var cN=Object.defineProperty;var uN=(u,r,i)=>r in u?cN(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i;var cI=(u,r,i)=>(uN(u,typeof r!="symbol"?r+"":r,i),i);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))m(_);new MutationObserver(_=>{for(const A of _)if(A.type==="childList")for(const w of A.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&m(w)}).observe(document,{childList:!0,subtree:!0});function i(_){const A={};return _.integrity&&(A.integrity=_.integrity),_.referrerPolicy&&(A.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?A.credentials="include":_.crossOrigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function m(_){if(_.ep)return;_.ep=!0;const A=i(_);fetch(_.href,A)}})();const style="";function makeMap(u,r){const i=Object.create(null),m=u.split(",");for(let _=0;_<m.length;_++)i[m[_]]=!0;return r?_=>!!i[_.toLowerCase()]:_=>!!i[_]}const EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,onRE=/^on[^a-z]/,isOn=u=>onRE.test(u),isModelListener=u=>u.startsWith("onUpdate:"),extend=Object.assign,remove=(u,r)=>{const i=u.indexOf(r);i>-1&&u.splice(i,1)},hasOwnProperty$1=Object.prototype.hasOwnProperty,hasOwn=(u,r)=>hasOwnProperty$1.call(u,r),isArray=Array.isArray,isMap=u=>toTypeString(u)==="[object Map]",isSet=u=>toTypeString(u)==="[object Set]",isDate=u=>toTypeString(u)==="[object Date]",isRegExp=u=>toTypeString(u)==="[object RegExp]",isFunction=u=>typeof u=="function",isString=u=>typeof u=="string",isSymbol=u=>typeof u=="symbol",isObject=u=>u!==null&&typeof u=="object",isPromise=u=>isObject(u)&&isFunction(u.then)&&isFunction(u.catch),objectToString=Object.prototype.toString,toTypeString=u=>objectToString.call(u),toRawType=u=>toTypeString(u).slice(8,-1),isPlainObject=u=>toTypeString(u)==="[object Object]",isIntegerKey=u=>isString(u)&&u!=="NaN"&&u[0]!=="-"&&""+parseInt(u,10)===u,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),isBuiltInDirective=makeMap("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo"),cacheStringFunction=u=>{const r=Object.create(null);return i=>r[i]||(r[i]=u(i))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(u=>u.replace(camelizeRE,(r,i)=>i?i.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(u=>u.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(u=>u.charAt(0).toUpperCase()+u.slice(1)),toHandlerKey=cacheStringFunction(u=>u?`on${capitalize(u)}`:""),hasChanged=(u,r)=>!Object.is(u,r),invokeArrayFns=(u,r)=>{for(let i=0;i<u.length;i++)u[i](r)},def=(u,r,i)=>{Object.defineProperty(u,r,{configurable:!0,enumerable:!1,value:i})},looseToNumber=u=>{const r=parseFloat(u);return isNaN(r)?u:r},toNumber=u=>{const r=isString(u)?Number(u):NaN;return isNaN(r)?u:r};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),GLOBALS_WHITE_LISTED="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console",isGloballyWhitelisted=makeMap(GLOBALS_WHITE_LISTED);function normalizeStyle(u){if(isArray(u)){const r={};for(let i=0;i<u.length;i++){const m=u[i],_=isString(m)?parseStringStyle(m):normalizeStyle(m);if(_)for(const A in _)r[A]=_[A]}return r}else{if(isString(u))return u;if(isObject(u))return u}}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:([^]+)/,styleCommentRE=/\/\*[^]*?\*\//g;function parseStringStyle(u){const r={};return u.replace(styleCommentRE,"").split(listDelimiterRE).forEach(i=>{if(i){const m=i.split(propertyDelimiterRE);m.length>1&&(r[m[0].trim()]=m[1].trim())}}),r}function normalizeClass(u){let r="";if(isString(u))r=u;else if(isArray(u))for(let i=0;i<u.length;i++){const m=normalizeClass(u[i]);m&&(r+=m+" ")}else if(isObject(u))for(const i in u)u[i]&&(r+=i+" ");return r.trim()}function normalizeProps(u){if(!u)return null;let{class:r,style:i}=u;return r&&!isString(r)&&(u.class=normalizeClass(r)),i&&(u.style=normalizeStyle(i)),u}const HTML_TAGS="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",SVG_TAGS="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistantLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",VOID_TAGS="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",isHTMLTag=makeMap(HTML_TAGS),isSVGTag=makeMap(SVG_TAGS),isVoidTag=makeMap(VOID_TAGS),specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(u){return!!u||u===""}function looseCompareArrays(u,r){if(u.length!==r.length)return!1;let i=!0;for(let m=0;i&&m<u.length;m++)i=looseEqual(u[m],r[m]);return i}function looseEqual(u,r){if(u===r)return!0;let i=isDate(u),m=isDate(r);if(i||m)return i&&m?u.getTime()===r.getTime():!1;if(i=isSymbol(u),m=isSymbol(r),i||m)return u===r;if(i=isArray(u),m=isArray(r),i||m)return i&&m?looseCompareArrays(u,r):!1;if(i=isObject(u),m=isObject(r),i||m){if(!i||!m)return!1;const _=Object.keys(u).length,A=Object.keys(r).length;if(_!==A)return!1;for(const w in u){const T=u.hasOwnProperty(w),R=r.hasOwnProperty(w);if(T&&!R||!T&&R||!looseEqual(u[w],r[w]))return!1}}return String(u)===String(r)}function looseIndexOf(u,r){return u.findIndex(i=>looseEqual(i,r))}const toDisplayString=u=>isString(u)?u:u==null?"":isArray(u)||isObject(u)&&(u.toString===objectToString||!isFunction(u.toString))?JSON.stringify(u,replacer,2):String(u),replacer=(u,r)=>r&&r.__v_isRef?replacer(u,r.value):isMap(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((i,[m,_])=>(i[`${m} =>`]=_,i),{})}:isSet(r)?{[`Set(${r.size})`]:[...r.values()]}:isObject(r)&&!isArray(r)&&!isPlainObject(r)?String(r):r;let activeEffectScope;class EffectScope{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=activeEffectScope,!r&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const i=activeEffectScope;try{return activeEffectScope=this,r()}finally{activeEffectScope=i}}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(r){if(this._active){let i,m;for(i=0,m=this.effects.length;i<m;i++)this.effects[i].stop();for(i=0,m=this.cleanups.length;i<m;i++)this.cleanups[i]();if(this.scopes)for(i=0,m=this.scopes.length;i<m;i++)this.scopes[i].stop(!0);if(!this.detached&&this.parent&&!r){const _=this.parent.scopes.pop();_&&_!==this&&(this.parent.scopes[this.index]=_,_.index=this.index)}this.parent=void 0,this._active=!1}}}function effectScope(u){return new EffectScope(u)}function recordEffectScope(u,r=activeEffectScope){r&&r.active&&r.effects.push(u)}function getCurrentScope(){return activeEffectScope}function onScopeDispose(u){activeEffectScope&&activeEffectScope.cleanups.push(u)}const createDep=u=>{const r=new Set(u);return r.w=0,r.n=0,r},wasTracked=u=>(u.w&trackOpBit)>0,newTracked=u=>(u.n&trackOpBit)>0,initDepMarkers=({deps:u})=>{if(u.length)for(let r=0;r<u.length;r++)u[r].w|=trackOpBit},finalizeDepMarkers=u=>{const{deps:r}=u;if(r.length){let i=0;for(let m=0;m<r.length;m++){const _=r[m];wasTracked(_)&&!newTracked(_)?_.delete(u):r[i++]=_,_.w&=~trackOpBit,_.n&=~trackOpBit}r.length=i}},targetMap=new WeakMap;let effectTrackDepth=0,trackOpBit=1;const maxMarkerBits=30;let activeEffect;const ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol("");class ReactiveEffect{constructor(r,i=null,m){this.fn=r,this.scheduler=i,this.active=!0,this.deps=[],this.parent=void 0,recordEffectScope(this,m)}run(){if(!this.active)return this.fn();let r=activeEffect,i=shouldTrack;for(;r;){if(r===this)return;r=r.parent}try{return this.parent=activeEffect,activeEffect=this,shouldTrack=!0,trackOpBit=1<<++effectTrackDepth,effectTrackDepth<=maxMarkerBits?initDepMarkers(this):cleanupEffect(this),this.fn()}finally{effectTrackDepth<=maxMarkerBits&&finalizeDepMarkers(this),trackOpBit=1<<--effectTrackDepth,activeEffect=this.parent,shouldTrack=i,this.parent=void 0,this.deferStop&&this.stop()}}stop(){activeEffect===this?this.deferStop=!0:this.active&&(cleanupEffect(this),this.onStop&&this.onStop(),this.active=!1)}}function cleanupEffect(u){const{deps:r}=u;if(r.length){for(let i=0;i<r.length;i++)r[i].delete(u);r.length=0}}function effect(u,r){u.effect&&(u=u.effect.fn);const i=new ReactiveEffect(u);r&&(extend(i,r),r.scope&&recordEffectScope(i,r.scope)),(!r||!r.lazy)&&i.run();const m=i.run.bind(i);return m.effect=i,m}function stop(u){u.effect.stop()}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const u=trackStack.pop();shouldTrack=u===void 0?!0:u}function track(u,r,i){if(shouldTrack&&activeEffect){let m=targetMap.get(u);m||targetMap.set(u,m=new Map);let _=m.get(i);_||m.set(i,_=createDep()),trackEffects(_)}}function trackEffects(u,r){let i=!1;effectTrackDepth<=maxMarkerBits?newTracked(u)||(u.n|=trackOpBit,i=!wasTracked(u)):i=!u.has(activeEffect),i&&(u.add(activeEffect),activeEffect.deps.push(u))}function trigger(u,r,i,m,_,A){const w=targetMap.get(u);if(!w)return;let T=[];if(r==="clear")T=[...w.values()];else if(i==="length"&&isArray(u)){const R=Number(m);w.forEach((D,U)=>{(U==="length"||U>=R)&&T.push(D)})}else switch(i!==void 0&&T.push(w.get(i)),r){case"add":isArray(u)?isIntegerKey(i)&&T.push(w.get("length")):(T.push(w.get(ITERATE_KEY)),isMap(u)&&T.push(w.get(MAP_KEY_ITERATE_KEY)));break;case"delete":isArray(u)||(T.push(w.get(ITERATE_KEY)),isMap(u)&&T.push(w.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(u)&&T.push(w.get(ITERATE_KEY));break}if(T.length===1)T[0]&&triggerEffects(T[0]);else{const R=[];for(const D of T)D&&R.push(...D);triggerEffects(createDep(R))}}function triggerEffects(u,r){const i=isArray(u)?u:[...u];for(const m of i)m.computed&&triggerEffect(m);for(const m of i)m.computed||triggerEffect(m)}function triggerEffect(u,r){(u!==activeEffect||u.allowRecurse)&&(u.scheduler?u.scheduler():u.run())}function getDepFromReactive(u,r){var i;return(i=targetMap.get(u))==null?void 0:i.get(r)}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(u=>u!=="arguments"&&u!=="caller").map(u=>Symbol[u]).filter(isSymbol)),get$1=createGetter(),shallowGet=createGetter(!1,!0),readonlyGet=createGetter(!0),shallowReadonlyGet=createGetter(!0,!0),arrayInstrumentations=createArrayInstrumentations();function createArrayInstrumentations(){const u={};return["includes","indexOf","lastIndexOf"].forEach(r=>{u[r]=function(...i){const m=toRaw(this);for(let A=0,w=this.length;A<w;A++)track(m,"get",A+"");const _=m[r](...i);return _===-1||_===!1?m[r](...i.map(toRaw)):_}}),["push","pop","shift","unshift","splice"].forEach(r=>{u[r]=function(...i){pauseTracking();const m=toRaw(this)[r].apply(this,i);return resetTracking(),m}}),u}function hasOwnProperty(u){const r=toRaw(this);return track(r,"has",u),r.hasOwnProperty(u)}function createGetter(u=!1,r=!1){return function(m,_,A){if(_==="__v_isReactive")return!u;if(_==="__v_isReadonly")return u;if(_==="__v_isShallow")return r;if(_==="__v_raw"&&A===(u?r?shallowReadonlyMap:readonlyMap:r?shallowReactiveMap:reactiveMap).get(m))return m;const w=isArray(m);if(!u){if(w&&hasOwn(arrayInstrumentations,_))return Reflect.get(arrayInstrumentations,_,A);if(_==="hasOwnProperty")return hasOwnProperty}const T=Reflect.get(m,_,A);return(isSymbol(_)?builtInSymbols.has(_):isNonTrackableKeys(_))||(u||track(m,"get",_),r)?T:isRef(T)?w&&isIntegerKey(_)?T:T.value:isObject(T)?u?readonly(T):reactive(T):T}}const set$1=createSetter(),shallowSet=createSetter(!0);function createSetter(u=!1){return function(i,m,_,A){let w=i[m];if(isReadonly(w)&&isRef(w)&&!isRef(_))return!1;if(!u&&(!isShallow(_)&&!isReadonly(_)&&(w=toRaw(w),_=toRaw(_)),!isArray(i)&&isRef(w)&&!isRef(_)))return w.value=_,!0;const T=isArray(i)&&isIntegerKey(m)?Number(m)<i.length:hasOwn(i,m),R=Reflect.set(i,m,_,A);return i===toRaw(A)&&(T?hasChanged(_,w)&&trigger(i,"set",m,_):trigger(i,"add",m,_)),R}}function deleteProperty(u,r){const i=hasOwn(u,r);u[r];const m=Reflect.deleteProperty(u,r);return m&&i&&trigger(u,"delete",r,void 0),m}function has$1(u,r){const i=Reflect.has(u,r);return(!isSymbol(r)||!builtInSymbols.has(r))&&track(u,"has",r),i}function ownKeys(u){return track(u,"iterate",isArray(u)?"length":ITERATE_KEY),Reflect.ownKeys(u)}const mutableHandlers={get:get$1,set:set$1,deleteProperty,has:has$1,ownKeys},readonlyHandlers={get:readonlyGet,set(u,r){return!0},deleteProperty(u,r){return!0}},shallowReactiveHandlers=extend({},mutableHandlers,{get:shallowGet,set:shallowSet}),shallowReadonlyHandlers=extend({},readonlyHandlers,{get:shallowReadonlyGet}),toShallow=u=>u,getProto$1=u=>Reflect.getPrototypeOf(u);function get(u,r,i=!1,m=!1){u=u.__v_raw;const _=toRaw(u),A=toRaw(r);i||(r!==A&&track(_,"get",r),track(_,"get",A));const{has:w}=getProto$1(_),T=m?toShallow:i?toReadonly:toReactive;if(w.call(_,r))return T(u.get(r));if(w.call(_,A))return T(u.get(A));u!==_&&u.get(r)}function has(u,r=!1){const i=this.__v_raw,m=toRaw(i),_=toRaw(u);return r||(u!==_&&track(m,"has",u),track(m,"has",_)),u===_?i.has(u):i.has(u)||i.has(_)}function size(u,r=!1){return u=u.__v_raw,!r&&track(toRaw(u),"iterate",ITERATE_KEY),Reflect.get(u,"size",u)}function add(u){u=toRaw(u);const r=toRaw(this);return getProto$1(r).has.call(r,u)||(r.add(u),trigger(r,"add",u,u)),this}function set(u,r){r=toRaw(r);const i=toRaw(this),{has:m,get:_}=getProto$1(i);let A=m.call(i,u);A||(u=toRaw(u),A=m.call(i,u));const w=_.call(i,u);return i.set(u,r),A?hasChanged(r,w)&&trigger(i,"set",u,r):trigger(i,"add",u,r),this}function deleteEntry(u){const r=toRaw(this),{has:i,get:m}=getProto$1(r);let _=i.call(r,u);_||(u=toRaw(u),_=i.call(r,u)),m&&m.call(r,u);const A=r.delete(u);return _&&trigger(r,"delete",u,void 0),A}function clear(){const u=toRaw(this),r=u.size!==0,i=u.clear();return r&&trigger(u,"clear",void 0,void 0),i}function createForEach(u,r){return function(m,_){const A=this,w=A.__v_raw,T=toRaw(w),R=r?toShallow:u?toReadonly:toReactive;return!u&&track(T,"iterate",ITERATE_KEY),w.forEach((D,U)=>m.call(_,R(D),R(U),A))}}function createIterableMethod(u,r,i){return function(...m){const _=this.__v_raw,A=toRaw(_),w=isMap(A),T=u==="entries"||u===Symbol.iterator&&w,R=u==="keys"&&w,D=_[u](...m),U=i?toShallow:r?toReadonly:toReactive;return!r&&track(A,"iterate",R?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:k,done:X}=D.next();return X?{value:k,done:X}:{value:T?[U(k[0]),U(k[1])]:U(k),done:X}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(u){return function(...r){return u==="delete"?!1:this}}function createInstrumentations(){const u={get(A){return get(this,A)},get size(){return size(this)},has,add,set,delete:deleteEntry,clear,forEach:createForEach(!1,!1)},r={get(A){return get(this,A,!1,!0)},get size(){return size(this)},has,add,set,delete:deleteEntry,clear,forEach:createForEach(!1,!0)},i={get(A){return get(this,A,!0)},get size(){return size(this,!0)},has(A){return has.call(this,A,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},m={get(A){return get(this,A,!0,!0)},get size(){return size(this,!0)},has(A){return has.call(this,A,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(A=>{u[A]=createIterableMethod(A,!1,!1),i[A]=createIterableMethod(A,!0,!1),r[A]=createIterableMethod(A,!1,!0),m[A]=createIterableMethod(A,!0,!0)}),[u,i,r,m]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(u,r){const i=r?u?shallowReadonlyInstrumentations:shallowInstrumentations:u?readonlyInstrumentations:mutableInstrumentations;return(m,_,A)=>_==="__v_isReactive"?!u:_==="__v_isReadonly"?u:_==="__v_raw"?m:Reflect.get(hasOwn(i,_)&&_ in m?i:m,_,A)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},shallowReadonlyCollectionHandlers={get:createInstrumentationGetter(!0,!0)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(u){switch(u){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(u){return u.__v_skip||!Object.isExtensible(u)?0:targetTypeMap(toRawType(u))}function reactive(u){return isReadonly(u)?u:createReactiveObject(u,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(u){return createReactiveObject(u,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(u){return createReactiveObject(u,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function shallowReadonly(u){return createReactiveObject(u,!0,shallowReadonlyHandlers,shallowReadonlyCollectionHandlers,shallowReadonlyMap)}function createReactiveObject(u,r,i,m,_){if(!isObject(u)||u.__v_raw&&!(r&&u.__v_isReactive))return u;const A=_.get(u);if(A)return A;const w=getTargetType(u);if(w===0)return u;const T=new Proxy(u,w===2?m:i);return _.set(u,T),T}function isReactive(u){return isReadonly(u)?isReactive(u.__v_raw):!!(u&&u.__v_isReactive)}function isReadonly(u){return!!(u&&u.__v_isReadonly)}function isShallow(u){return!!(u&&u.__v_isShallow)}function isProxy(u){return isReactive(u)||isReadonly(u)}function toRaw(u){const r=u&&u.__v_raw;return r?toRaw(r):u}function markRaw(u){return def(u,"__v_skip",!0),u}const toReactive=u=>isObject(u)?reactive(u):u,toReadonly=u=>isObject(u)?readonly(u):u;function trackRefValue(u){shouldTrack&&activeEffect&&(u=toRaw(u),trackEffects(u.dep||(u.dep=createDep())))}function triggerRefValue(u,r){u=toRaw(u);const i=u.dep;i&&triggerEffects(i)}function isRef(u){return!!(u&&u.__v_isRef===!0)}function ref(u){return createRef(u,!1)}function shallowRef(u){return createRef(u,!0)}function createRef(u,r){return isRef(u)?u:new RefImpl(u,r)}class RefImpl{constructor(r,i){this.__v_isShallow=i,this.dep=void 0,this.__v_isRef=!0,this._rawValue=i?r:toRaw(r),this._value=i?r:toReactive(r)}get value(){return trackRefValue(this),this._value}set value(r){const i=this.__v_isShallow||isShallow(r)||isReadonly(r);r=i?r:toRaw(r),hasChanged(r,this._rawValue)&&(this._rawValue=r,this._value=i?r:toReactive(r),triggerRefValue(this))}}function triggerRef(u){triggerRefValue(u)}function unref(u){return isRef(u)?u.value:u}function toValue(u){return isFunction(u)?u():unref(u)}const shallowUnwrapHandlers={get:(u,r,i)=>unref(Reflect.get(u,r,i)),set:(u,r,i,m)=>{const _=u[r];return isRef(_)&&!isRef(i)?(_.value=i,!0):Reflect.set(u,r,i,m)}};function proxyRefs(u){return isReactive(u)?u:new Proxy(u,shallowUnwrapHandlers)}class CustomRefImpl{constructor(r){this.dep=void 0,this.__v_isRef=!0;const{get:i,set:m}=r(()=>trackRefValue(this),()=>triggerRefValue(this));this._get=i,this._set=m}get value(){return this._get()}set value(r){this._set(r)}}function customRef(u){return new CustomRefImpl(u)}function toRefs(u){const r=isArray(u)?new Array(u.length):{};for(const i in u)r[i]=propertyToRef(u,i);return r}class ObjectRefImpl{constructor(r,i,m){this._object=r,this._key=i,this._defaultValue=m,this.__v_isRef=!0}get value(){const r=this._object[this._key];return r===void 0?this._defaultValue:r}set value(r){this._object[this._key]=r}get dep(){return getDepFromReactive(toRaw(this._object),this._key)}}class GetterRefImpl{constructor(r){this._getter=r,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function toRef(u,r,i){return isRef(u)?u:isFunction(u)?new GetterRefImpl(u):isObject(u)&&arguments.length>1?propertyToRef(u,r,i):ref(u)}function propertyToRef(u,r,i){const m=u[r];return isRef(m)?m:new ObjectRefImpl(u,r,i)}class ComputedRefImpl{constructor(r,i,m,_){this._setter=i,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new ReactiveEffect(r,()=>{this._dirty||(this._dirty=!0,triggerRefValue(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!_,this.__v_isReadonly=m}get value(){const r=toRaw(this);return trackRefValue(r),(r._dirty||!r._cacheable)&&(r._dirty=!1,r._value=r.effect.run()),r._value}set value(r){this._setter(r)}}function computed$1(u,r,i=!1){let m,_;const A=isFunction(u);return A?(m=u,_=NOOP):(m=u.get,_=u.set),new ComputedRefImpl(m,_,A||!_,i)}function warn(u,...r){}function assertNumber(u,r){}function callWithErrorHandling(u,r,i,m){let _;try{_=m?u(...m):u()}catch(A){handleError(A,r,i)}return _}function callWithAsyncErrorHandling(u,r,i,m){if(isFunction(u)){const A=callWithErrorHandling(u,r,i,m);return A&&isPromise(A)&&A.catch(w=>{handleError(w,r,i)}),A}const _=[];for(let A=0;A<u.length;A++)_.push(callWithAsyncErrorHandling(u[A],r,i,m));return _}function handleError(u,r,i,m=!0){const _=r?r.vnode:null;if(r){let A=r.parent;const w=r.proxy,T=i;for(;A;){const D=A.ec;if(D){for(let U=0;U<D.length;U++)if(D[U](u,w,T)===!1)return}A=A.parent}const R=r.appContext.config.errorHandler;if(R){callWithErrorHandling(R,null,10,[u,w,T]);return}}logError(u,i,_,m)}function logError(u,r,i,m=!0){console.error(u)}let isFlushing=!1,isFlushPending=!1;const queue=[];let flushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick(u){const r=currentFlushPromise||resolvedPromise;return u?r.then(this?u.bind(this):u):r}function findInsertionIndex(u){let r=flushIndex+1,i=queue.length;for(;r<i;){const m=r+i>>>1;getId(queue[m])<u?r=m+1:i=m}return r}function queueJob(u){(!queue.length||!queue.includes(u,isFlushing&&u.allowRecurse?flushIndex+1:flushIndex))&&(u.id==null?queue.push(u):queue.splice(findInsertionIndex(u.id),0,u),queueFlush())}function queueFlush(){!isFlushing&&!isFlushPending&&(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function invalidateJob(u){const r=queue.indexOf(u);r>flushIndex&&queue.splice(r,1)}function queuePostFlushCb(u){isArray(u)?pendingPostFlushCbs.push(...u):(!activePostFlushCbs||!activePostFlushCbs.includes(u,u.allowRecurse?postFlushIndex+1:postFlushIndex))&&pendingPostFlushCbs.push(u),queueFlush()}function flushPreFlushCbs(u,r=isFlushing?flushIndex+1:0){for(;r<queue.length;r++){const i=queue[r];i&&i.pre&&(queue.splice(r,1),r--,i())}}function flushPostFlushCbs(u){if(pendingPostFlushCbs.length){const r=[...new Set(pendingPostFlushCbs)];if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...r);return}for(activePostFlushCbs=r,activePostFlushCbs.sort((i,m)=>getId(i)-getId(m)),postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++)activePostFlushCbs[postFlushIndex]();activePostFlushCbs=null,postFlushIndex=0}}const getId=u=>u.id==null?1/0:u.id,comparator=(u,r)=>{const i=getId(u)-getId(r);if(i===0){if(u.pre&&!r.pre)return-1;if(r.pre&&!u.pre)return 1}return i};function flushJobs(u){isFlushPending=!1,isFlushing=!0,queue.sort(comparator);const r=NOOP;try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const i=queue[flushIndex];i&&i.active!==!1&&callWithErrorHandling(i,null,14)}}finally{flushIndex=0,queue.length=0,flushPostFlushCbs(),isFlushing=!1,currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs()}}let devtools,buffer=[];function setDevtoolsHook(u,r){var i,m;devtools=u,devtools?(devtools.enabled=!0,buffer.forEach(({event:_,args:A})=>devtools.emit(_,...A)),buffer=[]):typeof window<"u"&&window.HTMLElement&&!((m=(i=window.navigator)==null?void 0:i.userAgent)!=null&&m.includes("jsdom"))?((r.__VUE_DEVTOOLS_HOOK_REPLAY__=r.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(A=>{setDevtoolsHook(A,r)}),setTimeout(()=>{devtools||(r.__VUE_DEVTOOLS_HOOK_REPLAY__=null,buffer=[])},3e3)):buffer=[]}function emit(u,r,...i){if(u.isUnmounted)return;const m=u.vnode.props||EMPTY_OBJ;let _=i;const A=r.startsWith("update:"),w=A&&r.slice(7);if(w&&w in m){const U=`${w==="modelValue"?"model":w}Modifiers`,{number:k,trim:X}=m[U]||EMPTY_OBJ;X&&(_=i.map(J=>isString(J)?J.trim():J)),k&&(_=i.map(looseToNumber))}let T,R=m[T=toHandlerKey(r)]||m[T=toHandlerKey(camelize(r))];!R&&A&&(R=m[T=toHandlerKey(hyphenate(r))]),R&&callWithAsyncErrorHandling(R,u,6,_);const D=m[T+"Once"];if(D){if(!u.emitted)u.emitted={};else if(u.emitted[T])return;u.emitted[T]=!0,callWithAsyncErrorHandling(D,u,6,_)}}function normalizeEmitsOptions(u,r,i=!1){const m=r.emitsCache,_=m.get(u);if(_!==void 0)return _;const A=u.emits;let w={},T=!1;if(!isFunction(u)){const R=D=>{const U=normalizeEmitsOptions(D,r,!0);U&&(T=!0,extend(w,U))};!i&&r.mixins.length&&r.mixins.forEach(R),u.extends&&R(u.extends),u.mixins&&u.mixins.forEach(R)}return!A&&!T?(isObject(u)&&m.set(u,null),null):(isArray(A)?A.forEach(R=>w[R]=null):extend(w,A),isObject(u)&&m.set(u,w),w)}function isEmitListener(u,r){return!u||!isOn(r)?!1:(r=r.slice(2).replace(/Once$/,""),hasOwn(u,r[0].toLowerCase()+r.slice(1))||hasOwn(u,hyphenate(r))||hasOwn(u,r))}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(u){const r=currentRenderingInstance;return currentRenderingInstance=u,currentScopeId=u&&u.type.__scopeId||null,r}function pushScopeId(u){currentScopeId=u}function popScopeId(){currentScopeId=null}const withScopeId=u=>withCtx;function withCtx(u,r=currentRenderingInstance,i){if(!r||u._n)return u;const m=(..._)=>{m._d&&setBlockTracking(-1);const A=setCurrentRenderingInstance(r);let w;try{w=u(..._)}finally{setCurrentRenderingInstance(A),m._d&&setBlockTracking(1)}return w};return m._n=!0,m._c=!0,m._d=!0,m}function markAttrsAccessed(){}function renderComponentRoot(u){const{type:r,vnode:i,proxy:m,withProxy:_,props:A,propsOptions:[w],slots:T,attrs:R,emit:D,render:U,renderCache:k,data:X,setupState:J,ctx:$,inheritAttrs:oe}=u;let ne,H;const V=setCurrentRenderingInstance(u);try{if(i.shapeFlag&4){const ce=_||m;ne=normalizeVNode(U.call(ce,ce,k,A,J,X,$)),H=R}else{const ce=r;ne=normalizeVNode(ce.length>1?ce(A,{attrs:R,slots:T,emit:D}):ce(A,null)),H=r.props?R:getFunctionalFallthrough(R)}}catch(ce){blockStack.length=0,handleError(ce,u,1),ne=createVNode(Comment)}let z=ne;if(H&&oe!==!1){const ce=Object.keys(H),{shapeFlag:ue}=z;ce.length&&ue&7&&(w&&ce.some(isModelListener)&&(H=filterModelListeners(H,w)),z=cloneVNode(z,H))}return i.dirs&&(z=cloneVNode(z),z.dirs=z.dirs?z.dirs.concat(i.dirs):i.dirs),i.transition&&(z.transition=i.transition),ne=z,setCurrentRenderingInstance(V),ne}function filterSingleRoot(u){let r;for(let i=0;i<u.length;i++){const m=u[i];if(isVNode(m)){if(m.type!==Comment||m.children==="v-if"){if(r)return;r=m}}else return}return r}const getFunctionalFallthrough=u=>{let r;for(const i in u)(i==="class"||i==="style"||isOn(i))&&((r||(r={}))[i]=u[i]);return r},filterModelListeners=(u,r)=>{const i={};for(const m in u)(!isModelListener(m)||!(m.slice(9)in r))&&(i[m]=u[m]);return i};function shouldUpdateComponent(u,r,i){const{props:m,children:_,component:A}=u,{props:w,children:T,patchFlag:R}=r,D=A.emitsOptions;if(r.dirs||r.transition)return!0;if(i&&R>=0){if(R&1024)return!0;if(R&16)return m?hasPropsChanged(m,w,D):!!w;if(R&8){const U=r.dynamicProps;for(let k=0;k<U.length;k++){const X=U[k];if(w[X]!==m[X]&&!isEmitListener(D,X))return!0}}}else return(_||T)&&(!T||!T.$stable)?!0:m===w?!1:m?w?hasPropsChanged(m,w,D):!0:!!w;return!1}function hasPropsChanged(u,r,i){const m=Object.keys(r);if(m.length!==Object.keys(u).length)return!0;for(let _=0;_<m.length;_++){const A=m[_];if(r[A]!==u[A]&&!isEmitListener(i,A))return!0}return!1}function updateHOCHostEl({vnode:u,parent:r},i){for(;r&&r.subTree===u;)(u=r.vnode).el=i,r=r.parent}const isSuspense=u=>u.__isSuspense,SuspenseImpl={name:"Suspense",__isSuspense:!0,process(u,r,i,m,_,A,w,T,R,D){u==null?mountSuspense(r,i,m,_,A,w,T,R,D):patchSuspense(u,r,i,m,_,w,T,R,D)},hydrate:hydrateSuspense,create:createSuspenseBoundary,normalize:normalizeSuspenseChildren},Suspense=SuspenseImpl;function triggerEvent(u,r){const i=u.props&&u.props[r];isFunction(i)&&i()}function mountSuspense(u,r,i,m,_,A,w,T,R){const{p:D,o:{createElement:U}}=R,k=U("div"),X=u.suspense=createSuspenseBoundary(u,_,m,r,k,i,A,w,T,R);D(null,X.pendingBranch=u.ssContent,k,null,m,X,A,w),X.deps>0?(triggerEvent(u,"onPending"),triggerEvent(u,"onFallback"),D(null,u.ssFallback,r,i,m,null,A,w),setActiveBranch(X,u.ssFallback)):X.resolve(!1,!0)}function patchSuspense(u,r,i,m,_,A,w,T,{p:R,um:D,o:{createElement:U}}){const k=r.suspense=u.suspense;k.vnode=r,r.el=u.el;const X=r.ssContent,J=r.ssFallback,{activeBranch:$,pendingBranch:oe,isInFallback:ne,isHydrating:H}=k;if(oe)k.pendingBranch=X,isSameVNodeType(X,oe)?(R(oe,X,k.hiddenContainer,null,_,k,A,w,T),k.deps<=0?k.resolve():ne&&(R($,J,i,m,_,null,A,w,T),setActiveBranch(k,J))):(k.pendingId++,H?(k.isHydrating=!1,k.activeBranch=oe):D(oe,_,k),k.deps=0,k.effects.length=0,k.hiddenContainer=U("div"),ne?(R(null,X,k.hiddenContainer,null,_,k,A,w,T),k.deps<=0?k.resolve():(R($,J,i,m,_,null,A,w,T),setActiveBranch(k,J))):$&&isSameVNodeType(X,$)?(R($,X,i,m,_,k,A,w,T),k.resolve(!0)):(R(null,X,k.hiddenContainer,null,_,k,A,w,T),k.deps<=0&&k.resolve()));else if($&&isSameVNodeType(X,$))R($,X,i,m,_,k,A,w,T),setActiveBranch(k,X);else if(triggerEvent(r,"onPending"),k.pendingBranch=X,k.pendingId++,R(null,X,k.hiddenContainer,null,_,k,A,w,T),k.deps<=0)k.resolve();else{const{timeout:V,pendingId:z}=k;V>0?setTimeout(()=>{k.pendingId===z&&k.fallback(J)},V):V===0&&k.fallback(J)}}function createSuspenseBoundary(u,r,i,m,_,A,w,T,R,D,U=!1){const{p:k,m:X,um:J,n:$,o:{parentNode:oe,remove:ne}}=D;let H;const V=isVNodeSuspensible(u);V&&r!=null&&r.pendingBranch&&(H=r.pendingId,r.deps++);const z=u.props?toNumber(u.props.timeout):void 0,ce={vnode:u,parent:r,parentComponent:i,isSVG:w,container:m,hiddenContainer:_,anchor:A,deps:0,pendingId:0,timeout:typeof z=="number"?z:-1,activeBranch:null,pendingBranch:null,isInFallback:!0,isHydrating:U,isUnmounted:!1,effects:[],resolve(ue=!1,he=!1){const{vnode:K,activeBranch:Y,pendingBranch:ie,pendingId:ve,effects:re,parentComponent:ae,container:me}=ce;if(ce.isHydrating)ce.isHydrating=!1;else if(!ue){const ke=Y&&ie.transition&&ie.transition.mode==="out-in";ke&&(Y.transition.afterLeave=()=>{ve===ce.pendingId&&X(ie,me,Fe,0)});let{anchor:Fe}=ce;Y&&(Fe=$(Y),J(Y,ae,ce,!0)),ke||X(ie,me,Fe,0)}setActiveBranch(ce,ie),ce.pendingBranch=null,ce.isInFallback=!1;let ye=ce.parent,Te=!1;for(;ye;){if(ye.pendingBranch){ye.effects.push(...re),Te=!0;break}ye=ye.parent}Te||queuePostFlushCb(re),ce.effects=[],V&&r&&r.pendingBranch&&H===r.pendingId&&(r.deps--,r.deps===0&&!he&&r.resolve()),triggerEvent(K,"onResolve")},fallback(ue){if(!ce.pendingBranch)return;const{vnode:he,activeBranch:K,parentComponent:Y,container:ie,isSVG:ve}=ce;triggerEvent(he,"onFallback");const re=$(K),ae=()=>{ce.isInFallback&&(k(null,ue,ie,re,Y,null,ve,T,R),setActiveBranch(ce,ue))},me=ue.transition&&ue.transition.mode==="out-in";me&&(K.transition.afterLeave=ae),ce.isInFallback=!0,J(K,Y,null,!0),me||ae()},move(ue,he,K){ce.activeBranch&&X(ce.activeBranch,ue,he,K),ce.container=ue},next(){return ce.activeBranch&&$(ce.activeBranch)},registerDep(ue,he){const K=!!ce.pendingBranch;K&&ce.deps++;const Y=ue.vnode.el;ue.asyncDep.catch(ie=>{handleError(ie,ue,0)}).then(ie=>{if(ue.isUnmounted||ce.isUnmounted||ce.pendingId!==ue.suspenseId)return;ue.asyncResolved=!0;const{vnode:ve}=ue;handleSetupResult(ue,ie,!1),Y&&(ve.el=Y);const re=!Y&&ue.subTree.el;he(ue,ve,oe(Y||ue.subTree.el),Y?null:$(ue.subTree),ce,w,R),re&&ne(re),updateHOCHostEl(ue,ve.el),K&&--ce.deps===0&&ce.resolve()})},unmount(ue,he){ce.isUnmounted=!0,ce.activeBranch&&J(ce.activeBranch,i,ue,he),ce.pendingBranch&&J(ce.pendingBranch,i,ue,he)}};return ce}function hydrateSuspense(u,r,i,m,_,A,w,T,R){const D=r.suspense=createSuspenseBoundary(r,m,i,u.parentNode,document.createElement("div"),null,_,A,w,T,!0),U=R(u,D.pendingBranch=r.ssContent,i,D,A,w);return D.deps===0&&D.resolve(!1,!0),U}function normalizeSuspenseChildren(u){const{shapeFlag:r,children:i}=u,m=r&32;u.ssContent=normalizeSuspenseSlot(m?i.default:i),u.ssFallback=m?normalizeSuspenseSlot(i.fallback):createVNode(Comment)}function normalizeSuspenseSlot(u){let r;if(isFunction(u)){const i=isBlockTreeEnabled&&u._c;i&&(u._d=!1,openBlock()),u=u(),i&&(u._d=!0,r=currentBlock,closeBlock())}return isArray(u)&&(u=filterSingleRoot(u)),u=normalizeVNode(u),r&&!u.dynamicChildren&&(u.dynamicChildren=r.filter(i=>i!==u)),u}function queueEffectWithSuspense(u,r){r&&r.pendingBranch?isArray(u)?r.effects.push(...u):r.effects.push(u):queuePostFlushCb(u)}function setActiveBranch(u,r){u.activeBranch=r;const{vnode:i,parentComponent:m}=u,_=i.el=r.el;m&&m.subTree===i&&(m.vnode.el=_,updateHOCHostEl(m,_))}function isVNodeSuspensible(u){var r;return((r=u.props)==null?void 0:r.suspensible)!=null&&u.props.suspensible!==!1}function watchEffect(u,r){return doWatch(u,null,r)}function watchPostEffect(u,r){return doWatch(u,null,{flush:"post"})}function watchSyncEffect(u,r){return doWatch(u,null,{flush:"sync"})}const INITIAL_WATCHER_VALUE={};function watch(u,r,i){return doWatch(u,r,i)}function doWatch(u,r,{immediate:i,deep:m,flush:_,onTrack:A,onTrigger:w}=EMPTY_OBJ){var T;const R=getCurrentScope()===((T=currentInstance)==null?void 0:T.scope)?currentInstance:null;let D,U=!1,k=!1;if(isRef(u)?(D=()=>u.value,U=isShallow(u)):isReactive(u)?(D=()=>u,m=!0):isArray(u)?(k=!0,U=u.some(ce=>isReactive(ce)||isShallow(ce)),D=()=>u.map(ce=>{if(isRef(ce))return ce.value;if(isReactive(ce))return traverse(ce);if(isFunction(ce))return callWithErrorHandling(ce,R,2)})):isFunction(u)?r?D=()=>callWithErrorHandling(u,R,2):D=()=>{if(!(R&&R.isUnmounted))return X&&X(),callWithAsyncErrorHandling(u,R,3,[J])}:D=NOOP,r&&m){const ce=D;D=()=>traverse(ce())}let X,J=ce=>{X=V.onStop=()=>{callWithErrorHandling(ce,R,4)}},$;if(isInSSRComponentSetup)if(J=NOOP,r?i&&callWithAsyncErrorHandling(r,R,3,[D(),k?[]:void 0,J]):D(),_==="sync"){const ce=useSSRContext();$=ce.__watcherHandles||(ce.__watcherHandles=[])}else return NOOP;let oe=k?new Array(u.length).fill(INITIAL_WATCHER_VALUE):INITIAL_WATCHER_VALUE;const ne=()=>{if(V.active)if(r){const ce=V.run();(m||U||(k?ce.some((ue,he)=>hasChanged(ue,oe[he])):hasChanged(ce,oe)))&&(X&&X(),callWithAsyncErrorHandling(r,R,3,[ce,oe===INITIAL_WATCHER_VALUE?void 0:k&&oe[0]===INITIAL_WATCHER_VALUE?[]:oe,J]),oe=ce)}else V.run()};ne.allowRecurse=!!r;let H;_==="sync"?H=ne:_==="post"?H=()=>queuePostRenderEffect(ne,R&&R.suspense):(ne.pre=!0,R&&(ne.id=R.uid),H=()=>queueJob(ne));const V=new ReactiveEffect(D,H);r?i?ne():oe=V.run():_==="post"?queuePostRenderEffect(V.run.bind(V),R&&R.suspense):V.run();const z=()=>{V.stop(),R&&R.scope&&remove(R.scope.effects,V)};return $&&$.push(z),z}function instanceWatch(u,r,i){const m=this.proxy,_=isString(u)?u.includes(".")?createPathGetter(m,u):()=>m[u]:u.bind(m,m);let A;isFunction(r)?A=r:(A=r.handler,i=r);const w=currentInstance;setCurrentInstance(this);const T=doWatch(_,A.bind(m),i);return w?setCurrentInstance(w):unsetCurrentInstance(),T}function createPathGetter(u,r){const i=r.split(".");return()=>{let m=u;for(let _=0;_<i.length&&m;_++)m=m[i[_]];return m}}function traverse(u,r){if(!isObject(u)||u.__v_skip||(r=r||new Set,r.has(u)))return u;if(r.add(u),isRef(u))traverse(u.value,r);else if(isArray(u))for(let i=0;i<u.length;i++)traverse(u[i],r);else if(isSet(u)||isMap(u))u.forEach(i=>{traverse(i,r)});else if(isPlainObject(u))for(const i in u)traverse(u[i],r);return u}function withDirectives(u,r){const i=currentRenderingInstance;if(i===null)return u;const m=getExposeProxy(i)||i.proxy,_=u.dirs||(u.dirs=[]);for(let A=0;A<r.length;A++){let[w,T,R,D=EMPTY_OBJ]=r[A];w&&(isFunction(w)&&(w={mounted:w,updated:w}),w.deep&&traverse(T),_.push({dir:w,instance:m,value:T,oldValue:void 0,arg:R,modifiers:D}))}return u}function invokeDirectiveHook(u,r,i,m){const _=u.dirs,A=r&&r.dirs;for(let w=0;w<_.length;w++){const T=_[w];A&&(T.oldValue=A[w].value);let R=T.dir[m];R&&(pauseTracking(),callWithAsyncErrorHandling(R,i,8,[u.el,T,u,r]),resetTracking())}}function useTransitionState(){const u={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return onMounted(()=>{u.isMounted=!0}),onBeforeUnmount(()=>{u.isUnmounting=!0}),u}const TransitionHookValidator=[Function,Array],BaseTransitionPropsValidators={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:TransitionHookValidator,onEnter:TransitionHookValidator,onAfterEnter:TransitionHookValidator,onEnterCancelled:TransitionHookValidator,onBeforeLeave:TransitionHookValidator,onLeave:TransitionHookValidator,onAfterLeave:TransitionHookValidator,onLeaveCancelled:TransitionHookValidator,onBeforeAppear:TransitionHookValidator,onAppear:TransitionHookValidator,onAfterAppear:TransitionHookValidator,onAppearCancelled:TransitionHookValidator},BaseTransitionImpl={name:"BaseTransition",props:BaseTransitionPropsValidators,setup(u,{slots:r}){const i=getCurrentInstance(),m=useTransitionState();let _;return()=>{const A=r.default&&getTransitionRawChildren(r.default(),!0);if(!A||!A.length)return;let w=A[0];if(A.length>1){for(const oe of A)if(oe.type!==Comment){w=oe;break}}const T=toRaw(u),{mode:R}=T;if(m.isLeaving)return emptyPlaceholder(w);const D=getKeepAliveChild(w);if(!D)return emptyPlaceholder(w);const U=resolveTransitionHooks(D,T,m,i);setTransitionHooks(D,U);const k=i.subTree,X=k&&getKeepAliveChild(k);let J=!1;const{getTransitionKey:$}=D.type;if($){const oe=$();_===void 0?_=oe:oe!==_&&(_=oe,J=!0)}if(X&&X.type!==Comment&&(!isSameVNodeType(D,X)||J)){const oe=resolveTransitionHooks(X,T,m,i);if(setTransitionHooks(X,oe),R==="out-in")return m.isLeaving=!0,oe.afterLeave=()=>{m.isLeaving=!1,i.update.active!==!1&&i.update()},emptyPlaceholder(w);R==="in-out"&&D.type!==Comment&&(oe.delayLeave=(ne,H,V)=>{const z=getLeavingNodesForType(m,X);z[String(X.key)]=X,ne._leaveCb=()=>{H(),ne._leaveCb=void 0,delete U.delayedLeave},U.delayedLeave=V})}return w}}},BaseTransition=BaseTransitionImpl;function getLeavingNodesForType(u,r){const{leavingVNodes:i}=u;let m=i.get(r.type);return m||(m=Object.create(null),i.set(r.type,m)),m}function resolveTransitionHooks(u,r,i,m){const{appear:_,mode:A,persisted:w=!1,onBeforeEnter:T,onEnter:R,onAfterEnter:D,onEnterCancelled:U,onBeforeLeave:k,onLeave:X,onAfterLeave:J,onLeaveCancelled:$,onBeforeAppear:oe,onAppear:ne,onAfterAppear:H,onAppearCancelled:V}=r,z=String(u.key),ce=getLeavingNodesForType(i,u),ue=(Y,ie)=>{Y&&callWithAsyncErrorHandling(Y,m,9,ie)},he=(Y,ie)=>{const ve=ie[1];ue(Y,ie),isArray(Y)?Y.every(re=>re.length<=1)&&ve():Y.length<=1&&ve()},K={mode:A,persisted:w,beforeEnter(Y){let ie=T;if(!i.isMounted)if(_)ie=oe||T;else return;Y._leaveCb&&Y._leaveCb(!0);const ve=ce[z];ve&&isSameVNodeType(u,ve)&&ve.el._leaveCb&&ve.el._leaveCb(),ue(ie,[Y])},enter(Y){let ie=R,ve=D,re=U;if(!i.isMounted)if(_)ie=ne||R,ve=H||D,re=V||U;else return;let ae=!1;const me=Y._enterCb=ye=>{ae||(ae=!0,ye?ue(re,[Y]):ue(ve,[Y]),K.delayedLeave&&K.delayedLeave(),Y._enterCb=void 0)};ie?he(ie,[Y,me]):me()},leave(Y,ie){const ve=String(u.key);if(Y._enterCb&&Y._enterCb(!0),i.isUnmounting)return ie();ue(k,[Y]);let re=!1;const ae=Y._leaveCb=me=>{re||(re=!0,ie(),me?ue($,[Y]):ue(J,[Y]),Y._leaveCb=void 0,ce[ve]===u&&delete ce[ve])};ce[ve]=u,X?he(X,[Y,ae]):ae()},clone(Y){return resolveTransitionHooks(Y,r,i,m)}};return K}function emptyPlaceholder(u){if(isKeepAlive(u))return u=cloneVNode(u),u.children=null,u}function getKeepAliveChild(u){return isKeepAlive(u)?u.children?u.children[0]:void 0:u}function setTransitionHooks(u,r){u.shapeFlag&6&&u.component?setTransitionHooks(u.component.subTree,r):u.shapeFlag&128?(u.ssContent.transition=r.clone(u.ssContent),u.ssFallback.transition=r.clone(u.ssFallback)):u.transition=r}function getTransitionRawChildren(u,r=!1,i){let m=[],_=0;for(let A=0;A<u.length;A++){let w=u[A];const T=i==null?w.key:String(i)+String(w.key!=null?w.key:A);w.type===Fragment?(w.patchFlag&128&&_++,m=m.concat(getTransitionRawChildren(w.children,r,T))):(r||w.type!==Comment)&&m.push(T!=null?cloneVNode(w,{key:T}):w)}if(_>1)for(let A=0;A<m.length;A++)m[A].patchFlag=-2;return m}function defineComponent(u,r){return isFunction(u)?(()=>extend({name:u.name},r,{setup:u}))():u}const isAsyncWrapper=u=>!!u.type.__asyncLoader;function defineAsyncComponent(u){isFunction(u)&&(u={loader:u});const{loader:r,loadingComponent:i,errorComponent:m,delay:_=200,timeout:A,suspensible:w=!0,onError:T}=u;let R=null,D,U=0;const k=()=>(U++,R=null,X()),X=()=>{let J;return R||(J=R=r().catch($=>{if($=$ instanceof Error?$:new Error(String($)),T)return new Promise((oe,ne)=>{T($,()=>oe(k()),()=>ne($),U+1)});throw $}).then($=>J!==R&&R?R:($&&($.__esModule||$[Symbol.toStringTag]==="Module")&&($=$.default),D=$,$)))};return defineComponent({name:"AsyncComponentWrapper",__asyncLoader:X,get __asyncResolved(){return D},setup(){const J=currentInstance;if(D)return()=>createInnerComp(D,J);const $=V=>{R=null,handleError(V,J,13,!m)};if(w&&J.suspense||isInSSRComponentSetup)return X().then(V=>()=>createInnerComp(V,J)).catch(V=>($(V),()=>m?createVNode(m,{error:V}):null));const oe=ref(!1),ne=ref(),H=ref(!!_);return _&&setTimeout(()=>{H.value=!1},_),A!=null&&setTimeout(()=>{if(!oe.value&&!ne.value){const V=new Error(`Async component timed out after ${A}ms.`);$(V),ne.value=V}},A),X().then(()=>{oe.value=!0,J.parent&&isKeepAlive(J.parent.vnode)&&queueJob(J.parent.update)}).catch(V=>{$(V),ne.value=V}),()=>{if(oe.value&&D)return createInnerComp(D,J);if(ne.value&&m)return createVNode(m,{error:ne.value});if(i&&!H.value)return createVNode(i)}}})}function createInnerComp(u,r){const{ref:i,props:m,children:_,ce:A}=r.vnode,w=createVNode(u,m,_);return w.ref=i,w.ce=A,delete r.vnode.ce,w}const isKeepAlive=u=>u.type.__isKeepAlive,KeepAliveImpl={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(u,{slots:r}){const i=getCurrentInstance(),m=i.ctx;if(!m.renderer)return()=>{const V=r.default&&r.default();return V&&V.length===1?V[0]:V};const _=new Map,A=new Set;let w=null;const T=i.suspense,{renderer:{p:R,m:D,um:U,o:{createElement:k}}}=m,X=k("div");m.activate=(V,z,ce,ue,he)=>{const K=V.component;D(V,z,ce,0,T),R(K.vnode,V,z,ce,K,T,ue,V.slotScopeIds,he),queuePostRenderEffect(()=>{K.isDeactivated=!1,K.a&&invokeArrayFns(K.a);const Y=V.props&&V.props.onVnodeMounted;Y&&invokeVNodeHook(Y,K.parent,V)},T)},m.deactivate=V=>{const z=V.component;D(V,X,null,1,T),queuePostRenderEffect(()=>{z.da&&invokeArrayFns(z.da);const ce=V.props&&V.props.onVnodeUnmounted;ce&&invokeVNodeHook(ce,z.parent,V),z.isDeactivated=!0},T)};function J(V){resetShapeFlag(V),U(V,i,T,!0)}function $(V){_.forEach((z,ce)=>{const ue=getComponentName(z.type);ue&&(!V||!V(ue))&&oe(ce)})}function oe(V){const z=_.get(V);!w||!isSameVNodeType(z,w)?J(z):w&&resetShapeFlag(w),_.delete(V),A.delete(V)}watch(()=>[u.include,u.exclude],([V,z])=>{V&&$(ce=>matches(V,ce)),z&&$(ce=>!matches(z,ce))},{flush:"post",deep:!0});let ne=null;const H=()=>{ne!=null&&_.set(ne,getInnerChild(i.subTree))};return onMounted(H),onUpdated(H),onBeforeUnmount(()=>{_.forEach(V=>{const{subTree:z,suspense:ce}=i,ue=getInnerChild(z);if(V.type===ue.type&&V.key===ue.key){resetShapeFlag(ue);const he=ue.component.da;he&&queuePostRenderEffect(he,ce);return}J(V)})}),()=>{if(ne=null,!r.default)return null;const V=r.default(),z=V[0];if(V.length>1)return w=null,V;if(!isVNode(z)||!(z.shapeFlag&4)&&!(z.shapeFlag&128))return w=null,z;let ce=getInnerChild(z);const ue=ce.type,he=getComponentName(isAsyncWrapper(ce)?ce.type.__asyncResolved||{}:ue),{include:K,exclude:Y,max:ie}=u;if(K&&(!he||!matches(K,he))||Y&&he&&matches(Y,he))return w=ce,z;const ve=ce.key==null?ue:ce.key,re=_.get(ve);return ce.el&&(ce=cloneVNode(ce),z.shapeFlag&128&&(z.ssContent=ce)),ne=ve,re?(ce.el=re.el,ce.component=re.component,ce.transition&&setTransitionHooks(ce,ce.transition),ce.shapeFlag|=512,A.delete(ve),A.add(ve)):(A.add(ve),ie&&A.size>parseInt(ie,10)&&oe(A.values().next().value)),ce.shapeFlag|=256,w=ce,isSuspense(z.type)?z:ce}}},KeepAlive=KeepAliveImpl;function matches(u,r){return isArray(u)?u.some(i=>matches(i,r)):isString(u)?u.split(",").includes(r):isRegExp(u)?u.test(r):!1}function onActivated(u,r){registerKeepAliveHook(u,"a",r)}function onDeactivated(u,r){registerKeepAliveHook(u,"da",r)}function registerKeepAliveHook(u,r,i=currentInstance){const m=u.__wdc||(u.__wdc=()=>{let _=i;for(;_;){if(_.isDeactivated)return;_=_.parent}return u()});if(injectHook(r,m,i),i){let _=i.parent;for(;_&&_.parent;)isKeepAlive(_.parent.vnode)&&injectToKeepAliveRoot(m,r,i,_),_=_.parent}}function injectToKeepAliveRoot(u,r,i,m){const _=injectHook(r,u,m,!0);onUnmounted(()=>{remove(m[r],_)},i)}function resetShapeFlag(u){u.shapeFlag&=-257,u.shapeFlag&=-513}function getInnerChild(u){return u.shapeFlag&128?u.ssContent:u}function injectHook(u,r,i=currentInstance,m=!1){if(i){const _=i[u]||(i[u]=[]),A=r.__weh||(r.__weh=(...w)=>{if(i.isUnmounted)return;pauseTracking(),setCurrentInstance(i);const T=callWithAsyncErrorHandling(r,i,u,w);return unsetCurrentInstance(),resetTracking(),T});return m?_.unshift(A):_.push(A),A}}const createHook=u=>(r,i=currentInstance)=>(!isInSSRComponentSetup||u==="sp")&&injectHook(u,(...m)=>r(...m),i),onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(u,r=currentInstance){injectHook("ec",u,r)}const COMPONENTS="components",DIRECTIVES="directives";function resolveComponent(u,r){return resolveAsset(COMPONENTS,u,!0,r)||u}const NULL_DYNAMIC_COMPONENT=Symbol.for("v-ndc");function resolveDynamicComponent(u){return isString(u)?resolveAsset(COMPONENTS,u,!1)||u:u||NULL_DYNAMIC_COMPONENT}function resolveDirective(u){return resolveAsset(DIRECTIVES,u)}function resolveAsset(u,r,i=!0,m=!1){const _=currentRenderingInstance||currentInstance;if(_){const A=_.type;if(u===COMPONENTS){const T=getComponentName(A,!1);if(T&&(T===r||T===camelize(r)||T===capitalize(camelize(r))))return A}const w=resolve(_[u]||A[u],r)||resolve(_.appContext[u],r);return!w&&m?A:w}}function resolve(u,r){return u&&(u[r]||u[camelize(r)]||u[capitalize(camelize(r))])}function renderList(u,r,i,m){let _;const A=i&&i[m];if(isArray(u)||isString(u)){_=new Array(u.length);for(let w=0,T=u.length;w<T;w++)_[w]=r(u[w],w,void 0,A&&A[w])}else if(typeof u=="number"){_=new Array(u);for(let w=0;w<u;w++)_[w]=r(w+1,w,void 0,A&&A[w])}else if(isObject(u))if(u[Symbol.iterator])_=Array.from(u,(w,T)=>r(w,T,void 0,A&&A[T]));else{const w=Object.keys(u);_=new Array(w.length);for(let T=0,R=w.length;T<R;T++){const D=w[T];_[T]=r(u[D],D,T,A&&A[T])}}else _=[];return i&&(i[m]=_),_}function createSlots(u,r){for(let i=0;i<r.length;i++){const m=r[i];if(isArray(m))for(let _=0;_<m.length;_++)u[m[_].name]=m[_].fn;else m&&(u[m.name]=m.key?(..._)=>{const A=m.fn(..._);return A&&(A.key=m.key),A}:m.fn)}return u}function renderSlot(u,r,i={},m,_){if(currentRenderingInstance.isCE||currentRenderingInstance.parent&&isAsyncWrapper(currentRenderingInstance.parent)&&currentRenderingInstance.parent.isCE)return r!=="default"&&(i.name=r),createVNode("slot",i,m&&m());let A=u[r];A&&A._c&&(A._d=!1),openBlock();const w=A&&ensureValidVNode(A(i)),T=createBlock(Fragment,{key:i.key||w&&w.key||`_${r}`},w||(m?m():[]),w&&u._===1?64:-2);return!_&&T.scopeId&&(T.slotScopeIds=[T.scopeId+"-s"]),A&&A._c&&(A._d=!0),T}function ensureValidVNode(u){return u.some(r=>isVNode(r)?!(r.type===Comment||r.type===Fragment&&!ensureValidVNode(r.children)):!0)?u:null}function toHandlers(u,r){const i={};for(const m in u)i[r&&/[A-Z]/.test(m)?`on:${m}`:toHandlerKey(m)]=u[m];return i}const getPublicInstance=u=>u?isStatefulComponent(u)?getExposeProxy(u)||u.proxy:getPublicInstance(u.parent):null,publicPropertiesMap=extend(Object.create(null),{$:u=>u,$el:u=>u.vnode.el,$data:u=>u.data,$props:u=>u.props,$attrs:u=>u.attrs,$slots:u=>u.slots,$refs:u=>u.refs,$parent:u=>getPublicInstance(u.parent),$root:u=>getPublicInstance(u.root),$emit:u=>u.emit,$options:u=>resolveMergedOptions(u),$forceUpdate:u=>u.f||(u.f=()=>queueJob(u.update)),$nextTick:u=>u.n||(u.n=nextTick.bind(u.proxy)),$watch:u=>instanceWatch.bind(u)}),hasSetupBinding=(u,r)=>u!==EMPTY_OBJ&&!u.__isScriptSetup&&hasOwn(u,r),PublicInstanceProxyHandlers={get({_:u},r){const{ctx:i,setupState:m,data:_,props:A,accessCache:w,type:T,appContext:R}=u;let D;if(r[0]!=="$"){const J=w[r];if(J!==void 0)switch(J){case 1:return m[r];case 2:return _[r];case 4:return i[r];case 3:return A[r]}else{if(hasSetupBinding(m,r))return w[r]=1,m[r];if(_!==EMPTY_OBJ&&hasOwn(_,r))return w[r]=2,_[r];if((D=u.propsOptions[0])&&hasOwn(D,r))return w[r]=3,A[r];if(i!==EMPTY_OBJ&&hasOwn(i,r))return w[r]=4,i[r];shouldCacheAccess&&(w[r]=0)}}const U=publicPropertiesMap[r];let k,X;if(U)return r==="$attrs"&&track(u,"get",r),U(u);if((k=T.__cssModules)&&(k=k[r]))return k;if(i!==EMPTY_OBJ&&hasOwn(i,r))return w[r]=4,i[r];if(X=R.config.globalProperties,hasOwn(X,r))return X[r]},set({_:u},r,i){const{data:m,setupState:_,ctx:A}=u;return hasSetupBinding(_,r)?(_[r]=i,!0):m!==EMPTY_OBJ&&hasOwn(m,r)?(m[r]=i,!0):hasOwn(u.props,r)||r[0]==="$"&&r.slice(1)in u?!1:(A[r]=i,!0)},has({_:{data:u,setupState:r,accessCache:i,ctx:m,appContext:_,propsOptions:A}},w){let T;return!!i[w]||u!==EMPTY_OBJ&&hasOwn(u,w)||hasSetupBinding(r,w)||(T=A[0])&&hasOwn(T,w)||hasOwn(m,w)||hasOwn(publicPropertiesMap,w)||hasOwn(_.config.globalProperties,w)},defineProperty(u,r,i){return i.get!=null?u._.accessCache[r]=0:hasOwn(i,"value")&&this.set(u,r,i.value,null),Reflect.defineProperty(u,r,i)}},RuntimeCompiledPublicInstanceProxyHandlers=extend({},PublicInstanceProxyHandlers,{get(u,r){if(r!==Symbol.unscopables)return PublicInstanceProxyHandlers.get(u,r,u)},has(u,r){return r[0]!=="_"&&!isGloballyWhitelisted(r)}});function defineProps(){return null}function defineEmits(){return null}function defineExpose(u){}function defineOptions(u){}function defineSlots(){return null}function defineModel(){}function withDefaults(u,r){return null}function useSlots(){return getContext().slots}function useAttrs(){return getContext().attrs}function useModel(u,r,i){const m=getCurrentInstance();if(i&&i.local){const _=ref(u[r]);return watch(()=>u[r],A=>_.value=A),watch(_,A=>{A!==u[r]&&m.emit(`update:${r}`,A)}),_}else return{__v_isRef:!0,get value(){return u[r]},set value(_){m.emit(`update:${r}`,_)}}}function getContext(){const u=getCurrentInstance();return u.setupContext||(u.setupContext=createSetupContext(u))}function normalizePropsOrEmits(u){return isArray(u)?u.reduce((r,i)=>(r[i]=null,r),{}):u}function mergeDefaults(u,r){const i=normalizePropsOrEmits(u);for(const m in r){if(m.startsWith("__skip"))continue;let _=i[m];_?isArray(_)||isFunction(_)?_=i[m]={type:_,default:r[m]}:_.default=r[m]:_===null&&(_=i[m]={default:r[m]}),_&&r[`__skip_${m}`]&&(_.skipFactory=!0)}return i}function mergeModels(u,r){return!u||!r?u||r:isArray(u)&&isArray(r)?u.concat(r):extend({},normalizePropsOrEmits(u),normalizePropsOrEmits(r))}function createPropsRestProxy(u,r){const i={};for(const m in u)r.includes(m)||Object.defineProperty(i,m,{enumerable:!0,get:()=>u[m]});return i}function withAsyncContext(u){const r=getCurrentInstance();let i=u();return unsetCurrentInstance(),isPromise(i)&&(i=i.catch(m=>{throw setCurrentInstance(r),m})),[i,()=>setCurrentInstance(r)]}let shouldCacheAccess=!0;function applyOptions(u){const r=resolveMergedOptions(u),i=u.proxy,m=u.ctx;shouldCacheAccess=!1,r.beforeCreate&&callHook$1(r.beforeCreate,u,"bc");const{data:_,computed:A,methods:w,watch:T,provide:R,inject:D,created:U,beforeMount:k,mounted:X,beforeUpdate:J,updated:$,activated:oe,deactivated:ne,beforeDestroy:H,beforeUnmount:V,destroyed:z,unmounted:ce,render:ue,renderTracked:he,renderTriggered:K,errorCaptured:Y,serverPrefetch:ie,expose:ve,inheritAttrs:re,components:ae,directives:me,filters:ye}=r;if(D&&resolveInjections(D,m,null),w)for(const Fe in w){const Ve=w[Fe];isFunction(Ve)&&(m[Fe]=Ve.bind(i))}if(_){const Fe=_.call(i,i);isObject(Fe)&&(u.data=reactive(Fe))}if(shouldCacheAccess=!0,A)for(const Fe in A){const Ve=A[Fe],ot=isFunction(Ve)?Ve.bind(i,i):isFunction(Ve.get)?Ve.get.bind(i,i):NOOP,Ye=!isFunction(Ve)&&isFunction(Ve.set)?Ve.set.bind(i):NOOP,Ze=computed({get:ot,set:Ye});Object.defineProperty(m,Fe,{enumerable:!0,configurable:!0,get:()=>Ze.value,set:tt=>Ze.value=tt})}if(T)for(const Fe in T)createWatcher(T[Fe],m,i,Fe);if(R){const Fe=isFunction(R)?R.call(i):R;Reflect.ownKeys(Fe).forEach(Ve=>{provide(Ve,Fe[Ve])})}U&&callHook$1(U,u,"c");function ke(Fe,Ve){isArray(Ve)?Ve.forEach(ot=>Fe(ot.bind(i))):Ve&&Fe(Ve.bind(i))}if(ke(onBeforeMount,k),ke(onMounted,X),ke(onBeforeUpdate,J),ke(onUpdated,$),ke(onActivated,oe),ke(onDeactivated,ne),ke(onErrorCaptured,Y),ke(onRenderTracked,he),ke(onRenderTriggered,K),ke(onBeforeUnmount,V),ke(onUnmounted,ce),ke(onServerPrefetch,ie),isArray(ve))if(ve.length){const Fe=u.exposed||(u.exposed={});ve.forEach(Ve=>{Object.defineProperty(Fe,Ve,{get:()=>i[Ve],set:ot=>i[Ve]=ot})})}else u.exposed||(u.exposed={});ue&&u.render===NOOP&&(u.render=ue),re!=null&&(u.inheritAttrs=re),ae&&(u.components=ae),me&&(u.directives=me)}function resolveInjections(u,r,i=NOOP){isArray(u)&&(u=normalizeInject(u));for(const m in u){const _=u[m];let A;isObject(_)?"default"in _?A=inject(_.from||m,_.default,!0):A=inject(_.from||m):A=inject(_),isRef(A)?Object.defineProperty(r,m,{enumerable:!0,configurable:!0,get:()=>A.value,set:w=>A.value=w}):r[m]=A}}function callHook$1(u,r,i){callWithAsyncErrorHandling(isArray(u)?u.map(m=>m.bind(r.proxy)):u.bind(r.proxy),r,i)}function createWatcher(u,r,i,m){const _=m.includes(".")?createPathGetter(i,m):()=>i[m];if(isString(u)){const A=r[u];isFunction(A)&&watch(_,A)}else if(isFunction(u))watch(_,u.bind(i));else if(isObject(u))if(isArray(u))u.forEach(A=>createWatcher(A,r,i,m));else{const A=isFunction(u.handler)?u.handler.bind(i):r[u.handler];isFunction(A)&&watch(_,A,u)}}function resolveMergedOptions(u){const r=u.type,{mixins:i,extends:m}=r,{mixins:_,optionsCache:A,config:{optionMergeStrategies:w}}=u.appContext,T=A.get(r);let R;return T?R=T:!_.length&&!i&&!m?R=r:(R={},_.length&&_.forEach(D=>mergeOptions(R,D,w,!0)),mergeOptions(R,r,w)),isObject(r)&&A.set(r,R),R}function mergeOptions(u,r,i,m=!1){const{mixins:_,extends:A}=r;A&&mergeOptions(u,A,i,!0),_&&_.forEach(w=>mergeOptions(u,w,i,!0));for(const w in r)if(!(m&&w==="expose")){const T=internalOptionMergeStrats[w]||i&&i[w];u[w]=T?T(u[w],r[w]):r[w]}return u}const internalOptionMergeStrats={data:mergeDataFn,props:mergeEmitsOrPropsOptions,emits:mergeEmitsOrPropsOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray$1,created:mergeAsArray$1,beforeMount:mergeAsArray$1,mounted:mergeAsArray$1,beforeUpdate:mergeAsArray$1,updated:mergeAsArray$1,beforeDestroy:mergeAsArray$1,beforeUnmount:mergeAsArray$1,destroyed:mergeAsArray$1,unmounted:mergeAsArray$1,activated:mergeAsArray$1,deactivated:mergeAsArray$1,errorCaptured:mergeAsArray$1,serverPrefetch:mergeAsArray$1,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(u,r){return r?u?function(){return extend(isFunction(u)?u.call(this,this):u,isFunction(r)?r.call(this,this):r)}:r:u}function mergeInject(u,r){return mergeObjectOptions(normalizeInject(u),normalizeInject(r))}function normalizeInject(u){if(isArray(u)){const r={};for(let i=0;i<u.length;i++)r[u[i]]=u[i];return r}return u}function mergeAsArray$1(u,r){return u?[...new Set([].concat(u,r))]:r}function mergeObjectOptions(u,r){return u?extend(Object.create(null),u,r):r}function mergeEmitsOrPropsOptions(u,r){return u?isArray(u)&&isArray(r)?[...new Set([...u,...r])]:extend(Object.create(null),normalizePropsOrEmits(u),normalizePropsOrEmits(r??{})):r}function mergeWatchOptions(u,r){if(!u)return r;if(!r)return u;const i=extend(Object.create(null),u);for(const m in r)i[m]=mergeAsArray$1(u[m],r[m]);return i}function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid$1=0;function createAppAPI(u,r){return function(m,_=null){isFunction(m)||(m=extend({},m)),_!=null&&!isObject(_)&&(_=null);const A=createAppContext(),w=new Set;let T=!1;const R=A.app={_uid:uid$1++,_component:m,_props:_,_container:null,_context:A,_instance:null,version,get config(){return A.config},set config(D){},use(D,...U){return w.has(D)||(D&&isFunction(D.install)?(w.add(D),D.install(R,...U)):isFunction(D)&&(w.add(D),D(R,...U))),R},mixin(D){return A.mixins.includes(D)||A.mixins.push(D),R},component(D,U){return U?(A.components[D]=U,R):A.components[D]},directive(D,U){return U?(A.directives[D]=U,R):A.directives[D]},mount(D,U,k){if(!T){const X=createVNode(m,_);return X.appContext=A,U&&r?r(X,D):u(X,D,k),T=!0,R._container=D,D.__vue_app__=R,getExposeProxy(X.component)||X.component.proxy}},unmount(){T&&(u(null,R._container),delete R._container.__vue_app__)},provide(D,U){return A.provides[D]=U,R},runWithContext(D){currentApp=R;try{return D()}finally{currentApp=null}}};return R}}let currentApp=null;function provide(u,r){if(currentInstance){let i=currentInstance.provides;const m=currentInstance.parent&&currentInstance.parent.provides;m===i&&(i=currentInstance.provides=Object.create(m)),i[u]=r}}function inject(u,r,i=!1){const m=currentInstance||currentRenderingInstance;if(m||currentApp){const _=m?m.parent==null?m.vnode.appContext&&m.vnode.appContext.provides:m.parent.provides:currentApp._context.provides;if(_&&u in _)return _[u];if(arguments.length>1)return i&&isFunction(r)?r.call(m&&m.proxy):r}}function hasInjectionContext(){return!!(currentInstance||currentRenderingInstance||currentApp)}function initProps(u,r,i,m=!1){const _={},A={};def(A,InternalObjectKey,1),u.propsDefaults=Object.create(null),setFullProps(u,r,_,A);for(const w in u.propsOptions[0])w in _||(_[w]=void 0);i?u.props=m?_:shallowReactive(_):u.type.props?u.props=_:u.props=A,u.attrs=A}function updateProps(u,r,i,m){const{props:_,attrs:A,vnode:{patchFlag:w}}=u,T=toRaw(_),[R]=u.propsOptions;let D=!1;if((m||w>0)&&!(w&16)){if(w&8){const U=u.vnode.dynamicProps;for(let k=0;k<U.length;k++){let X=U[k];if(isEmitListener(u.emitsOptions,X))continue;const J=r[X];if(R)if(hasOwn(A,X))J!==A[X]&&(A[X]=J,D=!0);else{const $=camelize(X);_[$]=resolvePropValue(R,T,$,J,u,!1)}else J!==A[X]&&(A[X]=J,D=!0)}}}else{setFullProps(u,r,_,A)&&(D=!0);let U;for(const k in T)(!r||!hasOwn(r,k)&&((U=hyphenate(k))===k||!hasOwn(r,U)))&&(R?i&&(i[k]!==void 0||i[U]!==void 0)&&(_[k]=resolvePropValue(R,T,k,void 0,u,!0)):delete _[k]);if(A!==T)for(const k in A)(!r||!hasOwn(r,k))&&(delete A[k],D=!0)}D&&trigger(u,"set","$attrs")}function setFullProps(u,r,i,m){const[_,A]=u.propsOptions;let w=!1,T;if(r)for(let R in r){if(isReservedProp(R))continue;const D=r[R];let U;_&&hasOwn(_,U=camelize(R))?!A||!A.includes(U)?i[U]=D:(T||(T={}))[U]=D:isEmitListener(u.emitsOptions,R)||(!(R in m)||D!==m[R])&&(m[R]=D,w=!0)}if(A){const R=toRaw(i),D=T||EMPTY_OBJ;for(let U=0;U<A.length;U++){const k=A[U];i[k]=resolvePropValue(_,R,k,D[k],u,!hasOwn(D,k))}}return w}function resolvePropValue(u,r,i,m,_,A){const w=u[i];if(w!=null){const T=hasOwn(w,"default");if(T&&m===void 0){const R=w.default;if(w.type!==Function&&!w.skipFactory&&isFunction(R)){const{propsDefaults:D}=_;i in D?m=D[i]:(setCurrentInstance(_),m=D[i]=R.call(null,r),unsetCurrentInstance())}else m=R}w[0]&&(A&&!T?m=!1:w[1]&&(m===""||m===hyphenate(i))&&(m=!0))}return m}function normalizePropsOptions(u,r,i=!1){const m=r.propsCache,_=m.get(u);if(_)return _;const A=u.props,w={},T=[];let R=!1;if(!isFunction(u)){const U=k=>{R=!0;const[X,J]=normalizePropsOptions(k,r,!0);extend(w,X),J&&T.push(...J)};!i&&r.mixins.length&&r.mixins.forEach(U),u.extends&&U(u.extends),u.mixins&&u.mixins.forEach(U)}if(!A&&!R)return isObject(u)&&m.set(u,EMPTY_ARR),EMPTY_ARR;if(isArray(A))for(let U=0;U<A.length;U++){const k=camelize(A[U]);validatePropName(k)&&(w[k]=EMPTY_OBJ)}else if(A)for(const U in A){const k=camelize(U);if(validatePropName(k)){const X=A[U],J=w[k]=isArray(X)||isFunction(X)?{type:X}:extend({},X);if(J){const $=getTypeIndex(Boolean,J.type),oe=getTypeIndex(String,J.type);J[0]=$>-1,J[1]=oe<0||$<oe,($>-1||hasOwn(J,"default"))&&T.push(k)}}}const D=[w,T];return isObject(u)&&m.set(u,D),D}function validatePropName(u){return u[0]!=="$"}function getType(u){const r=u&&u.toString().match(/^\s*(function|class) (\w+)/);return r?r[2]:u===null?"null":""}function isSameType(u,r){return getType(u)===getType(r)}function getTypeIndex(u,r){return isArray(r)?r.findIndex(i=>isSameType(i,u)):isFunction(r)&&isSameType(r,u)?0:-1}const isInternalKey=u=>u[0]==="_"||u==="$stable",normalizeSlotValue=u=>isArray(u)?u.map(normalizeVNode):[normalizeVNode(u)],normalizeSlot=(u,r,i)=>{if(r._n)return r;const m=withCtx((..._)=>normalizeSlotValue(r(..._)),i);return m._c=!1,m},normalizeObjectSlots=(u,r,i)=>{const m=u._ctx;for(const _ in u){if(isInternalKey(_))continue;const A=u[_];if(isFunction(A))r[_]=normalizeSlot(_,A,m);else if(A!=null){const w=normalizeSlotValue(A);r[_]=()=>w}}},normalizeVNodeSlots=(u,r)=>{const i=normalizeSlotValue(r);u.slots.default=()=>i},initSlots=(u,r)=>{if(u.vnode.shapeFlag&32){const i=r._;i?(u.slots=toRaw(r),def(r,"_",i)):normalizeObjectSlots(r,u.slots={})}else u.slots={},r&&normalizeVNodeSlots(u,r);def(u.slots,InternalObjectKey,1)},updateSlots=(u,r,i)=>{const{vnode:m,slots:_}=u;let A=!0,w=EMPTY_OBJ;if(m.shapeFlag&32){const T=r._;T?i&&T===1?A=!1:(extend(_,r),!i&&T===1&&delete _._):(A=!r.$stable,normalizeObjectSlots(r,_)),w=r}else r&&(normalizeVNodeSlots(u,r),w={default:1});if(A)for(const T in _)!isInternalKey(T)&&!(T in w)&&delete _[T]};function setRef(u,r,i,m,_=!1){if(isArray(u)){u.forEach((X,J)=>setRef(X,r&&(isArray(r)?r[J]:r),i,m,_));return}if(isAsyncWrapper(m)&&!_)return;const A=m.shapeFlag&4?getExposeProxy(m.component)||m.component.proxy:m.el,w=_?null:A,{i:T,r:R}=u,D=r&&r.r,U=T.refs===EMPTY_OBJ?T.refs={}:T.refs,k=T.setupState;if(D!=null&&D!==R&&(isString(D)?(U[D]=null,hasOwn(k,D)&&(k[D]=null)):isRef(D)&&(D.value=null)),isFunction(R))callWithErrorHandling(R,T,12,[w,U]);else{const X=isString(R),J=isRef(R);if(X||J){const $=()=>{if(u.f){const oe=X?hasOwn(k,R)?k[R]:U[R]:R.value;_?isArray(oe)&&remove(oe,A):isArray(oe)?oe.includes(A)||oe.push(A):X?(U[R]=[A],hasOwn(k,R)&&(k[R]=U[R])):(R.value=[A],u.k&&(U[u.k]=R.value))}else X?(U[R]=w,hasOwn(k,R)&&(k[R]=w)):J&&(R.value=w,u.k&&(U[u.k]=w))};w?($.id=-1,queuePostRenderEffect($,i)):$()}}}let hasMismatch=!1;const isSVGContainer=u=>/svg/.test(u.namespaceURI)&&u.tagName!=="foreignObject",isComment=u=>u.nodeType===8;function createHydrationFunctions(u){const{mt:r,p:i,o:{patchProp:m,createText:_,nextSibling:A,parentNode:w,remove:T,insert:R,createComment:D}}=u,U=(H,V)=>{if(!V.hasChildNodes()){i(null,H,V),flushPostFlushCbs(),V._vnode=H;return}hasMismatch=!1,k(V.firstChild,H,null,null,null),flushPostFlushCbs(),V._vnode=H,hasMismatch&&console.error("Hydration completed but contains mismatches.")},k=(H,V,z,ce,ue,he=!1)=>{const K=isComment(H)&&H.data==="[",Y=()=>oe(H,V,z,ce,ue,K),{type:ie,ref:ve,shapeFlag:re,patchFlag:ae}=V;let me=H.nodeType;V.el=H,ae===-2&&(he=!1,V.dynamicChildren=null);let ye=null;switch(ie){case Text:me!==3?V.children===""?(R(V.el=_(""),w(H),H),ye=H):ye=Y():(H.data!==V.children&&(hasMismatch=!0,H.data=V.children),ye=A(H));break;case Comment:me!==8||K?ye=Y():ye=A(H);break;case Static:if(K&&(H=A(H),me=H.nodeType),me===1||me===3){ye=H;const Te=!V.children.length;for(let ke=0;ke<V.staticCount;ke++)Te&&(V.children+=ye.nodeType===1?ye.outerHTML:ye.data),ke===V.staticCount-1&&(V.anchor=ye),ye=A(ye);return K?A(ye):ye}else Y();break;case Fragment:K?ye=$(H,V,z,ce,ue,he):ye=Y();break;default:if(re&1)me!==1||V.type.toLowerCase()!==H.tagName.toLowerCase()?ye=Y():ye=X(H,V,z,ce,ue,he);else if(re&6){V.slotScopeIds=ue;const Te=w(H);if(r(V,Te,null,z,ce,isSVGContainer(Te),he),ye=K?ne(H):A(H),ye&&isComment(ye)&&ye.data==="teleport end"&&(ye=A(ye)),isAsyncWrapper(V)){let ke;K?(ke=createVNode(Fragment),ke.anchor=ye?ye.previousSibling:Te.lastChild):ke=H.nodeType===3?createTextVNode(""):createVNode("div"),ke.el=H,V.component.subTree=ke}}else re&64?me!==8?ye=Y():ye=V.type.hydrate(H,V,z,ce,ue,he,u,J):re&128&&(ye=V.type.hydrate(H,V,z,ce,isSVGContainer(w(H)),ue,he,u,k))}return ve!=null&&setRef(ve,null,ce,V),ye},X=(H,V,z,ce,ue,he)=>{he=he||!!V.dynamicChildren;const{type:K,props:Y,patchFlag:ie,shapeFlag:ve,dirs:re}=V,ae=K==="input"&&re||K==="option";if(ae||ie!==-1){if(re&&invokeDirectiveHook(V,null,z,"created"),Y)if(ae||!he||ie&48)for(const ye in Y)(ae&&ye.endsWith("value")||isOn(ye)&&!isReservedProp(ye))&&m(H,ye,null,Y[ye],!1,void 0,z);else Y.onClick&&m(H,"onClick",null,Y.onClick,!1,void 0,z);let me;if((me=Y&&Y.onVnodeBeforeMount)&&invokeVNodeHook(me,z,V),re&&invokeDirectiveHook(V,null,z,"beforeMount"),((me=Y&&Y.onVnodeMounted)||re)&&queueEffectWithSuspense(()=>{me&&invokeVNodeHook(me,z,V),re&&invokeDirectiveHook(V,null,z,"mounted")},ce),ve&16&&!(Y&&(Y.innerHTML||Y.textContent))){let ye=J(H.firstChild,V,H,z,ce,ue,he);for(;ye;){hasMismatch=!0;const Te=ye;ye=ye.nextSibling,T(Te)}}else ve&8&&H.textContent!==V.children&&(hasMismatch=!0,H.textContent=V.children)}return H.nextSibling},J=(H,V,z,ce,ue,he,K)=>{K=K||!!V.dynamicChildren;const Y=V.children,ie=Y.length;for(let ve=0;ve<ie;ve++){const re=K?Y[ve]:Y[ve]=normalizeVNode(Y[ve]);if(H)H=k(H,re,ce,ue,he,K);else{if(re.type===Text&&!re.children)continue;hasMismatch=!0,i(null,re,z,null,ce,ue,isSVGContainer(z),he)}}return H},$=(H,V,z,ce,ue,he)=>{const{slotScopeIds:K}=V;K&&(ue=ue?ue.concat(K):K);const Y=w(H),ie=J(A(H),V,Y,z,ce,ue,he);return ie&&isComment(ie)&&ie.data==="]"?A(V.anchor=ie):(hasMismatch=!0,R(V.anchor=D("]"),Y,ie),ie)},oe=(H,V,z,ce,ue,he)=>{if(hasMismatch=!0,V.el=null,he){const ie=ne(H);for(;;){const ve=A(H);if(ve&&ve!==ie)T(ve);else break}}const K=A(H),Y=w(H);return T(H),i(null,V,Y,K,z,ce,isSVGContainer(Y),ue),K},ne=H=>{let V=0;for(;H;)if(H=A(H),H&&isComment(H)&&(H.data==="["&&V++,H.data==="]")){if(V===0)return A(H);V--}return H};return[U,k]}const queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(u){return baseCreateRenderer(u)}function createHydrationRenderer(u){return baseCreateRenderer(u,createHydrationFunctions)}function baseCreateRenderer(u,r){const i=getGlobalThis();i.__VUE__=!0;const{insert:m,remove:_,patchProp:A,createElement:w,createText:T,createComment:R,setText:D,setElementText:U,parentNode:k,nextSibling:X,setScopeId:J=NOOP,insertStaticContent:$}=u,oe=(Ue,St,Lt,jt=null,Gt=null,fn=null,hn=!1,qt=null,An=!!St.dynamicChildren)=>{if(Ue===St)return;Ue&&!isSameVNodeType(Ue,St)&&(jt=wt(Ue),tt(Ue,Gt,fn,!0),Ue=null),St.patchFlag===-2&&(An=!1,St.dynamicChildren=null);const{type:_n,ref:Bn,shapeFlag:de}=St;switch(_n){case Text:ne(Ue,St,Lt,jt);break;case Comment:H(Ue,St,Lt,jt);break;case Static:Ue==null&&V(St,Lt,jt,hn);break;case Fragment:ae(Ue,St,Lt,jt,Gt,fn,hn,qt,An);break;default:de&1?ue(Ue,St,Lt,jt,Gt,fn,hn,qt,An):de&6?me(Ue,St,Lt,jt,Gt,fn,hn,qt,An):(de&64||de&128)&&_n.process(Ue,St,Lt,jt,Gt,fn,hn,qt,An,nn)}Bn!=null&&Gt&&setRef(Bn,Ue&&Ue.ref,fn,St||Ue,!St)},ne=(Ue,St,Lt,jt)=>{if(Ue==null)m(St.el=T(St.children),Lt,jt);else{const Gt=St.el=Ue.el;St.children!==Ue.children&&D(Gt,St.children)}},H=(Ue,St,Lt,jt)=>{Ue==null?m(St.el=R(St.children||""),Lt,jt):St.el=Ue.el},V=(Ue,St,Lt,jt)=>{[Ue.el,Ue.anchor]=$(Ue.children,St,Lt,jt,Ue.el,Ue.anchor)},z=({el:Ue,anchor:St},Lt,jt)=>{let Gt;for(;Ue&&Ue!==St;)Gt=X(Ue),m(Ue,Lt,jt),Ue=Gt;m(St,Lt,jt)},ce=({el:Ue,anchor:St})=>{let Lt;for(;Ue&&Ue!==St;)Lt=X(Ue),_(Ue),Ue=Lt;_(St)},ue=(Ue,St,Lt,jt,Gt,fn,hn,qt,An)=>{hn=hn||St.type==="svg",Ue==null?he(St,Lt,jt,Gt,fn,hn,qt,An):ie(Ue,St,Gt,fn,hn,qt,An)},he=(Ue,St,Lt,jt,Gt,fn,hn,qt)=>{let An,_n;const{type:Bn,props:de,shapeFlag:Ae,transition:Le,dirs:Oe}=Ue;if(An=Ue.el=w(Ue.type,fn,de&&de.is,de),Ae&8?U(An,Ue.children):Ae&16&&Y(Ue.children,An,null,jt,Gt,fn&&Bn!=="foreignObject",hn,qt),Oe&&invokeDirectiveHook(Ue,null,jt,"created"),K(An,Ue,Ue.scopeId,hn,jt),de){for(const pt in de)pt!=="value"&&!isReservedProp(pt)&&A(An,pt,null,de[pt],fn,Ue.children,jt,Gt,et);"value"in de&&A(An,"value",null,de.value),(_n=de.onVnodeBeforeMount)&&invokeVNodeHook(_n,jt,Ue)}Oe&&invokeDirectiveHook(Ue,null,jt,"beforeMount");const $e=(!Gt||Gt&&!Gt.pendingBranch)&&Le&&!Le.persisted;$e&&Le.beforeEnter(An),m(An,St,Lt),((_n=de&&de.onVnodeMounted)||$e||Oe)&&queuePostRenderEffect(()=>{_n&&invokeVNodeHook(_n,jt,Ue),$e&&Le.enter(An),Oe&&invokeDirectiveHook(Ue,null,jt,"mounted")},Gt)},K=(Ue,St,Lt,jt,Gt)=>{if(Lt&&J(Ue,Lt),jt)for(let fn=0;fn<jt.length;fn++)J(Ue,jt[fn]);if(Gt){let fn=Gt.subTree;if(St===fn){const hn=Gt.vnode;K(Ue,hn,hn.scopeId,hn.slotScopeIds,Gt.parent)}}},Y=(Ue,St,Lt,jt,Gt,fn,hn,qt,An=0)=>{for(let _n=An;_n<Ue.length;_n++){const Bn=Ue[_n]=qt?cloneIfMounted(Ue[_n]):normalizeVNode(Ue[_n]);oe(null,Bn,St,Lt,jt,Gt,fn,hn,qt)}},ie=(Ue,St,Lt,jt,Gt,fn,hn)=>{const qt=St.el=Ue.el;let{patchFlag:An,dynamicChildren:_n,dirs:Bn}=St;An|=Ue.patchFlag&16;const de=Ue.props||EMPTY_OBJ,Ae=St.props||EMPTY_OBJ;let Le;Lt&&toggleRecurse(Lt,!1),(Le=Ae.onVnodeBeforeUpdate)&&invokeVNodeHook(Le,Lt,St,Ue),Bn&&invokeDirectiveHook(St,Ue,Lt,"beforeUpdate"),Lt&&toggleRecurse(Lt,!0);const Oe=Gt&&St.type!=="foreignObject";if(_n?ve(Ue.dynamicChildren,_n,qt,Lt,jt,Oe,fn):hn||Ve(Ue,St,qt,null,Lt,jt,Oe,fn,!1),An>0){if(An&16)re(qt,St,de,Ae,Lt,jt,Gt);else if(An&2&&de.class!==Ae.class&&A(qt,"class",null,Ae.class,Gt),An&4&&A(qt,"style",de.style,Ae.style,Gt),An&8){const $e=St.dynamicProps;for(let pt=0;pt<$e.length;pt++){const Mt=$e[pt],Bt=de[Mt],xt=Ae[Mt];(xt!==Bt||Mt==="value")&&A(qt,Mt,Bt,xt,Gt,Ue.children,Lt,jt,et)}}An&1&&Ue.children!==St.children&&U(qt,St.children)}else!hn&&_n==null&&re(qt,St,de,Ae,Lt,jt,Gt);((Le=Ae.onVnodeUpdated)||Bn)&&queuePostRenderEffect(()=>{Le&&invokeVNodeHook(Le,Lt,St,Ue),Bn&&invokeDirectiveHook(St,Ue,Lt,"updated")},jt)},ve=(Ue,St,Lt,jt,Gt,fn,hn)=>{for(let qt=0;qt<St.length;qt++){const An=Ue[qt],_n=St[qt],Bn=An.el&&(An.type===Fragment||!isSameVNodeType(An,_n)||An.shapeFlag&70)?k(An.el):Lt;oe(An,_n,Bn,null,jt,Gt,fn,hn,!0)}},re=(Ue,St,Lt,jt,Gt,fn,hn)=>{if(Lt!==jt){if(Lt!==EMPTY_OBJ)for(const qt in Lt)!isReservedProp(qt)&&!(qt in jt)&&A(Ue,qt,Lt[qt],null,hn,St.children,Gt,fn,et);for(const qt in jt){if(isReservedProp(qt))continue;const An=jt[qt],_n=Lt[qt];An!==_n&&qt!=="value"&&A(Ue,qt,_n,An,hn,St.children,Gt,fn,et)}"value"in jt&&A(Ue,"value",Lt.value,jt.value)}},ae=(Ue,St,Lt,jt,Gt,fn,hn,qt,An)=>{const _n=St.el=Ue?Ue.el:T(""),Bn=St.anchor=Ue?Ue.anchor:T("");let{patchFlag:de,dynamicChildren:Ae,slotScopeIds:Le}=St;Le&&(qt=qt?qt.concat(Le):Le),Ue==null?(m(_n,Lt,jt),m(Bn,Lt,jt),Y(St.children,Lt,Bn,Gt,fn,hn,qt,An)):de>0&&de&64&&Ae&&Ue.dynamicChildren?(ve(Ue.dynamicChildren,Ae,Lt,Gt,fn,hn,qt),(St.key!=null||Gt&&St===Gt.subTree)&&traverseStaticChildren(Ue,St,!0)):Ve(Ue,St,Lt,Bn,Gt,fn,hn,qt,An)},me=(Ue,St,Lt,jt,Gt,fn,hn,qt,An)=>{St.slotScopeIds=qt,Ue==null?St.shapeFlag&512?Gt.ctx.activate(St,Lt,jt,hn,An):ye(St,Lt,jt,Gt,fn,hn,An):Te(Ue,St,An)},ye=(Ue,St,Lt,jt,Gt,fn,hn)=>{const qt=Ue.component=createComponentInstance(Ue,jt,Gt);if(isKeepAlive(Ue)&&(qt.ctx.renderer=nn),setupComponent(qt),qt.asyncDep){if(Gt&&Gt.registerDep(qt,ke),!Ue.el){const An=qt.subTree=createVNode(Comment);H(null,An,St,Lt)}return}ke(qt,Ue,St,Lt,Gt,fn,hn)},Te=(Ue,St,Lt)=>{const jt=St.component=Ue.component;if(shouldUpdateComponent(Ue,St,Lt))if(jt.asyncDep&&!jt.asyncResolved){Fe(jt,St,Lt);return}else jt.next=St,invalidateJob(jt.update),jt.update();else St.el=Ue.el,jt.vnode=St},ke=(Ue,St,Lt,jt,Gt,fn,hn)=>{const qt=()=>{if(Ue.isMounted){let{next:Bn,bu:de,u:Ae,parent:Le,vnode:Oe}=Ue,$e=Bn,pt;toggleRecurse(Ue,!1),Bn?(Bn.el=Oe.el,Fe(Ue,Bn,hn)):Bn=Oe,de&&invokeArrayFns(de),(pt=Bn.props&&Bn.props.onVnodeBeforeUpdate)&&invokeVNodeHook(pt,Le,Bn,Oe),toggleRecurse(Ue,!0);const Mt=renderComponentRoot(Ue),Bt=Ue.subTree;Ue.subTree=Mt,oe(Bt,Mt,k(Bt.el),wt(Bt),Ue,Gt,fn),Bn.el=Mt.el,$e===null&&updateHOCHostEl(Ue,Mt.el),Ae&&queuePostRenderEffect(Ae,Gt),(pt=Bn.props&&Bn.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(pt,Le,Bn,Oe),Gt)}else{let Bn;const{el:de,props:Ae}=St,{bm:Le,m:Oe,parent:$e}=Ue,pt=isAsyncWrapper(St);if(toggleRecurse(Ue,!1),Le&&invokeArrayFns(Le),!pt&&(Bn=Ae&&Ae.onVnodeBeforeMount)&&invokeVNodeHook(Bn,$e,St),toggleRecurse(Ue,!0),de&&Jn){const Mt=()=>{Ue.subTree=renderComponentRoot(Ue),Jn(de,Ue.subTree,Ue,Gt,null)};pt?St.type.__asyncLoader().then(()=>!Ue.isUnmounted&&Mt()):Mt()}else{const Mt=Ue.subTree=renderComponentRoot(Ue);oe(null,Mt,Lt,jt,Ue,Gt,fn),St.el=Mt.el}if(Oe&&queuePostRenderEffect(Oe,Gt),!pt&&(Bn=Ae&&Ae.onVnodeMounted)){const Mt=St;queuePostRenderEffect(()=>invokeVNodeHook(Bn,$e,Mt),Gt)}(St.shapeFlag&256||$e&&isAsyncWrapper($e.vnode)&&$e.vnode.shapeFlag&256)&&Ue.a&&queuePostRenderEffect(Ue.a,Gt),Ue.isMounted=!0,St=Lt=jt=null}},An=Ue.effect=new ReactiveEffect(qt,()=>queueJob(_n),Ue.scope),_n=Ue.update=()=>An.run();_n.id=Ue.uid,toggleRecurse(Ue,!0),_n()},Fe=(Ue,St,Lt)=>{St.component=Ue;const jt=Ue.vnode.props;Ue.vnode=St,Ue.next=null,updateProps(Ue,St.props,jt,Lt),updateSlots(Ue,St.children,Lt),pauseTracking(),flushPreFlushCbs(),resetTracking()},Ve=(Ue,St,Lt,jt,Gt,fn,hn,qt,An=!1)=>{const _n=Ue&&Ue.children,Bn=Ue?Ue.shapeFlag:0,de=St.children,{patchFlag:Ae,shapeFlag:Le}=St;if(Ae>0){if(Ae&128){Ye(_n,de,Lt,jt,Gt,fn,hn,qt,An);return}else if(Ae&256){ot(_n,de,Lt,jt,Gt,fn,hn,qt,An);return}}Le&8?(Bn&16&&et(_n,Gt,fn),de!==_n&&U(Lt,de)):Bn&16?Le&16?Ye(_n,de,Lt,jt,Gt,fn,hn,qt,An):et(_n,Gt,fn,!0):(Bn&8&&U(Lt,""),Le&16&&Y(de,Lt,jt,Gt,fn,hn,qt,An))},ot=(Ue,St,Lt,jt,Gt,fn,hn,qt,An)=>{Ue=Ue||EMPTY_ARR,St=St||EMPTY_ARR;const _n=Ue.length,Bn=St.length,de=Math.min(_n,Bn);let Ae;for(Ae=0;Ae<de;Ae++){const Le=St[Ae]=An?cloneIfMounted(St[Ae]):normalizeVNode(St[Ae]);oe(Ue[Ae],Le,Lt,null,Gt,fn,hn,qt,An)}_n>Bn?et(Ue,Gt,fn,!0,!1,de):Y(St,Lt,jt,Gt,fn,hn,qt,An,de)},Ye=(Ue,St,Lt,jt,Gt,fn,hn,qt,An)=>{let _n=0;const Bn=St.length;let de=Ue.length-1,Ae=Bn-1;for(;_n<=de&&_n<=Ae;){const Le=Ue[_n],Oe=St[_n]=An?cloneIfMounted(St[_n]):normalizeVNode(St[_n]);if(isSameVNodeType(Le,Oe))oe(Le,Oe,Lt,null,Gt,fn,hn,qt,An);else break;_n++}for(;_n<=de&&_n<=Ae;){const Le=Ue[de],Oe=St[Ae]=An?cloneIfMounted(St[Ae]):normalizeVNode(St[Ae]);if(isSameVNodeType(Le,Oe))oe(Le,Oe,Lt,null,Gt,fn,hn,qt,An);else break;de--,Ae--}if(_n>de){if(_n<=Ae){const Le=Ae+1,Oe=Le<Bn?St[Le].el:jt;for(;_n<=Ae;)oe(null,St[_n]=An?cloneIfMounted(St[_n]):normalizeVNode(St[_n]),Lt,Oe,Gt,fn,hn,qt,An),_n++}}else if(_n>Ae)for(;_n<=de;)tt(Ue[_n],Gt,fn,!0),_n++;else{const Le=_n,Oe=_n,$e=new Map;for(_n=Oe;_n<=Ae;_n++){const en=St[_n]=An?cloneIfMounted(St[_n]):normalizeVNode(St[_n]);en.key!=null&&$e.set(en.key,_n)}let pt,Mt=0;const Bt=Ae-Oe+1;let xt=!1,ht=0;const zt=new Array(Bt);for(_n=0;_n<Bt;_n++)zt[_n]=0;for(_n=Le;_n<=de;_n++){const en=Ue[_n];if(Mt>=Bt){tt(en,Gt,fn,!0);continue}let xn;if(en.key!=null)xn=$e.get(en.key);else for(pt=Oe;pt<=Ae;pt++)if(zt[pt-Oe]===0&&isSameVNodeType(en,St[pt])){xn=pt;break}xn===void 0?tt(en,Gt,fn,!0):(zt[xn-Oe]=_n+1,xn>=ht?ht=xn:xt=!0,oe(en,St[xn],Lt,null,Gt,fn,hn,qt,An),Mt++)}const dn=xt?getSequence(zt):EMPTY_ARR;for(pt=dn.length-1,_n=Bt-1;_n>=0;_n--){const en=Oe+_n,xn=St[en],wi=en+1<Bn?St[en+1].el:jt;zt[_n]===0?oe(null,xn,Lt,wi,Gt,fn,hn,qt,An):xt&&(pt<0||_n!==dn[pt]?Ze(xn,Lt,wi,2):pt--)}}},Ze=(Ue,St,Lt,jt,Gt=null)=>{const{el:fn,type:hn,transition:qt,children:An,shapeFlag:_n}=Ue;if(_n&6){Ze(Ue.component.subTree,St,Lt,jt);return}if(_n&128){Ue.suspense.move(St,Lt,jt);return}if(_n&64){hn.move(Ue,St,Lt,nn);return}if(hn===Fragment){m(fn,St,Lt);for(let de=0;de<An.length;de++)Ze(An[de],St,Lt,jt);m(Ue.anchor,St,Lt);return}if(hn===Static){z(Ue,St,Lt);return}if(jt!==2&&_n&1&&qt)if(jt===0)qt.beforeEnter(fn),m(fn,St,Lt),queuePostRenderEffect(()=>qt.enter(fn),Gt);else{const{leave:de,delayLeave:Ae,afterLeave:Le}=qt,Oe=()=>m(fn,St,Lt),$e=()=>{de(fn,()=>{Oe(),Le&&Le()})};Ae?Ae(fn,Oe,$e):$e()}else m(fn,St,Lt)},tt=(Ue,St,Lt,jt=!1,Gt=!1)=>{const{type:fn,props:hn,ref:qt,children:An,dynamicChildren:_n,shapeFlag:Bn,patchFlag:de,dirs:Ae}=Ue;if(qt!=null&&setRef(qt,null,Lt,Ue,!0),Bn&256){St.ctx.deactivate(Ue);return}const Le=Bn&1&&Ae,Oe=!isAsyncWrapper(Ue);let $e;if(Oe&&($e=hn&&hn.onVnodeBeforeUnmount)&&invokeVNodeHook($e,St,Ue),Bn&6)Ne(Ue.component,Lt,jt);else{if(Bn&128){Ue.suspense.unmount(Lt,jt);return}Le&&invokeDirectiveHook(Ue,null,St,"beforeUnmount"),Bn&64?Ue.type.remove(Ue,St,Lt,Gt,nn,jt):_n&&(fn!==Fragment||de>0&&de&64)?et(_n,St,Lt,!1,!0):(fn===Fragment&&de&384||!Gt&&Bn&16)&&et(An,St,Lt),jt&&Pt(Ue)}(Oe&&($e=hn&&hn.onVnodeUnmounted)||Le)&&queuePostRenderEffect(()=>{$e&&invokeVNodeHook($e,St,Ue),Le&&invokeDirectiveHook(Ue,null,St,"unmounted")},Lt)},Pt=Ue=>{const{type:St,el:Lt,anchor:jt,transition:Gt}=Ue;if(St===Fragment){Et(Lt,jt);return}if(St===Static){ce(Ue);return}const fn=()=>{_(Lt),Gt&&!Gt.persisted&&Gt.afterLeave&&Gt.afterLeave()};if(Ue.shapeFlag&1&&Gt&&!Gt.persisted){const{leave:hn,delayLeave:qt}=Gt,An=()=>hn(Lt,fn);qt?qt(Ue.el,fn,An):An()}else fn()},Et=(Ue,St)=>{let Lt;for(;Ue!==St;)Lt=X(Ue),_(Ue),Ue=Lt;_(St)},Ne=(Ue,St,Lt)=>{const{bum:jt,scope:Gt,update:fn,subTree:hn,um:qt}=Ue;jt&&invokeArrayFns(jt),Gt.stop(),fn&&(fn.active=!1,tt(hn,Ue,St,Lt)),qt&&queuePostRenderEffect(qt,St),queuePostRenderEffect(()=>{Ue.isUnmounted=!0},St),St&&St.pendingBranch&&!St.isUnmounted&&Ue.asyncDep&&!Ue.asyncResolved&&Ue.suspenseId===St.pendingId&&(St.deps--,St.deps===0&&St.resolve())},et=(Ue,St,Lt,jt=!1,Gt=!1,fn=0)=>{for(let hn=fn;hn<Ue.length;hn++)tt(Ue[hn],St,Lt,jt,Gt)},wt=Ue=>Ue.shapeFlag&6?wt(Ue.component.subTree):Ue.shapeFlag&128?Ue.suspense.next():X(Ue.anchor||Ue.el),Zt=(Ue,St,Lt)=>{Ue==null?St._vnode&&tt(St._vnode,null,null,!0):oe(St._vnode||null,Ue,St,null,null,null,Lt),flushPreFlushCbs(),flushPostFlushCbs(),St._vnode=Ue},nn={p:oe,um:tt,m:Ze,r:Pt,mt:ye,mc:Y,pc:Ve,pbc:ve,n:wt,o:u};let Vn,Jn;return r&&([Vn,Jn]=r(nn)),{render:Zt,hydrate:Vn,createApp:createAppAPI(Zt,Vn)}}function toggleRecurse({effect:u,update:r},i){u.allowRecurse=r.allowRecurse=i}function traverseStaticChildren(u,r,i=!1){const m=u.children,_=r.children;if(isArray(m)&&isArray(_))for(let A=0;A<m.length;A++){const w=m[A];let T=_[A];T.shapeFlag&1&&!T.dynamicChildren&&((T.patchFlag<=0||T.patchFlag===32)&&(T=_[A]=cloneIfMounted(_[A]),T.el=w.el),i||traverseStaticChildren(w,T)),T.type===Text&&(T.el=w.el)}}function getSequence(u){const r=u.slice(),i=[0];let m,_,A,w,T;const R=u.length;for(m=0;m<R;m++){const D=u[m];if(D!==0){if(_=i[i.length-1],u[_]<D){r[m]=_,i.push(m);continue}for(A=0,w=i.length-1;A<w;)T=A+w>>1,u[i[T]]<D?A=T+1:w=T;D<u[i[A]]&&(A>0&&(r[m]=i[A-1]),i[A]=m)}}for(A=i.length,w=i[A-1];A-- >0;)i[A]=w,w=r[w];return i}const isTeleport=u=>u.__isTeleport,isTeleportDisabled=u=>u&&(u.disabled||u.disabled===""),isTargetSVG=u=>typeof SVGElement<"u"&&u instanceof SVGElement,resolveTarget=(u,r)=>{const i=u&&u.to;return isString(i)?r?r(i):null:i},TeleportImpl={__isTeleport:!0,process(u,r,i,m,_,A,w,T,R,D){const{mc:U,pc:k,pbc:X,o:{insert:J,querySelector:$,createText:oe,createComment:ne}}=D,H=isTeleportDisabled(r.props);let{shapeFlag:V,children:z,dynamicChildren:ce}=r;if(u==null){const ue=r.el=oe(""),he=r.anchor=oe("");J(ue,i,m),J(he,i,m);const K=r.target=resolveTarget(r.props,$),Y=r.targetAnchor=oe("");K&&(J(Y,K),w=w||isTargetSVG(K));const ie=(ve,re)=>{V&16&&U(z,ve,re,_,A,w,T,R)};H?ie(i,he):K&&ie(K,Y)}else{r.el=u.el;const ue=r.anchor=u.anchor,he=r.target=u.target,K=r.targetAnchor=u.targetAnchor,Y=isTeleportDisabled(u.props),ie=Y?i:he,ve=Y?ue:K;if(w=w||isTargetSVG(he),ce?(X(u.dynamicChildren,ce,ie,_,A,w,T),traverseStaticChildren(u,r,!0)):R||k(u,r,ie,ve,_,A,w,T,!1),H)Y||moveTeleport(r,i,ue,D,1);else if((r.props&&r.props.to)!==(u.props&&u.props.to)){const re=r.target=resolveTarget(r.props,$);re&&moveTeleport(r,re,null,D,0)}else Y&&moveTeleport(r,he,K,D,1)}updateCssVars(r)},remove(u,r,i,m,{um:_,o:{remove:A}},w){const{shapeFlag:T,children:R,anchor:D,targetAnchor:U,target:k,props:X}=u;if(k&&A(U),(w||!isTeleportDisabled(X))&&(A(D),T&16))for(let J=0;J<R.length;J++){const $=R[J];_($,r,i,!0,!!$.dynamicChildren)}},move:moveTeleport,hydrate:hydrateTeleport};function moveTeleport(u,r,i,{o:{insert:m},m:_},A=2){A===0&&m(u.targetAnchor,r,i);const{el:w,anchor:T,shapeFlag:R,children:D,props:U}=u,k=A===2;if(k&&m(w,r,i),(!k||isTeleportDisabled(U))&&R&16)for(let X=0;X<D.length;X++)_(D[X],r,i,2);k&&m(T,r,i)}function hydrateTeleport(u,r,i,m,_,A,{o:{nextSibling:w,parentNode:T,querySelector:R}},D){const U=r.target=resolveTarget(r.props,R);if(U){const k=U._lpa||U.firstChild;if(r.shapeFlag&16)if(isTeleportDisabled(r.props))r.anchor=D(w(u),r,T(u),i,m,_,A),r.targetAnchor=k;else{r.anchor=w(u);let X=k;for(;X;)if(X=w(X),X&&X.nodeType===8&&X.data==="teleport anchor"){r.targetAnchor=X,U._lpa=r.targetAnchor&&w(r.targetAnchor);break}D(k,r,U,i,m,_,A)}updateCssVars(r)}return r.anchor&&w(r.anchor)}const Teleport=TeleportImpl;function updateCssVars(u){const r=u.ctx;if(r&&r.ut){let i=u.children[0].el;for(;i!==u.targetAnchor;)i.nodeType===1&&i.setAttribute("data-v-owner",r.uid),i=i.nextSibling;r.ut()}}const Fragment=Symbol.for("v-fgt"),Text=Symbol.for("v-txt"),Comment=Symbol.for("v-cmt"),Static=Symbol.for("v-stc"),blockStack=[];let currentBlock=null;function openBlock(u=!1){blockStack.push(currentBlock=u?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(u){isBlockTreeEnabled+=u}function setupBlock(u){return u.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(u),u}function createElementBlock(u,r,i,m,_,A){return setupBlock(createBaseVNode(u,r,i,m,_,A,!0))}function createBlock(u,r,i,m,_){return setupBlock(createVNode(u,r,i,m,_,!0))}function isVNode(u){return u?u.__v_isVNode===!0:!1}function isSameVNodeType(u,r){return u.type===r.type&&u.key===r.key}function transformVNodeArgs(u){}const InternalObjectKey="__vInternal",normalizeKey=({key:u})=>u??null,normalizeRef=({ref:u,ref_key:r,ref_for:i})=>(typeof u=="number"&&(u=""+u),u!=null?isString(u)||isRef(u)||isFunction(u)?{i:currentRenderingInstance,r:u,k:r,f:!!i}:u:null);function createBaseVNode(u,r=null,i=null,m=0,_=null,A=u===Fragment?0:1,w=!1,T=!1){const R={__v_isVNode:!0,__v_skip:!0,type:u,props:r,key:r&&normalizeKey(r),ref:r&&normalizeRef(r),scopeId:currentScopeId,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:A,patchFlag:m,dynamicProps:_,dynamicChildren:null,appContext:null,ctx:currentRenderingInstance};return T?(normalizeChildren(R,i),A&128&&u.normalize(R)):i&&(R.shapeFlag|=isString(i)?8:16),isBlockTreeEnabled>0&&!w&&currentBlock&&(R.patchFlag>0||A&6)&&R.patchFlag!==32&&currentBlock.push(R),R}const createVNode=_createVNode;function _createVNode(u,r=null,i=null,m=0,_=null,A=!1){if((!u||u===NULL_DYNAMIC_COMPONENT)&&(u=Comment),isVNode(u)){const T=cloneVNode(u,r,!0);return i&&normalizeChildren(T,i),isBlockTreeEnabled>0&&!A&&currentBlock&&(T.shapeFlag&6?currentBlock[currentBlock.indexOf(u)]=T:currentBlock.push(T)),T.patchFlag|=-2,T}if(isClassComponent(u)&&(u=u.__vccOpts),r){r=guardReactiveProps(r);let{class:T,style:R}=r;T&&!isString(T)&&(r.class=normalizeClass(T)),isObject(R)&&(isProxy(R)&&!isArray(R)&&(R=extend({},R)),r.style=normalizeStyle(R))}const w=isString(u)?1:isSuspense(u)?128:isTeleport(u)?64:isObject(u)?4:isFunction(u)?2:0;return createBaseVNode(u,r,i,m,_,w,A,!0)}function guardReactiveProps(u){return u?isProxy(u)||InternalObjectKey in u?extend({},u):u:null}function cloneVNode(u,r,i=!1){const{props:m,ref:_,patchFlag:A,children:w}=u,T=r?mergeProps(m||{},r):m;return{__v_isVNode:!0,__v_skip:!0,type:u.type,props:T,key:T&&normalizeKey(T),ref:r&&r.ref?i&&_?isArray(_)?_.concat(normalizeRef(r)):[_,normalizeRef(r)]:normalizeRef(r):_,scopeId:u.scopeId,slotScopeIds:u.slotScopeIds,children:w,target:u.target,targetAnchor:u.targetAnchor,staticCount:u.staticCount,shapeFlag:u.shapeFlag,patchFlag:r&&u.type!==Fragment?A===-1?16:A|16:A,dynamicProps:u.dynamicProps,dynamicChildren:u.dynamicChildren,appContext:u.appContext,dirs:u.dirs,transition:u.transition,component:u.component,suspense:u.suspense,ssContent:u.ssContent&&cloneVNode(u.ssContent),ssFallback:u.ssFallback&&cloneVNode(u.ssFallback),el:u.el,anchor:u.anchor,ctx:u.ctx,ce:u.ce}}function createTextVNode(u=" ",r=0){return createVNode(Text,null,u,r)}function createStaticVNode(u,r){const i=createVNode(Static,null,u);return i.staticCount=r,i}function createCommentVNode(u="",r=!1){return r?(openBlock(),createBlock(Comment,null,u)):createVNode(Comment,null,u)}function normalizeVNode(u){return u==null||typeof u=="boolean"?createVNode(Comment):isArray(u)?createVNode(Fragment,null,u.slice()):typeof u=="object"?cloneIfMounted(u):createVNode(Text,null,String(u))}function cloneIfMounted(u){return u.el===null&&u.patchFlag!==-1||u.memo?u:cloneVNode(u)}function normalizeChildren(u,r){let i=0;const{shapeFlag:m}=u;if(r==null)r=null;else if(isArray(r))i=16;else if(typeof r=="object")if(m&65){const _=r.default;_&&(_._c&&(_._d=!1),normalizeChildren(u,_()),_._c&&(_._d=!0));return}else{i=32;const _=r._;!_&&!(InternalObjectKey in r)?r._ctx=currentRenderingInstance:_===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?r._=1:(r._=2,u.patchFlag|=1024))}else isFunction(r)?(r={default:r,_ctx:currentRenderingInstance},i=32):(r=String(r),m&64?(i=16,r=[createTextVNode(r)]):i=8);u.children=r,u.shapeFlag|=i}function mergeProps(...u){const r={};for(let i=0;i<u.length;i++){const m=u[i];for(const _ in m)if(_==="class")r.class!==m.class&&(r.class=normalizeClass([r.class,m.class]));else if(_==="style")r.style=normalizeStyle([r.style,m.style]);else if(isOn(_)){const A=r[_],w=m[_];w&&A!==w&&!(isArray(A)&&A.includes(w))&&(r[_]=A?[].concat(A,w):w)}else _!==""&&(r[_]=m[_])}return r}function invokeVNodeHook(u,r,i,m=null){callWithAsyncErrorHandling(u,r,7,[i,m])}const emptyAppContext=createAppContext();let uid=0;function createComponentInstance(u,r,i){const m=u.type,_=(r?r.appContext:u.appContext)||emptyAppContext,A={uid:uid++,vnode:u,type:m,parent:r,appContext:_,root:null,next:null,subTree:null,effect:null,update:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(_.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(m,_),emitsOptions:normalizeEmitsOptions(m,_),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:m.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return A.ctx={_:A},A.root=r?r.root:A,A.emit=emit.bind(null,A),u.ce&&u.ce(A),A}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance;let internalSetCurrentInstance,globalCurrentInstanceSetters,settersKey="__VUE_INSTANCE_SETTERS__";(globalCurrentInstanceSetters=getGlobalThis()[settersKey])||(globalCurrentInstanceSetters=getGlobalThis()[settersKey]=[]),globalCurrentInstanceSetters.push(u=>currentInstance=u),internalSetCurrentInstance=u=>{globalCurrentInstanceSetters.length>1?globalCurrentInstanceSetters.forEach(r=>r(u)):globalCurrentInstanceSetters[0](u)};const setCurrentInstance=u=>{internalSetCurrentInstance(u),u.scope.on()},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),internalSetCurrentInstance(null)};function isStatefulComponent(u){return u.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(u,r=!1){isInSSRComponentSetup=r;const{props:i,children:m}=u.vnode,_=isStatefulComponent(u);initProps(u,i,_,r),initSlots(u,m);const A=_?setupStatefulComponent(u,r):void 0;return isInSSRComponentSetup=!1,A}function setupStatefulComponent(u,r){const i=u.type;u.accessCache=Object.create(null),u.proxy=markRaw(new Proxy(u.ctx,PublicInstanceProxyHandlers));const{setup:m}=i;if(m){const _=u.setupContext=m.length>1?createSetupContext(u):null;setCurrentInstance(u),pauseTracking();const A=callWithErrorHandling(m,u,0,[u.props,_]);if(resetTracking(),unsetCurrentInstance(),isPromise(A)){if(A.then(unsetCurrentInstance,unsetCurrentInstance),r)return A.then(w=>{handleSetupResult(u,w,r)}).catch(w=>{handleError(w,u,0)});u.asyncDep=A}else handleSetupResult(u,A,r)}else finishComponentSetup(u,r)}function handleSetupResult(u,r,i){isFunction(r)?u.type.__ssrInlineRender?u.ssrRender=r:u.render=r:isObject(r)&&(u.setupState=proxyRefs(r)),finishComponentSetup(u,i)}let compile$1,installWithProxy;function registerRuntimeCompiler(u){compile$1=u,installWithProxy=r=>{r.render._rc&&(r.withProxy=new Proxy(r.ctx,RuntimeCompiledPublicInstanceProxyHandlers))}}const isRuntimeOnly=()=>!compile$1;function finishComponentSetup(u,r,i){const m=u.type;if(!u.render){if(!r&&compile$1&&!m.render){const _=m.template||resolveMergedOptions(u).template;if(_){const{isCustomElement:A,compilerOptions:w}=u.appContext.config,{delimiters:T,compilerOptions:R}=m,D=extend(extend({isCustomElement:A,delimiters:T},w),R);m.render=compile$1(_,D)}}u.render=m.render||NOOP,installWithProxy&&installWithProxy(u)}setCurrentInstance(u),pauseTracking(),applyOptions(u),resetTracking(),unsetCurrentInstance()}function getAttrsProxy(u){return u.attrsProxy||(u.attrsProxy=new Proxy(u.attrs,{get(r,i){return track(u,"get","$attrs"),r[i]}}))}function createSetupContext(u){const r=i=>{u.exposed=i||{}};return{get attrs(){return getAttrsProxy(u)},slots:u.slots,emit:u.emit,expose:r}}function getExposeProxy(u){if(u.exposed)return u.exposeProxy||(u.exposeProxy=new Proxy(proxyRefs(markRaw(u.exposed)),{get(r,i){if(i in r)return r[i];if(i in publicPropertiesMap)return publicPropertiesMap[i](u)},has(r,i){return i in r||i in publicPropertiesMap}}))}function getComponentName(u,r=!0){return isFunction(u)?u.displayName||u.name:u.name||r&&u.__name}function isClassComponent(u){return isFunction(u)&&"__vccOpts"in u}const computed=(u,r)=>computed$1(u,r,isInSSRComponentSetup);function h(u,r,i){const m=arguments.length;return m===2?isObject(r)&&!isArray(r)?isVNode(r)?createVNode(u,null,[r]):createVNode(u,r):createVNode(u,null,r):(m>3?i=Array.prototype.slice.call(arguments,2):m===3&&isVNode(i)&&(i=[i]),createVNode(u,r,i))}const ssrContextKey=Symbol.for("v-scx"),useSSRContext=()=>inject(ssrContextKey);function initCustomFormatter(){}function withMemo(u,r,i,m){const _=i[m];if(_&&isMemoSame(_,u))return _;const A=r();return A.memo=u.slice(),i[m]=A}function isMemoSame(u,r){const i=u.memo;if(i.length!=r.length)return!1;for(let m=0;m<i.length;m++)if(hasChanged(i[m],r[m]))return!1;return isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(u),!0}const version="3.3.4",_ssrUtils={createComponentInstance,setupComponent,renderComponentRoot,setCurrentRenderingInstance,isVNode,normalizeVNode},ssrUtils=_ssrUtils,resolveFilter=null,compatUtils=null,svgNS="http://www.w3.org/2000/svg",doc=typeof document<"u"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(u,r,i)=>{r.insertBefore(u,i||null)},remove:u=>{const r=u.parentNode;r&&r.removeChild(u)},createElement:(u,r,i,m)=>{const _=r?doc.createElementNS(svgNS,u):doc.createElement(u,i?{is:i}:void 0);return u==="select"&&m&&m.multiple!=null&&_.setAttribute("multiple",m.multiple),_},createText:u=>doc.createTextNode(u),createComment:u=>doc.createComment(u),setText:(u,r)=>{u.nodeValue=r},setElementText:(u,r)=>{u.textContent=r},parentNode:u=>u.parentNode,nextSibling:u=>u.nextSibling,querySelector:u=>doc.querySelector(u),setScopeId(u,r){u.setAttribute(r,"")},insertStaticContent(u,r,i,m,_,A){const w=i?i.previousSibling:r.lastChild;if(_&&(_===A||_.nextSibling))for(;r.insertBefore(_.cloneNode(!0),i),!(_===A||!(_=_.nextSibling)););else{templateContainer.innerHTML=m?`<svg>${u}</svg>`:u;const T=templateContainer.content;if(m){const R=T.firstChild;for(;R.firstChild;)T.appendChild(R.firstChild);T.removeChild(R)}r.insertBefore(T,i)}return[w?w.nextSibling:r.firstChild,i?i.previousSibling:r.lastChild]}};function patchClass(u,r,i){const m=u._vtc;m&&(r=(r?[r,...m]:[...m]).join(" ")),r==null?u.removeAttribute("class"):i?u.setAttribute("class",r):u.className=r}function patchStyle(u,r,i){const m=u.style,_=isString(i);if(i&&!_){if(r&&!isString(r))for(const A in r)i[A]==null&&setStyle(m,A,"");for(const A in i)setStyle(m,A,i[A])}else{const A=m.display;_?r!==i&&(m.cssText=i):r&&u.removeAttribute("style"),"_vod"in u&&(m.display=A)}}const importantRE=/\s*!important$/;function setStyle(u,r,i){if(isArray(i))i.forEach(m=>setStyle(u,r,m));else if(i==null&&(i=""),r.startsWith("--"))u.setProperty(r,i);else{const m=autoPrefix(u,r);importantRE.test(i)?u.setProperty(hyphenate(m),i.replace(importantRE,""),"important"):u[m]=i}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(u,r){const i=prefixCache[r];if(i)return i;let m=camelize(r);if(m!=="filter"&&m in u)return prefixCache[r]=m;m=capitalize(m);for(let _=0;_<prefixes.length;_++){const A=prefixes[_]+m;if(A in u)return prefixCache[r]=A}return r}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(u,r,i,m,_){if(m&&r.startsWith("xlink:"))i==null?u.removeAttributeNS(xlinkNS,r.slice(6,r.length)):u.setAttributeNS(xlinkNS,r,i);else{const A=isSpecialBooleanAttr(r);i==null||A&&!includeBooleanAttr(i)?u.removeAttribute(r):u.setAttribute(r,A?"":i)}}function patchDOMProp(u,r,i,m,_,A,w){if(r==="innerHTML"||r==="textContent"){m&&w(m,_,A),u[r]=i??"";return}const T=u.tagName;if(r==="value"&&T!=="PROGRESS"&&!T.includes("-")){u._value=i;const D=T==="OPTION"?u.getAttribute("value"):u.value,U=i??"";D!==U&&(u.value=U),i==null&&u.removeAttribute(r);return}let R=!1;if(i===""||i==null){const D=typeof u[r];D==="boolean"?i=includeBooleanAttr(i):i==null&&D==="string"?(i="",R=!0):D==="number"&&(i=0,R=!0)}try{u[r]=i}catch{}R&&u.removeAttribute(r)}function addEventListener(u,r,i,m){u.addEventListener(r,i,m)}function removeEventListener(u,r,i,m){u.removeEventListener(r,i,m)}function patchEvent(u,r,i,m,_=null){const A=u._vei||(u._vei={}),w=A[r];if(m&&w)w.value=m;else{const[T,R]=parseName(r);if(m){const D=A[r]=createInvoker(m,_);addEventListener(u,T,D,R)}else w&&(removeEventListener(u,T,w,R),A[r]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(u){let r;if(optionsModifierRE.test(u)){r={};let m;for(;m=u.match(optionsModifierRE);)u=u.slice(0,u.length-m[0].length),r[m[0].toLowerCase()]=!0}return[u[2]===":"?u.slice(3):hyphenate(u.slice(2)),r]}let cachedNow=0;const p=Promise.resolve(),getNow=()=>cachedNow||(p.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(u,r){const i=m=>{if(!m._vts)m._vts=Date.now();else if(m._vts<=i.attached)return;callWithAsyncErrorHandling(patchStopImmediatePropagation(m,i.value),r,5,[m])};return i.value=u,i.attached=getNow(),i}function patchStopImmediatePropagation(u,r){if(isArray(r)){const i=u.stopImmediatePropagation;return u.stopImmediatePropagation=()=>{i.call(u),u._stopped=!0},r.map(m=>_=>!_._stopped&&m&&m(_))}else return r}const nativeOnRE=/^on[a-z]/,patchProp=(u,r,i,m,_=!1,A,w,T,R)=>{r==="class"?patchClass(u,m,_):r==="style"?patchStyle(u,i,m):isOn(r)?isModelListener(r)||patchEvent(u,r,i,m,w):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):shouldSetAsProp(u,r,m,_))?patchDOMProp(u,r,m,A,w,T,R):(r==="true-value"?u._trueValue=m:r==="false-value"&&(u._falseValue=m),patchAttr(u,r,m,_))};function shouldSetAsProp(u,r,i,m){return m?!!(r==="innerHTML"||r==="textContent"||r in u&&nativeOnRE.test(r)&&isFunction(i)):r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&u.tagName==="INPUT"||r==="type"&&u.tagName==="TEXTAREA"||nativeOnRE.test(r)&&isString(i)?!1:r in u}function defineCustomElement(u,r){const i=defineComponent(u);class m extends VueElement{constructor(A){super(i,A,r)}}return m.def=i,m}const defineSSRCustomElement=u=>defineCustomElement(u,hydrate),BaseClass=typeof HTMLElement<"u"?HTMLElement:class{};class VueElement extends BaseClass{constructor(r,i={},m){super(),this._def=r,this._props=i,this._instance=null,this._connected=!1,this._resolved=!1,this._numberProps=null,this.shadowRoot&&m?m(this._createVNode(),this.shadowRoot):(this.attachShadow({mode:"open"}),this._def.__asyncLoader||this._resolveProps(this._def))}connectedCallback(){this._connected=!0,this._instance||(this._resolved?this._update():this._resolveDef())}disconnectedCallback(){this._connected=!1,nextTick(()=>{this._connected||(render(null,this.shadowRoot),this._instance=null)})}_resolveDef(){this._resolved=!0;for(let m=0;m<this.attributes.length;m++)this._setAttr(this.attributes[m].name);new MutationObserver(m=>{for(const _ of m)this._setAttr(_.attributeName)}).observe(this,{attributes:!0});const r=(m,_=!1)=>{const{props:A,styles:w}=m;let T;if(A&&!isArray(A))for(const R in A){const D=A[R];(D===Number||D&&D.type===Number)&&(R in this._props&&(this._props[R]=toNumber(this._props[R])),(T||(T=Object.create(null)))[camelize(R)]=!0)}this._numberProps=T,_&&this._resolveProps(m),this._applyStyles(w),this._update()},i=this._def.__asyncLoader;i?i().then(m=>r(m,!0)):r(this._def)}_resolveProps(r){const{props:i}=r,m=isArray(i)?i:Object.keys(i||{});for(const _ of Object.keys(this))_[0]!=="_"&&m.includes(_)&&this._setProp(_,this[_],!0,!1);for(const _ of m.map(camelize))Object.defineProperty(this,_,{get(){return this._getProp(_)},set(A){this._setProp(_,A)}})}_setAttr(r){let i=this.getAttribute(r);const m=camelize(r);this._numberProps&&this._numberProps[m]&&(i=toNumber(i)),this._setProp(m,i,!1)}_getProp(r){return this._props[r]}_setProp(r,i,m=!0,_=!0){i!==this._props[r]&&(this._props[r]=i,_&&this._instance&&this._update(),m&&(i===!0?this.setAttribute(hyphenate(r),""):typeof i=="string"||typeof i=="number"?this.setAttribute(hyphenate(r),i+""):i||this.removeAttribute(hyphenate(r))))}_update(){render(this._createVNode(),this.shadowRoot)}_createVNode(){const r=createVNode(this._def,extend({},this._props));return this._instance||(r.ce=i=>{this._instance=i,i.isCE=!0;const m=(A,w)=>{this.dispatchEvent(new CustomEvent(A,{detail:w}))};i.emit=(A,...w)=>{m(A,w),hyphenate(A)!==A&&m(hyphenate(A),w)};let _=this;for(;_=_&&(_.parentNode||_.host);)if(_ instanceof VueElement){i.parent=_._instance,i.provides=_._instance.provides;break}}),r}_applyStyles(r){r&&r.forEach(i=>{const m=document.createElement("style");m.textContent=i,this.shadowRoot.appendChild(m)})}}function useCssModule(u="$style"){{const r=getCurrentInstance();if(!r)return EMPTY_OBJ;const i=r.type.__cssModules;if(!i)return EMPTY_OBJ;const m=i[u];return m||EMPTY_OBJ}}function useCssVars(u){const r=getCurrentInstance();if(!r)return;const i=r.ut=(_=u(r.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${r.uid}"]`)).forEach(A=>setVarsOnNode(A,_))},m=()=>{const _=u(r.proxy);setVarsOnVNode(r.subTree,_),i(_)};watchPostEffect(m),onMounted(()=>{const _=new MutationObserver(m);_.observe(r.subTree.el.parentNode,{childList:!0}),onUnmounted(()=>_.disconnect())})}function setVarsOnVNode(u,r){if(u.shapeFlag&128){const i=u.suspense;u=i.activeBranch,i.pendingBranch&&!i.isHydrating&&i.effects.push(()=>{setVarsOnVNode(i.activeBranch,r)})}for(;u.component;)u=u.component.subTree;if(u.shapeFlag&1&&u.el)setVarsOnNode(u.el,r);else if(u.type===Fragment)u.children.forEach(i=>setVarsOnVNode(i,r));else if(u.type===Static){let{el:i,anchor:m}=u;for(;i&&(setVarsOnNode(i,r),i!==m);)i=i.nextSibling}}function setVarsOnNode(u,r){if(u.nodeType===1){const i=u.style;for(const m in r)i.setProperty(`--${m}`,r[m])}}const TRANSITION$1="transition",ANIMATION="animation",Transition=(u,{slots:r})=>h(BaseTransition,resolveTransitionProps(u),r);Transition.displayName="Transition";const DOMTransitionPropsValidators={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},TransitionPropsValidators=Transition.props=extend({},BaseTransitionPropsValidators,DOMTransitionPropsValidators),callHook=(u,r=[])=>{isArray(u)?u.forEach(i=>i(...r)):u&&u(...r)},hasExplicitCallback=u=>u?isArray(u)?u.some(r=>r.length>1):u.length>1:!1;function resolveTransitionProps(u){const r={};for(const ae in u)ae in DOMTransitionPropsValidators||(r[ae]=u[ae]);if(u.css===!1)return r;const{name:i="v",type:m,duration:_,enterFromClass:A=`${i}-enter-from`,enterActiveClass:w=`${i}-enter-active`,enterToClass:T=`${i}-enter-to`,appearFromClass:R=A,appearActiveClass:D=w,appearToClass:U=T,leaveFromClass:k=`${i}-leave-from`,leaveActiveClass:X=`${i}-leave-active`,leaveToClass:J=`${i}-leave-to`}=u,$=normalizeDuration(_),oe=$&&$[0],ne=$&&$[1],{onBeforeEnter:H,onEnter:V,onEnterCancelled:z,onLeave:ce,onLeaveCancelled:ue,onBeforeAppear:he=H,onAppear:K=V,onAppearCancelled:Y=z}=r,ie=(ae,me,ye)=>{removeTransitionClass(ae,me?U:T),removeTransitionClass(ae,me?D:w),ye&&ye()},ve=(ae,me)=>{ae._isLeaving=!1,removeTransitionClass(ae,k),removeTransitionClass(ae,J),removeTransitionClass(ae,X),me&&me()},re=ae=>(me,ye)=>{const Te=ae?K:V,ke=()=>ie(me,ae,ye);callHook(Te,[me,ke]),nextFrame(()=>{removeTransitionClass(me,ae?R:A),addTransitionClass(me,ae?U:T),hasExplicitCallback(Te)||whenTransitionEnds(me,m,oe,ke)})};return extend(r,{onBeforeEnter(ae){callHook(H,[ae]),addTransitionClass(ae,A),addTransitionClass(ae,w)},onBeforeAppear(ae){callHook(he,[ae]),addTransitionClass(ae,R),addTransitionClass(ae,D)},onEnter:re(!1),onAppear:re(!0),onLeave(ae,me){ae._isLeaving=!0;const ye=()=>ve(ae,me);addTransitionClass(ae,k),forceReflow(),addTransitionClass(ae,X),nextFrame(()=>{ae._isLeaving&&(removeTransitionClass(ae,k),addTransitionClass(ae,J),hasExplicitCallback(ce)||whenTransitionEnds(ae,m,ne,ye))}),callHook(ce,[ae,ye])},onEnterCancelled(ae){ie(ae,!1),callHook(z,[ae])},onAppearCancelled(ae){ie(ae,!0),callHook(Y,[ae])},onLeaveCancelled(ae){ve(ae),callHook(ue,[ae])}})}function normalizeDuration(u){if(u==null)return null;if(isObject(u))return[NumberOf(u.enter),NumberOf(u.leave)];{const r=NumberOf(u);return[r,r]}}function NumberOf(u){return toNumber(u)}function addTransitionClass(u,r){r.split(/\s+/).forEach(i=>i&&u.classList.add(i)),(u._vtc||(u._vtc=new Set)).add(r)}function removeTransitionClass(u,r){r.split(/\s+/).forEach(m=>m&&u.classList.remove(m));const{_vtc:i}=u;i&&(i.delete(r),i.size||(u._vtc=void 0))}function nextFrame(u){requestAnimationFrame(()=>{requestAnimationFrame(u)})}let endId=0;function whenTransitionEnds(u,r,i,m){const _=u._endId=++endId,A=()=>{_===u._endId&&m()};if(i)return setTimeout(A,i);const{type:w,timeout:T,propCount:R}=getTransitionInfo(u,r);if(!w)return m();const D=w+"end";let U=0;const k=()=>{u.removeEventListener(D,X),A()},X=J=>{J.target===u&&++U>=R&&k()};setTimeout(()=>{U<R&&k()},T+1),u.addEventListener(D,X)}function getTransitionInfo(u,r){const i=window.getComputedStyle(u),m=$=>(i[$]||"").split(", "),_=m(`${TRANSITION$1}Delay`),A=m(`${TRANSITION$1}Duration`),w=getTimeout(_,A),T=m(`${ANIMATION}Delay`),R=m(`${ANIMATION}Duration`),D=getTimeout(T,R);let U=null,k=0,X=0;r===TRANSITION$1?w>0&&(U=TRANSITION$1,k=w,X=A.length):r===ANIMATION?D>0&&(U=ANIMATION,k=D,X=R.length):(k=Math.max(w,D),U=k>0?w>D?TRANSITION$1:ANIMATION:null,X=U?U===TRANSITION$1?A.length:R.length:0);const J=U===TRANSITION$1&&/\b(transform|all)(,|$)/.test(m(`${TRANSITION$1}Property`).toString());return{type:U,timeout:k,propCount:X,hasTransform:J}}function getTimeout(u,r){for(;u.length<r.length;)u=u.concat(u);return Math.max(...r.map((i,m)=>toMs(i)+toMs(u[m])))}function toMs(u){return Number(u.slice(0,-1).replace(",","."))*1e3}function forceReflow(){return document.body.offsetHeight}const positionMap=new WeakMap,newPositionMap=new WeakMap,TransitionGroupImpl={name:"TransitionGroup",props:extend({},TransitionPropsValidators,{tag:String,moveClass:String}),setup(u,{slots:r}){const i=getCurrentInstance(),m=useTransitionState();let _,A;return onUpdated(()=>{if(!_.length)return;const w=u.moveClass||`${u.name||"v"}-move`;if(!hasCSSTransform(_[0].el,i.vnode.el,w))return;_.forEach(callPendingCbs),_.forEach(recordPosition);const T=_.filter(applyTranslation);forceReflow(),T.forEach(R=>{const D=R.el,U=D.style;addTransitionClass(D,w),U.transform=U.webkitTransform=U.transitionDuration="";const k=D._moveCb=X=>{X&&X.target!==D||(!X||/transform$/.test(X.propertyName))&&(D.removeEventListener("transitionend",k),D._moveCb=null,removeTransitionClass(D,w))};D.addEventListener("transitionend",k)})}),()=>{const w=toRaw(u),T=resolveTransitionProps(w);let R=w.tag||Fragment;_=A,A=r.default?getTransitionRawChildren(r.default()):[];for(let D=0;D<A.length;D++){const U=A[D];U.key!=null&&setTransitionHooks(U,resolveTransitionHooks(U,T,m,i))}if(_)for(let D=0;D<_.length;D++){const U=_[D];setTransitionHooks(U,resolveTransitionHooks(U,T,m,i)),positionMap.set(U,U.el.getBoundingClientRect())}return createVNode(R,null,A)}}},removeMode=u=>delete u.mode;TransitionGroupImpl.props;const TransitionGroup=TransitionGroupImpl;function callPendingCbs(u){const r=u.el;r._moveCb&&r._moveCb(),r._enterCb&&r._enterCb()}function recordPosition(u){newPositionMap.set(u,u.el.getBoundingClientRect())}function applyTranslation(u){const r=positionMap.get(u),i=newPositionMap.get(u),m=r.left-i.left,_=r.top-i.top;if(m||_){const A=u.el.style;return A.transform=A.webkitTransform=`translate(${m}px,${_}px)`,A.transitionDuration="0s",u}}function hasCSSTransform(u,r,i){const m=u.cloneNode();u._vtc&&u._vtc.forEach(w=>{w.split(/\s+/).forEach(T=>T&&m.classList.remove(T))}),i.split(/\s+/).forEach(w=>w&&m.classList.add(w)),m.style.display="none";const _=r.nodeType===1?r:r.parentNode;_.appendChild(m);const{hasTransform:A}=getTransitionInfo(m);return _.removeChild(m),A}const getModelAssigner=u=>{const r=u.props["onUpdate:modelValue"]||!1;return isArray(r)?i=>invokeArrayFns(r,i):r};function onCompositionStart(u){u.target.composing=!0}function onCompositionEnd(u){const r=u.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const vModelText={created(u,{modifiers:{lazy:r,trim:i,number:m}},_){u._assign=getModelAssigner(_);const A=m||_.props&&_.props.type==="number";addEventListener(u,r?"change":"input",w=>{if(w.target.composing)return;let T=u.value;i&&(T=T.trim()),A&&(T=looseToNumber(T)),u._assign(T)}),i&&addEventListener(u,"change",()=>{u.value=u.value.trim()}),r||(addEventListener(u,"compositionstart",onCompositionStart),addEventListener(u,"compositionend",onCompositionEnd),addEventListener(u,"change",onCompositionEnd))},mounted(u,{value:r}){u.value=r??""},beforeUpdate(u,{value:r,modifiers:{lazy:i,trim:m,number:_}},A){if(u._assign=getModelAssigner(A),u.composing||document.activeElement===u&&u.type!=="range"&&(i||m&&u.value.trim()===r||(_||u.type==="number")&&looseToNumber(u.value)===r))return;const w=r??"";u.value!==w&&(u.value=w)}},vModelCheckbox={deep:!0,created(u,r,i){u._assign=getModelAssigner(i),addEventListener(u,"change",()=>{const m=u._modelValue,_=getValue(u),A=u.checked,w=u._assign;if(isArray(m)){const T=looseIndexOf(m,_),R=T!==-1;if(A&&!R)w(m.concat(_));else if(!A&&R){const D=[...m];D.splice(T,1),w(D)}}else if(isSet(m)){const T=new Set(m);A?T.add(_):T.delete(_),w(T)}else w(getCheckboxValue(u,A))})},mounted:setChecked,beforeUpdate(u,r,i){u._assign=getModelAssigner(i),setChecked(u,r,i)}};function setChecked(u,{value:r,oldValue:i},m){u._modelValue=r,isArray(r)?u.checked=looseIndexOf(r,m.props.value)>-1:isSet(r)?u.checked=r.has(m.props.value):r!==i&&(u.checked=looseEqual(r,getCheckboxValue(u,!0)))}const vModelRadio={created(u,{value:r},i){u.checked=looseEqual(r,i.props.value),u._assign=getModelAssigner(i),addEventListener(u,"change",()=>{u._assign(getValue(u))})},beforeUpdate(u,{value:r,oldValue:i},m){u._assign=getModelAssigner(m),r!==i&&(u.checked=looseEqual(r,m.props.value))}},vModelSelect={deep:!0,created(u,{value:r,modifiers:{number:i}},m){const _=isSet(r);addEventListener(u,"change",()=>{const A=Array.prototype.filter.call(u.options,w=>w.selected).map(w=>i?looseToNumber(getValue(w)):getValue(w));u._assign(u.multiple?_?new Set(A):A:A[0])}),u._assign=getModelAssigner(m)},mounted(u,{value:r}){setSelected(u,r)},beforeUpdate(u,r,i){u._assign=getModelAssigner(i)},updated(u,{value:r}){setSelected(u,r)}};function setSelected(u,r){const i=u.multiple;if(!(i&&!isArray(r)&&!isSet(r))){for(let m=0,_=u.options.length;m<_;m++){const A=u.options[m],w=getValue(A);if(i)isArray(r)?A.selected=looseIndexOf(r,w)>-1:A.selected=r.has(w);else if(looseEqual(getValue(A),r)){u.selectedIndex!==m&&(u.selectedIndex=m);return}}!i&&u.selectedIndex!==-1&&(u.selectedIndex=-1)}}function getValue(u){return"_value"in u?u._value:u.value}function getCheckboxValue(u,r){const i=r?"_trueValue":"_falseValue";return i in u?u[i]:r}const vModelDynamic={created(u,r,i){callModelHook(u,r,i,null,"created")},mounted(u,r,i){callModelHook(u,r,i,null,"mounted")},beforeUpdate(u,r,i,m){callModelHook(u,r,i,m,"beforeUpdate")},updated(u,r,i,m){callModelHook(u,r,i,m,"updated")}};function resolveDynamicModel(u,r){switch(u){case"SELECT":return vModelSelect;case"TEXTAREA":return vModelText;default:switch(r){case"checkbox":return vModelCheckbox;case"radio":return vModelRadio;default:return vModelText}}}function callModelHook(u,r,i,m,_){const w=resolveDynamicModel(u.tagName,i.props&&i.props.type)[_];w&&w(u,r,i,m)}function initVModelForSSR(){vModelText.getSSRProps=({value:u})=>({value:u}),vModelRadio.getSSRProps=({value:u},r)=>{if(r.props&&looseEqual(r.props.value,u))return{checked:!0}},vModelCheckbox.getSSRProps=({value:u},r)=>{if(isArray(u)){if(r.props&&looseIndexOf(u,r.props.value)>-1)return{checked:!0}}else if(isSet(u)){if(r.props&&u.has(r.props.value))return{checked:!0}}else if(u)return{checked:!0}},vModelDynamic.getSSRProps=(u,r)=>{if(typeof r.type!="string")return;const i=resolveDynamicModel(r.type.toUpperCase(),r.props&&r.props.type);if(i.getSSRProps)return i.getSSRProps(u,r)}}const systemModifiers=["ctrl","shift","alt","meta"],modifierGuards={stop:u=>u.stopPropagation(),prevent:u=>u.preventDefault(),self:u=>u.target!==u.currentTarget,ctrl:u=>!u.ctrlKey,shift:u=>!u.shiftKey,alt:u=>!u.altKey,meta:u=>!u.metaKey,left:u=>"button"in u&&u.button!==0,middle:u=>"button"in u&&u.button!==1,right:u=>"button"in u&&u.button!==2,exact:(u,r)=>systemModifiers.some(i=>u[`${i}Key`]&&!r.includes(i))},withModifiers=(u,r)=>(i,...m)=>{for(let _=0;_<r.length;_++){const A=modifierGuards[r[_]];if(A&&A(i,r))return}return u(i,...m)},keyNames={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},withKeys=(u,r)=>i=>{if(!("key"in i))return;const m=hyphenate(i.key);if(r.some(_=>_===m||keyNames[_]===m))return u(i)},vShow={beforeMount(u,{value:r},{transition:i}){u._vod=u.style.display==="none"?"":u.style.display,i&&r?i.beforeEnter(u):setDisplay(u,r)},mounted(u,{value:r},{transition:i}){i&&r&&i.enter(u)},updated(u,{value:r,oldValue:i},{transition:m}){!r!=!i&&(m?r?(m.beforeEnter(u),setDisplay(u,!0),m.enter(u)):m.leave(u,()=>{setDisplay(u,!1)}):setDisplay(u,r))},beforeUnmount(u,{value:r}){setDisplay(u,r)}};function setDisplay(u,r){u.style.display=r?u._vod:"none"}function initVShowForSSR(){vShow.getSSRProps=({value:u})=>{if(!u)return{style:{display:"none"}}}}const rendererOptions=extend({patchProp},nodeOps);let renderer,enabledHydration=!1;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}function ensureHydrationRenderer(){return renderer=enabledHydration?renderer:createHydrationRenderer(rendererOptions),enabledHydration=!0,renderer}const render=(...u)=>{ensureRenderer().render(...u)},hydrate=(...u)=>{ensureHydrationRenderer().hydrate(...u)},createApp=(...u)=>{const r=ensureRenderer().createApp(...u),{mount:i}=r;return r.mount=m=>{const _=normalizeContainer(m);if(!_)return;const A=r._component;!isFunction(A)&&!A.render&&!A.template&&(A.template=_.innerHTML),_.innerHTML="";const w=i(_,!1,_ instanceof SVGElement);return _ instanceof Element&&(_.removeAttribute("v-cloak"),_.setAttribute("data-v-app","")),w},r},createSSRApp=(...u)=>{const r=ensureHydrationRenderer().createApp(...u),{mount:i}=r;return r.mount=m=>{const _=normalizeContainer(m);if(_)return i(_,!0,_ instanceof SVGElement)},r};function normalizeContainer(u){return isString(u)?document.querySelector(u):u}let ssrDirectiveInitialized=!1;const initDirectivesForSSR=()=>{ssrDirectiveInitialized||(ssrDirectiveInitialized=!0,initVModelForSSR(),initVShowForSSR())},runtimeDom=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition,BaseTransitionPropsValidators,Comment,EffectScope,Fragment,KeepAlive,ReactiveEffect,Static,Suspense,Teleport,Text,Transition,TransitionGroup,VueElement,assertNumber,callWithAsyncErrorHandling,callWithErrorHandling,camelize,capitalize,cloneVNode,compatUtils,computed,createApp,createBlock,createCommentVNode,createElementBlock,createElementVNode:createBaseVNode,createHydrationRenderer,createPropsRestProxy,createRenderer,createSSRApp,createSlots,createStaticVNode,createTextVNode,createVNode,customRef,defineAsyncComponent,defineComponent,defineCustomElement,defineEmits,defineExpose,defineModel,defineOptions,defineProps,defineSSRCustomElement,defineSlots,get devtools(){return devtools},effect,effectScope,getCurrentInstance,getCurrentScope,getTransitionRawChildren,guardReactiveProps,h,handleError,hasInjectionContext,hydrate,initCustomFormatter,initDirectivesForSSR,inject,isMemoSame,isProxy,isReactive,isReadonly,isRef,isRuntimeOnly,isShallow,isVNode,markRaw,mergeDefaults,mergeModels,mergeProps,nextTick,normalizeClass,normalizeProps,normalizeStyle,onActivated,onBeforeMount,onBeforeUnmount,onBeforeUpdate,onDeactivated,onErrorCaptured,onMounted,onRenderTracked,onRenderTriggered,onScopeDispose,onServerPrefetch,onUnmounted,onUpdated,openBlock,popScopeId,provide,proxyRefs,pushScopeId,queuePostFlushCb,reactive,readonly,ref,registerRuntimeCompiler,render,renderList,renderSlot,resolveComponent,resolveDirective,resolveDynamicComponent,resolveFilter,resolveTransitionHooks,setBlockTracking,setDevtoolsHook,setTransitionHooks,shallowReactive,shallowReadonly,shallowRef,ssrContextKey,ssrUtils,stop,toDisplayString,toHandlerKey,toHandlers,toRaw,toRef,toRefs,toValue,transformVNodeArgs,triggerRef,unref,useAttrs,useCssModule,useCssVars,useModel,useSSRContext,useSlots,useTransitionState,vModelCheckbox,vModelDynamic,vModelRadio,vModelSelect,vModelText,vShow,version,warn,watch,watchEffect,watchPostEffect,watchSyncEffect,withAsyncContext,withCtx,withDefaults,withDirectives,withKeys,withMemo,withModifiers,withScopeId},Symbol.toStringTag,{value:"Module"}));function defaultOnError(u){throw u}function defaultOnWarn(u){}function createCompilerError(u,r,i,m){const _=u,A=new SyntaxError(String(_));return A.code=u,A.loc=r,A}const FRAGMENT=Symbol(""),TELEPORT=Symbol(""),SUSPENSE=Symbol(""),KEEP_ALIVE=Symbol(""),BASE_TRANSITION=Symbol(""),OPEN_BLOCK=Symbol(""),CREATE_BLOCK=Symbol(""),CREATE_ELEMENT_BLOCK=Symbol(""),CREATE_VNODE=Symbol(""),CREATE_ELEMENT_VNODE=Symbol(""),CREATE_COMMENT=Symbol(""),CREATE_TEXT=Symbol(""),CREATE_STATIC=Symbol(""),RESOLVE_COMPONENT=Symbol(""),RESOLVE_DYNAMIC_COMPONENT=Symbol(""),RESOLVE_DIRECTIVE=Symbol(""),RESOLVE_FILTER=Symbol(""),WITH_DIRECTIVES=Symbol(""),RENDER_LIST=Symbol(""),RENDER_SLOT=Symbol(""),CREATE_SLOTS=Symbol(""),TO_DISPLAY_STRING=Symbol(""),MERGE_PROPS=Symbol(""),NORMALIZE_CLASS=Symbol(""),NORMALIZE_STYLE=Symbol(""),NORMALIZE_PROPS=Symbol(""),GUARD_REACTIVE_PROPS=Symbol(""),TO_HANDLERS=Symbol(""),CAMELIZE=Symbol(""),CAPITALIZE=Symbol(""),TO_HANDLER_KEY=Symbol(""),SET_BLOCK_TRACKING=Symbol(""),PUSH_SCOPE_ID=Symbol(""),POP_SCOPE_ID=Symbol(""),WITH_CTX=Symbol(""),UNREF=Symbol(""),IS_REF=Symbol(""),WITH_MEMO=Symbol(""),IS_MEMO_SAME=Symbol(""),helperNameMap={[FRAGMENT]:"Fragment",[TELEPORT]:"Teleport",[SUSPENSE]:"Suspense",[KEEP_ALIVE]:"KeepAlive",[BASE_TRANSITION]:"BaseTransition",[OPEN_BLOCK]:"openBlock",[CREATE_BLOCK]:"createBlock",[CREATE_ELEMENT_BLOCK]:"createElementBlock",[CREATE_VNODE]:"createVNode",[CREATE_ELEMENT_VNODE]:"createElementVNode",[CREATE_COMMENT]:"createCommentVNode",[CREATE_TEXT]:"createTextVNode",[CREATE_STATIC]:"createStaticVNode",[RESOLVE_COMPONENT]:"resolveComponent",[RESOLVE_DYNAMIC_COMPONENT]:"resolveDynamicComponent",[RESOLVE_DIRECTIVE]:"resolveDirective",[RESOLVE_FILTER]:"resolveFilter",[WITH_DIRECTIVES]:"withDirectives",[RENDER_LIST]:"renderList",[RENDER_SLOT]:"renderSlot",[CREATE_SLOTS]:"createSlots",[TO_DISPLAY_STRING]:"toDisplayString",[MERGE_PROPS]:"mergeProps",[NORMALIZE_CLASS]:"normalizeClass",[NORMALIZE_STYLE]:"normalizeStyle",[NORMALIZE_PROPS]:"normalizeProps",[GUARD_REACTIVE_PROPS]:"guardReactiveProps",[TO_HANDLERS]:"toHandlers",[CAMELIZE]:"camelize",[CAPITALIZE]:"capitalize",[TO_HANDLER_KEY]:"toHandlerKey",[SET_BLOCK_TRACKING]:"setBlockTracking",[PUSH_SCOPE_ID]:"pushScopeId",[POP_SCOPE_ID]:"popScopeId",[WITH_CTX]:"withCtx",[UNREF]:"unref",[IS_REF]:"isRef",[WITH_MEMO]:"withMemo",[IS_MEMO_SAME]:"isMemoSame"};function registerRuntimeHelpers(u){Object.getOwnPropertySymbols(u).forEach(r=>{helperNameMap[r]=u[r]})}const locStub={source:"",start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0}};function createRoot(u,r=locStub){return{type:0,children:u,helpers:new Set,components:[],directives:[],hoists:[],imports:[],cached:0,temps:0,codegenNode:void 0,loc:r}}function createVNodeCall(u,r,i,m,_,A,w,T=!1,R=!1,D=!1,U=locStub){return u&&(T?(u.helper(OPEN_BLOCK),u.helper(getVNodeBlockHelper(u.inSSR,D))):u.helper(getVNodeHelper(u.inSSR,D)),w&&u.helper(WITH_DIRECTIVES)),{type:13,tag:r,props:i,children:m,patchFlag:_,dynamicProps:A,directives:w,isBlock:T,disableTracking:R,isComponent:D,loc:U}}function createArrayExpression(u,r=locStub){return{type:17,loc:r,elements:u}}function createObjectExpression(u,r=locStub){return{type:15,loc:r,properties:u}}function createObjectProperty(u,r){return{type:16,loc:locStub,key:isString(u)?createSimpleExpression(u,!0):u,value:r}}function createSimpleExpression(u,r=!1,i=locStub,m=0){return{type:4,loc:i,content:u,isStatic:r,constType:r?3:m}}function createCompoundExpression(u,r=locStub){return{type:8,loc:r,children:u}}function createCallExpression(u,r=[],i=locStub){return{type:14,loc:i,callee:u,arguments:r}}function createFunctionExpression(u,r=void 0,i=!1,m=!1,_=locStub){return{type:18,params:u,returns:r,newline:i,isSlot:m,loc:_}}function createConditionalExpression(u,r,i,m=!0){return{type:19,test:u,consequent:r,alternate:i,newline:m,loc:locStub}}function createCacheExpression(u,r,i=!1){return{type:20,index:u,value:r,isVNode:i,loc:locStub}}function createBlockStatement(u){return{type:21,body:u,loc:locStub}}function getVNodeHelper(u,r){return u||r?CREATE_VNODE:CREATE_ELEMENT_VNODE}function getVNodeBlockHelper(u,r){return u||r?CREATE_BLOCK:CREATE_ELEMENT_BLOCK}function convertToBlock(u,{helper:r,removeHelper:i,inSSR:m}){u.isBlock||(u.isBlock=!0,i(getVNodeHelper(m,u.isComponent)),r(OPEN_BLOCK),r(getVNodeBlockHelper(m,u.isComponent)))}const isStaticExp=u=>u.type===4&&u.isStatic,isBuiltInType=(u,r)=>u===r||u===hyphenate(r);function isCoreComponent(u){if(isBuiltInType(u,"Teleport"))return TELEPORT;if(isBuiltInType(u,"Suspense"))return SUSPENSE;if(isBuiltInType(u,"KeepAlive"))return KEEP_ALIVE;if(isBuiltInType(u,"BaseTransition"))return BASE_TRANSITION}const nonIdentifierRE=/^\d|[^\$\w]/,isSimpleIdentifier=u=>!nonIdentifierRE.test(u),validFirstIdentCharRE=/[A-Za-z_$\xA0-\uFFFF]/,validIdentCharRE=/[\.\?\w$\xA0-\uFFFF]/,whitespaceRE=/\s+[.[]\s*|\s*[.[]\s+/g,isMemberExpressionBrowser=u=>{u=u.trim().replace(whitespaceRE,w=>w.trim());let r=0,i=[],m=0,_=0,A=null;for(let w=0;w<u.length;w++){const T=u.charAt(w);switch(r){case 0:if(T==="[")i.push(r),r=1,m++;else if(T==="(")i.push(r),r=2,_++;else if(!(w===0?validFirstIdentCharRE:validIdentCharRE).test(T))return!1;break;case 1:T==="'"||T==='"'||T==="`"?(i.push(r),r=3,A=T):T==="["?m++:T==="]"&&(--m||(r=i.pop()));break;case 2:if(T==="'"||T==='"'||T==="`")i.push(r),r=3,A=T;else if(T==="(")_++;else if(T===")"){if(w===u.length-1)return!1;--_||(r=i.pop())}break;case 3:T===A&&(r=i.pop(),A=null);break}}return!m&&!_},isMemberExpression=isMemberExpressionBrowser;function getInnerRange(u,r,i){const _={source:u.source.slice(r,r+i),start:advancePositionWithClone(u.start,u.source,r),end:u.end};return i!=null&&(_.end=advancePositionWithClone(u.start,u.source,r+i)),_}function advancePositionWithClone(u,r,i=r.length){return advancePositionWithMutation(extend({},u),r,i)}function advancePositionWithMutation(u,r,i=r.length){let m=0,_=-1;for(let A=0;A<i;A++)r.charCodeAt(A)===10&&(m++,_=A);return u.offset+=i,u.line+=m,u.column=_===-1?u.column+i:i-_,u}function findDir(u,r,i=!1){for(let m=0;m<u.props.length;m++){const _=u.props[m];if(_.type===7&&(i||_.exp)&&(isString(r)?_.name===r:r.test(_.name)))return _}}function findProp(u,r,i=!1,m=!1){for(let _=0;_<u.props.length;_++){const A=u.props[_];if(A.type===6){if(i)continue;if(A.name===r&&(A.value||m))return A}else if(A.name==="bind"&&(A.exp||m)&&isStaticArgOf(A.arg,r))return A}}function isStaticArgOf(u,r){return!!(u&&isStaticExp(u)&&u.content===r)}function hasDynamicKeyVBind(u){return u.props.some(r=>r.type===7&&r.name==="bind"&&(!r.arg||r.arg.type!==4||!r.arg.isStatic))}function isText$1(u){return u.type===5||u.type===2}function isVSlot(u){return u.type===7&&u.name==="slot"}function isTemplateNode(u){return u.type===1&&u.tagType===3}function isSlotOutlet(u){return u.type===1&&u.tagType===2}const propsHelperSet=new Set([NORMALIZE_PROPS,GUARD_REACTIVE_PROPS]);function getUnnormalizedProps(u,r=[]){if(u&&!isString(u)&&u.type===14){const i=u.callee;if(!isString(i)&&propsHelperSet.has(i))return getUnnormalizedProps(u.arguments[0],r.concat(u))}return[u,r]}function injectProp(u,r,i){let m,_=u.type===13?u.props:u.arguments[2],A=[],w;if(_&&!isString(_)&&_.type===14){const T=getUnnormalizedProps(_);_=T[0],A=T[1],w=A[A.length-1]}if(_==null||isString(_))m=createObjectExpression([r]);else if(_.type===14){const T=_.arguments[0];!isString(T)&&T.type===15?hasProp(r,T)||T.properties.unshift(r):_.callee===TO_HANDLERS?m=createCallExpression(i.helper(MERGE_PROPS),[createObjectExpression([r]),_]):_.arguments.unshift(createObjectExpression([r])),!m&&(m=_)}else _.type===15?(hasProp(r,_)||_.properties.unshift(r),m=_):(m=createCallExpression(i.helper(MERGE_PROPS),[createObjectExpression([r]),_]),w&&w.callee===GUARD_REACTIVE_PROPS&&(w=A[A.length-2]));u.type===13?w?w.arguments[0]=m:u.props=m:w?w.arguments[0]=m:u.arguments[2]=m}function hasProp(u,r){let i=!1;if(u.key.type===4){const m=u.key.content;i=r.properties.some(_=>_.key.type===4&&_.key.content===m)}return i}function toValidAssetId(u,r){return`_${r}_${u.replace(/[^\w]/g,(i,m)=>i==="-"?"_":u.charCodeAt(m).toString())}`}function getMemoedVNodeCall(u){return u.type===14&&u.callee===WITH_MEMO?u.arguments[1].returns:u}function getCompatValue(u,r){const i=r.options?r.options.compatConfig:r.compatConfig,m=i&&i[u];return u==="MODE"?m||3:m}function isCompatEnabled(u,r){const i=getCompatValue("MODE",r),m=getCompatValue(u,r);return i===3?m===!0:m!==!1}function checkCompatEnabled(u,r,i,...m){return isCompatEnabled(u,r)}const decodeRE=/&(gt|lt|amp|apos|quot);/g,decodeMap={gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},defaultParserOptions={delimiters:["{{","}}"],getNamespace:()=>0,getTextMode:()=>0,isVoidTag:NO,isPreTag:NO,isCustomElement:NO,decodeEntities:u=>u.replace(decodeRE,(r,i)=>decodeMap[i]),onError:defaultOnError,onWarn:defaultOnWarn,comments:!1};function baseParse(u,r={}){const i=createParserContext(u,r),m=getCursor(i);return createRoot(parseChildren(i,0,[]),getSelection(i,m))}function createParserContext(u,r){const i=extend({},defaultParserOptions);let m;for(m in r)i[m]=r[m]===void 0?defaultParserOptions[m]:r[m];return{options:i,column:1,line:1,offset:0,originalSource:u,source:u,inPre:!1,inVPre:!1,onWarn:i.onWarn}}function parseChildren(u,r,i){const m=last(i),_=m?m.ns:0,A=[];for(;!isEnd(u,r,i);){const T=u.source;let R;if(r===0||r===1){if(!u.inVPre&&startsWith(T,u.options.delimiters[0]))R=parseInterpolation(u,r);else if(r===0&&T[0]==="<")if(T.length===1)emitError(u,5,1);else if(T[1]==="!")startsWith(T,"<!--")?R=parseComment(u):startsWith(T,"<!DOCTYPE")?R=parseBogusComment(u):startsWith(T,"<![CDATA[")?_!==0?R=parseCDATA(u,i):(emitError(u,1),R=parseBogusComment(u)):(emitError(u,11),R=parseBogusComment(u));else if(T[1]==="/")if(T.length===2)emitError(u,5,2);else if(T[2]===">"){emitError(u,14,2),advanceBy(u,3);continue}else if(/[a-z]/i.test(T[2])){emitError(u,23),parseTag(u,TagType.End,m);continue}else emitError(u,12,2),R=parseBogusComment(u);else/[a-z]/i.test(T[1])?(R=parseElement(u,i),isCompatEnabled("COMPILER_NATIVE_TEMPLATE",u)&&R&&R.tag==="template"&&!R.props.some(D=>D.type===7&&isSpecialTemplateDirective(D.name))&&(R=R.children)):T[1]==="?"?(emitError(u,21,1),R=parseBogusComment(u)):emitError(u,12,1)}if(R||(R=parseText(u,r)),isArray(R))for(let D=0;D<R.length;D++)pushNode(A,R[D]);else pushNode(A,R)}let w=!1;if(r!==2&&r!==1){const T=u.options.whitespace!=="preserve";for(let R=0;R<A.length;R++){const D=A[R];if(D.type===2)if(u.inPre)D.content=D.content.replace(/\r\n/g,`
`);else if(/[^\t\r\n\f ]/.test(D.content))T&&(D.content=D.content.replace(/[\t\r\n\f ]+/g," "));else{const U=A[R-1],k=A[R+1];!U||!k||T&&(U.type===3&&k.type===3||U.type===3&&k.type===1||U.type===1&&k.type===3||U.type===1&&k.type===1&&/[\r\n]/.test(D.content))?(w=!0,A[R]=null):D.content=" "}else D.type===3&&!u.options.comments&&(w=!0,A[R]=null)}if(u.inPre&&m&&u.options.isPreTag(m.tag)){const R=A[0];R&&R.type===2&&(R.content=R.content.replace(/^\r?\n/,""))}}return w?A.filter(Boolean):A}function pushNode(u,r){if(r.type===2){const i=last(u);if(i&&i.type===2&&i.loc.end.offset===r.loc.start.offset){i.content+=r.content,i.loc.end=r.loc.end,i.loc.source+=r.loc.source;return}}u.push(r)}function parseCDATA(u,r){advanceBy(u,9);const i=parseChildren(u,3,r);return u.source.length===0?emitError(u,6):advanceBy(u,3),i}function parseComment(u){const r=getCursor(u);let i;const m=/--(\!)?>/.exec(u.source);if(!m)i=u.source.slice(4),advanceBy(u,u.source.length),emitError(u,7);else{m.index<=3&&emitError(u,0),m[1]&&emitError(u,10),i=u.source.slice(4,m.index);const _=u.source.slice(0,m.index);let A=1,w=0;for(;(w=_.indexOf("<!--",A))!==-1;)advanceBy(u,w-A+1),w+4<_.length&&emitError(u,16),A=w+1;advanceBy(u,m.index+m[0].length-A+1)}return{type:3,content:i,loc:getSelection(u,r)}}function parseBogusComment(u){const r=getCursor(u),i=u.source[1]==="?"?1:2;let m;const _=u.source.indexOf(">");return _===-1?(m=u.source.slice(i),advanceBy(u,u.source.length)):(m=u.source.slice(i,_),advanceBy(u,_+1)),{type:3,content:m,loc:getSelection(u,r)}}function parseElement(u,r){const i=u.inPre,m=u.inVPre,_=last(r),A=parseTag(u,TagType.Start,_),w=u.inPre&&!i,T=u.inVPre&&!m;if(A.isSelfClosing||u.options.isVoidTag(A.tag))return w&&(u.inPre=!1),T&&(u.inVPre=!1),A;r.push(A);const R=u.options.getTextMode(A,_),D=parseChildren(u,R,r);r.pop();{const U=A.props.find(k=>k.type===6&&k.name==="inline-template");if(U&&checkCompatEnabled("COMPILER_INLINE_TEMPLATE",u,U.loc)){const k=getSelection(u,A.loc.end);U.value={type:2,content:k.source,loc:k}}}if(A.children=D,startsWithEndTagOpen(u.source,A.tag))parseTag(u,TagType.End,_);else if(emitError(u,24,0,A.loc.start),u.source.length===0&&A.tag.toLowerCase()==="script"){const U=D[0];U&&startsWith(U.loc.source,"<!--")&&emitError(u,8)}return A.loc=getSelection(u,A.loc.start),w&&(u.inPre=!1),T&&(u.inVPre=!1),A}var TagType=(u=>(u[u.Start=0]="Start",u[u.End=1]="End",u))(TagType||{});const isSpecialTemplateDirective=makeMap("if,else,else-if,for,slot");function parseTag(u,r,i){const m=getCursor(u),_=/^<\/?([a-z][^\t\r\n\f />]*)/i.exec(u.source),A=_[1],w=u.options.getNamespace(A,i);advanceBy(u,_[0].length),advanceSpaces(u);const T=getCursor(u),R=u.source;u.options.isPreTag(A)&&(u.inPre=!0);let D=parseAttributes(u,r);r===0&&!u.inVPre&&D.some(X=>X.type===7&&X.name==="pre")&&(u.inVPre=!0,extend(u,T),u.source=R,D=parseAttributes(u,r).filter(X=>X.name!=="v-pre"));let U=!1;if(u.source.length===0?emitError(u,9):(U=startsWith(u.source,"/>"),r===1&&U&&emitError(u,4),advanceBy(u,U?2:1)),r===1)return;let k=0;return u.inVPre||(A==="slot"?k=2:A==="template"?D.some(X=>X.type===7&&isSpecialTemplateDirective(X.name))&&(k=3):isComponent(A,D,u)&&(k=1)),{type:1,ns:w,tag:A,tagType:k,props:D,isSelfClosing:U,children:[],loc:getSelection(u,m),codegenNode:void 0}}function isComponent(u,r,i){const m=i.options;if(m.isCustomElement(u))return!1;if(u==="component"||/^[A-Z]/.test(u)||isCoreComponent(u)||m.isBuiltInComponent&&m.isBuiltInComponent(u)||m.isNativeTag&&!m.isNativeTag(u))return!0;for(let _=0;_<r.length;_++){const A=r[_];if(A.type===6){if(A.name==="is"&&A.value){if(A.value.content.startsWith("vue:"))return!0;if(checkCompatEnabled("COMPILER_IS_ON_ELEMENT",i,A.loc))return!0}}else{if(A.name==="is")return!0;if(A.name==="bind"&&isStaticArgOf(A.arg,"is")&&checkCompatEnabled("COMPILER_IS_ON_ELEMENT",i,A.loc))return!0}}}function parseAttributes(u,r){const i=[],m=new Set;for(;u.source.length>0&&!startsWith(u.source,">")&&!startsWith(u.source,"/>");){if(startsWith(u.source,"/")){emitError(u,22),advanceBy(u,1),advanceSpaces(u);continue}r===1&&emitError(u,3);const _=parseAttribute(u,m);_.type===6&&_.value&&_.name==="class"&&(_.value.content=_.value.content.replace(/\s+/g," ").trim()),r===0&&i.push(_),/^[^\t\r\n\f />]/.test(u.source)&&emitError(u,15),advanceSpaces(u)}return i}function parseAttribute(u,r){var i;const m=getCursor(u),A=/^[^\t\r\n\f />][^\t\r\n\f />=]*/.exec(u.source)[0];r.has(A)&&emitError(u,2),r.add(A),A[0]==="="&&emitError(u,19);{const R=/["'<]/g;let D;for(;D=R.exec(A);)emitError(u,17,D.index)}advanceBy(u,A.length);let w;/^[\t\r\n\f ]*=/.test(u.source)&&(advanceSpaces(u),advanceBy(u,1),advanceSpaces(u),w=parseAttributeValue(u),w||emitError(u,13));const T=getSelection(u,m);if(!u.inVPre&&/^(v-[A-Za-z0-9-]|:|\.|@|#)/.test(A)){const R=/(?:^v-([a-z0-9-]+))?(?:(?::|^\.|^@|^#)(\[[^\]]+\]|[^\.]+))?(.+)?$/i.exec(A);let D=startsWith(A,"."),U=R[1]||(D||startsWith(A,":")?"bind":startsWith(A,"@")?"on":"slot"),k;if(R[2]){const J=U==="slot",$=A.lastIndexOf(R[2],A.length-(((i=R[3])==null?void 0:i.length)||0)),oe=getSelection(u,getNewPosition(u,m,$),getNewPosition(u,m,$+R[2].length+(J&&R[3]||"").length));let ne=R[2],H=!0;ne.startsWith("[")?(H=!1,ne.endsWith("]")?ne=ne.slice(1,ne.length-1):(emitError(u,27),ne=ne.slice(1))):J&&(ne+=R[3]||""),k={type:4,content:ne,isStatic:H,constType:H?3:0,loc:oe}}if(w&&w.isQuoted){const J=w.loc;J.start.offset++,J.start.column++,J.end=advancePositionWithClone(J.start,w.content),J.source=J.source.slice(1,-1)}const X=R[3]?R[3].slice(1).split("."):[];return D&&X.push("prop"),U==="bind"&&k&&X.includes("sync")&&checkCompatEnabled("COMPILER_V_BIND_SYNC",u,T,k.loc.source)&&(U="model",X.splice(X.indexOf("sync"),1)),{type:7,name:U,exp:w&&{type:4,content:w.content,isStatic:!1,constType:0,loc:w.loc},arg:k,modifiers:X,loc:T}}return!u.inVPre&&startsWith(A,"v-")&&emitError(u,26),{type:6,name:A,value:w&&{type:2,content:w.content,loc:w.loc},loc:T}}function parseAttributeValue(u){const r=getCursor(u);let i;const m=u.source[0],_=m==='"'||m==="'";if(_){advanceBy(u,1);const A=u.source.indexOf(m);A===-1?i=parseTextData(u,u.source.length,4):(i=parseTextData(u,A,4),advanceBy(u,1))}else{const A=/^[^\t\r\n\f >]+/.exec(u.source);if(!A)return;const w=/["'<=`]/g;let T;for(;T=w.exec(A[0]);)emitError(u,18,T.index);i=parseTextData(u,A[0].length,4)}return{content:i,isQuoted:_,loc:getSelection(u,r)}}function parseInterpolation(u,r){const[i,m]=u.options.delimiters,_=u.source.indexOf(m,i.length);if(_===-1){emitError(u,25);return}const A=getCursor(u);advanceBy(u,i.length);const w=getCursor(u),T=getCursor(u),R=_-i.length,D=u.source.slice(0,R),U=parseTextData(u,R,r),k=U.trim(),X=U.indexOf(k);X>0&&advancePositionWithMutation(w,D,X);const J=R-(U.length-k.length-X);return advancePositionWithMutation(T,D,J),advanceBy(u,m.length),{type:5,content:{type:4,isStatic:!1,constType:0,content:k,loc:getSelection(u,w,T)},loc:getSelection(u,A)}}function parseText(u,r){const i=r===3?["]]>"]:["<",u.options.delimiters[0]];let m=u.source.length;for(let w=0;w<i.length;w++){const T=u.source.indexOf(i[w],1);T!==-1&&m>T&&(m=T)}const _=getCursor(u);return{type:2,content:parseTextData(u,m,r),loc:getSelection(u,_)}}function parseTextData(u,r,i){const m=u.source.slice(0,r);return advanceBy(u,r),i===2||i===3||!m.includes("&")?m:u.options.decodeEntities(m,i===4)}function getCursor(u){const{column:r,line:i,offset:m}=u;return{column:r,line:i,offset:m}}function getSelection(u,r,i){return i=i||getCursor(u),{start:r,end:i,source:u.originalSource.slice(r.offset,i.offset)}}function last(u){return u[u.length-1]}function startsWith(u,r){return u.startsWith(r)}function advanceBy(u,r){const{source:i}=u;advancePositionWithMutation(u,i,r),u.source=i.slice(r)}function advanceSpaces(u){const r=/^[\t\r\n\f ]+/.exec(u.source);r&&advanceBy(u,r[0].length)}function getNewPosition(u,r,i){return advancePositionWithClone(r,u.originalSource.slice(r.offset,i),i)}function emitError(u,r,i,m=getCursor(u)){i&&(m.offset+=i,m.column+=i),u.options.onError(createCompilerError(r,{start:m,end:m,source:""}))}function isEnd(u,r,i){const m=u.source;switch(r){case 0:if(startsWith(m,"</")){for(let _=i.length-1;_>=0;--_)if(startsWithEndTagOpen(m,i[_].tag))return!0}break;case 1:case 2:{const _=last(i);if(_&&startsWithEndTagOpen(m,_.tag))return!0;break}case 3:if(startsWith(m,"]]>"))return!0;break}return!m}function startsWithEndTagOpen(u,r){return startsWith(u,"</")&&u.slice(2,2+r.length).toLowerCase()===r.toLowerCase()&&/[\t\r\n\f />]/.test(u[2+r.length]||">")}function hoistStatic(u,r){walk(u,r,isSingleElementRoot(u,u.children[0]))}function isSingleElementRoot(u,r){const{children:i}=u;return i.length===1&&r.type===1&&!isSlotOutlet(r)}function walk(u,r,i=!1){const{children:m}=u,_=m.length;let A=0;for(let w=0;w<m.length;w++){const T=m[w];if(T.type===1&&T.tagType===0){const R=i?0:getConstantType(T,r);if(R>0){if(R>=2){T.codegenNode.patchFlag="-1",T.codegenNode=r.hoist(T.codegenNode),A++;continue}}else{const D=T.codegenNode;if(D.type===13){const U=getPatchFlag(D);if((!U||U===512||U===1)&&getGeneratedPropsConstantType(T,r)>=2){const k=getNodeProps(T);k&&(D.props=r.hoist(k))}D.dynamicProps&&(D.dynamicProps=r.hoist(D.dynamicProps))}}}if(T.type===1){const R=T.tagType===1;R&&r.scopes.vSlot++,walk(T,r),R&&r.scopes.vSlot--}else if(T.type===11)walk(T,r,T.children.length===1);else if(T.type===9)for(let R=0;R<T.branches.length;R++)walk(T.branches[R],r,T.branches[R].children.length===1)}A&&r.transformHoist&&r.transformHoist(m,r,u),A&&A===_&&u.type===1&&u.tagType===0&&u.codegenNode&&u.codegenNode.type===13&&isArray(u.codegenNode.children)&&(u.codegenNode.children=r.hoist(createArrayExpression(u.codegenNode.children)))}function getConstantType(u,r){const{constantCache:i}=r;switch(u.type){case 1:if(u.tagType!==0)return 0;const m=i.get(u);if(m!==void 0)return m;const _=u.codegenNode;if(_.type!==13||_.isBlock&&u.tag!=="svg"&&u.tag!=="foreignObject")return 0;if(getPatchFlag(_))return i.set(u,0),0;{let T=3;const R=getGeneratedPropsConstantType(u,r);if(R===0)return i.set(u,0),0;R<T&&(T=R);for(let D=0;D<u.children.length;D++){const U=getConstantType(u.children[D],r);if(U===0)return i.set(u,0),0;U<T&&(T=U)}if(T>1)for(let D=0;D<u.props.length;D++){const U=u.props[D];if(U.type===7&&U.name==="bind"&&U.exp){const k=getConstantType(U.exp,r);if(k===0)return i.set(u,0),0;k<T&&(T=k)}}if(_.isBlock){for(let D=0;D<u.props.length;D++)if(u.props[D].type===7)return i.set(u,0),0;r.removeHelper(OPEN_BLOCK),r.removeHelper(getVNodeBlockHelper(r.inSSR,_.isComponent)),_.isBlock=!1,r.helper(getVNodeHelper(r.inSSR,_.isComponent))}return i.set(u,T),T}case 2:case 3:return 3;case 9:case 11:case 10:return 0;case 5:case 12:return getConstantType(u.content,r);case 4:return u.constType;case 8:let w=3;for(let T=0;T<u.children.length;T++){const R=u.children[T];if(isString(R)||isSymbol(R))continue;const D=getConstantType(R,r);if(D===0)return 0;D<w&&(w=D)}return w;default:return 0}}const allowHoistedHelperSet=new Set([NORMALIZE_CLASS,NORMALIZE_STYLE,NORMALIZE_PROPS,GUARD_REACTIVE_PROPS]);function getConstantTypeOfHelperCall(u,r){if(u.type===14&&!isString(u.callee)&&allowHoistedHelperSet.has(u.callee)){const i=u.arguments[0];if(i.type===4)return getConstantType(i,r);if(i.type===14)return getConstantTypeOfHelperCall(i,r)}return 0}function getGeneratedPropsConstantType(u,r){let i=3;const m=getNodeProps(u);if(m&&m.type===15){const{properties:_}=m;for(let A=0;A<_.length;A++){const{key:w,value:T}=_[A],R=getConstantType(w,r);if(R===0)return R;R<i&&(i=R);let D;if(T.type===4?D=getConstantType(T,r):T.type===14?D=getConstantTypeOfHelperCall(T,r):D=0,D===0)return D;D<i&&(i=D)}}return i}function getNodeProps(u){const r=u.codegenNode;if(r.type===13)return r.props}function getPatchFlag(u){const r=u.patchFlag;return r?parseInt(r,10):void 0}function createTransformContext(u,{filename:r="",prefixIdentifiers:i=!1,hoistStatic:m=!1,cacheHandlers:_=!1,nodeTransforms:A=[],directiveTransforms:w={},transformHoist:T=null,isBuiltInComponent:R=NOOP,isCustomElement:D=NOOP,expressionPlugins:U=[],scopeId:k=null,slotted:X=!0,ssr:J=!1,inSSR:$=!1,ssrCssVars:oe="",bindingMetadata:ne=EMPTY_OBJ,inline:H=!1,isTS:V=!1,onError:z=defaultOnError,onWarn:ce=defaultOnWarn,compatConfig:ue}){const he=r.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),K={selfName:he&&capitalize(camelize(he[1])),prefixIdentifiers:i,hoistStatic:m,cacheHandlers:_,nodeTransforms:A,directiveTransforms:w,transformHoist:T,isBuiltInComponent:R,isCustomElement:D,expressionPlugins:U,scopeId:k,slotted:X,ssr:J,inSSR:$,ssrCssVars:oe,bindingMetadata:ne,inline:H,isTS:V,onError:z,onWarn:ce,compatConfig:ue,root:u,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],constantCache:new Map,temps:0,cached:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,currentNode:u,childIndex:0,inVOnce:!1,helper(Y){const ie=K.helpers.get(Y)||0;return K.helpers.set(Y,ie+1),Y},removeHelper(Y){const ie=K.helpers.get(Y);if(ie){const ve=ie-1;ve?K.helpers.set(Y,ve):K.helpers.delete(Y)}},helperString(Y){return`_${helperNameMap[K.helper(Y)]}`},replaceNode(Y){K.parent.children[K.childIndex]=K.currentNode=Y},removeNode(Y){const ie=K.parent.children,ve=Y?ie.indexOf(Y):K.currentNode?K.childIndex:-1;!Y||Y===K.currentNode?(K.currentNode=null,K.onNodeRemoved()):K.childIndex>ve&&(K.childIndex--,K.onNodeRemoved()),K.parent.children.splice(ve,1)},onNodeRemoved:()=>{},addIdentifiers(Y){},removeIdentifiers(Y){},hoist(Y){isString(Y)&&(Y=createSimpleExpression(Y)),K.hoists.push(Y);const ie=createSimpleExpression(`_hoisted_${K.hoists.length}`,!1,Y.loc,2);return ie.hoisted=Y,ie},cache(Y,ie=!1){return createCacheExpression(K.cached++,Y,ie)}};return K.filters=new Set,K}function transform(u,r){const i=createTransformContext(u,r);traverseNode(u,i),r.hoistStatic&&hoistStatic(u,i),r.ssr||createRootCodegen(u,i),u.helpers=new Set([...i.helpers.keys()]),u.components=[...i.components],u.directives=[...i.directives],u.imports=i.imports,u.hoists=i.hoists,u.temps=i.temps,u.cached=i.cached,u.filters=[...i.filters]}function createRootCodegen(u,r){const{helper:i}=r,{children:m}=u;if(m.length===1){const _=m[0];if(isSingleElementRoot(u,_)&&_.codegenNode){const A=_.codegenNode;A.type===13&&convertToBlock(A,r),u.codegenNode=A}else u.codegenNode=_}else if(m.length>1){let _=64;u.codegenNode=createVNodeCall(r,i(FRAGMENT),void 0,u.children,_+"",void 0,void 0,!0,void 0,!1)}}function traverseChildren(u,r){let i=0;const m=()=>{i--};for(;i<u.children.length;i++){const _=u.children[i];isString(_)||(r.parent=u,r.childIndex=i,r.onNodeRemoved=m,traverseNode(_,r))}}function traverseNode(u,r){r.currentNode=u;const{nodeTransforms:i}=r,m=[];for(let A=0;A<i.length;A++){const w=i[A](u,r);if(w&&(isArray(w)?m.push(...w):m.push(w)),r.currentNode)u=r.currentNode;else return}switch(u.type){case 3:r.ssr||r.helper(CREATE_COMMENT);break;case 5:r.ssr||r.helper(TO_DISPLAY_STRING);break;case 9:for(let A=0;A<u.branches.length;A++)traverseNode(u.branches[A],r);break;case 10:case 11:case 1:case 0:traverseChildren(u,r);break}r.currentNode=u;let _=m.length;for(;_--;)m[_]()}function createStructuralDirectiveTransform(u,r){const i=isString(u)?m=>m===u:m=>u.test(m);return(m,_)=>{if(m.type===1){const{props:A}=m;if(m.tagType===3&&A.some(isVSlot))return;const w=[];for(let T=0;T<A.length;T++){const R=A[T];if(R.type===7&&i(R.name)){A.splice(T,1),T--;const D=r(m,R,_);D&&w.push(D)}}return w}}}const PURE_ANNOTATION="/*#__PURE__*/",aliasHelper=u=>`${helperNameMap[u]}: _${helperNameMap[u]}`;function createCodegenContext(u,{mode:r="function",prefixIdentifiers:i=r==="module",sourceMap:m=!1,filename:_="template.vue.html",scopeId:A=null,optimizeImports:w=!1,runtimeGlobalName:T="Vue",runtimeModuleName:R="vue",ssrRuntimeModuleName:D="vue/server-renderer",ssr:U=!1,isTS:k=!1,inSSR:X=!1}){const J={mode:r,prefixIdentifiers:i,sourceMap:m,filename:_,scopeId:A,optimizeImports:w,runtimeGlobalName:T,runtimeModuleName:R,ssrRuntimeModuleName:D,ssr:U,isTS:k,inSSR:X,source:u.loc.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper(oe){return`_${helperNameMap[oe]}`},push(oe,ne){J.code+=oe},indent(){$(++J.indentLevel)},deindent(oe=!1){oe?--J.indentLevel:$(--J.indentLevel)},newline(){$(J.indentLevel)}};function $(oe){J.push(`
`+"  ".repeat(oe))}return J}function generate(u,r={}){const i=createCodegenContext(u,r);r.onContextCreated&&r.onContextCreated(i);const{mode:m,push:_,prefixIdentifiers:A,indent:w,deindent:T,newline:R,scopeId:D,ssr:U}=i,k=Array.from(u.helpers),X=k.length>0,J=!A&&m!=="module",$=!1,oe=$?createCodegenContext(u,r):i;genFunctionPreamble(u,oe);const ne=U?"ssrRender":"render",V=(U?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ");if(_(`function ${ne}(${V}) {`),w(),J&&(_("with (_ctx) {"),w(),X&&(_(`const { ${k.map(aliasHelper).join(", ")} } = _Vue`),_(`
`),R())),u.components.length&&(genAssets(u.components,"component",i),(u.directives.length||u.temps>0)&&R()),u.directives.length&&(genAssets(u.directives,"directive",i),u.temps>0&&R()),u.filters&&u.filters.length&&(R(),genAssets(u.filters,"filter",i),R()),u.temps>0){_("let ");for(let z=0;z<u.temps;z++)_(`${z>0?", ":""}_temp${z}`)}return(u.components.length||u.directives.length||u.temps)&&(_(`
`),R()),U||_("return "),u.codegenNode?genNode(u.codegenNode,i):_("null"),J&&(T(),_("}")),T(),_("}"),{ast:u,code:i.code,preamble:$?oe.code:"",map:i.map?i.map.toJSON():void 0}}function genFunctionPreamble(u,r){const{ssr:i,prefixIdentifiers:m,push:_,newline:A,runtimeModuleName:w,runtimeGlobalName:T,ssrRuntimeModuleName:R}=r,D=T,U=Array.from(u.helpers);if(U.length>0&&(_(`const _Vue = ${D}
`),u.hoists.length)){const k=[CREATE_VNODE,CREATE_ELEMENT_VNODE,CREATE_COMMENT,CREATE_TEXT,CREATE_STATIC].filter(X=>U.includes(X)).map(aliasHelper).join(", ");_(`const { ${k} } = _Vue
`)}genHoists(u.hoists,r),A(),_("return ")}function genAssets(u,r,{helper:i,push:m,newline:_,isTS:A}){const w=i(r==="filter"?RESOLVE_FILTER:r==="component"?RESOLVE_COMPONENT:RESOLVE_DIRECTIVE);for(let T=0;T<u.length;T++){let R=u[T];const D=R.endsWith("__self");D&&(R=R.slice(0,-6)),m(`const ${toValidAssetId(R,r)} = ${w}(${JSON.stringify(R)}${D?", true":""})${A?"!":""}`),T<u.length-1&&_()}}function genHoists(u,r){if(!u.length)return;r.pure=!0;const{push:i,newline:m,helper:_,scopeId:A,mode:w}=r;m();for(let T=0;T<u.length;T++){const R=u[T];R&&(i(`const _hoisted_${T+1} = `),genNode(R,r),m())}r.pure=!1}function genNodeListAsArray(u,r){const i=u.length>3||!1;r.push("["),i&&r.indent(),genNodeList(u,r,i),i&&r.deindent(),r.push("]")}function genNodeList(u,r,i=!1,m=!0){const{push:_,newline:A}=r;for(let w=0;w<u.length;w++){const T=u[w];isString(T)?_(T):isArray(T)?genNodeListAsArray(T,r):genNode(T,r),w<u.length-1&&(i?(m&&_(","),A()):m&&_(", "))}}function genNode(u,r){if(isString(u)){r.push(u);return}if(isSymbol(u)){r.push(r.helper(u));return}switch(u.type){case 1:case 9:case 11:genNode(u.codegenNode,r);break;case 2:genText(u,r);break;case 4:genExpression(u,r);break;case 5:genInterpolation(u,r);break;case 12:genNode(u.codegenNode,r);break;case 8:genCompoundExpression(u,r);break;case 3:genComment(u,r);break;case 13:genVNodeCall(u,r);break;case 14:genCallExpression(u,r);break;case 15:genObjectExpression(u,r);break;case 17:genArrayExpression(u,r);break;case 18:genFunctionExpression(u,r);break;case 19:genConditionalExpression(u,r);break;case 20:genCacheExpression(u,r);break;case 21:genNodeList(u.body,r,!0,!1);break}}function genText(u,r){r.push(JSON.stringify(u.content),u)}function genExpression(u,r){const{content:i,isStatic:m}=u;r.push(m?JSON.stringify(i):i,u)}function genInterpolation(u,r){const{push:i,helper:m,pure:_}=r;_&&i(PURE_ANNOTATION),i(`${m(TO_DISPLAY_STRING)}(`),genNode(u.content,r),i(")")}function genCompoundExpression(u,r){for(let i=0;i<u.children.length;i++){const m=u.children[i];isString(m)?r.push(m):genNode(m,r)}}function genExpressionAsPropertyKey(u,r){const{push:i}=r;if(u.type===8)i("["),genCompoundExpression(u,r),i("]");else if(u.isStatic){const m=isSimpleIdentifier(u.content)?u.content:JSON.stringify(u.content);i(m,u)}else i(`[${u.content}]`,u)}function genComment(u,r){const{push:i,helper:m,pure:_}=r;_&&i(PURE_ANNOTATION),i(`${m(CREATE_COMMENT)}(${JSON.stringify(u.content)})`,u)}function genVNodeCall(u,r){const{push:i,helper:m,pure:_}=r,{tag:A,props:w,children:T,patchFlag:R,dynamicProps:D,directives:U,isBlock:k,disableTracking:X,isComponent:J}=u;U&&i(m(WITH_DIRECTIVES)+"("),k&&i(`(${m(OPEN_BLOCK)}(${X?"true":""}), `),_&&i(PURE_ANNOTATION);const $=k?getVNodeBlockHelper(r.inSSR,J):getVNodeHelper(r.inSSR,J);i(m($)+"(",u),genNodeList(genNullableArgs([A,w,T,R,D]),r),i(")"),k&&i(")"),U&&(i(", "),genNode(U,r),i(")"))}function genNullableArgs(u){let r=u.length;for(;r--&&u[r]==null;);return u.slice(0,r+1).map(i=>i||"null")}function genCallExpression(u,r){const{push:i,helper:m,pure:_}=r,A=isString(u.callee)?u.callee:m(u.callee);_&&i(PURE_ANNOTATION),i(A+"(",u),genNodeList(u.arguments,r),i(")")}function genObjectExpression(u,r){const{push:i,indent:m,deindent:_,newline:A}=r,{properties:w}=u;if(!w.length){i("{}",u);return}const T=w.length>1||!1;i(T?"{":"{ "),T&&m();for(let R=0;R<w.length;R++){const{key:D,value:U}=w[R];genExpressionAsPropertyKey(D,r),i(": "),genNode(U,r),R<w.length-1&&(i(","),A())}T&&_(),i(T?"}":" }")}function genArrayExpression(u,r){genNodeListAsArray(u.elements,r)}function genFunctionExpression(u,r){const{push:i,indent:m,deindent:_}=r,{params:A,returns:w,body:T,newline:R,isSlot:D}=u;D&&i(`_${helperNameMap[WITH_CTX]}(`),i("(",u),isArray(A)?genNodeList(A,r):A&&genNode(A,r),i(") => "),(R||T)&&(i("{"),m()),w?(R&&i("return "),isArray(w)?genNodeListAsArray(w,r):genNode(w,r)):T&&genNode(T,r),(R||T)&&(_(),i("}")),D&&(u.isNonScopedSlot&&i(", undefined, true"),i(")"))}function genConditionalExpression(u,r){const{test:i,consequent:m,alternate:_,newline:A}=u,{push:w,indent:T,deindent:R,newline:D}=r;if(i.type===4){const k=!isSimpleIdentifier(i.content);k&&w("("),genExpression(i,r),k&&w(")")}else w("("),genNode(i,r),w(")");A&&T(),r.indentLevel++,A||w(" "),w("? "),genNode(m,r),r.indentLevel--,A&&D(),A||w(" "),w(": ");const U=_.type===19;U||r.indentLevel++,genNode(_,r),U||r.indentLevel--,A&&R(!0)}function genCacheExpression(u,r){const{push:i,helper:m,indent:_,deindent:A,newline:w}=r;i(`_cache[${u.index}] || (`),u.isVNode&&(_(),i(`${m(SET_BLOCK_TRACKING)}(-1),`),w()),i(`_cache[${u.index}] = `),genNode(u.value,r),u.isVNode&&(i(","),w(),i(`${m(SET_BLOCK_TRACKING)}(1),`),w(),i(`_cache[${u.index}]`),A()),i(")")}new RegExp("\\b"+"arguments,await,break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,let,new,return,super,switch,throw,try,var,void,while,with,yield".split(",").join("\\b|\\b")+"\\b");const transformIf=createStructuralDirectiveTransform(/^(if|else|else-if)$/,(u,r,i)=>processIf(u,r,i,(m,_,A)=>{const w=i.parent.children;let T=w.indexOf(m),R=0;for(;T-->=0;){const D=w[T];D&&D.type===9&&(R+=D.branches.length)}return()=>{if(A)m.codegenNode=createCodegenNodeForBranch(_,R,i);else{const D=getParentCondition(m.codegenNode);D.alternate=createCodegenNodeForBranch(_,R+m.branches.length-1,i)}}}));function processIf(u,r,i,m){if(r.name!=="else"&&(!r.exp||!r.exp.content.trim())){const _=r.exp?r.exp.loc:u.loc;i.onError(createCompilerError(28,r.loc)),r.exp=createSimpleExpression("true",!1,_)}if(r.name==="if"){const _=createIfBranch(u,r),A={type:9,loc:u.loc,branches:[_]};if(i.replaceNode(A),m)return m(A,_,!0)}else{const _=i.parent.children;let A=_.indexOf(u);for(;A-->=-1;){const w=_[A];if(w&&w.type===3){i.removeNode(w);continue}if(w&&w.type===2&&!w.content.trim().length){i.removeNode(w);continue}if(w&&w.type===9){r.name==="else-if"&&w.branches[w.branches.length-1].condition===void 0&&i.onError(createCompilerError(30,u.loc)),i.removeNode();const T=createIfBranch(u,r);w.branches.push(T);const R=m&&m(w,T,!1);traverseNode(T,i),R&&R(),i.currentNode=null}else i.onError(createCompilerError(30,u.loc));break}}}function createIfBranch(u,r){const i=u.tagType===3;return{type:10,loc:u.loc,condition:r.name==="else"?void 0:r.exp,children:i&&!findDir(u,"for")?u.children:[u],userKey:findProp(u,"key"),isTemplateIf:i}}function createCodegenNodeForBranch(u,r,i){return u.condition?createConditionalExpression(u.condition,createChildrenCodegenNode(u,r,i),createCallExpression(i.helper(CREATE_COMMENT),['""',"true"])):createChildrenCodegenNode(u,r,i)}function createChildrenCodegenNode(u,r,i){const{helper:m}=i,_=createObjectProperty("key",createSimpleExpression(`${r}`,!1,locStub,2)),{children:A}=u,w=A[0];if(A.length!==1||w.type!==1)if(A.length===1&&w.type===11){const R=w.codegenNode;return injectProp(R,_,i),R}else{let R=64;return createVNodeCall(i,m(FRAGMENT),createObjectExpression([_]),A,R+"",void 0,void 0,!0,!1,!1,u.loc)}else{const R=w.codegenNode,D=getMemoedVNodeCall(R);return D.type===13&&convertToBlock(D,i),injectProp(D,_,i),R}}function getParentCondition(u){for(;;)if(u.type===19)if(u.alternate.type===19)u=u.alternate;else return u;else u.type===20&&(u=u.value)}const transformFor=createStructuralDirectiveTransform("for",(u,r,i)=>{const{helper:m,removeHelper:_}=i;return processFor(u,r,i,A=>{const w=createCallExpression(m(RENDER_LIST),[A.source]),T=isTemplateNode(u),R=findDir(u,"memo"),D=findProp(u,"key"),U=D&&(D.type===6?createSimpleExpression(D.value.content,!0):D.exp),k=D?createObjectProperty("key",U):null,X=A.source.type===4&&A.source.constType>0,J=X?64:D?128:256;return A.codegenNode=createVNodeCall(i,m(FRAGMENT),void 0,w,J+"",void 0,void 0,!0,!X,!1,u.loc),()=>{let $;const{children:oe}=A,ne=oe.length!==1||oe[0].type!==1,H=isSlotOutlet(u)?u:T&&u.children.length===1&&isSlotOutlet(u.children[0])?u.children[0]:null;if(H?($=H.codegenNode,T&&k&&injectProp($,k,i)):ne?$=createVNodeCall(i,m(FRAGMENT),k?createObjectExpression([k]):void 0,u.children,"64",void 0,void 0,!0,void 0,!1):($=oe[0].codegenNode,T&&k&&injectProp($,k,i),$.isBlock!==!X&&($.isBlock?(_(OPEN_BLOCK),_(getVNodeBlockHelper(i.inSSR,$.isComponent))):_(getVNodeHelper(i.inSSR,$.isComponent))),$.isBlock=!X,$.isBlock?(m(OPEN_BLOCK),m(getVNodeBlockHelper(i.inSSR,$.isComponent))):m(getVNodeHelper(i.inSSR,$.isComponent))),R){const V=createFunctionExpression(createForLoopParams(A.parseResult,[createSimpleExpression("_cached")]));V.body=createBlockStatement([createCompoundExpression(["const _memo = (",R.exp,")"]),createCompoundExpression(["if (_cached",...U?[" && _cached.key === ",U]:[],` && ${i.helperString(IS_MEMO_SAME)}(_cached, _memo)) return _cached`]),createCompoundExpression(["const _item = ",$]),createSimpleExpression("_item.memo = _memo"),createSimpleExpression("return _item")]),w.arguments.push(V,createSimpleExpression("_cache"),createSimpleExpression(String(i.cached++)))}else w.arguments.push(createFunctionExpression(createForLoopParams(A.parseResult),$,!0))}})});function processFor(u,r,i,m){if(!r.exp){i.onError(createCompilerError(31,r.loc));return}const _=parseForExpression(r.exp);if(!_){i.onError(createCompilerError(32,r.loc));return}const{addIdentifiers:A,removeIdentifiers:w,scopes:T}=i,{source:R,value:D,key:U,index:k}=_,X={type:11,loc:r.loc,source:R,valueAlias:D,keyAlias:U,objectIndexAlias:k,parseResult:_,children:isTemplateNode(u)?u.children:[u]};i.replaceNode(X),T.vFor++;const J=m&&m(X);return()=>{T.vFor--,J&&J()}}const forAliasRE=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,forIteratorRE=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,stripParensRE=/^\(|\)$/g;function parseForExpression(u,r){const i=u.loc,m=u.content,_=m.match(forAliasRE);if(!_)return;const[,A,w]=_,T={source:createAliasExpression(i,w.trim(),m.indexOf(w,A.length)),value:void 0,key:void 0,index:void 0};let R=A.trim().replace(stripParensRE,"").trim();const D=A.indexOf(R),U=R.match(forIteratorRE);if(U){R=R.replace(forIteratorRE,"").trim();const k=U[1].trim();let X;if(k&&(X=m.indexOf(k,D+R.length),T.key=createAliasExpression(i,k,X)),U[2]){const J=U[2].trim();J&&(T.index=createAliasExpression(i,J,m.indexOf(J,T.key?X+k.length:D+R.length)))}}return R&&(T.value=createAliasExpression(i,R,D)),T}function createAliasExpression(u,r,i){return createSimpleExpression(r,!1,getInnerRange(u,i,r.length))}function createForLoopParams({value:u,key:r,index:i},m=[]){return createParamsList([u,r,i,...m])}function createParamsList(u){let r=u.length;for(;r--&&!u[r];);return u.slice(0,r+1).map((i,m)=>i||createSimpleExpression("_".repeat(m+1),!1))}const defaultFallback=createSimpleExpression("undefined",!1),trackSlotScopes=(u,r)=>{if(u.type===1&&(u.tagType===1||u.tagType===3)){const i=findDir(u,"slot");if(i)return i.exp,r.scopes.vSlot++,()=>{r.scopes.vSlot--}}},buildClientSlotFn=(u,r,i)=>createFunctionExpression(u,r,!1,!0,r.length?r[0].loc:i);function buildSlots(u,r,i=buildClientSlotFn){r.helper(WITH_CTX);const{children:m,loc:_}=u,A=[],w=[];let T=r.scopes.vSlot>0||r.scopes.vFor>0;const R=findDir(u,"slot",!0);if(R){const{arg:ne,exp:H}=R;ne&&!isStaticExp(ne)&&(T=!0),A.push(createObjectProperty(ne||createSimpleExpression("default",!0),i(H,m,_)))}let D=!1,U=!1;const k=[],X=new Set;let J=0;for(let ne=0;ne<m.length;ne++){const H=m[ne];let V;if(!isTemplateNode(H)||!(V=findDir(H,"slot",!0))){H.type!==3&&k.push(H);continue}if(R){r.onError(createCompilerError(37,V.loc));break}D=!0;const{children:z,loc:ce}=H,{arg:ue=createSimpleExpression("default",!0),exp:he,loc:K}=V;let Y;isStaticExp(ue)?Y=ue?ue.content:"default":T=!0;const ie=i(he,z,ce);let ve,re,ae;if(ve=findDir(H,"if"))T=!0,w.push(createConditionalExpression(ve.exp,buildDynamicSlot(ue,ie,J++),defaultFallback));else if(re=findDir(H,/^else(-if)?$/,!0)){let me=ne,ye;for(;me--&&(ye=m[me],ye.type===3););if(ye&&isTemplateNode(ye)&&findDir(ye,"if")){m.splice(ne,1),ne--;let Te=w[w.length-1];for(;Te.alternate.type===19;)Te=Te.alternate;Te.alternate=re.exp?createConditionalExpression(re.exp,buildDynamicSlot(ue,ie,J++),defaultFallback):buildDynamicSlot(ue,ie,J++)}else r.onError(createCompilerError(30,re.loc))}else if(ae=findDir(H,"for")){T=!0;const me=ae.parseResult||parseForExpression(ae.exp);me?w.push(createCallExpression(r.helper(RENDER_LIST),[me.source,createFunctionExpression(createForLoopParams(me),buildDynamicSlot(ue,ie),!0)])):r.onError(createCompilerError(32,ae.loc))}else{if(Y){if(X.has(Y)){r.onError(createCompilerError(38,K));continue}X.add(Y),Y==="default"&&(U=!0)}A.push(createObjectProperty(ue,ie))}}if(!R){const ne=(H,V)=>{const z=i(H,V,_);return r.compatConfig&&(z.isNonScopedSlot=!0),createObjectProperty("default",z)};D?k.length&&k.some(H=>isNonWhitespaceContent(H))&&(U?r.onError(createCompilerError(39,k[0].loc)):A.push(ne(void 0,k))):A.push(ne(void 0,m))}const $=T?2:hasForwardedSlots(u.children)?3:1;let oe=createObjectExpression(A.concat(createObjectProperty("_",createSimpleExpression($+"",!1))),_);return w.length&&(oe=createCallExpression(r.helper(CREATE_SLOTS),[oe,createArrayExpression(w)])),{slots:oe,hasDynamicSlots:T}}function buildDynamicSlot(u,r,i){const m=[createObjectProperty("name",u),createObjectProperty("fn",r)];return i!=null&&m.push(createObjectProperty("key",createSimpleExpression(String(i),!0))),createObjectExpression(m)}function hasForwardedSlots(u){for(let r=0;r<u.length;r++){const i=u[r];switch(i.type){case 1:if(i.tagType===2||hasForwardedSlots(i.children))return!0;break;case 9:if(hasForwardedSlots(i.branches))return!0;break;case 10:case 11:if(hasForwardedSlots(i.children))return!0;break}}return!1}function isNonWhitespaceContent(u){return u.type!==2&&u.type!==12?!0:u.type===2?!!u.content.trim():isNonWhitespaceContent(u.content)}const directiveImportMap=new WeakMap,transformElement=(u,r)=>function(){if(u=r.currentNode,!(u.type===1&&(u.tagType===0||u.tagType===1)))return;const{tag:m,props:_}=u,A=u.tagType===1;let w=A?resolveComponentType(u,r):`"${m}"`;const T=isObject(w)&&w.callee===RESOLVE_DYNAMIC_COMPONENT;let R,D,U,k=0,X,J,$,oe=T||w===TELEPORT||w===SUSPENSE||!A&&(m==="svg"||m==="foreignObject");if(_.length>0){const ne=buildProps(u,r,void 0,A,T);R=ne.props,k=ne.patchFlag,J=ne.dynamicPropNames;const H=ne.directives;$=H&&H.length?createArrayExpression(H.map(V=>buildDirectiveArgs(V,r))):void 0,ne.shouldUseBlock&&(oe=!0)}if(u.children.length>0)if(w===KEEP_ALIVE&&(oe=!0,k|=1024),A&&w!==TELEPORT&&w!==KEEP_ALIVE){const{slots:H,hasDynamicSlots:V}=buildSlots(u,r);D=H,V&&(k|=1024)}else if(u.children.length===1&&w!==TELEPORT){const H=u.children[0],V=H.type,z=V===5||V===8;z&&getConstantType(H,r)===0&&(k|=1),z||V===2?D=H:D=u.children}else D=u.children;k!==0&&(U=String(k),J&&J.length&&(X=stringifyDynamicPropNames(J))),u.codegenNode=createVNodeCall(r,w,R,D,U,X,$,!!oe,!1,A,u.loc)};function resolveComponentType(u,r,i=!1){let{tag:m}=u;const _=isComponentTag(m),A=findProp(u,"is");if(A)if(_||isCompatEnabled("COMPILER_IS_ON_ELEMENT",r)){const R=A.type===6?A.value&&createSimpleExpression(A.value.content,!0):A.exp;if(R)return createCallExpression(r.helper(RESOLVE_DYNAMIC_COMPONENT),[R])}else A.type===6&&A.value.content.startsWith("vue:")&&(m=A.value.content.slice(4));const w=!_&&findDir(u,"is");if(w&&w.exp)return createCallExpression(r.helper(RESOLVE_DYNAMIC_COMPONENT),[w.exp]);const T=isCoreComponent(m)||r.isBuiltInComponent(m);return T?(i||r.helper(T),T):(r.helper(RESOLVE_COMPONENT),r.components.add(m),toValidAssetId(m,"component"))}function buildProps(u,r,i=u.props,m,_,A=!1){const{tag:w,loc:T,children:R}=u;let D=[];const U=[],k=[],X=R.length>0;let J=!1,$=0,oe=!1,ne=!1,H=!1,V=!1,z=!1,ce=!1;const ue=[],he=ie=>{D.length&&(U.push(createObjectExpression(dedupeProperties(D),T)),D=[]),ie&&U.push(ie)},K=({key:ie,value:ve})=>{if(isStaticExp(ie)){const re=ie.content,ae=isOn(re);if(ae&&(!m||_)&&re.toLowerCase()!=="onclick"&&re!=="onUpdate:modelValue"&&!isReservedProp(re)&&(V=!0),ae&&isReservedProp(re)&&(ce=!0),ve.type===20||(ve.type===4||ve.type===8)&&getConstantType(ve,r)>0)return;re==="ref"?oe=!0:re==="class"?ne=!0:re==="style"?H=!0:re!=="key"&&!ue.includes(re)&&ue.push(re),m&&(re==="class"||re==="style")&&!ue.includes(re)&&ue.push(re)}else z=!0};for(let ie=0;ie<i.length;ie++){const ve=i[ie];if(ve.type===6){const{loc:re,name:ae,value:me}=ve;let ye=!0;if(ae==="ref"&&(oe=!0,r.scopes.vFor>0&&D.push(createObjectProperty(createSimpleExpression("ref_for",!0),createSimpleExpression("true")))),ae==="is"&&(isComponentTag(w)||me&&me.content.startsWith("vue:")||isCompatEnabled("COMPILER_IS_ON_ELEMENT",r)))continue;D.push(createObjectProperty(createSimpleExpression(ae,!0,getInnerRange(re,0,ae.length)),createSimpleExpression(me?me.content:"",ye,me?me.loc:re)))}else{const{name:re,arg:ae,exp:me,loc:ye}=ve,Te=re==="bind",ke=re==="on";if(re==="slot"){m||r.onError(createCompilerError(40,ye));continue}if(re==="once"||re==="memo"||re==="is"||Te&&isStaticArgOf(ae,"is")&&(isComponentTag(w)||isCompatEnabled("COMPILER_IS_ON_ELEMENT",r))||ke&&A)continue;if((Te&&isStaticArgOf(ae,"key")||ke&&X&&isStaticArgOf(ae,"vue:before-update"))&&(J=!0),Te&&isStaticArgOf(ae,"ref")&&r.scopes.vFor>0&&D.push(createObjectProperty(createSimpleExpression("ref_for",!0),createSimpleExpression("true"))),!ae&&(Te||ke)){if(z=!0,me)if(Te){if(he(),isCompatEnabled("COMPILER_V_BIND_OBJECT_ORDER",r)){U.unshift(me);continue}U.push(me)}else he({type:14,loc:ye,callee:r.helper(TO_HANDLERS),arguments:m?[me]:[me,"true"]});else r.onError(createCompilerError(Te?34:35,ye));continue}const Fe=r.directiveTransforms[re];if(Fe){const{props:Ve,needRuntime:ot}=Fe(ve,u,r);!A&&Ve.forEach(K),ke&&ae&&!isStaticExp(ae)?he(createObjectExpression(Ve,T)):D.push(...Ve),ot&&(k.push(ve),isSymbol(ot)&&directiveImportMap.set(ve,ot))}else isBuiltInDirective(re)||(k.push(ve),X&&(J=!0))}}let Y;if(U.length?(he(),U.length>1?Y=createCallExpression(r.helper(MERGE_PROPS),U,T):Y=U[0]):D.length&&(Y=createObjectExpression(dedupeProperties(D),T)),z?$|=16:(ne&&!m&&($|=2),H&&!m&&($|=4),ue.length&&($|=8),V&&($|=32)),!J&&($===0||$===32)&&(oe||ce||k.length>0)&&($|=512),!r.inSSR&&Y)switch(Y.type){case 15:let ie=-1,ve=-1,re=!1;for(let ye=0;ye<Y.properties.length;ye++){const Te=Y.properties[ye].key;isStaticExp(Te)?Te.content==="class"?ie=ye:Te.content==="style"&&(ve=ye):Te.isHandlerKey||(re=!0)}const ae=Y.properties[ie],me=Y.properties[ve];re?Y=createCallExpression(r.helper(NORMALIZE_PROPS),[Y]):(ae&&!isStaticExp(ae.value)&&(ae.value=createCallExpression(r.helper(NORMALIZE_CLASS),[ae.value])),me&&(H||me.value.type===4&&me.value.content.trim()[0]==="["||me.value.type===17)&&(me.value=createCallExpression(r.helper(NORMALIZE_STYLE),[me.value])));break;case 14:break;default:Y=createCallExpression(r.helper(NORMALIZE_PROPS),[createCallExpression(r.helper(GUARD_REACTIVE_PROPS),[Y])]);break}return{props:Y,directives:k,patchFlag:$,dynamicPropNames:ue,shouldUseBlock:J}}function dedupeProperties(u){const r=new Map,i=[];for(let m=0;m<u.length;m++){const _=u[m];if(_.key.type===8||!_.key.isStatic){i.push(_);continue}const A=_.key.content,w=r.get(A);w?(A==="style"||A==="class"||isOn(A))&&mergeAsArray(w,_):(r.set(A,_),i.push(_))}return i}function mergeAsArray(u,r){u.value.type===17?u.value.elements.push(r.value):u.value=createArrayExpression([u.value,r.value],u.loc)}function buildDirectiveArgs(u,r){const i=[],m=directiveImportMap.get(u);m?i.push(r.helperString(m)):(r.helper(RESOLVE_DIRECTIVE),r.directives.add(u.name),i.push(toValidAssetId(u.name,"directive")));const{loc:_}=u;if(u.exp&&i.push(u.exp),u.arg&&(u.exp||i.push("void 0"),i.push(u.arg)),Object.keys(u.modifiers).length){u.arg||(u.exp||i.push("void 0"),i.push("void 0"));const A=createSimpleExpression("true",!1,_);i.push(createObjectExpression(u.modifiers.map(w=>createObjectProperty(w,A)),_))}return createArrayExpression(i,u.loc)}function stringifyDynamicPropNames(u){let r="[";for(let i=0,m=u.length;i<m;i++)r+=JSON.stringify(u[i]),i<m-1&&(r+=", ");return r+"]"}function isComponentTag(u){return u==="component"||u==="Component"}const transformSlotOutlet=(u,r)=>{if(isSlotOutlet(u)){const{children:i,loc:m}=u,{slotName:_,slotProps:A}=processSlotOutlet(u,r),w=[r.prefixIdentifiers?"_ctx.$slots":"$slots",_,"{}","undefined","true"];let T=2;A&&(w[2]=A,T=3),i.length&&(w[3]=createFunctionExpression([],i,!1,!1,m),T=4),r.scopeId&&!r.slotted&&(T=5),w.splice(T),u.codegenNode=createCallExpression(r.helper(RENDER_SLOT),w,m)}};function processSlotOutlet(u,r){let i='"default"',m;const _=[];for(let A=0;A<u.props.length;A++){const w=u.props[A];w.type===6?w.value&&(w.name==="name"?i=JSON.stringify(w.value.content):(w.name=camelize(w.name),_.push(w))):w.name==="bind"&&isStaticArgOf(w.arg,"name")?w.exp&&(i=w.exp):(w.name==="bind"&&w.arg&&isStaticExp(w.arg)&&(w.arg.content=camelize(w.arg.content)),_.push(w))}if(_.length>0){const{props:A,directives:w}=buildProps(u,r,_,!1,!1);m=A,w.length&&r.onError(createCompilerError(36,w[0].loc))}return{slotName:i,slotProps:m}}const fnExpRE=/^\s*([\w$_]+|(async\s*)?\([^)]*?\))\s*(:[^=]+)?=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,transformOn$1=(u,r,i,m)=>{const{loc:_,modifiers:A,arg:w}=u;!u.exp&&!A.length&&i.onError(createCompilerError(35,_));let T;if(w.type===4)if(w.isStatic){let k=w.content;k.startsWith("vue:")&&(k=`vnode-${k.slice(4)}`);const X=r.tagType!==0||k.startsWith("vnode")||!/[A-Z]/.test(k)?toHandlerKey(camelize(k)):`on:${k}`;T=createSimpleExpression(X,!0,w.loc)}else T=createCompoundExpression([`${i.helperString(TO_HANDLER_KEY)}(`,w,")"]);else T=w,T.children.unshift(`${i.helperString(TO_HANDLER_KEY)}(`),T.children.push(")");let R=u.exp;R&&!R.content.trim()&&(R=void 0);let D=i.cacheHandlers&&!R&&!i.inVOnce;if(R){const k=isMemberExpression(R.content),X=!(k||fnExpRE.test(R.content)),J=R.content.includes(";");(X||D&&k)&&(R=createCompoundExpression([`${X?"$event":"(...args)"} => ${J?"{":"("}`,R,J?"}":")"]))}let U={props:[createObjectProperty(T,R||createSimpleExpression("() => {}",!1,_))]};return m&&(U=m(U)),D&&(U.props[0].value=i.cache(U.props[0].value)),U.props.forEach(k=>k.key.isHandlerKey=!0),U},transformBind=(u,r,i)=>{const{exp:m,modifiers:_,loc:A}=u,w=u.arg;return w.type!==4?(w.children.unshift("("),w.children.push(') || ""')):w.isStatic||(w.content=`${w.content} || ""`),_.includes("camel")&&(w.type===4?w.isStatic?w.content=camelize(w.content):w.content=`${i.helperString(CAMELIZE)}(${w.content})`:(w.children.unshift(`${i.helperString(CAMELIZE)}(`),w.children.push(")"))),i.inSSR||(_.includes("prop")&&injectPrefix(w,"."),_.includes("attr")&&injectPrefix(w,"^")),!m||m.type===4&&!m.content.trim()?(i.onError(createCompilerError(34,A)),{props:[createObjectProperty(w,createSimpleExpression("",!0,A))]}):{props:[createObjectProperty(w,m)]}},injectPrefix=(u,r)=>{u.type===4?u.isStatic?u.content=r+u.content:u.content=`\`${r}\${${u.content}}\``:(u.children.unshift(`'${r}' + (`),u.children.push(")"))},transformText=(u,r)=>{if(u.type===0||u.type===1||u.type===11||u.type===10)return()=>{const i=u.children;let m,_=!1;for(let A=0;A<i.length;A++){const w=i[A];if(isText$1(w)){_=!0;for(let T=A+1;T<i.length;T++){const R=i[T];if(isText$1(R))m||(m=i[A]=createCompoundExpression([w],w.loc)),m.children.push(" + ",R),i.splice(T,1),T--;else{m=void 0;break}}}}if(!(!_||i.length===1&&(u.type===0||u.type===1&&u.tagType===0&&!u.props.find(A=>A.type===7&&!r.directiveTransforms[A.name])&&u.tag!=="template")))for(let A=0;A<i.length;A++){const w=i[A];if(isText$1(w)||w.type===8){const T=[];(w.type!==2||w.content!==" ")&&T.push(w),!r.ssr&&getConstantType(w,r)===0&&T.push("1"),i[A]={type:12,content:w,loc:w.loc,codegenNode:createCallExpression(r.helper(CREATE_TEXT),T)}}}}},seen$1=new WeakSet,transformOnce=(u,r)=>{if(u.type===1&&findDir(u,"once",!0))return seen$1.has(u)||r.inVOnce||r.inSSR?void 0:(seen$1.add(u),r.inVOnce=!0,r.helper(SET_BLOCK_TRACKING),()=>{r.inVOnce=!1;const i=r.currentNode;i.codegenNode&&(i.codegenNode=r.cache(i.codegenNode,!0))})},transformModel$1=(u,r,i)=>{const{exp:m,arg:_}=u;if(!m)return i.onError(createCompilerError(41,u.loc)),createTransformProps();const A=m.loc.source,w=m.type===4?m.content:A,T=i.bindingMetadata[A];if(T==="props"||T==="props-aliased")return i.onError(createCompilerError(44,m.loc)),createTransformProps();const R=!1;if(!w.trim()||!isMemberExpression(w)&&!R)return i.onError(createCompilerError(42,m.loc)),createTransformProps();const D=_||createSimpleExpression("modelValue",!0),U=_?isStaticExp(_)?`onUpdate:${camelize(_.content)}`:createCompoundExpression(['"onUpdate:" + ',_]):"onUpdate:modelValue";let k;const X=i.isTS?"($event: any)":"$event";k=createCompoundExpression([`${X} => ((`,m,") = $event)"]);const J=[createObjectProperty(D,u.exp),createObjectProperty(U,k)];if(u.modifiers.length&&r.tagType===1){const $=u.modifiers.map(ne=>(isSimpleIdentifier(ne)?ne:JSON.stringify(ne))+": true").join(", "),oe=_?isStaticExp(_)?`${_.content}Modifiers`:createCompoundExpression([_,' + "Modifiers"']):"modelModifiers";J.push(createObjectProperty(oe,createSimpleExpression(`{ ${$} }`,!1,u.loc,2)))}return createTransformProps(J)};function createTransformProps(u=[]){return{props:u}}const validDivisionCharRE=/[\w).+\-_$\]]/,transformFilter=(u,r)=>{isCompatEnabled("COMPILER_FILTER",r)&&(u.type===5&&rewriteFilter(u.content,r),u.type===1&&u.props.forEach(i=>{i.type===7&&i.name!=="for"&&i.exp&&rewriteFilter(i.exp,r)}))};function rewriteFilter(u,r){if(u.type===4)parseFilter(u,r);else for(let i=0;i<u.children.length;i++){const m=u.children[i];typeof m=="object"&&(m.type===4?parseFilter(m,r):m.type===8?rewriteFilter(u,r):m.type===5&&rewriteFilter(m.content,r))}}function parseFilter(u,r){const i=u.content;let m=!1,_=!1,A=!1,w=!1,T=0,R=0,D=0,U=0,k,X,J,$,oe=[];for(J=0;J<i.length;J++)if(X=k,k=i.charCodeAt(J),m)k===39&&X!==92&&(m=!1);else if(_)k===34&&X!==92&&(_=!1);else if(A)k===96&&X!==92&&(A=!1);else if(w)k===47&&X!==92&&(w=!1);else if(k===124&&i.charCodeAt(J+1)!==124&&i.charCodeAt(J-1)!==124&&!T&&!R&&!D)$===void 0?(U=J+1,$=i.slice(0,J).trim()):ne();else{switch(k){case 34:_=!0;break;case 39:m=!0;break;case 96:A=!0;break;case 40:D++;break;case 41:D--;break;case 91:R++;break;case 93:R--;break;case 123:T++;break;case 125:T--;break}if(k===47){let H=J-1,V;for(;H>=0&&(V=i.charAt(H),V===" ");H--);(!V||!validDivisionCharRE.test(V))&&(w=!0)}}$===void 0?$=i.slice(0,J).trim():U!==0&&ne();function ne(){oe.push(i.slice(U,J).trim()),U=J+1}if(oe.length){for(J=0;J<oe.length;J++)$=wrapFilter($,oe[J],r);u.content=$}}function wrapFilter(u,r,i){i.helper(RESOLVE_FILTER);const m=r.indexOf("(");if(m<0)return i.filters.add(r),`${toValidAssetId(r,"filter")}(${u})`;{const _=r.slice(0,m),A=r.slice(m+1);return i.filters.add(_),`${toValidAssetId(_,"filter")}(${u}${A!==")"?","+A:A}`}}const seen=new WeakSet,transformMemo=(u,r)=>{if(u.type===1){const i=findDir(u,"memo");return!i||seen.has(u)?void 0:(seen.add(u),()=>{const m=u.codegenNode||r.currentNode.codegenNode;m&&m.type===13&&(u.tagType!==1&&convertToBlock(m,r),u.codegenNode=createCallExpression(r.helper(WITH_MEMO),[i.exp,createFunctionExpression(void 0,m),"_cache",String(r.cached++)]))})}};function getBaseTransformPreset(u){return[[transformOnce,transformIf,transformMemo,transformFor,transformFilter,transformSlotOutlet,transformElement,trackSlotScopes,transformText],{on:transformOn$1,bind:transformBind,model:transformModel$1}]}function baseCompile(u,r={}){const i=r.onError||defaultOnError,m=r.mode==="module";r.prefixIdentifiers===!0?i(createCompilerError(47)):m&&i(createCompilerError(48));const _=!1;r.cacheHandlers&&i(createCompilerError(49)),r.scopeId&&!m&&i(createCompilerError(50));const A=isString(u)?baseParse(u,r):u,[w,T]=getBaseTransformPreset();return transform(A,extend({},r,{prefixIdentifiers:_,nodeTransforms:[...w,...r.nodeTransforms||[]],directiveTransforms:extend({},T,r.directiveTransforms||{})})),generate(A,extend({},r,{prefixIdentifiers:_}))}const noopDirectiveTransform=()=>({props:[]}),V_MODEL_RADIO=Symbol(""),V_MODEL_CHECKBOX=Symbol(""),V_MODEL_TEXT=Symbol(""),V_MODEL_SELECT=Symbol(""),V_MODEL_DYNAMIC=Symbol(""),V_ON_WITH_MODIFIERS=Symbol(""),V_ON_WITH_KEYS=Symbol(""),V_SHOW=Symbol(""),TRANSITION=Symbol(""),TRANSITION_GROUP=Symbol("");registerRuntimeHelpers({[V_MODEL_RADIO]:"vModelRadio",[V_MODEL_CHECKBOX]:"vModelCheckbox",[V_MODEL_TEXT]:"vModelText",[V_MODEL_SELECT]:"vModelSelect",[V_MODEL_DYNAMIC]:"vModelDynamic",[V_ON_WITH_MODIFIERS]:"withModifiers",[V_ON_WITH_KEYS]:"withKeys",[V_SHOW]:"vShow",[TRANSITION]:"Transition",[TRANSITION_GROUP]:"TransitionGroup"});let decoder;function decodeHtmlBrowser(u,r=!1){return decoder||(decoder=document.createElement("div")),r?(decoder.innerHTML=`<div foo="${u.replace(/"/g,"&quot;")}">`,decoder.children[0].getAttribute("foo")):(decoder.innerHTML=u,decoder.textContent)}const isRawTextContainer=makeMap("style,iframe,script,noscript",!0),parserOptions={isVoidTag,isNativeTag:u=>isHTMLTag(u)||isSVGTag(u),isPreTag:u=>u==="pre",decodeEntities:decodeHtmlBrowser,isBuiltInComponent:u=>{if(isBuiltInType(u,"Transition"))return TRANSITION;if(isBuiltInType(u,"TransitionGroup"))return TRANSITION_GROUP},getNamespace(u,r){let i=r?r.ns:0;if(r&&i===2)if(r.tag==="annotation-xml"){if(u==="svg")return 1;r.props.some(m=>m.type===6&&m.name==="encoding"&&m.value!=null&&(m.value.content==="text/html"||m.value.content==="application/xhtml+xml"))&&(i=0)}else/^m(?:[ions]|text)$/.test(r.tag)&&u!=="mglyph"&&u!=="malignmark"&&(i=0);else r&&i===1&&(r.tag==="foreignObject"||r.tag==="desc"||r.tag==="title")&&(i=0);if(i===0){if(u==="svg")return 1;if(u==="math")return 2}return i},getTextMode({tag:u,ns:r}){if(r===0){if(u==="textarea"||u==="title")return 1;if(isRawTextContainer(u))return 2}return 0}},transformStyle=u=>{u.type===1&&u.props.forEach((r,i)=>{r.type===6&&r.name==="style"&&r.value&&(u.props[i]={type:7,name:"bind",arg:createSimpleExpression("style",!0,r.loc),exp:parseInlineCSS(r.value.content,r.loc),modifiers:[],loc:r.loc})})},parseInlineCSS=(u,r)=>{const i=parseStringStyle(u);return createSimpleExpression(JSON.stringify(i),!1,r,3)};function createDOMCompilerError(u,r){return createCompilerError(u,r)}const transformVHtml=(u,r,i)=>{const{exp:m,loc:_}=u;return m||i.onError(createDOMCompilerError(53,_)),r.children.length&&(i.onError(createDOMCompilerError(54,_)),r.children.length=0),{props:[createObjectProperty(createSimpleExpression("innerHTML",!0,_),m||createSimpleExpression("",!0))]}},transformVText=(u,r,i)=>{const{exp:m,loc:_}=u;return m||i.onError(createDOMCompilerError(55,_)),r.children.length&&(i.onError(createDOMCompilerError(56,_)),r.children.length=0),{props:[createObjectProperty(createSimpleExpression("textContent",!0),m?getConstantType(m,i)>0?m:createCallExpression(i.helperString(TO_DISPLAY_STRING),[m],_):createSimpleExpression("",!0))]}},transformModel=(u,r,i)=>{const m=transformModel$1(u,r,i);if(!m.props.length||r.tagType===1)return m;u.arg&&i.onError(createDOMCompilerError(58,u.arg.loc));const{tag:_}=r,A=i.isCustomElement(_);if(_==="input"||_==="textarea"||_==="select"||A){let w=V_MODEL_TEXT,T=!1;if(_==="input"||A){const R=findProp(r,"type");if(R){if(R.type===7)w=V_MODEL_DYNAMIC;else if(R.value)switch(R.value.content){case"radio":w=V_MODEL_RADIO;break;case"checkbox":w=V_MODEL_CHECKBOX;break;case"file":T=!0,i.onError(createDOMCompilerError(59,u.loc));break}}else hasDynamicKeyVBind(r)&&(w=V_MODEL_DYNAMIC)}else _==="select"&&(w=V_MODEL_SELECT);T||(m.needRuntime=i.helper(w))}else i.onError(createDOMCompilerError(57,u.loc));return m.props=m.props.filter(w=>!(w.key.type===4&&w.key.content==="modelValue")),m},isEventOptionModifier=makeMap("passive,once,capture"),isNonKeyModifier=makeMap("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),maybeKeyModifier=makeMap("left,right"),isKeyboardEvent=makeMap("onkeyup,onkeydown,onkeypress",!0),resolveModifiers=(u,r,i,m)=>{const _=[],A=[],w=[];for(let T=0;T<r.length;T++){const R=r[T];R==="native"&&checkCompatEnabled("COMPILER_V_ON_NATIVE",i)||isEventOptionModifier(R)?w.push(R):maybeKeyModifier(R)?isStaticExp(u)?isKeyboardEvent(u.content)?_.push(R):A.push(R):(_.push(R),A.push(R)):isNonKeyModifier(R)?A.push(R):_.push(R)}return{keyModifiers:_,nonKeyModifiers:A,eventOptionModifiers:w}},transformClick=(u,r)=>isStaticExp(u)&&u.content.toLowerCase()==="onclick"?createSimpleExpression(r,!0):u.type!==4?createCompoundExpression(["(",u,`) === "onClick" ? "${r}" : (`,u,")"]):u,transformOn=(u,r,i)=>transformOn$1(u,r,i,m=>{const{modifiers:_}=u;if(!_.length)return m;let{key:A,value:w}=m.props[0];const{keyModifiers:T,nonKeyModifiers:R,eventOptionModifiers:D}=resolveModifiers(A,_,i,u.loc);if(R.includes("right")&&(A=transformClick(A,"onContextmenu")),R.includes("middle")&&(A=transformClick(A,"onMouseup")),R.length&&(w=createCallExpression(i.helper(V_ON_WITH_MODIFIERS),[w,JSON.stringify(R)])),T.length&&(!isStaticExp(A)||isKeyboardEvent(A.content))&&(w=createCallExpression(i.helper(V_ON_WITH_KEYS),[w,JSON.stringify(T)])),D.length){const U=D.map(capitalize).join("");A=isStaticExp(A)?createSimpleExpression(`${A.content}${U}`,!0):createCompoundExpression(["(",A,`) + "${U}"`])}return{props:[createObjectProperty(A,w)]}}),transformShow=(u,r,i)=>{const{exp:m,loc:_}=u;return m||i.onError(createDOMCompilerError(61,_)),{props:[],needRuntime:i.helper(V_SHOW)}},ignoreSideEffectTags=(u,r)=>{u.type===1&&u.tagType===0&&(u.tag==="script"||u.tag==="style")&&r.removeNode()},DOMNodeTransforms=[transformStyle],DOMDirectiveTransforms={cloak:noopDirectiveTransform,html:transformVHtml,text:transformVText,model:transformModel,on:transformOn,show:transformShow};function compile(u,r={}){return baseCompile(u,extend({},parserOptions,r,{nodeTransforms:[ignoreSideEffectTags,...DOMNodeTransforms,...r.nodeTransforms||[]],directiveTransforms:extend({},DOMDirectiveTransforms,r.directiveTransforms||{}),transformHoist:null}))}const compileCache=Object.create(null);function compileToFunction(u,r){if(!isString(u))if(u.nodeType)u=u.innerHTML;else return NOOP;const i=u,m=compileCache[i];if(m)return m;if(u[0]==="#"){const T=document.querySelector(u);u=T?T.innerHTML:""}const _=extend({hoistStatic:!0,onError:void 0,onWarn:NOOP},r);!_.isCustomElement&&typeof customElements<"u"&&(_.isCustomElement=T=>!!customElements.get(T));const{code:A}=compile(u,_),w=new Function("Vue",A)(runtimeDom);return w._rc=!0,compileCache[i]=w}registerRuntimeCompiler(compileToFunction);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="156",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,AlphaFormat=1021,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",DisplayP3ColorSpace="display-p3",KeepStencilOp=7680,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,GLSL3="300 es",_SRGBAFormat=1035,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(r,i){this._listeners===void 0&&(this._listeners={});const m=this._listeners;m[r]===void 0&&(m[r]=[]),m[r].indexOf(i)===-1&&m[r].push(i)}hasEventListener(r,i){if(this._listeners===void 0)return!1;const m=this._listeners;return m[r]!==void 0&&m[r].indexOf(i)!==-1}removeEventListener(r,i){if(this._listeners===void 0)return;const _=this._listeners[r];if(_!==void 0){const A=_.indexOf(i);A!==-1&&_.splice(A,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const m=this._listeners[r.type];if(m!==void 0){r.target=this;const _=m.slice(0);for(let A=0,w=_.length;A<w;A++)_[A].call(this,r);r.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const u=Math.random()*4294967295|0,r=Math.random()*4294967295|0,i=Math.random()*4294967295|0,m=Math.random()*4294967295|0;return(_lut[u&255]+_lut[u>>8&255]+_lut[u>>16&255]+_lut[u>>24&255]+"-"+_lut[r&255]+_lut[r>>8&255]+"-"+_lut[r>>16&15|64]+_lut[r>>24&255]+"-"+_lut[i&63|128]+_lut[i>>8&255]+"-"+_lut[i>>16&255]+_lut[i>>24&255]+_lut[m&255]+_lut[m>>8&255]+_lut[m>>16&255]+_lut[m>>24&255]).toLowerCase()}function clamp(u,r,i){return Math.max(r,Math.min(i,u))}function euclideanModulo(u,r){return(u%r+r)%r}function mapLinear(u,r,i,m,_){return m+(u-r)*(_-m)/(i-r)}function inverseLerp(u,r,i){return u!==r?(i-u)/(r-u):0}function lerp(u,r,i){return(1-i)*u+i*r}function damp(u,r,i,m){return lerp(u,r,1-Math.exp(-i*m))}function pingpong(u,r=1){return r-Math.abs(euclideanModulo(u,r*2)-r)}function smoothstep(u,r,i){return u<=r?0:u>=i?1:(u=(u-r)/(i-r),u*u*(3-2*u))}function smootherstep(u,r,i){return u<=r?0:u>=i?1:(u=(u-r)/(i-r),u*u*u*(u*(u*6-15)+10))}function randInt(u,r){return u+Math.floor(Math.random()*(r-u+1))}function randFloat(u,r){return u+Math.random()*(r-u)}function randFloatSpread(u){return u*(.5-Math.random())}function seededRandom(u){u!==void 0&&(_seed=u);let r=_seed+=1831565813;return r=Math.imul(r^r>>>15,r|1),r^=r+Math.imul(r^r>>>7,r|61),((r^r>>>14)>>>0)/4294967296}function degToRad(u){return u*DEG2RAD}function radToDeg(u){return u*RAD2DEG}function isPowerOfTwo(u){return(u&u-1)===0&&u!==0}function ceilPowerOfTwo(u){return Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))}function floorPowerOfTwo(u){return Math.pow(2,Math.floor(Math.log(u)/Math.LN2))}function setQuaternionFromProperEuler(u,r,i,m,_){const A=Math.cos,w=Math.sin,T=A(i/2),R=w(i/2),D=A((r+m)/2),U=w((r+m)/2),k=A((r-m)/2),X=w((r-m)/2),J=A((m-r)/2),$=w((m-r)/2);switch(_){case"XYX":u.set(T*U,R*k,R*X,T*D);break;case"YZY":u.set(R*X,T*U,R*k,T*D);break;case"ZXZ":u.set(R*k,R*X,T*U,T*D);break;case"XZX":u.set(T*U,R*$,R*J,T*D);break;case"YXY":u.set(R*J,T*U,R*$,T*D);break;case"ZYZ":u.set(R*$,R*J,T*U,T*D);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+_)}}function denormalize(u,r){switch(r.constructor){case Float32Array:return u;case Uint32Array:return u/4294967295;case Uint16Array:return u/65535;case Uint8Array:return u/255;case Int32Array:return Math.max(u/2147483647,-1);case Int16Array:return Math.max(u/32767,-1);case Int8Array:return Math.max(u/127,-1);default:throw new Error("Invalid component type.")}}function normalize(u,r){switch(r.constructor){case Float32Array:return u;case Uint32Array:return Math.round(u*4294967295);case Uint16Array:return Math.round(u*65535);case Uint8Array:return Math.round(u*255);case Int32Array:return Math.round(u*2147483647);case Int16Array:return Math.round(u*32767);case Int8Array:return Math.round(u*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Vector2{constructor(r=0,i=0){Vector2.prototype.isVector2=!0,this.x=r,this.y=i}get width(){return this.x}set width(r){this.x=r}get height(){return this.y}set height(r){this.y=r}set(r,i){return this.x=r,this.y=i,this}setScalar(r){return this.x=r,this.y=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setComponent(r,i){switch(r){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y)}copy(r){return this.x=r.x,this.y=r.y,this}add(r){return this.x+=r.x,this.y+=r.y,this}addScalar(r){return this.x+=r,this.y+=r,this}addVectors(r,i){return this.x=r.x+i.x,this.y=r.y+i.y,this}addScaledVector(r,i){return this.x+=r.x*i,this.y+=r.y*i,this}sub(r){return this.x-=r.x,this.y-=r.y,this}subScalar(r){return this.x-=r,this.y-=r,this}subVectors(r,i){return this.x=r.x-i.x,this.y=r.y-i.y,this}multiply(r){return this.x*=r.x,this.y*=r.y,this}multiplyScalar(r){return this.x*=r,this.y*=r,this}divide(r){return this.x/=r.x,this.y/=r.y,this}divideScalar(r){return this.multiplyScalar(1/r)}applyMatrix3(r){const i=this.x,m=this.y,_=r.elements;return this.x=_[0]*i+_[3]*m+_[6],this.y=_[1]*i+_[4]*m+_[7],this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this}clamp(r,i){return this.x=Math.max(r.x,Math.min(i.x,this.x)),this.y=Math.max(r.y,Math.min(i.y,this.y)),this}clampScalar(r,i){return this.x=Math.max(r,Math.min(i,this.x)),this.y=Math.max(r,Math.min(i,this.y)),this}clampLength(r,i){const m=this.length();return this.divideScalar(m||1).multiplyScalar(Math.max(r,Math.min(i,m)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(r){return this.x*r.x+this.y*r.y}cross(r){return this.x*r.y-this.y*r.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(r){const i=Math.sqrt(this.lengthSq()*r.lengthSq());if(i===0)return Math.PI/2;const m=this.dot(r)/i;return Math.acos(clamp(m,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const i=this.x-r.x,m=this.y-r.y;return i*i+m*m}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,i){return this.x+=(r.x-this.x)*i,this.y+=(r.y-this.y)*i,this}lerpVectors(r,i,m){return this.x=r.x+(i.x-r.x)*m,this.y=r.y+(i.y-r.y)*m,this}equals(r){return r.x===this.x&&r.y===this.y}fromArray(r,i=0){return this.x=r[i],this.y=r[i+1],this}toArray(r=[],i=0){return r[i]=this.x,r[i+1]=this.y,r}fromBufferAttribute(r,i){return this.x=r.getX(i),this.y=r.getY(i),this}rotateAround(r,i){const m=Math.cos(i),_=Math.sin(i),A=this.x-r.x,w=this.y-r.y;return this.x=A*m-w*_+r.x,this.y=A*_+w*m+r.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(r,i,m,_,A,w,T,R,D){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],r!==void 0&&this.set(r,i,m,_,A,w,T,R,D)}set(r,i,m,_,A,w,T,R,D){const U=this.elements;return U[0]=r,U[1]=_,U[2]=T,U[3]=i,U[4]=A,U[5]=R,U[6]=m,U[7]=w,U[8]=D,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(r){const i=this.elements,m=r.elements;return i[0]=m[0],i[1]=m[1],i[2]=m[2],i[3]=m[3],i[4]=m[4],i[5]=m[5],i[6]=m[6],i[7]=m[7],i[8]=m[8],this}extractBasis(r,i,m){return r.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),m.setFromMatrix3Column(this,2),this}setFromMatrix4(r){const i=r.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,i){const m=r.elements,_=i.elements,A=this.elements,w=m[0],T=m[3],R=m[6],D=m[1],U=m[4],k=m[7],X=m[2],J=m[5],$=m[8],oe=_[0],ne=_[3],H=_[6],V=_[1],z=_[4],ce=_[7],ue=_[2],he=_[5],K=_[8];return A[0]=w*oe+T*V+R*ue,A[3]=w*ne+T*z+R*he,A[6]=w*H+T*ce+R*K,A[1]=D*oe+U*V+k*ue,A[4]=D*ne+U*z+k*he,A[7]=D*H+U*ce+k*K,A[2]=X*oe+J*V+$*ue,A[5]=X*ne+J*z+$*he,A[8]=X*H+J*ce+$*K,this}multiplyScalar(r){const i=this.elements;return i[0]*=r,i[3]*=r,i[6]*=r,i[1]*=r,i[4]*=r,i[7]*=r,i[2]*=r,i[5]*=r,i[8]*=r,this}determinant(){const r=this.elements,i=r[0],m=r[1],_=r[2],A=r[3],w=r[4],T=r[5],R=r[6],D=r[7],U=r[8];return i*w*U-i*T*D-m*A*U+m*T*R+_*A*D-_*w*R}invert(){const r=this.elements,i=r[0],m=r[1],_=r[2],A=r[3],w=r[4],T=r[5],R=r[6],D=r[7],U=r[8],k=U*w-T*D,X=T*R-U*A,J=D*A-w*R,$=i*k+m*X+_*J;if($===0)return this.set(0,0,0,0,0,0,0,0,0);const oe=1/$;return r[0]=k*oe,r[1]=(_*D-U*m)*oe,r[2]=(T*m-_*w)*oe,r[3]=X*oe,r[4]=(U*i-_*R)*oe,r[5]=(_*A-T*i)*oe,r[6]=J*oe,r[7]=(m*R-D*i)*oe,r[8]=(w*i-m*A)*oe,this}transpose(){let r;const i=this.elements;return r=i[1],i[1]=i[3],i[3]=r,r=i[2],i[2]=i[6],i[6]=r,r=i[5],i[5]=i[7],i[7]=r,this}getNormalMatrix(r){return this.setFromMatrix4(r).invert().transpose()}transposeIntoArray(r){const i=this.elements;return r[0]=i[0],r[1]=i[3],r[2]=i[6],r[3]=i[1],r[4]=i[4],r[5]=i[7],r[6]=i[2],r[7]=i[5],r[8]=i[8],this}setUvTransform(r,i,m,_,A,w,T){const R=Math.cos(A),D=Math.sin(A);return this.set(m*R,m*D,-m*(R*w+D*T)+w+r,-_*D,_*R,-_*(-D*w+R*T)+T+i,0,0,1),this}scale(r,i){return this.premultiply(_m3.makeScale(r,i)),this}rotate(r){return this.premultiply(_m3.makeRotation(-r)),this}translate(r,i){return this.premultiply(_m3.makeTranslation(r,i)),this}makeTranslation(r,i){return r.isVector2?this.set(1,0,r.x,0,1,r.y,0,0,1):this.set(1,0,r,0,1,i,0,0,1),this}makeRotation(r){const i=Math.cos(r),m=Math.sin(r);return this.set(i,-m,0,m,i,0,0,0,1),this}makeScale(r,i){return this.set(r,0,0,0,i,0,0,0,1),this}equals(r){const i=this.elements,m=r.elements;for(let _=0;_<9;_++)if(i[_]!==m[_])return!1;return!0}fromArray(r,i=0){for(let m=0;m<9;m++)this.elements[m]=r[m+i];return this}toArray(r=[],i=0){const m=this.elements;return r[i]=m[0],r[i+1]=m[1],r[i+2]=m[2],r[i+3]=m[3],r[i+4]=m[4],r[i+5]=m[5],r[i+6]=m[6],r[i+7]=m[7],r[i+8]=m[8],r}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(u){for(let r=u.length-1;r>=0;--r)if(u[r]>=65535)return!0;return!1}function createElementNS(u){return document.createElementNS("http://www.w3.org/1999/xhtml",u)}function createCanvasElement(){const u=createElementNS("canvas");return u.style.display="block",u}const _cache={};function warnOnce(u){u in _cache||(_cache[u]=!0,console.warn(u))}function SRGBToLinear(u){return u<.04045?u*.0773993808:Math.pow(u*.9478672986+.0521327014,2.4)}function LinearToSRGB(u){return u<.0031308?u*12.92:1.055*Math.pow(u,.41666)-.055}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=new Matrix3().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=new Matrix3().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function DisplayP3ToLinearSRGB(u){return u.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB)}function LinearSRGBToDisplayP3(u){return u.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}const TO_LINEAR={[LinearSRGBColorSpace]:u=>u,[SRGBColorSpace]:u=>u.convertSRGBToLinear(),[DisplayP3ColorSpace]:DisplayP3ToLinearSRGB},FROM_LINEAR={[LinearSRGBColorSpace]:u=>u,[SRGBColorSpace]:u=>u.convertLinearToSRGB(),[DisplayP3ColorSpace]:LinearSRGBToDisplayP3},ColorManagement={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(u){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!u},get workingColorSpace(){return LinearSRGBColorSpace},set workingColorSpace(u){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(u,r,i){if(this.enabled===!1||r===i||!r||!i)return u;const m=TO_LINEAR[r],_=FROM_LINEAR[i];if(m===void 0||_===void 0)throw new Error(`Unsupported color space conversion, "${r}" to "${i}".`);return _(m(u))},fromWorkingColorSpace:function(u,r){return this.convert(u,this.workingColorSpace,r)},toWorkingColorSpace:function(u,r){return this.convert(u,r,this.workingColorSpace)}};let _canvas;class ImageUtils{static getDataURL(r){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let i;if(r instanceof HTMLCanvasElement)i=r;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=r.width,_canvas.height=r.height;const m=_canvas.getContext("2d");r instanceof ImageData?m.putImageData(r,0,0):m.drawImage(r,0,0,r.width,r.height),i=_canvas}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const i=createElementNS("canvas");i.width=r.width,i.height=r.height;const m=i.getContext("2d");m.drawImage(r,0,0,r.width,r.height);const _=m.getImageData(0,0,r.width,r.height),A=_.data;for(let w=0;w<A.length;w++)A[w]=SRGBToLinear(A[w]/255)*255;return m.putImageData(_,0,0),i}else if(r.data){const i=r.data.slice(0);for(let m=0;m<i.length;m++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[m]=Math.floor(SRGBToLinear(i[m]/255)*255):i[m]=SRGBToLinear(i[m]);return{data:i,width:r.width,height:r.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}}let sourceId=0;class Source{constructor(r=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sourceId++}),this.uuid=generateUUID(),this.data=r,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const i=r===void 0||typeof r=="string";if(!i&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const m={uuid:this.uuid,url:""},_=this.data;if(_!==null){let A;if(Array.isArray(_)){A=[];for(let w=0,T=_.length;w<T;w++)_[w].isDataTexture?A.push(serializeImage(_[w].image)):A.push(serializeImage(_[w]))}else A=serializeImage(_);m.url=A}return i||(r.images[this.uuid]=m),m}}function serializeImage(u){return typeof HTMLImageElement<"u"&&u instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&u instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&u instanceof ImageBitmap?ImageUtils.getDataURL(u):u.data?{data:Array.from(u.data),width:u.width,height:u.height,type:u.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher{constructor(r=Texture.DEFAULT_IMAGE,i=Texture.DEFAULT_MAPPING,m=ClampToEdgeWrapping,_=ClampToEdgeWrapping,A=LinearFilter,w=LinearMipmapLinearFilter,T=RGBAFormat,R=UnsignedByteType,D=Texture.DEFAULT_ANISOTROPY,U=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(r),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=m,this.wrapT=_,this.magFilter=A,this.minFilter=w,this.anisotropy=D,this.format=T,this.internalFormat=null,this.type=R,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof U=="string"?this.colorSpace=U:(warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=U===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(r=null){this.source.data=r}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(r){return this.name=r.name,this.source=r.source,this.mipmaps=r.mipmaps.slice(0),this.mapping=r.mapping,this.channel=r.channel,this.wrapS=r.wrapS,this.wrapT=r.wrapT,this.magFilter=r.magFilter,this.minFilter=r.minFilter,this.anisotropy=r.anisotropy,this.format=r.format,this.internalFormat=r.internalFormat,this.type=r.type,this.offset.copy(r.offset),this.repeat.copy(r.repeat),this.center.copy(r.center),this.rotation=r.rotation,this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrix.copy(r.matrix),this.generateMipmaps=r.generateMipmaps,this.premultiplyAlpha=r.premultiplyAlpha,this.flipY=r.flipY,this.unpackAlignment=r.unpackAlignment,this.colorSpace=r.colorSpace,this.userData=JSON.parse(JSON.stringify(r.userData)),this.needsUpdate=!0,this}toJSON(r){const i=r===void 0||typeof r=="string";if(!i&&r.textures[this.uuid]!==void 0)return r.textures[this.uuid];const m={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(r).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(m.userData=this.userData),i||(r.textures[this.uuid]=m),m}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(r){if(this.mapping!==UVMapping)return r;if(r.applyMatrix3(this.matrix),r.x<0||r.x>1)switch(this.wrapS){case RepeatWrapping:r.x=r.x-Math.floor(r.x);break;case ClampToEdgeWrapping:r.x=r.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(r.x)%2)===1?r.x=Math.ceil(r.x)-r.x:r.x=r.x-Math.floor(r.x);break}if(r.y<0||r.y>1)switch(this.wrapT){case RepeatWrapping:r.y=r.y-Math.floor(r.y);break;case ClampToEdgeWrapping:r.y=r.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(r.y)%2)===1?r.y=Math.ceil(r.y)-r.y:r.y=r.y-Math.floor(r.y);break}return this.flipY&&(r.y=1-r.y),r}set needsUpdate(r){r===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set encoding(r){warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=r===sRGBEncoding?SRGBColorSpace:NoColorSpace}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(r=0,i=0,m=0,_=1){Vector4.prototype.isVector4=!0,this.x=r,this.y=i,this.z=m,this.w=_}get width(){return this.z}set width(r){this.z=r}get height(){return this.w}set height(r){this.w=r}set(r,i,m,_){return this.x=r,this.y=i,this.z=m,this.w=_,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this.w=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setW(r){return this.w=r,this}setComponent(r,i){switch(r){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w!==void 0?r.w:1,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this.w+=r.w,this}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this.w+=r,this}addVectors(r,i){return this.x=r.x+i.x,this.y=r.y+i.y,this.z=r.z+i.z,this.w=r.w+i.w,this}addScaledVector(r,i){return this.x+=r.x*i,this.y+=r.y*i,this.z+=r.z*i,this.w+=r.w*i,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this.w-=r.w,this}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this.w-=r,this}subVectors(r,i){return this.x=r.x-i.x,this.y=r.y-i.y,this.z=r.z-i.z,this.w=r.w-i.w,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this.w*=r.w,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this.w*=r,this}applyMatrix4(r){const i=this.x,m=this.y,_=this.z,A=this.w,w=r.elements;return this.x=w[0]*i+w[4]*m+w[8]*_+w[12]*A,this.y=w[1]*i+w[5]*m+w[9]*_+w[13]*A,this.z=w[2]*i+w[6]*m+w[10]*_+w[14]*A,this.w=w[3]*i+w[7]*m+w[11]*_+w[15]*A,this}divideScalar(r){return this.multiplyScalar(1/r)}setAxisAngleFromQuaternion(r){this.w=2*Math.acos(r.w);const i=Math.sqrt(1-r.w*r.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=r.x/i,this.y=r.y/i,this.z=r.z/i),this}setAxisAngleFromRotationMatrix(r){let i,m,_,A;const R=r.elements,D=R[0],U=R[4],k=R[8],X=R[1],J=R[5],$=R[9],oe=R[2],ne=R[6],H=R[10];if(Math.abs(U-X)<.01&&Math.abs(k-oe)<.01&&Math.abs($-ne)<.01){if(Math.abs(U+X)<.1&&Math.abs(k+oe)<.1&&Math.abs($+ne)<.1&&Math.abs(D+J+H-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const z=(D+1)/2,ce=(J+1)/2,ue=(H+1)/2,he=(U+X)/4,K=(k+oe)/4,Y=($+ne)/4;return z>ce&&z>ue?z<.01?(m=0,_=.707106781,A=.707106781):(m=Math.sqrt(z),_=he/m,A=K/m):ce>ue?ce<.01?(m=.707106781,_=0,A=.707106781):(_=Math.sqrt(ce),m=he/_,A=Y/_):ue<.01?(m=.707106781,_=.707106781,A=0):(A=Math.sqrt(ue),m=K/A,_=Y/A),this.set(m,_,A,i),this}let V=Math.sqrt((ne-$)*(ne-$)+(k-oe)*(k-oe)+(X-U)*(X-U));return Math.abs(V)<.001&&(V=1),this.x=(ne-$)/V,this.y=(k-oe)/V,this.z=(X-U)/V,this.w=Math.acos((D+J+H-1)/2),this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this.w=Math.min(this.w,r.w),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this.w=Math.max(this.w,r.w),this}clamp(r,i){return this.x=Math.max(r.x,Math.min(i.x,this.x)),this.y=Math.max(r.y,Math.min(i.y,this.y)),this.z=Math.max(r.z,Math.min(i.z,this.z)),this.w=Math.max(r.w,Math.min(i.w,this.w)),this}clampScalar(r,i){return this.x=Math.max(r,Math.min(i,this.x)),this.y=Math.max(r,Math.min(i,this.y)),this.z=Math.max(r,Math.min(i,this.z)),this.w=Math.max(r,Math.min(i,this.w)),this}clampLength(r,i){const m=this.length();return this.divideScalar(m||1).multiplyScalar(Math.max(r,Math.min(i,m)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z+this.w*r.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,i){return this.x+=(r.x-this.x)*i,this.y+=(r.y-this.y)*i,this.z+=(r.z-this.z)*i,this.w+=(r.w-this.w)*i,this}lerpVectors(r,i,m){return this.x=r.x+(i.x-r.x)*m,this.y=r.y+(i.y-r.y)*m,this.z=r.z+(i.z-r.z)*m,this.w=r.w+(i.w-r.w)*m,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z&&r.w===this.w}fromArray(r,i=0){return this.x=r[i],this.y=r[i+1],this.z=r[i+2],this.w=r[i+3],this}toArray(r=[],i=0){return r[i]=this.x,r[i+1]=this.y,r[i+2]=this.z,r[i+3]=this.w,r}fromBufferAttribute(r,i){return this.x=r.getX(i),this.y=r.getY(i),this.z=r.getZ(i),this.w=r.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(r=1,i=1,m={}){super(),this.isRenderTarget=!0,this.width=r,this.height=i,this.depth=1,this.scissor=new Vector4(0,0,r,i),this.scissorTest=!1,this.viewport=new Vector4(0,0,r,i);const _={width:r,height:i,depth:1};m.encoding!==void 0&&(warnOnce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),m.colorSpace=m.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new Texture(_,m.mapping,m.wrapS,m.wrapT,m.magFilter,m.minFilter,m.format,m.type,m.anisotropy,m.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=m.generateMipmaps!==void 0?m.generateMipmaps:!1,this.texture.internalFormat=m.internalFormat!==void 0?m.internalFormat:null,this.texture.minFilter=m.minFilter!==void 0?m.minFilter:LinearFilter,this.depthBuffer=m.depthBuffer!==void 0?m.depthBuffer:!0,this.stencilBuffer=m.stencilBuffer!==void 0?m.stencilBuffer:!1,this.depthTexture=m.depthTexture!==void 0?m.depthTexture:null,this.samples=m.samples!==void 0?m.samples:0}setSize(r,i,m=1){(this.width!==r||this.height!==i||this.depth!==m)&&(this.width=r,this.height=i,this.depth=m,this.texture.image.width=r,this.texture.image.height=i,this.texture.image.depth=m,this.dispose()),this.viewport.set(0,0,r,i),this.scissor.set(0,0,r,i)}clone(){return new this.constructor().copy(this)}copy(r){this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.texture=r.texture.clone(),this.texture.isRenderTargetTexture=!0;const i=Object.assign({},r.texture.image);return this.texture.source=new Source(i),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.samples=r.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(r=1,i=1,m={}){super(r,i,m),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(r=null,i=1,m=1,_=1){super(null),this.isDataArrayTexture=!0,this.image={data:r,width:i,height:m,depth:_},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Data3DTexture extends Texture{constructor(r=null,i=1,m=1,_=1){super(null),this.isData3DTexture=!0,this.image={data:r,width:i,height:m,depth:_},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Quaternion{constructor(r=0,i=0,m=0,_=1){this.isQuaternion=!0,this._x=r,this._y=i,this._z=m,this._w=_}static slerpFlat(r,i,m,_,A,w,T){let R=m[_+0],D=m[_+1],U=m[_+2],k=m[_+3];const X=A[w+0],J=A[w+1],$=A[w+2],oe=A[w+3];if(T===0){r[i+0]=R,r[i+1]=D,r[i+2]=U,r[i+3]=k;return}if(T===1){r[i+0]=X,r[i+1]=J,r[i+2]=$,r[i+3]=oe;return}if(k!==oe||R!==X||D!==J||U!==$){let ne=1-T;const H=R*X+D*J+U*$+k*oe,V=H>=0?1:-1,z=1-H*H;if(z>Number.EPSILON){const ue=Math.sqrt(z),he=Math.atan2(ue,H*V);ne=Math.sin(ne*he)/ue,T=Math.sin(T*he)/ue}const ce=T*V;if(R=R*ne+X*ce,D=D*ne+J*ce,U=U*ne+$*ce,k=k*ne+oe*ce,ne===1-T){const ue=1/Math.sqrt(R*R+D*D+U*U+k*k);R*=ue,D*=ue,U*=ue,k*=ue}}r[i]=R,r[i+1]=D,r[i+2]=U,r[i+3]=k}static multiplyQuaternionsFlat(r,i,m,_,A,w){const T=m[_],R=m[_+1],D=m[_+2],U=m[_+3],k=A[w],X=A[w+1],J=A[w+2],$=A[w+3];return r[i]=T*$+U*k+R*J-D*X,r[i+1]=R*$+U*X+D*k-T*J,r[i+2]=D*$+U*J+T*X-R*k,r[i+3]=U*$-T*k-R*X-D*J,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,i,m,_){return this._x=r,this._y=i,this._z=m,this._w=_,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,i){const m=r._x,_=r._y,A=r._z,w=r._order,T=Math.cos,R=Math.sin,D=T(m/2),U=T(_/2),k=T(A/2),X=R(m/2),J=R(_/2),$=R(A/2);switch(w){case"XYZ":this._x=X*U*k+D*J*$,this._y=D*J*k-X*U*$,this._z=D*U*$+X*J*k,this._w=D*U*k-X*J*$;break;case"YXZ":this._x=X*U*k+D*J*$,this._y=D*J*k-X*U*$,this._z=D*U*$-X*J*k,this._w=D*U*k+X*J*$;break;case"ZXY":this._x=X*U*k-D*J*$,this._y=D*J*k+X*U*$,this._z=D*U*$+X*J*k,this._w=D*U*k-X*J*$;break;case"ZYX":this._x=X*U*k-D*J*$,this._y=D*J*k+X*U*$,this._z=D*U*$-X*J*k,this._w=D*U*k+X*J*$;break;case"YZX":this._x=X*U*k+D*J*$,this._y=D*J*k+X*U*$,this._z=D*U*$-X*J*k,this._w=D*U*k-X*J*$;break;case"XZY":this._x=X*U*k-D*J*$,this._y=D*J*k-X*U*$,this._z=D*U*$+X*J*k,this._w=D*U*k+X*J*$;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+w)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(r,i){const m=i/2,_=Math.sin(m);return this._x=r.x*_,this._y=r.y*_,this._z=r.z*_,this._w=Math.cos(m),this._onChangeCallback(),this}setFromRotationMatrix(r){const i=r.elements,m=i[0],_=i[4],A=i[8],w=i[1],T=i[5],R=i[9],D=i[2],U=i[6],k=i[10],X=m+T+k;if(X>0){const J=.5/Math.sqrt(X+1);this._w=.25/J,this._x=(U-R)*J,this._y=(A-D)*J,this._z=(w-_)*J}else if(m>T&&m>k){const J=2*Math.sqrt(1+m-T-k);this._w=(U-R)/J,this._x=.25*J,this._y=(_+w)/J,this._z=(A+D)/J}else if(T>k){const J=2*Math.sqrt(1+T-m-k);this._w=(A-D)/J,this._x=(_+w)/J,this._y=.25*J,this._z=(R+U)/J}else{const J=2*Math.sqrt(1+k-m-T);this._w=(w-_)/J,this._x=(A+D)/J,this._y=(R+U)/J,this._z=.25*J}return this._onChangeCallback(),this}setFromUnitVectors(r,i){let m=r.dot(i)+1;return m<Number.EPSILON?(m=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=m):(this._x=0,this._y=-r.z,this._z=r.y,this._w=m)):(this._x=r.y*i.z-r.z*i.y,this._y=r.z*i.x-r.x*i.z,this._z=r.x*i.y-r.y*i.x,this._w=m),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(clamp(this.dot(r),-1,1)))}rotateTowards(r,i){const m=this.angleTo(r);if(m===0)return this;const _=Math.min(1,i/m);return this.slerp(r,_),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,i){const m=r._x,_=r._y,A=r._z,w=r._w,T=i._x,R=i._y,D=i._z,U=i._w;return this._x=m*U+w*T+_*D-A*R,this._y=_*U+w*R+A*T-m*D,this._z=A*U+w*D+m*R-_*T,this._w=w*U-m*T-_*R-A*D,this._onChangeCallback(),this}slerp(r,i){if(i===0)return this;if(i===1)return this.copy(r);const m=this._x,_=this._y,A=this._z,w=this._w;let T=w*r._w+m*r._x+_*r._y+A*r._z;if(T<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,T=-T):this.copy(r),T>=1)return this._w=w,this._x=m,this._y=_,this._z=A,this;const R=1-T*T;if(R<=Number.EPSILON){const J=1-i;return this._w=J*w+i*this._w,this._x=J*m+i*this._x,this._y=J*_+i*this._y,this._z=J*A+i*this._z,this.normalize(),this._onChangeCallback(),this}const D=Math.sqrt(R),U=Math.atan2(D,T),k=Math.sin((1-i)*U)/D,X=Math.sin(i*U)/D;return this._w=w*k+this._w*X,this._x=m*k+this._x*X,this._y=_*k+this._y*X,this._z=A*k+this._z*X,this._onChangeCallback(),this}slerpQuaternions(r,i,m){return this.copy(r).slerp(i,m)}random(){const r=Math.random(),i=Math.sqrt(1-r),m=Math.sqrt(r),_=2*Math.PI*Math.random(),A=2*Math.PI*Math.random();return this.set(i*Math.cos(_),m*Math.sin(A),m*Math.cos(A),i*Math.sin(_))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,i=0){return this._x=r[i],this._y=r[i+1],this._z=r[i+2],this._w=r[i+3],this._onChangeCallback(),this}toArray(r=[],i=0){return r[i]=this._x,r[i+1]=this._y,r[i+2]=this._z,r[i+3]=this._w,r}fromBufferAttribute(r,i){return this._x=r.getX(i),this._y=r.getY(i),this._z=r.getZ(i),this._w=r.getW(i),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(r=0,i=0,m=0){Vector3.prototype.isVector3=!0,this.x=r,this.y=i,this.z=m}set(r,i,m){return m===void 0&&(m=this.z),this.x=r,this.y=i,this.z=m,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setComponent(r,i){switch(r){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this}addVectors(r,i){return this.x=r.x+i.x,this.y=r.y+i.y,this.z=r.z+i.z,this}addScaledVector(r,i){return this.x+=r.x*i,this.y+=r.y*i,this.z+=r.z*i,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this}subVectors(r,i){return this.x=r.x-i.x,this.y=r.y-i.y,this.z=r.z-i.z,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this}multiplyVectors(r,i){return this.x=r.x*i.x,this.y=r.y*i.y,this.z=r.z*i.z,this}applyEuler(r){return this.applyQuaternion(_quaternion$4.setFromEuler(r))}applyAxisAngle(r,i){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(r,i))}applyMatrix3(r){const i=this.x,m=this.y,_=this.z,A=r.elements;return this.x=A[0]*i+A[3]*m+A[6]*_,this.y=A[1]*i+A[4]*m+A[7]*_,this.z=A[2]*i+A[5]*m+A[8]*_,this}applyNormalMatrix(r){return this.applyMatrix3(r).normalize()}applyMatrix4(r){const i=this.x,m=this.y,_=this.z,A=r.elements,w=1/(A[3]*i+A[7]*m+A[11]*_+A[15]);return this.x=(A[0]*i+A[4]*m+A[8]*_+A[12])*w,this.y=(A[1]*i+A[5]*m+A[9]*_+A[13])*w,this.z=(A[2]*i+A[6]*m+A[10]*_+A[14])*w,this}applyQuaternion(r){const i=this.x,m=this.y,_=this.z,A=r.x,w=r.y,T=r.z,R=r.w,D=R*i+w*_-T*m,U=R*m+T*i-A*_,k=R*_+A*m-w*i,X=-A*i-w*m-T*_;return this.x=D*R+X*-A+U*-T-k*-w,this.y=U*R+X*-w+k*-A-D*-T,this.z=k*R+X*-T+D*-w-U*-A,this}project(r){return this.applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix)}unproject(r){return this.applyMatrix4(r.projectionMatrixInverse).applyMatrix4(r.matrixWorld)}transformDirection(r){const i=this.x,m=this.y,_=this.z,A=r.elements;return this.x=A[0]*i+A[4]*m+A[8]*_,this.y=A[1]*i+A[5]*m+A[9]*_,this.z=A[2]*i+A[6]*m+A[10]*_,this.normalize()}divide(r){return this.x/=r.x,this.y/=r.y,this.z/=r.z,this}divideScalar(r){return this.multiplyScalar(1/r)}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this}clamp(r,i){return this.x=Math.max(r.x,Math.min(i.x,this.x)),this.y=Math.max(r.y,Math.min(i.y,this.y)),this.z=Math.max(r.z,Math.min(i.z,this.z)),this}clampScalar(r,i){return this.x=Math.max(r,Math.min(i,this.x)),this.y=Math.max(r,Math.min(i,this.y)),this.z=Math.max(r,Math.min(i,this.z)),this}clampLength(r,i){const m=this.length();return this.divideScalar(m||1).multiplyScalar(Math.max(r,Math.min(i,m)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,i){return this.x+=(r.x-this.x)*i,this.y+=(r.y-this.y)*i,this.z+=(r.z-this.z)*i,this}lerpVectors(r,i,m){return this.x=r.x+(i.x-r.x)*m,this.y=r.y+(i.y-r.y)*m,this.z=r.z+(i.z-r.z)*m,this}cross(r){return this.crossVectors(this,r)}crossVectors(r,i){const m=r.x,_=r.y,A=r.z,w=i.x,T=i.y,R=i.z;return this.x=_*R-A*T,this.y=A*w-m*R,this.z=m*T-_*w,this}projectOnVector(r){const i=r.lengthSq();if(i===0)return this.set(0,0,0);const m=r.dot(this)/i;return this.copy(r).multiplyScalar(m)}projectOnPlane(r){return _vector$b.copy(this).projectOnVector(r),this.sub(_vector$b)}reflect(r){return this.sub(_vector$b.copy(r).multiplyScalar(2*this.dot(r)))}angleTo(r){const i=Math.sqrt(this.lengthSq()*r.lengthSq());if(i===0)return Math.PI/2;const m=this.dot(r)/i;return Math.acos(clamp(m,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const i=this.x-r.x,m=this.y-r.y,_=this.z-r.z;return i*i+m*m+_*_}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)+Math.abs(this.z-r.z)}setFromSpherical(r){return this.setFromSphericalCoords(r.radius,r.phi,r.theta)}setFromSphericalCoords(r,i,m){const _=Math.sin(i)*r;return this.x=_*Math.sin(m),this.y=Math.cos(i)*r,this.z=_*Math.cos(m),this}setFromCylindrical(r){return this.setFromCylindricalCoords(r.radius,r.theta,r.y)}setFromCylindricalCoords(r,i,m){return this.x=r*Math.sin(i),this.y=m,this.z=r*Math.cos(i),this}setFromMatrixPosition(r){const i=r.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(r){const i=this.setFromMatrixColumn(r,0).length(),m=this.setFromMatrixColumn(r,1).length(),_=this.setFromMatrixColumn(r,2).length();return this.x=i,this.y=m,this.z=_,this}setFromMatrixColumn(r,i){return this.fromArray(r.elements,i*4)}setFromMatrix3Column(r,i){return this.fromArray(r.elements,i*3)}setFromEuler(r){return this.x=r._x,this.y=r._y,this.z=r._z,this}setFromColor(r){return this.x=r.r,this.y=r.g,this.z=r.b,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z}fromArray(r,i=0){return this.x=r[i],this.y=r[i+1],this.z=r[i+2],this}toArray(r=[],i=0){return r[i]=this.x,r[i+1]=this.y,r[i+2]=this.z,r}fromBufferAttribute(r,i){return this.x=r.getX(i),this.y=r.getY(i),this.z=r.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const r=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,m=Math.sqrt(1-r**2);return this.x=m*Math.cos(i),this.y=m*Math.sin(i),this.z=r,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$b=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(r=new Vector3(1/0,1/0,1/0),i=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=i}set(r,i){return this.min.copy(r),this.max.copy(i),this}setFromArray(r){this.makeEmpty();for(let i=0,m=r.length;i<m;i+=3)this.expandByPoint(_vector$a.fromArray(r,i));return this}setFromBufferAttribute(r){this.makeEmpty();for(let i=0,m=r.count;i<m;i++)this.expandByPoint(_vector$a.fromBufferAttribute(r,i));return this}setFromPoints(r){this.makeEmpty();for(let i=0,m=r.length;i<m;i++)this.expandByPoint(r[i]);return this}setFromCenterAndSize(r,i){const m=_vector$a.copy(i).multiplyScalar(.5);return this.min.copy(r).sub(m),this.max.copy(r).add(m),this}setFromObject(r,i=!1){return this.makeEmpty(),this.expandByObject(r,i)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,i=!1){if(r.updateWorldMatrix(!1,!1),r.boundingBox!==void 0)r.boundingBox===null&&r.computeBoundingBox(),_box$3.copy(r.boundingBox),_box$3.applyMatrix4(r.matrixWorld),this.union(_box$3);else{const _=r.geometry;if(_!==void 0)if(i&&_.attributes!==void 0&&_.attributes.position!==void 0){const A=_.attributes.position;for(let w=0,T=A.count;w<T;w++)_vector$a.fromBufferAttribute(A,w).applyMatrix4(r.matrixWorld),this.expandByPoint(_vector$a)}else _.boundingBox===null&&_.computeBoundingBox(),_box$3.copy(_.boundingBox),_box$3.applyMatrix4(r.matrixWorld),this.union(_box$3)}const m=r.children;for(let _=0,A=m.length;_<A;_++)this.expandByObject(m[_],i);return this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y||r.z<this.min.z||r.z>this.max.z)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,i){return i.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y||r.max.z<this.min.z||r.min.z>this.max.z)}intersectsSphere(r){return this.clampPoint(r.center,_vector$a),_vector$a.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let i,m;return r.normal.x>0?(i=r.normal.x*this.min.x,m=r.normal.x*this.max.x):(i=r.normal.x*this.max.x,m=r.normal.x*this.min.x),r.normal.y>0?(i+=r.normal.y*this.min.y,m+=r.normal.y*this.max.y):(i+=r.normal.y*this.max.y,m+=r.normal.y*this.min.y),r.normal.z>0?(i+=r.normal.z*this.min.z,m+=r.normal.z*this.max.z):(i+=r.normal.z*this.max.z,m+=r.normal.z*this.min.z),i<=-r.constant&&m>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(r.a,_center),_v1$7.subVectors(r.b,_center),_v2$4.subVectors(r.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let i=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(i,_v0$2,_v1$7,_v2$4,_extents)||(i=[1,0,0,0,1,0,0,0,1],!satForAxes(i,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),i=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(i,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(r,i){return i.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,_vector$a).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=this.getSize(_vector$a).length()*.5),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(_points),this)}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$a=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(u,r,i,m,_){for(let A=0,w=u.length-3;A<=w;A+=3){_testAxis.fromArray(u,A);const T=_.x*Math.abs(_testAxis.x)+_.y*Math.abs(_testAxis.y)+_.z*Math.abs(_testAxis.z),R=r.dot(_testAxis),D=i.dot(_testAxis),U=m.dot(_testAxis);if(Math.max(-Math.max(R,D,U),Math.min(R,D,U))>T)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(r=new Vector3,i=-1){this.center=r,this.radius=i}set(r,i){return this.center.copy(r),this.radius=i,this}setFromPoints(r,i){const m=this.center;i!==void 0?m.copy(i):_box$2.setFromPoints(r).getCenter(m);let _=0;for(let A=0,w=r.length;A<w;A++)_=Math.max(_,m.distanceToSquared(r[A]));return this.radius=Math.sqrt(_),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const i=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=i*i}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,i){const m=this.center.distanceToSquared(r);return i.copy(r),m>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;_v1$6.subVectors(r,this.center);const i=_v1$6.lengthSq();if(i>this.radius*this.radius){const m=Math.sqrt(i),_=(m-this.radius)*.5;this.center.addScaledVector(_v1$6,_/m),this.radius+=_}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(_v2$3.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(_v1$6.copy(r.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(r.center).sub(_v2$3))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$9=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(r=new Vector3,i=new Vector3(0,0,-1)){this.origin=r,this.direction=i}set(r,i){return this.origin.copy(r),this.direction.copy(i),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,i){return i.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,_vector$9)),this}closestPointToPoint(r,i){i.subVectors(r,this.origin);const m=i.dot(this.direction);return m<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,m)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const i=_vector$9.subVectors(r,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(r):(_vector$9.copy(this.origin).addScaledVector(this.direction,i),_vector$9.distanceToSquared(r))}distanceSqToSegment(r,i,m,_){_segCenter.copy(r).add(i).multiplyScalar(.5),_segDir.copy(i).sub(r).normalize(),_diff.copy(this.origin).sub(_segCenter);const A=r.distanceTo(i)*.5,w=-this.direction.dot(_segDir),T=_diff.dot(this.direction),R=-_diff.dot(_segDir),D=_diff.lengthSq(),U=Math.abs(1-w*w);let k,X,J,$;if(U>0)if(k=w*R-T,X=w*T-R,$=A*U,k>=0)if(X>=-$)if(X<=$){const oe=1/U;k*=oe,X*=oe,J=k*(k+w*X+2*T)+X*(w*k+X+2*R)+D}else X=A,k=Math.max(0,-(w*X+T)),J=-k*k+X*(X+2*R)+D;else X=-A,k=Math.max(0,-(w*X+T)),J=-k*k+X*(X+2*R)+D;else X<=-$?(k=Math.max(0,-(-w*A+T)),X=k>0?-A:Math.min(Math.max(-A,-R),A),J=-k*k+X*(X+2*R)+D):X<=$?(k=0,X=Math.min(Math.max(-A,-R),A),J=X*(X+2*R)+D):(k=Math.max(0,-(w*A+T)),X=k>0?A:Math.min(Math.max(-A,-R),A),J=-k*k+X*(X+2*R)+D);else X=w>0?-A:A,k=Math.max(0,-(w*X+T)),J=-k*k+X*(X+2*R)+D;return m&&m.copy(this.origin).addScaledVector(this.direction,k),_&&_.copy(_segCenter).addScaledVector(_segDir,X),J}intersectSphere(r,i){_vector$9.subVectors(r.center,this.origin);const m=_vector$9.dot(this.direction),_=_vector$9.dot(_vector$9)-m*m,A=r.radius*r.radius;if(_>A)return null;const w=Math.sqrt(A-_),T=m-w,R=m+w;return R<0?null:T<0?this.at(R,i):this.at(T,i)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const i=r.normal.dot(this.direction);if(i===0)return r.distanceToPoint(this.origin)===0?0:null;const m=-(this.origin.dot(r.normal)+r.constant)/i;return m>=0?m:null}intersectPlane(r,i){const m=this.distanceToPlane(r);return m===null?null:this.at(m,i)}intersectsPlane(r){const i=r.distanceToPoint(this.origin);return i===0||r.normal.dot(this.direction)*i<0}intersectBox(r,i){let m,_,A,w,T,R;const D=1/this.direction.x,U=1/this.direction.y,k=1/this.direction.z,X=this.origin;return D>=0?(m=(r.min.x-X.x)*D,_=(r.max.x-X.x)*D):(m=(r.max.x-X.x)*D,_=(r.min.x-X.x)*D),U>=0?(A=(r.min.y-X.y)*U,w=(r.max.y-X.y)*U):(A=(r.max.y-X.y)*U,w=(r.min.y-X.y)*U),m>w||A>_||((A>m||isNaN(m))&&(m=A),(w<_||isNaN(_))&&(_=w),k>=0?(T=(r.min.z-X.z)*k,R=(r.max.z-X.z)*k):(T=(r.max.z-X.z)*k,R=(r.min.z-X.z)*k),m>R||T>_)||((T>m||m!==m)&&(m=T),(R<_||_!==_)&&(_=R),_<0)?null:this.at(m>=0?m:_,i)}intersectsBox(r){return this.intersectBox(r,_vector$9)!==null}intersectTriangle(r,i,m,_,A){_edge1.subVectors(i,r),_edge2.subVectors(m,r),_normal$1.crossVectors(_edge1,_edge2);let w=this.direction.dot(_normal$1),T;if(w>0){if(_)return null;T=1}else if(w<0)T=-1,w=-w;else return null;_diff.subVectors(this.origin,r);const R=T*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(R<0)return null;const D=T*this.direction.dot(_edge1.cross(_diff));if(D<0||R+D>w)return null;const U=-T*_diff.dot(_normal$1);return U<0?null:this.at(U/w,A)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Matrix4{constructor(r,i,m,_,A,w,T,R,D,U,k,X,J,$,oe,ne){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r!==void 0&&this.set(r,i,m,_,A,w,T,R,D,U,k,X,J,$,oe,ne)}set(r,i,m,_,A,w,T,R,D,U,k,X,J,$,oe,ne){const H=this.elements;return H[0]=r,H[4]=i,H[8]=m,H[12]=_,H[1]=A,H[5]=w,H[9]=T,H[13]=R,H[2]=D,H[6]=U,H[10]=k,H[14]=X,H[3]=J,H[7]=$,H[11]=oe,H[15]=ne,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(r){const i=this.elements,m=r.elements;return i[0]=m[0],i[1]=m[1],i[2]=m[2],i[3]=m[3],i[4]=m[4],i[5]=m[5],i[6]=m[6],i[7]=m[7],i[8]=m[8],i[9]=m[9],i[10]=m[10],i[11]=m[11],i[12]=m[12],i[13]=m[13],i[14]=m[14],i[15]=m[15],this}copyPosition(r){const i=this.elements,m=r.elements;return i[12]=m[12],i[13]=m[13],i[14]=m[14],this}setFromMatrix3(r){const i=r.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(r,i,m){return r.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),m.setFromMatrixColumn(this,2),this}makeBasis(r,i,m){return this.set(r.x,i.x,m.x,0,r.y,i.y,m.y,0,r.z,i.z,m.z,0,0,0,0,1),this}extractRotation(r){const i=this.elements,m=r.elements,_=1/_v1$5.setFromMatrixColumn(r,0).length(),A=1/_v1$5.setFromMatrixColumn(r,1).length(),w=1/_v1$5.setFromMatrixColumn(r,2).length();return i[0]=m[0]*_,i[1]=m[1]*_,i[2]=m[2]*_,i[3]=0,i[4]=m[4]*A,i[5]=m[5]*A,i[6]=m[6]*A,i[7]=0,i[8]=m[8]*w,i[9]=m[9]*w,i[10]=m[10]*w,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(r){const i=this.elements,m=r.x,_=r.y,A=r.z,w=Math.cos(m),T=Math.sin(m),R=Math.cos(_),D=Math.sin(_),U=Math.cos(A),k=Math.sin(A);if(r.order==="XYZ"){const X=w*U,J=w*k,$=T*U,oe=T*k;i[0]=R*U,i[4]=-R*k,i[8]=D,i[1]=J+$*D,i[5]=X-oe*D,i[9]=-T*R,i[2]=oe-X*D,i[6]=$+J*D,i[10]=w*R}else if(r.order==="YXZ"){const X=R*U,J=R*k,$=D*U,oe=D*k;i[0]=X+oe*T,i[4]=$*T-J,i[8]=w*D,i[1]=w*k,i[5]=w*U,i[9]=-T,i[2]=J*T-$,i[6]=oe+X*T,i[10]=w*R}else if(r.order==="ZXY"){const X=R*U,J=R*k,$=D*U,oe=D*k;i[0]=X-oe*T,i[4]=-w*k,i[8]=$+J*T,i[1]=J+$*T,i[5]=w*U,i[9]=oe-X*T,i[2]=-w*D,i[6]=T,i[10]=w*R}else if(r.order==="ZYX"){const X=w*U,J=w*k,$=T*U,oe=T*k;i[0]=R*U,i[4]=$*D-J,i[8]=X*D+oe,i[1]=R*k,i[5]=oe*D+X,i[9]=J*D-$,i[2]=-D,i[6]=T*R,i[10]=w*R}else if(r.order==="YZX"){const X=w*R,J=w*D,$=T*R,oe=T*D;i[0]=R*U,i[4]=oe-X*k,i[8]=$*k+J,i[1]=k,i[5]=w*U,i[9]=-T*U,i[2]=-D*U,i[6]=J*k+$,i[10]=X-oe*k}else if(r.order==="XZY"){const X=w*R,J=w*D,$=T*R,oe=T*D;i[0]=R*U,i[4]=-k,i[8]=D*U,i[1]=X*k+oe,i[5]=w*U,i[9]=J*k-$,i[2]=$*k-J,i[6]=T*U,i[10]=oe*k+X}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(r){return this.compose(_zero,r,_one)}lookAt(r,i,m){const _=this.elements;return _z.subVectors(r,i),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(m,_z),_x.lengthSq()===0&&(Math.abs(m.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(m,_z)),_x.normalize(),_y.crossVectors(_z,_x),_[0]=_x.x,_[4]=_y.x,_[8]=_z.x,_[1]=_x.y,_[5]=_y.y,_[9]=_z.y,_[2]=_x.z,_[6]=_y.z,_[10]=_z.z,this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,i){const m=r.elements,_=i.elements,A=this.elements,w=m[0],T=m[4],R=m[8],D=m[12],U=m[1],k=m[5],X=m[9],J=m[13],$=m[2],oe=m[6],ne=m[10],H=m[14],V=m[3],z=m[7],ce=m[11],ue=m[15],he=_[0],K=_[4],Y=_[8],ie=_[12],ve=_[1],re=_[5],ae=_[9],me=_[13],ye=_[2],Te=_[6],ke=_[10],Fe=_[14],Ve=_[3],ot=_[7],Ye=_[11],Ze=_[15];return A[0]=w*he+T*ve+R*ye+D*Ve,A[4]=w*K+T*re+R*Te+D*ot,A[8]=w*Y+T*ae+R*ke+D*Ye,A[12]=w*ie+T*me+R*Fe+D*Ze,A[1]=U*he+k*ve+X*ye+J*Ve,A[5]=U*K+k*re+X*Te+J*ot,A[9]=U*Y+k*ae+X*ke+J*Ye,A[13]=U*ie+k*me+X*Fe+J*Ze,A[2]=$*he+oe*ve+ne*ye+H*Ve,A[6]=$*K+oe*re+ne*Te+H*ot,A[10]=$*Y+oe*ae+ne*ke+H*Ye,A[14]=$*ie+oe*me+ne*Fe+H*Ze,A[3]=V*he+z*ve+ce*ye+ue*Ve,A[7]=V*K+z*re+ce*Te+ue*ot,A[11]=V*Y+z*ae+ce*ke+ue*Ye,A[15]=V*ie+z*me+ce*Fe+ue*Ze,this}multiplyScalar(r){const i=this.elements;return i[0]*=r,i[4]*=r,i[8]*=r,i[12]*=r,i[1]*=r,i[5]*=r,i[9]*=r,i[13]*=r,i[2]*=r,i[6]*=r,i[10]*=r,i[14]*=r,i[3]*=r,i[7]*=r,i[11]*=r,i[15]*=r,this}determinant(){const r=this.elements,i=r[0],m=r[4],_=r[8],A=r[12],w=r[1],T=r[5],R=r[9],D=r[13],U=r[2],k=r[6],X=r[10],J=r[14],$=r[3],oe=r[7],ne=r[11],H=r[15];return $*(+A*R*k-_*D*k-A*T*X+m*D*X+_*T*J-m*R*J)+oe*(+i*R*J-i*D*X+A*w*X-_*w*J+_*D*U-A*R*U)+ne*(+i*D*k-i*T*J-A*w*k+m*w*J+A*T*U-m*D*U)+H*(-_*T*U-i*R*k+i*T*X+_*w*k-m*w*X+m*R*U)}transpose(){const r=this.elements;let i;return i=r[1],r[1]=r[4],r[4]=i,i=r[2],r[2]=r[8],r[8]=i,i=r[6],r[6]=r[9],r[9]=i,i=r[3],r[3]=r[12],r[12]=i,i=r[7],r[7]=r[13],r[13]=i,i=r[11],r[11]=r[14],r[14]=i,this}setPosition(r,i,m){const _=this.elements;return r.isVector3?(_[12]=r.x,_[13]=r.y,_[14]=r.z):(_[12]=r,_[13]=i,_[14]=m),this}invert(){const r=this.elements,i=r[0],m=r[1],_=r[2],A=r[3],w=r[4],T=r[5],R=r[6],D=r[7],U=r[8],k=r[9],X=r[10],J=r[11],$=r[12],oe=r[13],ne=r[14],H=r[15],V=k*ne*D-oe*X*D+oe*R*J-T*ne*J-k*R*H+T*X*H,z=$*X*D-U*ne*D-$*R*J+w*ne*J+U*R*H-w*X*H,ce=U*oe*D-$*k*D+$*T*J-w*oe*J-U*T*H+w*k*H,ue=$*k*R-U*oe*R-$*T*X+w*oe*X+U*T*ne-w*k*ne,he=i*V+m*z+_*ce+A*ue;if(he===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const K=1/he;return r[0]=V*K,r[1]=(oe*X*A-k*ne*A-oe*_*J+m*ne*J+k*_*H-m*X*H)*K,r[2]=(T*ne*A-oe*R*A+oe*_*D-m*ne*D-T*_*H+m*R*H)*K,r[3]=(k*R*A-T*X*A-k*_*D+m*X*D+T*_*J-m*R*J)*K,r[4]=z*K,r[5]=(U*ne*A-$*X*A+$*_*J-i*ne*J-U*_*H+i*X*H)*K,r[6]=($*R*A-w*ne*A-$*_*D+i*ne*D+w*_*H-i*R*H)*K,r[7]=(w*X*A-U*R*A+U*_*D-i*X*D-w*_*J+i*R*J)*K,r[8]=ce*K,r[9]=($*k*A-U*oe*A-$*m*J+i*oe*J+U*m*H-i*k*H)*K,r[10]=(w*oe*A-$*T*A+$*m*D-i*oe*D-w*m*H+i*T*H)*K,r[11]=(U*T*A-w*k*A-U*m*D+i*k*D+w*m*J-i*T*J)*K,r[12]=ue*K,r[13]=(U*oe*_-$*k*_+$*m*X-i*oe*X-U*m*ne+i*k*ne)*K,r[14]=($*T*_-w*oe*_-$*m*R+i*oe*R+w*m*ne-i*T*ne)*K,r[15]=(w*k*_-U*T*_+U*m*R-i*k*R-w*m*X+i*T*X)*K,this}scale(r){const i=this.elements,m=r.x,_=r.y,A=r.z;return i[0]*=m,i[4]*=_,i[8]*=A,i[1]*=m,i[5]*=_,i[9]*=A,i[2]*=m,i[6]*=_,i[10]*=A,i[3]*=m,i[7]*=_,i[11]*=A,this}getMaxScaleOnAxis(){const r=this.elements,i=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],m=r[4]*r[4]+r[5]*r[5]+r[6]*r[6],_=r[8]*r[8]+r[9]*r[9]+r[10]*r[10];return Math.sqrt(Math.max(i,m,_))}makeTranslation(r,i,m){return r.isVector3?this.set(1,0,0,r.x,0,1,0,r.y,0,0,1,r.z,0,0,0,1):this.set(1,0,0,r,0,1,0,i,0,0,1,m,0,0,0,1),this}makeRotationX(r){const i=Math.cos(r),m=Math.sin(r);return this.set(1,0,0,0,0,i,-m,0,0,m,i,0,0,0,0,1),this}makeRotationY(r){const i=Math.cos(r),m=Math.sin(r);return this.set(i,0,m,0,0,1,0,0,-m,0,i,0,0,0,0,1),this}makeRotationZ(r){const i=Math.cos(r),m=Math.sin(r);return this.set(i,-m,0,0,m,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(r,i){const m=Math.cos(i),_=Math.sin(i),A=1-m,w=r.x,T=r.y,R=r.z,D=A*w,U=A*T;return this.set(D*w+m,D*T-_*R,D*R+_*T,0,D*T+_*R,U*T+m,U*R-_*w,0,D*R-_*T,U*R+_*w,A*R*R+m,0,0,0,0,1),this}makeScale(r,i,m){return this.set(r,0,0,0,0,i,0,0,0,0,m,0,0,0,0,1),this}makeShear(r,i,m,_,A,w){return this.set(1,m,A,0,r,1,w,0,i,_,1,0,0,0,0,1),this}compose(r,i,m){const _=this.elements,A=i._x,w=i._y,T=i._z,R=i._w,D=A+A,U=w+w,k=T+T,X=A*D,J=A*U,$=A*k,oe=w*U,ne=w*k,H=T*k,V=R*D,z=R*U,ce=R*k,ue=m.x,he=m.y,K=m.z;return _[0]=(1-(oe+H))*ue,_[1]=(J+ce)*ue,_[2]=($-z)*ue,_[3]=0,_[4]=(J-ce)*he,_[5]=(1-(X+H))*he,_[6]=(ne+V)*he,_[7]=0,_[8]=($+z)*K,_[9]=(ne-V)*K,_[10]=(1-(X+oe))*K,_[11]=0,_[12]=r.x,_[13]=r.y,_[14]=r.z,_[15]=1,this}decompose(r,i,m){const _=this.elements;let A=_v1$5.set(_[0],_[1],_[2]).length();const w=_v1$5.set(_[4],_[5],_[6]).length(),T=_v1$5.set(_[8],_[9],_[10]).length();this.determinant()<0&&(A=-A),r.x=_[12],r.y=_[13],r.z=_[14],_m1$2.copy(this);const D=1/A,U=1/w,k=1/T;return _m1$2.elements[0]*=D,_m1$2.elements[1]*=D,_m1$2.elements[2]*=D,_m1$2.elements[4]*=U,_m1$2.elements[5]*=U,_m1$2.elements[6]*=U,_m1$2.elements[8]*=k,_m1$2.elements[9]*=k,_m1$2.elements[10]*=k,i.setFromRotationMatrix(_m1$2),m.x=A,m.y=w,m.z=T,this}makePerspective(r,i,m,_,A,w,T=WebGLCoordinateSystem){const R=this.elements,D=2*A/(i-r),U=2*A/(m-_),k=(i+r)/(i-r),X=(m+_)/(m-_);let J,$;if(T===WebGLCoordinateSystem)J=-(w+A)/(w-A),$=-2*w*A/(w-A);else if(T===WebGPUCoordinateSystem)J=-w/(w-A),$=-w*A/(w-A);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+T);return R[0]=D,R[4]=0,R[8]=k,R[12]=0,R[1]=0,R[5]=U,R[9]=X,R[13]=0,R[2]=0,R[6]=0,R[10]=J,R[14]=$,R[3]=0,R[7]=0,R[11]=-1,R[15]=0,this}makeOrthographic(r,i,m,_,A,w,T=WebGLCoordinateSystem){const R=this.elements,D=1/(i-r),U=1/(m-_),k=1/(w-A),X=(i+r)*D,J=(m+_)*U;let $,oe;if(T===WebGLCoordinateSystem)$=(w+A)*k,oe=-2*k;else if(T===WebGPUCoordinateSystem)$=A*k,oe=-1*k;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+T);return R[0]=2*D,R[4]=0,R[8]=0,R[12]=-X,R[1]=0,R[5]=2*U,R[9]=0,R[13]=-J,R[2]=0,R[6]=0,R[10]=oe,R[14]=-$,R[3]=0,R[7]=0,R[11]=0,R[15]=1,this}equals(r){const i=this.elements,m=r.elements;for(let _=0;_<16;_++)if(i[_]!==m[_])return!1;return!0}fromArray(r,i=0){for(let m=0;m<16;m++)this.elements[m]=r[m+i];return this}toArray(r=[],i=0){const m=this.elements;return r[i]=m[0],r[i+1]=m[1],r[i+2]=m[2],r[i+3]=m[3],r[i+4]=m[4],r[i+5]=m[5],r[i+6]=m[6],r[i+7]=m[7],r[i+8]=m[8],r[i+9]=m[9],r[i+10]=m[10],r[i+11]=m[11],r[i+12]=m[12],r[i+13]=m[13],r[i+14]=m[14],r[i+15]=m[15],r}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(r=0,i=0,m=0,_=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=r,this._y=i,this._z=m,this._order=_}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get order(){return this._order}set order(r){this._order=r,this._onChangeCallback()}set(r,i,m,_=this._order){return this._x=r,this._y=i,this._z=m,this._order=_,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(r){return this._x=r._x,this._y=r._y,this._z=r._z,this._order=r._order,this._onChangeCallback(),this}setFromRotationMatrix(r,i=this._order,m=!0){const _=r.elements,A=_[0],w=_[4],T=_[8],R=_[1],D=_[5],U=_[9],k=_[2],X=_[6],J=_[10];switch(i){case"XYZ":this._y=Math.asin(clamp(T,-1,1)),Math.abs(T)<.9999999?(this._x=Math.atan2(-U,J),this._z=Math.atan2(-w,A)):(this._x=Math.atan2(X,D),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(U,-1,1)),Math.abs(U)<.9999999?(this._y=Math.atan2(T,J),this._z=Math.atan2(R,D)):(this._y=Math.atan2(-k,A),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(X,-1,1)),Math.abs(X)<.9999999?(this._y=Math.atan2(-k,J),this._z=Math.atan2(-w,D)):(this._y=0,this._z=Math.atan2(R,A));break;case"ZYX":this._y=Math.asin(-clamp(k,-1,1)),Math.abs(k)<.9999999?(this._x=Math.atan2(X,J),this._z=Math.atan2(R,A)):(this._x=0,this._z=Math.atan2(-w,D));break;case"YZX":this._z=Math.asin(clamp(R,-1,1)),Math.abs(R)<.9999999?(this._x=Math.atan2(-U,D),this._y=Math.atan2(-k,A)):(this._x=0,this._y=Math.atan2(T,J));break;case"XZY":this._z=Math.asin(-clamp(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(X,D),this._y=Math.atan2(T,A)):(this._x=Math.atan2(-U,J),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,m===!0&&this._onChangeCallback(),this}setFromQuaternion(r,i,m){return _matrix.makeRotationFromQuaternion(r),this.setFromRotationMatrix(_matrix,i,m)}setFromVector3(r,i=this._order){return this.set(r.x,r.y,r.z,i)}reorder(r){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,r)}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._order===this._order}fromArray(r){return this._x=r[0],this._y=r[1],this._z=r[2],r[3]!==void 0&&(this._order=r[3]),this._onChangeCallback(),this}toArray(r=[],i=0){return r[i]=this._x,r[i+1]=this._y,r[i+2]=this._z,r[i+3]=this._order,r}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!==0}isEnabled(r){return(this.mask&(1<<r|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const r=new Vector3,i=new Euler,m=new Quaternion,_=new Vector3(1,1,1);function A(){m.setFromEuler(i,!1)}function w(){i.setFromQuaternion(m,void 0,!1)}i._onChange(A),m._onChange(w),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:m},scale:{configurable:!0,enumerable:!0,value:_},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(r){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(r),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(r){return this.quaternion.premultiply(r),this}setRotationFromAxisAngle(r,i){this.quaternion.setFromAxisAngle(r,i)}setRotationFromEuler(r){this.quaternion.setFromEuler(r,!0)}setRotationFromMatrix(r){this.quaternion.setFromRotationMatrix(r)}setRotationFromQuaternion(r){this.quaternion.copy(r)}rotateOnAxis(r,i){return _q1.setFromAxisAngle(r,i),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(r,i){return _q1.setFromAxisAngle(r,i),this.quaternion.premultiply(_q1),this}rotateX(r){return this.rotateOnAxis(_xAxis,r)}rotateY(r){return this.rotateOnAxis(_yAxis,r)}rotateZ(r){return this.rotateOnAxis(_zAxis,r)}translateOnAxis(r,i){return _v1$4.copy(r).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(i)),this}translateX(r){return this.translateOnAxis(_xAxis,r)}translateY(r){return this.translateOnAxis(_yAxis,r)}translateZ(r){return this.translateOnAxis(_zAxis,r)}localToWorld(r){return this.updateWorldMatrix(!0,!1),r.applyMatrix4(this.matrixWorld)}worldToLocal(r){return this.updateWorldMatrix(!0,!1),r.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(r,i,m){r.isVector3?_target.copy(r):_target.set(r,i,m);const _=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),_&&(_m1$1.extractRotation(_.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(r){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return r===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",r),this):(r&&r.isObject3D?(r.parent!==null&&r.parent.remove(r),r.parent=this,this.children.push(r),r.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",r),this)}remove(r){if(arguments.length>1){for(let m=0;m<arguments.length;m++)this.remove(arguments[m]);return this}const i=this.children.indexOf(r);return i!==-1&&(r.parent=null,this.children.splice(i,1),r.dispatchEvent(_removedEvent)),this}removeFromParent(){const r=this.parent;return r!==null&&r.remove(this),this}clear(){return this.remove(...this.children)}attach(r){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),r.parent!==null&&(r.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(r.parent.matrixWorld)),r.applyMatrix4(_m1$1),this.add(r),r.updateWorldMatrix(!1,!0),this}getObjectById(r){return this.getObjectByProperty("id",r)}getObjectByName(r){return this.getObjectByProperty("name",r)}getObjectByProperty(r,i){if(this[r]===i)return this;for(let m=0,_=this.children.length;m<_;m++){const w=this.children[m].getObjectByProperty(r,i);if(w!==void 0)return w}}getObjectsByProperty(r,i){let m=[];this[r]===i&&m.push(this);for(let _=0,A=this.children.length;_<A;_++){const w=this.children[_].getObjectsByProperty(r,i);w.length>0&&(m=m.concat(w))}return m}getWorldPosition(r){return this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,r,_scale$2),r}getWorldScale(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,r),r}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return r.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(r){r(this);const i=this.children;for(let m=0,_=i.length;m<_;m++)i[m].traverse(r)}traverseVisible(r){if(this.visible===!1)return;r(this);const i=this.children;for(let m=0,_=i.length;m<_;m++)i[m].traverseVisible(r)}traverseAncestors(r){const i=this.parent;i!==null&&(r(i),i.traverseAncestors(r))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,r=!0);const i=this.children;for(let m=0,_=i.length;m<_;m++){const A=i[m];(A.matrixWorldAutoUpdate===!0||r===!0)&&A.updateMatrixWorld(r)}}updateWorldMatrix(r,i){const m=this.parent;if(r===!0&&m!==null&&m.matrixWorldAutoUpdate===!0&&m.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const _=this.children;for(let A=0,w=_.length;A<w;A++){const T=_[A];T.matrixWorldAutoUpdate===!0&&T.updateWorldMatrix(!1,!0)}}}toJSON(r){const i=r===void 0||typeof r=="string",m={};i&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},m.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const _={};_.uuid=this.uuid,_.type=this.type,this.name!==""&&(_.name=this.name),this.castShadow===!0&&(_.castShadow=!0),this.receiveShadow===!0&&(_.receiveShadow=!0),this.visible===!1&&(_.visible=!1),this.frustumCulled===!1&&(_.frustumCulled=!1),this.renderOrder!==0&&(_.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(_.userData=this.userData),_.layers=this.layers.mask,_.matrix=this.matrix.toArray(),_.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(_.matrixAutoUpdate=!1),this.isInstancedMesh&&(_.type="InstancedMesh",_.count=this.count,_.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(_.instanceColor=this.instanceColor.toJSON()));function A(T,R){return T[R.uuid]===void 0&&(T[R.uuid]=R.toJSON(r)),R.uuid}if(this.isScene)this.background&&(this.background.isColor?_.background=this.background.toJSON():this.background.isTexture&&(_.background=this.background.toJSON(r).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(_.environment=this.environment.toJSON(r).uuid);else if(this.isMesh||this.isLine||this.isPoints){_.geometry=A(r.geometries,this.geometry);const T=this.geometry.parameters;if(T!==void 0&&T.shapes!==void 0){const R=T.shapes;if(Array.isArray(R))for(let D=0,U=R.length;D<U;D++){const k=R[D];A(r.shapes,k)}else A(r.shapes,R)}}if(this.isSkinnedMesh&&(_.bindMode=this.bindMode,_.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(A(r.skeletons,this.skeleton),_.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const T=[];for(let R=0,D=this.material.length;R<D;R++)T.push(A(r.materials,this.material[R]));_.material=T}else _.material=A(r.materials,this.material);if(this.children.length>0){_.children=[];for(let T=0;T<this.children.length;T++)_.children.push(this.children[T].toJSON(r).object)}if(this.animations.length>0){_.animations=[];for(let T=0;T<this.animations.length;T++){const R=this.animations[T];_.animations.push(A(r.animations,R))}}if(i){const T=w(r.geometries),R=w(r.materials),D=w(r.textures),U=w(r.images),k=w(r.shapes),X=w(r.skeletons),J=w(r.animations),$=w(r.nodes);T.length>0&&(m.geometries=T),R.length>0&&(m.materials=R),D.length>0&&(m.textures=D),U.length>0&&(m.images=U),k.length>0&&(m.shapes=k),X.length>0&&(m.skeletons=X),J.length>0&&(m.animations=J),$.length>0&&(m.nodes=$)}return m.object=_,m;function w(T){const R=[];for(const D in T){const U=T[D];delete U.metadata,R.push(U)}return R}}clone(r){return new this.constructor().copy(this,r)}copy(r,i=!0){if(this.name=r.name,this.up.copy(r.up),this.position.copy(r.position),this.rotation.order=r.rotation.order,this.quaternion.copy(r.quaternion),this.scale.copy(r.scale),this.matrix.copy(r.matrix),this.matrixWorld.copy(r.matrixWorld),this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrixWorldNeedsUpdate=r.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=r.matrixWorldAutoUpdate,this.layers.mask=r.layers.mask,this.visible=r.visible,this.castShadow=r.castShadow,this.receiveShadow=r.receiveShadow,this.frustumCulled=r.frustumCulled,this.renderOrder=r.renderOrder,this.animations=r.animations.slice(),this.userData=JSON.parse(JSON.stringify(r.userData)),i===!0)for(let m=0;m<r.children.length;m++){const _=r.children[m];this.add(_.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let warnedGetUV=!1;class Triangle{constructor(r=new Vector3,i=new Vector3,m=new Vector3){this.a=r,this.b=i,this.c=m}static getNormal(r,i,m,_){_.subVectors(m,i),_v0$1.subVectors(r,i),_.cross(_v0$1);const A=_.lengthSq();return A>0?_.multiplyScalar(1/Math.sqrt(A)):_.set(0,0,0)}static getBarycoord(r,i,m,_,A){_v0$1.subVectors(_,i),_v1$3.subVectors(m,i),_v2$2.subVectors(r,i);const w=_v0$1.dot(_v0$1),T=_v0$1.dot(_v1$3),R=_v0$1.dot(_v2$2),D=_v1$3.dot(_v1$3),U=_v1$3.dot(_v2$2),k=w*D-T*T;if(k===0)return A.set(-2,-1,-1);const X=1/k,J=(D*R-T*U)*X,$=(w*U-T*R)*X;return A.set(1-J-$,$,J)}static containsPoint(r,i,m,_){return this.getBarycoord(r,i,m,_,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(r,i,m,_,A,w,T,R){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),this.getInterpolation(r,i,m,_,A,w,T,R)}static getInterpolation(r,i,m,_,A,w,T,R){return this.getBarycoord(r,i,m,_,_v3$1),R.setScalar(0),R.addScaledVector(A,_v3$1.x),R.addScaledVector(w,_v3$1.y),R.addScaledVector(T,_v3$1.z),R}static isFrontFacing(r,i,m,_){return _v0$1.subVectors(m,i),_v1$3.subVectors(r,i),_v0$1.cross(_v1$3).dot(_)<0}set(r,i,m){return this.a.copy(r),this.b.copy(i),this.c.copy(m),this}setFromPointsAndIndices(r,i,m,_){return this.a.copy(r[i]),this.b.copy(r[m]),this.c.copy(r[_]),this}setFromAttributeAndIndices(r,i,m,_){return this.a.fromBufferAttribute(r,i),this.b.fromBufferAttribute(r,m),this.c.fromBufferAttribute(r,_),this}clone(){return new this.constructor().copy(this)}copy(r){return this.a.copy(r.a),this.b.copy(r.b),this.c.copy(r.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(r){return r.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(r){return Triangle.getNormal(this.a,this.b,this.c,r)}getPlane(r){return r.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(r,i){return Triangle.getBarycoord(r,this.a,this.b,this.c,i)}getUV(r,i,m,_,A){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),Triangle.getInterpolation(r,this.a,this.b,this.c,i,m,_,A)}getInterpolation(r,i,m,_,A){return Triangle.getInterpolation(r,this.a,this.b,this.c,i,m,_,A)}containsPoint(r){return Triangle.containsPoint(r,this.a,this.b,this.c)}isFrontFacing(r){return Triangle.isFrontFacing(this.a,this.b,this.c,r)}intersectsBox(r){return r.intersectsTriangle(this)}closestPointToPoint(r,i){const m=this.a,_=this.b,A=this.c;let w,T;_vab.subVectors(_,m),_vac.subVectors(A,m),_vap.subVectors(r,m);const R=_vab.dot(_vap),D=_vac.dot(_vap);if(R<=0&&D<=0)return i.copy(m);_vbp.subVectors(r,_);const U=_vab.dot(_vbp),k=_vac.dot(_vbp);if(U>=0&&k<=U)return i.copy(_);const X=R*k-U*D;if(X<=0&&R>=0&&U<=0)return w=R/(R-U),i.copy(m).addScaledVector(_vab,w);_vcp.subVectors(r,A);const J=_vab.dot(_vcp),$=_vac.dot(_vcp);if($>=0&&J<=$)return i.copy(A);const oe=J*D-R*$;if(oe<=0&&D>=0&&$<=0)return T=D/(D-$),i.copy(m).addScaledVector(_vac,T);const ne=U*$-J*k;if(ne<=0&&k-U>=0&&J-$>=0)return _vbc.subVectors(A,_),T=(k-U)/(k-U+(J-$)),i.copy(_).addScaledVector(_vbc,T);const H=1/(ne+oe+X);return w=oe*H,T=X*H,i.copy(m).addScaledVector(_vab,w).addScaledVector(_vac,T)}equals(r){return r.a.equals(this.a)&&r.b.equals(this.b)&&r.c.equals(this.c)}}let _materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const i in r){const m=r[i];if(m===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const _=this[i];if(_===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}_&&_.isColor?_.set(m):_&&_.isVector3&&m&&m.isVector3?_.copy(m):this[i]=m}}toJSON(r){const i=r===void 0||typeof r=="string";i&&(r={textures:{},images:{}});const m={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};m.uuid=this.uuid,m.type=this.type,this.name!==""&&(m.name=this.name),this.color&&this.color.isColor&&(m.color=this.color.getHex()),this.roughness!==void 0&&(m.roughness=this.roughness),this.metalness!==void 0&&(m.metalness=this.metalness),this.sheen!==void 0&&(m.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(m.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(m.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(m.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(m.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(m.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(m.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(m.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(m.shininess=this.shininess),this.clearcoat!==void 0&&(m.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(m.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(m.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(m.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(m.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,m.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(m.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(m.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(m.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(m.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(m.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.anisotropy!==void 0&&(m.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(m.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(m.anisotropyMap=this.anisotropyMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(m.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(m.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(m.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(m.lightMap=this.lightMap.toJSON(r).uuid,m.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(m.aoMap=this.aoMap.toJSON(r).uuid,m.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(m.bumpMap=this.bumpMap.toJSON(r).uuid,m.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(m.normalMap=this.normalMap.toJSON(r).uuid,m.normalMapType=this.normalMapType,m.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(m.displacementMap=this.displacementMap.toJSON(r).uuid,m.displacementScale=this.displacementScale,m.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(m.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(m.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(m.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(m.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(m.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(m.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(m.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(m.combine=this.combine)),this.envMapIntensity!==void 0&&(m.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(m.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(m.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(m.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(m.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(m.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(m.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(m.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(m.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(m.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(m.size=this.size),this.shadowSide!==null&&(m.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(m.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(m.blending=this.blending),this.side!==FrontSide&&(m.side=this.side),this.vertexColors&&(m.vertexColors=!0),this.opacity<1&&(m.opacity=this.opacity),this.transparent===!0&&(m.transparent=this.transparent),m.depthFunc=this.depthFunc,m.depthTest=this.depthTest,m.depthWrite=this.depthWrite,m.colorWrite=this.colorWrite,m.stencilWrite=this.stencilWrite,m.stencilWriteMask=this.stencilWriteMask,m.stencilFunc=this.stencilFunc,m.stencilRef=this.stencilRef,m.stencilFuncMask=this.stencilFuncMask,m.stencilFail=this.stencilFail,m.stencilZFail=this.stencilZFail,m.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(m.rotation=this.rotation),this.polygonOffset===!0&&(m.polygonOffset=!0),this.polygonOffsetFactor!==0&&(m.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(m.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(m.linewidth=this.linewidth),this.dashSize!==void 0&&(m.dashSize=this.dashSize),this.gapSize!==void 0&&(m.gapSize=this.gapSize),this.scale!==void 0&&(m.scale=this.scale),this.dithering===!0&&(m.dithering=!0),this.alphaTest>0&&(m.alphaTest=this.alphaTest),this.alphaHash===!0&&(m.alphaHash=this.alphaHash),this.alphaToCoverage===!0&&(m.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(m.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(m.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(m.wireframe=this.wireframe),this.wireframeLinewidth>1&&(m.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(m.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(m.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(m.flatShading=this.flatShading),this.visible===!1&&(m.visible=!1),this.toneMapped===!1&&(m.toneMapped=!1),this.fog===!1&&(m.fog=!1),Object.keys(this.userData).length>0&&(m.userData=this.userData);function _(A){const w=[];for(const T in A){const R=A[T];delete R.metadata,w.push(R)}return w}if(i){const A=_(r.textures),w=_(r.images);A.length>0&&(m.textures=A),w.length>0&&(m.images=w)}return m}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const i=r.clippingPlanes;let m=null;if(i!==null){const _=i.length;m=new Array(_);for(let A=0;A!==_;++A)m[A]=i[A].clone()}return this.clippingPlanes=m,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaHash=r.alphaHash,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=JSON.parse(JSON.stringify(r.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(u,r,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?u+(r-u)*6*i:i<1/2?r:i<2/3?u+(r-u)*6*(2/3-i):u}class Color{constructor(r,i,m){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(r,i,m)}set(r,i,m){if(i===void 0&&m===void 0){const _=r;_&&_.isColor?this.copy(_):typeof _=="number"?this.setHex(_):typeof _=="string"&&this.setStyle(_)}else this.setRGB(r,i,m);return this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,i=SRGBColorSpace){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(r&255)/255,ColorManagement.toWorkingColorSpace(this,i),this}setRGB(r,i,m,_=ColorManagement.workingColorSpace){return this.r=r,this.g=i,this.b=m,ColorManagement.toWorkingColorSpace(this,_),this}setHSL(r,i,m,_=ColorManagement.workingColorSpace){if(r=euclideanModulo(r,1),i=clamp(i,0,1),m=clamp(m,0,1),i===0)this.r=this.g=this.b=m;else{const A=m<=.5?m*(1+i):m+i-m*i,w=2*m-A;this.r=hue2rgb(w,A,r+1/3),this.g=hue2rgb(w,A,r),this.b=hue2rgb(w,A,r-1/3)}return ColorManagement.toWorkingColorSpace(this,_),this}setStyle(r,i=SRGBColorSpace){function m(A){A!==void 0&&parseFloat(A)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let _;if(_=/^(\w+)\(([^\)]*)\)/.exec(r)){let A;const w=_[1],T=_[2];switch(w){case"rgb":case"rgba":if(A=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(T))return m(A[4]),this.setRGB(Math.min(255,parseInt(A[1],10))/255,Math.min(255,parseInt(A[2],10))/255,Math.min(255,parseInt(A[3],10))/255,i);if(A=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(T))return m(A[4]),this.setRGB(Math.min(100,parseInt(A[1],10))/100,Math.min(100,parseInt(A[2],10))/100,Math.min(100,parseInt(A[3],10))/100,i);break;case"hsl":case"hsla":if(A=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(T))return m(A[4]),this.setHSL(parseFloat(A[1])/360,parseFloat(A[2])/100,parseFloat(A[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(_=/^\#([A-Fa-f\d]+)$/.exec(r)){const A=_[1],w=A.length;if(w===3)return this.setRGB(parseInt(A.charAt(0),16)/15,parseInt(A.charAt(1),16)/15,parseInt(A.charAt(2),16)/15,i);if(w===6)return this.setHex(parseInt(A,16),i);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,i);return this}setColorName(r,i=SRGBColorSpace){const m=_colorKeywords[r.toLowerCase()];return m!==void 0?this.setHex(m,i):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=SRGBToLinear(r.r),this.g=SRGBToLinear(r.g),this.b=SRGBToLinear(r.b),this}copyLinearToSRGB(r){return this.r=LinearToSRGB(r.r),this.g=LinearToSRGB(r.g),this.b=LinearToSRGB(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),r),Math.round(clamp(_color.r*255,0,255))*65536+Math.round(clamp(_color.g*255,0,255))*256+Math.round(clamp(_color.b*255,0,255))}getHexString(r=SRGBColorSpace){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,i=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),i);const m=_color.r,_=_color.g,A=_color.b,w=Math.max(m,_,A),T=Math.min(m,_,A);let R,D;const U=(T+w)/2;if(T===w)R=0,D=0;else{const k=w-T;switch(D=U<=.5?k/(w+T):k/(2-w-T),w){case m:R=(_-A)/k+(_<A?6:0);break;case _:R=(A-m)/k+2;break;case A:R=(m-_)/k+4;break}R/=6}return r.h=R,r.s=D,r.l=U,r}getRGB(r,i=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),i),r.r=_color.r,r.g=_color.g,r.b=_color.b,r}getStyle(r=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),r);const i=_color.r,m=_color.g,_=_color.b;return r!==SRGBColorSpace?`color(${r} ${i.toFixed(3)} ${m.toFixed(3)} ${_.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(m*255)},${Math.round(_*255)})`}offsetHSL(r,i,m){return this.getHSL(_hslA),_hslA.h+=r,_hslA.s+=i,_hslA.l+=m,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,i){return this.r=r.r+i.r,this.g=r.g+i.g,this.b=r.b+i.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,i){return this.r+=(r.r-this.r)*i,this.g+=(r.g-this.g)*i,this.b+=(r.b-this.b)*i,this}lerpColors(r,i,m){return this.r=r.r+(i.r-r.r)*m,this.g=r.g+(i.g-r.g)*m,this.b=r.b+(i.b-r.b)*m,this}lerpHSL(r,i){this.getHSL(_hslA),r.getHSL(_hslB);const m=lerp(_hslA.h,_hslB.h,i),_=lerp(_hslA.s,_hslB.s,i),A=lerp(_hslA.l,_hslB.l,i);return this.setHSL(m,_,A),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const i=this.r,m=this.g,_=this.b,A=r.elements;return this.r=A[0]*i+A[3]*m+A[6]*_,this.g=A[1]*i+A[4]*m+A[7]*_,this.b=A[2]*i+A[5]*m+A[8]*_,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,i=0){return this.r=r[i],this.g=r[i+1],this.b=r[i+2],this}toArray(r=[],i=0){return r[i]=this.r,r[i+1]=this.g,r[i+2]=this.b,r}fromBufferAttribute(r,i){return this.r=r.getX(i),this.g=r.getY(i),this.b=r.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;class MeshBasicMaterial extends Material{constructor(r){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}}const _tables=_generateTables();function _generateTables(){const u=new ArrayBuffer(4),r=new Float32Array(u),i=new Uint32Array(u),m=new Uint32Array(512),_=new Uint32Array(512);for(let R=0;R<256;++R){const D=R-127;D<-27?(m[R]=0,m[R|256]=32768,_[R]=24,_[R|256]=24):D<-14?(m[R]=1024>>-D-14,m[R|256]=1024>>-D-14|32768,_[R]=-D-1,_[R|256]=-D-1):D<=15?(m[R]=D+15<<10,m[R|256]=D+15<<10|32768,_[R]=13,_[R|256]=13):D<128?(m[R]=31744,m[R|256]=64512,_[R]=24,_[R|256]=24):(m[R]=31744,m[R|256]=64512,_[R]=13,_[R|256]=13)}const A=new Uint32Array(2048),w=new Uint32Array(64),T=new Uint32Array(64);for(let R=1;R<1024;++R){let D=R<<13,U=0;for(;!(D&8388608);)D<<=1,U-=8388608;D&=-8388609,U+=947912704,A[R]=D|U}for(let R=1024;R<2048;++R)A[R]=939524096+(R-1024<<13);for(let R=1;R<31;++R)w[R]=R<<23;w[31]=1199570944,w[32]=2147483648;for(let R=33;R<63;++R)w[R]=2147483648+(R-32<<23);w[63]=3347054592;for(let R=1;R<64;++R)R!==32&&(T[R]=1024);return{floatView:r,uint32View:i,baseTable:m,shiftTable:_,mantissaTable:A,exponentTable:w,offsetTable:T}}function toHalfFloat(u){Math.abs(u)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),u=clamp(u,-65504,65504),_tables.floatView[0]=u;const r=_tables.uint32View[0],i=r>>23&511;return _tables.baseTable[i]+((r&8388607)>>_tables.shiftTable[i])}function fromHalfFloat(u){const r=u>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[r]+(u&1023)]+_tables.exponentTable[r],_tables.floatView[0]}const DataUtils={toHalfFloat,fromHalfFloat},_vector$8=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(r,i,m=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=i,this.count=r!==void 0?r.length/i:0,this.normalized=m,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this.gpuType=r.gpuType,this}copyAt(r,i,m){r*=this.itemSize,m*=i.itemSize;for(let _=0,A=this.itemSize;_<A;_++)this.array[r+_]=i.array[m+_];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let i=0,m=this.count;i<m;i++)_vector2$1.fromBufferAttribute(this,i),_vector2$1.applyMatrix3(r),this.setXY(i,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let i=0,m=this.count;i<m;i++)_vector$8.fromBufferAttribute(this,i),_vector$8.applyMatrix3(r),this.setXYZ(i,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyMatrix4(r){for(let i=0,m=this.count;i<m;i++)_vector$8.fromBufferAttribute(this,i),_vector$8.applyMatrix4(r),this.setXYZ(i,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyNormalMatrix(r){for(let i=0,m=this.count;i<m;i++)_vector$8.fromBufferAttribute(this,i),_vector$8.applyNormalMatrix(r),this.setXYZ(i,_vector$8.x,_vector$8.y,_vector$8.z);return this}transformDirection(r){for(let i=0,m=this.count;i<m;i++)_vector$8.fromBufferAttribute(this,i),_vector$8.transformDirection(r),this.setXYZ(i,_vector$8.x,_vector$8.y,_vector$8.z);return this}set(r,i=0){return this.array.set(r,i),this}getComponent(r,i){let m=this.array[r*this.itemSize+i];return this.normalized&&(m=denormalize(m,this.array)),m}setComponent(r,i,m){return this.normalized&&(m=normalize(m,this.array)),this.array[r*this.itemSize+i]=m,this}getX(r){let i=this.array[r*this.itemSize];return this.normalized&&(i=denormalize(i,this.array)),i}setX(r,i){return this.normalized&&(i=normalize(i,this.array)),this.array[r*this.itemSize]=i,this}getY(r){let i=this.array[r*this.itemSize+1];return this.normalized&&(i=denormalize(i,this.array)),i}setY(r,i){return this.normalized&&(i=normalize(i,this.array)),this.array[r*this.itemSize+1]=i,this}getZ(r){let i=this.array[r*this.itemSize+2];return this.normalized&&(i=denormalize(i,this.array)),i}setZ(r,i){return this.normalized&&(i=normalize(i,this.array)),this.array[r*this.itemSize+2]=i,this}getW(r){let i=this.array[r*this.itemSize+3];return this.normalized&&(i=denormalize(i,this.array)),i}setW(r,i){return this.normalized&&(i=normalize(i,this.array)),this.array[r*this.itemSize+3]=i,this}setXY(r,i,m){return r*=this.itemSize,this.normalized&&(i=normalize(i,this.array),m=normalize(m,this.array)),this.array[r+0]=i,this.array[r+1]=m,this}setXYZ(r,i,m,_){return r*=this.itemSize,this.normalized&&(i=normalize(i,this.array),m=normalize(m,this.array),_=normalize(_,this.array)),this.array[r+0]=i,this.array[r+1]=m,this.array[r+2]=_,this}setXYZW(r,i,m,_,A){return r*=this.itemSize,this.normalized&&(i=normalize(i,this.array),m=normalize(m,this.array),_=normalize(_,this.array),A=normalize(A,this.array)),this.array[r+0]=i,this.array[r+1]=m,this.array[r+2]=_,this.array[r+3]=A,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==StaticDrawUsage&&(r.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(r.updateRange=this.updateRange),r}}class Uint16BufferAttribute extends BufferAttribute{constructor(r,i,m){super(new Uint16Array(r),i,m)}}class Uint32BufferAttribute extends BufferAttribute{constructor(r,i,m){super(new Uint32Array(r),i,m)}}class Float32BufferAttribute extends BufferAttribute{constructor(r,i,m){super(new Float32Array(r),i,m)}}let _id$2=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$7=new Vector3;let BufferGeometry$1=class uI extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(r){return Array.isArray(r)?this.index=new(arrayNeedsUint32(r)?Uint32BufferAttribute:Uint16BufferAttribute)(r,1):this.index=r,this}getAttribute(r){return this.attributes[r]}setAttribute(r,i){return this.attributes[r]=i,this}deleteAttribute(r){return delete this.attributes[r],this}hasAttribute(r){return this.attributes[r]!==void 0}addGroup(r,i,m=0){this.groups.push({start:r,count:i,materialIndex:m})}clearGroups(){this.groups=[]}setDrawRange(r,i){this.drawRange.start=r,this.drawRange.count=i}applyMatrix4(r){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(r),i.needsUpdate=!0);const m=this.attributes.normal;if(m!==void 0){const A=new Matrix3().getNormalMatrix(r);m.applyNormalMatrix(A),m.needsUpdate=!0}const _=this.attributes.tangent;return _!==void 0&&(_.transformDirection(r),_.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(r){return _m1.makeRotationFromQuaternion(r),this.applyMatrix4(_m1),this}rotateX(r){return _m1.makeRotationX(r),this.applyMatrix4(_m1),this}rotateY(r){return _m1.makeRotationY(r),this.applyMatrix4(_m1),this}rotateZ(r){return _m1.makeRotationZ(r),this.applyMatrix4(_m1),this}translate(r,i,m){return _m1.makeTranslation(r,i,m),this.applyMatrix4(_m1),this}scale(r,i,m){return _m1.makeScale(r,i,m),this.applyMatrix4(_m1),this}lookAt(r){return _obj.lookAt(r),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(r){const i=[];for(let m=0,_=r.length;m<_;m++){const A=r[m];i.push(A.x,A.y,A.z||0)}return this.setAttribute("position",new Float32BufferAttribute(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const r=this.attributes.position,i=this.morphAttributes.position;if(r&&r.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(r!==void 0){if(this.boundingBox.setFromBufferAttribute(r),i)for(let m=0,_=i.length;m<_;m++){const A=i[m];_box$1.setFromBufferAttribute(A),this.morphTargetsRelative?(_vector$7.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$7),_vector$7.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$7)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const r=this.attributes.position,i=this.morphAttributes.position;if(r&&r.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);return}if(r){const m=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(r),i)for(let A=0,w=i.length;A<w;A++){const T=i[A];_boxMorphTargets.setFromBufferAttribute(T),this.morphTargetsRelative?(_vector$7.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$7),_vector$7.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$7)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(m);let _=0;for(let A=0,w=r.count;A<w;A++)_vector$7.fromBufferAttribute(r,A),_=Math.max(_,m.distanceToSquared(_vector$7));if(i)for(let A=0,w=i.length;A<w;A++){const T=i[A],R=this.morphTargetsRelative;for(let D=0,U=T.count;D<U;D++)_vector$7.fromBufferAttribute(T,D),R&&(_offset.fromBufferAttribute(r,D),_vector$7.add(_offset)),_=Math.max(_,m.distanceToSquared(_vector$7))}this.boundingSphere.radius=Math.sqrt(_),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const r=this.index,i=this.attributes;if(r===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const m=r.array,_=i.position.array,A=i.normal.array,w=i.uv.array,T=_.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*T),4));const R=this.getAttribute("tangent").array,D=[],U=[];for(let ve=0;ve<T;ve++)D[ve]=new Vector3,U[ve]=new Vector3;const k=new Vector3,X=new Vector3,J=new Vector3,$=new Vector2,oe=new Vector2,ne=new Vector2,H=new Vector3,V=new Vector3;function z(ve,re,ae){k.fromArray(_,ve*3),X.fromArray(_,re*3),J.fromArray(_,ae*3),$.fromArray(w,ve*2),oe.fromArray(w,re*2),ne.fromArray(w,ae*2),X.sub(k),J.sub(k),oe.sub($),ne.sub($);const me=1/(oe.x*ne.y-ne.x*oe.y);isFinite(me)&&(H.copy(X).multiplyScalar(ne.y).addScaledVector(J,-oe.y).multiplyScalar(me),V.copy(J).multiplyScalar(oe.x).addScaledVector(X,-ne.x).multiplyScalar(me),D[ve].add(H),D[re].add(H),D[ae].add(H),U[ve].add(V),U[re].add(V),U[ae].add(V))}let ce=this.groups;ce.length===0&&(ce=[{start:0,count:m.length}]);for(let ve=0,re=ce.length;ve<re;++ve){const ae=ce[ve],me=ae.start,ye=ae.count;for(let Te=me,ke=me+ye;Te<ke;Te+=3)z(m[Te+0],m[Te+1],m[Te+2])}const ue=new Vector3,he=new Vector3,K=new Vector3,Y=new Vector3;function ie(ve){K.fromArray(A,ve*3),Y.copy(K);const re=D[ve];ue.copy(re),ue.sub(K.multiplyScalar(K.dot(re))).normalize(),he.crossVectors(Y,re);const me=he.dot(U[ve])<0?-1:1;R[ve*4]=ue.x,R[ve*4+1]=ue.y,R[ve*4+2]=ue.z,R[ve*4+3]=me}for(let ve=0,re=ce.length;ve<re;++ve){const ae=ce[ve],me=ae.start,ye=ae.count;for(let Te=me,ke=me+ye;Te<ke;Te+=3)ie(m[Te+0]),ie(m[Te+1]),ie(m[Te+2])}}computeVertexNormals(){const r=this.index,i=this.getAttribute("position");if(i!==void 0){let m=this.getAttribute("normal");if(m===void 0)m=new BufferAttribute(new Float32Array(i.count*3),3),this.setAttribute("normal",m);else for(let X=0,J=m.count;X<J;X++)m.setXYZ(X,0,0,0);const _=new Vector3,A=new Vector3,w=new Vector3,T=new Vector3,R=new Vector3,D=new Vector3,U=new Vector3,k=new Vector3;if(r)for(let X=0,J=r.count;X<J;X+=3){const $=r.getX(X+0),oe=r.getX(X+1),ne=r.getX(X+2);_.fromBufferAttribute(i,$),A.fromBufferAttribute(i,oe),w.fromBufferAttribute(i,ne),U.subVectors(w,A),k.subVectors(_,A),U.cross(k),T.fromBufferAttribute(m,$),R.fromBufferAttribute(m,oe),D.fromBufferAttribute(m,ne),T.add(U),R.add(U),D.add(U),m.setXYZ($,T.x,T.y,T.z),m.setXYZ(oe,R.x,R.y,R.z),m.setXYZ(ne,D.x,D.y,D.z)}else for(let X=0,J=i.count;X<J;X+=3)_.fromBufferAttribute(i,X+0),A.fromBufferAttribute(i,X+1),w.fromBufferAttribute(i,X+2),U.subVectors(w,A),k.subVectors(_,A),U.cross(k),m.setXYZ(X+0,U.x,U.y,U.z),m.setXYZ(X+1,U.x,U.y,U.z),m.setXYZ(X+2,U.x,U.y,U.z);this.normalizeNormals(),m.needsUpdate=!0}}normalizeNormals(){const r=this.attributes.normal;for(let i=0,m=r.count;i<m;i++)_vector$7.fromBufferAttribute(r,i),_vector$7.normalize(),r.setXYZ(i,_vector$7.x,_vector$7.y,_vector$7.z)}toNonIndexed(){function r(T,R){const D=T.array,U=T.itemSize,k=T.normalized,X=new D.constructor(R.length*U);let J=0,$=0;for(let oe=0,ne=R.length;oe<ne;oe++){T.isInterleavedBufferAttribute?J=R[oe]*T.data.stride+T.offset:J=R[oe]*U;for(let H=0;H<U;H++)X[$++]=D[J++]}return new BufferAttribute(X,U,k)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new uI,m=this.index.array,_=this.attributes;for(const T in _){const R=_[T],D=r(R,m);i.setAttribute(T,D)}const A=this.morphAttributes;for(const T in A){const R=[],D=A[T];for(let U=0,k=D.length;U<k;U++){const X=D[U],J=r(X,m);R.push(J)}i.morphAttributes[T]=R}i.morphTargetsRelative=this.morphTargetsRelative;const w=this.groups;for(let T=0,R=w.length;T<R;T++){const D=w[T];i.addGroup(D.start,D.count,D.materialIndex)}return i}toJSON(){const r={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),Object.keys(this.userData).length>0&&(r.userData=this.userData),this.parameters!==void 0){const R=this.parameters;for(const D in R)R[D]!==void 0&&(r[D]=R[D]);return r}r.data={attributes:{}};const i=this.index;i!==null&&(r.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const m=this.attributes;for(const R in m){const D=m[R];r.data.attributes[R]=D.toJSON(r.data)}const _={};let A=!1;for(const R in this.morphAttributes){const D=this.morphAttributes[R],U=[];for(let k=0,X=D.length;k<X;k++){const J=D[k];U.push(J.toJSON(r.data))}U.length>0&&(_[R]=U,A=!0)}A&&(r.data.morphAttributes=_,r.data.morphTargetsRelative=this.morphTargetsRelative);const w=this.groups;w.length>0&&(r.data.groups=JSON.parse(JSON.stringify(w)));const T=this.boundingSphere;return T!==null&&(r.data.boundingSphere={center:T.center.toArray(),radius:T.radius}),r}clone(){return new this.constructor().copy(this)}copy(r){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=r.name;const m=r.index;m!==null&&this.setIndex(m.clone(i));const _=r.attributes;for(const D in _){const U=_[D];this.setAttribute(D,U.clone(i))}const A=r.morphAttributes;for(const D in A){const U=[],k=A[D];for(let X=0,J=k.length;X<J;X++)U.push(k[X].clone(i));this.morphAttributes[D]=U}this.morphTargetsRelative=r.morphTargetsRelative;const w=r.groups;for(let D=0,U=w.length;D<U;D++){const k=w[D];this.addGroup(k.start,k.count,k.materialIndex)}const T=r.boundingBox;T!==null&&(this.boundingBox=T.clone());const R=r.boundingSphere;return R!==null&&(this.boundingSphere=R.clone()),this.drawRange.start=r.drawRange.start,this.drawRange.count=r.drawRange.count,this.userData=r.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const _inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$5=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(r=new BufferGeometry$1,i=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=i,this.updateMorphTargets()}copy(r,i){return super.copy(r,i),r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,m=Object.keys(i);if(m.length>0){const _=i[m[0]];if(_!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let A=0,w=_.length;A<w;A++){const T=_[A].name||String(A);this.morphTargetInfluences.push(0),this.morphTargetDictionary[T]=A}}}}getVertexPosition(r,i){const m=this.geometry,_=m.attributes.position,A=m.morphAttributes.position,w=m.morphTargetsRelative;i.fromBufferAttribute(_,r);const T=this.morphTargetInfluences;if(A&&T){_morphA.set(0,0,0);for(let R=0,D=A.length;R<D;R++){const U=T[R],k=A[R];U!==0&&(_tempA.fromBufferAttribute(k,r),w?_morphA.addScaledVector(_tempA,U):_morphA.addScaledVector(_tempA.sub(i),U))}i.add(_morphA)}return i}raycast(r,i){const m=this.geometry,_=this.material,A=this.matrixWorld;_!==void 0&&(m.boundingSphere===null&&m.computeBoundingSphere(),_sphere$5.copy(m.boundingSphere),_sphere$5.applyMatrix4(A),_ray$3.copy(r.ray).recast(r.near),!(_sphere$5.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$5,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(r.far-r.near)**2))&&(_inverseMatrix$3.copy(A).invert(),_ray$3.copy(r.ray).applyMatrix4(_inverseMatrix$3),!(m.boundingBox!==null&&_ray$3.intersectsBox(m.boundingBox)===!1)&&this._computeIntersections(r,i,_ray$3)))}_computeIntersections(r,i,m){let _;const A=this.geometry,w=this.material,T=A.index,R=A.attributes.position,D=A.attributes.uv,U=A.attributes.uv1,k=A.attributes.normal,X=A.groups,J=A.drawRange;if(T!==null)if(Array.isArray(w))for(let $=0,oe=X.length;$<oe;$++){const ne=X[$],H=w[ne.materialIndex],V=Math.max(ne.start,J.start),z=Math.min(T.count,Math.min(ne.start+ne.count,J.start+J.count));for(let ce=V,ue=z;ce<ue;ce+=3){const he=T.getX(ce),K=T.getX(ce+1),Y=T.getX(ce+2);_=checkGeometryIntersection(this,H,r,m,D,U,k,he,K,Y),_&&(_.faceIndex=Math.floor(ce/3),_.face.materialIndex=ne.materialIndex,i.push(_))}}else{const $=Math.max(0,J.start),oe=Math.min(T.count,J.start+J.count);for(let ne=$,H=oe;ne<H;ne+=3){const V=T.getX(ne),z=T.getX(ne+1),ce=T.getX(ne+2);_=checkGeometryIntersection(this,w,r,m,D,U,k,V,z,ce),_&&(_.faceIndex=Math.floor(ne/3),i.push(_))}}else if(R!==void 0)if(Array.isArray(w))for(let $=0,oe=X.length;$<oe;$++){const ne=X[$],H=w[ne.materialIndex],V=Math.max(ne.start,J.start),z=Math.min(R.count,Math.min(ne.start+ne.count,J.start+J.count));for(let ce=V,ue=z;ce<ue;ce+=3){const he=ce,K=ce+1,Y=ce+2;_=checkGeometryIntersection(this,H,r,m,D,U,k,he,K,Y),_&&(_.faceIndex=Math.floor(ce/3),_.face.materialIndex=ne.materialIndex,i.push(_))}}else{const $=Math.max(0,J.start),oe=Math.min(R.count,J.start+J.count);for(let ne=$,H=oe;ne<H;ne+=3){const V=ne,z=ne+1,ce=ne+2;_=checkGeometryIntersection(this,w,r,m,D,U,k,V,z,ce),_&&(_.faceIndex=Math.floor(ne/3),i.push(_))}}}}function checkIntersection(u,r,i,m,_,A,w,T){let R;if(r.side===BackSide?R=m.intersectTriangle(w,A,_,!0,T):R=m.intersectTriangle(_,A,w,r.side===FrontSide,T),R===null)return null;_intersectionPointWorld.copy(T),_intersectionPointWorld.applyMatrix4(u.matrixWorld);const D=i.ray.origin.distanceTo(_intersectionPointWorld);return D<i.near||D>i.far?null:{distance:D,point:_intersectionPointWorld.clone(),object:u}}function checkGeometryIntersection(u,r,i,m,_,A,w,T,R,D){u.getVertexPosition(T,_vA$1),u.getVertexPosition(R,_vB$1),u.getVertexPosition(D,_vC$1);const U=checkIntersection(u,r,i,m,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(U){_&&(_uvA$1.fromBufferAttribute(_,T),_uvB$1.fromBufferAttribute(_,R),_uvC$1.fromBufferAttribute(_,D),U.uv=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),A&&(_uvA$1.fromBufferAttribute(A,T),_uvB$1.fromBufferAttribute(A,R),_uvC$1.fromBufferAttribute(A,D),U.uv1=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),U.uv2=U.uv1),w&&(_normalA.fromBufferAttribute(w,T),_normalB.fromBufferAttribute(w,R),_normalC.fromBufferAttribute(w,D),U.normal=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_normalA,_normalB,_normalC,new Vector3),U.normal.dot(m.direction)>0&&U.normal.multiplyScalar(-1));const k={a:T,b:R,c:D,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,k.normal),U.face=k}return U}class BoxGeometry extends BufferGeometry$1{constructor(r=1,i=1,m=1,_=1,A=1,w=1){super(),this.type="BoxGeometry",this.parameters={width:r,height:i,depth:m,widthSegments:_,heightSegments:A,depthSegments:w};const T=this;_=Math.floor(_),A=Math.floor(A),w=Math.floor(w);const R=[],D=[],U=[],k=[];let X=0,J=0;$("z","y","x",-1,-1,m,i,r,w,A,0),$("z","y","x",1,-1,m,i,-r,w,A,1),$("x","z","y",1,1,r,m,i,_,w,2),$("x","z","y",1,-1,r,m,-i,_,w,3),$("x","y","z",1,-1,r,i,m,_,A,4),$("x","y","z",-1,-1,r,i,-m,_,A,5),this.setIndex(R),this.setAttribute("position",new Float32BufferAttribute(D,3)),this.setAttribute("normal",new Float32BufferAttribute(U,3)),this.setAttribute("uv",new Float32BufferAttribute(k,2));function $(oe,ne,H,V,z,ce,ue,he,K,Y,ie){const ve=ce/K,re=ue/Y,ae=ce/2,me=ue/2,ye=he/2,Te=K+1,ke=Y+1;let Fe=0,Ve=0;const ot=new Vector3;for(let Ye=0;Ye<ke;Ye++){const Ze=Ye*re-me;for(let tt=0;tt<Te;tt++){const Pt=tt*ve-ae;ot[oe]=Pt*V,ot[ne]=Ze*z,ot[H]=ye,D.push(ot.x,ot.y,ot.z),ot[oe]=0,ot[ne]=0,ot[H]=he>0?1:-1,U.push(ot.x,ot.y,ot.z),k.push(tt/K),k.push(1-Ye/Y),Fe+=1}}for(let Ye=0;Ye<Y;Ye++)for(let Ze=0;Ze<K;Ze++){const tt=X+Ze+Te*Ye,Pt=X+Ze+Te*(Ye+1),Et=X+(Ze+1)+Te*(Ye+1),Ne=X+(Ze+1)+Te*Ye;R.push(tt,Pt,Ne),R.push(Pt,Et,Ne),Ve+=6}T.addGroup(J,Ve,ie),J+=Ve,X+=Fe}}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new BoxGeometry(r.width,r.height,r.depth,r.widthSegments,r.heightSegments,r.depthSegments)}}function cloneUniforms(u){const r={};for(const i in u){r[i]={};for(const m in u[i]){const _=u[i][m];_&&(_.isColor||_.isMatrix3||_.isMatrix4||_.isVector2||_.isVector3||_.isVector4||_.isTexture||_.isQuaternion)?_.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),r[i][m]=null):r[i][m]=_.clone():Array.isArray(_)?r[i][m]=_.slice():r[i][m]=_}}return r}function mergeUniforms(u){const r={};for(let i=0;i<u.length;i++){const m=cloneUniforms(u[i]);for(const _ in m)r[_]=m[_]}return r}function cloneUniformsGroups(u){const r=[];for(let i=0;i<u.length;i++)r.push(u[i].clone());return r}function getUnlitUniformColorSpace(u){return u.getRenderTarget()===null?u.outputColorSpace:LinearSRGBColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(r){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,r!==void 0&&this.setValues(r)}copy(r){return super.copy(r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=cloneUniforms(r.uniforms),this.uniformsGroups=cloneUniformsGroups(r.uniformsGroups),this.defines=Object.assign({},r.defines),this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.fog=r.fog,this.lights=r.lights,this.clipping=r.clipping,this.extensions=Object.assign({},r.extensions),this.glslVersion=r.glslVersion,this}toJSON(r){const i=super.toJSON(r);i.glslVersion=this.glslVersion,i.uniforms={};for(const _ in this.uniforms){const w=this.uniforms[_].value;w&&w.isTexture?i.uniforms[_]={type:"t",value:w.toJSON(r).uuid}:w&&w.isColor?i.uniforms[_]={type:"c",value:w.getHex()}:w&&w.isVector2?i.uniforms[_]={type:"v2",value:w.toArray()}:w&&w.isVector3?i.uniforms[_]={type:"v3",value:w.toArray()}:w&&w.isVector4?i.uniforms[_]={type:"v4",value:w.toArray()}:w&&w.isMatrix3?i.uniforms[_]={type:"m3",value:w.toArray()}:w&&w.isMatrix4?i.uniforms[_]={type:"m4",value:w.toArray()}:i.uniforms[_]={value:w}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const m={};for(const _ in this.extensions)this.extensions[_]===!0&&(m[_]=!0);return Object.keys(m).length>0&&(i.extensions=m),i}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(r,i){return super.copy(r,i),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this.coordinateSystem=r.coordinateSystem,this}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return r.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,i){super.updateWorldMatrix(r,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class PerspectiveCamera extends Camera{constructor(r=50,i=1,m=.1,_=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=m,this.far=_,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,i){return super.copy(r,i),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const i=.5*this.getFilmHeight()/r;this.fov=RAD2DEG*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(r,i,m,_,A,w){this.aspect=r/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=i,this.view.offsetX=m,this.view.offsetY=_,this.view.width=A,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let i=r*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,m=2*i,_=this.aspect*m,A=-.5*_;const w=this.view;if(this.view!==null&&this.view.enabled){const R=w.fullWidth,D=w.fullHeight;A+=w.offsetX*_/R,i-=w.offsetY*m/D,_*=w.width/R,m*=w.height/D}const T=this.filmOffset;T!==0&&(A+=r*T/this.getFilmWidth()),this.projectionMatrix.makePerspective(A,A+_,i,i-m,r,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const i=super.toJSON(r);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(r,i,m){super(),this.type="CubeCamera",this.renderTarget=m,this.coordinateSystem=null;const _=new PerspectiveCamera(fov,aspect,r,i);_.layers=this.layers,this.add(_);const A=new PerspectiveCamera(fov,aspect,r,i);A.layers=this.layers,this.add(A);const w=new PerspectiveCamera(fov,aspect,r,i);w.layers=this.layers,this.add(w);const T=new PerspectiveCamera(fov,aspect,r,i);T.layers=this.layers,this.add(T);const R=new PerspectiveCamera(fov,aspect,r,i);R.layers=this.layers,this.add(R);const D=new PerspectiveCamera(fov,aspect,r,i);D.layers=this.layers,this.add(D)}updateCoordinateSystem(){const r=this.coordinateSystem,i=this.children.concat(),[m,_,A,w,T,R]=i;for(const D of i)this.remove(D);if(r===WebGLCoordinateSystem)m.up.set(0,1,0),m.lookAt(1,0,0),_.up.set(0,1,0),_.lookAt(-1,0,0),A.up.set(0,0,-1),A.lookAt(0,1,0),w.up.set(0,0,1),w.lookAt(0,-1,0),T.up.set(0,1,0),T.lookAt(0,0,1),R.up.set(0,1,0),R.lookAt(0,0,-1);else if(r===WebGPUCoordinateSystem)m.up.set(0,-1,0),m.lookAt(-1,0,0),_.up.set(0,-1,0),_.lookAt(1,0,0),A.up.set(0,0,1),A.lookAt(0,1,0),w.up.set(0,0,-1),w.lookAt(0,-1,0),T.up.set(0,-1,0),T.lookAt(0,0,1),R.up.set(0,-1,0),R.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+r);for(const D of i)this.add(D),D.updateMatrixWorld()}update(r,i){this.parent===null&&this.updateMatrixWorld();const m=this.renderTarget;this.coordinateSystem!==r.coordinateSystem&&(this.coordinateSystem=r.coordinateSystem,this.updateCoordinateSystem());const[_,A,w,T,R,D]=this.children,U=r.getRenderTarget(),k=r.xr.enabled;r.xr.enabled=!1;const X=m.texture.generateMipmaps;m.texture.generateMipmaps=!1,r.setRenderTarget(m,0),r.render(i,_),r.setRenderTarget(m,1),r.render(i,A),r.setRenderTarget(m,2),r.render(i,w),r.setRenderTarget(m,3),r.render(i,T),r.setRenderTarget(m,4),r.render(i,R),m.texture.generateMipmaps=X,r.setRenderTarget(m,5),r.render(i,D),r.setRenderTarget(U),r.xr.enabled=k,m.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(r,i,m,_,A,w,T,R,D,U){r=r!==void 0?r:[],i=i!==void 0?i:CubeReflectionMapping,super(r,i,m,_,A,w,T,R,D,U),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(r){this.image=r}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(r=1,i={}){super(r,r,i),this.isWebGLCubeRenderTarget=!0;const m={width:r,height:r,depth:1},_=[m,m,m,m,m,m];i.encoding!==void 0&&(warnOnce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new CubeTexture(_,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:LinearFilter}fromEquirectangularTexture(r,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const m={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},_=new BoxGeometry(5,5,5),A=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(m.uniforms),vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,side:BackSide,blending:NoBlending});A.uniforms.tEquirect.value=i;const w=new Mesh(_,A),T=i.minFilter;return i.minFilter===LinearMipmapLinearFilter&&(i.minFilter=LinearFilter),new CubeCamera(1,10,this).update(r,w),i.minFilter=T,w.geometry.dispose(),w.material.dispose(),this}clear(r,i,m,_){const A=r.getRenderTarget();for(let w=0;w<6;w++)r.setRenderTarget(this,w),r.clear(i,m,_);r.setRenderTarget(A)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(r=new Vector3(1,0,0),i=0){this.isPlane=!0,this.normal=r,this.constant=i}set(r,i){return this.normal.copy(r),this.constant=i,this}setComponents(r,i,m,_){return this.normal.set(r,i,m),this.constant=_,this}setFromNormalAndCoplanarPoint(r,i){return this.normal.copy(r),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(r,i,m){const _=_vector1.subVectors(m,i).cross(_vector2.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(_,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,i){return i.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,i){const m=r.delta(_vector1),_=this.normal.dot(m);if(_===0)return this.distanceToPoint(r.start)===0?i.copy(r.start):null;const A=-(r.start.dot(this.normal)+this.constant)/_;return A<0||A>1?null:i.copy(r.start).addScaledVector(m,A)}intersectsLine(r){const i=this.distanceToPoint(r.start),m=this.distanceToPoint(r.end);return i<0&&m>0||m<0&&i>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,i){const m=i||_normalMatrix.getNormalMatrix(r),_=this.coplanarPoint(_vector1).applyMatrix4(r),A=this.normal.applyMatrix3(m).normalize();return this.constant=-_.dot(A),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$4=new Sphere,_vector$6=new Vector3;class Frustum{constructor(r=new Plane,i=new Plane,m=new Plane,_=new Plane,A=new Plane,w=new Plane){this.planes=[r,i,m,_,A,w]}set(r,i,m,_,A,w){const T=this.planes;return T[0].copy(r),T[1].copy(i),T[2].copy(m),T[3].copy(_),T[4].copy(A),T[5].copy(w),this}copy(r){const i=this.planes;for(let m=0;m<6;m++)i[m].copy(r.planes[m]);return this}setFromProjectionMatrix(r,i=WebGLCoordinateSystem){const m=this.planes,_=r.elements,A=_[0],w=_[1],T=_[2],R=_[3],D=_[4],U=_[5],k=_[6],X=_[7],J=_[8],$=_[9],oe=_[10],ne=_[11],H=_[12],V=_[13],z=_[14],ce=_[15];if(m[0].setComponents(R-A,X-D,ne-J,ce-H).normalize(),m[1].setComponents(R+A,X+D,ne+J,ce+H).normalize(),m[2].setComponents(R+w,X+U,ne+$,ce+V).normalize(),m[3].setComponents(R-w,X-U,ne-$,ce-V).normalize(),m[4].setComponents(R-T,X-k,ne-oe,ce-z).normalize(),i===WebGLCoordinateSystem)m[5].setComponents(R+T,X+k,ne+oe,ce+z).normalize();else if(i===WebGPUCoordinateSystem)m[5].setComponents(T,k,oe,z).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),_sphere$4.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const i=r.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),_sphere$4.copy(i.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(_sphere$4)}intersectsSprite(r){return _sphere$4.center.set(0,0,0),_sphere$4.radius=.7071067811865476,_sphere$4.applyMatrix4(r.matrixWorld),this.intersectsSphere(_sphere$4)}intersectsSphere(r){const i=this.planes,m=r.center,_=-r.radius;for(let A=0;A<6;A++)if(i[A].distanceToPoint(m)<_)return!1;return!0}intersectsBox(r){const i=this.planes;for(let m=0;m<6;m++){const _=i[m];if(_vector$6.x=_.normal.x>0?r.max.x:r.min.x,_vector$6.y=_.normal.y>0?r.max.y:r.min.y,_vector$6.z=_.normal.z>0?r.max.z:r.min.z,_.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(r){const i=this.planes;for(let m=0;m<6;m++)if(i[m].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let u=null,r=!1,i=null,m=null;function _(A,w){i(A,w),m=u.requestAnimationFrame(_)}return{start:function(){r!==!0&&i!==null&&(m=u.requestAnimationFrame(_),r=!0)},stop:function(){u.cancelAnimationFrame(m),r=!1},setAnimationLoop:function(A){i=A},setContext:function(A){u=A}}}function WebGLAttributes(u,r){const i=r.isWebGL2,m=new WeakMap;function _(D,U){const k=D.array,X=D.usage,J=u.createBuffer();u.bindBuffer(U,J),u.bufferData(U,k,X),D.onUploadCallback();let $;if(k instanceof Float32Array)$=u.FLOAT;else if(k instanceof Uint16Array)if(D.isFloat16BufferAttribute)if(i)$=u.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else $=u.UNSIGNED_SHORT;else if(k instanceof Int16Array)$=u.SHORT;else if(k instanceof Uint32Array)$=u.UNSIGNED_INT;else if(k instanceof Int32Array)$=u.INT;else if(k instanceof Int8Array)$=u.BYTE;else if(k instanceof Uint8Array)$=u.UNSIGNED_BYTE;else if(k instanceof Uint8ClampedArray)$=u.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+k);return{buffer:J,type:$,bytesPerElement:k.BYTES_PER_ELEMENT,version:D.version}}function A(D,U,k){const X=U.array,J=U.updateRange;u.bindBuffer(k,D),J.count===-1?u.bufferSubData(k,0,X):(i?u.bufferSubData(k,J.offset*X.BYTES_PER_ELEMENT,X,J.offset,J.count):u.bufferSubData(k,J.offset*X.BYTES_PER_ELEMENT,X.subarray(J.offset,J.offset+J.count)),J.count=-1),U.onUploadCallback()}function w(D){return D.isInterleavedBufferAttribute&&(D=D.data),m.get(D)}function T(D){D.isInterleavedBufferAttribute&&(D=D.data);const U=m.get(D);U&&(u.deleteBuffer(U.buffer),m.delete(D))}function R(D,U){if(D.isGLBufferAttribute){const X=m.get(D);(!X||X.version<D.version)&&m.set(D,{buffer:D.buffer,type:D.type,bytesPerElement:D.elementSize,version:D.version});return}D.isInterleavedBufferAttribute&&(D=D.data);const k=m.get(D);k===void 0?m.set(D,_(D,U)):k.version<D.version&&(A(k.buffer,D,U),k.version=D.version)}return{get:w,remove:T,update:R}}class PlaneGeometry extends BufferGeometry$1{constructor(r=1,i=1,m=1,_=1){super(),this.type="PlaneGeometry",this.parameters={width:r,height:i,widthSegments:m,heightSegments:_};const A=r/2,w=i/2,T=Math.floor(m),R=Math.floor(_),D=T+1,U=R+1,k=r/T,X=i/R,J=[],$=[],oe=[],ne=[];for(let H=0;H<U;H++){const V=H*X-w;for(let z=0;z<D;z++){const ce=z*k-A;$.push(ce,-V,0),oe.push(0,0,1),ne.push(z/T),ne.push(1-H/R)}}for(let H=0;H<R;H++)for(let V=0;V<T;V++){const z=V+D*H,ce=V+D*(H+1),ue=V+1+D*(H+1),he=V+1+D*H;J.push(z,ce,he),J.push(ce,ue,he)}this.setIndex(J),this.setAttribute("position",new Float32BufferAttribute($,3)),this.setAttribute("normal",new Float32BufferAttribute(oe,3)),this.setAttribute("uv",new Float32BufferAttribute(ne,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new PlaneGeometry(r.width,r.height,r.widthSegments,r.heightSegments)}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0};function WebGLBackground(u,r,i,m,_,A,w){const T=new Color(0);let R=A===!0?0:1,D,U,k=null,X=0,J=null;function $(ne,H){let V=!1,z=H.isScene===!0?H.background:null;z&&z.isTexture&&(z=(H.backgroundBlurriness>0?i:r).get(z)),z===null?oe(T,R):z&&z.isColor&&(oe(z,1),V=!0);const ce=u.xr.getEnvironmentBlendMode();ce==="additive"?m.buffers.color.setClear(0,0,0,1,w):ce==="alpha-blend"&&m.buffers.color.setClear(0,0,0,0,w),(u.autoClear||V)&&u.clear(u.autoClearColor,u.autoClearDepth,u.autoClearStencil),z&&(z.isCubeTexture||z.mapping===CubeUVReflectionMapping)?(U===void 0&&(U=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),U.geometry.deleteAttribute("normal"),U.geometry.deleteAttribute("uv"),U.onBeforeRender=function(ue,he,K){this.matrixWorld.copyPosition(K.matrixWorld)},Object.defineProperty(U.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),_.update(U)),U.material.uniforms.envMap.value=z,U.material.uniforms.flipEnvMap.value=z.isCubeTexture&&z.isRenderTargetTexture===!1?-1:1,U.material.uniforms.backgroundBlurriness.value=H.backgroundBlurriness,U.material.uniforms.backgroundIntensity.value=H.backgroundIntensity,U.material.toneMapped=z.colorSpace!==SRGBColorSpace,(k!==z||X!==z.version||J!==u.toneMapping)&&(U.material.needsUpdate=!0,k=z,X=z.version,J=u.toneMapping),U.layers.enableAll(),ne.unshift(U,U.geometry,U.material,0,0,null)):z&&z.isTexture&&(D===void 0&&(D=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),D.geometry.deleteAttribute("normal"),Object.defineProperty(D.material,"map",{get:function(){return this.uniforms.t2D.value}}),_.update(D)),D.material.uniforms.t2D.value=z,D.material.uniforms.backgroundIntensity.value=H.backgroundIntensity,D.material.toneMapped=z.colorSpace!==SRGBColorSpace,z.matrixAutoUpdate===!0&&z.updateMatrix(),D.material.uniforms.uvTransform.value.copy(z.matrix),(k!==z||X!==z.version||J!==u.toneMapping)&&(D.material.needsUpdate=!0,k=z,X=z.version,J=u.toneMapping),D.layers.enableAll(),ne.unshift(D,D.geometry,D.material,0,0,null))}function oe(ne,H){ne.getRGB(_rgb,getUnlitUniformColorSpace(u)),m.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,H,w)}return{getClearColor:function(){return T},setClearColor:function(ne,H=1){T.set(ne),R=H,oe(T,R)},getClearAlpha:function(){return R},setClearAlpha:function(ne){R=ne,oe(T,R)},render:$}}function WebGLBindingStates(u,r,i,m){const _=u.getParameter(u.MAX_VERTEX_ATTRIBS),A=m.isWebGL2?null:r.get("OES_vertex_array_object"),w=m.isWebGL2||A!==null,T={},R=ne(null);let D=R,U=!1;function k(ye,Te,ke,Fe,Ve){let ot=!1;if(w){const Ye=oe(Fe,ke,Te);D!==Ye&&(D=Ye,J(D.object)),ot=H(ye,Fe,ke,Ve),ot&&V(ye,Fe,ke,Ve)}else{const Ye=Te.wireframe===!0;(D.geometry!==Fe.id||D.program!==ke.id||D.wireframe!==Ye)&&(D.geometry=Fe.id,D.program=ke.id,D.wireframe=Ye,ot=!0)}Ve!==null&&i.update(Ve,u.ELEMENT_ARRAY_BUFFER),(ot||U)&&(U=!1,Y(ye,Te,ke,Fe),Ve!==null&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.get(Ve).buffer))}function X(){return m.isWebGL2?u.createVertexArray():A.createVertexArrayOES()}function J(ye){return m.isWebGL2?u.bindVertexArray(ye):A.bindVertexArrayOES(ye)}function $(ye){return m.isWebGL2?u.deleteVertexArray(ye):A.deleteVertexArrayOES(ye)}function oe(ye,Te,ke){const Fe=ke.wireframe===!0;let Ve=T[ye.id];Ve===void 0&&(Ve={},T[ye.id]=Ve);let ot=Ve[Te.id];ot===void 0&&(ot={},Ve[Te.id]=ot);let Ye=ot[Fe];return Ye===void 0&&(Ye=ne(X()),ot[Fe]=Ye),Ye}function ne(ye){const Te=[],ke=[],Fe=[];for(let Ve=0;Ve<_;Ve++)Te[Ve]=0,ke[Ve]=0,Fe[Ve]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Te,enabledAttributes:ke,attributeDivisors:Fe,object:ye,attributes:{},index:null}}function H(ye,Te,ke,Fe){const Ve=D.attributes,ot=Te.attributes;let Ye=0;const Ze=ke.getAttributes();for(const tt in Ze)if(Ze[tt].location>=0){const Et=Ve[tt];let Ne=ot[tt];if(Ne===void 0&&(tt==="instanceMatrix"&&ye.instanceMatrix&&(Ne=ye.instanceMatrix),tt==="instanceColor"&&ye.instanceColor&&(Ne=ye.instanceColor)),Et===void 0||Et.attribute!==Ne||Ne&&Et.data!==Ne.data)return!0;Ye++}return D.attributesNum!==Ye||D.index!==Fe}function V(ye,Te,ke,Fe){const Ve={},ot=Te.attributes;let Ye=0;const Ze=ke.getAttributes();for(const tt in Ze)if(Ze[tt].location>=0){let Et=ot[tt];Et===void 0&&(tt==="instanceMatrix"&&ye.instanceMatrix&&(Et=ye.instanceMatrix),tt==="instanceColor"&&ye.instanceColor&&(Et=ye.instanceColor));const Ne={};Ne.attribute=Et,Et&&Et.data&&(Ne.data=Et.data),Ve[tt]=Ne,Ye++}D.attributes=Ve,D.attributesNum=Ye,D.index=Fe}function z(){const ye=D.newAttributes;for(let Te=0,ke=ye.length;Te<ke;Te++)ye[Te]=0}function ce(ye){ue(ye,0)}function ue(ye,Te){const ke=D.newAttributes,Fe=D.enabledAttributes,Ve=D.attributeDivisors;ke[ye]=1,Fe[ye]===0&&(u.enableVertexAttribArray(ye),Fe[ye]=1),Ve[ye]!==Te&&((m.isWebGL2?u:r.get("ANGLE_instanced_arrays"))[m.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ye,Te),Ve[ye]=Te)}function he(){const ye=D.newAttributes,Te=D.enabledAttributes;for(let ke=0,Fe=Te.length;ke<Fe;ke++)Te[ke]!==ye[ke]&&(u.disableVertexAttribArray(ke),Te[ke]=0)}function K(ye,Te,ke,Fe,Ve,ot,Ye){Ye===!0?u.vertexAttribIPointer(ye,Te,ke,Ve,ot):u.vertexAttribPointer(ye,Te,ke,Fe,Ve,ot)}function Y(ye,Te,ke,Fe){if(m.isWebGL2===!1&&(ye.isInstancedMesh||Fe.isInstancedBufferGeometry)&&r.get("ANGLE_instanced_arrays")===null)return;z();const Ve=Fe.attributes,ot=ke.getAttributes(),Ye=Te.defaultAttributeValues;for(const Ze in ot){const tt=ot[Ze];if(tt.location>=0){let Pt=Ve[Ze];if(Pt===void 0&&(Ze==="instanceMatrix"&&ye.instanceMatrix&&(Pt=ye.instanceMatrix),Ze==="instanceColor"&&ye.instanceColor&&(Pt=ye.instanceColor)),Pt!==void 0){const Et=Pt.normalized,Ne=Pt.itemSize,et=i.get(Pt);if(et===void 0)continue;const wt=et.buffer,Zt=et.type,nn=et.bytesPerElement,Vn=m.isWebGL2===!0&&(Zt===u.INT||Zt===u.UNSIGNED_INT||Pt.gpuType===IntType);if(Pt.isInterleavedBufferAttribute){const Jn=Pt.data,Ue=Jn.stride,St=Pt.offset;if(Jn.isInstancedInterleavedBuffer){for(let Lt=0;Lt<tt.locationSize;Lt++)ue(tt.location+Lt,Jn.meshPerAttribute);ye.isInstancedMesh!==!0&&Fe._maxInstanceCount===void 0&&(Fe._maxInstanceCount=Jn.meshPerAttribute*Jn.count)}else for(let Lt=0;Lt<tt.locationSize;Lt++)ce(tt.location+Lt);u.bindBuffer(u.ARRAY_BUFFER,wt);for(let Lt=0;Lt<tt.locationSize;Lt++)K(tt.location+Lt,Ne/tt.locationSize,Zt,Et,Ue*nn,(St+Ne/tt.locationSize*Lt)*nn,Vn)}else{if(Pt.isInstancedBufferAttribute){for(let Jn=0;Jn<tt.locationSize;Jn++)ue(tt.location+Jn,Pt.meshPerAttribute);ye.isInstancedMesh!==!0&&Fe._maxInstanceCount===void 0&&(Fe._maxInstanceCount=Pt.meshPerAttribute*Pt.count)}else for(let Jn=0;Jn<tt.locationSize;Jn++)ce(tt.location+Jn);u.bindBuffer(u.ARRAY_BUFFER,wt);for(let Jn=0;Jn<tt.locationSize;Jn++)K(tt.location+Jn,Ne/tt.locationSize,Zt,Et,Ne*nn,Ne/tt.locationSize*Jn*nn,Vn)}}else if(Ye!==void 0){const Et=Ye[Ze];if(Et!==void 0)switch(Et.length){case 2:u.vertexAttrib2fv(tt.location,Et);break;case 3:u.vertexAttrib3fv(tt.location,Et);break;case 4:u.vertexAttrib4fv(tt.location,Et);break;default:u.vertexAttrib1fv(tt.location,Et)}}}}he()}function ie(){ae();for(const ye in T){const Te=T[ye];for(const ke in Te){const Fe=Te[ke];for(const Ve in Fe)$(Fe[Ve].object),delete Fe[Ve];delete Te[ke]}delete T[ye]}}function ve(ye){if(T[ye.id]===void 0)return;const Te=T[ye.id];for(const ke in Te){const Fe=Te[ke];for(const Ve in Fe)$(Fe[Ve].object),delete Fe[Ve];delete Te[ke]}delete T[ye.id]}function re(ye){for(const Te in T){const ke=T[Te];if(ke[ye.id]===void 0)continue;const Fe=ke[ye.id];for(const Ve in Fe)$(Fe[Ve].object),delete Fe[Ve];delete ke[ye.id]}}function ae(){me(),U=!0,D!==R&&(D=R,J(D.object))}function me(){R.geometry=null,R.program=null,R.wireframe=!1}return{setup:k,reset:ae,resetDefaultState:me,dispose:ie,releaseStatesOfGeometry:ve,releaseStatesOfProgram:re,initAttributes:z,enableAttribute:ce,disableUnusedAttributes:he}}function WebGLBufferRenderer(u,r,i,m){const _=m.isWebGL2;let A;function w(D){A=D}function T(D,U){u.drawArrays(A,D,U),i.update(U,A,1)}function R(D,U,k){if(k===0)return;let X,J;if(_)X=u,J="drawArraysInstanced";else if(X=r.get("ANGLE_instanced_arrays"),J="drawArraysInstancedANGLE",X===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}X[J](A,D,U,k),i.update(U,A,k)}this.setMode=w,this.render=T,this.renderInstances=R}function WebGLCapabilities(u,r,i){let m;function _(){if(m!==void 0)return m;if(r.has("EXT_texture_filter_anisotropic")===!0){const K=r.get("EXT_texture_filter_anisotropic");m=u.getParameter(K.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else m=0;return m}function A(K){if(K==="highp"){if(u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision>0&&u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision>0)return"highp";K="mediump"}return K==="mediump"&&u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision>0&&u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const w=typeof WebGL2RenderingContext<"u"&&u.constructor.name==="WebGL2RenderingContext";let T=i.precision!==void 0?i.precision:"highp";const R=A(T);R!==T&&(console.warn("THREE.WebGLRenderer:",T,"not supported, using",R,"instead."),T=R);const D=w||r.has("WEBGL_draw_buffers"),U=i.logarithmicDepthBuffer===!0,k=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),X=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),J=u.getParameter(u.MAX_TEXTURE_SIZE),$=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),oe=u.getParameter(u.MAX_VERTEX_ATTRIBS),ne=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),H=u.getParameter(u.MAX_VARYING_VECTORS),V=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),z=X>0,ce=w||r.has("OES_texture_float"),ue=z&&ce,he=w?u.getParameter(u.MAX_SAMPLES):0;return{isWebGL2:w,drawBuffers:D,getMaxAnisotropy:_,getMaxPrecision:A,precision:T,logarithmicDepthBuffer:U,maxTextures:k,maxVertexTextures:X,maxTextureSize:J,maxCubemapSize:$,maxAttributes:oe,maxVertexUniforms:ne,maxVaryings:H,maxFragmentUniforms:V,vertexTextures:z,floatFragmentTextures:ce,floatVertexTextures:ue,maxSamples:he}}function WebGLClipping(u){const r=this;let i=null,m=0,_=!1,A=!1;const w=new Plane,T=new Matrix3,R={value:null,needsUpdate:!1};this.uniform=R,this.numPlanes=0,this.numIntersection=0,this.init=function(k,X){const J=k.length!==0||X||m!==0||_;return _=X,m=k.length,J},this.beginShadows=function(){A=!0,U(null)},this.endShadows=function(){A=!1},this.setGlobalState=function(k,X){i=U(k,X,0)},this.setState=function(k,X,J){const $=k.clippingPlanes,oe=k.clipIntersection,ne=k.clipShadows,H=u.get(k);if(!_||$===null||$.length===0||A&&!ne)A?U(null):D();else{const V=A?0:m,z=V*4;let ce=H.clippingState||null;R.value=ce,ce=U($,X,z,J);for(let ue=0;ue!==z;++ue)ce[ue]=i[ue];H.clippingState=ce,this.numIntersection=oe?this.numPlanes:0,this.numPlanes+=V}};function D(){R.value!==i&&(R.value=i,R.needsUpdate=m>0),r.numPlanes=m,r.numIntersection=0}function U(k,X,J,$){const oe=k!==null?k.length:0;let ne=null;if(oe!==0){if(ne=R.value,$!==!0||ne===null){const H=J+oe*4,V=X.matrixWorldInverse;T.getNormalMatrix(V),(ne===null||ne.length<H)&&(ne=new Float32Array(H));for(let z=0,ce=J;z!==oe;++z,ce+=4)w.copy(k[z]).applyMatrix4(V,T),w.normal.toArray(ne,ce),ne[ce+3]=w.constant}R.value=ne,R.needsUpdate=!0}return r.numPlanes=oe,r.numIntersection=0,ne}}function WebGLCubeMaps(u){let r=new WeakMap;function i(w,T){return T===EquirectangularReflectionMapping?w.mapping=CubeReflectionMapping:T===EquirectangularRefractionMapping&&(w.mapping=CubeRefractionMapping),w}function m(w){if(w&&w.isTexture&&w.isRenderTargetTexture===!1){const T=w.mapping;if(T===EquirectangularReflectionMapping||T===EquirectangularRefractionMapping)if(r.has(w)){const R=r.get(w).texture;return i(R,w.mapping)}else{const R=w.image;if(R&&R.height>0){const D=new WebGLCubeRenderTarget(R.height/2);return D.fromEquirectangularTexture(u,w),r.set(w,D),w.addEventListener("dispose",_),i(D.texture,w.mapping)}else return null}}return w}function _(w){const T=w.target;T.removeEventListener("dispose",_);const R=r.get(T);R!==void 0&&(r.delete(T),R.dispose())}function A(){r=new WeakMap}return{get:m,dispose:A}}class OrthographicCamera extends Camera{constructor(r=-1,i=1,m=1,_=-1,A=.1,w=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=i,this.top=m,this.bottom=_,this.near=A,this.far=w,this.updateProjectionMatrix()}copy(r,i){return super.copy(r,i),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,i,m,_,A,w){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=i,this.view.offsetX=m,this.view.offsetY=_,this.view.width=A,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),m=(this.right+this.left)/2,_=(this.top+this.bottom)/2;let A=m-r,w=m+r,T=_+i,R=_-i;if(this.view!==null&&this.view.enabled){const D=(this.right-this.left)/this.view.fullWidth/this.zoom,U=(this.top-this.bottom)/this.view.fullHeight/this.zoom;A+=D*this.view.offsetX,w=A+D*this.view.width,T-=U*this.view.offsetY,R=T-U*this.view.height}this.projectionMatrix.makeOrthographic(A,w,T,R,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const i=super.toJSON(r);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(r){this._renderer=r,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(r,i=0,m=.1,_=100){_oldTarget=this._renderer.getRenderTarget(),this._setSize(256);const A=this._allocateTargets();return A.depthBuffer=!0,this._sceneToCubeUV(r,m,_,A),i>0&&this._blur(A,0,0,i),this._applyPMREM(A),this._cleanup(A),A}fromEquirectangular(r,i=null){return this._fromTexture(r,i)}fromCubemap(r,i=null){return this._fromTexture(r,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(r){this._lodMax=Math.floor(Math.log2(r)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let r=0;r<this._lodPlanes.length;r++)this._lodPlanes[r].dispose()}_cleanup(r){this._renderer.setRenderTarget(_oldTarget),r.scissorTest=!1,_setViewport(r,0,0,r.width,r.height)}_fromTexture(r,i){r.mapping===CubeReflectionMapping||r.mapping===CubeRefractionMapping?this._setSize(r.image.length===0?16:r.image[0].width||r.image[0].image.width):this._setSize(r.image.width/4),_oldTarget=this._renderer.getRenderTarget();const m=i||this._allocateTargets();return this._textureToCubeUV(r,m),this._applyPMREM(m),this._cleanup(m),m}_allocateTargets(){const r=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,m={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},_=_createRenderTarget(r,i,m);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==r||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(r,i,m);const{_lodMax:A}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(A)),this._blurMaterial=_getBlurShader(A,r,i)}return _}_compileMaterial(r){const i=new Mesh(this._lodPlanes[0],r);this._renderer.compile(i,_flatCamera)}_sceneToCubeUV(r,i,m,_){const T=new PerspectiveCamera(90,1,i,m),R=[1,-1,1,1,1,1],D=[1,1,1,-1,-1,-1],U=this._renderer,k=U.autoClear,X=U.toneMapping;U.getClearColor(_clearColor),U.toneMapping=NoToneMapping,U.autoClear=!1;const J=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),$=new Mesh(new BoxGeometry,J);let oe=!1;const ne=r.background;ne?ne.isColor&&(J.color.copy(ne),r.background=null,oe=!0):(J.color.copy(_clearColor),oe=!0);for(let H=0;H<6;H++){const V=H%3;V===0?(T.up.set(0,R[H],0),T.lookAt(D[H],0,0)):V===1?(T.up.set(0,0,R[H]),T.lookAt(0,D[H],0)):(T.up.set(0,R[H],0),T.lookAt(0,0,D[H]));const z=this._cubeSize;_setViewport(_,V*z,H>2?z:0,z,z),U.setRenderTarget(_),oe&&U.render($,T),U.render(r,T)}$.geometry.dispose(),$.material.dispose(),U.toneMapping=X,U.autoClear=k,r.background=ne}_textureToCubeUV(r,i){const m=this._renderer,_=r.mapping===CubeReflectionMapping||r.mapping===CubeRefractionMapping;_?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=r.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const A=_?this._cubemapMaterial:this._equirectMaterial,w=new Mesh(this._lodPlanes[0],A),T=A.uniforms;T.envMap.value=r;const R=this._cubeSize;_setViewport(i,0,0,3*R,2*R),m.setRenderTarget(i),m.render(w,_flatCamera)}_applyPMREM(r){const i=this._renderer,m=i.autoClear;i.autoClear=!1;for(let _=1;_<this._lodPlanes.length;_++){const A=Math.sqrt(this._sigmas[_]*this._sigmas[_]-this._sigmas[_-1]*this._sigmas[_-1]),w=_axisDirections[(_-1)%_axisDirections.length];this._blur(r,_-1,_,A,w)}i.autoClear=m}_blur(r,i,m,_,A){const w=this._pingPongRenderTarget;this._halfBlur(r,w,i,m,_,"latitudinal",A),this._halfBlur(w,r,m,m,_,"longitudinal",A)}_halfBlur(r,i,m,_,A,w,T){const R=this._renderer,D=this._blurMaterial;w!=="latitudinal"&&w!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const U=3,k=new Mesh(this._lodPlanes[_],D),X=D.uniforms,J=this._sizeLods[m]-1,$=isFinite(A)?Math.PI/(2*J):2*Math.PI/(2*MAX_SAMPLES-1),oe=A/$,ne=isFinite(A)?1+Math.floor(U*oe):MAX_SAMPLES;ne>MAX_SAMPLES&&console.warn(`sigmaRadians, ${A}, is too large and will clip, as it requested ${ne} samples when the maximum is set to ${MAX_SAMPLES}`);const H=[];let V=0;for(let K=0;K<MAX_SAMPLES;++K){const Y=K/oe,ie=Math.exp(-Y*Y/2);H.push(ie),K===0?V+=ie:K<ne&&(V+=2*ie)}for(let K=0;K<H.length;K++)H[K]=H[K]/V;X.envMap.value=r.texture,X.samples.value=ne,X.weights.value=H,X.latitudinal.value=w==="latitudinal",T&&(X.poleAxis.value=T);const{_lodMax:z}=this;X.dTheta.value=$,X.mipInt.value=z-m;const ce=this._sizeLods[_],ue=3*ce*(_>z-LOD_MIN?_-z+LOD_MIN:0),he=4*(this._cubeSize-ce);_setViewport(i,ue,he,3*ce,2*ce),R.setRenderTarget(i),R.render(k,_flatCamera)}}function _createPlanes(u){const r=[],i=[],m=[];let _=u;const A=u-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let w=0;w<A;w++){const T=Math.pow(2,_);i.push(T);let R=1/T;w>u-LOD_MIN?R=EXTRA_LOD_SIGMA[w-u+LOD_MIN-1]:w===0&&(R=0),m.push(R);const D=1/(T-2),U=-D,k=1+D,X=[U,U,k,U,k,k,U,U,k,k,U,k],J=6,$=6,oe=3,ne=2,H=1,V=new Float32Array(oe*$*J),z=new Float32Array(ne*$*J),ce=new Float32Array(H*$*J);for(let he=0;he<J;he++){const K=he%3*2/3-1,Y=he>2?0:-1,ie=[K,Y,0,K+2/3,Y,0,K+2/3,Y+1,0,K,Y,0,K+2/3,Y+1,0,K,Y+1,0];V.set(ie,oe*$*he),z.set(X,ne*$*he);const ve=[he,he,he,he,he,he];ce.set(ve,H*$*he)}const ue=new BufferGeometry$1;ue.setAttribute("position",new BufferAttribute(V,oe)),ue.setAttribute("uv",new BufferAttribute(z,ne)),ue.setAttribute("faceIndex",new BufferAttribute(ce,H)),r.push(ue),_>LOD_MIN&&_--}return{lodPlanes:r,sizeLods:i,sigmas:m}}function _createRenderTarget(u,r,i){const m=new WebGLRenderTarget(u,r,i);return m.texture.mapping=CubeUVReflectionMapping,m.texture.name="PMREM.cubeUv",m.scissorTest=!0,m}function _setViewport(u,r,i,m,_){u.viewport.set(r,i,m,_),u.scissor.set(r,i,m,_)}function _getBlurShader(u,r,i){const m=new Float32Array(MAX_SAMPLES),_=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/r,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${u}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:m},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:_}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(u){let r=new WeakMap,i=null;function m(T){if(T&&T.isTexture){const R=T.mapping,D=R===EquirectangularReflectionMapping||R===EquirectangularRefractionMapping,U=R===CubeReflectionMapping||R===CubeRefractionMapping;if(D||U)if(T.isRenderTargetTexture&&T.needsPMREMUpdate===!0){T.needsPMREMUpdate=!1;let k=r.get(T);return i===null&&(i=new PMREMGenerator(u)),k=D?i.fromEquirectangular(T,k):i.fromCubemap(T,k),r.set(T,k),k.texture}else{if(r.has(T))return r.get(T).texture;{const k=T.image;if(D&&k&&k.height>0||U&&k&&_(k)){i===null&&(i=new PMREMGenerator(u));const X=D?i.fromEquirectangular(T):i.fromCubemap(T);return r.set(T,X),T.addEventListener("dispose",A),X.texture}else return null}}}return T}function _(T){let R=0;const D=6;for(let U=0;U<D;U++)T[U]!==void 0&&R++;return R===D}function A(T){const R=T.target;R.removeEventListener("dispose",A);const D=r.get(R);D!==void 0&&(r.delete(R),D.dispose())}function w(){r=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:m,dispose:w}}function WebGLExtensions(u){const r={};function i(m){if(r[m]!==void 0)return r[m];let _;switch(m){case"WEBGL_depth_texture":_=u.getExtension("WEBGL_depth_texture")||u.getExtension("MOZ_WEBGL_depth_texture")||u.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":_=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":_=u.getExtension("WEBGL_compressed_texture_s3tc")||u.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":_=u.getExtension("WEBGL_compressed_texture_pvrtc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:_=u.getExtension(m)}return r[m]=_,_}return{has:function(m){return i(m)!==null},init:function(m){m.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(m){const _=i(m);return _===null&&console.warn("THREE.WebGLRenderer: "+m+" extension not supported."),_}}}function WebGLGeometries(u,r,i,m){const _={},A=new WeakMap;function w(k){const X=k.target;X.index!==null&&r.remove(X.index);for(const $ in X.attributes)r.remove(X.attributes[$]);for(const $ in X.morphAttributes){const oe=X.morphAttributes[$];for(let ne=0,H=oe.length;ne<H;ne++)r.remove(oe[ne])}X.removeEventListener("dispose",w),delete _[X.id];const J=A.get(X);J&&(r.remove(J),A.delete(X)),m.releaseStatesOfGeometry(X),X.isInstancedBufferGeometry===!0&&delete X._maxInstanceCount,i.memory.geometries--}function T(k,X){return _[X.id]===!0||(X.addEventListener("dispose",w),_[X.id]=!0,i.memory.geometries++),X}function R(k){const X=k.attributes;for(const $ in X)r.update(X[$],u.ARRAY_BUFFER);const J=k.morphAttributes;for(const $ in J){const oe=J[$];for(let ne=0,H=oe.length;ne<H;ne++)r.update(oe[ne],u.ARRAY_BUFFER)}}function D(k){const X=[],J=k.index,$=k.attributes.position;let oe=0;if(J!==null){const V=J.array;oe=J.version;for(let z=0,ce=V.length;z<ce;z+=3){const ue=V[z+0],he=V[z+1],K=V[z+2];X.push(ue,he,he,K,K,ue)}}else if($!==void 0){const V=$.array;oe=$.version;for(let z=0,ce=V.length/3-1;z<ce;z+=3){const ue=z+0,he=z+1,K=z+2;X.push(ue,he,he,K,K,ue)}}else return;const ne=new(arrayNeedsUint32(X)?Uint32BufferAttribute:Uint16BufferAttribute)(X,1);ne.version=oe;const H=A.get(k);H&&r.remove(H),A.set(k,ne)}function U(k){const X=A.get(k);if(X){const J=k.index;J!==null&&X.version<J.version&&D(k)}else D(k);return A.get(k)}return{get:T,update:R,getWireframeAttribute:U}}function WebGLIndexedBufferRenderer(u,r,i,m){const _=m.isWebGL2;let A;function w(X){A=X}let T,R;function D(X){T=X.type,R=X.bytesPerElement}function U(X,J){u.drawElements(A,J,T,X*R),i.update(J,A,1)}function k(X,J,$){if($===0)return;let oe,ne;if(_)oe=u,ne="drawElementsInstanced";else if(oe=r.get("ANGLE_instanced_arrays"),ne="drawElementsInstancedANGLE",oe===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}oe[ne](A,J,T,X*R,$),i.update(J,A,$)}this.setMode=w,this.setIndex=D,this.render=U,this.renderInstances=k}function WebGLInfo(u){const r={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function m(A,w,T){switch(i.calls++,w){case u.TRIANGLES:i.triangles+=T*(A/3);break;case u.LINES:i.lines+=T*(A/2);break;case u.LINE_STRIP:i.lines+=T*(A-1);break;case u.LINE_LOOP:i.lines+=T*A;break;case u.POINTS:i.points+=T*A;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",w);break}}function _(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:r,render:i,programs:null,autoReset:!0,reset:_,update:m}}function numericalSort(u,r){return u[0]-r[0]}function absNumericalSort(u,r){return Math.abs(r[1])-Math.abs(u[1])}function WebGLMorphtargets(u,r,i){const m={},_=new Float32Array(8),A=new WeakMap,w=new Vector4,T=[];for(let D=0;D<8;D++)T[D]=[D,0];function R(D,U,k){const X=D.morphTargetInfluences;if(r.isWebGL2===!0){const J=U.morphAttributes.position||U.morphAttributes.normal||U.morphAttributes.color,$=J!==void 0?J.length:0;let oe=A.get(U);if(oe===void 0||oe.count!==$){let ye=function(){ae.dispose(),A.delete(U),U.removeEventListener("dispose",ye)};oe!==void 0&&oe.texture.dispose();const V=U.morphAttributes.position!==void 0,z=U.morphAttributes.normal!==void 0,ce=U.morphAttributes.color!==void 0,ue=U.morphAttributes.position||[],he=U.morphAttributes.normal||[],K=U.morphAttributes.color||[];let Y=0;V===!0&&(Y=1),z===!0&&(Y=2),ce===!0&&(Y=3);let ie=U.attributes.position.count*Y,ve=1;ie>r.maxTextureSize&&(ve=Math.ceil(ie/r.maxTextureSize),ie=r.maxTextureSize);const re=new Float32Array(ie*ve*4*$),ae=new DataArrayTexture(re,ie,ve,$);ae.type=FloatType,ae.needsUpdate=!0;const me=Y*4;for(let Te=0;Te<$;Te++){const ke=ue[Te],Fe=he[Te],Ve=K[Te],ot=ie*ve*4*Te;for(let Ye=0;Ye<ke.count;Ye++){const Ze=Ye*me;V===!0&&(w.fromBufferAttribute(ke,Ye),re[ot+Ze+0]=w.x,re[ot+Ze+1]=w.y,re[ot+Ze+2]=w.z,re[ot+Ze+3]=0),z===!0&&(w.fromBufferAttribute(Fe,Ye),re[ot+Ze+4]=w.x,re[ot+Ze+5]=w.y,re[ot+Ze+6]=w.z,re[ot+Ze+7]=0),ce===!0&&(w.fromBufferAttribute(Ve,Ye),re[ot+Ze+8]=w.x,re[ot+Ze+9]=w.y,re[ot+Ze+10]=w.z,re[ot+Ze+11]=Ve.itemSize===4?w.w:1)}}oe={count:$,texture:ae,size:new Vector2(ie,ve)},A.set(U,oe),U.addEventListener("dispose",ye)}let ne=0;for(let V=0;V<X.length;V++)ne+=X[V];const H=U.morphTargetsRelative?1:1-ne;k.getUniforms().setValue(u,"morphTargetBaseInfluence",H),k.getUniforms().setValue(u,"morphTargetInfluences",X),k.getUniforms().setValue(u,"morphTargetsTexture",oe.texture,i),k.getUniforms().setValue(u,"morphTargetsTextureSize",oe.size)}else{const J=X===void 0?0:X.length;let $=m[U.id];if($===void 0||$.length!==J){$=[];for(let z=0;z<J;z++)$[z]=[z,0];m[U.id]=$}for(let z=0;z<J;z++){const ce=$[z];ce[0]=z,ce[1]=X[z]}$.sort(absNumericalSort);for(let z=0;z<8;z++)z<J&&$[z][1]?(T[z][0]=$[z][0],T[z][1]=$[z][1]):(T[z][0]=Number.MAX_SAFE_INTEGER,T[z][1]=0);T.sort(numericalSort);const oe=U.morphAttributes.position,ne=U.morphAttributes.normal;let H=0;for(let z=0;z<8;z++){const ce=T[z],ue=ce[0],he=ce[1];ue!==Number.MAX_SAFE_INTEGER&&he?(oe&&U.getAttribute("morphTarget"+z)!==oe[ue]&&U.setAttribute("morphTarget"+z,oe[ue]),ne&&U.getAttribute("morphNormal"+z)!==ne[ue]&&U.setAttribute("morphNormal"+z,ne[ue]),_[z]=he,H+=he):(oe&&U.hasAttribute("morphTarget"+z)===!0&&U.deleteAttribute("morphTarget"+z),ne&&U.hasAttribute("morphNormal"+z)===!0&&U.deleteAttribute("morphNormal"+z),_[z]=0)}const V=U.morphTargetsRelative?1:1-H;k.getUniforms().setValue(u,"morphTargetBaseInfluence",V),k.getUniforms().setValue(u,"morphTargetInfluences",_)}}return{update:R}}function WebGLObjects(u,r,i,m){let _=new WeakMap;function A(R){const D=m.render.frame,U=R.geometry,k=r.get(R,U);if(_.get(k)!==D&&(r.update(k),_.set(k,D)),R.isInstancedMesh&&(R.hasEventListener("dispose",T)===!1&&R.addEventListener("dispose",T),_.get(R)!==D&&(i.update(R.instanceMatrix,u.ARRAY_BUFFER),R.instanceColor!==null&&i.update(R.instanceColor,u.ARRAY_BUFFER),_.set(R,D))),R.isSkinnedMesh){const X=R.skeleton;_.get(X)!==D&&(X.update(),_.set(X,D))}return k}function w(){_=new WeakMap}function T(R){const D=R.target;D.removeEventListener("dispose",T),i.remove(D.instanceMatrix),D.instanceColor!==null&&i.remove(D.instanceColor)}return{update:A,dispose:w}}const emptyTexture=new Texture,emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(u,r,i){const m=u[0];if(m<=0||m>0)return u;const _=r*i;let A=arrayCacheF32[_];if(A===void 0&&(A=new Float32Array(_),arrayCacheF32[_]=A),r!==0){m.toArray(A,0);for(let w=1,T=0;w!==r;++w)T+=i,u[w].toArray(A,T)}return A}function arraysEqual(u,r){if(u.length!==r.length)return!1;for(let i=0,m=u.length;i<m;i++)if(u[i]!==r[i])return!1;return!0}function copyArray(u,r){for(let i=0,m=r.length;i<m;i++)u[i]=r[i]}function allocTexUnits(u,r){let i=arrayCacheI32[r];i===void 0&&(i=new Int32Array(r),arrayCacheI32[r]=i);for(let m=0;m!==r;++m)i[m]=u.allocateTextureUnit();return i}function setValueV1f(u,r){const i=this.cache;i[0]!==r&&(u.uniform1f(this.addr,r),i[0]=r)}function setValueV2f(u,r){const i=this.cache;if(r.x!==void 0)(i[0]!==r.x||i[1]!==r.y)&&(u.uniform2f(this.addr,r.x,r.y),i[0]=r.x,i[1]=r.y);else{if(arraysEqual(i,r))return;u.uniform2fv(this.addr,r),copyArray(i,r)}}function setValueV3f(u,r){const i=this.cache;if(r.x!==void 0)(i[0]!==r.x||i[1]!==r.y||i[2]!==r.z)&&(u.uniform3f(this.addr,r.x,r.y,r.z),i[0]=r.x,i[1]=r.y,i[2]=r.z);else if(r.r!==void 0)(i[0]!==r.r||i[1]!==r.g||i[2]!==r.b)&&(u.uniform3f(this.addr,r.r,r.g,r.b),i[0]=r.r,i[1]=r.g,i[2]=r.b);else{if(arraysEqual(i,r))return;u.uniform3fv(this.addr,r),copyArray(i,r)}}function setValueV4f(u,r){const i=this.cache;if(r.x!==void 0)(i[0]!==r.x||i[1]!==r.y||i[2]!==r.z||i[3]!==r.w)&&(u.uniform4f(this.addr,r.x,r.y,r.z,r.w),i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=r.w);else{if(arraysEqual(i,r))return;u.uniform4fv(this.addr,r),copyArray(i,r)}}function setValueM2(u,r){const i=this.cache,m=r.elements;if(m===void 0){if(arraysEqual(i,r))return;u.uniformMatrix2fv(this.addr,!1,r),copyArray(i,r)}else{if(arraysEqual(i,m))return;mat2array.set(m),u.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(i,m)}}function setValueM3(u,r){const i=this.cache,m=r.elements;if(m===void 0){if(arraysEqual(i,r))return;u.uniformMatrix3fv(this.addr,!1,r),copyArray(i,r)}else{if(arraysEqual(i,m))return;mat3array.set(m),u.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(i,m)}}function setValueM4(u,r){const i=this.cache,m=r.elements;if(m===void 0){if(arraysEqual(i,r))return;u.uniformMatrix4fv(this.addr,!1,r),copyArray(i,r)}else{if(arraysEqual(i,m))return;mat4array.set(m),u.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(i,m)}}function setValueV1i(u,r){const i=this.cache;i[0]!==r&&(u.uniform1i(this.addr,r),i[0]=r)}function setValueV2i(u,r){const i=this.cache;if(r.x!==void 0)(i[0]!==r.x||i[1]!==r.y)&&(u.uniform2i(this.addr,r.x,r.y),i[0]=r.x,i[1]=r.y);else{if(arraysEqual(i,r))return;u.uniform2iv(this.addr,r),copyArray(i,r)}}function setValueV3i(u,r){const i=this.cache;if(r.x!==void 0)(i[0]!==r.x||i[1]!==r.y||i[2]!==r.z)&&(u.uniform3i(this.addr,r.x,r.y,r.z),i[0]=r.x,i[1]=r.y,i[2]=r.z);else{if(arraysEqual(i,r))return;u.uniform3iv(this.addr,r),copyArray(i,r)}}function setValueV4i(u,r){const i=this.cache;if(r.x!==void 0)(i[0]!==r.x||i[1]!==r.y||i[2]!==r.z||i[3]!==r.w)&&(u.uniform4i(this.addr,r.x,r.y,r.z,r.w),i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=r.w);else{if(arraysEqual(i,r))return;u.uniform4iv(this.addr,r),copyArray(i,r)}}function setValueV1ui(u,r){const i=this.cache;i[0]!==r&&(u.uniform1ui(this.addr,r),i[0]=r)}function setValueV2ui(u,r){const i=this.cache;if(r.x!==void 0)(i[0]!==r.x||i[1]!==r.y)&&(u.uniform2ui(this.addr,r.x,r.y),i[0]=r.x,i[1]=r.y);else{if(arraysEqual(i,r))return;u.uniform2uiv(this.addr,r),copyArray(i,r)}}function setValueV3ui(u,r){const i=this.cache;if(r.x!==void 0)(i[0]!==r.x||i[1]!==r.y||i[2]!==r.z)&&(u.uniform3ui(this.addr,r.x,r.y,r.z),i[0]=r.x,i[1]=r.y,i[2]=r.z);else{if(arraysEqual(i,r))return;u.uniform3uiv(this.addr,r),copyArray(i,r)}}function setValueV4ui(u,r){const i=this.cache;if(r.x!==void 0)(i[0]!==r.x||i[1]!==r.y||i[2]!==r.z||i[3]!==r.w)&&(u.uniform4ui(this.addr,r.x,r.y,r.z,r.w),i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=r.w);else{if(arraysEqual(i,r))return;u.uniform4uiv(this.addr,r),copyArray(i,r)}}function setValueT1(u,r,i){const m=this.cache,_=i.allocateTextureUnit();m[0]!==_&&(u.uniform1i(this.addr,_),m[0]=_),i.setTexture2D(r||emptyTexture,_)}function setValueT3D1(u,r,i){const m=this.cache,_=i.allocateTextureUnit();m[0]!==_&&(u.uniform1i(this.addr,_),m[0]=_),i.setTexture3D(r||empty3dTexture,_)}function setValueT6(u,r,i){const m=this.cache,_=i.allocateTextureUnit();m[0]!==_&&(u.uniform1i(this.addr,_),m[0]=_),i.setTextureCube(r||emptyCubeTexture,_)}function setValueT2DArray1(u,r,i){const m=this.cache,_=i.allocateTextureUnit();m[0]!==_&&(u.uniform1i(this.addr,_),m[0]=_),i.setTexture2DArray(r||emptyArrayTexture,_)}function getSingularSetter(u){switch(u){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(u,r){u.uniform1fv(this.addr,r)}function setValueV2fArray(u,r){const i=flatten(r,this.size,2);u.uniform2fv(this.addr,i)}function setValueV3fArray(u,r){const i=flatten(r,this.size,3);u.uniform3fv(this.addr,i)}function setValueV4fArray(u,r){const i=flatten(r,this.size,4);u.uniform4fv(this.addr,i)}function setValueM2Array(u,r){const i=flatten(r,this.size,4);u.uniformMatrix2fv(this.addr,!1,i)}function setValueM3Array(u,r){const i=flatten(r,this.size,9);u.uniformMatrix3fv(this.addr,!1,i)}function setValueM4Array(u,r){const i=flatten(r,this.size,16);u.uniformMatrix4fv(this.addr,!1,i)}function setValueV1iArray(u,r){u.uniform1iv(this.addr,r)}function setValueV2iArray(u,r){u.uniform2iv(this.addr,r)}function setValueV3iArray(u,r){u.uniform3iv(this.addr,r)}function setValueV4iArray(u,r){u.uniform4iv(this.addr,r)}function setValueV1uiArray(u,r){u.uniform1uiv(this.addr,r)}function setValueV2uiArray(u,r){u.uniform2uiv(this.addr,r)}function setValueV3uiArray(u,r){u.uniform3uiv(this.addr,r)}function setValueV4uiArray(u,r){u.uniform4uiv(this.addr,r)}function setValueT1Array(u,r,i){const m=this.cache,_=r.length,A=allocTexUnits(i,_);arraysEqual(m,A)||(u.uniform1iv(this.addr,A),copyArray(m,A));for(let w=0;w!==_;++w)i.setTexture2D(r[w]||emptyTexture,A[w])}function setValueT3DArray(u,r,i){const m=this.cache,_=r.length,A=allocTexUnits(i,_);arraysEqual(m,A)||(u.uniform1iv(this.addr,A),copyArray(m,A));for(let w=0;w!==_;++w)i.setTexture3D(r[w]||empty3dTexture,A[w])}function setValueT6Array(u,r,i){const m=this.cache,_=r.length,A=allocTexUnits(i,_);arraysEqual(m,A)||(u.uniform1iv(this.addr,A),copyArray(m,A));for(let w=0;w!==_;++w)i.setTextureCube(r[w]||emptyCubeTexture,A[w])}function setValueT2DArrayArray(u,r,i){const m=this.cache,_=r.length,A=allocTexUnits(i,_);arraysEqual(m,A)||(u.uniform1iv(this.addr,A),copyArray(m,A));for(let w=0;w!==_;++w)i.setTexture2DArray(r[w]||emptyArrayTexture,A[w])}function getPureArraySetter(u){switch(u){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(r,i,m){this.id=r,this.addr=m,this.cache=[],this.setValue=getSingularSetter(i.type)}}class PureArrayUniform{constructor(r,i,m){this.id=r,this.addr=m,this.cache=[],this.size=i.size,this.setValue=getPureArraySetter(i.type)}}class StructuredUniform{constructor(r){this.id=r,this.seq=[],this.map={}}setValue(r,i,m){const _=this.seq;for(let A=0,w=_.length;A!==w;++A){const T=_[A];T.setValue(r,i[T.id],m)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(u,r){u.seq.push(r),u.map[r.id]=r}function parseUniform(u,r,i){const m=u.name,_=m.length;for(RePathPart.lastIndex=0;;){const A=RePathPart.exec(m),w=RePathPart.lastIndex;let T=A[1];const R=A[2]==="]",D=A[3];if(R&&(T=T|0),D===void 0||D==="["&&w+2===_){addUniform(i,D===void 0?new SingleUniform(T,u,r):new PureArrayUniform(T,u,r));break}else{let k=i.map[T];k===void 0&&(k=new StructuredUniform(T),addUniform(i,k)),i=k}}}class WebGLUniforms{constructor(r,i){this.seq=[],this.map={};const m=r.getProgramParameter(i,r.ACTIVE_UNIFORMS);for(let _=0;_<m;++_){const A=r.getActiveUniform(i,_),w=r.getUniformLocation(i,A.name);parseUniform(A,w,this)}}setValue(r,i,m,_){const A=this.map[i];A!==void 0&&A.setValue(r,m,_)}setOptional(r,i,m){const _=i[m];_!==void 0&&this.setValue(r,m,_)}static upload(r,i,m,_){for(let A=0,w=i.length;A!==w;++A){const T=i[A],R=m[T.id];R.needsUpdate!==!1&&T.setValue(r,R.value,_)}}static seqWithValue(r,i){const m=[];for(let _=0,A=r.length;_!==A;++_){const w=r[_];w.id in i&&m.push(w)}return m}}function WebGLShader(u,r,i){const m=u.createShader(r);return u.shaderSource(m,i),u.compileShader(m),m}let programIdCount=0;function handleSource(u,r){const i=u.split(`
`),m=[],_=Math.max(r-6,0),A=Math.min(r+6,i.length);for(let w=_;w<A;w++){const T=w+1;m.push(`${T===r?">":" "} ${T}: ${i[w]}`)}return m.join(`
`)}function getEncodingComponents(u){switch(u){case LinearSRGBColorSpace:return["Linear","( value )"];case SRGBColorSpace:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",u),["Linear","( value )"]}}function getShaderErrors(u,r,i){const m=u.getShaderParameter(r,u.COMPILE_STATUS),_=u.getShaderInfoLog(r).trim();if(m&&_==="")return"";const A=/ERROR: 0:(\d+)/.exec(_);if(A){const w=parseInt(A[1]);return i.toUpperCase()+`

`+_+`

`+handleSource(u.getShaderSource(r),w)}else return _}function getTexelEncodingFunction(u,r){const i=getEncodingComponents(r);return"vec4 "+u+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(u,r){let i;switch(r){case LinearToneMapping:i="Linear";break;case ReinhardToneMapping:i="Reinhard";break;case CineonToneMapping:i="OptimizedCineon";break;case ACESFilmicToneMapping:i="ACESFilmic";break;case CustomToneMapping:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",r),i="Linear"}return"vec3 "+u+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function generateExtensions(u){return[u.extensionDerivatives||u.envMapCubeUVHeight||u.bumpMap||u.normalMapTangentSpace||u.clearcoatNormalMap||u.flatShading||u.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(u.extensionFragDepth||u.logarithmicDepthBuffer)&&u.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",u.extensionDrawBuffers&&u.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(u.extensionShaderTextureLOD||u.envMap||u.transmission)&&u.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join(`
`)}function generateDefines(u){const r=[];for(const i in u){const m=u[i];m!==!1&&r.push("#define "+i+" "+m)}return r.join(`
`)}function fetchAttributeLocations(u,r){const i={},m=u.getProgramParameter(r,u.ACTIVE_ATTRIBUTES);for(let _=0;_<m;_++){const A=u.getActiveAttrib(r,_),w=A.name;let T=1;A.type===u.FLOAT_MAT2&&(T=2),A.type===u.FLOAT_MAT3&&(T=3),A.type===u.FLOAT_MAT4&&(T=4),i[w]={type:A.type,location:u.getAttribLocation(r,w),locationSize:T}}return i}function filterEmptyLine(u){return u!==""}function replaceLightNums(u,r){const i=r.numSpotLightShadows+r.numSpotLightMaps-r.numSpotLightShadowsWithMaps;return u.replace(/NUM_DIR_LIGHTS/g,r.numDirLights).replace(/NUM_SPOT_LIGHTS/g,r.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,r.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,r.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,r.numPointLights).replace(/NUM_HEMI_LIGHTS/g,r.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,r.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,r.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,r.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,r.numPointLightShadows)}function replaceClippingPlaneNums(u,r){return u.replace(/NUM_CLIPPING_PLANES/g,r.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,r.numClippingPlanes-r.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(u){return u.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function includeReplacer(u,r){let i=ShaderChunk[r];if(i===void 0){const m=shaderChunkMap.get(r);if(m!==void 0)i=ShaderChunk[m],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',r,m);else throw new Error("Can not resolve #include <"+r+">")}return resolveIncludes(i)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(u){return u.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(u,r,i,m){let _="";for(let A=parseInt(r);A<parseInt(i);A++)_+=m.replace(/\[\s*i\s*\]/g,"[ "+A+" ]").replace(/UNROLLED_LOOP_INDEX/g,A);return _}function generatePrecision(u){let r="precision "+u.precision+` float;
precision `+u.precision+" int;";return u.precision==="highp"?r+=`
#define HIGH_PRECISION`:u.precision==="mediump"?r+=`
#define MEDIUM_PRECISION`:u.precision==="lowp"&&(r+=`
#define LOW_PRECISION`),r}function generateShadowMapTypeDefine(u){let r="SHADOWMAP_TYPE_BASIC";return u.shadowMapType===PCFShadowMap?r="SHADOWMAP_TYPE_PCF":u.shadowMapType===PCFSoftShadowMap?r="SHADOWMAP_TYPE_PCF_SOFT":u.shadowMapType===VSMShadowMap&&(r="SHADOWMAP_TYPE_VSM"),r}function generateEnvMapTypeDefine(u){let r="ENVMAP_TYPE_CUBE";if(u.envMap)switch(u.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:r="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:r="ENVMAP_TYPE_CUBE_UV";break}return r}function generateEnvMapModeDefine(u){let r="ENVMAP_MODE_REFLECTION";if(u.envMap)switch(u.envMapMode){case CubeRefractionMapping:r="ENVMAP_MODE_REFRACTION";break}return r}function generateEnvMapBlendingDefine(u){let r="ENVMAP_BLENDING_NONE";if(u.envMap)switch(u.combine){case MultiplyOperation:r="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:r="ENVMAP_BLENDING_MIX";break;case AddOperation:r="ENVMAP_BLENDING_ADD";break}return r}function generateCubeUVSize(u){const r=u.envMapCubeUVHeight;if(r===null)return null;const i=Math.log2(r)-2,m=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:m,maxMip:i}}function WebGLProgram(u,r,i,m){const _=u.getContext(),A=i.defines;let w=i.vertexShader,T=i.fragmentShader;const R=generateShadowMapTypeDefine(i),D=generateEnvMapTypeDefine(i),U=generateEnvMapModeDefine(i),k=generateEnvMapBlendingDefine(i),X=generateCubeUVSize(i),J=i.isWebGL2?"":generateExtensions(i),$=generateDefines(A),oe=_.createProgram();let ne,H,V=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(ne=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,$].filter(filterEmptyLine).join(`
`),ne.length>0&&(ne+=`
`),H=[J,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,$].filter(filterEmptyLine).join(`
`),H.length>0&&(H+=`
`)):(ne=[generatePrecision(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,$,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+U:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+R:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),H=[J,generatePrecision(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,$,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+D:"",i.envMap?"#define "+U:"",i.envMap?"#define "+k:"",X?"#define CUBEUV_TEXEL_WIDTH "+X.texelWidth:"",X?"#define CUBEUV_TEXEL_HEIGHT "+X.texelHeight:"",X?"#define CUBEUV_MAX_MIP "+X.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+R:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",i.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",i.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),w=resolveIncludes(w),w=replaceLightNums(w,i),w=replaceClippingPlaneNums(w,i),T=resolveIncludes(T),T=replaceLightNums(T,i),T=replaceClippingPlaneNums(T,i),w=unrollLoops(w),T=unrollLoops(T),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(V=`#version 300 es
`,ne=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ne,H=["#define varying in",i.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+H);const z=V+ne+w,ce=V+H+T,ue=WebGLShader(_,_.VERTEX_SHADER,z),he=WebGLShader(_,_.FRAGMENT_SHADER,ce);if(_.attachShader(oe,ue),_.attachShader(oe,he),i.index0AttributeName!==void 0?_.bindAttribLocation(oe,0,i.index0AttributeName):i.morphTargets===!0&&_.bindAttribLocation(oe,0,"position"),_.linkProgram(oe),u.debug.checkShaderErrors){const ie=_.getProgramInfoLog(oe).trim(),ve=_.getShaderInfoLog(ue).trim(),re=_.getShaderInfoLog(he).trim();let ae=!0,me=!0;if(_.getProgramParameter(oe,_.LINK_STATUS)===!1)if(ae=!1,typeof u.debug.onShaderError=="function")u.debug.onShaderError(_,oe,ue,he);else{const ye=getShaderErrors(_,ue,"vertex"),Te=getShaderErrors(_,he,"fragment");console.error("THREE.WebGLProgram: Shader Error "+_.getError()+" - VALIDATE_STATUS "+_.getProgramParameter(oe,_.VALIDATE_STATUS)+`

Program Info Log: `+ie+`
`+ye+`
`+Te)}else ie!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ie):(ve===""||re==="")&&(me=!1);me&&(this.diagnostics={runnable:ae,programLog:ie,vertexShader:{log:ve,prefix:ne},fragmentShader:{log:re,prefix:H}})}_.deleteShader(ue),_.deleteShader(he);let K;this.getUniforms=function(){return K===void 0&&(K=new WebGLUniforms(_,oe)),K};let Y;return this.getAttributes=function(){return Y===void 0&&(Y=fetchAttributeLocations(_,oe)),Y},this.destroy=function(){m.releaseStatesOfProgram(this),_.deleteProgram(oe),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=programIdCount++,this.cacheKey=r,this.usedTimes=1,this.program=oe,this.vertexShader=ue,this.fragmentShader=he,this}let _id$1=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(r){const i=r.vertexShader,m=r.fragmentShader,_=this._getShaderStage(i),A=this._getShaderStage(m),w=this._getShaderCacheForMaterial(r);return w.has(_)===!1&&(w.add(_),_.usedTimes++),w.has(A)===!1&&(w.add(A),A.usedTimes++),this}remove(r){const i=this.materialCache.get(r);for(const m of i)m.usedTimes--,m.usedTimes===0&&this.shaderCache.delete(m.code);return this.materialCache.delete(r),this}getVertexShaderID(r){return this._getShaderStage(r.vertexShader).id}getFragmentShaderID(r){return this._getShaderStage(r.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(r){const i=this.materialCache;let m=i.get(r);return m===void 0&&(m=new Set,i.set(r,m)),m}_getShaderStage(r){const i=this.shaderCache;let m=i.get(r);return m===void 0&&(m=new WebGLShaderStage(r),i.set(r,m)),m}}class WebGLShaderStage{constructor(r){this.id=_id$1++,this.code=r,this.usedTimes=0}}function WebGLPrograms(u,r,i,m,_,A,w){const T=new Layers,R=new WebGLShaderCache,D=[],U=_.isWebGL2,k=_.logarithmicDepthBuffer,X=_.vertexTextures;let J=_.precision;const $={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function oe(ie){return ie===0?"uv":`uv${ie}`}function ne(ie,ve,re,ae,me){const ye=ae.fog,Te=me.geometry,ke=ie.isMeshStandardMaterial?ae.environment:null,Fe=(ie.isMeshStandardMaterial?i:r).get(ie.envMap||ke),Ve=Fe&&Fe.mapping===CubeUVReflectionMapping?Fe.image.height:null,ot=$[ie.type];ie.precision!==null&&(J=_.getMaxPrecision(ie.precision),J!==ie.precision&&console.warn("THREE.WebGLProgram.getParameters:",ie.precision,"not supported, using",J,"instead."));const Ye=Te.morphAttributes.position||Te.morphAttributes.normal||Te.morphAttributes.color,Ze=Ye!==void 0?Ye.length:0;let tt=0;Te.morphAttributes.position!==void 0&&(tt=1),Te.morphAttributes.normal!==void 0&&(tt=2),Te.morphAttributes.color!==void 0&&(tt=3);let Pt,Et,Ne,et;if(ot){const es=ShaderLib[ot];Pt=es.vertexShader,Et=es.fragmentShader}else Pt=ie.vertexShader,Et=ie.fragmentShader,R.update(ie),Ne=R.getVertexShaderID(ie),et=R.getFragmentShaderID(ie);const wt=u.getRenderTarget(),Zt=me.isInstancedMesh===!0,nn=!!ie.map,Vn=!!ie.matcap,Jn=!!Fe,Ue=!!ie.aoMap,St=!!ie.lightMap,Lt=!!ie.bumpMap,jt=!!ie.normalMap,Gt=!!ie.displacementMap,fn=!!ie.emissiveMap,hn=!!ie.metalnessMap,qt=!!ie.roughnessMap,An=ie.anisotropy>0,_n=ie.clearcoat>0,Bn=ie.iridescence>0,de=ie.sheen>0,Ae=ie.transmission>0,Le=An&&!!ie.anisotropyMap,Oe=_n&&!!ie.clearcoatMap,$e=_n&&!!ie.clearcoatNormalMap,pt=_n&&!!ie.clearcoatRoughnessMap,Mt=Bn&&!!ie.iridescenceMap,Bt=Bn&&!!ie.iridescenceThicknessMap,xt=de&&!!ie.sheenColorMap,ht=de&&!!ie.sheenRoughnessMap,zt=!!ie.specularMap,dn=!!ie.specularColorMap,en=!!ie.specularIntensityMap,xn=Ae&&!!ie.transmissionMap,wi=Ae&&!!ie.thicknessMap,Gi=!!ie.gradientMap,Pe=!!ie.alphaMap,oi=ie.alphaTest>0,pn=!!ie.alphaHash,Dn=!!ie.extensions,kn=!!Te.attributes.uv1,ui=!!Te.attributes.uv2,Nr=!!Te.attributes.uv3;let Pr=NoToneMapping;return ie.toneMapped&&(wt===null||wt.isXRRenderTarget===!0)&&(Pr=u.toneMapping),{isWebGL2:U,shaderID:ot,shaderType:ie.type,shaderName:ie.name,vertexShader:Pt,fragmentShader:Et,defines:ie.defines,customVertexShaderID:Ne,customFragmentShaderID:et,isRawShaderMaterial:ie.isRawShaderMaterial===!0,glslVersion:ie.glslVersion,precision:J,instancing:Zt,instancingColor:Zt&&me.instanceColor!==null,supportsVertexTextures:X,outputColorSpace:wt===null?u.outputColorSpace:wt.isXRRenderTarget===!0?wt.texture.colorSpace:LinearSRGBColorSpace,map:nn,matcap:Vn,envMap:Jn,envMapMode:Jn&&Fe.mapping,envMapCubeUVHeight:Ve,aoMap:Ue,lightMap:St,bumpMap:Lt,normalMap:jt,displacementMap:X&&Gt,emissiveMap:fn,normalMapObjectSpace:jt&&ie.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:jt&&ie.normalMapType===TangentSpaceNormalMap,metalnessMap:hn,roughnessMap:qt,anisotropy:An,anisotropyMap:Le,clearcoat:_n,clearcoatMap:Oe,clearcoatNormalMap:$e,clearcoatRoughnessMap:pt,iridescence:Bn,iridescenceMap:Mt,iridescenceThicknessMap:Bt,sheen:de,sheenColorMap:xt,sheenRoughnessMap:ht,specularMap:zt,specularColorMap:dn,specularIntensityMap:en,transmission:Ae,transmissionMap:xn,thicknessMap:wi,gradientMap:Gi,opaque:ie.transparent===!1&&ie.blending===NormalBlending,alphaMap:Pe,alphaTest:oi,alphaHash:pn,combine:ie.combine,mapUv:nn&&oe(ie.map.channel),aoMapUv:Ue&&oe(ie.aoMap.channel),lightMapUv:St&&oe(ie.lightMap.channel),bumpMapUv:Lt&&oe(ie.bumpMap.channel),normalMapUv:jt&&oe(ie.normalMap.channel),displacementMapUv:Gt&&oe(ie.displacementMap.channel),emissiveMapUv:fn&&oe(ie.emissiveMap.channel),metalnessMapUv:hn&&oe(ie.metalnessMap.channel),roughnessMapUv:qt&&oe(ie.roughnessMap.channel),anisotropyMapUv:Le&&oe(ie.anisotropyMap.channel),clearcoatMapUv:Oe&&oe(ie.clearcoatMap.channel),clearcoatNormalMapUv:$e&&oe(ie.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:pt&&oe(ie.clearcoatRoughnessMap.channel),iridescenceMapUv:Mt&&oe(ie.iridescenceMap.channel),iridescenceThicknessMapUv:Bt&&oe(ie.iridescenceThicknessMap.channel),sheenColorMapUv:xt&&oe(ie.sheenColorMap.channel),sheenRoughnessMapUv:ht&&oe(ie.sheenRoughnessMap.channel),specularMapUv:zt&&oe(ie.specularMap.channel),specularColorMapUv:dn&&oe(ie.specularColorMap.channel),specularIntensityMapUv:en&&oe(ie.specularIntensityMap.channel),transmissionMapUv:xn&&oe(ie.transmissionMap.channel),thicknessMapUv:wi&&oe(ie.thicknessMap.channel),alphaMapUv:Pe&&oe(ie.alphaMap.channel),vertexTangents:!!Te.attributes.tangent&&(jt||An),vertexColors:ie.vertexColors,vertexAlphas:ie.vertexColors===!0&&!!Te.attributes.color&&Te.attributes.color.itemSize===4,vertexUv1s:kn,vertexUv2s:ui,vertexUv3s:Nr,pointsUvs:me.isPoints===!0&&!!Te.attributes.uv&&(nn||Pe),fog:!!ye,useFog:ie.fog===!0,fogExp2:ye&&ye.isFogExp2,flatShading:ie.flatShading===!0,sizeAttenuation:ie.sizeAttenuation===!0,logarithmicDepthBuffer:k,skinning:me.isSkinnedMesh===!0,morphTargets:Te.morphAttributes.position!==void 0,morphNormals:Te.morphAttributes.normal!==void 0,morphColors:Te.morphAttributes.color!==void 0,morphTargetsCount:Ze,morphTextureStride:tt,numDirLights:ve.directional.length,numPointLights:ve.point.length,numSpotLights:ve.spot.length,numSpotLightMaps:ve.spotLightMap.length,numRectAreaLights:ve.rectArea.length,numHemiLights:ve.hemi.length,numDirLightShadows:ve.directionalShadowMap.length,numPointLightShadows:ve.pointShadowMap.length,numSpotLightShadows:ve.spotShadowMap.length,numSpotLightShadowsWithMaps:ve.numSpotLightShadowsWithMaps,numClippingPlanes:w.numPlanes,numClipIntersection:w.numIntersection,dithering:ie.dithering,shadowMapEnabled:u.shadowMap.enabled&&re.length>0,shadowMapType:u.shadowMap.type,toneMapping:Pr,useLegacyLights:u._useLegacyLights,decodeVideoTexture:nn&&ie.map.isVideoTexture===!0&&ie.map.colorSpace===SRGBColorSpace,premultipliedAlpha:ie.premultipliedAlpha,doubleSided:ie.side===DoubleSide,flipSided:ie.side===BackSide,useDepthPacking:ie.depthPacking>=0,depthPacking:ie.depthPacking||0,index0AttributeName:ie.index0AttributeName,extensionDerivatives:Dn&&ie.extensions.derivatives===!0,extensionFragDepth:Dn&&ie.extensions.fragDepth===!0,extensionDrawBuffers:Dn&&ie.extensions.drawBuffers===!0,extensionShaderTextureLOD:Dn&&ie.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:U||m.has("EXT_frag_depth"),rendererExtensionDrawBuffers:U||m.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:U||m.has("EXT_shader_texture_lod"),customProgramCacheKey:ie.customProgramCacheKey()}}function H(ie){const ve=[];if(ie.shaderID?ve.push(ie.shaderID):(ve.push(ie.customVertexShaderID),ve.push(ie.customFragmentShaderID)),ie.defines!==void 0)for(const re in ie.defines)ve.push(re),ve.push(ie.defines[re]);return ie.isRawShaderMaterial===!1&&(V(ve,ie),z(ve,ie),ve.push(u.outputColorSpace)),ve.push(ie.customProgramCacheKey),ve.join()}function V(ie,ve){ie.push(ve.precision),ie.push(ve.outputColorSpace),ie.push(ve.envMapMode),ie.push(ve.envMapCubeUVHeight),ie.push(ve.mapUv),ie.push(ve.alphaMapUv),ie.push(ve.lightMapUv),ie.push(ve.aoMapUv),ie.push(ve.bumpMapUv),ie.push(ve.normalMapUv),ie.push(ve.displacementMapUv),ie.push(ve.emissiveMapUv),ie.push(ve.metalnessMapUv),ie.push(ve.roughnessMapUv),ie.push(ve.anisotropyMapUv),ie.push(ve.clearcoatMapUv),ie.push(ve.clearcoatNormalMapUv),ie.push(ve.clearcoatRoughnessMapUv),ie.push(ve.iridescenceMapUv),ie.push(ve.iridescenceThicknessMapUv),ie.push(ve.sheenColorMapUv),ie.push(ve.sheenRoughnessMapUv),ie.push(ve.specularMapUv),ie.push(ve.specularColorMapUv),ie.push(ve.specularIntensityMapUv),ie.push(ve.transmissionMapUv),ie.push(ve.thicknessMapUv),ie.push(ve.combine),ie.push(ve.fogExp2),ie.push(ve.sizeAttenuation),ie.push(ve.morphTargetsCount),ie.push(ve.morphAttributeCount),ie.push(ve.numDirLights),ie.push(ve.numPointLights),ie.push(ve.numSpotLights),ie.push(ve.numSpotLightMaps),ie.push(ve.numHemiLights),ie.push(ve.numRectAreaLights),ie.push(ve.numDirLightShadows),ie.push(ve.numPointLightShadows),ie.push(ve.numSpotLightShadows),ie.push(ve.numSpotLightShadowsWithMaps),ie.push(ve.shadowMapType),ie.push(ve.toneMapping),ie.push(ve.numClippingPlanes),ie.push(ve.numClipIntersection),ie.push(ve.depthPacking)}function z(ie,ve){T.disableAll(),ve.isWebGL2&&T.enable(0),ve.supportsVertexTextures&&T.enable(1),ve.instancing&&T.enable(2),ve.instancingColor&&T.enable(3),ve.matcap&&T.enable(4),ve.envMap&&T.enable(5),ve.normalMapObjectSpace&&T.enable(6),ve.normalMapTangentSpace&&T.enable(7),ve.clearcoat&&T.enable(8),ve.iridescence&&T.enable(9),ve.alphaTest&&T.enable(10),ve.vertexColors&&T.enable(11),ve.vertexAlphas&&T.enable(12),ve.vertexUv1s&&T.enable(13),ve.vertexUv2s&&T.enable(14),ve.vertexUv3s&&T.enable(15),ve.vertexTangents&&T.enable(16),ve.anisotropy&&T.enable(17),ie.push(T.mask),T.disableAll(),ve.fog&&T.enable(0),ve.useFog&&T.enable(1),ve.flatShading&&T.enable(2),ve.logarithmicDepthBuffer&&T.enable(3),ve.skinning&&T.enable(4),ve.morphTargets&&T.enable(5),ve.morphNormals&&T.enable(6),ve.morphColors&&T.enable(7),ve.premultipliedAlpha&&T.enable(8),ve.shadowMapEnabled&&T.enable(9),ve.useLegacyLights&&T.enable(10),ve.doubleSided&&T.enable(11),ve.flipSided&&T.enable(12),ve.useDepthPacking&&T.enable(13),ve.dithering&&T.enable(14),ve.transmission&&T.enable(15),ve.sheen&&T.enable(16),ve.opaque&&T.enable(17),ve.pointsUvs&&T.enable(18),ve.decodeVideoTexture&&T.enable(19),ie.push(T.mask)}function ce(ie){const ve=$[ie.type];let re;if(ve){const ae=ShaderLib[ve];re=UniformsUtils.clone(ae.uniforms)}else re=ie.uniforms;return re}function ue(ie,ve){let re;for(let ae=0,me=D.length;ae<me;ae++){const ye=D[ae];if(ye.cacheKey===ve){re=ye,++re.usedTimes;break}}return re===void 0&&(re=new WebGLProgram(u,ve,ie,A),D.push(re)),re}function he(ie){if(--ie.usedTimes===0){const ve=D.indexOf(ie);D[ve]=D[D.length-1],D.pop(),ie.destroy()}}function K(ie){R.remove(ie)}function Y(){R.dispose()}return{getParameters:ne,getProgramCacheKey:H,getUniforms:ce,acquireProgram:ue,releaseProgram:he,releaseShaderCache:K,programs:D,dispose:Y}}function WebGLProperties(){let u=new WeakMap;function r(A){let w=u.get(A);return w===void 0&&(w={},u.set(A,w)),w}function i(A){u.delete(A)}function m(A,w,T){u.get(A)[w]=T}function _(){u=new WeakMap}return{get:r,remove:i,update:m,dispose:_}}function painterSortStable(u,r){return u.groupOrder!==r.groupOrder?u.groupOrder-r.groupOrder:u.renderOrder!==r.renderOrder?u.renderOrder-r.renderOrder:u.material.id!==r.material.id?u.material.id-r.material.id:u.z!==r.z?u.z-r.z:u.id-r.id}function reversePainterSortStable(u,r){return u.groupOrder!==r.groupOrder?u.groupOrder-r.groupOrder:u.renderOrder!==r.renderOrder?u.renderOrder-r.renderOrder:u.z!==r.z?r.z-u.z:u.id-r.id}function WebGLRenderList(){const u=[];let r=0;const i=[],m=[],_=[];function A(){r=0,i.length=0,m.length=0,_.length=0}function w(k,X,J,$,oe,ne){let H=u[r];return H===void 0?(H={id:k.id,object:k,geometry:X,material:J,groupOrder:$,renderOrder:k.renderOrder,z:oe,group:ne},u[r]=H):(H.id=k.id,H.object=k,H.geometry=X,H.material=J,H.groupOrder=$,H.renderOrder=k.renderOrder,H.z=oe,H.group=ne),r++,H}function T(k,X,J,$,oe,ne){const H=w(k,X,J,$,oe,ne);J.transmission>0?m.push(H):J.transparent===!0?_.push(H):i.push(H)}function R(k,X,J,$,oe,ne){const H=w(k,X,J,$,oe,ne);J.transmission>0?m.unshift(H):J.transparent===!0?_.unshift(H):i.unshift(H)}function D(k,X){i.length>1&&i.sort(k||painterSortStable),m.length>1&&m.sort(X||reversePainterSortStable),_.length>1&&_.sort(X||reversePainterSortStable)}function U(){for(let k=r,X=u.length;k<X;k++){const J=u[k];if(J.id===null)break;J.id=null,J.object=null,J.geometry=null,J.material=null,J.group=null}}return{opaque:i,transmissive:m,transparent:_,init:A,push:T,unshift:R,finish:U,sort:D}}function WebGLRenderLists(){let u=new WeakMap;function r(m,_){const A=u.get(m);let w;return A===void 0?(w=new WebGLRenderList,u.set(m,[w])):_>=A.length?(w=new WebGLRenderList,A.push(w)):w=A[_],w}function i(){u=new WeakMap}return{get:r,dispose:i}}function UniformsCache(){const u={};return{get:function(r){if(u[r.id]!==void 0)return u[r.id];let i;switch(r.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return u[r.id]=i,i}}}function ShadowUniformsCache(){const u={};return{get:function(r){if(u[r.id]!==void 0)return u[r.id];let i;switch(r.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return u[r.id]=i,i}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(u,r){return(r.castShadow?2:0)-(u.castShadow?2:0)+(r.map?1:0)-(u.map?1:0)}function WebGLLights(u,r){const i=new UniformsCache,m=ShadowUniformsCache(),_={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let U=0;U<9;U++)_.probe.push(new Vector3);const A=new Vector3,w=new Matrix4,T=new Matrix4;function R(U,k){let X=0,J=0,$=0;for(let re=0;re<9;re++)_.probe[re].set(0,0,0);let oe=0,ne=0,H=0,V=0,z=0,ce=0,ue=0,he=0,K=0,Y=0;U.sort(shadowCastingAndTexturingLightsFirst);const ie=k===!0?Math.PI:1;for(let re=0,ae=U.length;re<ae;re++){const me=U[re],ye=me.color,Te=me.intensity,ke=me.distance,Fe=me.shadow&&me.shadow.map?me.shadow.map.texture:null;if(me.isAmbientLight)X+=ye.r*Te*ie,J+=ye.g*Te*ie,$+=ye.b*Te*ie;else if(me.isLightProbe)for(let Ve=0;Ve<9;Ve++)_.probe[Ve].addScaledVector(me.sh.coefficients[Ve],Te);else if(me.isDirectionalLight){const Ve=i.get(me);if(Ve.color.copy(me.color).multiplyScalar(me.intensity*ie),me.castShadow){const ot=me.shadow,Ye=m.get(me);Ye.shadowBias=ot.bias,Ye.shadowNormalBias=ot.normalBias,Ye.shadowRadius=ot.radius,Ye.shadowMapSize=ot.mapSize,_.directionalShadow[oe]=Ye,_.directionalShadowMap[oe]=Fe,_.directionalShadowMatrix[oe]=me.shadow.matrix,ce++}_.directional[oe]=Ve,oe++}else if(me.isSpotLight){const Ve=i.get(me);Ve.position.setFromMatrixPosition(me.matrixWorld),Ve.color.copy(ye).multiplyScalar(Te*ie),Ve.distance=ke,Ve.coneCos=Math.cos(me.angle),Ve.penumbraCos=Math.cos(me.angle*(1-me.penumbra)),Ve.decay=me.decay,_.spot[H]=Ve;const ot=me.shadow;if(me.map&&(_.spotLightMap[K]=me.map,K++,ot.updateMatrices(me),me.castShadow&&Y++),_.spotLightMatrix[H]=ot.matrix,me.castShadow){const Ye=m.get(me);Ye.shadowBias=ot.bias,Ye.shadowNormalBias=ot.normalBias,Ye.shadowRadius=ot.radius,Ye.shadowMapSize=ot.mapSize,_.spotShadow[H]=Ye,_.spotShadowMap[H]=Fe,he++}H++}else if(me.isRectAreaLight){const Ve=i.get(me);Ve.color.copy(ye).multiplyScalar(Te),Ve.halfWidth.set(me.width*.5,0,0),Ve.halfHeight.set(0,me.height*.5,0),_.rectArea[V]=Ve,V++}else if(me.isPointLight){const Ve=i.get(me);if(Ve.color.copy(me.color).multiplyScalar(me.intensity*ie),Ve.distance=me.distance,Ve.decay=me.decay,me.castShadow){const ot=me.shadow,Ye=m.get(me);Ye.shadowBias=ot.bias,Ye.shadowNormalBias=ot.normalBias,Ye.shadowRadius=ot.radius,Ye.shadowMapSize=ot.mapSize,Ye.shadowCameraNear=ot.camera.near,Ye.shadowCameraFar=ot.camera.far,_.pointShadow[ne]=Ye,_.pointShadowMap[ne]=Fe,_.pointShadowMatrix[ne]=me.shadow.matrix,ue++}_.point[ne]=Ve,ne++}else if(me.isHemisphereLight){const Ve=i.get(me);Ve.skyColor.copy(me.color).multiplyScalar(Te*ie),Ve.groundColor.copy(me.groundColor).multiplyScalar(Te*ie),_.hemi[z]=Ve,z++}}V>0&&(r.isWebGL2||u.has("OES_texture_float_linear")===!0?(_.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,_.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):u.has("OES_texture_half_float_linear")===!0?(_.rectAreaLTC1=UniformsLib.LTC_HALF_1,_.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),_.ambient[0]=X,_.ambient[1]=J,_.ambient[2]=$;const ve=_.hash;(ve.directionalLength!==oe||ve.pointLength!==ne||ve.spotLength!==H||ve.rectAreaLength!==V||ve.hemiLength!==z||ve.numDirectionalShadows!==ce||ve.numPointShadows!==ue||ve.numSpotShadows!==he||ve.numSpotMaps!==K)&&(_.directional.length=oe,_.spot.length=H,_.rectArea.length=V,_.point.length=ne,_.hemi.length=z,_.directionalShadow.length=ce,_.directionalShadowMap.length=ce,_.pointShadow.length=ue,_.pointShadowMap.length=ue,_.spotShadow.length=he,_.spotShadowMap.length=he,_.directionalShadowMatrix.length=ce,_.pointShadowMatrix.length=ue,_.spotLightMatrix.length=he+K-Y,_.spotLightMap.length=K,_.numSpotLightShadowsWithMaps=Y,ve.directionalLength=oe,ve.pointLength=ne,ve.spotLength=H,ve.rectAreaLength=V,ve.hemiLength=z,ve.numDirectionalShadows=ce,ve.numPointShadows=ue,ve.numSpotShadows=he,ve.numSpotMaps=K,_.version=nextVersion++)}function D(U,k){let X=0,J=0,$=0,oe=0,ne=0;const H=k.matrixWorldInverse;for(let V=0,z=U.length;V<z;V++){const ce=U[V];if(ce.isDirectionalLight){const ue=_.directional[X];ue.direction.setFromMatrixPosition(ce.matrixWorld),A.setFromMatrixPosition(ce.target.matrixWorld),ue.direction.sub(A),ue.direction.transformDirection(H),X++}else if(ce.isSpotLight){const ue=_.spot[$];ue.position.setFromMatrixPosition(ce.matrixWorld),ue.position.applyMatrix4(H),ue.direction.setFromMatrixPosition(ce.matrixWorld),A.setFromMatrixPosition(ce.target.matrixWorld),ue.direction.sub(A),ue.direction.transformDirection(H),$++}else if(ce.isRectAreaLight){const ue=_.rectArea[oe];ue.position.setFromMatrixPosition(ce.matrixWorld),ue.position.applyMatrix4(H),T.identity(),w.copy(ce.matrixWorld),w.premultiply(H),T.extractRotation(w),ue.halfWidth.set(ce.width*.5,0,0),ue.halfHeight.set(0,ce.height*.5,0),ue.halfWidth.applyMatrix4(T),ue.halfHeight.applyMatrix4(T),oe++}else if(ce.isPointLight){const ue=_.point[J];ue.position.setFromMatrixPosition(ce.matrixWorld),ue.position.applyMatrix4(H),J++}else if(ce.isHemisphereLight){const ue=_.hemi[ne];ue.direction.setFromMatrixPosition(ce.matrixWorld),ue.direction.transformDirection(H),ne++}}}return{setup:R,setupView:D,state:_}}function WebGLRenderState(u,r){const i=new WebGLLights(u,r),m=[],_=[];function A(){m.length=0,_.length=0}function w(k){m.push(k)}function T(k){_.push(k)}function R(k){i.setup(m,k)}function D(k){i.setupView(m,k)}return{init:A,state:{lightsArray:m,shadowsArray:_,lights:i},setupLights:R,setupLightsView:D,pushLight:w,pushShadow:T}}function WebGLRenderStates(u,r){let i=new WeakMap;function m(A,w=0){const T=i.get(A);let R;return T===void 0?(R=new WebGLRenderState(u,r),i.set(A,[R])):w>=T.length?(R=new WebGLRenderState(u,r),T.push(R)):R=T[w],R}function _(){i=new WeakMap}return{get:m,dispose:_}}class MeshDepthMaterial extends Material{constructor(r){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(r)}copy(r){return super.copy(r),this.depthPacking=r.depthPacking,this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(r){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(r)}copy(r){return super.copy(r),this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(u,r,i){let m=new Frustum;const _=new Vector2,A=new Vector2,w=new Vector4,T=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),R=new MeshDistanceMaterial,D={},U=i.maxTextureSize,k={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},X=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),J=X.clone();J.defines.HORIZONTAL_PASS=1;const $=new BufferGeometry$1;$.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const oe=new Mesh($,X),ne=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let H=this.type;this.render=function(ue,he,K){if(ne.enabled===!1||ne.autoUpdate===!1&&ne.needsUpdate===!1||ue.length===0)return;const Y=u.getRenderTarget(),ie=u.getActiveCubeFace(),ve=u.getActiveMipmapLevel(),re=u.state;re.setBlending(NoBlending),re.buffers.color.setClear(1,1,1,1),re.buffers.depth.setTest(!0),re.setScissorTest(!1);const ae=H!==VSMShadowMap&&this.type===VSMShadowMap,me=H===VSMShadowMap&&this.type!==VSMShadowMap;for(let ye=0,Te=ue.length;ye<Te;ye++){const ke=ue[ye],Fe=ke.shadow;if(Fe===void 0){console.warn("THREE.WebGLShadowMap:",ke,"has no shadow.");continue}if(Fe.autoUpdate===!1&&Fe.needsUpdate===!1)continue;_.copy(Fe.mapSize);const Ve=Fe.getFrameExtents();if(_.multiply(Ve),A.copy(Fe.mapSize),(_.x>U||_.y>U)&&(_.x>U&&(A.x=Math.floor(U/Ve.x),_.x=A.x*Ve.x,Fe.mapSize.x=A.x),_.y>U&&(A.y=Math.floor(U/Ve.y),_.y=A.y*Ve.y,Fe.mapSize.y=A.y)),Fe.map===null||ae===!0||me===!0){const Ye=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};Fe.map!==null&&Fe.map.dispose(),Fe.map=new WebGLRenderTarget(_.x,_.y,Ye),Fe.map.texture.name=ke.name+".shadowMap",Fe.camera.updateProjectionMatrix()}u.setRenderTarget(Fe.map),u.clear();const ot=Fe.getViewportCount();for(let Ye=0;Ye<ot;Ye++){const Ze=Fe.getViewport(Ye);w.set(A.x*Ze.x,A.y*Ze.y,A.x*Ze.z,A.y*Ze.w),re.viewport(w),Fe.updateMatrices(ke,Ye),m=Fe.getFrustum(),ce(he,K,Fe.camera,ke,this.type)}Fe.isPointLightShadow!==!0&&this.type===VSMShadowMap&&V(Fe,K),Fe.needsUpdate=!1}H=this.type,ne.needsUpdate=!1,u.setRenderTarget(Y,ie,ve)};function V(ue,he){const K=r.update(oe);X.defines.VSM_SAMPLES!==ue.blurSamples&&(X.defines.VSM_SAMPLES=ue.blurSamples,J.defines.VSM_SAMPLES=ue.blurSamples,X.needsUpdate=!0,J.needsUpdate=!0),ue.mapPass===null&&(ue.mapPass=new WebGLRenderTarget(_.x,_.y)),X.uniforms.shadow_pass.value=ue.map.texture,X.uniforms.resolution.value=ue.mapSize,X.uniforms.radius.value=ue.radius,u.setRenderTarget(ue.mapPass),u.clear(),u.renderBufferDirect(he,null,K,X,oe,null),J.uniforms.shadow_pass.value=ue.mapPass.texture,J.uniforms.resolution.value=ue.mapSize,J.uniforms.radius.value=ue.radius,u.setRenderTarget(ue.map),u.clear(),u.renderBufferDirect(he,null,K,J,oe,null)}function z(ue,he,K,Y){let ie=null;const ve=K.isPointLight===!0?ue.customDistanceMaterial:ue.customDepthMaterial;if(ve!==void 0)ie=ve;else if(ie=K.isPointLight===!0?R:T,u.localClippingEnabled&&he.clipShadows===!0&&Array.isArray(he.clippingPlanes)&&he.clippingPlanes.length!==0||he.displacementMap&&he.displacementScale!==0||he.alphaMap&&he.alphaTest>0||he.map&&he.alphaTest>0){const re=ie.uuid,ae=he.uuid;let me=D[re];me===void 0&&(me={},D[re]=me);let ye=me[ae];ye===void 0&&(ye=ie.clone(),me[ae]=ye),ie=ye}if(ie.visible=he.visible,ie.wireframe=he.wireframe,Y===VSMShadowMap?ie.side=he.shadowSide!==null?he.shadowSide:he.side:ie.side=he.shadowSide!==null?he.shadowSide:k[he.side],ie.alphaMap=he.alphaMap,ie.alphaTest=he.alphaTest,ie.map=he.map,ie.clipShadows=he.clipShadows,ie.clippingPlanes=he.clippingPlanes,ie.clipIntersection=he.clipIntersection,ie.displacementMap=he.displacementMap,ie.displacementScale=he.displacementScale,ie.displacementBias=he.displacementBias,ie.wireframeLinewidth=he.wireframeLinewidth,ie.linewidth=he.linewidth,K.isPointLight===!0&&ie.isMeshDistanceMaterial===!0){const re=u.properties.get(ie);re.light=K}return ie}function ce(ue,he,K,Y,ie){if(ue.visible===!1)return;if(ue.layers.test(he.layers)&&(ue.isMesh||ue.isLine||ue.isPoints)&&(ue.castShadow||ue.receiveShadow&&ie===VSMShadowMap)&&(!ue.frustumCulled||m.intersectsObject(ue))){ue.modelViewMatrix.multiplyMatrices(K.matrixWorldInverse,ue.matrixWorld);const ae=r.update(ue),me=ue.material;if(Array.isArray(me)){const ye=ae.groups;for(let Te=0,ke=ye.length;Te<ke;Te++){const Fe=ye[Te],Ve=me[Fe.materialIndex];if(Ve&&Ve.visible){const ot=z(ue,Ve,Y,ie);u.renderBufferDirect(K,null,ae,ot,ue,Fe)}}}else if(me.visible){const ye=z(ue,me,Y,ie);u.renderBufferDirect(K,null,ae,ye,ue,null)}}const re=ue.children;for(let ae=0,me=re.length;ae<me;ae++)ce(re[ae],he,K,Y,ie)}}function WebGLState(u,r,i){const m=i.isWebGL2;function _(){let Pe=!1;const oi=new Vector4;let pn=null;const Dn=new Vector4(0,0,0,0);return{setMask:function(kn){pn!==kn&&!Pe&&(u.colorMask(kn,kn,kn,kn),pn=kn)},setLocked:function(kn){Pe=kn},setClear:function(kn,ui,Nr,Pr,wr){wr===!0&&(kn*=Pr,ui*=Pr,Nr*=Pr),oi.set(kn,ui,Nr,Pr),Dn.equals(oi)===!1&&(u.clearColor(kn,ui,Nr,Pr),Dn.copy(oi))},reset:function(){Pe=!1,pn=null,Dn.set(-1,0,0,0)}}}function A(){let Pe=!1,oi=null,pn=null,Dn=null;return{setTest:function(kn){kn?wt(u.DEPTH_TEST):Zt(u.DEPTH_TEST)},setMask:function(kn){oi!==kn&&!Pe&&(u.depthMask(kn),oi=kn)},setFunc:function(kn){if(pn!==kn){switch(kn){case NeverDepth:u.depthFunc(u.NEVER);break;case AlwaysDepth:u.depthFunc(u.ALWAYS);break;case LessDepth:u.depthFunc(u.LESS);break;case LessEqualDepth:u.depthFunc(u.LEQUAL);break;case EqualDepth:u.depthFunc(u.EQUAL);break;case GreaterEqualDepth:u.depthFunc(u.GEQUAL);break;case GreaterDepth:u.depthFunc(u.GREATER);break;case NotEqualDepth:u.depthFunc(u.NOTEQUAL);break;default:u.depthFunc(u.LEQUAL)}pn=kn}},setLocked:function(kn){Pe=kn},setClear:function(kn){Dn!==kn&&(u.clearDepth(kn),Dn=kn)},reset:function(){Pe=!1,oi=null,pn=null,Dn=null}}}function w(){let Pe=!1,oi=null,pn=null,Dn=null,kn=null,ui=null,Nr=null,Pr=null,wr=null;return{setTest:function(es){Pe||(es?wt(u.STENCIL_TEST):Zt(u.STENCIL_TEST))},setMask:function(es){oi!==es&&!Pe&&(u.stencilMask(es),oi=es)},setFunc:function(es,Ps,Jr){(pn!==es||Dn!==Ps||kn!==Jr)&&(u.stencilFunc(es,Ps,Jr),pn=es,Dn=Ps,kn=Jr)},setOp:function(es,Ps,Jr){(ui!==es||Nr!==Ps||Pr!==Jr)&&(u.stencilOp(es,Ps,Jr),ui=es,Nr=Ps,Pr=Jr)},setLocked:function(es){Pe=es},setClear:function(es){wr!==es&&(u.clearStencil(es),wr=es)},reset:function(){Pe=!1,oi=null,pn=null,Dn=null,kn=null,ui=null,Nr=null,Pr=null,wr=null}}}const T=new _,R=new A,D=new w,U=new WeakMap,k=new WeakMap;let X={},J={},$=new WeakMap,oe=[],ne=null,H=!1,V=null,z=null,ce=null,ue=null,he=null,K=null,Y=null,ie=!1,ve=null,re=null,ae=null,me=null,ye=null;const Te=u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ke=!1,Fe=0;const Ve=u.getParameter(u.VERSION);Ve.indexOf("WebGL")!==-1?(Fe=parseFloat(/^WebGL (\d)/.exec(Ve)[1]),ke=Fe>=1):Ve.indexOf("OpenGL ES")!==-1&&(Fe=parseFloat(/^OpenGL ES (\d)/.exec(Ve)[1]),ke=Fe>=2);let ot=null,Ye={};const Ze=u.getParameter(u.SCISSOR_BOX),tt=u.getParameter(u.VIEWPORT),Pt=new Vector4().fromArray(Ze),Et=new Vector4().fromArray(tt);function Ne(Pe,oi,pn,Dn){const kn=new Uint8Array(4),ui=u.createTexture();u.bindTexture(Pe,ui),u.texParameteri(Pe,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(Pe,u.TEXTURE_MAG_FILTER,u.NEAREST);for(let Nr=0;Nr<pn;Nr++)m&&(Pe===u.TEXTURE_3D||Pe===u.TEXTURE_2D_ARRAY)?u.texImage3D(oi,0,u.RGBA,1,1,Dn,0,u.RGBA,u.UNSIGNED_BYTE,kn):u.texImage2D(oi+Nr,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,kn);return ui}const et={};et[u.TEXTURE_2D]=Ne(u.TEXTURE_2D,u.TEXTURE_2D,1),et[u.TEXTURE_CUBE_MAP]=Ne(u.TEXTURE_CUBE_MAP,u.TEXTURE_CUBE_MAP_POSITIVE_X,6),m&&(et[u.TEXTURE_2D_ARRAY]=Ne(u.TEXTURE_2D_ARRAY,u.TEXTURE_2D_ARRAY,1,1),et[u.TEXTURE_3D]=Ne(u.TEXTURE_3D,u.TEXTURE_3D,1,1)),T.setClear(0,0,0,1),R.setClear(1),D.setClear(0),wt(u.DEPTH_TEST),R.setFunc(LessEqualDepth),Gt(!1),fn(CullFaceBack),wt(u.CULL_FACE),Lt(NoBlending);function wt(Pe){X[Pe]!==!0&&(u.enable(Pe),X[Pe]=!0)}function Zt(Pe){X[Pe]!==!1&&(u.disable(Pe),X[Pe]=!1)}function nn(Pe,oi){return J[Pe]!==oi?(u.bindFramebuffer(Pe,oi),J[Pe]=oi,m&&(Pe===u.DRAW_FRAMEBUFFER&&(J[u.FRAMEBUFFER]=oi),Pe===u.FRAMEBUFFER&&(J[u.DRAW_FRAMEBUFFER]=oi)),!0):!1}function Vn(Pe,oi){let pn=oe,Dn=!1;if(Pe)if(pn=$.get(oi),pn===void 0&&(pn=[],$.set(oi,pn)),Pe.isWebGLMultipleRenderTargets){const kn=Pe.texture;if(pn.length!==kn.length||pn[0]!==u.COLOR_ATTACHMENT0){for(let ui=0,Nr=kn.length;ui<Nr;ui++)pn[ui]=u.COLOR_ATTACHMENT0+ui;pn.length=kn.length,Dn=!0}}else pn[0]!==u.COLOR_ATTACHMENT0&&(pn[0]=u.COLOR_ATTACHMENT0,Dn=!0);else pn[0]!==u.BACK&&(pn[0]=u.BACK,Dn=!0);Dn&&(i.isWebGL2?u.drawBuffers(pn):r.get("WEBGL_draw_buffers").drawBuffersWEBGL(pn))}function Jn(Pe){return ne!==Pe?(u.useProgram(Pe),ne=Pe,!0):!1}const Ue={[AddEquation]:u.FUNC_ADD,[SubtractEquation]:u.FUNC_SUBTRACT,[ReverseSubtractEquation]:u.FUNC_REVERSE_SUBTRACT};if(m)Ue[MinEquation]=u.MIN,Ue[MaxEquation]=u.MAX;else{const Pe=r.get("EXT_blend_minmax");Pe!==null&&(Ue[MinEquation]=Pe.MIN_EXT,Ue[MaxEquation]=Pe.MAX_EXT)}const St={[ZeroFactor]:u.ZERO,[OneFactor]:u.ONE,[SrcColorFactor]:u.SRC_COLOR,[SrcAlphaFactor]:u.SRC_ALPHA,[SrcAlphaSaturateFactor]:u.SRC_ALPHA_SATURATE,[DstColorFactor]:u.DST_COLOR,[DstAlphaFactor]:u.DST_ALPHA,[OneMinusSrcColorFactor]:u.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:u.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:u.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:u.ONE_MINUS_DST_ALPHA};function Lt(Pe,oi,pn,Dn,kn,ui,Nr,Pr){if(Pe===NoBlending){H===!0&&(Zt(u.BLEND),H=!1);return}if(H===!1&&(wt(u.BLEND),H=!0),Pe!==CustomBlending){if(Pe!==V||Pr!==ie){if((z!==AddEquation||he!==AddEquation)&&(u.blendEquation(u.FUNC_ADD),z=AddEquation,he=AddEquation),Pr)switch(Pe){case NormalBlending:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:u.blendFunc(u.ONE,u.ONE);break;case SubtractiveBlending:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case MultiplyBlending:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}else switch(Pe){case NormalBlending:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case SubtractiveBlending:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case MultiplyBlending:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}ce=null,ue=null,K=null,Y=null,V=Pe,ie=Pr}return}kn=kn||oi,ui=ui||pn,Nr=Nr||Dn,(oi!==z||kn!==he)&&(u.blendEquationSeparate(Ue[oi],Ue[kn]),z=oi,he=kn),(pn!==ce||Dn!==ue||ui!==K||Nr!==Y)&&(u.blendFuncSeparate(St[pn],St[Dn],St[ui],St[Nr]),ce=pn,ue=Dn,K=ui,Y=Nr),V=Pe,ie=!1}function jt(Pe,oi){Pe.side===DoubleSide?Zt(u.CULL_FACE):wt(u.CULL_FACE);let pn=Pe.side===BackSide;oi&&(pn=!pn),Gt(pn),Pe.blending===NormalBlending&&Pe.transparent===!1?Lt(NoBlending):Lt(Pe.blending,Pe.blendEquation,Pe.blendSrc,Pe.blendDst,Pe.blendEquationAlpha,Pe.blendSrcAlpha,Pe.blendDstAlpha,Pe.premultipliedAlpha),R.setFunc(Pe.depthFunc),R.setTest(Pe.depthTest),R.setMask(Pe.depthWrite),T.setMask(Pe.colorWrite);const Dn=Pe.stencilWrite;D.setTest(Dn),Dn&&(D.setMask(Pe.stencilWriteMask),D.setFunc(Pe.stencilFunc,Pe.stencilRef,Pe.stencilFuncMask),D.setOp(Pe.stencilFail,Pe.stencilZFail,Pe.stencilZPass)),qt(Pe.polygonOffset,Pe.polygonOffsetFactor,Pe.polygonOffsetUnits),Pe.alphaToCoverage===!0?wt(u.SAMPLE_ALPHA_TO_COVERAGE):Zt(u.SAMPLE_ALPHA_TO_COVERAGE)}function Gt(Pe){ve!==Pe&&(Pe?u.frontFace(u.CW):u.frontFace(u.CCW),ve=Pe)}function fn(Pe){Pe!==CullFaceNone?(wt(u.CULL_FACE),Pe!==re&&(Pe===CullFaceBack?u.cullFace(u.BACK):Pe===CullFaceFront?u.cullFace(u.FRONT):u.cullFace(u.FRONT_AND_BACK))):Zt(u.CULL_FACE),re=Pe}function hn(Pe){Pe!==ae&&(ke&&u.lineWidth(Pe),ae=Pe)}function qt(Pe,oi,pn){Pe?(wt(u.POLYGON_OFFSET_FILL),(me!==oi||ye!==pn)&&(u.polygonOffset(oi,pn),me=oi,ye=pn)):Zt(u.POLYGON_OFFSET_FILL)}function An(Pe){Pe?wt(u.SCISSOR_TEST):Zt(u.SCISSOR_TEST)}function _n(Pe){Pe===void 0&&(Pe=u.TEXTURE0+Te-1),ot!==Pe&&(u.activeTexture(Pe),ot=Pe)}function Bn(Pe,oi,pn){pn===void 0&&(ot===null?pn=u.TEXTURE0+Te-1:pn=ot);let Dn=Ye[pn];Dn===void 0&&(Dn={type:void 0,texture:void 0},Ye[pn]=Dn),(Dn.type!==Pe||Dn.texture!==oi)&&(ot!==pn&&(u.activeTexture(pn),ot=pn),u.bindTexture(Pe,oi||et[Pe]),Dn.type=Pe,Dn.texture=oi)}function de(){const Pe=Ye[ot];Pe!==void 0&&Pe.type!==void 0&&(u.bindTexture(Pe.type,null),Pe.type=void 0,Pe.texture=void 0)}function Ae(){try{u.compressedTexImage2D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Le(){try{u.compressedTexImage3D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Oe(){try{u.texSubImage2D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function $e(){try{u.texSubImage3D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function pt(){try{u.compressedTexSubImage2D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Mt(){try{u.compressedTexSubImage3D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Bt(){try{u.texStorage2D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function xt(){try{u.texStorage3D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ht(){try{u.texImage2D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function zt(){try{u.texImage3D.apply(u,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function dn(Pe){Pt.equals(Pe)===!1&&(u.scissor(Pe.x,Pe.y,Pe.z,Pe.w),Pt.copy(Pe))}function en(Pe){Et.equals(Pe)===!1&&(u.viewport(Pe.x,Pe.y,Pe.z,Pe.w),Et.copy(Pe))}function xn(Pe,oi){let pn=k.get(oi);pn===void 0&&(pn=new WeakMap,k.set(oi,pn));let Dn=pn.get(Pe);Dn===void 0&&(Dn=u.getUniformBlockIndex(oi,Pe.name),pn.set(Pe,Dn))}function wi(Pe,oi){const Dn=k.get(oi).get(Pe);U.get(oi)!==Dn&&(u.uniformBlockBinding(oi,Dn,Pe.__bindingPointIndex),U.set(oi,Dn))}function Gi(){u.disable(u.BLEND),u.disable(u.CULL_FACE),u.disable(u.DEPTH_TEST),u.disable(u.POLYGON_OFFSET_FILL),u.disable(u.SCISSOR_TEST),u.disable(u.STENCIL_TEST),u.disable(u.SAMPLE_ALPHA_TO_COVERAGE),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.ONE,u.ZERO),u.blendFuncSeparate(u.ONE,u.ZERO,u.ONE,u.ZERO),u.colorMask(!0,!0,!0,!0),u.clearColor(0,0,0,0),u.depthMask(!0),u.depthFunc(u.LESS),u.clearDepth(1),u.stencilMask(4294967295),u.stencilFunc(u.ALWAYS,0,4294967295),u.stencilOp(u.KEEP,u.KEEP,u.KEEP),u.clearStencil(0),u.cullFace(u.BACK),u.frontFace(u.CCW),u.polygonOffset(0,0),u.activeTexture(u.TEXTURE0),u.bindFramebuffer(u.FRAMEBUFFER,null),m===!0&&(u.bindFramebuffer(u.DRAW_FRAMEBUFFER,null),u.bindFramebuffer(u.READ_FRAMEBUFFER,null)),u.useProgram(null),u.lineWidth(1),u.scissor(0,0,u.canvas.width,u.canvas.height),u.viewport(0,0,u.canvas.width,u.canvas.height),X={},ot=null,Ye={},J={},$=new WeakMap,oe=[],ne=null,H=!1,V=null,z=null,ce=null,ue=null,he=null,K=null,Y=null,ie=!1,ve=null,re=null,ae=null,me=null,ye=null,Pt.set(0,0,u.canvas.width,u.canvas.height),Et.set(0,0,u.canvas.width,u.canvas.height),T.reset(),R.reset(),D.reset()}return{buffers:{color:T,depth:R,stencil:D},enable:wt,disable:Zt,bindFramebuffer:nn,drawBuffers:Vn,useProgram:Jn,setBlending:Lt,setMaterial:jt,setFlipSided:Gt,setCullFace:fn,setLineWidth:hn,setPolygonOffset:qt,setScissorTest:An,activeTexture:_n,bindTexture:Bn,unbindTexture:de,compressedTexImage2D:Ae,compressedTexImage3D:Le,texImage2D:ht,texImage3D:zt,updateUBOMapping:xn,uniformBlockBinding:wi,texStorage2D:Bt,texStorage3D:xt,texSubImage2D:Oe,texSubImage3D:$e,compressedTexSubImage2D:pt,compressedTexSubImage3D:Mt,scissor:dn,viewport:en,reset:Gi}}function WebGLTextures(u,r,i,m,_,A,w){const T=_.isWebGL2,R=_.maxTextures,D=_.maxCubemapSize,U=_.maxTextureSize,k=_.maxSamples,X=r.has("WEBGL_multisampled_render_to_texture")?r.get("WEBGL_multisampled_render_to_texture"):null,J=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),$=new WeakMap;let oe;const ne=new WeakMap;let H=!1;try{H=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function V(de,Ae){return H?new OffscreenCanvas(de,Ae):createElementNS("canvas")}function z(de,Ae,Le,Oe){let $e=1;if((de.width>Oe||de.height>Oe)&&($e=Oe/Math.max(de.width,de.height)),$e<1||Ae===!0)if(typeof HTMLImageElement<"u"&&de instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&de instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&de instanceof ImageBitmap){const pt=Ae?floorPowerOfTwo:Math.floor,Mt=pt($e*de.width),Bt=pt($e*de.height);oe===void 0&&(oe=V(Mt,Bt));const xt=Le?V(Mt,Bt):oe;return xt.width=Mt,xt.height=Bt,xt.getContext("2d").drawImage(de,0,0,Mt,Bt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+de.width+"x"+de.height+") to ("+Mt+"x"+Bt+")."),xt}else return"data"in de&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+de.width+"x"+de.height+")."),de;return de}function ce(de){return isPowerOfTwo(de.width)&&isPowerOfTwo(de.height)}function ue(de){return T?!1:de.wrapS!==ClampToEdgeWrapping||de.wrapT!==ClampToEdgeWrapping||de.minFilter!==NearestFilter&&de.minFilter!==LinearFilter}function he(de,Ae){return de.generateMipmaps&&Ae&&de.minFilter!==NearestFilter&&de.minFilter!==LinearFilter}function K(de){u.generateMipmap(de)}function Y(de,Ae,Le,Oe,$e=!1){if(T===!1)return Ae;if(de!==null){if(u[de]!==void 0)return u[de];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+de+"'")}let pt=Ae;return Ae===u.RED&&(Le===u.FLOAT&&(pt=u.R32F),Le===u.HALF_FLOAT&&(pt=u.R16F),Le===u.UNSIGNED_BYTE&&(pt=u.R8)),Ae===u.RED_INTEGER&&(Le===u.UNSIGNED_BYTE&&(pt=u.R8UI),Le===u.UNSIGNED_SHORT&&(pt=u.R16UI),Le===u.UNSIGNED_INT&&(pt=u.R32UI),Le===u.BYTE&&(pt=u.R8I),Le===u.SHORT&&(pt=u.R16I),Le===u.INT&&(pt=u.R32I)),Ae===u.RG&&(Le===u.FLOAT&&(pt=u.RG32F),Le===u.HALF_FLOAT&&(pt=u.RG16F),Le===u.UNSIGNED_BYTE&&(pt=u.RG8)),Ae===u.RGBA&&(Le===u.FLOAT&&(pt=u.RGBA32F),Le===u.HALF_FLOAT&&(pt=u.RGBA16F),Le===u.UNSIGNED_BYTE&&(pt=Oe===SRGBColorSpace&&$e===!1?u.SRGB8_ALPHA8:u.RGBA8),Le===u.UNSIGNED_SHORT_4_4_4_4&&(pt=u.RGBA4),Le===u.UNSIGNED_SHORT_5_5_5_1&&(pt=u.RGB5_A1)),(pt===u.R16F||pt===u.R32F||pt===u.RG16F||pt===u.RG32F||pt===u.RGBA16F||pt===u.RGBA32F)&&r.get("EXT_color_buffer_float"),pt}function ie(de,Ae,Le){return he(de,Le)===!0||de.isFramebufferTexture&&de.minFilter!==NearestFilter&&de.minFilter!==LinearFilter?Math.log2(Math.max(Ae.width,Ae.height))+1:de.mipmaps!==void 0&&de.mipmaps.length>0?de.mipmaps.length:de.isCompressedTexture&&Array.isArray(de.image)?Ae.mipmaps.length:1}function ve(de){return de===NearestFilter||de===NearestMipmapNearestFilter||de===NearestMipmapLinearFilter?u.NEAREST:u.LINEAR}function re(de){const Ae=de.target;Ae.removeEventListener("dispose",re),me(Ae),Ae.isVideoTexture&&$.delete(Ae)}function ae(de){const Ae=de.target;Ae.removeEventListener("dispose",ae),Te(Ae)}function me(de){const Ae=m.get(de);if(Ae.__webglInit===void 0)return;const Le=de.source,Oe=ne.get(Le);if(Oe){const $e=Oe[Ae.__cacheKey];$e.usedTimes--,$e.usedTimes===0&&ye(de),Object.keys(Oe).length===0&&ne.delete(Le)}m.remove(de)}function ye(de){const Ae=m.get(de);u.deleteTexture(Ae.__webglTexture);const Le=de.source,Oe=ne.get(Le);delete Oe[Ae.__cacheKey],w.memory.textures--}function Te(de){const Ae=de.texture,Le=m.get(de),Oe=m.get(Ae);if(Oe.__webglTexture!==void 0&&(u.deleteTexture(Oe.__webglTexture),w.memory.textures--),de.depthTexture&&de.depthTexture.dispose(),de.isWebGLCubeRenderTarget)for(let $e=0;$e<6;$e++){if(Array.isArray(Le.__webglFramebuffer[$e]))for(let pt=0;pt<Le.__webglFramebuffer[$e].length;pt++)u.deleteFramebuffer(Le.__webglFramebuffer[$e][pt]);else u.deleteFramebuffer(Le.__webglFramebuffer[$e]);Le.__webglDepthbuffer&&u.deleteRenderbuffer(Le.__webglDepthbuffer[$e])}else{if(Array.isArray(Le.__webglFramebuffer))for(let $e=0;$e<Le.__webglFramebuffer.length;$e++)u.deleteFramebuffer(Le.__webglFramebuffer[$e]);else u.deleteFramebuffer(Le.__webglFramebuffer);if(Le.__webglDepthbuffer&&u.deleteRenderbuffer(Le.__webglDepthbuffer),Le.__webglMultisampledFramebuffer&&u.deleteFramebuffer(Le.__webglMultisampledFramebuffer),Le.__webglColorRenderbuffer)for(let $e=0;$e<Le.__webglColorRenderbuffer.length;$e++)Le.__webglColorRenderbuffer[$e]&&u.deleteRenderbuffer(Le.__webglColorRenderbuffer[$e]);Le.__webglDepthRenderbuffer&&u.deleteRenderbuffer(Le.__webglDepthRenderbuffer)}if(de.isWebGLMultipleRenderTargets)for(let $e=0,pt=Ae.length;$e<pt;$e++){const Mt=m.get(Ae[$e]);Mt.__webglTexture&&(u.deleteTexture(Mt.__webglTexture),w.memory.textures--),m.remove(Ae[$e])}m.remove(Ae),m.remove(de)}let ke=0;function Fe(){ke=0}function Ve(){const de=ke;return de>=R&&console.warn("THREE.WebGLTextures: Trying to use "+de+" texture units while this GPU supports only "+R),ke+=1,de}function ot(de){const Ae=[];return Ae.push(de.wrapS),Ae.push(de.wrapT),Ae.push(de.wrapR||0),Ae.push(de.magFilter),Ae.push(de.minFilter),Ae.push(de.anisotropy),Ae.push(de.internalFormat),Ae.push(de.format),Ae.push(de.type),Ae.push(de.generateMipmaps),Ae.push(de.premultiplyAlpha),Ae.push(de.flipY),Ae.push(de.unpackAlignment),Ae.push(de.colorSpace),Ae.join()}function Ye(de,Ae){const Le=m.get(de);if(de.isVideoTexture&&_n(de),de.isRenderTargetTexture===!1&&de.version>0&&Le.__version!==de.version){const Oe=de.image;if(Oe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Oe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{nn(Le,de,Ae);return}}i.bindTexture(u.TEXTURE_2D,Le.__webglTexture,u.TEXTURE0+Ae)}function Ze(de,Ae){const Le=m.get(de);if(de.version>0&&Le.__version!==de.version){nn(Le,de,Ae);return}i.bindTexture(u.TEXTURE_2D_ARRAY,Le.__webglTexture,u.TEXTURE0+Ae)}function tt(de,Ae){const Le=m.get(de);if(de.version>0&&Le.__version!==de.version){nn(Le,de,Ae);return}i.bindTexture(u.TEXTURE_3D,Le.__webglTexture,u.TEXTURE0+Ae)}function Pt(de,Ae){const Le=m.get(de);if(de.version>0&&Le.__version!==de.version){Vn(Le,de,Ae);return}i.bindTexture(u.TEXTURE_CUBE_MAP,Le.__webglTexture,u.TEXTURE0+Ae)}const Et={[RepeatWrapping]:u.REPEAT,[ClampToEdgeWrapping]:u.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:u.MIRRORED_REPEAT},Ne={[NearestFilter]:u.NEAREST,[NearestMipmapNearestFilter]:u.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:u.NEAREST_MIPMAP_LINEAR,[LinearFilter]:u.LINEAR,[LinearMipmapNearestFilter]:u.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:u.LINEAR_MIPMAP_LINEAR},et={[NeverCompare]:u.NEVER,[AlwaysCompare]:u.ALWAYS,[LessCompare]:u.LESS,[LessEqualCompare]:u.LEQUAL,[EqualCompare]:u.EQUAL,[GreaterEqualCompare]:u.GEQUAL,[GreaterCompare]:u.GREATER,[NotEqualCompare]:u.NOTEQUAL};function wt(de,Ae,Le){if(Le?(u.texParameteri(de,u.TEXTURE_WRAP_S,Et[Ae.wrapS]),u.texParameteri(de,u.TEXTURE_WRAP_T,Et[Ae.wrapT]),(de===u.TEXTURE_3D||de===u.TEXTURE_2D_ARRAY)&&u.texParameteri(de,u.TEXTURE_WRAP_R,Et[Ae.wrapR]),u.texParameteri(de,u.TEXTURE_MAG_FILTER,Ne[Ae.magFilter]),u.texParameteri(de,u.TEXTURE_MIN_FILTER,Ne[Ae.minFilter])):(u.texParameteri(de,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(de,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),(de===u.TEXTURE_3D||de===u.TEXTURE_2D_ARRAY)&&u.texParameteri(de,u.TEXTURE_WRAP_R,u.CLAMP_TO_EDGE),(Ae.wrapS!==ClampToEdgeWrapping||Ae.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),u.texParameteri(de,u.TEXTURE_MAG_FILTER,ve(Ae.magFilter)),u.texParameteri(de,u.TEXTURE_MIN_FILTER,ve(Ae.minFilter)),Ae.minFilter!==NearestFilter&&Ae.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),Ae.compareFunction&&(u.texParameteri(de,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.texParameteri(de,u.TEXTURE_COMPARE_FUNC,et[Ae.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){const Oe=r.get("EXT_texture_filter_anisotropic");if(Ae.magFilter===NearestFilter||Ae.minFilter!==NearestMipmapLinearFilter&&Ae.minFilter!==LinearMipmapLinearFilter||Ae.type===FloatType&&r.has("OES_texture_float_linear")===!1||T===!1&&Ae.type===HalfFloatType&&r.has("OES_texture_half_float_linear")===!1)return;(Ae.anisotropy>1||m.get(Ae).__currentAnisotropy)&&(u.texParameterf(de,Oe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ae.anisotropy,_.getMaxAnisotropy())),m.get(Ae).__currentAnisotropy=Ae.anisotropy)}}function Zt(de,Ae){let Le=!1;de.__webglInit===void 0&&(de.__webglInit=!0,Ae.addEventListener("dispose",re));const Oe=Ae.source;let $e=ne.get(Oe);$e===void 0&&($e={},ne.set(Oe,$e));const pt=ot(Ae);if(pt!==de.__cacheKey){$e[pt]===void 0&&($e[pt]={texture:u.createTexture(),usedTimes:0},w.memory.textures++,Le=!0),$e[pt].usedTimes++;const Mt=$e[de.__cacheKey];Mt!==void 0&&($e[de.__cacheKey].usedTimes--,Mt.usedTimes===0&&ye(Ae)),de.__cacheKey=pt,de.__webglTexture=$e[pt].texture}return Le}function nn(de,Ae,Le){let Oe=u.TEXTURE_2D;(Ae.isDataArrayTexture||Ae.isCompressedArrayTexture)&&(Oe=u.TEXTURE_2D_ARRAY),Ae.isData3DTexture&&(Oe=u.TEXTURE_3D);const $e=Zt(de,Ae),pt=Ae.source;i.bindTexture(Oe,de.__webglTexture,u.TEXTURE0+Le);const Mt=m.get(pt);if(pt.version!==Mt.__version||$e===!0){i.activeTexture(u.TEXTURE0+Le),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,Ae.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ae.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,Ae.unpackAlignment),u.pixelStorei(u.UNPACK_COLORSPACE_CONVERSION_WEBGL,u.NONE);const Bt=ue(Ae)&&ce(Ae.image)===!1;let xt=z(Ae.image,Bt,!1,U);xt=Bn(Ae,xt);const ht=ce(xt)||T,zt=A.convert(Ae.format,Ae.colorSpace);let dn=A.convert(Ae.type),en=Y(Ae.internalFormat,zt,dn,Ae.colorSpace,Ae.isVideoTexture);wt(Oe,Ae,ht);let xn;const wi=Ae.mipmaps,Gi=T&&Ae.isVideoTexture!==!0,Pe=Mt.__version===void 0||$e===!0,oi=ie(Ae,xt,ht);if(Ae.isDepthTexture)en=u.DEPTH_COMPONENT,T?Ae.type===FloatType?en=u.DEPTH_COMPONENT32F:Ae.type===UnsignedIntType?en=u.DEPTH_COMPONENT24:Ae.type===UnsignedInt248Type?en=u.DEPTH24_STENCIL8:en=u.DEPTH_COMPONENT16:Ae.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Ae.format===DepthFormat&&en===u.DEPTH_COMPONENT&&Ae.type!==UnsignedShortType&&Ae.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Ae.type=UnsignedIntType,dn=A.convert(Ae.type)),Ae.format===DepthStencilFormat&&en===u.DEPTH_COMPONENT&&(en=u.DEPTH_STENCIL,Ae.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Ae.type=UnsignedInt248Type,dn=A.convert(Ae.type))),Pe&&(Gi?i.texStorage2D(u.TEXTURE_2D,1,en,xt.width,xt.height):i.texImage2D(u.TEXTURE_2D,0,en,xt.width,xt.height,0,zt,dn,null));else if(Ae.isDataTexture)if(wi.length>0&&ht){Gi&&Pe&&i.texStorage2D(u.TEXTURE_2D,oi,en,wi[0].width,wi[0].height);for(let pn=0,Dn=wi.length;pn<Dn;pn++)xn=wi[pn],Gi?i.texSubImage2D(u.TEXTURE_2D,pn,0,0,xn.width,xn.height,zt,dn,xn.data):i.texImage2D(u.TEXTURE_2D,pn,en,xn.width,xn.height,0,zt,dn,xn.data);Ae.generateMipmaps=!1}else Gi?(Pe&&i.texStorage2D(u.TEXTURE_2D,oi,en,xt.width,xt.height),i.texSubImage2D(u.TEXTURE_2D,0,0,0,xt.width,xt.height,zt,dn,xt.data)):i.texImage2D(u.TEXTURE_2D,0,en,xt.width,xt.height,0,zt,dn,xt.data);else if(Ae.isCompressedTexture)if(Ae.isCompressedArrayTexture){Gi&&Pe&&i.texStorage3D(u.TEXTURE_2D_ARRAY,oi,en,wi[0].width,wi[0].height,xt.depth);for(let pn=0,Dn=wi.length;pn<Dn;pn++)xn=wi[pn],Ae.format!==RGBAFormat?zt!==null?Gi?i.compressedTexSubImage3D(u.TEXTURE_2D_ARRAY,pn,0,0,0,xn.width,xn.height,xt.depth,zt,xn.data,0,0):i.compressedTexImage3D(u.TEXTURE_2D_ARRAY,pn,en,xn.width,xn.height,xt.depth,0,xn.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Gi?i.texSubImage3D(u.TEXTURE_2D_ARRAY,pn,0,0,0,xn.width,xn.height,xt.depth,zt,dn,xn.data):i.texImage3D(u.TEXTURE_2D_ARRAY,pn,en,xn.width,xn.height,xt.depth,0,zt,dn,xn.data)}else{Gi&&Pe&&i.texStorage2D(u.TEXTURE_2D,oi,en,wi[0].width,wi[0].height);for(let pn=0,Dn=wi.length;pn<Dn;pn++)xn=wi[pn],Ae.format!==RGBAFormat?zt!==null?Gi?i.compressedTexSubImage2D(u.TEXTURE_2D,pn,0,0,xn.width,xn.height,zt,xn.data):i.compressedTexImage2D(u.TEXTURE_2D,pn,en,xn.width,xn.height,0,xn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Gi?i.texSubImage2D(u.TEXTURE_2D,pn,0,0,xn.width,xn.height,zt,dn,xn.data):i.texImage2D(u.TEXTURE_2D,pn,en,xn.width,xn.height,0,zt,dn,xn.data)}else if(Ae.isDataArrayTexture)Gi?(Pe&&i.texStorage3D(u.TEXTURE_2D_ARRAY,oi,en,xt.width,xt.height,xt.depth),i.texSubImage3D(u.TEXTURE_2D_ARRAY,0,0,0,0,xt.width,xt.height,xt.depth,zt,dn,xt.data)):i.texImage3D(u.TEXTURE_2D_ARRAY,0,en,xt.width,xt.height,xt.depth,0,zt,dn,xt.data);else if(Ae.isData3DTexture)Gi?(Pe&&i.texStorage3D(u.TEXTURE_3D,oi,en,xt.width,xt.height,xt.depth),i.texSubImage3D(u.TEXTURE_3D,0,0,0,0,xt.width,xt.height,xt.depth,zt,dn,xt.data)):i.texImage3D(u.TEXTURE_3D,0,en,xt.width,xt.height,xt.depth,0,zt,dn,xt.data);else if(Ae.isFramebufferTexture){if(Pe)if(Gi)i.texStorage2D(u.TEXTURE_2D,oi,en,xt.width,xt.height);else{let pn=xt.width,Dn=xt.height;for(let kn=0;kn<oi;kn++)i.texImage2D(u.TEXTURE_2D,kn,en,pn,Dn,0,zt,dn,null),pn>>=1,Dn>>=1}}else if(wi.length>0&&ht){Gi&&Pe&&i.texStorage2D(u.TEXTURE_2D,oi,en,wi[0].width,wi[0].height);for(let pn=0,Dn=wi.length;pn<Dn;pn++)xn=wi[pn],Gi?i.texSubImage2D(u.TEXTURE_2D,pn,0,0,zt,dn,xn):i.texImage2D(u.TEXTURE_2D,pn,en,zt,dn,xn);Ae.generateMipmaps=!1}else Gi?(Pe&&i.texStorage2D(u.TEXTURE_2D,oi,en,xt.width,xt.height),i.texSubImage2D(u.TEXTURE_2D,0,0,0,zt,dn,xt)):i.texImage2D(u.TEXTURE_2D,0,en,zt,dn,xt);he(Ae,ht)&&K(Oe),Mt.__version=pt.version,Ae.onUpdate&&Ae.onUpdate(Ae)}de.__version=Ae.version}function Vn(de,Ae,Le){if(Ae.image.length!==6)return;const Oe=Zt(de,Ae),$e=Ae.source;i.bindTexture(u.TEXTURE_CUBE_MAP,de.__webglTexture,u.TEXTURE0+Le);const pt=m.get($e);if($e.version!==pt.__version||Oe===!0){i.activeTexture(u.TEXTURE0+Le),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,Ae.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ae.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,Ae.unpackAlignment),u.pixelStorei(u.UNPACK_COLORSPACE_CONVERSION_WEBGL,u.NONE);const Mt=Ae.isCompressedTexture||Ae.image[0].isCompressedTexture,Bt=Ae.image[0]&&Ae.image[0].isDataTexture,xt=[];for(let pn=0;pn<6;pn++)!Mt&&!Bt?xt[pn]=z(Ae.image[pn],!1,!0,D):xt[pn]=Bt?Ae.image[pn].image:Ae.image[pn],xt[pn]=Bn(Ae,xt[pn]);const ht=xt[0],zt=ce(ht)||T,dn=A.convert(Ae.format,Ae.colorSpace),en=A.convert(Ae.type),xn=Y(Ae.internalFormat,dn,en,Ae.colorSpace),wi=T&&Ae.isVideoTexture!==!0,Gi=pt.__version===void 0||Oe===!0;let Pe=ie(Ae,ht,zt);wt(u.TEXTURE_CUBE_MAP,Ae,zt);let oi;if(Mt){wi&&Gi&&i.texStorage2D(u.TEXTURE_CUBE_MAP,Pe,xn,ht.width,ht.height);for(let pn=0;pn<6;pn++){oi=xt[pn].mipmaps;for(let Dn=0;Dn<oi.length;Dn++){const kn=oi[Dn];Ae.format!==RGBAFormat?dn!==null?wi?i.compressedTexSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,Dn,0,0,kn.width,kn.height,dn,kn.data):i.compressedTexImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,Dn,xn,kn.width,kn.height,0,kn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):wi?i.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,Dn,0,0,kn.width,kn.height,dn,en,kn.data):i.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,Dn,xn,kn.width,kn.height,0,dn,en,kn.data)}}}else{oi=Ae.mipmaps,wi&&Gi&&(oi.length>0&&Pe++,i.texStorage2D(u.TEXTURE_CUBE_MAP,Pe,xn,xt[0].width,xt[0].height));for(let pn=0;pn<6;pn++)if(Bt){wi?i.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,0,0,0,xt[pn].width,xt[pn].height,dn,en,xt[pn].data):i.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,0,xn,xt[pn].width,xt[pn].height,0,dn,en,xt[pn].data);for(let Dn=0;Dn<oi.length;Dn++){const ui=oi[Dn].image[pn].image;wi?i.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,Dn+1,0,0,ui.width,ui.height,dn,en,ui.data):i.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,Dn+1,xn,ui.width,ui.height,0,dn,en,ui.data)}}else{wi?i.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,0,0,0,dn,en,xt[pn]):i.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,0,xn,dn,en,xt[pn]);for(let Dn=0;Dn<oi.length;Dn++){const kn=oi[Dn];wi?i.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,Dn+1,0,0,dn,en,kn.image[pn]):i.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+pn,Dn+1,xn,dn,en,kn.image[pn])}}}he(Ae,zt)&&K(u.TEXTURE_CUBE_MAP),pt.__version=$e.version,Ae.onUpdate&&Ae.onUpdate(Ae)}de.__version=Ae.version}function Jn(de,Ae,Le,Oe,$e,pt){const Mt=A.convert(Le.format,Le.colorSpace),Bt=A.convert(Le.type),xt=Y(Le.internalFormat,Mt,Bt,Le.colorSpace);if(!m.get(Ae).__hasExternalTextures){const zt=Math.max(1,Ae.width>>pt),dn=Math.max(1,Ae.height>>pt);$e===u.TEXTURE_3D||$e===u.TEXTURE_2D_ARRAY?i.texImage3D($e,pt,xt,zt,dn,Ae.depth,0,Mt,Bt,null):i.texImage2D($e,pt,xt,zt,dn,0,Mt,Bt,null)}i.bindFramebuffer(u.FRAMEBUFFER,de),An(Ae)?X.framebufferTexture2DMultisampleEXT(u.FRAMEBUFFER,Oe,$e,m.get(Le).__webglTexture,0,qt(Ae)):($e===u.TEXTURE_2D||$e>=u.TEXTURE_CUBE_MAP_POSITIVE_X&&$e<=u.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&u.framebufferTexture2D(u.FRAMEBUFFER,Oe,$e,m.get(Le).__webglTexture,pt),i.bindFramebuffer(u.FRAMEBUFFER,null)}function Ue(de,Ae,Le){if(u.bindRenderbuffer(u.RENDERBUFFER,de),Ae.depthBuffer&&!Ae.stencilBuffer){let Oe=u.DEPTH_COMPONENT16;if(Le||An(Ae)){const $e=Ae.depthTexture;$e&&$e.isDepthTexture&&($e.type===FloatType?Oe=u.DEPTH_COMPONENT32F:$e.type===UnsignedIntType&&(Oe=u.DEPTH_COMPONENT24));const pt=qt(Ae);An(Ae)?X.renderbufferStorageMultisampleEXT(u.RENDERBUFFER,pt,Oe,Ae.width,Ae.height):u.renderbufferStorageMultisample(u.RENDERBUFFER,pt,Oe,Ae.width,Ae.height)}else u.renderbufferStorage(u.RENDERBUFFER,Oe,Ae.width,Ae.height);u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,de)}else if(Ae.depthBuffer&&Ae.stencilBuffer){const Oe=qt(Ae);Le&&An(Ae)===!1?u.renderbufferStorageMultisample(u.RENDERBUFFER,Oe,u.DEPTH24_STENCIL8,Ae.width,Ae.height):An(Ae)?X.renderbufferStorageMultisampleEXT(u.RENDERBUFFER,Oe,u.DEPTH24_STENCIL8,Ae.width,Ae.height):u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_STENCIL,Ae.width,Ae.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,de)}else{const Oe=Ae.isWebGLMultipleRenderTargets===!0?Ae.texture:[Ae.texture];for(let $e=0;$e<Oe.length;$e++){const pt=Oe[$e],Mt=A.convert(pt.format,pt.colorSpace),Bt=A.convert(pt.type),xt=Y(pt.internalFormat,Mt,Bt,pt.colorSpace),ht=qt(Ae);Le&&An(Ae)===!1?u.renderbufferStorageMultisample(u.RENDERBUFFER,ht,xt,Ae.width,Ae.height):An(Ae)?X.renderbufferStorageMultisampleEXT(u.RENDERBUFFER,ht,xt,Ae.width,Ae.height):u.renderbufferStorage(u.RENDERBUFFER,xt,Ae.width,Ae.height)}}u.bindRenderbuffer(u.RENDERBUFFER,null)}function St(de,Ae){if(Ae&&Ae.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(u.FRAMEBUFFER,de),!(Ae.depthTexture&&Ae.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!m.get(Ae.depthTexture).__webglTexture||Ae.depthTexture.image.width!==Ae.width||Ae.depthTexture.image.height!==Ae.height)&&(Ae.depthTexture.image.width=Ae.width,Ae.depthTexture.image.height=Ae.height,Ae.depthTexture.needsUpdate=!0),Ye(Ae.depthTexture,0);const Oe=m.get(Ae.depthTexture).__webglTexture,$e=qt(Ae);if(Ae.depthTexture.format===DepthFormat)An(Ae)?X.framebufferTexture2DMultisampleEXT(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.TEXTURE_2D,Oe,0,$e):u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.TEXTURE_2D,Oe,0);else if(Ae.depthTexture.format===DepthStencilFormat)An(Ae)?X.framebufferTexture2DMultisampleEXT(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.TEXTURE_2D,Oe,0,$e):u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.TEXTURE_2D,Oe,0);else throw new Error("Unknown depthTexture format")}function Lt(de){const Ae=m.get(de),Le=de.isWebGLCubeRenderTarget===!0;if(de.depthTexture&&!Ae.__autoAllocateDepthBuffer){if(Le)throw new Error("target.depthTexture not supported in Cube render targets");St(Ae.__webglFramebuffer,de)}else if(Le){Ae.__webglDepthbuffer=[];for(let Oe=0;Oe<6;Oe++)i.bindFramebuffer(u.FRAMEBUFFER,Ae.__webglFramebuffer[Oe]),Ae.__webglDepthbuffer[Oe]=u.createRenderbuffer(),Ue(Ae.__webglDepthbuffer[Oe],de,!1)}else i.bindFramebuffer(u.FRAMEBUFFER,Ae.__webglFramebuffer),Ae.__webglDepthbuffer=u.createRenderbuffer(),Ue(Ae.__webglDepthbuffer,de,!1);i.bindFramebuffer(u.FRAMEBUFFER,null)}function jt(de,Ae,Le){const Oe=m.get(de);Ae!==void 0&&Jn(Oe.__webglFramebuffer,de,de.texture,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,0),Le!==void 0&&Lt(de)}function Gt(de){const Ae=de.texture,Le=m.get(de),Oe=m.get(Ae);de.addEventListener("dispose",ae),de.isWebGLMultipleRenderTargets!==!0&&(Oe.__webglTexture===void 0&&(Oe.__webglTexture=u.createTexture()),Oe.__version=Ae.version,w.memory.textures++);const $e=de.isWebGLCubeRenderTarget===!0,pt=de.isWebGLMultipleRenderTargets===!0,Mt=ce(de)||T;if($e){Le.__webglFramebuffer=[];for(let Bt=0;Bt<6;Bt++)if(T&&Ae.mipmaps&&Ae.mipmaps.length>0){Le.__webglFramebuffer[Bt]=[];for(let xt=0;xt<Ae.mipmaps.length;xt++)Le.__webglFramebuffer[Bt][xt]=u.createFramebuffer()}else Le.__webglFramebuffer[Bt]=u.createFramebuffer()}else{if(T&&Ae.mipmaps&&Ae.mipmaps.length>0){Le.__webglFramebuffer=[];for(let Bt=0;Bt<Ae.mipmaps.length;Bt++)Le.__webglFramebuffer[Bt]=u.createFramebuffer()}else Le.__webglFramebuffer=u.createFramebuffer();if(pt)if(_.drawBuffers){const Bt=de.texture;for(let xt=0,ht=Bt.length;xt<ht;xt++){const zt=m.get(Bt[xt]);zt.__webglTexture===void 0&&(zt.__webglTexture=u.createTexture(),w.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(T&&de.samples>0&&An(de)===!1){const Bt=pt?Ae:[Ae];Le.__webglMultisampledFramebuffer=u.createFramebuffer(),Le.__webglColorRenderbuffer=[],i.bindFramebuffer(u.FRAMEBUFFER,Le.__webglMultisampledFramebuffer);for(let xt=0;xt<Bt.length;xt++){const ht=Bt[xt];Le.__webglColorRenderbuffer[xt]=u.createRenderbuffer(),u.bindRenderbuffer(u.RENDERBUFFER,Le.__webglColorRenderbuffer[xt]);const zt=A.convert(ht.format,ht.colorSpace),dn=A.convert(ht.type),en=Y(ht.internalFormat,zt,dn,ht.colorSpace,de.isXRRenderTarget===!0),xn=qt(de);u.renderbufferStorageMultisample(u.RENDERBUFFER,xn,en,de.width,de.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0+xt,u.RENDERBUFFER,Le.__webglColorRenderbuffer[xt])}u.bindRenderbuffer(u.RENDERBUFFER,null),de.depthBuffer&&(Le.__webglDepthRenderbuffer=u.createRenderbuffer(),Ue(Le.__webglDepthRenderbuffer,de,!0)),i.bindFramebuffer(u.FRAMEBUFFER,null)}}if($e){i.bindTexture(u.TEXTURE_CUBE_MAP,Oe.__webglTexture),wt(u.TEXTURE_CUBE_MAP,Ae,Mt);for(let Bt=0;Bt<6;Bt++)if(T&&Ae.mipmaps&&Ae.mipmaps.length>0)for(let xt=0;xt<Ae.mipmaps.length;xt++)Jn(Le.__webglFramebuffer[Bt][xt],de,Ae,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+Bt,xt);else Jn(Le.__webglFramebuffer[Bt],de,Ae,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+Bt,0);he(Ae,Mt)&&K(u.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(pt){const Bt=de.texture;for(let xt=0,ht=Bt.length;xt<ht;xt++){const zt=Bt[xt],dn=m.get(zt);i.bindTexture(u.TEXTURE_2D,dn.__webglTexture),wt(u.TEXTURE_2D,zt,Mt),Jn(Le.__webglFramebuffer,de,zt,u.COLOR_ATTACHMENT0+xt,u.TEXTURE_2D,0),he(zt,Mt)&&K(u.TEXTURE_2D)}i.unbindTexture()}else{let Bt=u.TEXTURE_2D;if((de.isWebGL3DRenderTarget||de.isWebGLArrayRenderTarget)&&(T?Bt=de.isWebGL3DRenderTarget?u.TEXTURE_3D:u.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Bt,Oe.__webglTexture),wt(Bt,Ae,Mt),T&&Ae.mipmaps&&Ae.mipmaps.length>0)for(let xt=0;xt<Ae.mipmaps.length;xt++)Jn(Le.__webglFramebuffer[xt],de,Ae,u.COLOR_ATTACHMENT0,Bt,xt);else Jn(Le.__webglFramebuffer,de,Ae,u.COLOR_ATTACHMENT0,Bt,0);he(Ae,Mt)&&K(Bt),i.unbindTexture()}de.depthBuffer&&Lt(de)}function fn(de){const Ae=ce(de)||T,Le=de.isWebGLMultipleRenderTargets===!0?de.texture:[de.texture];for(let Oe=0,$e=Le.length;Oe<$e;Oe++){const pt=Le[Oe];if(he(pt,Ae)){const Mt=de.isWebGLCubeRenderTarget?u.TEXTURE_CUBE_MAP:u.TEXTURE_2D,Bt=m.get(pt).__webglTexture;i.bindTexture(Mt,Bt),K(Mt),i.unbindTexture()}}}function hn(de){if(T&&de.samples>0&&An(de)===!1){const Ae=de.isWebGLMultipleRenderTargets?de.texture:[de.texture],Le=de.width,Oe=de.height;let $e=u.COLOR_BUFFER_BIT;const pt=[],Mt=de.stencilBuffer?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT,Bt=m.get(de),xt=de.isWebGLMultipleRenderTargets===!0;if(xt)for(let ht=0;ht<Ae.length;ht++)i.bindFramebuffer(u.FRAMEBUFFER,Bt.__webglMultisampledFramebuffer),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0+ht,u.RENDERBUFFER,null),i.bindFramebuffer(u.FRAMEBUFFER,Bt.__webglFramebuffer),u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0+ht,u.TEXTURE_2D,null,0);i.bindFramebuffer(u.READ_FRAMEBUFFER,Bt.__webglMultisampledFramebuffer),i.bindFramebuffer(u.DRAW_FRAMEBUFFER,Bt.__webglFramebuffer);for(let ht=0;ht<Ae.length;ht++){pt.push(u.COLOR_ATTACHMENT0+ht),de.depthBuffer&&pt.push(Mt);const zt=Bt.__ignoreDepthValues!==void 0?Bt.__ignoreDepthValues:!1;if(zt===!1&&(de.depthBuffer&&($e|=u.DEPTH_BUFFER_BIT),de.stencilBuffer&&($e|=u.STENCIL_BUFFER_BIT)),xt&&u.framebufferRenderbuffer(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.RENDERBUFFER,Bt.__webglColorRenderbuffer[ht]),zt===!0&&(u.invalidateFramebuffer(u.READ_FRAMEBUFFER,[Mt]),u.invalidateFramebuffer(u.DRAW_FRAMEBUFFER,[Mt])),xt){const dn=m.get(Ae[ht]).__webglTexture;u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,dn,0)}u.blitFramebuffer(0,0,Le,Oe,0,0,Le,Oe,$e,u.NEAREST),J&&u.invalidateFramebuffer(u.READ_FRAMEBUFFER,pt)}if(i.bindFramebuffer(u.READ_FRAMEBUFFER,null),i.bindFramebuffer(u.DRAW_FRAMEBUFFER,null),xt)for(let ht=0;ht<Ae.length;ht++){i.bindFramebuffer(u.FRAMEBUFFER,Bt.__webglMultisampledFramebuffer),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0+ht,u.RENDERBUFFER,Bt.__webglColorRenderbuffer[ht]);const zt=m.get(Ae[ht]).__webglTexture;i.bindFramebuffer(u.FRAMEBUFFER,Bt.__webglFramebuffer),u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0+ht,u.TEXTURE_2D,zt,0)}i.bindFramebuffer(u.DRAW_FRAMEBUFFER,Bt.__webglMultisampledFramebuffer)}}function qt(de){return Math.min(k,de.samples)}function An(de){const Ae=m.get(de);return T&&de.samples>0&&r.has("WEBGL_multisampled_render_to_texture")===!0&&Ae.__useRenderToTexture!==!1}function _n(de){const Ae=w.render.frame;$.get(de)!==Ae&&($.set(de,Ae),de.update())}function Bn(de,Ae){const Le=de.colorSpace,Oe=de.format,$e=de.type;return de.isCompressedTexture===!0||de.isVideoTexture===!0||de.format===_SRGBAFormat||Le!==LinearSRGBColorSpace&&Le!==NoColorSpace&&(Le===SRGBColorSpace||Le===DisplayP3ColorSpace?T===!1?r.has("EXT_sRGB")===!0&&Oe===RGBAFormat?(de.format=_SRGBAFormat,de.minFilter=LinearFilter,de.generateMipmaps=!1):Ae=ImageUtils.sRGBToLinear(Ae):(Oe!==RGBAFormat||$e!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Le)),Ae}this.allocateTextureUnit=Ve,this.resetTextureUnits=Fe,this.setTexture2D=Ye,this.setTexture2DArray=Ze,this.setTexture3D=tt,this.setTextureCube=Pt,this.rebindTextures=jt,this.setupRenderTarget=Gt,this.updateRenderTargetMipmap=fn,this.updateMultisampleRenderTarget=hn,this.setupDepthRenderbuffer=Lt,this.setupFrameBufferTexture=Jn,this.useMultisampledRTT=An}const LinearTransferFunction=0,SRGBTransferFunction=1;function WebGLUtils(u,r,i){const m=i.isWebGL2;function _(A,w=NoColorSpace){let T;const R=w===SRGBColorSpace||w===DisplayP3ColorSpace?SRGBTransferFunction:LinearTransferFunction;if(A===UnsignedByteType)return u.UNSIGNED_BYTE;if(A===UnsignedShort4444Type)return u.UNSIGNED_SHORT_4_4_4_4;if(A===UnsignedShort5551Type)return u.UNSIGNED_SHORT_5_5_5_1;if(A===ByteType)return u.BYTE;if(A===ShortType)return u.SHORT;if(A===UnsignedShortType)return u.UNSIGNED_SHORT;if(A===IntType)return u.INT;if(A===UnsignedIntType)return u.UNSIGNED_INT;if(A===FloatType)return u.FLOAT;if(A===HalfFloatType)return m?u.HALF_FLOAT:(T=r.get("OES_texture_half_float"),T!==null?T.HALF_FLOAT_OES:null);if(A===AlphaFormat)return u.ALPHA;if(A===RGBAFormat)return u.RGBA;if(A===LuminanceFormat)return u.LUMINANCE;if(A===LuminanceAlphaFormat)return u.LUMINANCE_ALPHA;if(A===DepthFormat)return u.DEPTH_COMPONENT;if(A===DepthStencilFormat)return u.DEPTH_STENCIL;if(A===_SRGBAFormat)return T=r.get("EXT_sRGB"),T!==null?T.SRGB_ALPHA_EXT:null;if(A===RedFormat)return u.RED;if(A===RedIntegerFormat)return u.RED_INTEGER;if(A===RGFormat)return u.RG;if(A===RGIntegerFormat)return u.RG_INTEGER;if(A===RGBAIntegerFormat)return u.RGBA_INTEGER;if(A===RGB_S3TC_DXT1_Format||A===RGBA_S3TC_DXT1_Format||A===RGBA_S3TC_DXT3_Format||A===RGBA_S3TC_DXT5_Format)if(R===SRGBTransferFunction)if(T=r.get("WEBGL_compressed_texture_s3tc_srgb"),T!==null){if(A===RGB_S3TC_DXT1_Format)return T.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(A===RGBA_S3TC_DXT1_Format)return T.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(A===RGBA_S3TC_DXT3_Format)return T.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(A===RGBA_S3TC_DXT5_Format)return T.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(T=r.get("WEBGL_compressed_texture_s3tc"),T!==null){if(A===RGB_S3TC_DXT1_Format)return T.COMPRESSED_RGB_S3TC_DXT1_EXT;if(A===RGBA_S3TC_DXT1_Format)return T.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(A===RGBA_S3TC_DXT3_Format)return T.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(A===RGBA_S3TC_DXT5_Format)return T.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(A===RGB_PVRTC_4BPPV1_Format||A===RGB_PVRTC_2BPPV1_Format||A===RGBA_PVRTC_4BPPV1_Format||A===RGBA_PVRTC_2BPPV1_Format)if(T=r.get("WEBGL_compressed_texture_pvrtc"),T!==null){if(A===RGB_PVRTC_4BPPV1_Format)return T.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(A===RGB_PVRTC_2BPPV1_Format)return T.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(A===RGBA_PVRTC_4BPPV1_Format)return T.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(A===RGBA_PVRTC_2BPPV1_Format)return T.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(A===RGB_ETC1_Format)return T=r.get("WEBGL_compressed_texture_etc1"),T!==null?T.COMPRESSED_RGB_ETC1_WEBGL:null;if(A===RGB_ETC2_Format||A===RGBA_ETC2_EAC_Format)if(T=r.get("WEBGL_compressed_texture_etc"),T!==null){if(A===RGB_ETC2_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ETC2:T.COMPRESSED_RGB8_ETC2;if(A===RGBA_ETC2_EAC_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:T.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(A===RGBA_ASTC_4x4_Format||A===RGBA_ASTC_5x4_Format||A===RGBA_ASTC_5x5_Format||A===RGBA_ASTC_6x5_Format||A===RGBA_ASTC_6x6_Format||A===RGBA_ASTC_8x5_Format||A===RGBA_ASTC_8x6_Format||A===RGBA_ASTC_8x8_Format||A===RGBA_ASTC_10x5_Format||A===RGBA_ASTC_10x6_Format||A===RGBA_ASTC_10x8_Format||A===RGBA_ASTC_10x10_Format||A===RGBA_ASTC_12x10_Format||A===RGBA_ASTC_12x12_Format)if(T=r.get("WEBGL_compressed_texture_astc"),T!==null){if(A===RGBA_ASTC_4x4_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:T.COMPRESSED_RGBA_ASTC_4x4_KHR;if(A===RGBA_ASTC_5x4_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:T.COMPRESSED_RGBA_ASTC_5x4_KHR;if(A===RGBA_ASTC_5x5_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:T.COMPRESSED_RGBA_ASTC_5x5_KHR;if(A===RGBA_ASTC_6x5_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:T.COMPRESSED_RGBA_ASTC_6x5_KHR;if(A===RGBA_ASTC_6x6_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:T.COMPRESSED_RGBA_ASTC_6x6_KHR;if(A===RGBA_ASTC_8x5_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:T.COMPRESSED_RGBA_ASTC_8x5_KHR;if(A===RGBA_ASTC_8x6_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:T.COMPRESSED_RGBA_ASTC_8x6_KHR;if(A===RGBA_ASTC_8x8_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:T.COMPRESSED_RGBA_ASTC_8x8_KHR;if(A===RGBA_ASTC_10x5_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:T.COMPRESSED_RGBA_ASTC_10x5_KHR;if(A===RGBA_ASTC_10x6_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:T.COMPRESSED_RGBA_ASTC_10x6_KHR;if(A===RGBA_ASTC_10x8_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:T.COMPRESSED_RGBA_ASTC_10x8_KHR;if(A===RGBA_ASTC_10x10_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:T.COMPRESSED_RGBA_ASTC_10x10_KHR;if(A===RGBA_ASTC_12x10_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:T.COMPRESSED_RGBA_ASTC_12x10_KHR;if(A===RGBA_ASTC_12x12_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:T.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(A===RGBA_BPTC_Format||A===RGB_BPTC_SIGNED_Format||A===RGB_BPTC_UNSIGNED_Format)if(T=r.get("EXT_texture_compression_bptc"),T!==null){if(A===RGBA_BPTC_Format)return R===SRGBTransferFunction?T.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:T.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(A===RGB_BPTC_SIGNED_Format)return T.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(A===RGB_BPTC_UNSIGNED_Format)return T.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(A===RED_RGTC1_Format||A===SIGNED_RED_RGTC1_Format||A===RED_GREEN_RGTC2_Format||A===SIGNED_RED_GREEN_RGTC2_Format)if(T=r.get("EXT_texture_compression_rgtc"),T!==null){if(A===RGBA_BPTC_Format)return T.COMPRESSED_RED_RGTC1_EXT;if(A===SIGNED_RED_RGTC1_Format)return T.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(A===RED_GREEN_RGTC2_Format)return T.COMPRESSED_RED_GREEN_RGTC2_EXT;if(A===SIGNED_RED_GREEN_RGTC2_Format)return T.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return A===UnsignedInt248Type?m?u.UNSIGNED_INT_24_8:(T=r.get("WEBGL_depth_texture"),T!==null?T.UNSIGNED_INT_24_8_WEBGL:null):u[A]!==void 0?u[A]:null}return{convert:_}}class ArrayCamera extends PerspectiveCamera{constructor(r=[]){super(),this.isArrayCamera=!0,this.cameras=r}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(r){return this._targetRay!==null&&this._targetRay.dispatchEvent(r),this._grip!==null&&this._grip.dispatchEvent(r),this._hand!==null&&this._hand.dispatchEvent(r),this}connect(r){if(r&&r.hand){const i=this._hand;if(i)for(const m of r.hand.values())this._getHandJoint(i,m)}return this.dispatchEvent({type:"connected",data:r}),this}disconnect(r){return this.dispatchEvent({type:"disconnected",data:r}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(r,i,m){let _=null,A=null,w=null;const T=this._targetRay,R=this._grip,D=this._hand;if(r&&i.session.visibilityState!=="visible-blurred"){if(D&&r.hand){w=!0;for(const oe of r.hand.values()){const ne=i.getJointPose(oe,m),H=this._getHandJoint(D,oe);ne!==null&&(H.matrix.fromArray(ne.transform.matrix),H.matrix.decompose(H.position,H.rotation,H.scale),H.matrixWorldNeedsUpdate=!0,H.jointRadius=ne.radius),H.visible=ne!==null}const U=D.joints["index-finger-tip"],k=D.joints["thumb-tip"],X=U.position.distanceTo(k.position),J=.02,$=.005;D.inputState.pinching&&X>J+$?(D.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:r.handedness,target:this})):!D.inputState.pinching&&X<=J-$&&(D.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:r.handedness,target:this}))}else R!==null&&r.gripSpace&&(A=i.getPose(r.gripSpace,m),A!==null&&(R.matrix.fromArray(A.transform.matrix),R.matrix.decompose(R.position,R.rotation,R.scale),R.matrixWorldNeedsUpdate=!0,A.linearVelocity?(R.hasLinearVelocity=!0,R.linearVelocity.copy(A.linearVelocity)):R.hasLinearVelocity=!1,A.angularVelocity?(R.hasAngularVelocity=!0,R.angularVelocity.copy(A.angularVelocity)):R.hasAngularVelocity=!1));T!==null&&(_=i.getPose(r.targetRaySpace,m),_===null&&A!==null&&(_=A),_!==null&&(T.matrix.fromArray(_.transform.matrix),T.matrix.decompose(T.position,T.rotation,T.scale),T.matrixWorldNeedsUpdate=!0,_.linearVelocity?(T.hasLinearVelocity=!0,T.linearVelocity.copy(_.linearVelocity)):T.hasLinearVelocity=!1,_.angularVelocity?(T.hasAngularVelocity=!0,T.angularVelocity.copy(_.angularVelocity)):T.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return T!==null&&(T.visible=_!==null),R!==null&&(R.visible=A!==null),D!==null&&(D.visible=w!==null),this}_getHandJoint(r,i){if(r.joints[i.jointName]===void 0){const m=new Group;m.matrixAutoUpdate=!1,m.visible=!1,r.joints[i.jointName]=m,r.add(m)}return r.joints[i.jointName]}}class DepthTexture extends Texture{constructor(r,i,m,_,A,w,T,R,D,U){if(U=U!==void 0?U:DepthFormat,U!==DepthFormat&&U!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");m===void 0&&U===DepthFormat&&(m=UnsignedIntType),m===void 0&&U===DepthStencilFormat&&(m=UnsignedInt248Type),super(null,_,A,w,T,R,U,m,D),this.isDepthTexture=!0,this.image={width:r,height:i},this.magFilter=T!==void 0?T:NearestFilter,this.minFilter=R!==void 0?R:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(r){return super.copy(r),this.compareFunction=r.compareFunction,this}toJSON(r){const i=super.toJSON(r);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class WebXRManager extends EventDispatcher{constructor(r,i){super();const m=this;let _=null,A=1,w=null,T="local-floor",R=1,D=null,U=null,k=null,X=null,J=null,$=null;const oe=i.getContextAttributes();let ne=null,H=null;const V=[],z=[],ce=new PerspectiveCamera;ce.layers.enable(1),ce.viewport=new Vector4;const ue=new PerspectiveCamera;ue.layers.enable(2),ue.viewport=new Vector4;const he=[ce,ue],K=new ArrayCamera;K.layers.enable(1),K.layers.enable(2);let Y=null,ie=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ze){let tt=V[Ze];return tt===void 0&&(tt=new WebXRController,V[Ze]=tt),tt.getTargetRaySpace()},this.getControllerGrip=function(Ze){let tt=V[Ze];return tt===void 0&&(tt=new WebXRController,V[Ze]=tt),tt.getGripSpace()},this.getHand=function(Ze){let tt=V[Ze];return tt===void 0&&(tt=new WebXRController,V[Ze]=tt),tt.getHandSpace()};function ve(Ze){const tt=z.indexOf(Ze.inputSource);if(tt===-1)return;const Pt=V[tt];Pt!==void 0&&(Pt.update(Ze.inputSource,Ze.frame,D||w),Pt.dispatchEvent({type:Ze.type,data:Ze.inputSource}))}function re(){_.removeEventListener("select",ve),_.removeEventListener("selectstart",ve),_.removeEventListener("selectend",ve),_.removeEventListener("squeeze",ve),_.removeEventListener("squeezestart",ve),_.removeEventListener("squeezeend",ve),_.removeEventListener("end",re),_.removeEventListener("inputsourceschange",ae);for(let Ze=0;Ze<V.length;Ze++){const tt=z[Ze];tt!==null&&(z[Ze]=null,V[Ze].disconnect(tt))}Y=null,ie=null,r.setRenderTarget(ne),J=null,X=null,k=null,_=null,H=null,Ye.stop(),m.isPresenting=!1,m.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ze){A=Ze,m.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ze){T=Ze,m.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return D||w},this.setReferenceSpace=function(Ze){D=Ze},this.getBaseLayer=function(){return X!==null?X:J},this.getBinding=function(){return k},this.getFrame=function(){return $},this.getSession=function(){return _},this.setSession=async function(Ze){if(_=Ze,_!==null){if(ne=r.getRenderTarget(),_.addEventListener("select",ve),_.addEventListener("selectstart",ve),_.addEventListener("selectend",ve),_.addEventListener("squeeze",ve),_.addEventListener("squeezestart",ve),_.addEventListener("squeezeend",ve),_.addEventListener("end",re),_.addEventListener("inputsourceschange",ae),oe.xrCompatible!==!0&&await i.makeXRCompatible(),_.renderState.layers===void 0||r.capabilities.isWebGL2===!1){const tt={antialias:_.renderState.layers===void 0?oe.antialias:!0,alpha:!0,depth:oe.depth,stencil:oe.stencil,framebufferScaleFactor:A};J=new XRWebGLLayer(_,i,tt),_.updateRenderState({baseLayer:J}),H=new WebGLRenderTarget(J.framebufferWidth,J.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:r.outputColorSpace,stencilBuffer:oe.stencil})}else{let tt=null,Pt=null,Et=null;oe.depth&&(Et=oe.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,tt=oe.stencil?DepthStencilFormat:DepthFormat,Pt=oe.stencil?UnsignedInt248Type:UnsignedIntType);const Ne={colorFormat:i.RGBA8,depthFormat:Et,scaleFactor:A};k=new XRWebGLBinding(_,i),X=k.createProjectionLayer(Ne),_.updateRenderState({layers:[X]}),H=new WebGLRenderTarget(X.textureWidth,X.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(X.textureWidth,X.textureHeight,Pt,void 0,void 0,void 0,void 0,void 0,void 0,tt),stencilBuffer:oe.stencil,colorSpace:r.outputColorSpace,samples:oe.antialias?4:0});const et=r.properties.get(H);et.__ignoreDepthValues=X.ignoreDepthValues}H.isXRRenderTarget=!0,this.setFoveation(R),D=null,w=await _.requestReferenceSpace(T),Ye.setContext(_),Ye.start(),m.isPresenting=!0,m.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(_!==null)return _.environmentBlendMode};function ae(Ze){for(let tt=0;tt<Ze.removed.length;tt++){const Pt=Ze.removed[tt],Et=z.indexOf(Pt);Et>=0&&(z[Et]=null,V[Et].disconnect(Pt))}for(let tt=0;tt<Ze.added.length;tt++){const Pt=Ze.added[tt];let Et=z.indexOf(Pt);if(Et===-1){for(let et=0;et<V.length;et++)if(et>=z.length){z.push(Pt),Et=et;break}else if(z[et]===null){z[et]=Pt,Et=et;break}if(Et===-1)break}const Ne=V[Et];Ne&&Ne.connect(Pt)}}const me=new Vector3,ye=new Vector3;function Te(Ze,tt,Pt){me.setFromMatrixPosition(tt.matrixWorld),ye.setFromMatrixPosition(Pt.matrixWorld);const Et=me.distanceTo(ye),Ne=tt.projectionMatrix.elements,et=Pt.projectionMatrix.elements,wt=Ne[14]/(Ne[10]-1),Zt=Ne[14]/(Ne[10]+1),nn=(Ne[9]+1)/Ne[5],Vn=(Ne[9]-1)/Ne[5],Jn=(Ne[8]-1)/Ne[0],Ue=(et[8]+1)/et[0],St=wt*Jn,Lt=wt*Ue,jt=Et/(-Jn+Ue),Gt=jt*-Jn;tt.matrixWorld.decompose(Ze.position,Ze.quaternion,Ze.scale),Ze.translateX(Gt),Ze.translateZ(jt),Ze.matrixWorld.compose(Ze.position,Ze.quaternion,Ze.scale),Ze.matrixWorldInverse.copy(Ze.matrixWorld).invert();const fn=wt+jt,hn=Zt+jt,qt=St-Gt,An=Lt+(Et-Gt),_n=nn*Zt/hn*fn,Bn=Vn*Zt/hn*fn;Ze.projectionMatrix.makePerspective(qt,An,_n,Bn,fn,hn),Ze.projectionMatrixInverse.copy(Ze.projectionMatrix).invert()}function ke(Ze,tt){tt===null?Ze.matrixWorld.copy(Ze.matrix):Ze.matrixWorld.multiplyMatrices(tt.matrixWorld,Ze.matrix),Ze.matrixWorldInverse.copy(Ze.matrixWorld).invert()}this.updateCamera=function(Ze){if(_===null)return;K.near=ue.near=ce.near=Ze.near,K.far=ue.far=ce.far=Ze.far,(Y!==K.near||ie!==K.far)&&(_.updateRenderState({depthNear:K.near,depthFar:K.far}),Y=K.near,ie=K.far);const tt=Ze.parent,Pt=K.cameras;ke(K,tt);for(let Et=0;Et<Pt.length;Et++)ke(Pt[Et],tt);Pt.length===2?Te(K,ce,ue):K.projectionMatrix.copy(ce.projectionMatrix),Fe(Ze,K,tt)};function Fe(Ze,tt,Pt){Pt===null?Ze.matrix.copy(tt.matrixWorld):(Ze.matrix.copy(Pt.matrixWorld),Ze.matrix.invert(),Ze.matrix.multiply(tt.matrixWorld)),Ze.matrix.decompose(Ze.position,Ze.quaternion,Ze.scale),Ze.updateMatrixWorld(!0),Ze.projectionMatrix.copy(tt.projectionMatrix),Ze.projectionMatrixInverse.copy(tt.projectionMatrixInverse),Ze.isPerspectiveCamera&&(Ze.fov=RAD2DEG*2*Math.atan(1/Ze.projectionMatrix.elements[5]),Ze.zoom=1)}this.getCamera=function(){return K},this.getFoveation=function(){if(!(X===null&&J===null))return R},this.setFoveation=function(Ze){R=Ze,X!==null&&(X.fixedFoveation=Ze),J!==null&&J.fixedFoveation!==void 0&&(J.fixedFoveation=Ze)};let Ve=null;function ot(Ze,tt){if(U=tt.getViewerPose(D||w),$=tt,U!==null){const Pt=U.views;J!==null&&(r.setRenderTargetFramebuffer(H,J.framebuffer),r.setRenderTarget(H));let Et=!1;Pt.length!==K.cameras.length&&(K.cameras.length=0,Et=!0);for(let Ne=0;Ne<Pt.length;Ne++){const et=Pt[Ne];let wt=null;if(J!==null)wt=J.getViewport(et);else{const nn=k.getViewSubImage(X,et);wt=nn.viewport,Ne===0&&(r.setRenderTargetTextures(H,nn.colorTexture,X.ignoreDepthValues?void 0:nn.depthStencilTexture),r.setRenderTarget(H))}let Zt=he[Ne];Zt===void 0&&(Zt=new PerspectiveCamera,Zt.layers.enable(Ne),Zt.viewport=new Vector4,he[Ne]=Zt),Zt.matrix.fromArray(et.transform.matrix),Zt.matrix.decompose(Zt.position,Zt.quaternion,Zt.scale),Zt.projectionMatrix.fromArray(et.projectionMatrix),Zt.projectionMatrixInverse.copy(Zt.projectionMatrix).invert(),Zt.viewport.set(wt.x,wt.y,wt.width,wt.height),Ne===0&&(K.matrix.copy(Zt.matrix),K.matrix.decompose(K.position,K.quaternion,K.scale)),Et===!0&&K.cameras.push(Zt)}}for(let Pt=0;Pt<V.length;Pt++){const Et=z[Pt],Ne=V[Pt];Et!==null&&Ne!==void 0&&Ne.update(Et,tt,D||w)}Ve&&Ve(Ze,tt),tt.detectedPlanes&&m.dispatchEvent({type:"planesdetected",data:tt}),$=null}const Ye=new WebGLAnimation;Ye.setAnimationLoop(ot),this.setAnimationLoop=function(Ze){Ve=Ze},this.dispose=function(){}}}function WebGLMaterials(u,r){function i(ne,H){ne.matrixAutoUpdate===!0&&ne.updateMatrix(),H.value.copy(ne.matrix)}function m(ne,H){H.color.getRGB(ne.fogColor.value,getUnlitUniformColorSpace(u)),H.isFog?(ne.fogNear.value=H.near,ne.fogFar.value=H.far):H.isFogExp2&&(ne.fogDensity.value=H.density)}function _(ne,H,V,z,ce){H.isMeshBasicMaterial||H.isMeshLambertMaterial?A(ne,H):H.isMeshToonMaterial?(A(ne,H),k(ne,H)):H.isMeshPhongMaterial?(A(ne,H),U(ne,H)):H.isMeshStandardMaterial?(A(ne,H),X(ne,H),H.isMeshPhysicalMaterial&&J(ne,H,ce)):H.isMeshMatcapMaterial?(A(ne,H),$(ne,H)):H.isMeshDepthMaterial?A(ne,H):H.isMeshDistanceMaterial?(A(ne,H),oe(ne,H)):H.isMeshNormalMaterial?A(ne,H):H.isLineBasicMaterial?(w(ne,H),H.isLineDashedMaterial&&T(ne,H)):H.isPointsMaterial?R(ne,H,V,z):H.isSpriteMaterial?D(ne,H):H.isShadowMaterial?(ne.color.value.copy(H.color),ne.opacity.value=H.opacity):H.isShaderMaterial&&(H.uniformsNeedUpdate=!1)}function A(ne,H){ne.opacity.value=H.opacity,H.color&&ne.diffuse.value.copy(H.color),H.emissive&&ne.emissive.value.copy(H.emissive).multiplyScalar(H.emissiveIntensity),H.map&&(ne.map.value=H.map,i(H.map,ne.mapTransform)),H.alphaMap&&(ne.alphaMap.value=H.alphaMap,i(H.alphaMap,ne.alphaMapTransform)),H.bumpMap&&(ne.bumpMap.value=H.bumpMap,i(H.bumpMap,ne.bumpMapTransform),ne.bumpScale.value=H.bumpScale,H.side===BackSide&&(ne.bumpScale.value*=-1)),H.normalMap&&(ne.normalMap.value=H.normalMap,i(H.normalMap,ne.normalMapTransform),ne.normalScale.value.copy(H.normalScale),H.side===BackSide&&ne.normalScale.value.negate()),H.displacementMap&&(ne.displacementMap.value=H.displacementMap,i(H.displacementMap,ne.displacementMapTransform),ne.displacementScale.value=H.displacementScale,ne.displacementBias.value=H.displacementBias),H.emissiveMap&&(ne.emissiveMap.value=H.emissiveMap,i(H.emissiveMap,ne.emissiveMapTransform)),H.specularMap&&(ne.specularMap.value=H.specularMap,i(H.specularMap,ne.specularMapTransform)),H.alphaTest>0&&(ne.alphaTest.value=H.alphaTest);const V=r.get(H).envMap;if(V&&(ne.envMap.value=V,ne.flipEnvMap.value=V.isCubeTexture&&V.isRenderTargetTexture===!1?-1:1,ne.reflectivity.value=H.reflectivity,ne.ior.value=H.ior,ne.refractionRatio.value=H.refractionRatio),H.lightMap){ne.lightMap.value=H.lightMap;const z=u._useLegacyLights===!0?Math.PI:1;ne.lightMapIntensity.value=H.lightMapIntensity*z,i(H.lightMap,ne.lightMapTransform)}H.aoMap&&(ne.aoMap.value=H.aoMap,ne.aoMapIntensity.value=H.aoMapIntensity,i(H.aoMap,ne.aoMapTransform))}function w(ne,H){ne.diffuse.value.copy(H.color),ne.opacity.value=H.opacity,H.map&&(ne.map.value=H.map,i(H.map,ne.mapTransform))}function T(ne,H){ne.dashSize.value=H.dashSize,ne.totalSize.value=H.dashSize+H.gapSize,ne.scale.value=H.scale}function R(ne,H,V,z){ne.diffuse.value.copy(H.color),ne.opacity.value=H.opacity,ne.size.value=H.size*V,ne.scale.value=z*.5,H.map&&(ne.map.value=H.map,i(H.map,ne.uvTransform)),H.alphaMap&&(ne.alphaMap.value=H.alphaMap,i(H.alphaMap,ne.alphaMapTransform)),H.alphaTest>0&&(ne.alphaTest.value=H.alphaTest)}function D(ne,H){ne.diffuse.value.copy(H.color),ne.opacity.value=H.opacity,ne.rotation.value=H.rotation,H.map&&(ne.map.value=H.map,i(H.map,ne.mapTransform)),H.alphaMap&&(ne.alphaMap.value=H.alphaMap,i(H.alphaMap,ne.alphaMapTransform)),H.alphaTest>0&&(ne.alphaTest.value=H.alphaTest)}function U(ne,H){ne.specular.value.copy(H.specular),ne.shininess.value=Math.max(H.shininess,1e-4)}function k(ne,H){H.gradientMap&&(ne.gradientMap.value=H.gradientMap)}function X(ne,H){ne.metalness.value=H.metalness,H.metalnessMap&&(ne.metalnessMap.value=H.metalnessMap,i(H.metalnessMap,ne.metalnessMapTransform)),ne.roughness.value=H.roughness,H.roughnessMap&&(ne.roughnessMap.value=H.roughnessMap,i(H.roughnessMap,ne.roughnessMapTransform)),r.get(H).envMap&&(ne.envMapIntensity.value=H.envMapIntensity)}function J(ne,H,V){ne.ior.value=H.ior,H.sheen>0&&(ne.sheenColor.value.copy(H.sheenColor).multiplyScalar(H.sheen),ne.sheenRoughness.value=H.sheenRoughness,H.sheenColorMap&&(ne.sheenColorMap.value=H.sheenColorMap,i(H.sheenColorMap,ne.sheenColorMapTransform)),H.sheenRoughnessMap&&(ne.sheenRoughnessMap.value=H.sheenRoughnessMap,i(H.sheenRoughnessMap,ne.sheenRoughnessMapTransform))),H.clearcoat>0&&(ne.clearcoat.value=H.clearcoat,ne.clearcoatRoughness.value=H.clearcoatRoughness,H.clearcoatMap&&(ne.clearcoatMap.value=H.clearcoatMap,i(H.clearcoatMap,ne.clearcoatMapTransform)),H.clearcoatRoughnessMap&&(ne.clearcoatRoughnessMap.value=H.clearcoatRoughnessMap,i(H.clearcoatRoughnessMap,ne.clearcoatRoughnessMapTransform)),H.clearcoatNormalMap&&(ne.clearcoatNormalMap.value=H.clearcoatNormalMap,i(H.clearcoatNormalMap,ne.clearcoatNormalMapTransform),ne.clearcoatNormalScale.value.copy(H.clearcoatNormalScale),H.side===BackSide&&ne.clearcoatNormalScale.value.negate())),H.iridescence>0&&(ne.iridescence.value=H.iridescence,ne.iridescenceIOR.value=H.iridescenceIOR,ne.iridescenceThicknessMinimum.value=H.iridescenceThicknessRange[0],ne.iridescenceThicknessMaximum.value=H.iridescenceThicknessRange[1],H.iridescenceMap&&(ne.iridescenceMap.value=H.iridescenceMap,i(H.iridescenceMap,ne.iridescenceMapTransform)),H.iridescenceThicknessMap&&(ne.iridescenceThicknessMap.value=H.iridescenceThicknessMap,i(H.iridescenceThicknessMap,ne.iridescenceThicknessMapTransform))),H.transmission>0&&(ne.transmission.value=H.transmission,ne.transmissionSamplerMap.value=V.texture,ne.transmissionSamplerSize.value.set(V.width,V.height),H.transmissionMap&&(ne.transmissionMap.value=H.transmissionMap,i(H.transmissionMap,ne.transmissionMapTransform)),ne.thickness.value=H.thickness,H.thicknessMap&&(ne.thicknessMap.value=H.thicknessMap,i(H.thicknessMap,ne.thicknessMapTransform)),ne.attenuationDistance.value=H.attenuationDistance,ne.attenuationColor.value.copy(H.attenuationColor)),H.anisotropy>0&&(ne.anisotropyVector.value.set(H.anisotropy*Math.cos(H.anisotropyRotation),H.anisotropy*Math.sin(H.anisotropyRotation)),H.anisotropyMap&&(ne.anisotropyMap.value=H.anisotropyMap,i(H.anisotropyMap,ne.anisotropyMapTransform))),ne.specularIntensity.value=H.specularIntensity,ne.specularColor.value.copy(H.specularColor),H.specularColorMap&&(ne.specularColorMap.value=H.specularColorMap,i(H.specularColorMap,ne.specularColorMapTransform)),H.specularIntensityMap&&(ne.specularIntensityMap.value=H.specularIntensityMap,i(H.specularIntensityMap,ne.specularIntensityMapTransform))}function $(ne,H){H.matcap&&(ne.matcap.value=H.matcap)}function oe(ne,H){const V=r.get(H).light;ne.referencePosition.value.setFromMatrixPosition(V.matrixWorld),ne.nearDistance.value=V.shadow.camera.near,ne.farDistance.value=V.shadow.camera.far}return{refreshFogUniforms:m,refreshMaterialUniforms:_}}function WebGLUniformsGroups(u,r,i,m){let _={},A={},w=[];const T=i.isWebGL2?u.getParameter(u.MAX_UNIFORM_BUFFER_BINDINGS):0;function R(V,z){const ce=z.program;m.uniformBlockBinding(V,ce)}function D(V,z){let ce=_[V.id];ce===void 0&&($(V),ce=U(V),_[V.id]=ce,V.addEventListener("dispose",ne));const ue=z.program;m.updateUBOMapping(V,ue);const he=r.render.frame;A[V.id]!==he&&(X(V),A[V.id]=he)}function U(V){const z=k();V.__bindingPointIndex=z;const ce=u.createBuffer(),ue=V.__size,he=V.usage;return u.bindBuffer(u.UNIFORM_BUFFER,ce),u.bufferData(u.UNIFORM_BUFFER,ue,he),u.bindBuffer(u.UNIFORM_BUFFER,null),u.bindBufferBase(u.UNIFORM_BUFFER,z,ce),ce}function k(){for(let V=0;V<T;V++)if(w.indexOf(V)===-1)return w.push(V),V;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function X(V){const z=_[V.id],ce=V.uniforms,ue=V.__cache;u.bindBuffer(u.UNIFORM_BUFFER,z);for(let he=0,K=ce.length;he<K;he++){const Y=ce[he];if(J(Y,he,ue)===!0){const ie=Y.__offset,ve=Array.isArray(Y.value)?Y.value:[Y.value];let re=0;for(let ae=0;ae<ve.length;ae++){const me=ve[ae],ye=oe(me);typeof me=="number"?(Y.__data[0]=me,u.bufferSubData(u.UNIFORM_BUFFER,ie+re,Y.__data)):me.isMatrix3?(Y.__data[0]=me.elements[0],Y.__data[1]=me.elements[1],Y.__data[2]=me.elements[2],Y.__data[3]=me.elements[0],Y.__data[4]=me.elements[3],Y.__data[5]=me.elements[4],Y.__data[6]=me.elements[5],Y.__data[7]=me.elements[0],Y.__data[8]=me.elements[6],Y.__data[9]=me.elements[7],Y.__data[10]=me.elements[8],Y.__data[11]=me.elements[0]):(me.toArray(Y.__data,re),re+=ye.storage/Float32Array.BYTES_PER_ELEMENT)}u.bufferSubData(u.UNIFORM_BUFFER,ie,Y.__data)}}u.bindBuffer(u.UNIFORM_BUFFER,null)}function J(V,z,ce){const ue=V.value;if(ce[z]===void 0){if(typeof ue=="number")ce[z]=ue;else{const he=Array.isArray(ue)?ue:[ue],K=[];for(let Y=0;Y<he.length;Y++)K.push(he[Y].clone());ce[z]=K}return!0}else if(typeof ue=="number"){if(ce[z]!==ue)return ce[z]=ue,!0}else{const he=Array.isArray(ce[z])?ce[z]:[ce[z]],K=Array.isArray(ue)?ue:[ue];for(let Y=0;Y<he.length;Y++){const ie=he[Y];if(ie.equals(K[Y])===!1)return ie.copy(K[Y]),!0}}return!1}function $(V){const z=V.uniforms;let ce=0;const ue=16;let he=0;for(let K=0,Y=z.length;K<Y;K++){const ie=z[K],ve={boundary:0,storage:0},re=Array.isArray(ie.value)?ie.value:[ie.value];for(let ae=0,me=re.length;ae<me;ae++){const ye=re[ae],Te=oe(ye);ve.boundary+=Te.boundary,ve.storage+=Te.storage}if(ie.__data=new Float32Array(ve.storage/Float32Array.BYTES_PER_ELEMENT),ie.__offset=ce,K>0){he=ce%ue;const ae=ue-he;he!==0&&ae-ve.boundary<0&&(ce+=ue-he,ie.__offset=ce)}ce+=ve.storage}return he=ce%ue,he>0&&(ce+=ue-he),V.__size=ce,V.__cache={},this}function oe(V){const z={boundary:0,storage:0};return typeof V=="number"?(z.boundary=4,z.storage=4):V.isVector2?(z.boundary=8,z.storage=8):V.isVector3||V.isColor?(z.boundary=16,z.storage=12):V.isVector4?(z.boundary=16,z.storage=16):V.isMatrix3?(z.boundary=48,z.storage=48):V.isMatrix4?(z.boundary=64,z.storage=64):V.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",V),z}function ne(V){const z=V.target;z.removeEventListener("dispose",ne);const ce=w.indexOf(z.__bindingPointIndex);w.splice(ce,1),u.deleteBuffer(_[z.id]),delete _[z.id],delete A[z.id]}function H(){for(const V in _)u.deleteBuffer(_[V]);w=[],_={},A={}}return{bind:R,update:D,dispose:H}}class WebGLRenderer{constructor(r={}){const{canvas:i=createCanvasElement(),context:m=null,depth:_=!0,stencil:A=!0,alpha:w=!1,antialias:T=!1,premultipliedAlpha:R=!0,preserveDrawingBuffer:D=!1,powerPreference:U="default",failIfMajorPerformanceCaveat:k=!1}=r;this.isWebGLRenderer=!0;let X;m!==null?X=m.getContextAttributes().alpha:X=w;const J=new Uint32Array(4),$=new Int32Array(4);let oe=null,ne=null;const H=[],V=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=SRGBColorSpace,this._useLegacyLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const z=this;let ce=!1,ue=0,he=0,K=null,Y=-1,ie=null;const ve=new Vector4,re=new Vector4;let ae=null;const me=new Color(0);let ye=0,Te=i.width,ke=i.height,Fe=1,Ve=null,ot=null;const Ye=new Vector4(0,0,Te,ke),Ze=new Vector4(0,0,Te,ke);let tt=!1;const Pt=new Frustum;let Et=!1,Ne=!1,et=null;const wt=new Matrix4,Zt=new Vector2,nn=new Vector3,Vn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Jn(){return K===null?Fe:1}let Ue=m;function St(gt,Wt){for(let bn=0;bn<gt.length;bn++){const ln=gt[bn],mn=i.getContext(ln,Wt);if(mn!==null)return mn}return null}try{const gt={alpha:!0,depth:_,stencil:A,antialias:T,premultipliedAlpha:R,preserveDrawingBuffer:D,powerPreference:U,failIfMajorPerformanceCaveat:k};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${REVISION}`),i.addEventListener("webglcontextlost",oi,!1),i.addEventListener("webglcontextrestored",pn,!1),i.addEventListener("webglcontextcreationerror",Dn,!1),Ue===null){const Wt=["webgl2","webgl","experimental-webgl"];if(z.isWebGL1Renderer===!0&&Wt.shift(),Ue=St(Wt,gt),Ue===null)throw St(Wt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&Ue instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Ue.getShaderPrecisionFormat===void 0&&(Ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(gt){throw console.error("THREE.WebGLRenderer: "+gt.message),gt}let Lt,jt,Gt,fn,hn,qt,An,_n,Bn,de,Ae,Le,Oe,$e,pt,Mt,Bt,xt,ht,zt,dn,en,xn,wi;function Gi(){Lt=new WebGLExtensions(Ue),jt=new WebGLCapabilities(Ue,Lt,r),Lt.init(jt),en=new WebGLUtils(Ue,Lt,jt),Gt=new WebGLState(Ue,Lt,jt),fn=new WebGLInfo(Ue),hn=new WebGLProperties,qt=new WebGLTextures(Ue,Lt,Gt,hn,jt,en,fn),An=new WebGLCubeMaps(z),_n=new WebGLCubeUVMaps(z),Bn=new WebGLAttributes(Ue,jt),xn=new WebGLBindingStates(Ue,Lt,Bn,jt),de=new WebGLGeometries(Ue,Bn,fn,xn),Ae=new WebGLObjects(Ue,de,Bn,fn),ht=new WebGLMorphtargets(Ue,jt,qt),Mt=new WebGLClipping(hn),Le=new WebGLPrograms(z,An,_n,Lt,jt,xn,Mt),Oe=new WebGLMaterials(z,hn),$e=new WebGLRenderLists,pt=new WebGLRenderStates(Lt,jt),xt=new WebGLBackground(z,An,_n,Gt,Ae,X,R),Bt=new WebGLShadowMap(z,Ae,jt),wi=new WebGLUniformsGroups(Ue,fn,jt,Gt),zt=new WebGLBufferRenderer(Ue,Lt,fn,jt),dn=new WebGLIndexedBufferRenderer(Ue,Lt,fn,jt),fn.programs=Le.programs,z.capabilities=jt,z.extensions=Lt,z.properties=hn,z.renderLists=$e,z.shadowMap=Bt,z.state=Gt,z.info=fn}Gi();const Pe=new WebXRManager(z,Ue);this.xr=Pe,this.getContext=function(){return Ue},this.getContextAttributes=function(){return Ue.getContextAttributes()},this.forceContextLoss=function(){const gt=Lt.get("WEBGL_lose_context");gt&&gt.loseContext()},this.forceContextRestore=function(){const gt=Lt.get("WEBGL_lose_context");gt&&gt.restoreContext()},this.getPixelRatio=function(){return Fe},this.setPixelRatio=function(gt){gt!==void 0&&(Fe=gt,this.setSize(Te,ke,!1))},this.getSize=function(gt){return gt.set(Te,ke)},this.setSize=function(gt,Wt,bn=!0){if(Pe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Te=gt,ke=Wt,i.width=Math.floor(gt*Fe),i.height=Math.floor(Wt*Fe),bn===!0&&(i.style.width=gt+"px",i.style.height=Wt+"px"),this.setViewport(0,0,gt,Wt)},this.getDrawingBufferSize=function(gt){return gt.set(Te*Fe,ke*Fe).floor()},this.setDrawingBufferSize=function(gt,Wt,bn){Te=gt,ke=Wt,Fe=bn,i.width=Math.floor(gt*bn),i.height=Math.floor(Wt*bn),this.setViewport(0,0,gt,Wt)},this.getCurrentViewport=function(gt){return gt.copy(ve)},this.getViewport=function(gt){return gt.copy(Ye)},this.setViewport=function(gt,Wt,bn,ln){gt.isVector4?Ye.set(gt.x,gt.y,gt.z,gt.w):Ye.set(gt,Wt,bn,ln),Gt.viewport(ve.copy(Ye).multiplyScalar(Fe).floor())},this.getScissor=function(gt){return gt.copy(Ze)},this.setScissor=function(gt,Wt,bn,ln){gt.isVector4?Ze.set(gt.x,gt.y,gt.z,gt.w):Ze.set(gt,Wt,bn,ln),Gt.scissor(re.copy(Ze).multiplyScalar(Fe).floor())},this.getScissorTest=function(){return tt},this.setScissorTest=function(gt){Gt.setScissorTest(tt=gt)},this.setOpaqueSort=function(gt){Ve=gt},this.setTransparentSort=function(gt){ot=gt},this.getClearColor=function(gt){return gt.copy(xt.getClearColor())},this.setClearColor=function(){xt.setClearColor.apply(xt,arguments)},this.getClearAlpha=function(){return xt.getClearAlpha()},this.setClearAlpha=function(){xt.setClearAlpha.apply(xt,arguments)},this.clear=function(gt=!0,Wt=!0,bn=!0){let ln=0;if(gt){let mn=!1;if(K!==null){const Pi=K.texture.format;mn=Pi===RGBAIntegerFormat||Pi===RGIntegerFormat||Pi===RedIntegerFormat}if(mn){const Pi=K.texture.type,Di=Pi===UnsignedByteType||Pi===UnsignedIntType||Pi===UnsignedShortType||Pi===UnsignedInt248Type||Pi===UnsignedShort4444Type||Pi===UnsignedShort5551Type,En=xt.getClearColor(),nr=xt.getClearAlpha(),Hn=En.r,Ni=En.g,Me=En.b;Di?(J[0]=Hn,J[1]=Ni,J[2]=Me,J[3]=nr,Ue.clearBufferuiv(Ue.COLOR,0,J)):($[0]=Hn,$[1]=Ni,$[2]=Me,$[3]=nr,Ue.clearBufferiv(Ue.COLOR,0,$))}else ln|=Ue.COLOR_BUFFER_BIT}Wt&&(ln|=Ue.DEPTH_BUFFER_BIT),bn&&(ln|=Ue.STENCIL_BUFFER_BIT),Ue.clear(ln)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",oi,!1),i.removeEventListener("webglcontextrestored",pn,!1),i.removeEventListener("webglcontextcreationerror",Dn,!1),$e.dispose(),pt.dispose(),hn.dispose(),An.dispose(),_n.dispose(),Ae.dispose(),xn.dispose(),wi.dispose(),Le.dispose(),Pe.dispose(),Pe.removeEventListener("sessionstart",es),Pe.removeEventListener("sessionend",Ps),et&&(et.dispose(),et=null),Jr.stop()};function oi(gt){gt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ce=!0}function pn(){console.log("THREE.WebGLRenderer: Context Restored."),ce=!1;const gt=fn.autoReset,Wt=Bt.enabled,bn=Bt.autoUpdate,ln=Bt.needsUpdate,mn=Bt.type;Gi(),fn.autoReset=gt,Bt.enabled=Wt,Bt.autoUpdate=bn,Bt.needsUpdate=ln,Bt.type=mn}function Dn(gt){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",gt.statusMessage)}function kn(gt){const Wt=gt.target;Wt.removeEventListener("dispose",kn),ui(Wt)}function ui(gt){Nr(gt),hn.remove(gt)}function Nr(gt){const Wt=hn.get(gt).programs;Wt!==void 0&&(Wt.forEach(function(bn){Le.releaseProgram(bn)}),gt.isShaderMaterial&&Le.releaseShaderCache(gt))}this.renderBufferDirect=function(gt,Wt,bn,ln,mn,Pi){Wt===null&&(Wt=Vn);const Di=mn.isMesh&&mn.matrixWorld.determinant()<0,En=Jl(gt,Wt,bn,ln,mn);Gt.setMaterial(ln,Di);let nr=bn.index,Hn=1;if(ln.wireframe===!0){if(nr=de.getWireframeAttribute(bn),nr===void 0)return;Hn=2}const Ni=bn.drawRange,Me=bn.attributes.position;let Ee=Ni.start*Hn,We=(Ni.start+Ni.count)*Hn;Pi!==null&&(Ee=Math.max(Ee,Pi.start*Hn),We=Math.min(We,(Pi.start+Pi.count)*Hn)),nr!==null?(Ee=Math.max(Ee,0),We=Math.min(We,nr.count)):Me!=null&&(Ee=Math.max(Ee,0),We=Math.min(We,Me.count));const it=We-Ee;if(it<0||it===1/0)return;xn.setup(mn,ln,En,bn,nr);let je,_t=zt;if(nr!==null&&(je=Bn.get(nr),_t=dn,_t.setIndex(je)),mn.isMesh)ln.wireframe===!0?(Gt.setLineWidth(ln.wireframeLinewidth*Jn()),_t.setMode(Ue.LINES)):_t.setMode(Ue.TRIANGLES);else if(mn.isLine){let qe=ln.linewidth;qe===void 0&&(qe=1),Gt.setLineWidth(qe*Jn()),mn.isLineSegments?_t.setMode(Ue.LINES):mn.isLineLoop?_t.setMode(Ue.LINE_LOOP):_t.setMode(Ue.LINE_STRIP)}else mn.isPoints?_t.setMode(Ue.POINTS):mn.isSprite&&_t.setMode(Ue.TRIANGLES);if(mn.isInstancedMesh)_t.renderInstances(Ee,it,mn.count);else if(bn.isInstancedBufferGeometry){const qe=bn._maxInstanceCount!==void 0?bn._maxInstanceCount:1/0,lt=Math.min(bn.instanceCount,qe);_t.renderInstances(Ee,it,lt)}else _t.render(Ee,it)},this.compile=function(gt,Wt){function bn(ln,mn,Pi){ln.transparent===!0&&ln.side===DoubleSide&&ln.forceSinglePass===!1?(ln.side=BackSide,ln.needsUpdate=!0,Bo(ln,mn,Pi),ln.side=FrontSide,ln.needsUpdate=!0,Bo(ln,mn,Pi),ln.side=DoubleSide):Bo(ln,mn,Pi)}ne=pt.get(gt),ne.init(),V.push(ne),gt.traverseVisible(function(ln){ln.isLight&&ln.layers.test(Wt.layers)&&(ne.pushLight(ln),ln.castShadow&&ne.pushShadow(ln))}),ne.setupLights(z._useLegacyLights),gt.traverse(function(ln){const mn=ln.material;if(mn)if(Array.isArray(mn))for(let Pi=0;Pi<mn.length;Pi++){const Di=mn[Pi];bn(Di,gt,ln)}else bn(mn,gt,ln)}),V.pop(),ne=null};let Pr=null;function wr(gt){Pr&&Pr(gt)}function es(){Jr.stop()}function Ps(){Jr.start()}const Jr=new WebGLAnimation;Jr.setAnimationLoop(wr),typeof self<"u"&&Jr.setContext(self),this.setAnimationLoop=function(gt){Pr=gt,Pe.setAnimationLoop(gt),gt===null?Jr.stop():Jr.start()},Pe.addEventListener("sessionstart",es),Pe.addEventListener("sessionend",Ps),this.render=function(gt,Wt){if(Wt!==void 0&&Wt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(ce===!0)return;gt.matrixWorldAutoUpdate===!0&&gt.updateMatrixWorld(),Wt.parent===null&&Wt.matrixWorldAutoUpdate===!0&&Wt.updateMatrixWorld(),Pe.enabled===!0&&Pe.isPresenting===!0&&(Pe.cameraAutoUpdate===!0&&Pe.updateCamera(Wt),Wt=Pe.getCamera()),gt.isScene===!0&&gt.onBeforeRender(z,gt,Wt,K),ne=pt.get(gt,V.length),ne.init(),V.push(ne),wt.multiplyMatrices(Wt.projectionMatrix,Wt.matrixWorldInverse),Pt.setFromProjectionMatrix(wt),Ne=this.localClippingEnabled,Et=Mt.init(this.clippingPlanes,Ne),oe=$e.get(gt,H.length),oe.init(),H.push(oe),cl(gt,Wt,0,z.sortObjects),oe.finish(),z.sortObjects===!0&&oe.sort(Ve,ot),this.info.render.frame++,Et===!0&&Mt.beginShadows();const bn=ne.state.shadowsArray;if(Bt.render(bn,gt,Wt),Et===!0&&Mt.endShadows(),this.info.autoReset===!0&&this.info.reset(),xt.render(oe,gt),ne.setupLights(z._useLegacyLights),Wt.isArrayCamera){const ln=Wt.cameras;for(let mn=0,Pi=ln.length;mn<Pi;mn++){const Di=ln[mn];xs(oe,gt,Di,Di.viewport)}}else xs(oe,gt,Wt);K!==null&&(qt.updateMultisampleRenderTarget(K),qt.updateRenderTargetMipmap(K)),gt.isScene===!0&&gt.onAfterRender(z,gt,Wt),xn.resetDefaultState(),Y=-1,ie=null,V.pop(),V.length>0?ne=V[V.length-1]:ne=null,H.pop(),H.length>0?oe=H[H.length-1]:oe=null};function cl(gt,Wt,bn,ln){if(gt.visible===!1)return;if(gt.layers.test(Wt.layers)){if(gt.isGroup)bn=gt.renderOrder;else if(gt.isLOD)gt.autoUpdate===!0&&gt.update(Wt);else if(gt.isLight)ne.pushLight(gt),gt.castShadow&&ne.pushShadow(gt);else if(gt.isSprite){if(!gt.frustumCulled||Pt.intersectsSprite(gt)){ln&&nn.setFromMatrixPosition(gt.matrixWorld).applyMatrix4(wt);const Di=Ae.update(gt),En=gt.material;En.visible&&oe.push(gt,Di,En,bn,nn.z,null)}}else if((gt.isMesh||gt.isLine||gt.isPoints)&&(!gt.frustumCulled||Pt.intersectsObject(gt))){const Di=Ae.update(gt),En=gt.material;if(ln&&(gt.boundingSphere!==void 0?(gt.boundingSphere===null&&gt.computeBoundingSphere(),nn.copy(gt.boundingSphere.center)):(Di.boundingSphere===null&&Di.computeBoundingSphere(),nn.copy(Di.boundingSphere.center)),nn.applyMatrix4(gt.matrixWorld).applyMatrix4(wt)),Array.isArray(En)){const nr=Di.groups;for(let Hn=0,Ni=nr.length;Hn<Ni;Hn++){const Me=nr[Hn],Ee=En[Me.materialIndex];Ee&&Ee.visible&&oe.push(gt,Di,Ee,bn,nn.z,Me)}}else En.visible&&oe.push(gt,Di,En,bn,nn.z,null)}}const Pi=gt.children;for(let Di=0,En=Pi.length;Di<En;Di++)cl(Pi[Di],Wt,bn,ln)}function xs(gt,Wt,bn,ln){const mn=gt.opaque,Pi=gt.transmissive,Di=gt.transparent;ne.setupLightsView(bn),Et===!0&&Mt.setGlobalState(z.clippingPlanes,bn),Pi.length>0&&wo(mn,Pi,Wt,bn),ln&&Gt.viewport(ve.copy(ln)),mn.length>0&&Cl(mn,Wt,bn),Pi.length>0&&Cl(Pi,Wt,bn),Di.length>0&&Cl(Di,Wt,bn),Gt.buffers.depth.setTest(!0),Gt.buffers.depth.setMask(!0),Gt.buffers.color.setMask(!0),Gt.setPolygonOffset(!1)}function wo(gt,Wt,bn,ln){const mn=jt.isWebGL2;et===null&&(et=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:Lt.has("EXT_color_buffer_half_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:mn?4:0})),z.getDrawingBufferSize(Zt),mn?et.setSize(Zt.x,Zt.y):et.setSize(floorPowerOfTwo(Zt.x),floorPowerOfTwo(Zt.y));const Pi=z.getRenderTarget();z.setRenderTarget(et),z.getClearColor(me),ye=z.getClearAlpha(),ye<1&&z.setClearColor(16777215,.5),z.clear();const Di=z.toneMapping;z.toneMapping=NoToneMapping,Cl(gt,bn,ln),qt.updateMultisampleRenderTarget(et),qt.updateRenderTargetMipmap(et);let En=!1;for(let nr=0,Hn=Wt.length;nr<Hn;nr++){const Ni=Wt[nr],Me=Ni.object,Ee=Ni.geometry,We=Ni.material,it=Ni.group;if(We.side===DoubleSide&&Me.layers.test(ln.layers)){const je=We.side;We.side=BackSide,We.needsUpdate=!0,Zs(Me,bn,ln,Ee,We,it),We.side=je,We.needsUpdate=!0,En=!0}}En===!0&&(qt.updateMultisampleRenderTarget(et),qt.updateRenderTargetMipmap(et)),z.setRenderTarget(Pi),z.setClearColor(me,ye),z.toneMapping=Di}function Cl(gt,Wt,bn){const ln=Wt.isScene===!0?Wt.overrideMaterial:null;for(let mn=0,Pi=gt.length;mn<Pi;mn++){const Di=gt[mn],En=Di.object,nr=Di.geometry,Hn=ln===null?Di.material:ln,Ni=Di.group;En.layers.test(bn.layers)&&Zs(En,Wt,bn,nr,Hn,Ni)}}function Zs(gt,Wt,bn,ln,mn,Pi){gt.onBeforeRender(z,Wt,bn,ln,mn,Pi),gt.modelViewMatrix.multiplyMatrices(bn.matrixWorldInverse,gt.matrixWorld),gt.normalMatrix.getNormalMatrix(gt.modelViewMatrix),mn.onBeforeRender(z,Wt,bn,ln,gt,Pi),mn.transparent===!0&&mn.side===DoubleSide&&mn.forceSinglePass===!1?(mn.side=BackSide,mn.needsUpdate=!0,z.renderBufferDirect(bn,Wt,ln,mn,gt,Pi),mn.side=FrontSide,mn.needsUpdate=!0,z.renderBufferDirect(bn,Wt,ln,mn,gt,Pi),mn.side=DoubleSide):z.renderBufferDirect(bn,Wt,ln,mn,gt,Pi),gt.onAfterRender(z,Wt,bn,ln,mn,Pi)}function Bo(gt,Wt,bn){Wt.isScene!==!0&&(Wt=Vn);const ln=hn.get(gt),mn=ne.state.lights,Pi=ne.state.shadowsArray,Di=mn.state.version,En=Le.getParameters(gt,mn.state,Pi,Wt,bn),nr=Le.getProgramCacheKey(En);let Hn=ln.programs;ln.environment=gt.isMeshStandardMaterial?Wt.environment:null,ln.fog=Wt.fog,ln.envMap=(gt.isMeshStandardMaterial?_n:An).get(gt.envMap||ln.environment),Hn===void 0&&(gt.addEventListener("dispose",kn),Hn=new Map,ln.programs=Hn);let Ni=Hn.get(nr);if(Ni!==void 0){if(ln.currentProgram===Ni&&ln.lightsStateVersion===Di)return co(gt,En),Ni}else En.uniforms=Le.getUniforms(gt),gt.onBuild(bn,En,z),gt.onBeforeCompile(En,z),Ni=Le.acquireProgram(En,nr),Hn.set(nr,Ni),ln.uniforms=En.uniforms;const Me=ln.uniforms;(!gt.isShaderMaterial&&!gt.isRawShaderMaterial||gt.clipping===!0)&&(Me.clippingPlanes=Mt.uniform),co(gt,En),ln.needsLights=ul(gt),ln.lightsStateVersion=Di,ln.needsLights&&(Me.ambientLightColor.value=mn.state.ambient,Me.lightProbe.value=mn.state.probe,Me.directionalLights.value=mn.state.directional,Me.directionalLightShadows.value=mn.state.directionalShadow,Me.spotLights.value=mn.state.spot,Me.spotLightShadows.value=mn.state.spotShadow,Me.rectAreaLights.value=mn.state.rectArea,Me.ltc_1.value=mn.state.rectAreaLTC1,Me.ltc_2.value=mn.state.rectAreaLTC2,Me.pointLights.value=mn.state.point,Me.pointLightShadows.value=mn.state.pointShadow,Me.hemisphereLights.value=mn.state.hemi,Me.directionalShadowMap.value=mn.state.directionalShadowMap,Me.directionalShadowMatrix.value=mn.state.directionalShadowMatrix,Me.spotShadowMap.value=mn.state.spotShadowMap,Me.spotLightMatrix.value=mn.state.spotLightMatrix,Me.spotLightMap.value=mn.state.spotLightMap,Me.pointShadowMap.value=mn.state.pointShadowMap,Me.pointShadowMatrix.value=mn.state.pointShadowMatrix);const Ee=Ni.getUniforms(),We=WebGLUniforms.seqWithValue(Ee.seq,Me);return ln.currentProgram=Ni,ln.uniformsList=We,Ni}function co(gt,Wt){const bn=hn.get(gt);bn.outputColorSpace=Wt.outputColorSpace,bn.instancing=Wt.instancing,bn.instancingColor=Wt.instancingColor,bn.skinning=Wt.skinning,bn.morphTargets=Wt.morphTargets,bn.morphNormals=Wt.morphNormals,bn.morphColors=Wt.morphColors,bn.morphTargetsCount=Wt.morphTargetsCount,bn.numClippingPlanes=Wt.numClippingPlanes,bn.numIntersection=Wt.numClipIntersection,bn.vertexAlphas=Wt.vertexAlphas,bn.vertexTangents=Wt.vertexTangents,bn.toneMapping=Wt.toneMapping}function Jl(gt,Wt,bn,ln,mn){Wt.isScene!==!0&&(Wt=Vn),qt.resetTextureUnits();const Pi=Wt.fog,Di=ln.isMeshStandardMaterial?Wt.environment:null,En=K===null?z.outputColorSpace:K.isXRRenderTarget===!0?K.texture.colorSpace:LinearSRGBColorSpace,nr=(ln.isMeshStandardMaterial?_n:An).get(ln.envMap||Di),Hn=ln.vertexColors===!0&&!!bn.attributes.color&&bn.attributes.color.itemSize===4,Ni=!!bn.attributes.tangent&&(!!ln.normalMap||ln.anisotropy>0),Me=!!bn.morphAttributes.position,Ee=!!bn.morphAttributes.normal,We=!!bn.morphAttributes.color;let it=NoToneMapping;ln.toneMapped&&(K===null||K.isXRRenderTarget===!0)&&(it=z.toneMapping);const je=bn.morphAttributes.position||bn.morphAttributes.normal||bn.morphAttributes.color,_t=je!==void 0?je.length:0,qe=hn.get(ln),lt=ne.state.lights;if(Et===!0&&(Ne===!0||gt!==ie)){const si=gt===ie&&ln.id===Y;Mt.setState(ln,gt,si)}let Nt=!1;ln.version===qe.__version?(qe.needsLights&&qe.lightsStateVersion!==lt.state.version||qe.outputColorSpace!==En||mn.isInstancedMesh&&qe.instancing===!1||!mn.isInstancedMesh&&qe.instancing===!0||mn.isSkinnedMesh&&qe.skinning===!1||!mn.isSkinnedMesh&&qe.skinning===!0||mn.isInstancedMesh&&qe.instancingColor===!0&&mn.instanceColor===null||mn.isInstancedMesh&&qe.instancingColor===!1&&mn.instanceColor!==null||qe.envMap!==nr||ln.fog===!0&&qe.fog!==Pi||qe.numClippingPlanes!==void 0&&(qe.numClippingPlanes!==Mt.numPlanes||qe.numIntersection!==Mt.numIntersection)||qe.vertexAlphas!==Hn||qe.vertexTangents!==Ni||qe.morphTargets!==Me||qe.morphNormals!==Ee||qe.morphColors!==We||qe.toneMapping!==it||jt.isWebGL2===!0&&qe.morphTargetsCount!==_t)&&(Nt=!0):(Nt=!0,qe.__version=ln.version);let cn=qe.currentProgram;Nt===!0&&(cn=Bo(ln,Wt,mn));let Xt=!1,In=!1,Ut=!1;const Zn=cn.getUniforms(),On=qe.uniforms;if(Gt.useProgram(cn.program)&&(Xt=!0,In=!0,Ut=!0),ln.id!==Y&&(Y=ln.id,In=!0),Xt||ie!==gt){Zn.setValue(Ue,"projectionMatrix",gt.projectionMatrix),Zn.setValue(Ue,"viewMatrix",gt.matrixWorldInverse);const si=Zn.map.cameraPosition;si!==void 0&&si.setValue(Ue,nn.setFromMatrixPosition(gt.matrixWorld)),jt.logarithmicDepthBuffer&&Zn.setValue(Ue,"logDepthBufFC",2/(Math.log(gt.far+1)/Math.LN2)),(ln.isMeshPhongMaterial||ln.isMeshToonMaterial||ln.isMeshLambertMaterial||ln.isMeshBasicMaterial||ln.isMeshStandardMaterial||ln.isShaderMaterial)&&Zn.setValue(Ue,"isOrthographic",gt.isOrthographicCamera===!0),ie!==gt&&(ie=gt,In=!0,Ut=!0)}if(mn.isSkinnedMesh){Zn.setOptional(Ue,mn,"bindMatrix"),Zn.setOptional(Ue,mn,"bindMatrixInverse");const si=mn.skeleton;si&&(jt.floatVertexTextures?(si.boneTexture===null&&si.computeBoneTexture(),Zn.setValue(Ue,"boneTexture",si.boneTexture,qt),Zn.setValue(Ue,"boneTextureSize",si.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Yt=bn.morphAttributes;if((Yt.position!==void 0||Yt.normal!==void 0||Yt.color!==void 0&&jt.isWebGL2===!0)&&ht.update(mn,bn,cn),(In||qe.receiveShadow!==mn.receiveShadow)&&(qe.receiveShadow=mn.receiveShadow,Zn.setValue(Ue,"receiveShadow",mn.receiveShadow)),ln.isMeshGouraudMaterial&&ln.envMap!==null&&(On.envMap.value=nr,On.flipEnvMap.value=nr.isCubeTexture&&nr.isRenderTargetTexture===!1?-1:1),In&&(Zn.setValue(Ue,"toneMappingExposure",z.toneMappingExposure),qe.needsLights&&mh(On,Ut),Pi&&ln.fog===!0&&Oe.refreshFogUniforms(On,Pi),Oe.refreshMaterialUniforms(On,ln,Fe,ke,et),WebGLUniforms.upload(Ue,qe.uniformsList,On,qt)),ln.isShaderMaterial&&ln.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(Ue,qe.uniformsList,On,qt),ln.uniformsNeedUpdate=!1),ln.isSpriteMaterial&&Zn.setValue(Ue,"center",mn.center),Zn.setValue(Ue,"modelViewMatrix",mn.modelViewMatrix),Zn.setValue(Ue,"normalMatrix",mn.normalMatrix),Zn.setValue(Ue,"modelMatrix",mn.matrixWorld),ln.isShaderMaterial||ln.isRawShaderMaterial){const si=ln.uniformsGroups;for(let Tn=0,_i=si.length;Tn<_i;Tn++)if(jt.isWebGL2){const Ii=si[Tn];wi.update(Ii,cn),wi.bind(Ii,cn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return cn}function mh(gt,Wt){gt.ambientLightColor.needsUpdate=Wt,gt.lightProbe.needsUpdate=Wt,gt.directionalLights.needsUpdate=Wt,gt.directionalLightShadows.needsUpdate=Wt,gt.pointLights.needsUpdate=Wt,gt.pointLightShadows.needsUpdate=Wt,gt.spotLights.needsUpdate=Wt,gt.spotLightShadows.needsUpdate=Wt,gt.rectAreaLights.needsUpdate=Wt,gt.hemisphereLights.needsUpdate=Wt}function ul(gt){return gt.isMeshLambertMaterial||gt.isMeshToonMaterial||gt.isMeshPhongMaterial||gt.isMeshStandardMaterial||gt.isShadowMaterial||gt.isShaderMaterial&&gt.lights===!0}this.getActiveCubeFace=function(){return ue},this.getActiveMipmapLevel=function(){return he},this.getRenderTarget=function(){return K},this.setRenderTargetTextures=function(gt,Wt,bn){hn.get(gt.texture).__webglTexture=Wt,hn.get(gt.depthTexture).__webglTexture=bn;const ln=hn.get(gt);ln.__hasExternalTextures=!0,ln.__hasExternalTextures&&(ln.__autoAllocateDepthBuffer=bn===void 0,ln.__autoAllocateDepthBuffer||Lt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ln.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(gt,Wt){const bn=hn.get(gt);bn.__webglFramebuffer=Wt,bn.__useDefaultFramebuffer=Wt===void 0},this.setRenderTarget=function(gt,Wt=0,bn=0){K=gt,ue=Wt,he=bn;let ln=!0,mn=null,Pi=!1,Di=!1;if(gt){const nr=hn.get(gt);nr.__useDefaultFramebuffer!==void 0?(Gt.bindFramebuffer(Ue.FRAMEBUFFER,null),ln=!1):nr.__webglFramebuffer===void 0?qt.setupRenderTarget(gt):nr.__hasExternalTextures&&qt.rebindTextures(gt,hn.get(gt.texture).__webglTexture,hn.get(gt.depthTexture).__webglTexture);const Hn=gt.texture;(Hn.isData3DTexture||Hn.isDataArrayTexture||Hn.isCompressedArrayTexture)&&(Di=!0);const Ni=hn.get(gt).__webglFramebuffer;gt.isWebGLCubeRenderTarget?(Array.isArray(Ni[Wt])?mn=Ni[Wt][bn]:mn=Ni[Wt],Pi=!0):jt.isWebGL2&&gt.samples>0&&qt.useMultisampledRTT(gt)===!1?mn=hn.get(gt).__webglMultisampledFramebuffer:Array.isArray(Ni)?mn=Ni[bn]:mn=Ni,ve.copy(gt.viewport),re.copy(gt.scissor),ae=gt.scissorTest}else ve.copy(Ye).multiplyScalar(Fe).floor(),re.copy(Ze).multiplyScalar(Fe).floor(),ae=tt;if(Gt.bindFramebuffer(Ue.FRAMEBUFFER,mn)&&jt.drawBuffers&&ln&&Gt.drawBuffers(gt,mn),Gt.viewport(ve),Gt.scissor(re),Gt.setScissorTest(ae),Pi){const nr=hn.get(gt.texture);Ue.framebufferTexture2D(Ue.FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Ue.TEXTURE_CUBE_MAP_POSITIVE_X+Wt,nr.__webglTexture,bn)}else if(Di){const nr=hn.get(gt.texture),Hn=Wt||0;Ue.framebufferTextureLayer(Ue.FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,nr.__webglTexture,bn||0,Hn)}Y=-1},this.readRenderTargetPixels=function(gt,Wt,bn,ln,mn,Pi,Di){if(!(gt&&gt.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let En=hn.get(gt).__webglFramebuffer;if(gt.isWebGLCubeRenderTarget&&Di!==void 0&&(En=En[Di]),En){Gt.bindFramebuffer(Ue.FRAMEBUFFER,En);try{const nr=gt.texture,Hn=nr.format,Ni=nr.type;if(Hn!==RGBAFormat&&en.convert(Hn)!==Ue.getParameter(Ue.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Me=Ni===HalfFloatType&&(Lt.has("EXT_color_buffer_half_float")||jt.isWebGL2&&Lt.has("EXT_color_buffer_float"));if(Ni!==UnsignedByteType&&en.convert(Ni)!==Ue.getParameter(Ue.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Ni===FloatType&&(jt.isWebGL2||Lt.has("OES_texture_float")||Lt.has("WEBGL_color_buffer_float")))&&!Me){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Wt>=0&&Wt<=gt.width-ln&&bn>=0&&bn<=gt.height-mn&&Ue.readPixels(Wt,bn,ln,mn,en.convert(Hn),en.convert(Ni),Pi)}finally{const nr=K!==null?hn.get(K).__webglFramebuffer:null;Gt.bindFramebuffer(Ue.FRAMEBUFFER,nr)}}},this.copyFramebufferToTexture=function(gt,Wt,bn=0){const ln=Math.pow(2,-bn),mn=Math.floor(Wt.image.width*ln),Pi=Math.floor(Wt.image.height*ln);qt.setTexture2D(Wt,0),Ue.copyTexSubImage2D(Ue.TEXTURE_2D,bn,0,0,gt.x,gt.y,mn,Pi),Gt.unbindTexture()},this.copyTextureToTexture=function(gt,Wt,bn,ln=0){const mn=Wt.image.width,Pi=Wt.image.height,Di=en.convert(bn.format),En=en.convert(bn.type);qt.setTexture2D(bn,0),Ue.pixelStorei(Ue.UNPACK_FLIP_Y_WEBGL,bn.flipY),Ue.pixelStorei(Ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,bn.premultiplyAlpha),Ue.pixelStorei(Ue.UNPACK_ALIGNMENT,bn.unpackAlignment),Wt.isDataTexture?Ue.texSubImage2D(Ue.TEXTURE_2D,ln,gt.x,gt.y,mn,Pi,Di,En,Wt.image.data):Wt.isCompressedTexture?Ue.compressedTexSubImage2D(Ue.TEXTURE_2D,ln,gt.x,gt.y,Wt.mipmaps[0].width,Wt.mipmaps[0].height,Di,Wt.mipmaps[0].data):Ue.texSubImage2D(Ue.TEXTURE_2D,ln,gt.x,gt.y,Di,En,Wt.image),ln===0&&bn.generateMipmaps&&Ue.generateMipmap(Ue.TEXTURE_2D),Gt.unbindTexture()},this.copyTextureToTexture3D=function(gt,Wt,bn,ln,mn=0){if(z.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Pi=gt.max.x-gt.min.x+1,Di=gt.max.y-gt.min.y+1,En=gt.max.z-gt.min.z+1,nr=en.convert(ln.format),Hn=en.convert(ln.type);let Ni;if(ln.isData3DTexture)qt.setTexture3D(ln,0),Ni=Ue.TEXTURE_3D;else if(ln.isDataArrayTexture)qt.setTexture2DArray(ln,0),Ni=Ue.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Ue.pixelStorei(Ue.UNPACK_FLIP_Y_WEBGL,ln.flipY),Ue.pixelStorei(Ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ln.premultiplyAlpha),Ue.pixelStorei(Ue.UNPACK_ALIGNMENT,ln.unpackAlignment);const Me=Ue.getParameter(Ue.UNPACK_ROW_LENGTH),Ee=Ue.getParameter(Ue.UNPACK_IMAGE_HEIGHT),We=Ue.getParameter(Ue.UNPACK_SKIP_PIXELS),it=Ue.getParameter(Ue.UNPACK_SKIP_ROWS),je=Ue.getParameter(Ue.UNPACK_SKIP_IMAGES),_t=bn.isCompressedTexture?bn.mipmaps[0]:bn.image;Ue.pixelStorei(Ue.UNPACK_ROW_LENGTH,_t.width),Ue.pixelStorei(Ue.UNPACK_IMAGE_HEIGHT,_t.height),Ue.pixelStorei(Ue.UNPACK_SKIP_PIXELS,gt.min.x),Ue.pixelStorei(Ue.UNPACK_SKIP_ROWS,gt.min.y),Ue.pixelStorei(Ue.UNPACK_SKIP_IMAGES,gt.min.z),bn.isDataTexture||bn.isData3DTexture?Ue.texSubImage3D(Ni,mn,Wt.x,Wt.y,Wt.z,Pi,Di,En,nr,Hn,_t.data):bn.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ue.compressedTexSubImage3D(Ni,mn,Wt.x,Wt.y,Wt.z,Pi,Di,En,nr,_t.data)):Ue.texSubImage3D(Ni,mn,Wt.x,Wt.y,Wt.z,Pi,Di,En,nr,Hn,_t),Ue.pixelStorei(Ue.UNPACK_ROW_LENGTH,Me),Ue.pixelStorei(Ue.UNPACK_IMAGE_HEIGHT,Ee),Ue.pixelStorei(Ue.UNPACK_SKIP_PIXELS,We),Ue.pixelStorei(Ue.UNPACK_SKIP_ROWS,it),Ue.pixelStorei(Ue.UNPACK_SKIP_IMAGES,je),mn===0&&ln.generateMipmaps&&Ue.generateMipmap(Ni),Gt.unbindTexture()},this.initTexture=function(gt){gt.isCubeTexture?qt.setTextureCube(gt,0):gt.isData3DTexture?qt.setTexture3D(gt,0):gt.isDataArrayTexture||gt.isCompressedArrayTexture?qt.setTexture2DArray(gt,0):qt.setTexture2D(gt,0),Gt.unbindTexture()},this.resetState=function(){ue=0,he=0,K=null,Gt.reset(),xn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(r){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!r}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set outputEncoding(r){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=r===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(r){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=r}}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(r,i){return super.copy(r,i),r.background!==null&&(this.background=r.background.clone()),r.environment!==null&&(this.environment=r.environment.clone()),r.fog!==null&&(this.fog=r.fog.clone()),this.backgroundBlurriness=r.backgroundBlurriness,this.backgroundIntensity=r.backgroundIntensity,r.overrideMaterial!==null&&(this.overrideMaterial=r.overrideMaterial.clone()),this.matrixAutoUpdate=r.matrixAutoUpdate,this}toJSON(r){const i=super.toJSON(r);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i}}class InterleavedBuffer{constructor(r,i){this.isInterleavedBuffer=!0,this.array=r,this.stride=i,this.count=r!==void 0?r.length/i:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.array=new r.array.constructor(r.array),this.count=r.count,this.stride=r.stride,this.usage=r.usage,this}copyAt(r,i,m){r*=this.stride,m*=i.stride;for(let _=0,A=this.stride;_<A;_++)this.array[r+_]=i.array[m+_];return this}set(r,i=0){return this.array.set(r,i),this}clone(r){r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(r.arrayBuffers[this.array.buffer._uuid]),m=new this.constructor(i,this.stride);return m.setUsage(this.usage),m}onUpload(r){return this.onUploadCallback=r,this}toJSON(r){return r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$5=new Vector3;class InterleavedBufferAttribute{constructor(r,i,m,_=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=r,this.itemSize=i,this.offset=m,this.normalized=_}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(r){this.data.needsUpdate=r}applyMatrix4(r){for(let i=0,m=this.data.count;i<m;i++)_vector$5.fromBufferAttribute(this,i),_vector$5.applyMatrix4(r),this.setXYZ(i,_vector$5.x,_vector$5.y,_vector$5.z);return this}applyNormalMatrix(r){for(let i=0,m=this.count;i<m;i++)_vector$5.fromBufferAttribute(this,i),_vector$5.applyNormalMatrix(r),this.setXYZ(i,_vector$5.x,_vector$5.y,_vector$5.z);return this}transformDirection(r){for(let i=0,m=this.count;i<m;i++)_vector$5.fromBufferAttribute(this,i),_vector$5.transformDirection(r),this.setXYZ(i,_vector$5.x,_vector$5.y,_vector$5.z);return this}setX(r,i){return this.normalized&&(i=normalize(i,this.array)),this.data.array[r*this.data.stride+this.offset]=i,this}setY(r,i){return this.normalized&&(i=normalize(i,this.array)),this.data.array[r*this.data.stride+this.offset+1]=i,this}setZ(r,i){return this.normalized&&(i=normalize(i,this.array)),this.data.array[r*this.data.stride+this.offset+2]=i,this}setW(r,i){return this.normalized&&(i=normalize(i,this.array)),this.data.array[r*this.data.stride+this.offset+3]=i,this}getX(r){let i=this.data.array[r*this.data.stride+this.offset];return this.normalized&&(i=denormalize(i,this.array)),i}getY(r){let i=this.data.array[r*this.data.stride+this.offset+1];return this.normalized&&(i=denormalize(i,this.array)),i}getZ(r){let i=this.data.array[r*this.data.stride+this.offset+2];return this.normalized&&(i=denormalize(i,this.array)),i}getW(r){let i=this.data.array[r*this.data.stride+this.offset+3];return this.normalized&&(i=denormalize(i,this.array)),i}setXY(r,i,m){return r=r*this.data.stride+this.offset,this.normalized&&(i=normalize(i,this.array),m=normalize(m,this.array)),this.data.array[r+0]=i,this.data.array[r+1]=m,this}setXYZ(r,i,m,_){return r=r*this.data.stride+this.offset,this.normalized&&(i=normalize(i,this.array),m=normalize(m,this.array),_=normalize(_,this.array)),this.data.array[r+0]=i,this.data.array[r+1]=m,this.data.array[r+2]=_,this}setXYZW(r,i,m,_,A){return r=r*this.data.stride+this.offset,this.normalized&&(i=normalize(i,this.array),m=normalize(m,this.array),_=normalize(_,this.array),A=normalize(A,this.array)),this.data.array[r+0]=i,this.data.array[r+1]=m,this.data.array[r+2]=_,this.data.array[r+3]=A,this}clone(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let m=0;m<this.count;m++){const _=m*this.data.stride+this.offset;for(let A=0;A<this.itemSize;A++)i.push(this.data.array[_+A])}return new BufferAttribute(new this.array.constructor(i),this.itemSize,this.normalized)}else return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.clone(r)),new InterleavedBufferAttribute(r.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let m=0;m<this.count;m++){const _=m*this.data.stride+this.offset;for(let A=0;A<this.itemSize;A++)i.push(this.data.array[_+A])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.toJSON(r)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$3=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2=new Ray;class SkinnedMesh extends Mesh{constructor(r,i){super(r,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const r=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const i=r.getAttribute("position");for(let m=0;m<i.count;m++)_vertex.fromBufferAttribute(i,m),this.applyBoneTransform(m,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const r=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const i=r.getAttribute("position");for(let m=0;m<i.count;m++)_vertex.fromBufferAttribute(i,m),this.applyBoneTransform(m,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(r,i){return super.copy(r,i),this.bindMode=r.bindMode,this.bindMatrix.copy(r.bindMatrix),this.bindMatrixInverse.copy(r.bindMatrixInverse),this.skeleton=r.skeleton,r.boundingBox!==null&&(this.boundingBox=r.boundingBox.clone()),r.boundingSphere!==null&&(this.boundingSphere=r.boundingSphere.clone()),this}raycast(r,i){const m=this.material,_=this.matrixWorld;m!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$3.copy(this.boundingSphere),_sphere$3.applyMatrix4(_),r.ray.intersectsSphere(_sphere$3)!==!1&&(_inverseMatrix$2.copy(_).invert(),_ray$2.copy(r.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(r,i,_ray$2)))}getVertexPosition(r,i){return super.getVertexPosition(r,i),this.applyBoneTransform(r,i),i}bind(r,i){this.skeleton=r,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const r=new Vector4,i=this.geometry.attributes.skinWeight;for(let m=0,_=i.count;m<_;m++){r.fromBufferAttribute(i,m);const A=1/r.manhattanLength();A!==1/0?r.multiplyScalar(A):r.set(1,0,0,0),i.setXYZW(m,r.x,r.y,r.z,r.w)}}updateMatrixWorld(r){super.updateMatrixWorld(r),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(r,i){const m=this.skeleton,_=this.geometry;_skinIndex.fromBufferAttribute(_.attributes.skinIndex,r),_skinWeight.fromBufferAttribute(_.attributes.skinWeight,r),_basePosition.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let A=0;A<4;A++){const w=_skinWeight.getComponent(A);if(w!==0){const T=_skinIndex.getComponent(A);_matrix4.multiplyMatrices(m.bones[T].matrixWorld,m.boneInverses[T]),i.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),w)}}return i.applyMatrix4(this.bindMatrixInverse)}boneTransform(r,i){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(r,i)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(r=null,i=1,m=1,_,A,w,T,R,D=NearestFilter,U=NearestFilter,k,X){super(null,w,T,R,D,U,_,A,k,X),this.isDataTexture=!0,this.image={data:r,width:i,height:m},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix$1=new Matrix4;class Skeleton{constructor(r=[],i=[]){this.uuid=generateUUID(),this.bones=r.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const r=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(r.length*16),i.length===0)this.calculateInverses();else if(r.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let m=0,_=this.bones.length;m<_;m++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let r=0,i=this.bones.length;r<i;r++){const m=new Matrix4;this.bones[r]&&m.copy(this.bones[r].matrixWorld).invert(),this.boneInverses.push(m)}}pose(){for(let r=0,i=this.bones.length;r<i;r++){const m=this.bones[r];m&&m.matrixWorld.copy(this.boneInverses[r]).invert()}for(let r=0,i=this.bones.length;r<i;r++){const m=this.bones[r];m&&(m.parent&&m.parent.isBone?(m.matrix.copy(m.parent.matrixWorld).invert(),m.matrix.multiply(m.matrixWorld)):m.matrix.copy(m.matrixWorld),m.matrix.decompose(m.position,m.quaternion,m.scale))}}update(){const r=this.bones,i=this.boneInverses,m=this.boneMatrices,_=this.boneTexture;for(let A=0,w=r.length;A<w;A++){const T=r[A]?r[A].matrixWorld:_identityMatrix$1;_offsetMatrix.multiplyMatrices(T,i[A]),_offsetMatrix.toArray(m,A*16)}_!==null&&(_.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let r=Math.sqrt(this.bones.length*4);r=ceilPowerOfTwo(r),r=Math.max(r,4);const i=new Float32Array(r*r*4);i.set(this.boneMatrices);const m=new DataTexture(i,r,r,RGBAFormat,FloatType);return m.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=m,this.boneTextureSize=r,this}getBoneByName(r){for(let i=0,m=this.bones.length;i<m;i++){const _=this.bones[i];if(_.name===r)return _}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,i){this.uuid=r.uuid;for(let m=0,_=r.bones.length;m<_;m++){const A=r.bones[m];let w=i[A];w===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",A),w=new Bone),this.bones.push(w),this.boneInverses.push(new Matrix4().fromArray(r.boneInverses[m]))}return this.init(),this}toJSON(){const r={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};r.uuid=this.uuid;const i=this.bones,m=this.boneInverses;for(let _=0,A=i.length;_<A;_++){const w=i[_];r.bones.push(w.uuid);const T=m[_];r.boneInverses.push(T.toArray())}return r}}class InstancedBufferAttribute extends BufferAttribute{constructor(r,i,m,_=1){super(r,i,m),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=_}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}toJSON(){const r=super.toJSON();return r.meshPerAttribute=this.meshPerAttribute,r.isInstancedBufferAttribute=!0,r}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh=new Mesh,_sphere$2=new Sphere;class InstancedMesh extends Mesh{constructor(r,i,m){super(r,i),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(m*16),16),this.instanceColor=null,this.count=m,this.boundingBox=null,this.boundingSphere=null;for(let _=0;_<m;_++)this.setMatrixAt(_,_identity)}computeBoundingBox(){const r=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),r.boundingBox===null&&r.computeBoundingBox(),this.boundingBox.makeEmpty();for(let m=0;m<i;m++)this.getMatrixAt(m,_instanceLocalMatrix),_box3.copy(r.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const r=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere),r.boundingSphere===null&&r.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let m=0;m<i;m++)this.getMatrixAt(m,_instanceLocalMatrix),_sphere$2.copy(r.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$2)}copy(r,i){return super.copy(r,i),this.instanceMatrix.copy(r.instanceMatrix),r.instanceColor!==null&&(this.instanceColor=r.instanceColor.clone()),this.count=r.count,r.boundingBox!==null&&(this.boundingBox=r.boundingBox.clone()),r.boundingSphere!==null&&(this.boundingSphere=r.boundingSphere.clone()),this}getColorAt(r,i){i.fromArray(this.instanceColor.array,r*3)}getMatrixAt(r,i){i.fromArray(this.instanceMatrix.array,r*16)}raycast(r,i){const m=this.matrixWorld,_=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,_mesh.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$2.copy(this.boundingSphere),_sphere$2.applyMatrix4(m),r.ray.intersectsSphere(_sphere$2)!==!1))for(let A=0;A<_;A++){this.getMatrixAt(A,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(m,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(r,_instanceIntersects);for(let w=0,T=_instanceIntersects.length;w<T;w++){const R=_instanceIntersects[w];R.instanceId=A,R.object=this,i.push(R)}_instanceIntersects.length=0}}setColorAt(r,i){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,r*3)}setMatrixAt(r,i){i.toArray(this.instanceMatrix.array,r*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class LineBasicMaterial extends Material{constructor(r){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}}const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;class Line extends Object3D{constructor(r=new BufferGeometry$1,i=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=r,this.material=i,this.updateMorphTargets()}copy(r,i){return super.copy(r,i),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}computeLineDistances(){const r=this.geometry;if(r.index===null){const i=r.attributes.position,m=[0];for(let _=1,A=i.count;_<A;_++)_start$1.fromBufferAttribute(i,_-1),_end$1.fromBufferAttribute(i,_),m[_]=m[_-1],m[_]+=_start$1.distanceTo(_end$1);r.setAttribute("lineDistance",new Float32BufferAttribute(m,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(r,i){const m=this.geometry,_=this.matrixWorld,A=r.params.Line.threshold,w=m.drawRange;if(m.boundingSphere===null&&m.computeBoundingSphere(),_sphere$1.copy(m.boundingSphere),_sphere$1.applyMatrix4(_),_sphere$1.radius+=A,r.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(_).invert(),_ray$1.copy(r.ray).applyMatrix4(_inverseMatrix$1);const T=A/((this.scale.x+this.scale.y+this.scale.z)/3),R=T*T,D=new Vector3,U=new Vector3,k=new Vector3,X=new Vector3,J=this.isLineSegments?2:1,$=m.index,ne=m.attributes.position;if($!==null){const H=Math.max(0,w.start),V=Math.min($.count,w.start+w.count);for(let z=H,ce=V-1;z<ce;z+=J){const ue=$.getX(z),he=$.getX(z+1);if(D.fromBufferAttribute(ne,ue),U.fromBufferAttribute(ne,he),_ray$1.distanceSqToSegment(D,U,X,k)>R)continue;X.applyMatrix4(this.matrixWorld);const Y=r.ray.origin.distanceTo(X);Y<r.near||Y>r.far||i.push({distance:Y,point:k.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this})}}else{const H=Math.max(0,w.start),V=Math.min(ne.count,w.start+w.count);for(let z=H,ce=V-1;z<ce;z+=J){if(D.fromBufferAttribute(ne,z),U.fromBufferAttribute(ne,z+1),_ray$1.distanceSqToSegment(D,U,X,k)>R)continue;X.applyMatrix4(this.matrixWorld);const he=r.ray.origin.distanceTo(X);he<r.near||he>r.far||i.push({distance:he,point:k.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const i=this.geometry.morphAttributes,m=Object.keys(i);if(m.length>0){const _=i[m[0]];if(_!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let A=0,w=_.length;A<w;A++){const T=_[A].name||String(A);this.morphTargetInfluences.push(0),this.morphTargetDictionary[T]=A}}}}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(r,i){super(r,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const r=this.geometry;if(r.index===null){const i=r.attributes.position,m=[];for(let _=0,A=i.count;_<A;_+=2)_start.fromBufferAttribute(i,_),_end.fromBufferAttribute(i,_+1),m[_]=_===0?0:m[_-1],m[_+1]=m[_]+_start.distanceTo(_end);r.setAttribute("lineDistance",new Float32BufferAttribute(m,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(r,i){super(r,i),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(r){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.size=r.size,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}}const _inverseMatrix=new Matrix4,_ray$4=new Ray,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(r=new BufferGeometry$1,i=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=r,this.material=i,this.updateMorphTargets()}copy(r,i){return super.copy(r,i),this.material=Array.isArray(r.material)?r.material.slice():r.material,this.geometry=r.geometry,this}raycast(r,i){const m=this.geometry,_=this.matrixWorld,A=r.params.Points.threshold,w=m.drawRange;if(m.boundingSphere===null&&m.computeBoundingSphere(),_sphere.copy(m.boundingSphere),_sphere.applyMatrix4(_),_sphere.radius+=A,r.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(_).invert(),_ray$4.copy(r.ray).applyMatrix4(_inverseMatrix);const T=A/((this.scale.x+this.scale.y+this.scale.z)/3),R=T*T,D=m.index,k=m.attributes.position;if(D!==null){const X=Math.max(0,w.start),J=Math.min(D.count,w.start+w.count);for(let $=X,oe=J;$<oe;$++){const ne=D.getX($);_position$2.fromBufferAttribute(k,ne),testPoint(_position$2,ne,R,_,r,i,this)}}else{const X=Math.max(0,w.start),J=Math.min(k.count,w.start+w.count);for(let $=X,oe=J;$<oe;$++)_position$2.fromBufferAttribute(k,$),testPoint(_position$2,$,R,_,r,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,m=Object.keys(i);if(m.length>0){const _=i[m[0]];if(_!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let A=0,w=_.length;A<w;A++){const T=_[A].name||String(A);this.morphTargetInfluences.push(0),this.morphTargetDictionary[T]=A}}}}}function testPoint(u,r,i,m,_,A,w){const T=_ray$4.distanceSqToPoint(u);if(T<i){const R=new Vector3;_ray$4.closestPointToPoint(u,R),R.applyMatrix4(m);const D=_.ray.origin.distanceTo(R);if(D<_.near||D>_.far)return;A.push({distance:D,distanceToRay:Math.sqrt(T),point:R,index:r,face:null,object:w})}}class MeshStandardMaterial extends Material{constructor(r){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.defines={STANDARD:""},this.color.copy(r.color),this.roughness=r.roughness,this.metalness=r.metalness,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.roughnessMap=r.roughnessMap,this.metalnessMap=r.metalnessMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapIntensity=r.envMapIntensity,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(r){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(r)}get anisotropy(){return this._anisotropy}set anisotropy(r){this._anisotropy>0!=r>0&&this.version++,this._anisotropy=r}get clearcoat(){return this._clearcoat}set clearcoat(r){this._clearcoat>0!=r>0&&this.version++,this._clearcoat=r}get iridescence(){return this._iridescence}set iridescence(r){this._iridescence>0!=r>0&&this.version++,this._iridescence=r}get sheen(){return this._sheen}set sheen(r){this._sheen>0!=r>0&&this.version++,this._sheen=r}get transmission(){return this._transmission}set transmission(r){this._transmission>0!=r>0&&this.version++,this._transmission=r}copy(r){return super.copy(r),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=r.anisotropy,this.anisotropyRotation=r.anisotropyRotation,this.anisotropyMap=r.anisotropyMap,this.clearcoat=r.clearcoat,this.clearcoatMap=r.clearcoatMap,this.clearcoatRoughness=r.clearcoatRoughness,this.clearcoatRoughnessMap=r.clearcoatRoughnessMap,this.clearcoatNormalMap=r.clearcoatNormalMap,this.clearcoatNormalScale.copy(r.clearcoatNormalScale),this.ior=r.ior,this.iridescence=r.iridescence,this.iridescenceMap=r.iridescenceMap,this.iridescenceIOR=r.iridescenceIOR,this.iridescenceThicknessRange=[...r.iridescenceThicknessRange],this.iridescenceThicknessMap=r.iridescenceThicknessMap,this.sheen=r.sheen,this.sheenColor.copy(r.sheenColor),this.sheenColorMap=r.sheenColorMap,this.sheenRoughness=r.sheenRoughness,this.sheenRoughnessMap=r.sheenRoughnessMap,this.transmission=r.transmission,this.transmissionMap=r.transmissionMap,this.thickness=r.thickness,this.thicknessMap=r.thicknessMap,this.attenuationDistance=r.attenuationDistance,this.attenuationColor.copy(r.attenuationColor),this.specularIntensity=r.specularIntensity,this.specularIntensityMap=r.specularIntensityMap,this.specularColor.copy(r.specularColor),this.specularColorMap=r.specularColorMap,this}}function arraySlice(u,r,i){return isTypedArray(u)?new u.constructor(u.subarray(r,i!==void 0?i:u.length)):u.slice(r,i)}function convertArray(u,r,i){return!u||!i&&u.constructor===r?u:typeof r.BYTES_PER_ELEMENT=="number"?new r(u):Array.prototype.slice.call(u)}function isTypedArray(u){return ArrayBuffer.isView(u)&&!(u instanceof DataView)}function getKeyframeOrder(u){function r(_,A){return u[_]-u[A]}const i=u.length,m=new Array(i);for(let _=0;_!==i;++_)m[_]=_;return m.sort(r),m}function sortedArray(u,r,i){const m=u.length,_=new u.constructor(m);for(let A=0,w=0;w!==m;++A){const T=i[A]*r;for(let R=0;R!==r;++R)_[w++]=u[T+R]}return _}function flattenJSON(u,r,i,m){let _=1,A=u[0];for(;A!==void 0&&A[m]===void 0;)A=u[_++];if(A===void 0)return;let w=A[m];if(w!==void 0)if(Array.isArray(w))do w=A[m],w!==void 0&&(r.push(A.time),i.push.apply(i,w)),A=u[_++];while(A!==void 0);else if(w.toArray!==void 0)do w=A[m],w!==void 0&&(r.push(A.time),w.toArray(i,i.length)),A=u[_++];while(A!==void 0);else do w=A[m],w!==void 0&&(r.push(A.time),i.push(w)),A=u[_++];while(A!==void 0)}class Interpolant{constructor(r,i,m,_){this.parameterPositions=r,this._cachedIndex=0,this.resultBuffer=_!==void 0?_:new i.constructor(m),this.sampleValues=i,this.valueSize=m,this.settings=null,this.DefaultSettings_={}}evaluate(r){const i=this.parameterPositions;let m=this._cachedIndex,_=i[m],A=i[m-1];t:{e:{let w;n:{i:if(!(r<_)){for(let T=m+2;;){if(_===void 0){if(r<A)break i;return m=i.length,this._cachedIndex=m,this.copySampleValue_(m-1)}if(m===T)break;if(A=_,_=i[++m],r<_)break e}w=i.length;break n}if(!(r>=A)){const T=i[1];r<T&&(m=2,A=T);for(let R=m-2;;){if(A===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(m===R)break;if(_=A,A=i[--m-1],r>=A)break e}w=m,m=0;break n}break t}for(;m<w;){const T=m+w>>>1;r<i[T]?w=T:m=T+1}if(_=i[m],A=i[m-1],A===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(_===void 0)return m=i.length,this._cachedIndex=m,this.copySampleValue_(m-1)}this._cachedIndex=m,this.intervalChanged_(m,A,_)}return this.interpolate_(m,A,r,_)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(r){const i=this.resultBuffer,m=this.sampleValues,_=this.valueSize,A=r*_;for(let w=0;w!==_;++w)i[w]=m[A+w];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(r,i,m,_){super(r,i,m,_),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(r,i,m){const _=this.parameterPositions;let A=r-2,w=r+1,T=_[A],R=_[w];if(T===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:A=r,T=2*i-m;break;case WrapAroundEnding:A=_.length-2,T=i+_[A]-_[A+1];break;default:A=r,T=m}if(R===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:w=r,R=2*m-i;break;case WrapAroundEnding:w=1,R=m+_[1]-_[0];break;default:w=r-1,R=i}const D=(m-i)*.5,U=this.valueSize;this._weightPrev=D/(i-T),this._weightNext=D/(R-m),this._offsetPrev=A*U,this._offsetNext=w*U}interpolate_(r,i,m,_){const A=this.resultBuffer,w=this.sampleValues,T=this.valueSize,R=r*T,D=R-T,U=this._offsetPrev,k=this._offsetNext,X=this._weightPrev,J=this._weightNext,$=(m-i)/(_-i),oe=$*$,ne=oe*$,H=-X*ne+2*X*oe-X*$,V=(1+X)*ne+(-1.5-2*X)*oe+(-.5+X)*$+1,z=(-1-J)*ne+(1.5+J)*oe+.5*$,ce=J*ne-J*oe;for(let ue=0;ue!==T;++ue)A[ue]=H*w[U+ue]+V*w[D+ue]+z*w[R+ue]+ce*w[k+ue];return A}}class LinearInterpolant extends Interpolant{constructor(r,i,m,_){super(r,i,m,_)}interpolate_(r,i,m,_){const A=this.resultBuffer,w=this.sampleValues,T=this.valueSize,R=r*T,D=R-T,U=(m-i)/(_-i),k=1-U;for(let X=0;X!==T;++X)A[X]=w[D+X]*k+w[R+X]*U;return A}}class DiscreteInterpolant extends Interpolant{constructor(r,i,m,_){super(r,i,m,_)}interpolate_(r){return this.copySampleValue_(r-1)}}class KeyframeTrack{constructor(r,i,m,_){if(r===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+r);this.name=r,this.times=convertArray(i,this.TimeBufferType),this.values=convertArray(m,this.ValueBufferType),this.setInterpolation(_||this.DefaultInterpolation)}static toJSON(r){const i=r.constructor;let m;if(i.toJSON!==this.toJSON)m=i.toJSON(r);else{m={name:r.name,times:convertArray(r.times,Array),values:convertArray(r.values,Array)};const _=r.getInterpolation();_!==r.DefaultInterpolation&&(m.interpolation=_)}return m.type=r.ValueTypeName,m}InterpolantFactoryMethodDiscrete(r){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodLinear(r){return new LinearInterpolant(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodSmooth(r){return new CubicInterpolant(this.times,this.values,this.getValueSize(),r)}setInterpolation(r){let i;switch(r){case InterpolateDiscrete:i=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:i=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const m="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(r!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(m);return console.warn("THREE.KeyframeTrack:",m),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(r){if(r!==0){const i=this.times;for(let m=0,_=i.length;m!==_;++m)i[m]+=r}return this}scale(r){if(r!==1){const i=this.times;for(let m=0,_=i.length;m!==_;++m)i[m]*=r}return this}trim(r,i){const m=this.times,_=m.length;let A=0,w=_-1;for(;A!==_&&m[A]<r;)++A;for(;w!==-1&&m[w]>i;)--w;if(++w,A!==0||w!==_){A>=w&&(w=Math.max(w,1),A=w-1);const T=this.getValueSize();this.times=arraySlice(m,A,w),this.values=arraySlice(this.values,A*T,w*T)}return this}validate(){let r=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1);const m=this.times,_=this.values,A=m.length;A===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1);let w=null;for(let T=0;T!==A;T++){const R=m[T];if(typeof R=="number"&&isNaN(R)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,T,R),r=!1;break}if(w!==null&&w>R){console.error("THREE.KeyframeTrack: Out of order keys.",this,T,R,w),r=!1;break}w=R}if(_!==void 0&&isTypedArray(_))for(let T=0,R=_.length;T!==R;++T){const D=_[T];if(isNaN(D)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,T,D),r=!1;break}}return r}optimize(){const r=arraySlice(this.times),i=arraySlice(this.values),m=this.getValueSize(),_=this.getInterpolation()===InterpolateSmooth,A=r.length-1;let w=1;for(let T=1;T<A;++T){let R=!1;const D=r[T],U=r[T+1];if(D!==U&&(T!==1||D!==r[0]))if(_)R=!0;else{const k=T*m,X=k-m,J=k+m;for(let $=0;$!==m;++$){const oe=i[k+$];if(oe!==i[X+$]||oe!==i[J+$]){R=!0;break}}}if(R){if(T!==w){r[w]=r[T];const k=T*m,X=w*m;for(let J=0;J!==m;++J)i[X+J]=i[k+J]}++w}}if(A>0){r[w]=r[A];for(let T=A*m,R=w*m,D=0;D!==m;++D)i[R+D]=i[T+D];++w}return w!==r.length?(this.times=arraySlice(r,0,w),this.values=arraySlice(i,0,w*m)):(this.times=r,this.values=i),this}clone(){const r=arraySlice(this.times,0),i=arraySlice(this.values,0),m=this.constructor,_=new m(this.name,r,i);return _.createInterpolant=this.createInterpolant,_}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(r,i,m,_){super(r,i,m,_)}interpolate_(r,i,m,_){const A=this.resultBuffer,w=this.sampleValues,T=this.valueSize,R=(m-i)/(_-i);let D=r*T;for(let U=D+T;D!==U;D+=4)Quaternion.slerpFlat(A,0,w,D-T,w,D,R);return A}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(r){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),r)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(r,i=-1,m,_=NormalAnimationBlendMode){this.name=r,this.tracks=m,this.duration=i,this.blendMode=_,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(r){const i=[],m=r.tracks,_=1/(r.fps||1);for(let w=0,T=m.length;w!==T;++w)i.push(parseKeyframeTrack(m[w]).scale(_));const A=new this(r.name,r.duration,i,r.blendMode);return A.uuid=r.uuid,A}static toJSON(r){const i=[],m=r.tracks,_={name:r.name,duration:r.duration,tracks:i,uuid:r.uuid,blendMode:r.blendMode};for(let A=0,w=m.length;A!==w;++A)i.push(KeyframeTrack.toJSON(m[A]));return _}static CreateFromMorphTargetSequence(r,i,m,_){const A=i.length,w=[];for(let T=0;T<A;T++){let R=[],D=[];R.push((T+A-1)%A,T,(T+1)%A),D.push(0,1,0);const U=getKeyframeOrder(R);R=sortedArray(R,1,U),D=sortedArray(D,1,U),!_&&R[0]===0&&(R.push(A),D.push(D[0])),w.push(new NumberKeyframeTrack(".morphTargetInfluences["+i[T].name+"]",R,D).scale(1/m))}return new this(r,-1,w)}static findByName(r,i){let m=r;if(!Array.isArray(r)){const _=r;m=_.geometry&&_.geometry.animations||_.animations}for(let _=0;_<m.length;_++)if(m[_].name===i)return m[_];return null}static CreateClipsFromMorphTargetSequences(r,i,m){const _={},A=/^([\w-]*?)([\d]+)$/;for(let T=0,R=r.length;T<R;T++){const D=r[T],U=D.name.match(A);if(U&&U.length>1){const k=U[1];let X=_[k];X||(_[k]=X=[]),X.push(D)}}const w=[];for(const T in _)w.push(this.CreateFromMorphTargetSequence(T,_[T],i,m));return w}static parseAnimation(r,i){if(!r)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const m=function(k,X,J,$,oe){if(J.length!==0){const ne=[],H=[];flattenJSON(J,ne,H,$),ne.length!==0&&oe.push(new k(X,ne,H))}},_=[],A=r.name||"default",w=r.fps||30,T=r.blendMode;let R=r.length||-1;const D=r.hierarchy||[];for(let k=0;k<D.length;k++){const X=D[k].keys;if(!(!X||X.length===0))if(X[0].morphTargets){const J={};let $;for($=0;$<X.length;$++)if(X[$].morphTargets)for(let oe=0;oe<X[$].morphTargets.length;oe++)J[X[$].morphTargets[oe]]=-1;for(const oe in J){const ne=[],H=[];for(let V=0;V!==X[$].morphTargets.length;++V){const z=X[$];ne.push(z.time),H.push(z.morphTarget===oe?1:0)}_.push(new NumberKeyframeTrack(".morphTargetInfluence["+oe+"]",ne,H))}R=J.length*w}else{const J=".bones["+i[k].name+"]";m(VectorKeyframeTrack,J+".position",X,"pos",_),m(QuaternionKeyframeTrack,J+".quaternion",X,"rot",_),m(VectorKeyframeTrack,J+".scale",X,"scl",_)}}return _.length===0?null:new this(A,R,_,T)}resetDuration(){const r=this.tracks;let i=0;for(let m=0,_=r.length;m!==_;++m){const A=this.tracks[m];i=Math.max(i,A.times[A.times.length-1])}return this.duration=i,this}trim(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].trim(0,this.duration);return this}validate(){let r=!0;for(let i=0;i<this.tracks.length;i++)r=r&&this.tracks[i].validate();return r}optimize(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].optimize();return this}clone(){const r=[];for(let i=0;i<this.tracks.length;i++)r.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,r,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(u){switch(u.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+u)}function parseKeyframeTrack(u){if(u.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const r=getTrackTypeForValueTypeName(u.type);if(u.times===void 0){const i=[],m=[];flattenJSON(u.keys,i,m,"value"),u.times=i,u.values=m}return r.parse!==void 0?r.parse(u):new r(u.name,u.times,u.values,u.interpolation)}const Cache$1={enabled:!1,files:{},add:function(u,r){this.enabled!==!1&&(this.files[u]=r)},get:function(u){if(this.enabled!==!1)return this.files[u]},remove:function(u){delete this.files[u]},clear:function(){this.files={}}};class LoadingManager{constructor(r,i,m){const _=this;let A=!1,w=0,T=0,R;const D=[];this.onStart=void 0,this.onLoad=r,this.onProgress=i,this.onError=m,this.itemStart=function(U){T++,A===!1&&_.onStart!==void 0&&_.onStart(U,w,T),A=!0},this.itemEnd=function(U){w++,_.onProgress!==void 0&&_.onProgress(U,w,T),w===T&&(A=!1,_.onLoad!==void 0&&_.onLoad())},this.itemError=function(U){_.onError!==void 0&&_.onError(U)},this.resolveURL=function(U){return R?R(U):U},this.setURLModifier=function(U){return R=U,this},this.addHandler=function(U,k){return D.push(U,k),this},this.removeHandler=function(U){const k=D.indexOf(U);return k!==-1&&D.splice(k,2),this},this.getHandler=function(U){for(let k=0,X=D.length;k<X;k+=2){const J=D[k],$=D[k+1];if(J.global&&(J.lastIndex=0),J.test(U))return $}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(r){this.manager=r!==void 0?r:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,i){const m=this;return new Promise(function(_,A){m.load(r,_,i,A)})}parse(){}setCrossOrigin(r){return this.crossOrigin=r,this}setWithCredentials(r){return this.withCredentials=r,this}setPath(r){return this.path=r,this}setResourcePath(r){return this.resourcePath=r,this}setRequestHeader(r){return this.requestHeader=r,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(r,i){super(r),this.response=i}}class FileLoader extends Loader{constructor(r){super(r)}load(r,i,m,_){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const A=Cache$1.get(r);if(A!==void 0)return this.manager.itemStart(r),setTimeout(()=>{i&&i(A),this.manager.itemEnd(r)},0),A;if(loading[r]!==void 0){loading[r].push({onLoad:i,onProgress:m,onError:_});return}loading[r]=[],loading[r].push({onLoad:i,onProgress:m,onError:_});const w=new Request(r,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),T=this.mimeType,R=this.responseType;fetch(w).then(D=>{if(D.status===200||D.status===0){if(D.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||D.body===void 0||D.body.getReader===void 0)return D;const U=loading[r],k=D.body.getReader(),X=D.headers.get("Content-Length")||D.headers.get("X-File-Size"),J=X?parseInt(X):0,$=J!==0;let oe=0;const ne=new ReadableStream({start(H){V();function V(){k.read().then(({done:z,value:ce})=>{if(z)H.close();else{oe+=ce.byteLength;const ue=new ProgressEvent("progress",{lengthComputable:$,loaded:oe,total:J});for(let he=0,K=U.length;he<K;he++){const Y=U[he];Y.onProgress&&Y.onProgress(ue)}H.enqueue(ce),V()}})}}});return new Response(ne)}else throw new HttpError(`fetch for "${D.url}" responded with ${D.status}: ${D.statusText}`,D)}).then(D=>{switch(R){case"arraybuffer":return D.arrayBuffer();case"blob":return D.blob();case"document":return D.text().then(U=>new DOMParser().parseFromString(U,T));case"json":return D.json();default:if(T===void 0)return D.text();{const k=/charset="?([^;"\s]*)"?/i.exec(T),X=k&&k[1]?k[1].toLowerCase():void 0,J=new TextDecoder(X);return D.arrayBuffer().then($=>J.decode($))}}}).then(D=>{Cache$1.add(r,D);const U=loading[r];delete loading[r];for(let k=0,X=U.length;k<X;k++){const J=U[k];J.onLoad&&J.onLoad(D)}}).catch(D=>{const U=loading[r];if(U===void 0)throw this.manager.itemError(r),D;delete loading[r];for(let k=0,X=U.length;k<X;k++){const J=U[k];J.onError&&J.onError(D)}this.manager.itemError(r)}).finally(()=>{this.manager.itemEnd(r)}),this.manager.itemStart(r)}setResponseType(r){return this.responseType=r,this}setMimeType(r){return this.mimeType=r,this}}class ImageLoader extends Loader{constructor(r){super(r)}load(r,i,m,_){this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const A=this,w=Cache$1.get(r);if(w!==void 0)return A.manager.itemStart(r),setTimeout(function(){i&&i(w),A.manager.itemEnd(r)},0),w;const T=createElementNS("img");function R(){U(),Cache$1.add(r,this),i&&i(this),A.manager.itemEnd(r)}function D(k){U(),_&&_(k),A.manager.itemError(r),A.manager.itemEnd(r)}function U(){T.removeEventListener("load",R,!1),T.removeEventListener("error",D,!1)}return T.addEventListener("load",R,!1),T.addEventListener("error",D,!1),r.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(T.crossOrigin=this.crossOrigin),A.manager.itemStart(r),T.src=r,T}}class DataTextureLoader extends Loader{constructor(r){super(r)}load(r,i,m,_){const A=this,w=new DataTexture,T=new FileLoader(this.manager);return T.setResponseType("arraybuffer"),T.setRequestHeader(this.requestHeader),T.setPath(this.path),T.setWithCredentials(A.withCredentials),T.load(r,function(R){let D;try{D=A.parse(R)}catch(U){if(_!==void 0)_(U);else{console.error(U);return}}D.image!==void 0?w.image=D.image:D.data!==void 0&&(w.image.width=D.width,w.image.height=D.height,w.image.data=D.data),w.wrapS=D.wrapS!==void 0?D.wrapS:ClampToEdgeWrapping,w.wrapT=D.wrapT!==void 0?D.wrapT:ClampToEdgeWrapping,w.magFilter=D.magFilter!==void 0?D.magFilter:LinearFilter,w.minFilter=D.minFilter!==void 0?D.minFilter:LinearFilter,w.anisotropy=D.anisotropy!==void 0?D.anisotropy:1,D.colorSpace!==void 0?w.colorSpace=D.colorSpace:D.encoding!==void 0&&(w.encoding=D.encoding),D.flipY!==void 0&&(w.flipY=D.flipY),D.format!==void 0&&(w.format=D.format),D.type!==void 0&&(w.type=D.type),D.mipmaps!==void 0&&(w.mipmaps=D.mipmaps,w.minFilter=LinearMipmapLinearFilter),D.mipmapCount===1&&(w.minFilter=LinearFilter),D.generateMipmaps!==void 0&&(w.generateMipmaps=D.generateMipmaps),w.needsUpdate=!0,i&&i(w,D)},m,_),w}}class TextureLoader extends Loader{constructor(r){super(r)}load(r,i,m,_){const A=new Texture,w=new ImageLoader(this.manager);return w.setCrossOrigin(this.crossOrigin),w.setPath(this.path),w.load(r,function(T){A.image=T,A.needsUpdate=!0,i!==void 0&&i(A)},m,_),A}}class Light extends Object3D{constructor(r,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(r),this.intensity=i}dispose(){}copy(r,i){return super.copy(r,i),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const i=super.toJSON(r);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(r){this.camera=r,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const i=this.camera,m=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(r.matrixWorld),i.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(r.target.matrixWorld),i.lookAt(_lookTarget$1),i.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),m.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),m.multiply(_projScreenMatrix$1)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.bias=r.bias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(r){const i=this.camera,m=RAD2DEG*2*r.angle*this.focus,_=this.mapSize.width/this.mapSize.height,A=r.distance||i.far;(m!==i.fov||_!==i.aspect||A!==i.far)&&(i.fov=m,i.aspect=_,i.far=A,i.updateProjectionMatrix()),super.updateMatrices(r)}copy(r){return super.copy(r),this.focus=r.focus,this}}class SpotLight extends Light{constructor(r,i,m=0,_=Math.PI/3,A=0,w=2){super(r,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=m,this.angle=_,this.penumbra=A,this.decay=w,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(r){this.intensity=r/Math.PI}dispose(){this.shadow.dispose()}copy(r,i){return super.copy(r,i),this.distance=r.distance,this.angle=r.angle,this.penumbra=r.penumbra,this.decay=r.decay,this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(r,i=0){const m=this.camera,_=this.matrix,A=r.distance||m.far;A!==m.far&&(m.far=A,m.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(r.matrixWorld),m.position.copy(_lightPositionWorld),_lookTarget.copy(m.position),_lookTarget.add(this._cubeDirections[i]),m.up.copy(this._cubeUps[i]),m.lookAt(_lookTarget),m.updateMatrixWorld(),_.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(m.projectionMatrix,m.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(r,i,m=0,_=2){super(r,i),this.isPointLight=!0,this.type="PointLight",this.distance=m,this.decay=_,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(r){this.intensity=r/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(r,i){return super.copy(r,i),this.distance=r.distance,this.decay=r.decay,this.shadow=r.shadow.clone(),this}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(r,i){super(r,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}class LoaderUtils{static decodeText(r){if(typeof TextDecoder<"u")return new TextDecoder().decode(r);let i="";for(let m=0,_=r.length;m<_;m++)i+=String.fromCharCode(r[m]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(r){const i=r.lastIndexOf("/");return i===-1?"./":r.slice(0,i+1)}static resolveURL(r,i){return typeof r!="string"||r===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(r)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(r)||/^data:.*,.*$/i.test(r)||/^blob:.*$/i.test(r)?r:i+r)}}class ImageBitmapLoader extends Loader{constructor(r){super(r),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(r){return this.options=r,this}load(r,i,m,_){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const A=this,w=Cache$1.get(r);if(w!==void 0)return A.manager.itemStart(r),setTimeout(function(){i&&i(w),A.manager.itemEnd(r)},0),w;const T={};T.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",T.headers=this.requestHeader,fetch(r,T).then(function(R){return R.blob()}).then(function(R){return createImageBitmap(R,Object.assign(A.options,{colorSpaceConversion:"none"}))}).then(function(R){Cache$1.add(r,R),i&&i(R),A.manager.itemEnd(r)}).catch(function(R){_&&_(R),A.manager.itemError(r),A.manager.itemEnd(r)}),A.manager.itemStart(r)}}class Clock{constructor(r=!0){this.autoStart=r,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=now();r=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=r}return r}}function now(){return(typeof performance>"u"?Date:performance).now()}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(r,i,m){const _=m||PropertyBinding.parseTrackName(i);this._targetGroup=r,this._bindings=r.subscribe_(i,_)}getValue(r,i){this.bind();const m=this._targetGroup.nCachedObjects_,_=this._bindings[m];_!==void 0&&_.getValue(r,i)}setValue(r,i){const m=this._bindings;for(let _=this._targetGroup.nCachedObjects_,A=m.length;_!==A;++_)m[_].setValue(r,i)}bind(){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,m=r.length;i!==m;++i)r[i].bind()}unbind(){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,m=r.length;i!==m;++i)r[i].unbind()}}class PropertyBinding{constructor(r,i,m){this.path=i,this.parsedPath=m||PropertyBinding.parseTrackName(i),this.node=PropertyBinding.findNode(r,this.parsedPath.nodeName),this.rootNode=r,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(r,i,m){return r&&r.isAnimationObjectGroup?new PropertyBinding.Composite(r,i,m):new PropertyBinding(r,i,m)}static sanitizeNodeName(r){return r.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(r){const i=_trackRe.exec(r);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+r);const m={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},_=m.nodeName&&m.nodeName.lastIndexOf(".");if(_!==void 0&&_!==-1){const A=m.nodeName.substring(_+1);_supportedObjectNames.indexOf(A)!==-1&&(m.nodeName=m.nodeName.substring(0,_),m.objectName=A)}if(m.propertyName===null||m.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+r);return m}static findNode(r,i){if(i===void 0||i===""||i==="."||i===-1||i===r.name||i===r.uuid)return r;if(r.skeleton){const m=r.skeleton.getBoneByName(i);if(m!==void 0)return m}if(r.children){const m=function(A){for(let w=0;w<A.length;w++){const T=A[w];if(T.name===i||T.uuid===i)return T;const R=m(T.children);if(R)return R}return null},_=m(r.children);if(_)return _}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(r,i){r[i]=this.targetObject[this.propertyName]}_getValue_array(r,i){const m=this.resolvedProperty;for(let _=0,A=m.length;_!==A;++_)r[i++]=m[_]}_getValue_arrayElement(r,i){r[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(r,i){this.resolvedProperty.toArray(r,i)}_setValue_direct(r,i){this.targetObject[this.propertyName]=r[i]}_setValue_direct_setNeedsUpdate(r,i){this.targetObject[this.propertyName]=r[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(r,i){this.targetObject[this.propertyName]=r[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(r,i){const m=this.resolvedProperty;for(let _=0,A=m.length;_!==A;++_)m[_]=r[i++]}_setValue_array_setNeedsUpdate(r,i){const m=this.resolvedProperty;for(let _=0,A=m.length;_!==A;++_)m[_]=r[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(r,i){const m=this.resolvedProperty;for(let _=0,A=m.length;_!==A;++_)m[_]=r[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(r,i){this.resolvedProperty[this.propertyIndex]=r[i]}_setValue_arrayElement_setNeedsUpdate(r,i){this.resolvedProperty[this.propertyIndex]=r[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(r,i){this.resolvedProperty[this.propertyIndex]=r[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(r,i){this.resolvedProperty.fromArray(r,i)}_setValue_fromArray_setNeedsUpdate(r,i){this.resolvedProperty.fromArray(r,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(r,i){this.resolvedProperty.fromArray(r,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(r,i){this.bind(),this.getValue(r,i)}_setValue_unbound(r,i){this.bind(),this.setValue(r,i)}bind(){let r=this.node;const i=this.parsedPath,m=i.objectName,_=i.propertyName;let A=i.propertyIndex;if(r||(r=PropertyBinding.findNode(this.rootNode,i.nodeName),this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!r){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(m){let D=i.objectIndex;switch(m){case"materials":if(!r.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!r.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}r=r.material.materials;break;case"bones":if(!r.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}r=r.skeleton.bones;for(let U=0;U<r.length;U++)if(r[U].name===D){D=U;break}break;case"map":if("map"in r){r=r.map;break}if(!r.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!r.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}r=r.material.map;break;default:if(r[m]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}r=r[m]}if(D!==void 0){if(r[D]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);return}r=r[D]}}const w=r[_];if(w===void 0){const D=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+D+"."+_+" but it wasn't found.",r);return}let T=this.Versioning.None;this.targetObject=r,r.needsUpdate!==void 0?T=this.Versioning.NeedsUpdate:r.matrixWorldNeedsUpdate!==void 0&&(T=this.Versioning.MatrixWorldNeedsUpdate);let R=this.BindingType.Direct;if(A!==void 0){if(_==="morphTargetInfluences"){if(!r.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!r.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}r.morphTargetDictionary[A]!==void 0&&(A=r.morphTargetDictionary[A])}R=this.BindingType.ArrayElement,this.resolvedProperty=w,this.propertyIndex=A}else w.fromArray!==void 0&&w.toArray!==void 0?(R=this.BindingType.HasFromToArray,this.resolvedProperty=w):Array.isArray(w)?(R=this.BindingType.EntireArray,this.resolvedProperty=w):this.propertyName=_;this.getValue=this.GetterByBindingType[R],this.setValue=this.SetterByBindingTypeAndVersioning[R][T]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Spherical{constructor(r=1,i=0,m=0){return this.radius=r,this.phi=i,this.theta=m,this}set(r,i,m){return this.radius=r,this.phi=i,this.theta=m,this}copy(r){return this.radius=r.radius,this.phi=r.phi,this.theta=r.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,i,m){return this.radius=Math.sqrt(r*r+i*i+m*m),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(r,m),this.phi=Math.acos(clamp(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);class Slider{constructor(){this.bindAll(),this.vert=`
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
      `,this.frag=`
      varying vec2 vUv;
  
      uniform sampler2D texture1;
      uniform sampler2D texture2;
      uniform sampler2D disp;
  
      uniform float dispPower;
      uniform float intensity;
  
      uniform vec2 size;
      uniform vec2 res;
  
      vec2 backgroundCoverUv( vec2 screenSize, vec2 imageSize, vec2 uv ) {
        float screenRatio = screenSize.x / screenSize.y;
        float imageRatio = imageSize.x / imageSize.y;
        vec2 newSize = screenRatio < imageRatio 
            ? vec2(imageSize.x * (screenSize.y / imageSize.y), screenSize.y)
            : vec2(screenSize.x, imageSize.y * (screenSize.x / imageSize.x));
        vec2 newOffset = (screenRatio < imageRatio 
            ? vec2((newSize.x - screenSize.x) / 2.0, 0.0) 
            : vec2(0.0, (newSize.y - screenSize.y) / 2.0)) / newSize;
        return uv * screenSize / newSize + newOffset;
      }
  
      void main() {
        vec2 uv = vUv;
        
        vec4 disp = texture2D(disp, uv);
        vec2 dispVec = vec2(disp.x, disp.y);
        
        vec2 distPos1 = uv + (dispVec * intensity * dispPower);
        vec2 distPos2 = uv + (dispVec * -(intensity * (1.0 - dispPower)));
        
        vec4 _texture1 = texture2D(texture1, distPos1);
        vec4 _texture2 = texture2D(texture2, distPos2);
        
        gl_FragColor = mix(_texture1, _texture2, dispPower);
      }
      `,this.el=document.querySelector(".js-slider"),this.inner=this.el.querySelector(".js-slider__inner"),this.slides=[...this.el.querySelectorAll(".js-slide")],this.bullets=[...this.el.querySelectorAll(".js-slider-bullet")],this.renderer=null,this.scene=null,this.clock=null,this.camera=null,this.images=["./images/bg1.jpg","./images/bg2.jpg","./images/bg3.jpg","./images/bg4.jpg"],this.data={current:0,next:1,total:this.images.length-1,delta:0},this.state={animating:!1,text:!1,initial:!0},this.textures=null,this.init()}bindAll(){["render","nextSlide"].forEach(r=>this[r]=this[r].bind(this))}setStyles(){this.slides.forEach((r,i)=>{i!==0&&TweenMax.set(r,{autoAlpha:0})}),this.bullets.forEach((r,i)=>{if(i===0)return;const m=r.querySelector(".js-slider-bullet__text"),_=r.querySelector(".js-slider-bullet__line");TweenMax.set(m,{alpha:.25}),TweenMax.set(_,{scaleX:0,transformOrigin:"left"})})}cameraSetup(){this.camera=new OrthographicCamera(this.el.offsetWidth/-2,this.el.offsetWidth/2,this.el.offsetHeight/2,this.el.offsetHeight/-2,1,1e3),this.camera.lookAt(this.scene.position),this.camera.position.z=1}setup(){this.scene=new Scene,this.clock=new Clock(!0),this.renderer=new WebGLRenderer({alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.el.offsetWidth,this.el.offsetHeight),this.inner.appendChild(this.renderer.domElement)}loadTextures(){const r=new TextureLoader;r.crossOrigin="",this.textures=[],this.images.forEach((i,m)=>{const _=r.load(i+"?v="+Date.now(),this.render);_.minFilter=LinearFilter,_.generateMipmaps=!1,m===0&&this.mat&&(this.mat.uniforms.size.value=[_.image.naturalWidth,_.image.naturalHeight]),this.textures.push(_)}),this.disp=r.load("./images/disp_reference.png",this.render),this.disp.magFilter=this.disp.minFilter=LinearFilter,this.disp.wrapS=this.disp.wrapT=RepeatWrapping}createMesh(){this.mat=new ShaderMaterial({uniforms:{dispPower:{type:"f",value:0},intensity:{type:"f",value:.5},res:{value:new Vector2(window.innerWidth,window.innerHeight)},size:{value:new Vector2(1,1)},texture1:{type:"t",value:this.textures[0]},texture2:{type:"t",value:this.textures[1]},disp:{type:"t",value:this.disp}},transparent:!0,vertexShader:this.vert,fragmentShader:this.frag});const r=new PlaneGeometry(this.el.offsetWidth,this.el.offsetHeight,1),i=new Mesh(r,this.mat);this.scene.add(i)}transitionNext(){TweenMax.to(this.mat.uniforms.dispPower,2,{value:1,ease:Expo.easeInOut,onUpdate:this.render,onComplete:()=>{this.mat.uniforms.dispPower.value=0,this.changeTexture(),this.render.bind(this),this.state.animating=!1}})}prevSlide(){}nextSlide(){this.state.animating||(this.state.animating=!0,this.transitionNext(),this.data.current=this.data.current===this.data.total?0:this.data.current+1,this.data.next=this.data.current===this.data.total?0:this.data.current+1,window.clearInterval(this.autoTimer),this.timer())}previousSlide(){this.state.animating||(this.state.animating=!0,this.data.current=this.data.current===0?this.data.total:this.data.current-1,this.data.next=this.data.current===0?this.data.total:this.data.current-1,this.transitionNext())}changeTexture(){this.mat.uniforms.texture1.value=this.textures[this.data.current],this.mat.uniforms.texture2.value=this.textures[this.data.next]}listeners(){}timer(){this.autoTimer=window.setInterval(this.nextSlide,5e3)}render(){this.renderer.render(this.scene,this.camera)}init(){this.setup(),this.cameraSetup(),this.loadTextures(),this.createMesh(),this.setStyles(),this.render(),this.timer()}}const categories=[{id:"1",name:"Wedding Rings",imgSrc:"weddingrings.png"},{id:"2",name:"Gold Coins",imgSrc:"goldcoin.png"},{id:"3",name:"Pendants",imgSrc:"pendants.png"},{id:"4",name:"Earrings",imgSrc:"earrings.png"},{id:"5",name:"Neckwear",imgSrc:"neckwear.png"},{id:"6",name:"Nose Pins",imgSrc:"nosepins.png"},{id:"7",name:"Chains",imgSrc:"chains.png"},{id:"8",name:"Bangles",imgSrc:"bangles.png"},{id:"9",name:"Bracelets",imgSrc:"bracelets.png"},{id:"10",name:"Mangalsutras",imgSrc:"mangalsutras.png"}],collection=[{id:"1",name:"Dor",imgSrc:"dor.png"},{id:"2",name:"Exclusive Coins",imgSrc:"exclusivecoins.png"},{id:"3",name:"Stunnning Every Ear",imgSrc:"stunningear.png"}],weddrings=[{id:"1",name:"Fancy Glossy Gold and Diamond Rings",price:32880,gender:"Women",category:"Finger Ring",imgSrc:"ring1.png"},{id:"2",name:"Elegant Classy Diamond Rings",price:30323,gender:"Women",category:"Finger Ring",imgSrc:"ring2.png"},{id:"3",name:"Bliss of Innocence Ring",price:38108,gender:"Women",category:"Finger Ring",imgSrc:"ring3.png"},{id:"4",name:"Vintage Elegance Ring",price:40839,gender:"Women",category:"Finger Ring",imgSrc:"ring4.png"},{id:"5",name:"A Delicate Touch Diamond Ring",price:24584,gender:"Women",category:"Finger Ring",imgSrc:"ring5.png"},{id:"6",name:"Simple Joys Diamond Ring",price:23220,gender:"Women",category:"Finger Ring",imgSrc:"ring6.png"},{id:"7",name:"Stylish Geometric Gold Mesh Ring",price:40216,gender:"Men",category:"Finger Ring",imgSrc:"ring7.png"},{id:"8",name:"Magnificent Flower Diamond Ring",price:51293,gender:"Women",category:"Finger Ring",imgSrc:"ring8.png"}];let app$1;const initMainApp=function(){return app$1=createApp({props:[]},{properties:[]}),app$1.component("headercmp",{props:[],data(){return{}},created(){},mounted(){},methods:{},template:`
        <div class="headerPanel" :style="{'opacity': showPropertyMode ? '0.5':'1'}">
            <figure class="logo" onclick="location.href='#'">
                <img src="./images/tanishqlogo.svg">
            </figure>
            <div class="searchbox"><span class="searchplaceholder">Search for Gold Jewellery, Diamond Jewellery and more...</span></div>
            <nav id="navright" class="nav">
                <ul class="slider-ul">
                    <li class="slider-li">
                    <a class="sliderA is-active" href="/Jewellery/index.html"><span class="navSpan">Home</span></a>
                    </li>
                    <li class="slider-li">
                            <a class="sliderA" href="#"><span class="navSpan">Collection</span></a>
                    </li>
                    <li class="slider-li">
                            <a class="sliderA" href="#"><span class="navSpan">About</span></a>
                    </li>
                    <li class="slider-li">
                    <a class="sliderA" href="#">
                        <span>Account</span>
                    </a>
                    </li>
                    <li class="slider-li">
                    <a class="sliderA" href="#">
                        <span>Cart</span>
                        <div class="cart-total">0</div>
                    </a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="menuNavBar">
            <nav class="nav">
                <ul class="slider-ul">
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span class="navSpan">All jewellery</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span class="navSpan">Gold</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span class="navSpan">Diamond</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>Earrings</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>Rings</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>Wedding Rings</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>Rivaah</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>MIA</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>More</span></a>
                    </li>
                </ul>
            </nav>
        </div>
    `}),app$1.component("footercmp",{props:[],data(){return{}},created(){},mounted(){},methods:{},template:`
        <footer class="footerBlock">
        <div style="display:flex; flex-direction:row;">
        <div style="margin-left:4em;width:20em"><h2 class="footerTitle">Useful Links</h2>
            <ul id="collapsible-links" class="menu-footer content">
            <li><a class="gtm-footer-link" href="#" title="Delivery Information" >Delivery Information</a></li>
            <li><a class="gtm-footer-link" href="#" title="International Shipping" >International Shipping</a></li>
            <li><a class="gtm-footer-link" href="#" title="Payment Options" >Payment Options</a></li>
            <li><a class="gtm-footer-link" href="#" title="Track your Order" >Track your Order</a></li>
            <li><a class="gtm-footer-link" href="#" title="Returns" >Returns</a></li>
            <li><a class="gtm-footer-link" href="#" title="Find a Store" >Find a Store</a></li>
            </ul>
        </div>
        <div style="margin-left:4em;width:20em"><h2 class="footerTitle">Information</h2>
            <ul id="collapsible-links" class="menu-footer content">
            <li><a class="gtm-footer-link" href="#" title="Delivery Information" >Careers</a></li>
            <li><a class="gtm-footer-link" href="#" title="International Shipping" >Blog</a></li>
            <li><a class="gtm-footer-link" href="#" title="Payment Options" >Offers & Contest Details</a></li>
            <li><a class="gtm-footer-link" href="#" title="Track your Order" >Help & FAQs</a></li>
            <li><a class="gtm-footer-link" href="#" title="Returns" >About Tanishq</a></li>
            </ul>
        </div>
        <div style="margin-left:4em;width:20em"><h2 class="footerTitle">Contact Us</h2>
            <ul id="collapsible-links" class="menu-footer content">
            <li><a class="gtm-footer-link" href="#" title="Delivery Information" >Write to Us</a></li>
            <li><a class="gtm-footer-link" href="#" title="International Shipping" >1800-266-0123</a></li>
            <li><a class="gtm-footer-link" href="#" title="Payment Options" >Chat with Us</a></li>
            </ul>
        </div>
        <div style="margin-left:4em;width:20em"><h2 class="footerTitle">Download</h2>
            <div>
            <a class="gtm-footer-link" href="#">
                <img class="app-download appstore-img" src="./images/appstore.png" alt="appstore">
            </a>
            <a class="gtm-footer-link" href="#">
                <img class="app-download" src="./images/playstore.png" alt="sdf">
            </a>
            </div>
        </div>
        </div>
        <div>
            <p style="margin-left:2em; font-size:large; color:red">**This is a demo website for training purpose only. It has no connection with or have intention to replicate the original Tanishq website.</p>
        </div>
        </footer>
    `}),app$1.component("app",{props:[],data(){return{categories:[],categoryColSize:5,collections:[],collectionColSize:3}},created(){this.categories=categories,this.collections=collection},mounted(){this.slider=new Slider},methods:{nextSlide(){this.slider.nextSlide()},previousSlide(){this.slider.previousSlide()},getCategoryRowNum(){return Math.ceil(this.categories.length/this.categoryColSize)},getCategoryIndex(u,r){return(u-1)*this.categoryColSize+r},isCellAvailable(u,r){return!(this.getCategoryIndex(u,r)>this.categories.length)},getCollectionRowNum(){return Math.ceil(this.collections.length/this.collectionColSize)},getCollectionIndex(u,r){return(u-1)*this.collectionColSize+r},isCollectionCellAvailable(u,r){return!(this.getCollectionIndex(u,r)>this.collections.length)},openCategory(u){location.href="/Jewellery/weddingrings.html"}},template:`
        <headercmp></headercmp>
        <div class="slider js-slider">
            <div class="slider__inner js-slider__inner"></div>
            <div id="sliderControl">
                <div class="sliderControlButton" @click="previousSlide()"><img src="./images/leftarrow.svg" 
                    style="object-contain:contain;height:1.5em;width:1.5em;margin-left: 0.25rem;">
                </div>
                <div class="sliderControlButton" style="right:2em;" @click="nextSlide()"><img src="./images/rightarrow.svg" 
                    style="object-contain:contain;height:1.5em;width:1.5em;margin-left: 0.5em;">
                </div>
            </div>
            <div id="sliderExploreButton">
            </div>
        </div>
        <div class="categoryHeadBlock">
            <div class="categoryHead"><h4>Shop By Category</h4></div>
            <div class="categoryHeadSub"><p>Browse through your favorite categories. We've got them all!</p></div>
            <img src="./images/Line-Design.svg" style="margin-top: -20px;"/>
        </div>
        <div class="categoryBlock">
            <table class="catagoryTable">
                <tr v-for="row in Number(getCategoryRowNum())" style="padding-bottom:1em">
                    <td class="categoryGrid" v-for="col in Number(categoryColSize)">
                        <div class="categoryItemBlock" v-if="isCellAvailable(row,col)" @click="openCategory(categories[getCategoryIndex(row,col)-1])">
                            <div class="categoryImgContainer"><img style="width:100%" :src="'./images/'+ categories[getCategoryIndex(row,col)-1].imgSrc"></div>
                            <div class="categoryTitleContainer">
                                <h4 style="text-align:center">{{categories[getCategoryIndex(row,col)-1].name}}</h4>
                                <span class="exploreButton">Explore <span class="hide">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span> ></span>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="categoryHeadBlock">
            <div class="categoryHead"><h4>Shop By Collections</h4></div>
            <div class="categoryHeadSub"><p>Whatever the occasion, we've got a beautiful piece of jewellery for you.</p></div>
            <img src="./images/Line-Design.svg" style="margin-top: -20px;"/>
        </div>
        <div class="categoryBlock">
        <table class="catagoryTable">
            <tr v-for="row in Number(getCollectionRowNum())" style="padding-bottom:1em">
                <td class="categoryGrid" v-for="col in Number(collectionColSize)">
                    <div class="categoryItemBlock" style="width:95%" v-if="isCollectionCellAvailable(row,col)">
                        <div class="categoryImgContainer"><img style="width:100%" :src="'./images/'+ collections[getCategoryIndex(row,col)-1].imgSrc"></div>
                        <div class="categoryTitleContainer" style="flex-direction: row;justify-content: flex-start; margin-bottom:0">
                            <h3 style="text-align:left;margin-left:1em;width:50%;">{{collections[getCollectionIndex(row,col)-1].name}}</h3>
                            <span class="exploreButton" style="float:right;justify-content: center; align-items: center;display:flex;">
                                Explore &nbsp;<span class="hide">&nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;</span> ></span>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div class="categoryHeadBlock">
        <div class="categoryHead"><h4>Connect With Us</h4></div>
        <div class="categoryHeadSub"><p>We are always available to guide you at your convenience.</p></div>
        <img src="./images/Line-Design.svg" style="margin-top: -20px;"/>
    </div>
    
    <footercmp></footercmp>
        `}),app$1};/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={109:function(u,r,i){var m=i(352),_=i.n(m)()(function(A){return A[1]});_.push([u.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),r.Z=_},44:function(u,r,i){var m=i(352),_=i.n(m)()(function(A){return A[1]});_.push([u.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),r.Z=_},798:function(u,r,i){var m=i(352),_=i.n(m)()(function(A){return A[1]});_.push([u.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),r.Z=_},729:function(u,r,i){var m=i(352),_=i.n(m)()(function(A){return A[1]});_.push([u.id,'.button-bar{background:var(--tp-base-background-color);border:1px solid #8f949c;width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:400;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:#ccc;transition:color .25s}.button-bar-button:hover{color:#eee}.button-bar-selected{color:#fff}.button-bar-selected-box{color:#fff}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:#413762}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:#ccc;transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px}.mode-button{font-weight:400}#webgi-logo{background-image:url("https://webgi.xyz/img/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:2.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.8rem !important;color:#ddd !important}#tweakpaneUiContainer{margin-top:7.5rem}@media only screen and (min-width: 480px){#tweakpaneUiContainer{margin-top:5.5rem}}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{background-color:#d1d4e7}',""]),r.Z=_},898:function(u,r,i){var m=i(352),_=i.n(m)()(function(A){return A[1]});_.push([u.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:#eee;border:none}',""]),r.Z=_},513:function(u,r,i){var m=i(352),_=i.n(m)()(function(A){return A[1]});_.push([u.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),r.Z=_},336:function(u){var r;r=function(){return function(i){var m={};function _(A){if(m[A])return m[A].exports;var w=m[A]={i:A,l:!1,exports:{}};return i[A].call(w.exports,w,w.exports,_),w.l=!0,w.exports}return _.m=i,_.c=m,_.i=function(A){return A},_.d=function(A,w,T){_.o(A,w)||Object.defineProperty(A,w,{configurable:!1,enumerable:!0,get:T})},_.n=function(A){var w=A&&A.__esModule?function(){return A.default}:function(){return A};return _.d(w,"a",w),w},_.o=function(A,w){return Object.prototype.hasOwnProperty.call(A,w)},_.p="",_(_.s=5)}([function(i,m,_){Object.defineProperty(m,"__esModule",{value:!0});var A={convertToObject:function(w){var T=w.substring(w.indexOf("{")+1).trim().slice(0,-1),R={};return T.split(";").map(function(D){if(D=D.trim()){var U=D.split(":");R[U[0].trim()]=U[1].trim()}}),R},getFromSheets:function(w){var T=document.styleSheets;for(var R in T){var D=null;try{D=T[R].rules||T[R].cssRules}catch{}if(D){for(var U in D)if(D[U].selectorText&&D[U].selectorText.split(",").indexOf(w)!=-1)return D[U].cssText?A.convertToObject(D[U].cssText):A.convertToObject(D[U].style.cssText)}}return{}},getPropertyDefault:function(w){return w=="timing-function"?"ease":w=="iteration-count"?1:w=="direction"?"normal":w=="fill-mode"?"none":null}};m.default=A},function(i,m,_){Object.defineProperty(m,"__esModule",{value:!0});var A={generateId:function(){for(var w="",T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",R=0;R<8;++R)w+=T.charAt(Math.floor(Math.random()*T.length));return w},frameToString:function(w){var T="";for(var R in w)T+=R+":"+w[R]+";";return T},convertTimeToMs:function(w){if(!w)return 0;if(typeof w=="number")return w;var T=parseFloat(w);return w.indexOf("ms")!=-1?T:1e3*T},prefixes:["","-webkit-","-moz-","-o-"]};m.default=A},function(i,m,_){Object.defineProperty(m,"__esModule",{value:!0});var A,w=(A=_(0))&&A.__esModule?A:{default:A};m.default=function T(R,D){if(function(X,J){if(!(X instanceof J))throw new TypeError("Cannot call a class as a function")}(this,T),this.styles=typeof R=="string"?w.default.getFromSheets(R):R,typeof D=="string"){var U=w.default.getFromSheets(D);for(var k in this.options={},U)this.options[k.replace("animation-","")]=U[k]}else this.options=typeof D=="number"?{duration:D}:D}},function(i,m,_){Object.defineProperty(m,"__esModule",{value:!0});var A=function(){function k(X,J){for(var $=0;$<J.length;$++){var oe=J[$];oe.enumerable=oe.enumerable||!1,oe.configurable=!0,"value"in oe&&(oe.writable=!0),Object.defineProperty(X,oe.key,oe)}}return function(X,J,$){return J&&k(X.prototype,J),$&&k(X,$),X}}(),w=D(_(4)),T=D(_(1)),R=D(_(0));function D(k){return k&&k.__esModule?k:{default:k}}var U=function(){function k(X,J,$,oe){if(function(V,z){if(!(V instanceof z))throw new TypeError("Cannot call a class as a function")}(this,k),X.constructor===Array?this.doms=X:this.doms=[X],J.constructor===Array?this.frames=J:this.frames=[J],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},$!=null&&$!=null)if(typeof $=="boolean")this.options.instant=$;else if(typeof $=="number")this.options.count=$,typeof oe=="boolean"&&(this.options.instant=oe);else for(var ne in $)ne=="pauseAt"&&$.pauseAt.constructor!==Array?this.options[ne]=[$[ne]]:this.options[ne]=$[ne];for(var H in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=T.default.prefixes:this.prefixes=[""],X)this.countRemainder[H]=this.options.count-1;this.options.instant&&this.play()}return A(k,[{key:"play",value:function(){var X=this;for(var J in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(oe){X.promiseResolve=oe})),this.doms){var $=this.makeAnimation(this.doms[J]);this.animations[J]=$.names,this.styleDoms[J]=$.styleDom,this.superSets[J]=this.makeSuperSet(this.doms[J],this.animations[J]),this.playAnimation(this.doms[J],this.superSets[J]),this.eventHandler[J]=this.handleAnimationEnd.bind(this,J),this.doms[J].addEventListener("animationend",this.eventHandler[J])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(X){if(!X){for(var J in this.doms)this.clear(J);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var $=this.styleDoms[X];for(var oe in $&&$.parentNode&&$.parentNode.removeChild($),this.superSets[X])for(var ne in this.prefixes)this.doms[X].style[this.prefixes[ne]+"animation-"+oe]=null;for(var H in this.prefixes)this.doms[X].style[this.prefixes[H]+"animation-play-state"]=null;this.doms[X].removeEventListener("animationend",this.eventHandler[X]),this.countRemainder[X]=this.options.count-1}},{key:"replay",value:function(X){var J=this.doms[X],$=J.cloneNode(!0);J.parentNode.replaceChild($,J),this.doms[X].removeEventListener("animationend",this.eventHandler[X]),this.doms[X]=$,this.doms[X].addEventListener("animationend",this.eventHandler[X])}},{key:"pause",value:function(){for(var X in this.doms)this.pauseDom(this.doms[X])}},{key:"resume",value:function(){for(var X in this.doms)this.resumeDom(this.doms[X])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(X,J){var $=J.animationName,oe=$.substring($.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(oe))&&this.pauseDom(this.doms[X]),oe==this.frames.length&&(this.countRemainder[X]==-1?this.replay(X):this.countRemainder[X]>0?(this.countRemainder[X]--,this.replay(X)):(this.options.applyOnEnd&&this.applyOnEnd(X),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(X){for(var J in this.prefixes)X.style[this.prefixes[J]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(X){for(var J in this.prefixes)X.style[this.prefixes[J]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(X){var J=this.newFrames[this.frames.length];for(var $ in J)this.doms[X].style[$]=J[$]}},{key:"makeAnimation",value:function(X){var J={},$=[],oe={};for(var ne in this.frames)for(var H in $.push(this.frames[ne].styles),$[ne])oe[H]=!0;var V=window.getComputedStyle(X);for(var z in oe)J[z]=V[z];$.unshift(J);for(var ce=[$[0]],ue=1;ue<$.length;++ue){var he=JSON.parse(JSON.stringify(ce[ue-1]));for(var K in $[ue])he[K]=$[ue][K];ce.push(he)}return this.newFrames=ce,w.default.make(ce,this.prefixes)}},{key:"makeSuperSet",value:function(X,J){var $=0,oe={};for(var ne in this.frames)for(var H in this.frames[ne].options)oe[H]="";oe.name="",oe.duration="",oe.delay="";for(var V=0;V<this.frames.length;++V){if(V)for(var z in oe)oe[z]+=",";var ce=T.default.convertTimeToMs(this.frames[V].options.duration),ue=T.default.convertTimeToMs(this.frames[V].options.delay);for(var he in V<this.options.startFrom&&(ce=0,ue=0),oe.name+=J[V],oe.duration+=ce+"ms",oe.delay+=$+ue+"ms",oe)he!="name"&&he!="duration"&&he!="delay"&&(oe[he]+=this.frames[V].options[he]?this.frames[V].options[he]:R.default.getPropertyDefault(he));var K=this.frames[V].options["iteration-count"];$+=ce*parseInt(K||1)+ue}return oe}},{key:"playAnimation",value:function(X,J){for(var $ in J)for(var oe in this.prefixes)X.style[this.prefixes[oe]+"animation-"+$]=J[$];this.options.pauseAt.includes(0)&&this.pauseDom(X)}}]),k}();m.default=U},function(i,m,_){Object.defineProperty(m,"__esModule",{value:!0});var A,w=(A=_(1))&&A.__esModule?A:{default:A},T={make:function(R,D){for(var U=[],k="",X="atr-"+w.default.generateId(),J=document.createElement("style"),$=0;$<R.length-1;++$)U.push(X+"-"+($+1)),k+=T.makeFromTwoFrames(R[$],R[$+1],U[$],D);return J.innerHTML=k,J.class="foo",document.getElementsByTagName("head")[0].appendChild(J),{names:U,styleDom:J}},makeFromTwoFrames:function(R,D,U,k){var X="";for(var J in k)X+="@"+k[J]+"keyframes "+U+" {",X+="0%",X+="{"+w.default.frameToString(R)+"}",X+="100%",X+="{"+w.default.frameToString(D)+"}",X+="}";return X}};m.default=T},function(i,m,_){Object.defineProperty(m,"__esModule",{value:!0}),m.Queue=m.Frame=void 0;var A=T(_(2)),w=T(_(3));function T(R){return R&&R.__esModule?R:{default:R}}m.Frame=A.default,m.Queue=w.default}])},u.exports=r()},352:function(u){u.exports=function(r){var i=[];return i.toString=function(){return this.map(function(m){var _=r(m);return m[2]?"@media ".concat(m[2]," {").concat(_,"}"):_}).join("")},i.i=function(m,_,A){typeof m=="string"&&(m=[[null,m,""]]);var w={};if(A)for(var T=0;T<this.length;T++){var R=this[T][0];R!=null&&(w[R]=!0)}for(var D=0;D<m.length;D++){var U=[].concat(m[D]);A&&w[U[0]]||(_&&(U[2]?U[2]="".concat(_," and ").concat(U[2]):U[2]=_),i.push(U))}},i}},388:function(u){u.exports=function r(i,m,_){function A(R,D){if(!m[R]){if(!i[R]){if(w)return w(R,!0);throw new Error("Cannot find module '"+R+"'")}var U=m[R]={exports:{}};i[R][0].call(U.exports,function(k){return A(i[R][1][k]||k)},U,U.exports,r,i,m,_)}return m[R].exports}for(var w=void 0,T=0;T<_.length;T++)A(_[T]);return A}({1:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){var J=r("crypto");function $(ue,he){return function(K,Y){var ie;if((ie=Y.algorithm!=="passthrough"?J.createHash(Y.algorithm):new ce).write===void 0&&(ie.write=ie.update,ie.end=ie.update),z(Y,ie).dispatch(K),ie.update||ie.end(""),ie.digest)return ie.digest(Y.encoding==="buffer"?void 0:Y.encoding);var ve=ie.read();return Y.encoding!=="buffer"?ve.toString(Y.encoding):ve}(ue,he=H(ue,he))}(m=i.exports=$).sha1=function(ue){return $(ue)},m.keys=function(ue){return $(ue,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},m.MD5=function(ue){return $(ue,{algorithm:"md5",encoding:"hex"})},m.keysMD5=function(ue){return $(ue,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var oe=J.getHashes?J.getHashes().slice():["sha1","md5"];oe.push("passthrough");var ne=["buffer","hex","binary","base64"];function H(ue,he){he=he||{};var K={};if(K.algorithm=he.algorithm||"sha1",K.encoding=he.encoding||"hex",K.excludeValues=!!he.excludeValues,K.algorithm=K.algorithm.toLowerCase(),K.encoding=K.encoding.toLowerCase(),K.ignoreUnknown=he.ignoreUnknown===!0,K.respectType=he.respectType!==!1,K.respectFunctionNames=he.respectFunctionNames!==!1,K.respectFunctionProperties=he.respectFunctionProperties!==!1,K.unorderedArrays=he.unorderedArrays===!0,K.unorderedSets=he.unorderedSets!==!1,K.unorderedObjects=he.unorderedObjects!==!1,K.replacer=he.replacer||void 0,K.excludeKeys=he.excludeKeys||void 0,ue===void 0)throw new Error("Object argument required.");for(var Y=0;Y<oe.length;++Y)oe[Y].toLowerCase()===K.algorithm.toLowerCase()&&(K.algorithm=oe[Y]);if(oe.indexOf(K.algorithm)===-1)throw new Error('Algorithm "'+K.algorithm+'"  not supported. supported values: '+oe.join(", "));if(ne.indexOf(K.encoding)===-1&&K.algorithm!=="passthrough")throw new Error('Encoding "'+K.encoding+'"  not supported. supported values: '+ne.join(", "));return K}function V(ue){if(typeof ue=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(ue))!=null}function z(ue,he,K){function Y(ie){return he.update?he.update(ie,"utf8"):he.write(ie,"utf8")}return K=K||[],{dispatch:function(ie){return ue.replacer&&(ie=ue.replacer(ie)),this["_"+(ie===null?"null":typeof ie)](ie)},_object:function(ie){var ve,re=Object.prototype.toString.call(ie),ae=/\[object (.*)\]/i.exec(re);if(ae=(ae=ae?ae[1]:"unknown:["+re+"]").toLowerCase(),0<=(ve=K.indexOf(ie)))return this.dispatch("[CIRCULAR:"+ve+"]");if(K.push(ie),w!==void 0&&w.isBuffer&&w.isBuffer(ie))return Y("buffer:"),Y(ie);if(ae==="object"||ae==="function"||ae==="asyncfunction"){var me=Object.keys(ie);ue.unorderedObjects&&(me=me.sort()),ue.respectType===!1||V(ie)||me.splice(0,0,"prototype","__proto__","constructor"),ue.excludeKeys&&(me=me.filter(function(Te){return!ue.excludeKeys(Te)})),Y("object:"+me.length+":");var ye=this;return me.forEach(function(Te){ye.dispatch(Te),Y(":"),ue.excludeValues||ye.dispatch(ie[Te]),Y(",")})}if(!this["_"+ae]){if(ue.ignoreUnknown)return Y("["+ae+"]");throw new Error('Unknown object type "'+ae+'"')}this["_"+ae](ie)},_array:function(ie,ve){ve=ve!==void 0?ve:ue.unorderedArrays!==!1;var re=this;if(Y("array:"+ie.length+":"),!ve||ie.length<=1)return ie.forEach(function(ye){return re.dispatch(ye)});var ae=[],me=ie.map(function(ye){var Te=new ce,ke=K.slice();return z(ue,Te,ke).dispatch(ye),ae=ae.concat(ke.slice(K.length)),Te.read().toString()});return K=K.concat(ae),me.sort(),this._array(me,!1)},_date:function(ie){return Y("date:"+ie.toJSON())},_symbol:function(ie){return Y("symbol:"+ie.toString())},_error:function(ie){return Y("error:"+ie.toString())},_boolean:function(ie){return Y("bool:"+ie.toString())},_string:function(ie){Y("string:"+ie.length+":"),Y(ie.toString())},_function:function(ie){Y("fn:"),V(ie)?this.dispatch("[native]"):this.dispatch(ie.toString()),ue.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(ie.name)),ue.respectFunctionProperties&&this._object(ie)},_number:function(ie){return Y("number:"+ie.toString())},_xml:function(ie){return Y("xml:"+ie.toString())},_null:function(){return Y("Null")},_undefined:function(){return Y("Undefined")},_regexp:function(ie){return Y("regex:"+ie.toString())},_uint8array:function(ie){return Y("uint8array:"),this.dispatch(Array.prototype.slice.call(ie))},_uint8clampedarray:function(ie){return Y("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(ie))},_int8array:function(ie){return Y("uint8array:"),this.dispatch(Array.prototype.slice.call(ie))},_uint16array:function(ie){return Y("uint16array:"),this.dispatch(Array.prototype.slice.call(ie))},_int16array:function(ie){return Y("uint16array:"),this.dispatch(Array.prototype.slice.call(ie))},_uint32array:function(ie){return Y("uint32array:"),this.dispatch(Array.prototype.slice.call(ie))},_int32array:function(ie){return Y("uint32array:"),this.dispatch(Array.prototype.slice.call(ie))},_float32array:function(ie){return Y("float32array:"),this.dispatch(Array.prototype.slice.call(ie))},_float64array:function(ie){return Y("float64array:"),this.dispatch(Array.prototype.slice.call(ie))},_arraybuffer:function(ie){return Y("arraybuffer:"),this.dispatch(new Uint8Array(ie))},_url:function(ie){return Y("url:"+ie.toString())},_map:function(ie){Y("map:");var ve=Array.from(ie);return this._array(ve,ue.unorderedSets!==!1)},_set:function(ie){Y("set:");var ve=Array.from(ie);return this._array(ve,ue.unorderedSets!==!1)},_file:function(ie){return Y("file:"),this.dispatch([ie.name,ie.size,ie.type,ie.lastModfied])},_blob:function(){if(ue.ignoreUnknown)return Y("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Y("domwindow")},_bigint:function(ie){return Y("bigint:"+ie.toString())},_process:function(){return Y("process")},_timer:function(){return Y("timer")},_pipe:function(){return Y("pipe")},_tcp:function(){return Y("tcp")},_udp:function(){return Y("udp")},_tty:function(){return Y("tty")},_statwatcher:function(){return Y("statwatcher")},_securecontext:function(){return Y("securecontext")},_connection:function(){return Y("connection")},_zlib:function(){return Y("zlib")},_context:function(){return Y("context")},_nodescript:function(){return Y("nodescript")},_httpparser:function(){return Y("httpparser")},_dataview:function(){return Y("dataview")},_signal:function(){return Y("signal")},_fsevent:function(){return Y("fsevent")},_tlswrap:function(){return Y("tlswrap")}}}function ce(){return{buf:"",write:function(ue){this.buf+=ue},end:function(ue){this.buf+=ue},read:function(){return this.buf}}}m.writeToStream=function(ue,he,K){return K===void 0&&(K=he,he={}),z(he=H(ue,he),K).dispatch(ue)}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){(function(J){var $=typeof Uint8Array<"u"?Uint8Array:Array,oe="+".charCodeAt(0),ne="/".charCodeAt(0),H="0".charCodeAt(0),V="a".charCodeAt(0),z="A".charCodeAt(0),ce="-".charCodeAt(0),ue="_".charCodeAt(0);function he(K){var Y=K.charCodeAt(0);return Y===oe||Y===ce?62:Y===ne||Y===ue?63:Y<H?-1:Y<H+10?Y-H+26+26:Y<z+26?Y-z:Y<V+26?Y-V+26:void 0}J.toByteArray=function(K){var Y,ie;if(0<K.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var ve=K.length,re=K.charAt(ve-2)==="="?2:K.charAt(ve-1)==="="?1:0,ae=new $(3*K.length/4-re),me=0<re?K.length-4:K.length,ye=0;function Te(ke){ae[ye++]=ke}for(Y=0;Y<me;Y+=4,0)Te((16711680&(ie=he(K.charAt(Y))<<18|he(K.charAt(Y+1))<<12|he(K.charAt(Y+2))<<6|he(K.charAt(Y+3))))>>16),Te((65280&ie)>>8),Te(255&ie);return re==2?Te(255&(ie=he(K.charAt(Y))<<2|he(K.charAt(Y+1))>>4)):re==1&&(Te((ie=he(K.charAt(Y))<<10|he(K.charAt(Y+1))<<4|he(K.charAt(Y+2))>>2)>>8&255),Te(255&ie)),ae},J.fromByteArray=function(K){var Y,ie,ve,re,ae=K.length%3,me="";function ye(Te){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(Te)}for(Y=0,ve=K.length-ae;Y<ve;Y+=3)me+=ye((re=ie=(K[Y]<<16)+(K[Y+1]<<8)+K[Y+2])>>18&63)+ye(re>>12&63)+ye(re>>6&63)+ye(63&re);switch(ae){case 1:me+=ye((ie=K[K.length-1])>>2),me+=ye(ie<<4&63),me+="==";break;case 2:me+=ye((ie=(K[K.length-2]<<8)+K[K.length-1])>>10),me+=ye(ie>>4&63),me+=ye(ie<<2&63),me+="="}return me}})(m===void 0?this.base64js={}:m)}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(r,i,m){(function(_,A,oe,T,R,D,U,k,X){var J=r("base64-js"),$=r("ieee754");function oe(Ne,et,wt){if(!(this instanceof oe))return new oe(Ne,et,wt);var Zt,nn,Vn,Jn,Ue,St=typeof Ne;if(et==="base64"&&St=="string")for(Ne=(Zt=Ne).trim?Zt.trim():Zt.replace(/^\s+|\s+$/g,"");Ne.length%4!=0;)Ne+="=";if(St=="number")nn=ye(Ne);else if(St=="string")nn=oe.byteLength(Ne,et);else{if(St!="object")throw new Error("First argument needs to be a number, array or string.");nn=ye(Ne.length)}if(oe._useTypedArrays?Vn=oe._augment(new Uint8Array(nn)):((Vn=this).length=nn,Vn._isBuffer=!0),oe._useTypedArrays&&typeof Ne.byteLength=="number")Vn._set(Ne);else if(Te(Ue=Ne)||oe.isBuffer(Ue)||Ue&&typeof Ue=="object"&&typeof Ue.length=="number")for(Jn=0;Jn<nn;Jn++)oe.isBuffer(Ne)?Vn[Jn]=Ne.readUInt8(Jn):Vn[Jn]=Ne[Jn];else if(St=="string")Vn.write(Ne,0,et);else if(St=="number"&&!oe._useTypedArrays&&!wt)for(Jn=0;Jn<nn;Jn++)Vn[Jn]=0;return Vn}function ne(Ne,et,wt,Zt){Zt||(Et(typeof wt=="boolean","missing or invalid endian"),Et(et!=null,"missing offset"),Et(et+1<Ne.length,"Trying to read beyond buffer length"));var nn,Vn=Ne.length;if(!(Vn<=et))return wt?(nn=Ne[et],et+1<Vn&&(nn|=Ne[et+1]<<8)):(nn=Ne[et]<<8,et+1<Vn&&(nn|=Ne[et+1])),nn}function H(Ne,et,wt,Zt){Zt||(Et(typeof wt=="boolean","missing or invalid endian"),Et(et!=null,"missing offset"),Et(et+3<Ne.length,"Trying to read beyond buffer length"));var nn,Vn=Ne.length;if(!(Vn<=et))return wt?(et+2<Vn&&(nn=Ne[et+2]<<16),et+1<Vn&&(nn|=Ne[et+1]<<8),nn|=Ne[et],et+3<Vn&&(nn+=Ne[et+3]<<24>>>0)):(et+1<Vn&&(nn=Ne[et+1]<<16),et+2<Vn&&(nn|=Ne[et+2]<<8),et+3<Vn&&(nn|=Ne[et+3]),nn+=Ne[et]<<24>>>0),nn}function V(Ne,et,wt,Zt){if(Zt||(Et(typeof wt=="boolean","missing or invalid endian"),Et(et!=null,"missing offset"),Et(et+1<Ne.length,"Trying to read beyond buffer length")),!(Ne.length<=et)){var nn=ne(Ne,et,wt,!0);return 32768&nn?-1*(65535-nn+1):nn}}function z(Ne,et,wt,Zt){if(Zt||(Et(typeof wt=="boolean","missing or invalid endian"),Et(et!=null,"missing offset"),Et(et+3<Ne.length,"Trying to read beyond buffer length")),!(Ne.length<=et)){var nn=H(Ne,et,wt,!0);return 2147483648&nn?-1*(4294967295-nn+1):nn}}function ce(Ne,et,wt,Zt){return Zt||(Et(typeof wt=="boolean","missing or invalid endian"),Et(et+3<Ne.length,"Trying to read beyond buffer length")),$.read(Ne,et,wt,23,4)}function ue(Ne,et,wt,Zt){return Zt||(Et(typeof wt=="boolean","missing or invalid endian"),Et(et+7<Ne.length,"Trying to read beyond buffer length")),$.read(Ne,et,wt,52,8)}function he(Ne,et,wt,Zt,nn){nn||(Et(et!=null,"missing value"),Et(typeof Zt=="boolean","missing or invalid endian"),Et(wt!=null,"missing offset"),Et(wt+1<Ne.length,"trying to write beyond buffer length"),Ze(et,65535));var Vn=Ne.length;if(!(Vn<=wt))for(var Jn=0,Ue=Math.min(Vn-wt,2);Jn<Ue;Jn++)Ne[wt+Jn]=(et&255<<8*(Zt?Jn:1-Jn))>>>8*(Zt?Jn:1-Jn)}function K(Ne,et,wt,Zt,nn){nn||(Et(et!=null,"missing value"),Et(typeof Zt=="boolean","missing or invalid endian"),Et(wt!=null,"missing offset"),Et(wt+3<Ne.length,"trying to write beyond buffer length"),Ze(et,4294967295));var Vn=Ne.length;if(!(Vn<=wt))for(var Jn=0,Ue=Math.min(Vn-wt,4);Jn<Ue;Jn++)Ne[wt+Jn]=et>>>8*(Zt?Jn:3-Jn)&255}function Y(Ne,et,wt,Zt,nn){nn||(Et(et!=null,"missing value"),Et(typeof Zt=="boolean","missing or invalid endian"),Et(wt!=null,"missing offset"),Et(wt+1<Ne.length,"Trying to write beyond buffer length"),tt(et,32767,-32768)),Ne.length<=wt||he(Ne,0<=et?et:65535+et+1,wt,Zt,nn)}function ie(Ne,et,wt,Zt,nn){nn||(Et(et!=null,"missing value"),Et(typeof Zt=="boolean","missing or invalid endian"),Et(wt!=null,"missing offset"),Et(wt+3<Ne.length,"Trying to write beyond buffer length"),tt(et,2147483647,-2147483648)),Ne.length<=wt||K(Ne,0<=et?et:4294967295+et+1,wt,Zt,nn)}function ve(Ne,et,wt,Zt,nn){nn||(Et(et!=null,"missing value"),Et(typeof Zt=="boolean","missing or invalid endian"),Et(wt!=null,"missing offset"),Et(wt+3<Ne.length,"Trying to write beyond buffer length"),Pt(et,34028234663852886e22,-34028234663852886e22)),Ne.length<=wt||$.write(Ne,et,wt,Zt,23,4)}function re(Ne,et,wt,Zt,nn){nn||(Et(et!=null,"missing value"),Et(typeof Zt=="boolean","missing or invalid endian"),Et(wt!=null,"missing offset"),Et(wt+7<Ne.length,"Trying to write beyond buffer length"),Pt(et,17976931348623157e292,-17976931348623157e292)),Ne.length<=wt||$.write(Ne,et,wt,Zt,52,8)}m.Buffer=oe,m.SlowBuffer=oe,m.INSPECT_MAX_BYTES=50,oe.poolSize=8192,oe._useTypedArrays=function(){try{var Ne=new ArrayBuffer(0),et=new Uint8Array(Ne);return et.foo=function(){return 42},et.foo()===42&&typeof et.subarray=="function"}catch{return!1}}(),oe.isEncoding=function(Ne){switch(String(Ne).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},oe.isBuffer=function(Ne){return!(Ne==null||!Ne._isBuffer)},oe.byteLength=function(Ne,et){var wt;switch(Ne+="",et||"utf8"){case"hex":wt=Ne.length/2;break;case"utf8":case"utf-8":wt=Fe(Ne).length;break;case"ascii":case"binary":case"raw":wt=Ne.length;break;case"base64":wt=Ve(Ne).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":wt=2*Ne.length;break;default:throw new Error("Unknown encoding")}return wt},oe.concat=function(Ne,et){if(Et(Te(Ne),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),Ne.length===0)return new oe(0);if(Ne.length===1)return Ne[0];if(typeof et!="number")for(nn=et=0;nn<Ne.length;nn++)et+=Ne[nn].length;for(var wt=new oe(et),Zt=0,nn=0;nn<Ne.length;nn++){var Vn=Ne[nn];Vn.copy(wt,Zt),Zt+=Vn.length}return wt},oe.prototype.write=function(Ne,et,wt,Zt){var nn;isFinite(et)?isFinite(wt)||(Zt=wt,wt=void 0):(nn=Zt,Zt=et,et=wt,wt=nn),et=Number(et)||0;var Vn,Jn,Ue,St,Lt,jt,Gt,fn=this.length-et;switch((!wt||fn<(wt=Number(wt)))&&(wt=fn),Zt=String(Zt||"utf8").toLowerCase()){case"hex":Vn=function(hn,qt,An,_n){An=Number(An)||0;var Bn=hn.length-An;(!_n||Bn<(_n=Number(_n)))&&(_n=Bn);var de=qt.length;Et(de%2==0,"Invalid hex string"),de/2<_n&&(_n=de/2);for(var Ae=0;Ae<_n;Ae++){var Le=parseInt(qt.substr(2*Ae,2),16);Et(!isNaN(Le),"Invalid hex string"),hn[An+Ae]=Le}return oe._charsWritten=2*Ae,Ae}(this,Ne,et,wt);break;case"utf8":case"utf-8":Lt=Ne,jt=et,Gt=wt,Vn=oe._charsWritten=ot(Fe(Lt),this,jt,Gt);break;case"ascii":case"binary":Vn=function(hn,qt,An,_n){return oe._charsWritten=ot(function(Bn){for(var de=[],Ae=0;Ae<Bn.length;Ae++)de.push(255&Bn.charCodeAt(Ae));return de}(qt),hn,An,_n)}(this,Ne,et,wt);break;case"base64":Jn=Ne,Ue=et,St=wt,Vn=oe._charsWritten=ot(Ve(Jn),this,Ue,St);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Vn=function(hn,qt,An,_n){return oe._charsWritten=ot(function(Bn){for(var de,Ae,Le,Oe=[],$e=0;$e<Bn.length;$e++)Ae=(de=Bn.charCodeAt($e))>>8,Le=de%256,Oe.push(Le),Oe.push(Ae);return Oe}(qt),hn,An,_n)}(this,Ne,et,wt);break;default:throw new Error("Unknown encoding")}return Vn},oe.prototype.toString=function(Ne,et,wt){var Zt,nn,Vn,Jn,Ue=this;if(Ne=String(Ne||"utf8").toLowerCase(),et=Number(et)||0,(wt=wt!==void 0?Number(wt):wt=Ue.length)===et)return"";switch(Ne){case"hex":Zt=function(St,Lt,jt){var Gt=St.length;(!Lt||Lt<0)&&(Lt=0),(!jt||jt<0||Gt<jt)&&(jt=Gt);for(var fn="",hn=Lt;hn<jt;hn++)fn+=ke(St[hn]);return fn}(Ue,et,wt);break;case"utf8":case"utf-8":Zt=function(St,Lt,jt){var Gt="",fn="";jt=Math.min(St.length,jt);for(var hn=Lt;hn<jt;hn++)St[hn]<=127?(Gt+=Ye(fn)+String.fromCharCode(St[hn]),fn=""):fn+="%"+St[hn].toString(16);return Gt+Ye(fn)}(Ue,et,wt);break;case"ascii":case"binary":Zt=function(St,Lt,jt){var Gt="";jt=Math.min(St.length,jt);for(var fn=Lt;fn<jt;fn++)Gt+=String.fromCharCode(St[fn]);return Gt}(Ue,et,wt);break;case"base64":nn=Ue,Jn=wt,Zt=(Vn=et)===0&&Jn===nn.length?J.fromByteArray(nn):J.fromByteArray(nn.slice(Vn,Jn));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Zt=function(St,Lt,jt){for(var Gt=St.slice(Lt,jt),fn="",hn=0;hn<Gt.length;hn+=2)fn+=String.fromCharCode(Gt[hn]+256*Gt[hn+1]);return fn}(Ue,et,wt);break;default:throw new Error("Unknown encoding")}return Zt},oe.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},oe.prototype.copy=function(Ne,et,wt,Zt){if(wt=wt||0,Zt||Zt===0||(Zt=this.length),et=et||0,Zt!==wt&&Ne.length!==0&&this.length!==0){Et(wt<=Zt,"sourceEnd < sourceStart"),Et(0<=et&&et<Ne.length,"targetStart out of bounds"),Et(0<=wt&&wt<this.length,"sourceStart out of bounds"),Et(0<=Zt&&Zt<=this.length,"sourceEnd out of bounds"),Zt>this.length&&(Zt=this.length),Ne.length-et<Zt-wt&&(Zt=Ne.length-et+wt);var nn=Zt-wt;if(nn<100||!oe._useTypedArrays)for(var Vn=0;Vn<nn;Vn++)Ne[Vn+et]=this[Vn+wt];else Ne._set(this.subarray(wt,wt+nn),et)}},oe.prototype.slice=function(Ne,et){var wt=this.length;if(Ne=me(Ne,wt,0),et=me(et,wt,wt),oe._useTypedArrays)return oe._augment(this.subarray(Ne,et));for(var Zt=et-Ne,nn=new oe(Zt,void 0,!0),Vn=0;Vn<Zt;Vn++)nn[Vn]=this[Vn+Ne];return nn},oe.prototype.get=function(Ne){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(Ne)},oe.prototype.set=function(Ne,et){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(Ne,et)},oe.prototype.readUInt8=function(Ne,et){if(et||(Et(Ne!=null,"missing offset"),Et(Ne<this.length,"Trying to read beyond buffer length")),!(Ne>=this.length))return this[Ne]},oe.prototype.readUInt16LE=function(Ne,et){return ne(this,Ne,!0,et)},oe.prototype.readUInt16BE=function(Ne,et){return ne(this,Ne,!1,et)},oe.prototype.readUInt32LE=function(Ne,et){return H(this,Ne,!0,et)},oe.prototype.readUInt32BE=function(Ne,et){return H(this,Ne,!1,et)},oe.prototype.readInt8=function(Ne,et){if(et||(Et(Ne!=null,"missing offset"),Et(Ne<this.length,"Trying to read beyond buffer length")),!(Ne>=this.length))return 128&this[Ne]?-1*(255-this[Ne]+1):this[Ne]},oe.prototype.readInt16LE=function(Ne,et){return V(this,Ne,!0,et)},oe.prototype.readInt16BE=function(Ne,et){return V(this,Ne,!1,et)},oe.prototype.readInt32LE=function(Ne,et){return z(this,Ne,!0,et)},oe.prototype.readInt32BE=function(Ne,et){return z(this,Ne,!1,et)},oe.prototype.readFloatLE=function(Ne,et){return ce(this,Ne,!0,et)},oe.prototype.readFloatBE=function(Ne,et){return ce(this,Ne,!1,et)},oe.prototype.readDoubleLE=function(Ne,et){return ue(this,Ne,!0,et)},oe.prototype.readDoubleBE=function(Ne,et){return ue(this,Ne,!1,et)},oe.prototype.writeUInt8=function(Ne,et,wt){wt||(Et(Ne!=null,"missing value"),Et(et!=null,"missing offset"),Et(et<this.length,"trying to write beyond buffer length"),Ze(Ne,255)),et>=this.length||(this[et]=Ne)},oe.prototype.writeUInt16LE=function(Ne,et,wt){he(this,Ne,et,!0,wt)},oe.prototype.writeUInt16BE=function(Ne,et,wt){he(this,Ne,et,!1,wt)},oe.prototype.writeUInt32LE=function(Ne,et,wt){K(this,Ne,et,!0,wt)},oe.prototype.writeUInt32BE=function(Ne,et,wt){K(this,Ne,et,!1,wt)},oe.prototype.writeInt8=function(Ne,et,wt){wt||(Et(Ne!=null,"missing value"),Et(et!=null,"missing offset"),Et(et<this.length,"Trying to write beyond buffer length"),tt(Ne,127,-128)),et>=this.length||(0<=Ne?this.writeUInt8(Ne,et,wt):this.writeUInt8(255+Ne+1,et,wt))},oe.prototype.writeInt16LE=function(Ne,et,wt){Y(this,Ne,et,!0,wt)},oe.prototype.writeInt16BE=function(Ne,et,wt){Y(this,Ne,et,!1,wt)},oe.prototype.writeInt32LE=function(Ne,et,wt){ie(this,Ne,et,!0,wt)},oe.prototype.writeInt32BE=function(Ne,et,wt){ie(this,Ne,et,!1,wt)},oe.prototype.writeFloatLE=function(Ne,et,wt){ve(this,Ne,et,!0,wt)},oe.prototype.writeFloatBE=function(Ne,et,wt){ve(this,Ne,et,!1,wt)},oe.prototype.writeDoubleLE=function(Ne,et,wt){re(this,Ne,et,!0,wt)},oe.prototype.writeDoubleBE=function(Ne,et,wt){re(this,Ne,et,!1,wt)},oe.prototype.fill=function(Ne,et,wt){if(Ne=Ne||0,et=et||0,wt=wt||this.length,typeof Ne=="string"&&(Ne=Ne.charCodeAt(0)),Et(typeof Ne=="number"&&!isNaN(Ne),"value is not a number"),Et(et<=wt,"end < start"),wt!==et&&this.length!==0){Et(0<=et&&et<this.length,"start out of bounds"),Et(0<=wt&&wt<=this.length,"end out of bounds");for(var Zt=et;Zt<wt;Zt++)this[Zt]=Ne}},oe.prototype.inspect=function(){for(var Ne=[],et=this.length,wt=0;wt<et;wt++)if(Ne[wt]=ke(this[wt]),wt===m.INSPECT_MAX_BYTES){Ne[wt+1]="...";break}return"<Buffer "+Ne.join(" ")+">"},oe.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(oe._useTypedArrays)return new oe(this).buffer;for(var Ne=new Uint8Array(this.length),et=0,wt=Ne.length;et<wt;et+=1)Ne[et]=this[et];return Ne.buffer};var ae=oe.prototype;function me(Ne,et,wt){return typeof Ne!="number"?wt:et<=(Ne=~~Ne)?et:0<=Ne||0<=(Ne+=et)?Ne:0}function ye(Ne){return(Ne=~~Math.ceil(+Ne))<0?0:Ne}function Te(Ne){return(Array.isArray||function(et){return Object.prototype.toString.call(et)==="[object Array]"})(Ne)}function ke(Ne){return Ne<16?"0"+Ne.toString(16):Ne.toString(16)}function Fe(Ne){for(var et=[],wt=0;wt<Ne.length;wt++){var Zt=Ne.charCodeAt(wt);if(Zt<=127)et.push(Ne.charCodeAt(wt));else{var nn=wt;55296<=Zt&&Zt<=57343&&wt++;for(var Vn=encodeURIComponent(Ne.slice(nn,wt+1)).substr(1).split("%"),Jn=0;Jn<Vn.length;Jn++)et.push(parseInt(Vn[Jn],16))}}return et}function Ve(Ne){return J.toByteArray(Ne)}function ot(Ne,et,wt,Zt){for(var nn=0;nn<Zt&&!(nn+wt>=et.length||nn>=Ne.length);nn++)et[nn+wt]=Ne[nn];return nn}function Ye(Ne){try{return decodeURIComponent(Ne)}catch{return String.fromCharCode(65533)}}function Ze(Ne,et){Et(typeof Ne=="number","cannot write a non-number as a number"),Et(0<=Ne,"specified a negative value for writing an unsigned value"),Et(Ne<=et,"value is larger than maximum value for type"),Et(Math.floor(Ne)===Ne,"value has a fractional component")}function tt(Ne,et,wt){Et(typeof Ne=="number","cannot write a non-number as a number"),Et(Ne<=et,"value larger than maximum allowed value"),Et(wt<=Ne,"value smaller than minimum allowed value"),Et(Math.floor(Ne)===Ne,"value has a fractional component")}function Pt(Ne,et,wt){Et(typeof Ne=="number","cannot write a non-number as a number"),Et(Ne<=et,"value larger than maximum allowed value"),Et(wt<=Ne,"value smaller than minimum allowed value")}function Et(Ne,et){if(!Ne)throw new Error(et||"Failed assertion")}oe._augment=function(Ne){return Ne._isBuffer=!0,Ne._get=Ne.get,Ne._set=Ne.set,Ne.get=ae.get,Ne.set=ae.set,Ne.write=ae.write,Ne.toString=ae.toString,Ne.toLocaleString=ae.toString,Ne.toJSON=ae.toJSON,Ne.copy=ae.copy,Ne.slice=ae.slice,Ne.readUInt8=ae.readUInt8,Ne.readUInt16LE=ae.readUInt16LE,Ne.readUInt16BE=ae.readUInt16BE,Ne.readUInt32LE=ae.readUInt32LE,Ne.readUInt32BE=ae.readUInt32BE,Ne.readInt8=ae.readInt8,Ne.readInt16LE=ae.readInt16LE,Ne.readInt16BE=ae.readInt16BE,Ne.readInt32LE=ae.readInt32LE,Ne.readInt32BE=ae.readInt32BE,Ne.readFloatLE=ae.readFloatLE,Ne.readFloatBE=ae.readFloatBE,Ne.readDoubleLE=ae.readDoubleLE,Ne.readDoubleBE=ae.readDoubleBE,Ne.writeUInt8=ae.writeUInt8,Ne.writeUInt16LE=ae.writeUInt16LE,Ne.writeUInt16BE=ae.writeUInt16BE,Ne.writeUInt32LE=ae.writeUInt32LE,Ne.writeUInt32BE=ae.writeUInt32BE,Ne.writeInt8=ae.writeInt8,Ne.writeInt16LE=ae.writeInt16LE,Ne.writeInt16BE=ae.writeInt16BE,Ne.writeInt32LE=ae.writeInt32LE,Ne.writeInt32BE=ae.writeInt32BE,Ne.writeFloatLE=ae.writeFloatLE,Ne.writeFloatBE=ae.writeFloatBE,Ne.writeDoubleLE=ae.writeDoubleLE,Ne.writeDoubleBE=ae.writeDoubleBE,Ne.fill=ae.fill,Ne.inspect=ae.inspect,Ne.toArrayBuffer=ae.toArrayBuffer,Ne}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){w=r("buffer").Buffer;var J=new w(4);J.fill(0),i.exports={hash:function($,oe,ne,H){return w.isBuffer($)||($=new w($)),function(V,z,ce){for(var ue=new w(z),he=ce?ue.writeInt32BE:ue.writeInt32LE,K=0;K<V.length;K++)he.call(ue,V[K],4*K,!0);return ue}(oe(function(V,z){var ce;V.length%4!=0&&(ce=V.length+(4-V.length%4),V=w.concat([V,J],ce));for(var ue=[],he=z?V.readInt32BE:V.readInt32LE,K=0;K<V.length;K+=4)ue.push(he.call(V,K));return ue}($,H),8*$.length),ne,H)}}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){w=r("buffer").Buffer;var J=r("./sha"),$=r("./sha256"),oe=r("./rng"),ne={sha1:J,sha256:$,md5:r("./md5")},H=64,V=new w(H);function z(ue,he){var K=ne[ue=ue||"sha1"],Y=[];return K||ce("algorithm:",ue,"is not yet supported"),{update:function(ie){return w.isBuffer(ie)||(ie=new w(ie)),Y.push(ie),ie.length,this},digest:function(ie){var ve=w.concat(Y),re=he?function(ae,me,ye){w.isBuffer(me)||(me=new w(me)),w.isBuffer(ye)||(ye=new w(ye)),me.length>H?me=ae(me):me.length<H&&(me=w.concat([me,V],H));for(var Te=new w(H),ke=new w(H),Fe=0;Fe<H;Fe++)Te[Fe]=54^me[Fe],ke[Fe]=92^me[Fe];var Ve=ae(w.concat([Te,ye]));return ae(w.concat([ke,Ve]))}(K,he,ve):K(ve);return Y=null,ie?re.toString(ie):re}}}function ce(){var ue=[].slice.call(arguments).join(" ");throw new Error([ue,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}V.fill(0),m.createHash=function(ue){return z(ue)},m.createHmac=z,m.randomBytes=function(ue,he){if(!he||!he.call)return new w(oe(ue));try{he.call(this,void 0,new w(oe(ue)))}catch(K){he(K)}},function(ue,he){for(var K in ue)he(ue[K])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(ue){m[ue]=function(){ce("sorry,",ue,"is not implemented yet")}})}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){var J=r("./helpers");function $(ue,he){ue[he>>5]|=128<<he%32,ue[14+(he+64>>>9<<4)]=he;for(var K=1732584193,Y=-271733879,ie=-1732584194,ve=271733878,re=0;re<ue.length;re+=16){var ae=K,me=Y,ye=ie,Te=ve;K=ne(K,Y,ie,ve,ue[re+0],7,-680876936),ve=ne(ve,K,Y,ie,ue[re+1],12,-389564586),ie=ne(ie,ve,K,Y,ue[re+2],17,606105819),Y=ne(Y,ie,ve,K,ue[re+3],22,-1044525330),K=ne(K,Y,ie,ve,ue[re+4],7,-176418897),ve=ne(ve,K,Y,ie,ue[re+5],12,1200080426),ie=ne(ie,ve,K,Y,ue[re+6],17,-1473231341),Y=ne(Y,ie,ve,K,ue[re+7],22,-45705983),K=ne(K,Y,ie,ve,ue[re+8],7,1770035416),ve=ne(ve,K,Y,ie,ue[re+9],12,-1958414417),ie=ne(ie,ve,K,Y,ue[re+10],17,-42063),Y=ne(Y,ie,ve,K,ue[re+11],22,-1990404162),K=ne(K,Y,ie,ve,ue[re+12],7,1804603682),ve=ne(ve,K,Y,ie,ue[re+13],12,-40341101),ie=ne(ie,ve,K,Y,ue[re+14],17,-1502002290),K=H(K,Y=ne(Y,ie,ve,K,ue[re+15],22,1236535329),ie,ve,ue[re+1],5,-165796510),ve=H(ve,K,Y,ie,ue[re+6],9,-1069501632),ie=H(ie,ve,K,Y,ue[re+11],14,643717713),Y=H(Y,ie,ve,K,ue[re+0],20,-373897302),K=H(K,Y,ie,ve,ue[re+5],5,-701558691),ve=H(ve,K,Y,ie,ue[re+10],9,38016083),ie=H(ie,ve,K,Y,ue[re+15],14,-660478335),Y=H(Y,ie,ve,K,ue[re+4],20,-405537848),K=H(K,Y,ie,ve,ue[re+9],5,568446438),ve=H(ve,K,Y,ie,ue[re+14],9,-1019803690),ie=H(ie,ve,K,Y,ue[re+3],14,-187363961),Y=H(Y,ie,ve,K,ue[re+8],20,1163531501),K=H(K,Y,ie,ve,ue[re+13],5,-1444681467),ve=H(ve,K,Y,ie,ue[re+2],9,-51403784),ie=H(ie,ve,K,Y,ue[re+7],14,1735328473),K=V(K,Y=H(Y,ie,ve,K,ue[re+12],20,-1926607734),ie,ve,ue[re+5],4,-378558),ve=V(ve,K,Y,ie,ue[re+8],11,-2022574463),ie=V(ie,ve,K,Y,ue[re+11],16,1839030562),Y=V(Y,ie,ve,K,ue[re+14],23,-35309556),K=V(K,Y,ie,ve,ue[re+1],4,-1530992060),ve=V(ve,K,Y,ie,ue[re+4],11,1272893353),ie=V(ie,ve,K,Y,ue[re+7],16,-155497632),Y=V(Y,ie,ve,K,ue[re+10],23,-1094730640),K=V(K,Y,ie,ve,ue[re+13],4,681279174),ve=V(ve,K,Y,ie,ue[re+0],11,-358537222),ie=V(ie,ve,K,Y,ue[re+3],16,-722521979),Y=V(Y,ie,ve,K,ue[re+6],23,76029189),K=V(K,Y,ie,ve,ue[re+9],4,-640364487),ve=V(ve,K,Y,ie,ue[re+12],11,-421815835),ie=V(ie,ve,K,Y,ue[re+15],16,530742520),K=z(K,Y=V(Y,ie,ve,K,ue[re+2],23,-995338651),ie,ve,ue[re+0],6,-198630844),ve=z(ve,K,Y,ie,ue[re+7],10,1126891415),ie=z(ie,ve,K,Y,ue[re+14],15,-1416354905),Y=z(Y,ie,ve,K,ue[re+5],21,-57434055),K=z(K,Y,ie,ve,ue[re+12],6,1700485571),ve=z(ve,K,Y,ie,ue[re+3],10,-1894986606),ie=z(ie,ve,K,Y,ue[re+10],15,-1051523),Y=z(Y,ie,ve,K,ue[re+1],21,-2054922799),K=z(K,Y,ie,ve,ue[re+8],6,1873313359),ve=z(ve,K,Y,ie,ue[re+15],10,-30611744),ie=z(ie,ve,K,Y,ue[re+6],15,-1560198380),Y=z(Y,ie,ve,K,ue[re+13],21,1309151649),K=z(K,Y,ie,ve,ue[re+4],6,-145523070),ve=z(ve,K,Y,ie,ue[re+11],10,-1120210379),ie=z(ie,ve,K,Y,ue[re+2],15,718787259),Y=z(Y,ie,ve,K,ue[re+9],21,-343485551),K=ce(K,ae),Y=ce(Y,me),ie=ce(ie,ye),ve=ce(ve,Te)}return Array(K,Y,ie,ve)}function oe(ue,he,K,Y,ie,ve){return ce((re=ce(ce(he,ue),ce(Y,ve)))<<(ae=ie)|re>>>32-ae,K);var re,ae}function ne(ue,he,K,Y,ie,ve,re){return oe(he&K|~he&Y,ue,he,ie,ve,re)}function H(ue,he,K,Y,ie,ve,re){return oe(he&Y|K&~Y,ue,he,ie,ve,re)}function V(ue,he,K,Y,ie,ve,re){return oe(he^K^Y,ue,he,ie,ve,re)}function z(ue,he,K,Y,ie,ve,re){return oe(K^(he|~Y),ue,he,ie,ve,re)}function ce(ue,he){var K=(65535&ue)+(65535&he);return(ue>>16)+(he>>16)+(K>>16)<<16|65535&K}i.exports=function(ue){return J.hash(ue,$,16)}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){var J;J=function($){for(var oe,ne=new Array($),H=0;H<$;H++)!(3&H)&&(oe=4294967296*Math.random()),ne[H]=oe>>>((3&H)<<3)&255;return ne},i.exports=J}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){var J=r("./helpers");function $(H,V){H[V>>5]|=128<<24-V%32,H[15+(V+64>>9<<4)]=V;for(var z,ce,ue,he,K,Y=Array(80),ie=1732584193,ve=-271733879,re=-1732584194,ae=271733878,me=-1009589776,ye=0;ye<H.length;ye+=16){for(var Te=ie,ke=ve,Fe=re,Ve=ae,ot=me,Ye=0;Ye<80;Ye++){Y[Ye]=Ye<16?H[ye+Ye]:ne(Y[Ye-3]^Y[Ye-8]^Y[Ye-14]^Y[Ye-16],1);var Ze=oe(oe(ne(ie,5),(ue=ve,he=re,K=ae,(ce=Ye)<20?ue&he|~ue&K:!(ce<40)&&ce<60?ue&he|ue&K|he&K:ue^he^K)),oe(oe(me,Y[Ye]),(z=Ye)<20?1518500249:z<40?1859775393:z<60?-1894007588:-899497514));me=ae,ae=re,re=ne(ve,30),ve=ie,ie=Ze}ie=oe(ie,Te),ve=oe(ve,ke),re=oe(re,Fe),ae=oe(ae,Ve),me=oe(me,ot)}return Array(ie,ve,re,ae,me)}function oe(H,V){var z=(65535&H)+(65535&V);return(H>>16)+(V>>16)+(z>>16)<<16|65535&z}function ne(H,V){return H<<V|H>>>32-V}i.exports=function(H){return J.hash(H,$,20,!0)}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){function J(H,V){var z=(65535&H)+(65535&V);return(H>>16)+(V>>16)+(z>>16)<<16|65535&z}function $(H,V){return H>>>V|H<<32-V}function oe(H,V){var z,ce,ue,he,K,Y,ie,ve,re,ae,me=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),ye=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),Te=new Array(64);H[V>>5]|=128<<24-V%32,H[15+(V+64>>9<<4)]=V;for(var ke,Fe,Ve,ot,Ye,Ze,tt,Pt,Et=0;Et<H.length;Et+=16){z=ye[0],ce=ye[1],ue=ye[2],he=ye[3],K=ye[4],Y=ye[5],ie=ye[6],ve=ye[7];for(var Ne=0;Ne<64;Ne++)Te[Ne]=Ne<16?H[Ne+Et]:J(J(J($(Pt=Te[Ne-2],17)^$(Pt,19)^Pt>>>10,Te[Ne-7]),$(tt=Te[Ne-15],7)^$(tt,18)^tt>>>3),Te[Ne-16]),re=J(J(J(J(ve,$(Ze=K,6)^$(Ze,11)^$(Ze,25)),(Ye=K)&Y^~Ye&ie),me[Ne]),Te[Ne]),ae=J($(ot=z,2)^$(ot,13)^$(ot,22),(ke=z)&(Fe=ce)^ke&(Ve=ue)^Fe&Ve),ve=ie,ie=Y,Y=K,K=J(he,re),he=ue,ue=ce,ce=z,z=J(re,ae);ye[0]=J(z,ye[0]),ye[1]=J(ce,ye[1]),ye[2]=J(ue,ye[2]),ye[3]=J(he,ye[3]),ye[4]=J(K,ye[4]),ye[5]=J(Y,ye[5]),ye[6]=J(ie,ye[6]),ye[7]=J(ve,ye[7])}return ye}var ne=r("./helpers");i.exports=function(H){return ne.hash(H,oe,32,!0)}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){function J(){}(_=i.exports={}).nextTick=function(){var $=typeof window<"u"&&window.setImmediate,oe=typeof window<"u"&&window.postMessage&&window.addEventListener;if($)return function(H){return window.setImmediate(H)};if(oe){var ne=[];return window.addEventListener("message",function(H){var V=H.source;V!==window&&V!==null||H.data!=="process-tick"||(H.stopPropagation(),0<ne.length&&ne.shift()())},!0),function(H){ne.push(H),window.postMessage("process-tick","*")}}return function(H){setTimeout(H,0)}}(),_.title="browser",_.browser=!0,_.env={},_.argv=[],_.on=J,_.addListener=J,_.once=J,_.off=J,_.removeListener=J,_.removeAllListeners=J,_.emit=J,_.binding=function($){throw new Error("process.binding is not supported")},_.cwd=function(){return"/"},_.chdir=function($){throw new Error("process.chdir is not supported")}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(r,i,m){(function(_,A,w,T,R,D,U,k,X){m.read=function(J,$,oe,ne,H){var V,z,ce=8*H-ne-1,ue=(1<<ce)-1,he=ue>>1,K=-7,Y=oe?H-1:0,ie=oe?-1:1,ve=J[$+Y];for(Y+=ie,V=ve&(1<<-K)-1,ve>>=-K,K+=ce;0<K;V=256*V+J[$+Y],Y+=ie,K-=8);for(z=V&(1<<-K)-1,V>>=-K,K+=ne;0<K;z=256*z+J[$+Y],Y+=ie,K-=8);if(V===0)V=1-he;else{if(V===ue)return z?NaN:1/0*(ve?-1:1);z+=Math.pow(2,ne),V-=he}return(ve?-1:1)*z*Math.pow(2,V-ne)},m.write=function(J,$,oe,ne,H,V){var z,ce,ue,he=8*V-H-1,K=(1<<he)-1,Y=K>>1,ie=H===23?Math.pow(2,-24)-Math.pow(2,-77):0,ve=ne?0:V-1,re=ne?1:-1,ae=$<0||$===0&&1/$<0?1:0;for($=Math.abs($),isNaN($)||$===1/0?(ce=isNaN($)?1:0,z=K):(z=Math.floor(Math.log($)/Math.LN2),$*(ue=Math.pow(2,-z))<1&&(z--,ue*=2),2<=($+=1<=z+Y?ie/ue:ie*Math.pow(2,1-Y))*ue&&(z++,ue/=2),K<=z+Y?(ce=0,z=K):1<=z+Y?(ce=($*ue-1)*Math.pow(2,H),z+=Y):(ce=$*Math.pow(2,Y-1)*Math.pow(2,H),z=0));8<=H;J[oe+ve]=255&ce,ve+=re,ce/=256,H-=8);for(z=z<<H|ce,he+=H;0<he;J[oe+ve]=255&z,ve+=re,z/=256,he-=8);J[oe+ve-re]|=128*ae}}).call(this,r("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},r("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(u){var r=function(){function i(oe){return U(oe,k(D(X(oe.length),oe),1/oe.length))}function m(oe){return D(J(oe),oe)}function _(oe,ne){return k(oe,ne?1/(oe.length-1):1/oe.length)}function A(oe){var ne=function(V){var z,ce=Math.pow(2,-52),ue=1e-64/ce,he=0,K=0,Y=0,ie=0,ve=0,re=$(V),ae=re.length,me=re[0].length;if(ae<me)throw"Need more rows than columns";var ye=new Array(me),Te=new Array(me);for(K=0;K<me;K++)ye[K]=Te[K]=0;var ke=function Zt(nn,Vn,Jn){Jn===void 0&&(Jn=0);var Ue,St=nn[Jn],Lt=Array(St);if(Jn===nn.length-1){for(Ue=St-2;Ue>=0;Ue-=2)Lt[Ue+1]=Vn,Lt[Ue]=Vn;return Ue===-1&&(Lt[0]=Vn),Lt}for(Ue=St-1;Ue>=0;Ue--)Lt[Ue]=Zt(nn,Vn,Jn+1);return Lt}([me,me],0);function Fe(Zt,nn){return(Zt=Math.abs(Zt))>(nn=Math.abs(nn))?Zt*Math.sqrt(1+nn*nn/Zt/Zt):nn==0?Zt:nn*Math.sqrt(1+Zt*Zt/nn/nn)}var Ve=0,ot=0,Ye=0,Ze=0,tt=0,Pt=0,Et=0;for(K=0;K<me;K++){for(ye[K]=ot,Et=0,ve=K+1,Y=K;Y<ae;Y++)Et+=re[Y][K]*re[Y][K];if(Et<=ue)ot=0;else for(Ve=re[K][K],ot=Math.sqrt(Et),Ve>=0&&(ot=-ot),Ye=Ve*ot-Et,re[K][K]=Ve-ot,Y=ve;Y<me;Y++){for(Et=0,ie=K;ie<ae;ie++)Et+=re[ie][K]*re[ie][Y];for(Ve=Et/Ye,ie=K;ie<ae;ie++)re[ie][Y]+=Ve*re[ie][K]}for(Te[K]=ot,Et=0,Y=ve;Y<me;Y++)Et+=re[K][Y]*re[K][Y];if(Et<=ue)ot=0;else{for(Ve=re[K][K+1],ot=Math.sqrt(Et),Ve>=0&&(ot=-ot),Ye=Ve*ot-Et,re[K][K+1]=Ve-ot,Y=ve;Y<me;Y++)ye[Y]=re[K][Y]/Ye;for(Y=ve;Y<ae;Y++){for(Et=0,ie=ve;ie<me;ie++)Et+=re[Y][ie]*re[K][ie];for(ie=ve;ie<me;ie++)re[Y][ie]+=Et*ye[ie]}}(tt=Math.abs(Te[K])+Math.abs(ye[K]))>Ze&&(Ze=tt)}for(K=me-1;K!=-1;K+=-1){if(ot!=0){for(Ye=ot*re[K][K+1],Y=ve;Y<me;Y++)ke[Y][K]=re[K][Y]/Ye;for(Y=ve;Y<me;Y++){for(Et=0,ie=ve;ie<me;ie++)Et+=re[K][ie]*ke[ie][Y];for(ie=ve;ie<me;ie++)ke[ie][Y]+=Et*ke[ie][K]}}for(Y=ve;Y<me;Y++)ke[K][Y]=0,ke[Y][K]=0;ke[K][K]=1,ot=ye[K],ve=K}for(K=me-1;K!=-1;K+=-1){for(ve=K+1,ot=Te[K],Y=ve;Y<me;Y++)re[K][Y]=0;if(ot!=0){for(Ye=re[K][K]*ot,Y=ve;Y<me;Y++){for(Et=0,ie=ve;ie<ae;ie++)Et+=re[ie][K]*re[ie][Y];for(Ve=Et/Ye,ie=K;ie<ae;ie++)re[ie][Y]+=Ve*re[ie][K]}for(Y=K;Y<ae;Y++)re[Y][K]=re[Y][K]/ot}else for(Y=K;Y<ae;Y++)re[Y][K]=0;re[K][K]+=1}for(ce*=Ze,ie=me-1;ie!=-1;ie+=-1)for(var Ne=0;Ne<50;Ne++){var et=!1;for(ve=ie;ve!=-1;ve+=-1){if(Math.abs(ye[ve])<=ce){et=!0;break}if(Math.abs(Te[ve-1])<=ce)break}if(!et){he=0,Et=1;var wt=ve-1;for(K=ve;K<ie+1&&(Ve=Et*ye[K],ye[K]=he*ye[K],!(Math.abs(Ve)<=ce));K++)for(Ye=Fe(Ve,ot=Te[K]),Te[K]=Ye,he=ot/Ye,Et=-Ve/Ye,Y=0;Y<ae;Y++)tt=re[Y][wt],Pt=re[Y][K],re[Y][wt]=tt*he+Pt*Et,re[Y][K]=-tt*Et+Pt*he}if(Pt=Te[ie],ve==ie){if(Pt<0)for(Te[ie]=-Pt,Y=0;Y<me;Y++)ke[Y][ie]=-ke[Y][ie];break}if(Ne>=49)throw"Error: no convergence.";for(Ze=Te[ve],ot=Fe(Ve=(((tt=Te[ie-1])-Pt)*(tt+Pt)+((ot=ye[ie-1])-(Ye=ye[ie]))*(ot+Ye))/(2*Ye*tt),1),Ve=Ve<0?((Ze-Pt)*(Ze+Pt)+Ye*(tt/(Ve-ot)-Ye))/Ze:((Ze-Pt)*(Ze+Pt)+Ye*(tt/(Ve+ot)-Ye))/Ze,he=1,Et=1,K=ve+1;K<ie+1;K++){for(ot=ye[K],tt=Te[K],Ye=Et*ot,ot*=he,Pt=Fe(Ve,Ye),ye[K-1]=Pt,Ve=Ze*(he=Ve/Pt)+ot*(Et=Ye/Pt),ot=-Ze*Et+ot*he,Ye=tt*Et,tt*=he,Y=0;Y<me;Y++)Ze=ke[Y][K-1],Pt=ke[Y][K],ke[Y][K-1]=Ze*he+Pt*Et,ke[Y][K]=-Ze*Et+Pt*he;for(Pt=Fe(Ve,Ye),Te[K-1]=Pt,Ve=(he=Ve/Pt)*ot+(Et=Ye/Pt)*tt,Ze=-Et*ot+he*tt,Y=0;Y<ae;Y++)tt=re[Y][K-1],Pt=re[Y][K],re[Y][K-1]=tt*he+Pt*Et,re[Y][K]=-tt*Et+Pt*he}ye[ve]=0,ye[ie]=Ve,Te[ie]=Ze}for(K=0;K<Te.length;K++)Te[K]<ce&&(Te[K]=0);for(K=0;K<me;K++)for(Y=K-1;Y>=0;Y--)if(Te[Y]<Te[K]){for(he=Te[Y],Te[Y]=Te[K],Te[K]=he,ie=0;ie<re.length;ie++)z=re[ie][K],re[ie][K]=re[ie][Y],re[ie][Y]=z;for(ie=0;ie<ke.length;ie++)z=ke[ie][K],ke[ie][K]=ke[ie][Y],ke[ie][Y]=z;K=Y}return{U:re,S:Te,V:ke}}(oe);console.log(ne);var H=ne.U;return ne.S.map(function(V,z){var ce={};return ce.eigenvalue=V,ce.vector=H.map(function(ue,he){return-1*ue[z]}),ce})}function w(oe,...ne){var H=ne.map(function(ce){return ce.vector}),V=D(H,J(i(oe))),z=k(D(X(oe.length),oe),-1/oe.length);return{adjustedData:V,formattedAdjustedData:R(V,2),avgData:z,selectedVectors:H}}function T(oe){return A(_(m(i(oe)),!1))}function R(oe,ne){var H=Math.pow(10,ne||2);return oe.map(function(V,z){return V.map(function(ce){return Math.round(ce*H)/H})})}function D(oe,ne){if(!(oe[0]&&ne[0]&&oe.length&&ne.length))throw new Error("Both A and B should be matrices");if(ne.length!==oe[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var H=[],V=0;V<oe.length;V++){H[V]=[];for(var z=0;z<ne[0].length;z++)for(var ce=0;ce<oe[0].length;ce++)H[V][z]=H[V][z]?H[V][z]+oe[V][ce]*ne[ce][z]:oe[V][ce]*ne[ce][z]}return H}function U(oe,ne){if(oe.length!==ne.length||oe[0].length!==ne[0].length)throw new Error("Both A and B should have the same dimensions");for(var H=[],V=0;V<oe.length;V++){H[V]=[];for(var z=0;z<ne[0].length;z++)H[V][z]=oe[V][z]-ne[V][z]}return H}function k(oe,ne){for(var H=[],V=0;V<oe.length;V++){H[V]=[];for(var z=0;z<oe[0].length;z++)H[V][z]=oe[V][z]*ne}return H}function X(oe){for(var ne=[],H=0;H<oe;H++){ne[H]=[];for(var V=0;V<oe;V++)ne[H][V]=1}return ne}function J(oe){return $(oe)[0].map(function(ne,H){return oe.map(function(V){return V[H]})})}function $(oe){var ne=JSON.stringify(oe);return JSON.parse(ne)}return{computeDeviationScores:m,computeDeviationMatrix:i,computeSVD:A,computePercentageExplained:function(oe,...ne){var H=oe.map(function(V){return V.eigenvalue}).reduce(function(V,z){return V+z});return ne.map(function(V){return V.eigenvalue}).reduce(function(V,z){return V+z})/H},computeOriginalData:function(oe,ne,H){var V=U(J(D(J(ne),oe)),H);return{originalData:V,formattedOriginalData:R(V,2)}},computeVarianceCovariance:_,computeAdjustedData:w,getEigenVectors:T,analyseTopResult:function(oe){var ne=T(oe).sort(function(H,V){return V.eigenvalue-H.eigenvalue});return console.log("Sorted Vectors",ne),w(oe,ne[0].vector)},transpose:J,multiply:D,clone:$,scale:k}}();u.exports=r},701:function(u){var r=[];function i(A){for(var w=-1,T=0;T<r.length;T++)if(r[T].identifier===A){w=T;break}return w}function m(A,w){for(var T={},R=[],D=0;D<A.length;D++){var U=A[D],k=w.base?U[0]+w.base:U[0],X=T[k]||0,J="".concat(k," ").concat(X);T[k]=X+1;var $=i(J),oe={css:U[1],media:U[2],sourceMap:U[3],supports:U[4],layer:U[5]};if($!==-1)r[$].references++,r[$].updater(oe);else{var ne=_(oe,w);w.byIndex=D,r.splice(D,0,{identifier:J,updater:ne,references:1})}R.push(J)}return R}function _(A,w){var T=w.domAPI(w);return T.update(A),function(R){if(R){if(R.css===A.css&&R.media===A.media&&R.sourceMap===A.sourceMap&&R.supports===A.supports&&R.layer===A.layer)return;T.update(A=R)}else T.remove()}}u.exports=function(A,w){var T=m(A=A||[],w=w||{});return function(R){R=R||[];for(var D=0;D<T.length;D++){var U=i(T[D]);r[U].references--}for(var k=m(R,w),X=0;X<T.length;X++){var J=i(T[X]);r[J].references===0&&(r[J].updater(),r.splice(J,1))}T=k}}},182:function(u){u.exports=function(r){var i=document.createElement("style");return r.setAttributes(i,r.attributes),r.insert(i,r.options),i}},850:function(u,r,i){u.exports=function(m){var _=i.nc;_&&m.setAttribute("nonce",_)}},236:function(u){u.exports=function(r){var i=r.insertStyleElement(r);return{update:function(m){(function(_,A,w){var T="";w.supports&&(T+="@supports (".concat(w.supports,") {")),w.media&&(T+="@media ".concat(w.media," {"));var R=w.layer!==void 0;R&&(T+="@layer".concat(w.layer.length>0?" ".concat(w.layer):""," {")),T+=w.css,R&&(T+="}"),w.media&&(T+="}"),w.supports&&(T+="}");var D=w.sourceMap;D&&typeof btoa<"u"&&(T+=`
/`,T+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(D))))," *"),T+="/"),A.styleTagTransform(T,_,A.options)})(i,r,m)},remove:function(){(function(m){if(m.parentNode===null)return!1;m.parentNode.removeChild(m)})(i)}}}},213:function(u){u.exports=function(r,i){if(i.styleSheet)i.styleSheet.cssText=r;else{for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(document.createTextNode(r))}}},1:function(u){u.exports=function(){var r={820:function(A,w,T){var R=T(537),D=T.n(R),U=T(645),k=T.n(U)()(D());k.push([A.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),w.Z=k},645:function(A){A.exports=function(w){var T=[];return T.toString=function(){return this.map(function(R){var D="",U=R[5]!==void 0;return R[4]&&(D+="@supports (".concat(R[4],") {")),R[2]&&(D+="@media ".concat(R[2]," {")),U&&(D+="@layer".concat(R[5].length>0?" ".concat(R[5]):""," {")),D+=w(R),U&&(D+="}"),R[2]&&(D+="}"),R[4]&&(D+="}"),D}).join("")},T.i=function(R,D,U,k,X){typeof R=="string"&&(R=[[null,R,void 0]]);var J={};if(U)for(var $=0;$<this.length;$++){var oe=this[$][0];oe!=null&&(J[oe]=!0)}for(var ne=0;ne<R.length;ne++){var H=[].concat(R[ne]);U&&J[H[0]]||(X!==void 0&&(H[5]===void 0||(H[1]="@layer".concat(H[5].length>0?" ".concat(H[5]):""," {").concat(H[1],"}")),H[5]=X),D&&(H[2]&&(H[1]="@media ".concat(H[2]," {").concat(H[1],"}")),H[2]=D),k&&(H[4]?(H[1]="@supports (".concat(H[4],") {").concat(H[1],"}"),H[4]=k):H[4]="".concat(k)),T.push(H))}},T}},537:function(A){A.exports=function(w){var T=w[1],R=w[3];if(!R)return T;if(typeof btoa=="function"){var D=btoa(unescape(encodeURIComponent(JSON.stringify(R)))),U="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(D),k="/*# ".concat(U," */"),X=R.sources.map(function(J){return"/*# sourceURL=".concat(R.sourceRoot||"").concat(J," */")});return[T].concat(X).concat([k]).join(`
`)}return[T].join(`
`)}},379:function(A){var w=[];function T(U){for(var k=-1,X=0;X<w.length;X++)if(w[X].identifier===U){k=X;break}return k}function R(U,k){for(var X={},J=[],$=0;$<U.length;$++){var oe=U[$],ne=k.base?oe[0]+k.base:oe[0],H=X[ne]||0,V="".concat(ne," ").concat(H);X[ne]=H+1;var z=T(V),ce={css:oe[1],media:oe[2],sourceMap:oe[3],supports:oe[4],layer:oe[5]};if(z!==-1)w[z].references++,w[z].updater(ce);else{var ue=D(ce,k);k.byIndex=$,w.splice($,0,{identifier:V,updater:ue,references:1})}J.push(V)}return J}function D(U,k){var X=k.domAPI(k);return X.update(U),function(J){if(J){if(J.css===U.css&&J.media===U.media&&J.sourceMap===U.sourceMap&&J.supports===U.supports&&J.layer===U.layer)return;X.update(U=J)}else X.remove()}}A.exports=function(U,k){var X=R(U=U||[],k=k||{});return function(J){J=J||[];for(var $=0;$<X.length;$++){var oe=T(X[$]);w[oe].references--}for(var ne=R(J,k),H=0;H<X.length;H++){var V=T(X[H]);w[V].references===0&&(w[V].updater(),w.splice(V,1))}X=ne}}},216:function(A){A.exports=function(w){var T=document.createElement("style");return w.setAttributes(T,w.attributes),w.insert(T,w.options),T}},636:function(A,w,T){A.exports=function(R){var D=T.nc;D&&R.setAttribute("nonce",D)}},795:function(A){A.exports=function(w){var T=w.insertStyleElement(w);return{update:function(R){(function(D,U,k){var X="";k.supports&&(X+="@supports (".concat(k.supports,") {")),k.media&&(X+="@media ".concat(k.media," {"));var J=k.layer!==void 0;J&&(X+="@layer".concat(k.layer.length>0?" ".concat(k.layer):""," {")),X+=k.css,J&&(X+="}"),k.media&&(X+="}"),k.supports&&(X+="}");var $=k.sourceMap;$&&typeof btoa<"u"&&(X+=`
/`,X+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify($))))," *"),X+="/"),U.styleTagTransform(X,D,U.options)})(T,w,R)},remove:function(){(function(R){if(R.parentNode===null)return!1;R.parentNode.removeChild(R)})(T)}}}},589:function(A){A.exports=function(w,T){if(T.styleSheet)T.styleSheet.cssText=w;else{for(;T.firstChild;)T.removeChild(T.firstChild);T.appendChild(document.createTextNode(w))}}}},i={};function m(A){var w=i[A];if(w!==void 0)return w.exports;var T=i[A]={id:A,exports:{}};return r[A](T,T.exports,m),T.exports}m.n=function(A){var w=A&&A.__esModule?function(){return A.default}:function(){return A};return m.d(w,{a:w}),w},m.d=function(A,w){for(var T in w)m.o(w,T)&&!m.o(A,T)&&Object.defineProperty(A,T,{enumerable:!0,get:w[T]})},m.o=function(A,w){return Object.prototype.hasOwnProperty.call(A,w)},m.nc=void 0;var _={};return function(){m.d(_,{default:function(){return Te}});var A=m(379),w=m.n(A),T=m(795),R=m.n(T),D=m(636),U=m.n(D),k=m(216),X=m.n(k),J=m(589),$=m.n(J),oe=m(820),ne={};oe.Z&&oe.Z.locals&&(ne.locals=oe.Z.locals);var H,V=0,z={};z.styleTagTransform=$(),z.setAttributes=U(),z.insert=function(ke,Fe){(Fe.target||document.head).appendChild(ke)},z.domAPI=R(),z.insertStyleElement=X(),ne.use=function(ke){return z.options=ke||{},V++||(H=w()(oe.Z,z)),ne},ne.unuse=function(){V>0&&!--V&&(H(),H=null)};var ce=ne;function ue(ke,Fe){return function(Ve){if(Array.isArray(Ve))return Ve}(ke)||function(Ve,ot){var Ye=Ve==null?null:typeof Symbol<"u"&&Ve[Symbol.iterator]||Ve["@@iterator"];if(Ye!=null){var Ze,tt,Pt=[],Et=!0,Ne=!1;try{for(Ye=Ye.call(Ve);!(Et=(Ze=Ye.next()).done)&&(Pt.push(Ze.value),!ot||Pt.length!==ot);Et=!0);}catch(et){Ne=!0,tt=et}finally{try{Et||Ye.return==null||Ye.return()}finally{if(Ne)throw tt}}return Pt}}(ke,Fe)||function(Ve,ot){if(Ve){if(typeof Ve=="string")return he(Ve,ot);var Ye=Object.prototype.toString.call(Ve).slice(8,-1);return Ye==="Object"&&Ve.constructor&&(Ye=Ve.constructor.name),Ye==="Map"||Ye==="Set"?Array.from(Ve):Ye==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ye)?he(Ve,ot):void 0}}(ke,Fe)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function he(ke,Fe){(Fe==null||Fe>ke.length)&&(Fe=ke.length);for(var Ve=0,ot=new Array(Fe);Ve<Fe;Ve++)ot[Ve]=ke[Ve];return ot}function K(ke,Fe){var Ve=Object.keys(ke);if(Object.getOwnPropertySymbols){var ot=Object.getOwnPropertySymbols(ke);Fe&&(ot=ot.filter(function(Ye){return Object.getOwnPropertyDescriptor(ke,Ye).enumerable})),Ve.push.apply(Ve,ot)}return Ve}function Y(ke){for(var Fe=1;Fe<arguments.length;Fe++){var Ve=arguments[Fe]!=null?arguments[Fe]:{};Fe%2?K(Object(Ve),!0).forEach(function(ot){ie(ke,ot,Ve[ot])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ke,Object.getOwnPropertyDescriptors(Ve)):K(Object(Ve)).forEach(function(ot){Object.defineProperty(ke,ot,Object.getOwnPropertyDescriptor(Ve,ot))})}return ke}function ie(ke,Fe,Ve){return Fe in ke?Object.defineProperty(ke,Fe,{value:Ve,enumerable:!0,configurable:!0,writable:!0}):ke[Fe]=Ve,ke}function ve(ke,Fe){for(var Ve=0;Ve<Fe.length;Ve++){var ot=Fe[Ve];ot.enumerable=ot.enumerable||!1,ot.configurable=!0,"value"in ot&&(ot.writable=!0),Object.defineProperty(ke,ot.key,ot)}}function re(ke){var Fe={};return ke.reduce(function(Ve,ot){return Fe[ot]||(Fe[ot]=!0,Ve.push(ot)),Ve},[])}function ae(ke,Fe){requestAnimationFrame(function(){Fe.enter(),requestAnimationFrame(function(){Fe.active(),setTimeout(function(){Fe.leave()},ke)})})}function me(ke,Fe){try{var Ve=ke.liElementsById[Fe.parent.id];Ve.classList.contains("treejs-node__close")||Ve.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(Fe,"parent")&&me(ke,Fe.parent)}function ye(ke,Fe){var Ve=ke.liElementsById[Fe.id];Ve.classList.contains("treejs-node__close")&&Ve.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(Fe,"children")&&Fe.children.forEach(function(ot){return ye(ke,ot)})}var Te=function(){function ke(Ye,Ze){(function(tt,Pt){if(!(tt instanceof Pt))throw new TypeError("Cannot call a class as a function")})(this,ke),ce.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=Ye,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},Ze),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(tt){this.setValues(re(tt))}},disables:{get:function(){return this.getDisables()},set:function(tt){this.setDisables(re(tt))}},selectedNodes:{get:function(){var tt=[],Pt=this.nodesById;return Object.keys(Pt).forEach(function(Et){if(Object.prototype.hasOwnProperty.call(Pt,Et)&&(Pt[Et].status===1||Pt[Et].status===2)){var Ne=Y({},Pt[Et]);delete Ne.parent,delete Ne.children,tt.push(Ne)}}),tt}},disabledNodes:{get:function(){var tt=[],Pt=this.nodesById;return Object.keys(Pt).forEach(function(Et){if(Object.prototype.hasOwnProperty.call(Pt,Et)&&Pt[Et].disabled){var Ne=Y({},Pt[Et]);delete Ne.parent,tt.push(Ne)}}),tt}}}),this.init(this.options.data)}var Fe,Ve,ot;return Fe=ke,ot=[{key:"onSwitcherClick",value:function(Ye){var Ze=Ye.parentNode,tt=Ze.lastChild,Pt=tt.scrollHeight;Ze.classList.contains("treejs-node__close")?ae(150,{enter:function(){tt.style.height=0,tt.style.opacity=0},active:function(){tt.style.height="".concat(Pt,"px"),tt.style.opacity=1},leave:function(){tt.style.height="",tt.style.opacity="",Ze.classList.remove("treejs-node__close")}}):ae(150,{enter:function(){tt.style.height="".concat(Pt,"px"),tt.style.opacity=1},active:function(){tt.style.height=0,tt.style.opacity=0},leave:function(){tt.style.height="",tt.style.opacity="",Ze.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(Ye){var Ze,tt=(Ze=Ye,JSON.parse(JSON.stringify(Ze))),Pt={},Et={},Ne=[],et=[];return function wt(Zt,nn){Zt.forEach(function(Vn){Pt[Vn.id]=Vn,Vn.checked&&Ne.push(Vn.id),Vn.disabled&&et.push(Vn.id),nn&&(Vn.parent=nn),Vn.children&&Vn.children.length?wt(Vn.children,Vn):Et[Vn.id]=Vn})}(tt),{treeNodes:tt,nodesById:Pt,leafNodesById:Et,defaultValues:Ne,defaultDisables:et}}},{key:"createRootEle",value:function(){var Ye=document.createElement("div");return Ye.classList.add("treejs"),Ye}},{key:"createUlEle",value:function(){var Ye=document.createElement("ul");return Ye.classList.add("treejs-nodes"),Ye}},{key:"createLiEle",value:function(Ye,Ze){var tt=document.createElement("li");if(tt.classList.add("treejs-node"),Ze&&tt.classList.add("treejs-node__close"),Ye.children&&Ye.children.length){var Pt=document.createElement("span");Pt.classList.add("treejs-switcher"),tt.appendChild(Pt)}else tt.classList.add("treejs-placeholder");var Et=document.createElement("span");Et.classList.add("treejs-checkbox"),tt.appendChild(Et);var Ne=document.createElement("span");Ne.classList.add("treejs-label");var et=document.createTextNode(Ye.text);return Ne.appendChild(et),tt.appendChild(Ne),tt.nodeId=Ye.id,tt}}],(Ve=[{key:"init",value:function(Ye){var Ze=ke.parseTreeData(Ye),tt=Ze.treeNodes,Pt=Ze.nodesById,Et=Ze.leafNodesById,Ne=Ze.defaultValues,et=Ze.defaultDisables;this.treeNodes=tt,this.nodesById=Pt,this.leafNodesById=Et,this.render(this.treeNodes);var wt=this.options,Zt=wt.values,nn=wt.disables,Vn=wt.loaded;Zt&&Zt.length?this.setValues(Zt):Ne&&Ne.length&&this.setValues(Ne),nn&&nn.length?this.setDisables(nn):et&&et.length&&this.setDisables(et),typeof Vn=="function"&&Vn.call(this)}},{key:"render",value:function(Ye){var Ze=ke.createRootEle();Ze.appendChild(this.buildTree(Ye,0)),this.bindEvent(Ze);var tt=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Pt){for(;Pt.firstChild;)Pt.removeChild(Pt.firstChild)})(tt),tt.appendChild(Ze)}},{key:"buildTree",value:function(Ye,Ze){var tt=this,Pt=ke.createUlEle();return Ye&&Ye.length&&Ye.forEach(function(Et){var Ne=ke.createLiEle(Et,Ze===tt.options.closeDepth-1);tt.liElementsById[Et.id]=Ne;var et=null;Et.children&&Et.children.length&&(et=tt.buildTree(Et.children,Ze+1)),et&&Ne.appendChild(et),Pt.appendChild(Ne)}),Pt}},{key:"bindEvent",value:function(Ye){var Ze=this;Ye.addEventListener("click",function(tt){var Pt=tt.target;Pt.nodeName==="SPAN"&&Pt.classList.contains("treejs-checkbox")?Ze.onItemClick(Pt.parentNode.nodeId):Pt.nodeName==="SPAN"&&Pt.classList.contains("treejs-label")?Ze.onItemLabelClick(Pt.parentNode.nodeId):Pt.nodeName==="LI"&&Pt.classList.contains("treejs-node")?Ze.onItemClick(Pt.nodeId):Pt.nodeName==="SPAN"&&Pt.classList.contains("treejs-switcher")&&ke.onSwitcherClick(Pt)},!1)}},{key:"onItemClick",value:function(Ye){var Ze=this.nodesById[Ye],tt=this.options.onChange;Ze.disabled||(this.setValue(Ye),this.updateLiElements()),tt&&tt.call(this)}},{key:"onItemLabelClick",value:function(Ye){var Ze=this.options.onItemLabelClick;Ze&&Ze.call(this,Ye)}},{key:"setValue",value:function(Ye){var Ze=this.nodesById[Ye];if(Ze){var tt=Ze.status,Pt=tt===1||tt===2?0:2;Ze.status=Pt,this.markWillUpdateNode(Ze),this.walkUp(Ze,"status"),this.walkDown(Ze,"status")}}},{key:"getValues",value:function(){var Ye=this,Ze=[];return Object.keys(this.leafNodesById).forEach(function(tt){Object.prototype.hasOwnProperty.call(Ye.leafNodesById,tt)&&(Ye.leafNodesById[tt].status!==1&&Ye.leafNodesById[tt].status!==2||Ze.push(tt))}),Ze}},{key:"setValues",value:function(Ye){var Ze=this;this.emptyNodesCheckStatus(),Ye.forEach(function(Pt){Ze.setValue(Pt)}),this.updateLiElements();var tt=this.options.onChange;tt&&tt.call(this)}},{key:"setDisable",value:function(Ye){var Ze=this.nodesById[Ye];Ze&&(Ze.disabled||(Ze.disabled=!0,this.markWillUpdateNode(Ze),this.walkUp(Ze,"disabled"),this.walkDown(Ze,"disabled")))}},{key:"getDisables",value:function(){var Ye=this,Ze=[];return Object.keys(this.leafNodesById).forEach(function(tt){Object.prototype.hasOwnProperty.call(Ye.leafNodesById,tt)&&Ye.leafNodesById[tt].disabled&&Ze.push(tt)}),Ze}},{key:"setDisables",value:function(Ye){var Ze=this;this.emptyNodesDisable(),Ye.forEach(function(tt){Ze.setDisable(tt)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(Ye){Ye.disabled||(Ye.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(Ye){Ye.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(Ye,Ze){var tt=ue(Ze,2),Pt=tt[0],Et=tt[1];return Et.status!==1&&Et.status!==2||(Ye[Pt]=Et),Ye},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(Ye,Ze){var tt=ue(Ze,2),Pt=tt[0],Et=tt[1];return Et.disabled&&(Ye[Pt]=Et),Ye},{})}},{key:"updateLiElements",value:function(){var Ye=this;Object.values(this.willUpdateNodesById).forEach(function(Ze){Ye.updateLiElement(Ze)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(Ye){this.willUpdateNodesById[Ye.id]=Ye}},{key:"walkUp",value:function(Ye,Ze){var tt=Ye.parent;if(tt){if(Ze==="status"){var Pt,Et=tt.children.reduce(function(et,wt){return Number.isNaN(wt.status)?et:et+wt.status},0);if(Pt=Et?Et===2*tt.children.length?2:1:0,tt.status===Pt)return;tt.status=Pt}else{var Ne=tt.children.reduce(function(et,wt){return et&&wt.disabled},!0);if(tt.disabled===Ne)return;tt.disabled=Ne}this.markWillUpdateNode(tt),this.walkUp(tt,Ze)}}},{key:"walkDown",value:function(Ye,Ze){var tt=this;Ye.children&&Ye.children.length&&Ye.children.forEach(function(Pt){Ze==="status"&&Pt.disabled||(Pt[Ze]=Ye[Ze],tt.markWillUpdateNode(Pt),tt.walkDown(Pt,Ze))})}},{key:"updateLiElement",value:function(Ye){var Ze=this.liElementsById[Ye.id].classList;switch(Ye.status){case 0:Ze.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:Ze.remove("treejs-node__checked"),Ze.add("treejs-node__halfchecked");break;case 2:Ze.remove("treejs-node__halfchecked"),Ze.add("treejs-node__checked")}switch(Ye.disabled){case!0:Ze.contains("treejs-node__disabled")||Ze.add("treejs-node__disabled");break;case!1:Ze.contains("treejs-node__disabled")&&Ze.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var Ye=this;Object.keys(this.leafNodesById).forEach(function(Ze){var tt=Ye.leafNodesById[Ze];me(Ye,tt)})}},{key:"expandAll",value:function(){ye(this,this.treeNodes[0])}}])&&ve(Fe.prototype,Ve),ot&&ve(Fe,ot),Object.defineProperty(Fe,"prototype",{writable:!1}),ke}()}(),_.default}()},8:function(u,r){(function(i){class m{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(ae,me){const ye=this._eventListeners;ye[ae]===void 0&&(ye[ae]=[]),ye[ae].includes(me)||ye[ae].push(me)}hasEventListener(ae,me){const ye=this._eventListeners;return ye[ae]!==void 0&&ye[ae].includes(me)}removeEventListener(ae,me){const ye=this._eventListeners[ae];if(ye!==void 0){const Te=ye.indexOf(me);Te!==-1&&ye.splice(Te,1)}}dispatchEvent(ae){const me=this._eventListeners[ae.type];if(me!==void 0){ae.target=this;const ye=me.slice(0);for(let Te=0,ke=ye.length;Te<ke;Te++)ye[Te].call(this,ae)}}}function _(){return(typeof performance>"u"?Date:performance).now()}class A{constructor(ae=A.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(ae)}setDecayTime(ae){this.naturalFrequency=1/Math.max(A.MIN_DECAY_MILLISECONDS,ae)}update(ae,me,ye,Te){const ke=2e-4*this.naturalFrequency;if(ae==null||Te===0||ae===me&&this.velocity===0)return me;if(ye<0)return ae;const Fe=ae-me,Ve=this.velocity+this.naturalFrequency*Fe,ot=Fe+ye*Ve,Ye=Math.exp(-this.naturalFrequency*ye),Ze=(Ve-this.naturalFrequency*ot)*Ye,tt=-this.naturalFrequency*(Ze+Ve*Ye);return Math.abs(Ze)<ke*Math.abs(Te)&&tt*Fe>=0?(this.velocity=0,me):(this.velocity=Ze,me+ot*Ye)}}async function w(re){return new Promise((ae,me)=>{const ye=new Image;ye.onload=()=>ae(ye),ye.onerror=me,ye.crossOrigin="anonymous",ye.decoding="sync",ye.src=re})}function T(re,ae=document.head){const me=document.createElement("style");return me.type="text/css",me.innerText=re,ae==null||ae.appendChild(me),me}A.SETTLING_TIME=1e4,A.MIN_DECAY_MILLISECONDS=.001,A.DECAY_MILLISECONDS=50;const R={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function D(re){return re.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function U(re,ae,me){return re.replace(new RegExp(D(ae),"g"),me)}const k=(re,...ae)=>String.raw({raw:re},...ae),X=(re,...ae)=>{let me=String.raw({raw:re},...ae);return me=U(me,"%","%25"),me=U(me,"> <","><"),me=U(me,"; }",";}"),me=U(me,"<","%3c"),me=U(me,">","%3e"),me=U(me,'"',"'"),me=U(me,"#","%23"),me=U(me,"{","%7b"),me=U(me,"}","%7d"),me=U(me,"|","%7c"),me=U(me,"^","%5e"),me=U(me,"`","%60"),me=U(me,"@","%40"),me=U(me,"&","&amp;"),me=U(me,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+me};function J(re,ae){const me=window.URL.createObjectURL(re),ye=document.createElement("a");ye.style.display="none",ye.href=me,ye.download=ae,document.body.appendChild(ye),ye.click(),setTimeout(()=>{document.body.removeChild(ye),window.URL.revokeObjectURL(me)},1e3)}async function $(re){return new Promise((ae,me)=>{const ye=new FileReader;ye.onload=Te=>ae(ye.result),ye.onerror=Te=>me(ye.error),ye.onabort=Te=>me(new Error("Read aborted")),ye.readAsDataURL(re)})}function oe(re,ae){let me;do me=Object.getOwnPropertyDescriptor(re,ae);while(!me&&(re=Object.getPrototypeOf(re)));return me}function ne(re,ae,me=!0,ye=!1){const Te=oe(re,ae);return!!(Te!=null&&Te.set)||me&&(Te==null?void 0:Te.writable)!==!1&&(Te==null?void 0:Te.get)===void 0||ye&&!Te}function H(re,ae,me,ye=!0,Te=!1){return!(!re||!ne(re,ae,ye,Te)||(re[ae]=me,0))}function V(re,ae){for(let me=re.length-1;me>=0;me--)if(ae(re[me]))return me;return-1}const z={priority:1/0,serialize:(re,ae)=>Object.fromEntries(Object.entries(re).map(([me,ye])=>[me,ce.Serialize(ye,ae,!1)])),deserialize:(re,ae,me)=>Object.assign(ae||{},Object.fromEntries(Object.entries(re).map(([ye,Te])=>[ye,ce.Deserialize(Te,ae==null?void 0:ae[ye],me,!1)]))),isType:re=>(re.constructor||Object)===Object};class ce{static GetSerializer(ae){return ce.Serializers.find(me=>me.isType(ae))}static RegisterSerializer(...ae){var me;for(const ye of ae){const Te=(me=ye.priority)!==null&&me!==void 0?me:1e10,ke=V(ce.Serializers,Fe=>Fe.priority!==void 0&&Fe.priority<Te);ke>=0?ce.Serializers.splice(ke+1,0,ye):ce.Serializers.push(ye)}}static UnregisterSerializer(...ae){for(const me of ae){const ye=ce.Serializers.indexOf(me);ye>=0&&ce.Serializers.splice(ye,1)}}static Serialize(ae,me,ye=!1){var Te,ke;if(typeof ae=="function")return;if(!ye){const ot=ce.GetSerializer(ae);if(ot)return ot.serialize(ae,me);if(typeof ae.toJSON=="function"){const Ye=ae.toJSON(me);return ae.serializableClassId&&Ye&&(Ye.serializableClassId=ae.serializableClassId),Ye}}let Fe=(Te=ae.constructor)!==null&&Te!==void 0?Te:Object;const Ve={};for(;Fe&&Fe!==Object;){const ot=(ke=ce.TypeMap.get(Fe))!==null&&ke!==void 0?ke:[];for(const[Ye,Ze]of ot)Ve[Ye]=ce.Serialize(ae[Ze],me,!1);Fe=Object.getPrototypeOf(Fe)}return ae.serializableClassId&&(Ve.serializableClassId=ae.serializableClassId),Ve}static Deserialize(ae,me,ye,Te=!1){var ke,Fe;if(ae===void 0||me===ae)return me;if(ae&&typeof ae=="object"&&(ae.constructor||Object)===Object&&ae.resource&&typeof ae.resource=="string"&&ae.uuid){const ot=ye==null?void 0:ye[ae.resource];if(!ot)return console.warn(`Resource ${ae.resource} not found`),me;if(typeof(ae=ot[ae.uuid])=="object"&&(ae.__useCount=ae.__useCount?ae.__useCount+1:1),ae||console.warn(`Resource ${ae.resource} with uuid ${ae.uuid} not found`),me===ae)return me;if(ae&&typeof ae=="object"){if((ae.constructor||Object)!==Object)return me&&console.warn("replacing object",me,"with deserialized object from meta",ae),ae;console.error("Deserialize; meta should only have class instances, not js objects",ae,me,ye)}}if(ae&&typeof ae=="object"&&(ae.constructor||Object)!==Object&&!Array.isArray(ae)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",ae,"source",me,ae.constructor,ae.constructor!==Object),ae&&typeof ae=="object")if(!ae.serializableClassId||me&&me.serializableClassId===ae.serializableClassId)(ae.constructor||Object)!==Object||me?Array.isArray(ae)&&!me&&(me=[]):me={};else{const ot=ce.SerializableClasses.get(ae.serializableClassId);ot&&(me=ot.DataInConstructor?new ot(ae):new ot)}if(typeof me=="function")return console.error("cannot deserialize over function",me,ae),me;if(!Te){const ot=ce.GetSerializer(ae);if(ot&&ot!==z)return ot.deserialize(ae,me,ye)}if(!ae||me==null||typeof me!="object")return ae;if(!Te&&typeof(me==null?void 0:me.fromJSON)=="function")return me.fromJSON(ae,ye),me;let Ve=(ke=me.constructor)!==null&&ke!==void 0?ke:Object;if(Ve===Object)return z.deserialize(ae,me,ye);for(;Ve&&Ve!==Object;){const ot=(Fe=ce.TypeMap.get(Ve))!==null&&Fe!==void 0?Fe:[];for(const[Ye,Ze]of ot){const tt=me[Ze],Pt=ce.Deserialize(ae[Ye],tt,ye,!1);Pt!==tt&&H(me,Ze,Pt,!0)}Ve=Object.getPrototypeOf(Ve)}return me}}function ue(re,ae="param"){if(!re)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(me,ye)=>{Object.defineProperty(me,ye,{get(){return this[`_oc_${ye}`]},set(Te){var ke;const Fe=this[`_oc_${ye}`];if(Fe===Te)return;this[`_oc_${ye}`]=Te;const Ve=ae==="param"?[ye,Te,Fe]:ae==="object"?[{key:ye,value:Te,oldValue:Fe}]:"";if(typeof re=="string")(ke=this[re])===null||ke===void 0||ke.call(this,...Ve);else if(typeof re=="function"){let ot=!1;if(re.name){let Ye=this;for(;Ye;){if(Ye[re.name]===re){re.call(this,...Ve),ot=!0;break}Ye=Object.getPrototypeOf(Ye)}}ot||(re.name&&this[re.name].name===`bound ${re.name}`?this[re.name](...Ve):re(...Ve))}}})}}function he(re,{backgroundColor:ae="",scale:me=1,width:ye=512,height:Te=512}){const ke=document.createElement("canvas"),Fe=ke.getContext("2d"),Ve=me,ot=ye,Ye=Te;return ke.width=ot*Ve,ke.height=Ye*Ve,ke.style.width=`${ot}`,ke.style.height=`${Ye}`,(ae==null?void 0:ae.length)>0&&(Fe.fillStyle=ae,Fe.fillRect(0,0,ke.width,ke.height)),Fe.drawImage(re,0,0,ke.width,ke.height),ke}ce.TypeMap=new Map,ce.SerializableClasses=new Map,ce.Serializers=[{priority:0,isType:re=>Array.isArray(re),serialize:(re,ae)=>re.map(me=>ce.Serialize(me,ae,!1)),deserialize:(re,ae,me)=>{const ye=re.length;Array.isArray(ae)||(ae=[]);for(let Te=0;Te<ye;Te++){const ke=re[Te],Fe=ae.length>Te?ce.Deserialize(ke,ae[Te],me,!1):ce.Deserialize(ke,void 0,me,!1);ae.length<=Te?ae.push(Fe):ae[Te]=Fe}return ae}},{priority:0,isType:re=>!re||typeof re!="object",serialize:re=>{if(re&&typeof re=="number"){if(re===1/0)return"Infinity";if(re===-1/0)return"-Infinity";if(isNaN(re))return"NaN"}return re},deserialize:(re,ae)=>{if(typeof ae=="number"){if(re==="Infinity")return 1/0;if(re==="-Infinity")return-1/0;if(re==="NaN")return NaN;if(typeof re=="number"||!re)return re}return re}},z];const K=async(re,ae)=>he(await w(re),ae),Y=async(re,ae)=>await K(re,ae).then(me=>me.toDataURL("image/png")),ie=async re=>$(await(await fetch(re)).blob());function ve(re,ae,{width:me,height:ye},Te=!0){const ke=`
<svg viewBox="0 0 ${me} ${ye}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${ae}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${re}
        </div>
    </foreignObject>
</svg>
    `;return Te?X(ke):ke}i.Damper=A,i.LinearToSRGB=function(re){return re<.0031308?12.92*re:1.055*Math.pow(re,.41666)-.055},i.PointerDragHelper=class extends m{constructor(){super(...arguments),this._onPointerDown=re=>{if(re.button!==0||!this._element)return;this._pointerUp=void 0;const ae=re.clientX/this._element.clientWidth*2-1,me=-re.clientY/this._element.clientHeight*2+1,ye=_();this._pointerDown={x:ae,y:me,time:ye},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=re=>{if(!this._pointerDown||!this._pointer||!this._element)return;const ae=re.clientX/this._element.clientWidth*2-1,me=-re.clientY/this._element.clientHeight*2+1,ye=_();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:ae-this._pointerDown.x,y:me-this._pointerDown.y,time:ye-this._pointerDown.time},delta:{x:ae-this._pointer.x,y:me-this._pointer.y,time:ye-this._pointer.time}}),this._pointer={x:ae,y:me,time:_()},re.buttons%2==0&&this._onPointerUp(re)},this._onPointerUp=re=>{if(re.button!==0||!this._pointerDown||!this._element)return;const ae=re.clientX/this._element.clientWidth*2-1,me=-re.clientY/this._element.clientHeight*2+1,ye=_();this._pointerUp={x:ae,y:me,time:ye},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(re){this._element!==re&&(this._element&&this._removeElement(),this._element=re,this._element&&this._addElement())}_removeElement(){var re,ae,me,ye,Te;(re=this._element)===null||re===void 0||re.removeEventListener("pointerdown",this._onPointerDown),(ae=this._element)===null||ae===void 0||ae.removeEventListener("pointermove",this._onPointerMove),(me=this._element)===null||me===void 0||me.removeEventListener("pointerup",this._onPointerUp),(ye=this._element)===null||ye===void 0||ye.removeEventListener("pointercancel",this._onPointerUp),(Te=this._element)===null||Te===void 0||Te.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var re,ae,me,ye,Te;(re=this._element)===null||re===void 0||re.addEventListener("pointerdown",this._onPointerDown),(ae=this._element)===null||ae===void 0||ae.addEventListener("pointermove",this._onPointerMove),(me=this._element)===null||me===void 0||me.addEventListener("pointerup",this._onPointerUp),(ye=this._element)===null||ye===void 0||ye.addEventListener("pointercancel",this._onPointerUp),(Te=this._element)===null||Te===void 0||Te.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},i.SRGBToLinear=function(re){return re<.04045?.0773993808*re:Math.pow(.9478672986*re+.0521327014,2.4)},i.Serialization=ce,i.SimpleEventDispatcher=m,i.TYPED_ARRAYS=R,i.absMax=function(re,ae){return Math.abs(re)>Math.abs(ae)?re:ae},i.aesGcmDecrypt=async function(re,ae){const me=typeof ae=="string"?new TextEncoder().encode(ae):ae,ye=await crypto.subtle.digest("SHA-256",me),Te=re.slice(0,12),ke={name:"AES-GCM",iv:typeof Te=="string"?new Uint8Array(Array.from(Te).map(Ye=>Ye.charCodeAt(0))):Te},Fe=await crypto.subtle.importKey("raw",ye,ke,!1,["decrypt"]),Ve=re.slice(12),ot=typeof Ve=="string"?new Uint8Array(Array.from(Ve).map(Ye=>Ye.charCodeAt(0))):Ve;try{const Ye=await crypto.subtle.decrypt(ke,Fe,ot);return typeof re=="string"?new TextDecoder().decode(Ye):new Uint8Array(Ye)}catch{throw new Error("Decrypt failed")}},i.aesGcmEncrypt=async function(re,ae,me){const ye=typeof ae=="string"?new TextEncoder().encode(ae):ae,Te=await crypto.subtle.digest("SHA-256",ye),ke=crypto.getRandomValues(new Uint8Array(12)),Fe=Array.from(ke).map(wt=>String.fromCharCode(wt)).join(""),Ve={name:"AES-GCM",iv:ke},ot=await crypto.subtle.importKey("raw",Te,Ve,!1,["encrypt"]),Ye=typeof re=="string"?new TextEncoder().encode(re):re,Ze=await crypto.subtle.encrypt(Ve,ot,Ye),tt=new Uint8Array(Ze),Pt=Array.from(tt),Et=Pt.map(wt=>String.fromCharCode(wt)).join(""),Ne=me?typeof me=="string"?me:new TextDecoder().decode(me):"",et=me?typeof me=="string"?new TextEncoder().encode(me):Array.from(me):[];return typeof re=="string"?Ne+Fe+Et:new Uint8Array([...et,...ke,...Pt])},i.arrayBufferToBase64=function(re){if(!window)return console.warn("window is required"),"";let ae="";const me=new Uint8Array(re),ye=me.byteLength;for(let Te=0;Te<ye;Te++)ae+=String.fromCharCode(me[Te]);return window.btoa(ae)},i.base64ToArrayBuffer=function(re){if(!window)return console.warn("window is required"),new Uint8Array(0);const ae=window.atob(re),me=ae.length,ye=new Uint8Array(me);for(let Te=0;Te<me;Te++)ye[Te]=ae.charCodeAt(Te);return ye.buffer},i.blobToDataURL=$,i.canvasFlipY=function(re){const ae=document.createElement("canvas");ae.width=re.width,ae.height=re.height;const me=ae.getContext("2d");if(!me)throw new Error("Unable to get 2d context");return me.translate(0,re.height),me.scale(1,-1),me.drawImage(re,0,0),ae},i.clearBit=function(re,ae){return re&~(1<<ae)},i.colorToDataUrl=function(re,ae=1,me=1){const ye=document.createElement("canvas");ye.width=ae,ye.height=me;const Te=ye.getContext("2d");Te.fillStyle="#"+re,Te.fillRect(0,0,ae,me);const ke=ye.toDataURL();return ye.remove(),ke},i.copyProps=function(re,ae,me){for(const ye of me){const Te=re[ye];Te!==void 0&&H(ae,ye,Te,!0)}return ae},i.createCanvasElement=function(){const re=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return re.style.display="block",re},i.createDiv=function({innerHTML:re="",id:ae,classList:me,addToBody:ye=!0,elementTag:Te="div"}){const ke=document.createElement(Te);return ae&&(ke.id=ae),ke.innerHTML=re,me&&ke.classList.add(...me),ye&&document.body.appendChild(ke),ke},i.createImage=w,i.createScriptFromURL=async function(re,ae=document.head){return new Promise((me,ye)=>{const Te=document.createElement("script");Te.setAttribute("src",re),Te.addEventListener("load",()=>me(Te)),Te.addEventListener("error",ye),ae.appendChild(Te)})},i.createStyles=T,i.css=k,i.deepAccessObject=function(re,ae,me=!1){for(typeof re=="string"&&(re=re.split("."));re.length>0;){if(!ae)return;const ye=re.splice(0,1)[0];if(!(ye.length<1)){if(!(ye in ae)){if(me)throw new Error("invalid access, check "+ye+" in "+ae);return}ae=ae[ye]}}return ae},i.downloadBlob=J,i.downloadFile=function(re,ae){return J(re,ae??re.name)},i.embedUrlRefs=async function(re,ae=ie){const me=re.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(me)for(const ye of me){const Te=await ae(ye);re=re.replace(ye,Te)}return re},i.escapeRegExp=D,i.getFileHandle=function(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(re=>re[0]):window.chooseFileSystemEntries()},i.getFilenameFromPath=function(re){return re.substring(re.lastIndexOf("/")+1)},i.getKeyByValue=function(re,ae){return Object.keys(re).find(me=>re[me]===ae)},i.getNewFileHandle=function(){if("showSaveFilePicker"in window){const re={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(re)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})},i.getOrCall=function(re,...ae){return typeof re=="function"&&(re=re(...ae)),re},i.getPropertyDescriptor=oe,i.getTypedArray=function(re,ae){return new R[re](ae)},i.getUrlQueryParam=function(re,ae=null){var me;return(me=new URL(window.location.href).searchParams.get(re))!==null&&me!==void 0?me:ae},i.glsl=(re,...ae)=>String.raw({raw:re},...ae),i.html=(re,...ae)=>String.raw({raw:re},...ae),i.htmlToCanvas=async function(re,ae,me){const ye=ve(re,ae,me);return await K(ye,me)},i.htmlToPng=async function(re,ae,me){const ye=ve(re,ae,me);return await Y(ye,me)},i.htmlToSvg=ve,i.imageBitmapToBase64=function(re,ae=8192,me=!1){var ye;if(!re.width||!re.height)return"";const Te=document.createElement("canvas");Te.width=Math.min(ae,re.width),Te.height=Math.floor(1+Te.width*re.height/re.width);const ke=re instanceof ImageBitmap,Fe=ke&&me&&Math.abs(Te.width-re.width)<.5?Te.getContext("bitmaprenderer"):void 0;Fe?Fe.transferFromImageBitmap(re):(ye=Te.getContext("2d"))===null||ye===void 0||ye.drawImage(re,0,0,Te.width,Te.height);const Ve=Te.toDataURL("image/png");return Te.remove(),ke&&me&&re.close(),Ve},i.imageDataToCanvas=function(re){const ae=document.createElement("canvas");return ae.width=re.width,ae.height=re.height,ae.getContext("2d").putImageData(re,0,0),ae},i.imageToCanvas=he,i.imageUrlToImageData=async function(re){return new Promise((ae,me)=>{const ye=new Image;ye.addEventListener("load",()=>{const Te=document.createElement("canvas");Te.width=ye.width,Te.height=ye.height;const ke=Te.getContext("2d");if(!ke)return void me(new Error("Could not get 2d context"));ke.drawImage(ye,0,0,Te.width,Te.height);const Fe=ke.getImageData(0,0,Te.width,Te.height);ae(Fe),Te.remove(),ye.remove()},!1),ye.addEventListener("error",Te=>{ye.remove(),me(Te)},!1),ye.src=re})},i.includesAll=function(re,ae){for(const me of ae)if(!re.includes(me))return!1;return!0},i.isPropertyWritable=ne,i.isWebpExportSupported=function(){const re=document.createElement("canvas");return!(!re.getContext||!re.getContext("2d"))&&re.toDataURL("image/webp").startsWith("data:image/webp")},i.longestCommonPrefix=function(re){return re.sort(),re[0].split("").map((ae,me)=>re[re.length-1][me]===ae?ae:"\0").join("").split("\0").at(0)||""},i.makeColorSvg=re=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${re}'/%3E%3C/svg%3E%0A`,i.makeColorSvgCircle=re=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${re}'/%3E%3C/svg%3E%0A`,i.makeTextSvg=re=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${re}%3C/text%3E%3C/svg%3E%0A`,i.mobileAndTabletCheck=function(){let re=!1;var ae;return ae=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(ae)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ae.substr(0,4)))&&(re=!0),re},i.now=_,i.objectHasOwn=function(re,ae){return Object.hasOwn?Object.hasOwn(re,ae):re.hasOwnProperty(ae)},i.onChange=ue,i.onChange2=function(re,ae="void"){if(!re)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return ue(re,ae)},i.onChange3=function(re,ae="object"){if(!re)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return ue(re,ae)},i.parseFileExtension=function(re){var ae;if(!re||re===""||re.match(/__MACOSX\/.*\._/))return"";const me=(ae=(re=re.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&ae!==void 0?ae:"",ye=me.lastIndexOf(".");return me===""||ye<1?"":me.slice(ye+1)},i.pathJoin=function(re,ae="/"){return re.join(ae)},i.prettyScrollbar=function(re=document.head){return T(k`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,re)},i.readFile=function(re){return re.text?re.text():function(ae){return new Promise(me=>{const ye=new FileReader;ye.addEventListener("loadend",Te=>{const ke=Te.srcElement.result;me(ke)}),ye.readAsText(ae)})}(re)},i.remoteWorkerURL=function(re,ae){const me=(ae?`var Module = { locateFile: function(s) { return "${ae}"; } }; 
`:"")+`importScripts( "${re}" );`;return URL.createObjectURL(new Blob([me],{type:"text/javascript"}))},i.replaceAll=U,i.safeSetProperty=H,i.serializable=function(re){return ae=>(ae=class extends ae{constructor(){super(...arguments),this.serializableClassId=re}},ce.SerializableClasses.set(re,ae),ae)},i.serialize=function(re){return(ae,me)=>{const ye=ae.constructor;if(ye===Object)throw new Error("All properties in an object are serialized by default");ce.TypeMap.has(ye)||ce.TypeMap.set(ye,[]),ce.TypeMap.get(ye).push([re||me,me])}},i.setUrlQueryParam=function(re,ae,me=!1){const ye=new URLSearchParams(location.search);ae==null?ye.has(re)&&ye.delete(re):ye.set(re,ae),me?window.location.search=ye.toString():window.history.replaceState({},"","?"+ye.toString())},i.svgToCanvas=K,i.svgToPng=Y,i.svgUrl=X,i.timeout=async function(re){return new Promise(ae=>setTimeout(ae,Math.max(0,re)))},i.toTitleCase=function(re){return re.replace(/\w\S*/g,function(ae){return ae.charAt(0).toUpperCase()+ae.substr(1).toLowerCase()})},i.updateBit=function(re,ae,me){return re&~(1<<ae)|(me?1:0)<<ae},i.uploadFile=async function(re=!1,ae=!1,me){const ye=document.createElement("input");ye.type="file",ye.multiple=re,ye.accept=me||"*",ye.webkitdirectory=ae,ye.style.display="none",document.body.appendChild(ye),ye.click();const Te=await new Promise(ke=>{ye.onchange=Fe=>{ke(Array.from(ye.files||[]))}});return document.body.removeChild(ye),Te},i.verifyPermission=async function(re,ae){const me={};return ae&&(me.writable=!0,me.mode="readwrite"),await re.queryPermission(me)==="granted"||await re.requestPermission(me)==="granted"},i.writeFile=async function(re,ae){if(re.createWriter){const ye=await re.createWriter();return await ye.write(0,ae),void await ye.close()}const me=await re.createWritable();await me.write(ae),await me.close()}})(r)},819:function(u,r){(function(i){const m="tp";function _(he){return K=>Y=>{if(!K&&Y===void 0)return{succeeded:!1,value:void 0};if(K&&Y===void 0)return{succeeded:!0,value:void 0};const ie=he(Y);return ie!==void 0?{succeeded:!0,value:ie}:{succeeded:!1,value:void 0}}}function A(he){return{custom:K=>_(K)(he),boolean:_(K=>typeof K=="boolean"?K:void 0)(he),number:_(K=>typeof K=="number"?K:void 0)(he),string:_(K=>typeof K=="string"?K:void 0)(he),function:_(K=>typeof K=="function"?K:void 0)(he),constant:K=>_(Y=>Y===K?K:void 0)(he),raw:_(K=>K)(he),object:K=>_(Y=>{if((ie=Y)!==null&&typeof ie=="object")return function(ve,re){return Object.keys(re).reduce((ae,me)=>{if(ae===void 0)return;const ye=(0,re[me])(ve[me]);return ye.succeeded?Object.assign(Object.assign({},ae),{[me]:ye.value}):void 0},{})}(Y,K);var ie})(he),array:K=>_(Y=>{if(Array.isArray(Y))return ie=K,Y.reduce((ve,re)=>{if(ve===void 0)return;const ae=ie(re);return ae.succeeded&&ae.value!==void 0?[...ve,ae.value]:void 0},[]);var ie})(he)}}const w={optional:A(!0),required:A(!1)};function T(he){return K=>K.toFixed(Math.max(Math.min(he,20),0))}function R(he){return[he[0],he[1],he[2]]}function D(he){return K=>function(Y,ie){const ve=T(ie==="float"?2:0);return`rgb(${R(Y.getComponents("rgb",ie)).map(re=>ve(re)).join(", ")})`}(K,he)}function U(he){return K=>function(Y,ie){const ve=T(2),re=T(ie==="float"?2:0);return`rgba(${Y.getComponents("rgb",ie).map((ae,me)=>(me===3?ve:re)(ae)).join(", ")})`}(K,he)}function k(he){return K=>function(Y,ie){const ve=T(ie==="float"?2:0),re=["r","g","b"];return`{${R(Y.getComponents("rgb",ie)).map((ae,me)=>`${re[me]}: ${ve(ae)}`).join(", ")}}`}(K,he)}function X(he){return K=>function(Y,ie){const ve=T(2),re=T(ie==="float"?2:0),ae=["r","g","b","a"];return`{${Y.getComponents("rgb",ie).map((me,ye)=>`${ae[ye]}: ${(ye===3?ve:re)(me)}`).join(", ")}}`}(K,he)}function J(he,K,Y,ie){return new(Y||(Y=Promise))(function(ve,re){function ae(Te){try{ye(ie.next(Te))}catch(ke){re(ke)}}function me(Te){try{ye(ie.throw(Te))}catch(ke){re(ke)}}function ye(Te){var ke;Te.done?ve(Te.value):(ke=Te.value,ke instanceof Y?ke:new Y(function(Fe){Fe(ke)})).then(ae,me)}ye((ie=ie.apply(he,K||[])).next())})}function $(he){return J(this,void 0,void 0,function*(){const K=new Image;return K.crossOrigin="anonymous",new Promise((Y,ie)=>{K.src=he,K.onload=()=>{Y(K)},K.onerror=ie})})}["int","float"].reduce((he,K)=>[...he,{format:{alpha:!1,mode:"rgb",notation:"func",type:K},stringifier:D(K)},{format:{alpha:!0,mode:"rgb",notation:"func",type:K},stringifier:U(K)},{format:{alpha:!1,mode:"rgb",notation:"object",type:K},stringifier:k(K)},{format:{alpha:!0,mode:"rgb",notation:"object",type:K},stringifier:X(K)}],[]);const oe=(ne="img",(he,K)=>[m,"-",ne,"v",he?`_${he}`:"",K?`-${K}`:""].join(""));var ne;class H{constructor(K,Y){this.element=K.createElement("div"),this.element.classList.add(oe()),Y.viewProps.bindClassModifiers(this.element),this.input=K.createElement("input"),this.input.classList.add(oe("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",Y.extensions.join(",")),this.image_=K.createElement("img"),this.image_.classList.add(oe("image")),this.image_.classList.add(oe(`image_${Y.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=ie=>{Y.clickCallback?Y.clickCallback(ie,this.input):this.input.click()},this.element.classList.add(oe("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(K){this.image_.src=K}changeDraggingState(K){const Y=this.element;K?Y==null||Y.classList.add(oe("area_dragging")):Y==null||Y.classList.remove(oe("area_dragging"))}}let V=null;class z{constructor(K,Y){this.value=Y.value,this.viewProps=Y.viewProps,this.view=new H(K,{viewProps:this.viewProps,extensions:Y.extensions,imageFit:Y.imageFit,clickCallback:Y.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(K){const Y=(K==null?void 0:K.target).files;if(!Y||!Y.length)return;const ie=Y[0];this.setValue(ie)}onDrop(K){return J(this,void 0,void 0,function*(){K.preventDefault();try{const{dataTransfer:Y}=K,ie=Y==null?void 0:Y.files[0];if(ie)this.setValue(ie);else{const ve=Y==null?void 0:Y.getData("url");if(!ve)throw new Error("No url");this.setValue(ve)}}catch(Y){console.error("Could not parse the dropped image",Y)}finally{this.view.changeDraggingState(!1)}})}onDragOver(K){K.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(K){return J(this,void 0,void 0,function*(){K instanceof HTMLImageElement?this.updateImage(K.src):typeof K!="string"&&K?yield this.setValue(K):(K!=="placeholder"&&K||(K=(yield this.handlePlaceholderImage()).src),this.updateImage(K))})}updateImage(K){this.view.changeImage(K)}setValue(K){return J(this,void 0,void 0,function*(){if(K instanceof HTMLImageElement)this.value.setRawValue(K);else if(K instanceof File){const Y=URL.createObjectURL(K)+"#"+K.name;K.src=Y;const ie=yield $(Y).catch(()=>{});this.value.setRawValue(ie||K)}else K?this.value.setRawValue(yield $(K)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return J(this,void 0,void 0,function*(){return V||(V=yield function(){const K=document.createElement("canvas");K.width=320,K.height=50;const Y=K.getContext("2d");return Y.fillStyle="#00000004",Y.fillRect(0,0,K.width,K.height),Y.fillStyle="#eee",Y.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',Y.textAlign="center",Y.textBaseline="middle",Y.fillText("No image",.5*K.width,.5*K.height),new Promise(ie=>{K.toBlob(ve=>{const re=new Image;re.src=URL.createObjectURL(ve),re.isPlaceholder=!0,re.onload=()=>{ie(re)}})})}()),V})}}const ce=[".jpg",".png",".gif"],ue={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(he,K){if(!(he instanceof HTMLImageElement||typeof he=="string"))return null;const Y=w,ie=function(ve,re){const ae=w.required.object(re)(ve);return ae.succeeded?ae.value:void 0}(K,{view:Y.required.constant("input-image"),acceptUrl:Y.optional.boolean,clickCallback:Y.optional.function,imageFit:Y.optional.custom(ve=>ve==="contain"||ve==="cover"?ve:void 0),extensions:Y.optional.array(Y.required.string)});return ie?{initialValue:he,params:ie}:null},binding:{reader(he){return K=>K.src!==void 0?K.src===""?"placeholder":K.src:K},writer(he){return(K,Y)=>{K.write(Y)}}},controller(he){var K,Y;return new z(he.document,{value:he.value,imageFit:(K=he.params.imageFit)!==null&&K!==void 0?K:"cover",clickCallback:he.params.clickCallback,viewProps:he.viewProps,extensions:(Y=he.params.extensions)!==null&&Y!==void 0?Y:ce})}};i.plugin=ue,Object.defineProperty(i,"__esModule",{value:!0})})(r)},665:function(u,r){(function(i){class m{constructor(M){this.controller_=M}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(M){this.controller_.viewProps.set("disabled",M)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(M){this.controller_.viewProps.set("hidden",M)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class _{constructor(M){this.target=M}}class A extends _{constructor(M,N,le,Ie){super(M),this.value=N,this.presetKey=le,this.last=Ie==null||Ie}}class w extends _{constructor(M,N,le){super(M),this.value=N,this.presetKey=le}}class T extends _{constructor(M,N){super(M),this.expanded=N}}class R extends _{constructor(M,N){super(M),this.index=N}}function D(ee){return ee==null}function U(ee,M){if(ee.length!==M.length)return!1;for(let N=0;N<ee.length;N++)if(ee[N]!==M[N])return!1;return!0}function k(ee,M){let N=ee;do{const le=Object.getOwnPropertyDescriptor(N,M);if(le&&(le.set!==void 0||le.writable===!0))return!0;N=Object.getPrototypeOf(N)}while(N!==null);return!1}const X={alreadydisposed:()=>"View has been already disposed",invalidparams:ee=>`Invalid parameters for '${ee.name}'`,nomatchingcontroller:ee=>`No matching controller for '${ee.key}'`,nomatchingview:ee=>`No matching view for '${JSON.stringify(ee.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:ee=>`Property '${ee.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class J{static alreadyDisposed(){return new J({type:"alreadydisposed"})}static notBindable(){return new J({type:"notbindable"})}static propertyNotFound(M){return new J({type:"propertynotfound",context:{name:M}})}static shouldNeverHappen(){return new J({type:"shouldneverhappen"})}constructor(M){var N;this.message=(N=X[M.type](M.context))!==null&&N!==void 0?N:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=M.type}}class ${constructor(M,N,le){this.obj_=M,this.key_=N,this.presetKey_=le??N}static isBindable(M){return M!==null&&typeof M=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(M){this.obj_[this.key_]=M}writeProperty(M,N){const le=this.read();if(!$.isBindable(le))throw J.notBindable();if(!(M in le))throw J.propertyNotFound(M);le[M]=N}}class oe extends m{get label(){return this.controller_.props.get("label")}set label(M){this.controller_.props.set("label",M)}get title(){var M;return(M=this.controller_.valueController.props.get("title"))!==null&&M!==void 0?M:""}set title(M){this.controller_.valueController.props.set("title",M)}on(M,N){const le=N.bind(this);return this.controller_.valueController.emitter.on(M,()=>{le(new _(this))}),this}}class ne{constructor(){this.observers_={}}on(M,N){let le=this.observers_[M];return le||(le=this.observers_[M]=[]),le.push({handler:N}),this}off(M,N){const le=this.observers_[M];return le&&(this.observers_[M]=le.filter(Ie=>Ie.handler!==N)),this}emit(M,N){const le=this.observers_[M];le&&le.forEach(Ie=>{Ie.handler(N)})}}const H="tp";function V(ee){return(M,N)=>[H,"-",ee,"v",M?`_${M}`:"",N?`-${N}`:""].join("")}function z(ee){return ee.rawValue}function ce(ee,M){var N,le;ee.emitter.on("change",(N=z,le=M,Ie=>le(N(Ie)))),M(ee.rawValue)}function ue(ee,M,N){ce(ee.value(M),N)}function he(ee,M){return N=>{(function(le,Ie,ct){ct?le.classList.add(Ie):le.classList.remove(Ie)})(ee,M,N)}}function K(ee,M){ce(ee,N=>{M.textContent=N??""})}const Y=V("btn");class ie{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(Y()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("button");le.classList.add(Y("b")),N.viewProps.bindDisabled(le),this.element.appendChild(le),this.buttonElement=le;const Ie=M.createElement("div");Ie.classList.add(Y("t")),K(N.props.value("title"),Ie),this.buttonElement.appendChild(Ie)}}class ve{constructor(M,N){this.emitter=new ne,this.onClick_=this.onClick_.bind(this),this.props=N.props,this.viewProps=N.viewProps,this.view=new ie(M,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class re{constructor(M,N){var le;this.constraint_=N==null?void 0:N.constraint,this.equals_=(le=N==null?void 0:N.equals)!==null&&le!==void 0?le:(Ie,ct)=>Ie===ct,this.emitter=new ne,this.rawValue_=M}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(M){this.setRawValue(M,{forceEmit:!1,last:!0})}setRawValue(M,N){const le=N??{forceEmit:!1,last:!0},Ie=this.constraint_?this.constraint_.constrain(M):M,ct=this.rawValue_;(!this.equals_(ct,Ie)||le.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Ie,this.emitter.emit("change",{options:le,previousRawValue:ct,rawValue:Ie,sender:this}))}}class ae{constructor(M){this.emitter=new ne,this.value_=M}get rawValue(){return this.value_}set rawValue(M){this.setRawValue(M,{forceEmit:!1,last:!0})}setRawValue(M,N){const le=N??{forceEmit:!1,last:!0},Ie=this.value_;(Ie!==M||le.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=M,this.emitter.emit("change",{options:le,previousRawValue:Ie,rawValue:this.value_,sender:this}))}}function me(ee,M){const N=M==null?void 0:M.constraint,le=M==null?void 0:M.equals;return N||le?new re(ee,M):new ae(ee)}class ye{constructor(M){this.emitter=new ne,this.valMap_=M;for(const N in this.valMap_)this.valMap_[N].emitter.on("change",()=>{this.emitter.emit("change",{key:N,sender:this})})}static createCore(M){return Object.keys(M).reduce((N,le)=>Object.assign(N,{[le]:me(M[le])}),{})}static fromObject(M){const N=this.createCore(M);return new ye(N)}get(M){return this.valMap_[M].rawValue}set(M,N){this.valMap_[M].rawValue=N}value(M){return this.valMap_[M]}}function Te(ee){return M=>N=>{if(!M&&N===void 0)return{succeeded:!1,value:void 0};if(M&&N===void 0)return{succeeded:!0,value:void 0};const le=ee(N);return le!==void 0?{succeeded:!0,value:le}:{succeeded:!1,value:void 0}}}function ke(ee){return{custom:M=>Te(M)(ee),boolean:Te(M=>typeof M=="boolean"?M:void 0)(ee),number:Te(M=>typeof M=="number"?M:void 0)(ee),string:Te(M=>typeof M=="string"?M:void 0)(ee),function:Te(M=>typeof M=="function"?M:void 0)(ee),constant:M=>Te(N=>N===M?M:void 0)(ee),raw:Te(M=>M)(ee),object:M=>Te(N=>{if((le=N)!==null&&typeof le=="object")return function(Ie,ct){return Object.keys(ct).reduce((yt,on)=>{if(yt===void 0)return;const ei=(0,ct[on])(Ie[on]);return ei.succeeded?Object.assign(Object.assign({},yt),{[on]:ei.value}):void 0},{})}(N,M);var le})(ee),array:M=>Te(N=>{if(Array.isArray(N))return le=M,N.reduce((Ie,ct)=>{if(Ie===void 0)return;const yt=le(ct);return yt.succeeded&&yt.value!==void 0?[...Ie,yt.value]:void 0},[]);var le})(ee)}}const Fe={optional:ke(!0),required:ke(!1)};function Ve(ee,M){const N=Fe.required.object(M)(ee);return N.succeeded?N.value:void 0}function ot(ee){console.warn([`Missing '${ee.key}' of ${ee.target} in ${ee.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class Ye{constructor(M){this.value_=M}static create(M){return[new Ye(M),(N,le)=>{M.setRawValue(N,le)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const Ze=V("");function tt(ee,M){return he(ee,Ze(void 0,M))}class Pt extends ye{constructor(M){var N;super(M),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=Ye.create(me(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(N=this.get("parent"))===null||N===void 0||N.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(M){var N,le,Ie;const ct=M??{};return new Pt(ye.createCore({disabled:(N=ct.disabled)!==null&&N!==void 0&&N,disposed:!1,hidden:(le=ct.hidden)!==null&&le!==void 0&&le,parent:(Ie=ct.parent)!==null&&Ie!==void 0?Ie:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(M){ce(this.globalDisabled_,tt(M,"disabled")),ue(this,"hidden",tt(M,"hidden"))}bindDisabled(M){ce(this.globalDisabled_,N=>{M.disabled=N})}bindTabIndex(M){ce(this.globalDisabled_,N=>{M.tabIndex=N?-1:0})}handleDispose(M){this.value("disposed").emitter.on("change",N=>{N&&M()})}getGlobalDisabled_(){const M=this.get("parent");return!!M&&M.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(M){var N;const le=M.previousRawValue;le==null||le.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(N=this.get("parent"))===null||N===void 0||N.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Et=V(""),Ne={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class et{constructor(M){this.parent_=null,this.blade=M.blade,this.view=M.view,this.viewProps=M.viewProps;const N=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(le=>{N.classList.remove(Et(void 0,Ne[le]))}),this.blade.get("positions").forEach(le=>{N.classList.add(Et(void 0,Ne[le]))})}),this.viewProps.handleDispose(()=>{(function(le){le&&le.parentElement&&le.parentElement.removeChild(le)})(N)})}get parent(){return this.parent_}set parent(M){this.parent_=M,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):ot({key:"parent",target:Pt.name,place:"BladeController.parent"})}}const wt="http://www.w3.org/2000/svg";function Zt(ee){ee.offsetHeight}function nn(ee){return ee.ontouchstart!==void 0}function Vn(){return globalThis.document}const Jn={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ue(ee,M){const N=ee.createElementNS(wt,"svg");return N.innerHTML=Jn[M],N}function St(ee,M,N){ee.insertBefore(M,ee.children[N])}function Lt(ee){ee.parentElement&&ee.parentElement.removeChild(ee)}function jt(ee){for(;ee.children.length>0;)ee.removeChild(ee.children[0])}function Gt(ee){return ee.relatedTarget?ee.relatedTarget:"explicitOriginalTarget"in ee?ee.explicitOriginalTarget:null}const fn=V("lbl");class hn{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(fn()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("div");le.classList.add(fn("l")),ue(N.props,"label",ct=>{D(ct)?this.element.classList.add(fn(void 0,"nol")):(this.element.classList.remove(fn(void 0,"nol")),function(yt){for(;yt.childNodes.length>0;)yt.removeChild(yt.childNodes[0])}(le),le.appendChild(function(yt,on){const ei=yt.createDocumentFragment();return on.split(`
`).map(Ci=>yt.createTextNode(Ci)).forEach((Ci,yr)=>{yr>0&&ei.appendChild(yt.createElement("br")),ei.appendChild(Ci)}),ei}(M,ct)))}),this.element.appendChild(le),this.labelElement=le;const Ie=M.createElement("div");Ie.classList.add(fn("v")),this.element.appendChild(Ie),this.valueElement=Ie}}class qt extends et{constructor(M,N){const le=N.valueController.viewProps;super(Object.assign(Object.assign({},N),{view:new hn(M,{props:N.props,viewProps:le}),viewProps:le})),this.props=N.props,this.valueController=N.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const An={id:"button",type:"blade",accept(ee){const M=Fe,N=Ve(ee,{title:M.required.string,view:M.required.constant("button"),label:M.optional.string});return N?{params:N}:null},controller(ee){return new qt(ee.document,{blade:ee.blade,props:ye.fromObject({label:ee.params.label}),valueController:new ve(ee.document,{props:ye.fromObject({title:ee.params.title}),viewProps:ee.viewProps})})},api(ee){return ee.controller instanceof qt&&ee.controller.valueController instanceof ve?new oe(ee.controller):null}};class _n extends et{constructor(M){super(M),this.value=M.value}}function Bn(){return new ye({positions:me([],{equals:U})})}class de extends ye{constructor(M){super(M)}static create(M){const N={completed:!0,expanded:M,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},le=ye.createCore(N);return new de(le)}get styleExpanded(){var M;return(M=this.get("temporaryExpanded"))!==null&&M!==void 0?M:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const M=this.get("expandedHeight");return this.get("shouldFixHeight")&&!D(M)?`${M}px`:"auto"}bindExpandedClass(M,N){const le=()=>{this.styleExpanded?M.classList.add(N):M.classList.remove(N)};ue(this,"expanded",le),ue(this,"temporaryExpanded",le)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Ae(ee,M){M.style.height=ee.styleHeight}function Le(ee,M){ee.value("expanded").emitter.on("beforechange",()=>{if(ee.set("completed",!1),D(ee.get("expandedHeight"))){const N=function(le,Ie){let ct=0;return function(yt,on){const ei=yt.style.transition;yt.style.transition="none",on(),yt.style.transition=ei}(Ie,()=>{le.set("expandedHeight",null),le.set("temporaryExpanded",!0),Zt(Ie),ct=Ie.clientHeight,le.set("temporaryExpanded",null),Zt(Ie)}),ct}(ee,M);N>0&&ee.set("expandedHeight",N)}ee.set("shouldFixHeight",!0),Zt(M)}),ee.emitter.on("change",()=>{Ae(ee,M)}),Ae(ee,M),M.addEventListener("transitionend",N=>{N.propertyName==="height"&&ee.cleanUpTransition()})}class Oe extends m{constructor(M,N){super(M),this.rackApi_=N}}class $e{constructor(M){this.emitter=new ne,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=M}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(M){for(const N of this.allItems())if(M(N))return N;return null}includes(M){return this.cache_.has(M)}add(M,N){if(this.includes(M))throw J.shouldNeverHappen();const le=N!==void 0?N:this.items_.length;this.items_.splice(le,0,M),this.cache_.add(M);const Ie=this.extract_(M);Ie&&(Ie.emitter.on("add",this.onSubListAdd_),Ie.emitter.on("remove",this.onSubListRemove_),Ie.allItems().forEach(ct=>{this.cache_.add(ct)})),this.emitter.emit("add",{index:le,item:M,root:this,target:this})}remove(M){const N=this.items_.indexOf(M);if(N<0)return;this.items_.splice(N,1),this.cache_.delete(M);const le=this.extract_(M);le&&(le.emitter.off("add",this.onSubListAdd_),le.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:N,item:M,root:this,target:this})}onSubListAdd_(M){this.cache_.add(M.item),this.emitter.emit("add",{index:M.index,item:M.item,root:this,target:M.target})}onSubListRemove_(M){this.cache_.delete(M.item),this.emitter.emit("remove",{index:M.index,item:M.item,root:this,target:M.target})}}class pt extends m{constructor(M){super(M),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new ne,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(M){this.controller_.props.set("label",M)}on(M,N){const le=N.bind(this);return this.emitter_.on(M,Ie=>{le(Ie.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(M){const N=M.sender.target.read();this.emitter_.emit("change",{event:new A(this,N,this.controller_.binding.target.presetKey,M.options.last)})}}class Mt extends qt{constructor(M,N){super(M,N),this.binding=N.binding}}class Bt extends m{constructor(M){super(M),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new ne,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(M){this.controller_.props.set("label",M)}on(M,N){const le=N.bind(this);return this.emitter_.on(M,Ie=>{le(Ie.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(M){const N=M.sender.target.read();this.emitter_.emit("update",{event:new w(this,N,this.controller_.binding.target.presetKey)})}}class xt extends qt{constructor(M,N){super(M,N),this.binding=N.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function ht(ee){return ee instanceof en?ee.apiSet_:ee instanceof Oe?ee.rackApi_.apiSet_:null}function zt(ee,M){const N=ee.find(le=>le.controller_===M);if(!N)throw J.shouldNeverHappen();return N}function dn(ee,M,N){if(!$.isBindable(ee))throw J.notBindable();return new $(ee,M,N)}class en extends m{constructor(M,N){super(M),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new ne,this.apiSet_=new $e(ht),this.pool_=N;const le=this.controller_.rack;le.emitter.on("add",this.onRackAdd_),le.emitter.on("remove",this.onRackRemove_),le.emitter.on("inputchange",this.onRackInputChange_),le.emitter.on("monitorupdate",this.onRackMonitorUpdate_),le.children.forEach(Ie=>{this.setUpApi_(Ie)})}get children(){return this.controller_.rack.children.map(M=>zt(this.apiSet_,M))}addInput(M,N,le){const Ie=le??{},ct=this.controller_.view.element.ownerDocument,yt=this.pool_.createInput(ct,dn(M,N,Ie.presetKey),Ie),on=new pt(yt);return this.add(on,Ie.index)}addMonitor(M,N,le){const Ie=le??{},ct=this.controller_.view.element.ownerDocument,yt=this.pool_.createMonitor(ct,dn(M,N),Ie),on=new Bt(yt);return this.add(on,Ie.index)}addFolder(M){return function(N,le){return N.addBlade(Object.assign(Object.assign({},le),{view:"folder"}))}(this,M)}addButton(M){return function(N,le){return N.addBlade(Object.assign(Object.assign({},le),{view:"button"}))}(this,M)}addSeparator(M){return function(N,le){const Ie=le??{};return N.addBlade(Object.assign(Object.assign({},Ie),{view:"separator"}))}(this,M)}addTab(M){return function(N,le){return N.addBlade(Object.assign(Object.assign({},le),{view:"tab"}))}(this,M)}add(M,N){this.controller_.rack.add(M.controller_,N);const le=this.apiSet_.find(Ie=>Ie.controller_===M.controller_);return le&&this.apiSet_.remove(le),this.apiSet_.add(M),M}remove(M){this.controller_.rack.remove(M.controller_)}addBlade(M){const N=this.controller_.view.element.ownerDocument,le=this.pool_.createBlade(N,M),Ie=this.pool_.createBladeApi(le);return this.add(Ie,M.index)}on(M,N){const le=N.bind(this);return this.emitter_.on(M,Ie=>{le(Ie.event)}),this}setUpApi_(M){this.apiSet_.find(N=>N.controller_===M)||this.apiSet_.add(this.pool_.createBladeApi(M))}onRackAdd_(M){this.setUpApi_(M.bladeController)}onRackRemove_(M){if(M.isRoot){const N=zt(this.apiSet_,M.bladeController);this.apiSet_.remove(N)}}onRackInputChange_(M){const N=M.bladeController;if(N instanceof Mt){const le=zt(this.apiSet_,N),Ie=N.binding;this.emitter_.emit("change",{event:new A(le,Ie.target.read(),Ie.target.presetKey,M.options.last)})}else if(N instanceof _n){const le=zt(this.apiSet_,N);this.emitter_.emit("change",{event:new A(le,N.value.rawValue,void 0,M.options.last)})}}onRackMonitorUpdate_(M){if(!(M.bladeController instanceof xt))throw J.shouldNeverHappen();const N=zt(this.apiSet_,M.bladeController),le=M.bladeController.binding;this.emitter_.emit("update",{event:new w(N,le.target.read(),le.target.presetKey)})}}class xn extends Oe{constructor(M,N){super(M,new en(M.rackController,N)),this.emitter_=new ne,this.controller_.foldable.value("expanded").emitter.on("change",le=>{this.emitter_.emit("fold",{event:new T(this,le.sender.rawValue)})}),this.rackApi_.on("change",le=>{this.emitter_.emit("change",{event:le})}),this.rackApi_.on("update",le=>{this.emitter_.emit("update",{event:le})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(M){this.controller_.foldable.set("expanded",M)}get title(){return this.controller_.props.get("title")}set title(M){this.controller_.props.set("title",M)}get children(){return this.rackApi_.children}addInput(M,N,le){return this.rackApi_.addInput(M,N,le)}addMonitor(M,N,le){return this.rackApi_.addMonitor(M,N,le)}addFolder(M){return this.rackApi_.addFolder(M)}addButton(M){return this.rackApi_.addButton(M)}addSeparator(M){return this.rackApi_.addSeparator(M)}addTab(M){return this.rackApi_.addTab(M)}add(M,N){return this.rackApi_.add(M,N)}remove(M){this.rackApi_.remove(M)}addBlade(M){return this.rackApi_.addBlade(M)}on(M,N){const le=N.bind(this);return this.emitter_.on(M,Ie=>{le(Ie.event)}),this}}class wi extends et{constructor(M){super({blade:M.blade,view:M.view,viewProps:M.rackController.viewProps}),this.rackController=M.rackController}}class Gi{constructor(M,N){const le=V(N.viewName);this.element=M.createElement("div"),this.element.classList.add(le()),N.viewProps.bindClassModifiers(this.element)}}function Pe(ee){return ee instanceof Dn?ee.rack:ee instanceof wi?ee.rackController.rack:null}function oi(ee){const M=Pe(ee);return M?M.bcSet_:null}class pn{constructor(M){var N,le;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new ne,this.blade_=(N=M.blade)!==null&&N!==void 0?N:null,(le=this.blade_)===null||le===void 0||le.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=M.viewProps,this.bcSet_=new $e(oi),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(M,N){var le;(le=M.parent)===null||le===void 0||le.remove(M),k(M,"parent")?M.parent=this:(M.parent_=this,ot({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(M,N)}remove(M){k(M,"parent")?M.parent=null:(M.parent_=null,ot({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(M)}find(M){return this.bcSet_.allItems().filter(N=>N instanceof M)}onSetAdd_(M){this.updatePositions_();const N=M.target===M.root;if(this.emitter.emit("add",{bladeController:M.item,index:M.index,isRoot:N,sender:this}),!N)return;const le=M.item;if(le.viewProps.emitter.on("change",this.onChildViewPropsChange_),le.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),le.viewProps.handleDispose(this.onChildDispose_),le instanceof Mt)le.binding.emitter.on("change",this.onChildInputChange_);else if(le instanceof xt)le.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(le instanceof _n)le.value.emitter.on("change",this.onChildValueChange_);else{const Ie=Pe(le);if(Ie){const ct=Ie.emitter;ct.on("layout",this.onDescendantLayout_),ct.on("inputchange",this.onDescendantInputChange_),ct.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(M){this.updatePositions_();const N=M.target===M.root;if(this.emitter.emit("remove",{bladeController:M.item,isRoot:N,sender:this}),!N)return;const le=M.item;if(le instanceof Mt)le.binding.emitter.off("change",this.onChildInputChange_);else if(le instanceof xt)le.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(le instanceof _n)le.value.emitter.off("change",this.onChildValueChange_);else{const Ie=Pe(le);if(Ie){const ct=Ie.emitter;ct.off("layout",this.onDescendantLayout_),ct.off("inputchange",this.onDescendantInputChange_),ct.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const M=this.bcSet_.items.filter(Ie=>!Ie.viewProps.get("hidden")),N=M[0],le=M[M.length-1];this.bcSet_.items.forEach(Ie=>{const ct=[];Ie===N&&(ct.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||ct.push("veryfirst")),Ie===le&&(ct.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||ct.push("verylast")),Ie.blade.set("positions",ct)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(M){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(M=>M.viewProps.get("disposed")).forEach(M=>{this.bcSet_.remove(M)})}onChildInputChange_(M){const N=function(le,Ie){for(let ct=0;ct<le.length;ct++){const yt=le[ct];if(yt instanceof Mt&&yt.binding===Ie)return yt}return null}(this.find(Mt),M.sender);if(!N)throw J.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:N,options:M.options,sender:this})}onChildMonitorUpdate_(M){const N=function(le,Ie){for(let ct=0;ct<le.length;ct++){const yt=le[ct];if(yt instanceof xt&&yt.binding===Ie)return yt}return null}(this.find(xt),M.sender);if(!N)throw J.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:N,sender:this})}onChildValueChange_(M){const N=function(le,Ie){for(let ct=0;ct<le.length;ct++){const yt=le[ct];if(yt instanceof _n&&yt.value===Ie)return yt}return null}(this.find(_n),M.sender);if(!N)throw J.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:N,options:M.options,sender:this})}onDescendantLayout_(M){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(M){this.emitter.emit("inputchange",{bladeController:M.bladeController,options:M.options,sender:this})}onDescendantMonitorUpdate_(M){this.emitter.emit("monitorupdate",{bladeController:M.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Dn extends et{constructor(M,N){super(Object.assign(Object.assign({},N),{view:new Gi(M,{viewName:"brk",viewProps:N.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const le=new pn({blade:N.root?void 0:N.blade,viewProps:N.viewProps});le.emitter.on("add",this.onRackAdd_),le.emitter.on("remove",this.onRackRemove_),this.rack=le,this.viewProps.handleDispose(()=>{for(let Ie=this.rack.children.length-1;Ie>=0;Ie--)this.rack.children[Ie].viewProps.set("disposed",!0)})}onRackAdd_(M){M.isRoot&&St(this.view.element,M.bladeController.view.element,M.index)}onRackRemove_(M){M.isRoot&&Lt(M.bladeController.view.element)}}const kn=V("cnt");class ui{constructor(M,N){var le;this.className_=V((le=N.viewName)!==null&&le!==void 0?le:"fld"),this.element=M.createElement("div"),this.element.classList.add(this.className_(),kn()),N.viewProps.bindClassModifiers(this.element),this.foldable_=N.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ue(this.foldable_,"completed",he(this.element,this.className_(void 0,"cpl")));const Ie=M.createElement("button");Ie.classList.add(this.className_("b")),ue(N.props,"title",Ci=>{D(Ci)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),N.viewProps.bindDisabled(Ie),this.element.appendChild(Ie),this.buttonElement=Ie;const ct=M.createElement("div");ct.classList.add(this.className_("i")),this.element.appendChild(ct);const yt=M.createElement("div");yt.classList.add(this.className_("t")),K(N.props.value("title"),yt),this.buttonElement.appendChild(yt),this.titleElement=yt;const on=M.createElement("div");on.classList.add(this.className_("m")),this.buttonElement.appendChild(on);const ei=N.containerElement;ei.classList.add(this.className_("c")),this.element.appendChild(ei),this.containerElement=ei}}class Nr extends wi{constructor(M,N){var le;const Ie=de.create((le=N.expanded)===null||le===void 0||le),ct=new Dn(M,{blade:N.blade,root:N.root,viewProps:N.viewProps});super(Object.assign(Object.assign({},N),{rackController:ct,view:new ui(M,{containerElement:ct.view.element,foldable:Ie,props:N.props,viewName:N.root?"rot":void 0,viewProps:N.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=N.props,this.foldable=Ie,Le(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Pr={id:"folder",type:"blade",accept(ee){const M=Fe,N=Ve(ee,{title:M.required.string,view:M.required.constant("folder"),expanded:M.optional.boolean});return N?{params:N}:null},controller(ee){return new Nr(ee.document,{blade:ee.blade,expanded:ee.params.expanded,props:ye.fromObject({title:ee.params.title}),viewProps:ee.viewProps})},api(ee){return ee.controller instanceof Nr?new xn(ee.controller,ee.pool):null}};class wr extends _n{constructor(M,N){const le=N.valueController.viewProps;super(Object.assign(Object.assign({},N),{value:N.valueController.value,view:new hn(M,{props:N.props,viewProps:le}),viewProps:le})),this.props=N.props,this.valueController=N.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class es extends m{}const Ps=V("spr");class Jr{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(Ps()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("hr");le.classList.add(Ps("r")),this.element.appendChild(le)}}class cl extends et{constructor(M,N){super(Object.assign(Object.assign({},N),{view:new Jr(M,{viewProps:N.viewProps})}))}}const xs={id:"separator",type:"blade",accept(ee){const M=Ve(ee,{view:Fe.required.constant("separator")});return M?{params:M}:null},controller(ee){return new cl(ee.document,{blade:ee.blade,viewProps:ee.viewProps})},api(ee){return ee.controller instanceof cl?new es(ee.controller):null}},wo=V("tbi");class Cl{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(wo()),N.viewProps.bindClassModifiers(this.element),ue(N.props,"selected",ct=>{ct?this.element.classList.add(wo(void 0,"sel")):this.element.classList.remove(wo(void 0,"sel"))});const le=M.createElement("button");le.classList.add(wo("b")),N.viewProps.bindDisabled(le),this.element.appendChild(le),this.buttonElement=le;const Ie=M.createElement("div");Ie.classList.add(wo("t")),K(N.props.value("title"),Ie),this.buttonElement.appendChild(Ie),this.titleElement=Ie}}class Zs{constructor(M,N){this.emitter=new ne,this.onClick_=this.onClick_.bind(this),this.props=N.props,this.viewProps=N.viewProps,this.view=new Cl(M,{props:N.props,viewProps:N.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Bo{constructor(M,N){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Zs(M,{props:N.itemProps,viewProps:Pt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Dn(M,{blade:Bn(),viewProps:Pt.create()}),this.props=N.props,ue(this.props,"selected",le=>{this.itemController.props.set("selected",le),this.contentController.viewProps.set("hidden",!le)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class co{constructor(M,N){this.controller_=M,this.rackApi_=N}get title(){var M;return(M=this.controller_.itemController.props.get("title"))!==null&&M!==void 0?M:""}set title(M){this.controller_.itemController.props.set("title",M)}get selected(){return this.controller_.props.get("selected")}set selected(M){this.controller_.props.set("selected",M)}get children(){return this.rackApi_.children}addButton(M){return this.rackApi_.addButton(M)}addFolder(M){return this.rackApi_.addFolder(M)}addSeparator(M){return this.rackApi_.addSeparator(M)}addTab(M){return this.rackApi_.addTab(M)}add(M,N){this.rackApi_.add(M,N)}remove(M){this.rackApi_.remove(M)}addInput(M,N,le){return this.rackApi_.addInput(M,N,le)}addMonitor(M,N,le){return this.rackApi_.addMonitor(M,N,le)}addBlade(M){return this.rackApi_.addBlade(M)}}class Jl extends Oe{constructor(M,N){super(M,new en(M.rackController,N)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new ne,this.pageApiMap_=new Map,this.rackApi_.on("change",le=>{this.emitter_.emit("change",{event:le})}),this.rackApi_.on("update",le=>{this.emitter_.emit("update",{event:le})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(le=>{this.setUpPageApi_(le)})}get pages(){return this.controller_.pageSet.items.map(M=>{const N=this.pageApiMap_.get(M);if(!N)throw J.shouldNeverHappen();return N})}addPage(M){const N=this.controller_.view.element.ownerDocument,le=new Bo(N,{itemProps:ye.fromObject({selected:!1,title:M.title}),props:ye.fromObject({selected:!1})});this.controller_.add(le,M.index);const Ie=this.pageApiMap_.get(le);if(!Ie)throw J.shouldNeverHappen();return Ie}removePage(M){this.controller_.remove(M)}on(M,N){const le=N.bind(this);return this.emitter_.on(M,Ie=>{le(Ie.event)}),this}setUpPageApi_(M){const N=this.rackApi_.apiSet_.find(Ie=>Ie.controller_===M.contentController);if(!N)throw J.shouldNeverHappen();const le=new co(M,N);this.pageApiMap_.set(M,le)}onPageAdd_(M){this.setUpPageApi_(M.item)}onPageRemove_(M){if(!this.pageApiMap_.get(M.item))throw J.shouldNeverHappen();this.pageApiMap_.delete(M.item)}onSelect_(M){this.emitter_.emit("select",{event:new R(this,M.rawValue)})}}class mh{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=me(!0),this.selectedIndex=me(-1),this.items_=[]}add(M,N){const le=N??this.items_.length;this.items_.splice(le,0,M),M.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(M){const N=this.items_.indexOf(M);N<0||(this.items_.splice(N,1),M.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const M=this.items_.findIndex(N=>N.rawValue);M<0?(this.items_.forEach((N,le)=>{N.rawValue=le===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((N,le)=>{N.rawValue=le===M}),this.selectedIndex.rawValue=M),this.empty.rawValue=!1}onItemSelectedChange_(M){if(M.rawValue){const N=this.items_.findIndex(le=>le===M.sender);this.items_.forEach((le,Ie)=>{le.rawValue=Ie===N}),this.selectedIndex.rawValue=N}else this.keepSelection_()}}const ul=V("tab");class gt{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(ul(),kn()),N.viewProps.bindClassModifiers(this.element),ce(N.empty,he(this.element,ul(void 0,"nop")));const le=M.createElement("div");le.classList.add(ul("t")),this.element.appendChild(le),this.itemsElement=le;const Ie=M.createElement("div");Ie.classList.add(ul("i")),this.element.appendChild(Ie);const ct=N.contentsElement;ct.classList.add(ul("c")),this.element.appendChild(ct),this.contentsElement=ct}}class Wt extends wi{constructor(M,N){const le=new Dn(M,{blade:N.blade,viewProps:N.viewProps}),Ie=new mh;super({blade:N.blade,rackController:le,view:new gt(M,{contentsElement:le.view.element,empty:Ie.empty,viewProps:N.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new $e(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=Ie}get pageSet(){return this.pageSet_}add(M,N){this.pageSet_.add(M,N)}remove(M){this.pageSet_.remove(this.pageSet_.items[M])}onPageAdd_(M){const N=M.item;St(this.view.itemsElement,N.itemController.view.element,M.index),N.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(N.contentController,M.index),this.tab.add(N.props.value("selected"))}onPageRemove_(M){const N=M.item;Lt(N.itemController.view.element),N.itemController.viewProps.set("parent",null),this.rackController.rack.remove(N.contentController),this.tab.remove(N.props.value("selected"))}}const bn={id:"tab",type:"blade",accept(ee){const M=Fe,N=Ve(ee,{pages:M.required.array(M.required.object({title:M.required.string})),view:M.required.constant("tab")});return N&&N.pages.length!==0?{params:N}:null},controller(ee){const M=new Wt(ee.document,{blade:ee.blade,viewProps:ee.viewProps});return ee.params.pages.forEach(N=>{const le=new Bo(ee.document,{itemProps:ye.fromObject({selected:!1,title:N.title}),props:ye.fromObject({selected:!1})});M.add(le)}),M},api(ee){return ee.controller instanceof Wt?new Jl(ee.controller,ee.pool):null}};class ln{constructor(){this.disabled=!1,this.emitter=new ne}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class mn{constructor(M,N){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=M,this.emitter=new ne,this.interval_=N,this.setTimer_()}get disabled(){return this.disabled_}set disabled(M){this.disabled_=M,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const M=this.doc_.defaultView;M&&M.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const M=this.doc_.defaultView;M&&(this.timerId_=M.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Pi{constructor(M){this.onValueChange_=this.onValueChange_.bind(this),this.reader=M.reader,this.writer=M.writer,this.emitter=new ne,this.value=M.value,this.value.emitter.on("change",this.onValueChange_),this.target=M.target,this.read()}read(){const M=this.target.read();M!==void 0&&(this.value.rawValue=this.reader(M))}write_(M){this.writer(this.target,M)}onValueChange_(M){this.write_(M.rawValue),this.emitter.emit("change",{options:M.options,rawValue:M.rawValue,sender:this})}}function Di(ee,M){for(;ee.length<M;)ee.push(void 0)}function En(ee){const M=[];return Di(M,ee),me(M)}function nr(ee){const M=ee.indexOf(void 0);return M<0?ee:ee.slice(0,M)}class Hn{constructor(M){this.onTick_=this.onTick_.bind(this),this.reader_=M.reader,this.target=M.target,this.emitter=new ne,this.value=M.value,this.ticker=M.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const M=this.target.read();if(M===void 0)return;const N=this.value.rawValue,le=this.reader_(M);this.value.rawValue=function(Ie,ct){const yt=[...nr(Ie),ct];return yt.length>Ie.length?yt.splice(0,yt.length-Ie.length):Di(yt,Ie.length),yt}(N,le),this.emitter.emit("update",{rawValue:le,sender:this})}onTick_(M){this.read()}}class Ni{constructor(M){this.constraints=M}constrain(M){return this.constraints.reduce((N,le)=>le.constrain(N),M)}}function Me(ee,M){if(ee instanceof M)return ee;if(ee instanceof Ni){const N=ee.constraints.reduce((le,Ie)=>le||(Ie instanceof M?Ie:null),null);if(N)return N}return null}class Ee{constructor(M){this.values=ye.fromObject({max:M.max,min:M.min})}constrain(M){const N=this.values.get("max"),le=this.values.get("min");return Math.min(Math.max(M,le),N)}}class We{constructor(M){this.values=ye.fromObject({options:M})}get options(){return this.values.get("options")}constrain(M){const N=this.values.get("options");return N.length===0||N.filter(le=>le.value===M).length>0?M:N[0].value}}class it{constructor(M){this.values=ye.fromObject({max:M.max,min:M.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(M){const N=this.values.get("max"),le=this.values.get("min");let Ie=M;return D(le)||(Ie=Math.max(Ie,le)),D(N)||(Ie=Math.min(Ie,N)),Ie}}class je{constructor(M,N=0){this.step=M,this.origin=N}constrain(M){const N=this.origin%this.step;return N+Math.round((M-N)/this.step)*this.step}}const _t=V("lst");class qe{constructor(M,N){this.onValueChange_=this.onValueChange_.bind(this),this.props_=N.props,this.element=M.createElement("div"),this.element.classList.add(_t()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("select");le.classList.add(_t("s")),ue(this.props_,"options",ct=>{jt(le),ct.forEach((yt,on)=>{const ei=M.createElement("option");ei.dataset.index=String(on),ei.textContent=yt.text,ei.value=String(yt.value),le.appendChild(ei)})}),N.viewProps.bindDisabled(le),this.element.appendChild(le),this.selectElement=le;const Ie=M.createElement("div");Ie.classList.add(_t("m")),Ie.appendChild(Ue(M,"dropdown")),this.element.appendChild(Ie),N.value.emitter.on("change",this.onValueChange_),this.value_=N.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class lt{constructor(M,N){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=N.props,this.value=N.value,this.viewProps=N.viewProps,this.view=new qe(M,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(M){const N=M.currentTarget.selectedOptions.item(0);if(!N)return;const le=Number(N.dataset.index);this.value.rawValue=this.props.get("options")[le].value}}const Nt=V("pop");class cn{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(Nt()),N.viewProps.bindClassModifiers(this.element),ce(N.shows,he(this.element,Nt(void 0,"v")))}}class Xt{constructor(M,N){this.shows=me(!1),this.viewProps=N.viewProps,this.view=new cn(M,{shows:this.shows,viewProps:this.viewProps})}}const In=V("txt");class Ut{constructor(M,N){this.onChange_=this.onChange_.bind(this),this.element=M.createElement("div"),this.element.classList.add(In()),N.viewProps.bindClassModifiers(this.element),this.props_=N.props,this.props_.emitter.on("change",this.onChange_);const le=M.createElement("input");le.classList.add(In("i")),le.type="text",N.viewProps.bindDisabled(le),this.element.appendChild(le),this.inputElement=le,N.value.emitter.on("change",this.onChange_),this.value_=N.value,this.refresh()}refresh(){const M=this.props_.get("formatter");this.inputElement.value=M(this.value_.rawValue)}onChange_(){this.refresh()}}class Zn{constructor(M,N){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=N.parser,this.props=N.props,this.value=N.value,this.viewProps=N.viewProps,this.view=new Ut(M,{props:N.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(M){const N=M.currentTarget.value,le=this.parser_(N);D(le)||(this.value.rawValue=le),this.view.refresh()}}function On(ee){return ee!=="false"&&!!ee}function Yt(ee){return function(M){return String(M)}(ee)}class si{constructor(M){this.text=M}evaluate(){return Number(this.text)}toString(){return this.text}}const Tn={"**":(ee,M)=>Math.pow(ee,M),"*":(ee,M)=>ee*M,"/":(ee,M)=>ee/M,"%":(ee,M)=>ee%M,"+":(ee,M)=>ee+M,"-":(ee,M)=>ee-M,"<<":(ee,M)=>ee<<M,">>":(ee,M)=>ee>>M,">>>":(ee,M)=>ee>>>M,"&":(ee,M)=>ee&M,"^":(ee,M)=>ee^M,"|":(ee,M)=>ee|M};class _i{constructor(M,N,le){this.left=N,this.operator=M,this.right=le}evaluate(){const M=Tn[this.operator];if(!M)throw new Error(`unexpected binary operator: '${this.operator}`);return M(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ii={"+":ee=>ee,"-":ee=>-ee,"~":ee=>~ee};class Yn{constructor(M,N){this.operator=M,this.expression=N}evaluate(){const M=Ii[this.operator];if(!M)throw new Error(`unexpected unary operator: '${this.operator}`);return M(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Oi(ee){return(M,N)=>{for(let le=0;le<ee.length;le++){const Ie=ee[le](M,N);if(Ie!=="")return Ie}return""}}function Ki(ee,M){var N;const le=ee.substr(M).match(/^\s+/);return(N=le&&le[0])!==null&&N!==void 0?N:""}function Zi(ee,M){var N;const le=ee.substr(M).match(/^[0-9]+/);return(N=le&&le[0])!==null&&N!==void 0?N:""}function kr(ee,M){const N=ee.substr(M,1);if(M+=1,N.toLowerCase()!=="e")return"";const le=function(Ie,ct){const yt=Zi(Ie,ct);if(yt!=="")return yt;const on=Ie.substr(ct,1);if(on!=="-"&&on!=="+")return"";const ei=Zi(Ie,ct+=1);return ei===""?"":on+ei}(ee,M);return le===""?"":N+le}function sr(ee,M){const N=ee.substr(M,1);if(N==="0")return N;const le=function(Ie,ct){const yt=Ie.substr(ct,1);return yt.match(/^[1-9]$/)?yt:""}(ee,M);return M+=le.length,le===""?"":le+Zi(ee,M)}const ur=Oi([function(ee,M){const N=sr(ee,M);if(M+=N.length,N==="")return"";const le=ee.substr(M,1);if(M+=le.length,le!==".")return"";const Ie=Zi(ee,M);return N+le+Ie+kr(ee,M+=Ie.length)},function(ee,M){const N=ee.substr(M,1);if(M+=N.length,N!==".")return"";const le=Zi(ee,M);return M+=le.length,le===""?"":N+le+kr(ee,M)},function(ee,M){const N=sr(ee,M);return M+=N.length,N===""?"":N+kr(ee,M)}]),eo=Oi([function(ee,M){const N=ee.substr(M,2);if(M+=N.length,N.toLowerCase()!=="0b")return"";const le=function(Ie,ct){var yt;const on=Ie.substr(ct).match(/^[01]+/);return(yt=on&&on[0])!==null&&yt!==void 0?yt:""}(ee,M);return le===""?"":N+le},function(ee,M){const N=ee.substr(M,2);if(M+=N.length,N.toLowerCase()!=="0o")return"";const le=function(Ie,ct){var yt;const on=Ie.substr(ct).match(/^[0-7]+/);return(yt=on&&on[0])!==null&&yt!==void 0?yt:""}(ee,M);return le===""?"":N+le},function(ee,M){const N=ee.substr(M,2);if(M+=N.length,N.toLowerCase()!=="0x")return"";const le=function(Ie,ct){var yt;const on=Ie.substr(ct).match(/^[0-9a-f]+/i);return(yt=on&&on[0])!==null&&yt!==void 0?yt:""}(ee,M);return le===""?"":N+le}]),Jo=Oi([eo,ur]);function to(ee,M){var N;return(N=function(le,Ie){const ct=Jo(le,Ie);return Ie+=ct.length,ct===""?null:{evaluable:new si(ct),cursor:Ie}}(ee,M))!==null&&N!==void 0?N:function(le,Ie){const ct=le.substr(Ie,1);if(Ie+=ct.length,ct!=="(")return null;const yt=as(le,Ie);if(!yt)return null;Ie=yt.cursor,Ie+=Ki(le,Ie).length;const on=le.substr(Ie,1);return Ie+=on.length,on!==")"?null:{evaluable:yt.evaluable,cursor:Ie}}(ee,M)}function gs(ee,M,N){N+=Ki(M,N).length;const le=ee.filter(Ie=>M.startsWith(Ie,N))[0];return le?(N+=le.length,{cursor:N+=Ki(M,N).length,operator:le}):null}const Ln=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((ee,M)=>function(N,le){return(Ie,ct)=>{const yt=N(Ie,ct);if(!yt)return null;ct=yt.cursor;let on=yt.evaluable;for(;;){const ei=gs(le,Ie,ct);if(!ei)break;ct=ei.cursor;const Ci=N(Ie,ct);if(!Ci)return null;ct=Ci.cursor,on=new _i(ei.operator,on,Ci.evaluable)}return on?{cursor:ct,evaluable:on}:null}}(ee,M),function ee(M,N){const le=to(M,N);if(le)return le;const Ie=M.substr(N,1);if(N+=Ie.length,Ie!=="+"&&Ie!=="-"&&Ie!=="~")return null;const ct=ee(M,N);return ct?{cursor:N=ct.cursor,evaluable:new Yn(Ie,ct.evaluable)}:null});function as(ee,M){return M+=Ki(ee,M).length,Ln(ee,M)}function Ur(ee){var M;const N=function(le){const Ie=as(le,0);return Ie?Ie.cursor+Ki(le,Ie.cursor).length!==le.length?null:Ie.evaluable:null}(ee);return(M=N==null?void 0:N.evaluate())!==null&&M!==void 0?M:null}function Oo(ee){if(typeof ee=="number")return ee;if(typeof ee=="string"){const M=Ur(ee);if(!D(M))return M}return 0}function Er(ee){return String(ee)}function $i(ee){return M=>M.toFixed(Math.max(Math.min(ee,20),0))}const ir=$i(0);function Fs(ee){return ir(ee)+"%"}function uo(ee){return String(ee)}function Eo(ee){return ee}function or({primary:ee,secondary:M,forward:N,backward:le}){let Ie=!1;function ct(yt){Ie||(Ie=!0,yt(),Ie=!1)}ee.emitter.on("change",yt=>{ct(()=>{M.setRawValue(N(ee,M),yt.options)})}),M.emitter.on("change",yt=>{ct(()=>{ee.setRawValue(le(ee,M),yt.options)}),ct(()=>{M.setRawValue(N(ee,M),yt.options)})}),ct(()=>{M.setRawValue(N(ee,M),{forceEmit:!1,last:!0})})}function ws(ee,M){const N=ee*(M.altKey?.1:1)*(M.shiftKey?10:1);return M.upKey?+N:M.downKey?-N:0}function Sc(ee){return{altKey:ee.altKey,downKey:ee.key==="ArrowDown",shiftKey:ee.shiftKey,upKey:ee.key==="ArrowUp"}}function Ha(ee){return{altKey:ee.altKey,downKey:ee.key==="ArrowLeft",shiftKey:ee.shiftKey,upKey:ee.key==="ArrowRight"}}function Xp(ee){return function(M){return M==="ArrowUp"||M==="ArrowDown"}(ee)||ee==="ArrowLeft"||ee==="ArrowRight"}function _o(ee,M){var N,le;const Ie=M.ownerDocument.defaultView,ct=M.getBoundingClientRect();return{x:ee.pageX-(((N=Ie&&Ie.scrollX)!==null&&N!==void 0?N:0)+ct.left),y:ee.pageY-(((le=Ie&&Ie.scrollY)!==null&&le!==void 0?le:0)+ct.top)}}class Tc{constructor(M){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=M,this.emitter=new ne,M.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),M.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),M.addEventListener("touchend",this.onTouchEnd_),M.addEventListener("mousedown",this.onMouseDown_)}computePosition_(M){const N=this.elem_.getBoundingClientRect();return{bounds:{width:N.width,height:N.height},point:M?{x:M.x,y:M.y}:null}}onMouseDown_(M){var N;M.preventDefault(),(N=M.currentTarget)===null||N===void 0||N.focus();const le=this.elem_.ownerDocument;le.addEventListener("mousemove",this.onDocumentMouseMove_),le.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:M.altKey,data:this.computePosition_(_o(M,this.elem_)),sender:this,shiftKey:M.shiftKey})}onDocumentMouseMove_(M){this.emitter.emit("move",{altKey:M.altKey,data:this.computePosition_(_o(M,this.elem_)),sender:this,shiftKey:M.shiftKey})}onDocumentMouseUp_(M){const N=this.elem_.ownerDocument;N.removeEventListener("mousemove",this.onDocumentMouseMove_),N.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:M.altKey,data:this.computePosition_(_o(M,this.elem_)),sender:this,shiftKey:M.shiftKey})}onTouchStart_(M){M.preventDefault();const N=M.targetTouches.item(0),le=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:M.altKey,data:this.computePosition_(N?{x:N.clientX-le.left,y:N.clientY-le.top}:void 0),sender:this,shiftKey:M.shiftKey}),this.lastTouch_=N}onTouchMove_(M){const N=M.targetTouches.item(0),le=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:M.altKey,data:this.computePosition_(N?{x:N.clientX-le.left,y:N.clientY-le.top}:void 0),sender:this,shiftKey:M.shiftKey}),this.lastTouch_=N}onTouchEnd_(M){var N;const le=(N=M.targetTouches.item(0))!==null&&N!==void 0?N:this.lastTouch_,Ie=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:M.altKey,data:this.computePosition_(le?{x:le.clientX-Ie.left,y:le.clientY-Ie.top}:void 0),sender:this,shiftKey:M.shiftKey})}}function ss(ee,M,N,le,Ie){return le+(ee-M)/(N-M)*(Ie-le)}function wd(ee){return String(ee.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function no(ee,M,N){return Math.min(Math.max(ee,M),N)}function m_(ee,M){return(ee%M+M)%M}const Wa=V("txt");class g_{constructor(M,N){this.onChange_=this.onChange_.bind(this),this.props_=N.props,this.props_.emitter.on("change",this.onChange_),this.element=M.createElement("div"),this.element.classList.add(Wa(),Wa(void 0,"num")),N.arrayPosition&&this.element.classList.add(Wa(void 0,N.arrayPosition)),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("input");le.classList.add(Wa("i")),le.type="text",N.viewProps.bindDisabled(le),this.element.appendChild(le),this.inputElement=le,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=N.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Wa()),this.inputElement.classList.add(Wa("i"));const Ie=M.createElement("div");Ie.classList.add(Wa("k")),this.element.appendChild(Ie),this.knobElement=Ie;const ct=M.createElementNS(wt,"svg");ct.classList.add(Wa("g")),this.knobElement.appendChild(ct);const yt=M.createElementNS(wt,"path");yt.classList.add(Wa("gb")),ct.appendChild(yt),this.guideBodyElem_=yt;const on=M.createElementNS(wt,"path");on.classList.add(Wa("gh")),ct.appendChild(on),this.guideHeadElem_=on;const ei=M.createElement("div");ei.classList.add(V("tt")()),this.knobElement.appendChild(ei),this.tooltipElem_=ei,N.value.emitter.on("change",this.onChange_),this.value=N.value,this.refresh()}onDraggingChange_(M){if(M.rawValue===null)return void this.element.classList.remove(Wa(void 0,"drg"));this.element.classList.add(Wa(void 0,"drg"));const N=M.rawValue/this.props_.get("draggingScale"),le=N+(N>0?-1:N<0?1:0),Ie=no(-le,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${le+Ie},0 L${le},4 L${le+Ie},8`,`M ${N},-1 L${N},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${N},4`);const ct=this.props_.get("formatter");this.tooltipElem_.textContent=ct(this.value.rawValue),this.tooltipElem_.style.left=`${N}px`}refresh(){const M=this.props_.get("formatter");this.inputElement.value=M(this.value.rawValue)}onChange_(){this.refresh()}}class Ms{constructor(M,N){var le;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=N.baseStep,this.parser_=N.parser,this.props=N.props,this.sliderProps_=(le=N.sliderProps)!==null&&le!==void 0?le:null,this.value=N.value,this.viewProps=N.viewProps,this.dragging_=me(null),this.view=new g_(M,{arrayPosition:N.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Ie=new Tc(this.view.knobElement);Ie.emitter.on("down",this.onPointerDown_),Ie.emitter.on("move",this.onPointerMove_),Ie.emitter.on("up",this.onPointerUp_)}constrainValue_(M){var N,le;const Ie=(N=this.sliderProps_)===null||N===void 0?void 0:N.get("minValue"),ct=(le=this.sliderProps_)===null||le===void 0?void 0:le.get("maxValue");let yt=M;return Ie!==void 0&&(yt=Math.max(yt,Ie)),ct!==void 0&&(yt=Math.min(yt,ct)),yt}onInputChange_(M){const N=M.currentTarget.value,le=this.parser_(N);D(le)||(this.value.rawValue=this.constrainValue_(le)),this.view.refresh()}onInputKeyDown_(M){const N=ws(this.baseStep_,Sc(M));N!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+N),{forceEmit:!1,last:!1})}onInputKeyUp_(M){ws(this.baseStep_,Sc(M))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(M){if(!M.point)return null;const N=M.point.x-M.bounds.width/2;return this.constrainValue_(this.originRawValue_+N*this.props.get("draggingScale"))}onPointerMove_(M){const N=this.computeDraggingValue_(M.data);N!==null&&(this.value.setRawValue(N,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(M){const N=this.computeDraggingValue_(M.data);N!==null&&(this.value.setRawValue(N,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const gh=V("sld");class __{constructor(M,N){this.onChange_=this.onChange_.bind(this),this.props_=N.props,this.props_.emitter.on("change",this.onChange_),this.element=M.createElement("div"),this.element.classList.add(gh()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("div");le.classList.add(gh("t")),N.viewProps.bindTabIndex(le),this.element.appendChild(le),this.trackElement=le;const Ie=M.createElement("div");Ie.classList.add(gh("k")),this.trackElement.appendChild(Ie),this.knobElement=Ie,N.value.emitter.on("change",this.onChange_),this.value=N.value,this.update_()}update_(){const M=no(ss(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${M}%`}onChange_(){this.update_()}}class gm{constructor(M,N){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=N.baseStep,this.value=N.value,this.viewProps=N.viewProps,this.props=N.props,this.view=new __(M,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tc(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(M,N){M.point&&this.value.setRawValue(ss(no(M.point.x,0,M.bounds.width),0,M.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),N)}onPointerDownOrMove_(M){this.handlePointerEvent_(M.data,{forceEmit:!1,last:!1})}onPointerUp_(M){this.handlePointerEvent_(M.data,{forceEmit:!0,last:!0})}onKeyDown_(M){const N=ws(this.baseStep_,Ha(M));N!==0&&this.value.setRawValue(this.value.rawValue+N,{forceEmit:!1,last:!1})}onKeyUp_(M){ws(this.baseStep_,Ha(M))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const _h=V("sldtxt");class m0{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(_h());const le=M.createElement("div");le.classList.add(_h("s")),this.sliderView_=N.sliderView,le.appendChild(this.sliderView_.element),this.element.appendChild(le);const Ie=M.createElement("div");Ie.classList.add(_h("t")),this.textView_=N.textView,Ie.appendChild(this.textView_.element),this.element.appendChild(Ie)}}class Ed{constructor(M,N){this.value=N.value,this.viewProps=N.viewProps,this.sliderC_=new gm(M,{baseStep:N.baseStep,props:N.sliderProps,value:N.value,viewProps:this.viewProps}),this.textC_=new Ms(M,{baseStep:N.baseStep,parser:N.parser,props:N.textProps,sliderProps:N.sliderProps,value:N.value,viewProps:N.viewProps}),this.view=new m0(M,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Mc(ee,M){ee.write(M)}function qp(ee){const M=Fe;return Array.isArray(ee)?M.required.array(M.required.object({text:M.required.string,value:M.required.raw}))(ee).value:typeof ee=="object"?M.required.raw(ee).value:void 0}function ts(ee){if(ee==="inline"||ee==="popup")return ee}function su(ee){const M=Fe;return M.required.object({max:M.optional.number,min:M.optional.number,step:M.optional.number})(ee).value}function v_(ee){if(Array.isArray(ee))return ee;const M=[];return Object.keys(ee).forEach(N=>{M.push({text:N,value:ee[N]})}),M}function _m(ee){return D(ee)?null:new We(v_(ee))}function Yp(ee,M){const N=ee&&Me(ee,je);return N?wd(N.step):Math.max(wd(M),2)}function vh(ee){const M=function(N){const le=N?Me(N,je):null;return le?le.step:null}(ee);return M??1}function yh(ee,M){var N;const le=ee&&Me(ee,je),Ie=Math.abs((N=le==null?void 0:le.step)!==null&&N!==void 0?N:M);return Ie===0?.1:Math.pow(10,Math.floor(Math.log10(Ie))-1)}const Kp=V("ckb");class vm{constructor(M,N){this.onValueChange_=this.onValueChange_.bind(this),this.element=M.createElement("div"),this.element.classList.add(Kp()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("label");le.classList.add(Kp("l")),this.element.appendChild(le);const Ie=M.createElement("input");Ie.classList.add(Kp("i")),Ie.type="checkbox",le.appendChild(Ie),this.inputElement=Ie,N.viewProps.bindDisabled(this.inputElement);const ct=M.createElement("div");ct.classList.add(Kp("w")),le.appendChild(ct);const yt=Ue(M,"check");ct.appendChild(yt),N.value.emitter.on("change",this.onValueChange_),this.value=N.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class $p{constructor(M,N){this.onInputChange_=this.onInputChange_.bind(this),this.value=N.value,this.viewProps=N.viewProps,this.view=new vm(M,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(M){const N=M.currentTarget;this.value.rawValue=N.checked}}const Cc={id:"input-bool",type:"input",accept:(ee,M)=>{if(typeof ee!="boolean")return null;const N=Ve(M,{options:Fe.optional.custom(qp)});return N?{initialValue:ee,params:N}:null},binding:{reader:ee=>On,constraint:ee=>function(M){const N=[],le=_m(M.options);return le&&N.push(le),new Ni(N)}(ee.params),writer:ee=>Mc},controller:ee=>{const M=ee.document,N=ee.value,le=ee.constraint,Ie=le&&Me(le,We);return Ie?new lt(M,{props:new ye({options:Ie.values.value("options")}),value:N,viewProps:ee.viewProps}):new $p(M,{value:N,viewProps:ee.viewProps})}},Hs=V("col");class y_{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(Hs()),N.foldable.bindExpandedClass(this.element,Hs(void 0,"expanded")),ue(N.foldable,"completed",he(this.element,Hs(void 0,"cpl")));const le=M.createElement("div");le.classList.add(Hs("h")),this.element.appendChild(le);const Ie=M.createElement("div");Ie.classList.add(Hs("s")),le.appendChild(Ie),this.swatchElement=Ie;const ct=M.createElement("div");if(ct.classList.add(Hs("t")),le.appendChild(ct),this.textElement=ct,N.pickerLayout==="inline"){const yt=M.createElement("div");yt.classList.add(Hs("p")),this.element.appendChild(yt),this.pickerElement=yt}else this.pickerElement=null}}function ou(ee,M,N){const le=m_(ee,360),Ie=no(M/100,0,1),ct=no(N/100,0,1),yt=ct*Ie,on=yt*(1-Math.abs(le/60%2-1)),ei=ct-yt;let Ci,yr,Es;return[Ci,yr,Es]=le>=0&&le<60?[yt,on,0]:le>=60&&le<120?[on,yt,0]:le>=120&&le<180?[0,yt,on]:le>=180&&le<240?[0,on,yt]:le>=240&&le<300?[on,0,yt]:[yt,0,on],[255*(Ci+ei),255*(yr+ei),255*(Es+ei)]}function hl(ee){return[ee[0],ee[1],ee[2]]}function Sa(ee,M){return[ee[0],ee[1],ee[2],M]}const zs={hsl:{hsl:(ee,M,N)=>[ee,M,N],hsv:function(ee,M,N){const le=N+M*(100-Math.abs(2*N-100))/200;return[ee,le!==0?M*(100-Math.abs(2*N-100))/le:0,N+M*(100-Math.abs(2*N-100))/200]},rgb:function(ee,M,N){const le=(ee%360+360)%360,Ie=no(M/100,0,1),ct=no(N/100,0,1),yt=(1-Math.abs(2*ct-1))*Ie,on=yt*(1-Math.abs(le/60%2-1)),ei=ct-yt/2;let Ci,yr,Es;return[Ci,yr,Es]=le>=0&&le<60?[yt,on,0]:le>=60&&le<120?[on,yt,0]:le>=120&&le<180?[0,yt,on]:le>=180&&le<240?[0,on,yt]:le>=240&&le<300?[on,0,yt]:[yt,0,on],[255*(Ci+ei),255*(yr+ei),255*(Es+ei)]}},hsv:{hsl:function(ee,M,N){const le=100-Math.abs(N*(200-M)/100-100);return[ee,le!==0?M*N/le:0,N*(200-M)/200]},hsv:(ee,M,N)=>[ee,M,N],rgb:ou},rgb:{hsl:function(ee,M,N){const le=no(ee/255,0,1),Ie=no(M/255,0,1),ct=no(N/255,0,1),yt=Math.max(le,Ie,ct),on=Math.min(le,Ie,ct),ei=yt-on;let Ci=0,yr=0;const Es=(on+yt)/2;return ei!==0&&(yr=ei/(1-Math.abs(yt+on-1)),Ci=le===yt?(Ie-ct)/ei:Ie===yt?2+(ct-le)/ei:4+(le-Ie)/ei,Ci=Ci/6+(Ci<0?1:0)),[360*Ci,100*yr,100*Es]},hsv:function(ee,M,N){const le=no(ee/255,0,1),Ie=no(M/255,0,1),ct=no(N/255,0,1),yt=Math.max(le,Ie,ct),on=yt-Math.min(le,Ie,ct);let ei;return ei=on===0?0:yt===le?((Ie-ct)/on%6+6)%6*60:yt===Ie?60*((ct-le)/on+2):60*((le-Ie)/on+4),[ei,100*(yt===0?0:on/yt),100*yt]},rgb:(ee,M,N)=>[ee,M,N]}};function Bu(ee,M){return[M==="float"?1:ee==="rgb"?255:360,M==="float"?1:ee==="rgb"?255:100,M==="float"?1:ee==="rgb"?255:100]}function Ah(ee,M,N,le){const Ie=Bu(M,N),ct=Bu(M,le);return ee.map((yt,on)=>yt/Ie[on]*ct[on])}function bh(ee,M){return typeof ee=="object"&&!D(ee)&&M in ee&&typeof ee[M]=="number"}class qr{static black(M="int"){return new qr([0,0,0],"rgb",M)}static fromObject(M,N="int"){const le="a"in M?[M.r,M.g,M.b,M.a]:[M.r,M.g,M.b];return new qr(le,"rgb",N)}static toRgbaObject(M,N="int"){return M.toRgbaObject(N)}static isRgbColorObject(M){return bh(M,"r")&&bh(M,"g")&&bh(M,"b")}static isRgbaColorObject(M){return this.isRgbColorObject(M)&&bh(M,"a")}static isColorObject(M){return this.isRgbColorObject(M)}static equals(M,N){if(M.mode!==N.mode)return!1;const le=M.comps_,Ie=N.comps_;for(let ct=0;ct<le.length;ct++)if(le[ct]!==Ie[ct])return!1;return!0}constructor(M,N,le="int"){this.mode=N,this.type=le,this.comps_=function(Ie,ct,yt){var on;const ei=Bu(ct,yt);return[ct==="rgb"?no(Ie[0],0,ei[0]):(Ci=Ie[0],yr=ei[0],Ci===yr?yr:m_(Ci,yr)),no(Ie[1],0,ei[1]),no(Ie[2],0,ei[2]),no((on=Ie[3])!==null&&on!==void 0?on:1,0,1)];var Ci,yr}(M,N,le)}getComponents(M,N="int"){return Sa(function(le,Ie,ct){const yt=Ah(le,Ie.mode,Ie.type,"int");return Ah(zs[Ie.mode][ct.mode](...yt),ct.mode,"int",ct.type)}(hl(this.comps_),{mode:this.mode,type:this.type},{mode:M??this.mode,type:N}),this.comps_[3])}toRgbaObject(M="int"){const N=this.getComponents("rgb",M);return{r:N[0],g:N[1],b:N[2],a:N[3]}}}const Zl=V("colp");class Qa{constructor(M,N){this.alphaViews_=null,this.element=M.createElement("div"),this.element.classList.add(Zl()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("div");le.classList.add(Zl("hsv"));const Ie=M.createElement("div");Ie.classList.add(Zl("sv")),this.svPaletteView_=N.svPaletteView,Ie.appendChild(this.svPaletteView_.element),le.appendChild(Ie);const ct=M.createElement("div");ct.classList.add(Zl("h")),this.hPaletteView_=N.hPaletteView,ct.appendChild(this.hPaletteView_.element),le.appendChild(ct),this.element.appendChild(le);const yt=M.createElement("div");if(yt.classList.add(Zl("rgb")),this.textView_=N.textView,yt.appendChild(this.textView_.element),this.element.appendChild(yt),N.alphaViews){this.alphaViews_={palette:N.alphaViews.palette,text:N.alphaViews.text};const on=M.createElement("div");on.classList.add(Zl("a"));const ei=M.createElement("div");ei.classList.add(Zl("ap")),ei.appendChild(this.alphaViews_.palette.element),on.appendChild(ei);const Ci=M.createElement("div");Ci.classList.add(Zl("at")),Ci.appendChild(this.alphaViews_.text.element),on.appendChild(Ci),this.element.appendChild(on)}}get allFocusableElements(){const M=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(N=>N.inputElement)];return this.alphaViews_&&M.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),M}}function Vr(ee){return ee==="int"?"int":ee==="float"?"float":void 0}function Ta(ee){const M=Fe;return Ve(ee,{alpha:M.optional.boolean,color:M.optional.object({alpha:M.optional.boolean,type:M.optional.custom(Vr)}),expanded:M.optional.boolean,picker:M.optional.custom(ts)})}function jn(ee){return ee?.1:1}function Dr(ee){var M;return(M=ee.color)===null||M===void 0?void 0:M.type}function la(ee,M){const N=ee.match(/^(.+)%$/);return Math.min(N?.01*parseFloat(N[1])*M:parseFloat(ee),M)}const Jp={deg:ee=>ee,grad:ee=>360*ee/400,rad:ee=>360*ee/(2*Math.PI),turn:ee=>360*ee};function Zp(ee){const M=ee.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!M)return parseFloat(ee);const N=parseFloat(M[1]),le=M[2];return Jp[le](N)}function dl(ee){const M=ee.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!M)return null;const N=[la(M[1],255),la(M[2],255),la(M[3],255)];return isNaN(N[0])||isNaN(N[1])||isNaN(N[2])?null:N}function xh(ee){return M=>{const N=dl(M);return N?new qr(N,"rgb",ee):null}}function Rc(ee){const M=ee.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!M)return null;const N=[la(M[1],255),la(M[2],255),la(M[3],255),la(M[4],1)];return isNaN(N[0])||isNaN(N[1])||isNaN(N[2])||isNaN(N[3])?null:N}function Ma(ee){return M=>{const N=Rc(M);return N?new qr(N,"rgb",ee):null}}function Ou(ee){const M=ee.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!M)return null;const N=[Zp(M[1]),la(M[2],100),la(M[3],100)];return isNaN(N[0])||isNaN(N[1])||isNaN(N[2])?null:N}function ef(ee){return M=>{const N=Ou(M);return N?new qr(N,"hsl",ee):null}}function ym(ee){const M=ee.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!M)return null;const N=[Zp(M[1]),la(M[2],100),la(M[3],100),la(M[4],1)];return isNaN(N[0])||isNaN(N[1])||isNaN(N[2])||isNaN(N[3])?null:N}function tf(ee){return M=>{const N=ym(M);return N?new qr(N,"hsl",ee):null}}function A_(ee){const M=ee.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(M)return[parseInt(M[1]+M[1],16),parseInt(M[2]+M[2],16),parseInt(M[3]+M[3],16)];const N=ee.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return N?[parseInt(N[1],16),parseInt(N[2],16),parseInt(N[3],16)]:null}function b_(ee){const M=ee.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(M)return[parseInt(M[1]+M[1],16),parseInt(M[2]+M[2],16),parseInt(M[3]+M[3],16),ss(parseInt(M[4]+M[4],16),0,255,0,1)];const N=ee.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return N?[parseInt(N[1],16),parseInt(N[2],16),parseInt(N[3],16),ss(parseInt(N[4],16),0,255,0,1)]:null}function Ca(ee){const M=ee.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!M)return null;const N=[parseFloat(M[1]),parseFloat(M[2]),parseFloat(M[3])];return isNaN(N[0])||isNaN(N[1])||isNaN(N[2])?null:N}function au(ee){return M=>{const N=Ca(M);return N?new qr(N,"rgb",ee):null}}function Sd(ee){const M=ee.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!M)return null;const N=[parseFloat(M[1]),parseFloat(M[2]),parseFloat(M[3]),parseFloat(M[4])];return isNaN(N[0])||isNaN(N[1])||isNaN(N[2])||isNaN(N[3])?null:N}function Ic(ee){return M=>{const N=Sd(M);return N?new qr(N,"rgb",ee):null}}const lu=[{parser:A_,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:b_,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:dl,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Rc,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Ou,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:ym,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Ca,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Sd,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Ra(ee,M="int"){const N=function(le){return lu.reduce((Ie,{parser:ct,result:yt})=>Ie||(ct(le)?yt:null),null)}(ee);return N?N.notation==="hex"&&M!=="float"?Object.assign(Object.assign({},N),{type:"int"}):N.notation==="func"?Object.assign(Object.assign({},N),{type:M}):null:null}const Vs={int:[function(ee){const M=A_(ee);return M?new qr(M,"rgb","int"):null},function(ee){const M=b_(ee);return M?new qr(M,"rgb","int"):null},xh("int"),Ma("int"),ef("int"),tf("int"),au("int"),Ic("int")],float:[xh("float"),Ma("float"),ef("float"),tf("float"),au("float"),Ic("float")]};function Yr(ee){const M=Vs[ee];return N=>M.reduce((le,Ie)=>le||Ie(N),null)}function vo(ee){const M=no(Math.floor(ee),0,255).toString(16);return M.length===1?`0${M}`:M}function ca(ee,M="#"){return`${M}${hl(ee.getComponents("rgb")).map(vo).join("")}`}function Am(ee,M="#"){const N=ee.getComponents("rgb");return`${M}${[N[0],N[1],N[2],255*N[3]].map(vo).join("")}`}function nf(ee,M){const N=$i(M==="float"?2:0);return`rgb(${hl(ee.getComponents("rgb",M)).map(le=>N(le)).join(", ")})`}function g0(ee){return M=>nf(M,ee)}function Td(ee,M){const N=$i(2),le=$i(M==="float"?2:0);return`rgba(${ee.getComponents("rgb",M).map((Ie,ct)=>(ct===3?N:le)(Ie)).join(", ")})`}function No(ee){return M=>Td(M,ee)}function At(ee,M){const N=$i(M==="float"?2:0),le=["r","g","b"];return`{${hl(ee.getComponents("rgb",M)).map((Ie,ct)=>`${le[ct]}: ${N(Ie)}`).join(", ")}}`}function wh(ee){return M=>At(M,ee)}function Eh(ee,M){const N=$i(2),le=$i(M==="float"?2:0),Ie=["r","g","b","a"];return`{${ee.getComponents("rgb",M).map((ct,yt)=>`${Ie[yt]}: ${(yt===3?N:le)(ct)}`).join(", ")}}`}function ec(ee){return M=>Eh(M,ee)}const Pc=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:ca},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Am},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(ee){const M=[$i(0),Fs,Fs];return`hsl(${hl(ee.getComponents("hsl")).map((N,le)=>M[le](N)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(ee){const M=[$i(0),Fs,Fs,$i(2)];return`hsla(${ee.getComponents("hsl").map((N,le)=>M[le](N)).join(", ")})`}},...["int","float"].reduce((ee,M)=>[...ee,{format:{alpha:!1,mode:"rgb",notation:"func",type:M},stringifier:g0(M)},{format:{alpha:!0,mode:"rgb",notation:"func",type:M},stringifier:No(M)},{format:{alpha:!1,mode:"rgb",notation:"object",type:M},stringifier:wh(M)},{format:{alpha:!0,mode:"rgb",notation:"object",type:M},stringifier:ec(M)}],[])];function Rl(ee){return Pc.reduce((M,N)=>{return M||(le=N.format,Ie=ee,le.alpha===Ie.alpha&&le.mode===Ie.mode&&le.notation===Ie.notation&&le.type===Ie.type?N.stringifier:null);var le,Ie},null)}const tc=V("apl");class Nu{constructor(M,N){this.onValueChange_=this.onValueChange_.bind(this),this.value=N.value,this.value.emitter.on("change",this.onValueChange_),this.element=M.createElement("div"),this.element.classList.add(tc()),N.viewProps.bindClassModifiers(this.element),N.viewProps.bindTabIndex(this.element);const le=M.createElement("div");le.classList.add(tc("b")),this.element.appendChild(le);const Ie=M.createElement("div");Ie.classList.add(tc("c")),le.appendChild(Ie),this.colorElem_=Ie;const ct=M.createElement("div");ct.classList.add(tc("m")),this.element.appendChild(ct),this.markerElem_=ct;const yt=M.createElement("div");yt.classList.add(tc("p")),this.markerElem_.appendChild(yt),this.previewElem_=yt,this.update_()}update_(){const M=this.value.rawValue,N=M.getComponents("rgb"),le=new qr([N[0],N[1],N[2],0],"rgb"),Ie=new qr([N[0],N[1],N[2],255],"rgb"),ct=["to right",Td(le),Td(Ie)];this.colorElem_.style.background=`linear-gradient(${ct.join(",")})`,this.previewElem_.style.backgroundColor=Td(M);const yt=ss(N[3],0,1,0,100);this.markerElem_.style.left=`${yt}%`}onValueChange_(){this.update_()}}class ku{constructor(M,N){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=N.value,this.viewProps=N.viewProps,this.view=new Nu(M,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tc(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(M,N){if(!M.point)return;const le=M.point.x/M.bounds.width,Ie=this.value.rawValue,[ct,yt,on]=Ie.getComponents("hsv");this.value.setRawValue(new qr([ct,yt,on,le],"hsv"),N)}onPointerDown_(M){this.handlePointerEvent_(M.data,{forceEmit:!1,last:!1})}onPointerMove_(M){this.handlePointerEvent_(M.data,{forceEmit:!1,last:!1})}onPointerUp_(M){this.handlePointerEvent_(M.data,{forceEmit:!0,last:!0})}onKeyDown_(M){const N=ws(jn(!0),Ha(M));if(N===0)return;const le=this.value.rawValue,[Ie,ct,yt,on]=le.getComponents("hsv");this.value.setRawValue(new qr([Ie,ct,yt,on+N],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(M){ws(jn(!0),Ha(M))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ia=V("coltxt");class Dc{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(Ia()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("div");le.classList.add(Ia("m")),this.modeElem_=function(yt){const on=yt.createElement("select");return on.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((ei,Ci)=>{const yr=yt.createElement("option");return yr.textContent=Ci.text,yr.value=Ci.value,ei.appendChild(yr),ei},yt.createDocumentFragment())),on}(M),this.modeElem_.classList.add(Ia("ms")),le.appendChild(this.modeSelectElement),N.viewProps.bindDisabled(this.modeElem_);const Ie=M.createElement("div");Ie.classList.add(Ia("mm")),Ie.appendChild(Ue(M,"dropdown")),le.appendChild(Ie),this.element.appendChild(le);const ct=M.createElement("div");ct.classList.add(Ia("w")),this.element.appendChild(ct),this.textsElem_=ct,this.textViews_=N.textViews,this.applyTextViews_(),ce(N.colorMode,yt=>{this.modeElem_.value=yt})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(M){this.textViews_=M,this.applyTextViews_()}applyTextViews_(){jt(this.textsElem_);const M=this.element.ownerDocument;this.textViews_.forEach(N=>{const le=M.createElement("div");le.classList.add(Ia("c")),le.appendChild(N.element),this.textsElem_.appendChild(le)})}}function Lc(ee,M,N){const le=Bu(ee,M)[N];return new Ee({min:0,max:le})}function nc(ee,M,N){return new Ms(ee,{arrayPosition:N===0?"fst":N===2?"lst":"mid",baseStep:jn(!1),parser:M.parser,props:ye.fromObject({draggingScale:M.colorType==="float"?.01:1,formatter:(le=M.colorType,$i(le==="float"?2:0))}),value:me(0,{constraint:Lc(M.colorMode,M.colorType,N)}),viewProps:M.viewProps});var le}class Md{constructor(M,N){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=N.colorType,this.parser_=N.parser,this.value=N.value,this.viewProps=N.viewProps,this.colorMode=me(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(M),this.view=new Dc(M,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(M){const N={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},le=[nc(M,N,0),nc(M,N,1),nc(M,N,2)];return le.forEach((Ie,ct)=>{or({primary:this.value,secondary:Ie.value,forward:yt=>yt.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[ct],backward:(yt,on)=>{const ei=this.colorMode.rawValue,Ci=yt.rawValue.getComponents(ei,this.colorType_);return Ci[ct]=on.rawValue,new qr(Sa(hl(Ci),Ci[3]),ei,this.colorType_)}})}),le}onModeSelectChange_(M){const N=M.currentTarget;this.colorMode.rawValue=N.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const cu=V("hpl");class rf{constructor(M,N){this.onValueChange_=this.onValueChange_.bind(this),this.value=N.value,this.value.emitter.on("change",this.onValueChange_),this.element=M.createElement("div"),this.element.classList.add(cu()),N.viewProps.bindClassModifiers(this.element),N.viewProps.bindTabIndex(this.element);const le=M.createElement("div");le.classList.add(cu("c")),this.element.appendChild(le);const Ie=M.createElement("div");Ie.classList.add(cu("m")),this.element.appendChild(Ie),this.markerElem_=Ie,this.update_()}update_(){const M=this.value.rawValue,[N]=M.getComponents("hsv");this.markerElem_.style.backgroundColor=nf(new qr([N,100,100],"hsv"));const le=ss(N,0,360,0,100);this.markerElem_.style.left=`${le}%`}onValueChange_(){this.update_()}}class uu{constructor(M,N){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=N.value,this.viewProps=N.viewProps,this.view=new rf(M,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tc(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(M,N){if(!M.point)return;const le=ss(no(M.point.x,0,M.bounds.width),0,M.bounds.width,0,360),Ie=this.value.rawValue,[,ct,yt,on]=Ie.getComponents("hsv");this.value.setRawValue(new qr([le,ct,yt,on],"hsv"),N)}onPointerDown_(M){this.handlePointerEvent_(M.data,{forceEmit:!1,last:!1})}onPointerMove_(M){this.handlePointerEvent_(M.data,{forceEmit:!1,last:!1})}onPointerUp_(M){this.handlePointerEvent_(M.data,{forceEmit:!0,last:!0})}onKeyDown_(M){const N=ws(jn(!1),Ha(M));if(N===0)return;const le=this.value.rawValue,[Ie,ct,yt,on]=le.getComponents("hsv");this.value.setRawValue(new qr([Ie+N,ct,yt,on],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(M){ws(jn(!1),Ha(M))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const jr=V("svp");class So{constructor(M,N){this.onValueChange_=this.onValueChange_.bind(this),this.value=N.value,this.value.emitter.on("change",this.onValueChange_),this.element=M.createElement("div"),this.element.classList.add(jr()),N.viewProps.bindClassModifiers(this.element),N.viewProps.bindTabIndex(this.element);const le=M.createElement("canvas");le.height=64,le.width=64,le.classList.add(jr("c")),this.element.appendChild(le),this.canvasElement=le;const Ie=M.createElement("div");Ie.classList.add(jr("m")),this.element.appendChild(Ie),this.markerElem_=Ie,this.update_()}update_(){const M=function(Ci){const yr=Ci.ownerDocument.defaultView;return yr&&"document"in yr?Ci.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!M)return;const N=this.value.rawValue.getComponents("hsv"),le=this.canvasElement.width,Ie=this.canvasElement.height,ct=M.getImageData(0,0,le,Ie),yt=ct.data;for(let Ci=0;Ci<Ie;Ci++)for(let yr=0;yr<le;yr++){const Es=ss(yr,0,le,0,100),da=ss(Ci,0,Ie,100,0),jo=ou(N[0],Es,da),Dl=4*(Ci*le+yr);yt[Dl]=jo[0],yt[Dl+1]=jo[1],yt[Dl+2]=jo[2],yt[Dl+3]=255}M.putImageData(ct,0,0);const on=ss(N[1],0,100,0,100);this.markerElem_.style.left=`${on}%`;const ei=ss(N[2],0,100,100,0);this.markerElem_.style.top=`${ei}%`}onValueChange_(){this.update_()}}class pl{constructor(M,N){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=N.value,this.viewProps=N.viewProps,this.view=new So(M,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tc(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(M,N){if(!M.point)return;const le=ss(M.point.x,0,M.bounds.width,0,100),Ie=ss(M.point.y,0,M.bounds.height,100,0),[ct,,,yt]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new qr([ct,le,Ie,yt],"hsv"),N)}onPointerDown_(M){this.handlePointerEvent_(M.data,{forceEmit:!1,last:!1})}onPointerMove_(M){this.handlePointerEvent_(M.data,{forceEmit:!1,last:!1})}onPointerUp_(M){this.handlePointerEvent_(M.data,{forceEmit:!0,last:!0})}onKeyDown_(M){Xp(M.key)&&M.preventDefault();const[N,le,Ie,ct]=this.value.rawValue.getComponents("hsv"),yt=jn(!1),on=ws(yt,Ha(M)),ei=ws(yt,Sc(M));on===0&&ei===0||this.value.setRawValue(new qr([N,le+on,Ie+ei,ct],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(M){const N=jn(!1),le=ws(N,Ha(M)),Ie=ws(N,Sc(M));le===0&&Ie===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class hu{constructor(M,N){this.value=N.value,this.viewProps=N.viewProps,this.hPaletteC_=new uu(M,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new pl(M,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=N.supportsAlpha?{palette:new ku(M,{value:this.value,viewProps:this.viewProps}),text:new Ms(M,{parser:Ur,baseStep:.1,props:ye.fromObject({draggingScale:.01,formatter:$i(2)}),value:me(0,{constraint:new Ee({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&or({primary:this.value,secondary:this.alphaIcs_.text.value,forward:le=>le.rawValue.getComponents()[3],backward:(le,Ie)=>{const ct=le.rawValue.getComponents();return ct[3]=Ie.rawValue,new qr(ct,le.rawValue.mode)}}),this.textC_=new Md(M,{colorType:N.colorType,parser:Ur,value:this.value,viewProps:this.viewProps}),this.view=new Qa(M,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:N.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const ko=V("colsw");class Xa{constructor(M,N){this.onValueChange_=this.onValueChange_.bind(this),N.value.emitter.on("change",this.onValueChange_),this.value=N.value,this.element=M.createElement("div"),this.element.classList.add(ko()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("div");le.classList.add(ko("sw")),this.element.appendChild(le),this.swatchElem_=le;const Ie=M.createElement("button");Ie.classList.add(ko("b")),N.viewProps.bindDisabled(Ie),this.element.appendChild(Ie),this.buttonElement=Ie,this.update_()}update_(){const M=this.value.rawValue;this.swatchElem_.style.backgroundColor=Am(M)}onValueChange_(){this.update_()}}class sf{constructor(M,N){this.value=N.value,this.viewProps=N.viewProps,this.view=new Xa(M,{value:this.value,viewProps:this.viewProps})}}class Uu{constructor(M,N){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=N.value,this.viewProps=N.viewProps,this.foldable_=de.create(N.expanded),this.swatchC_=new sf(M,{value:this.value,viewProps:this.viewProps});const le=this.swatchC_.view.buttonElement;le.addEventListener("blur",this.onButtonBlur_),le.addEventListener("click",this.onButtonClick_),this.textC_=new Zn(M,{parser:N.parser,props:ye.fromObject({formatter:N.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new y_(M,{foldable:this.foldable_,pickerLayout:N.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=N.pickerLayout==="popup"?new Xt(M,{viewProps:this.viewProps}):null;const Ie=new hu(M,{colorType:N.colorType,supportsAlpha:N.supportsAlpha,value:this.value,viewProps:this.viewProps});Ie.view.allFocusableElements.forEach(ct=>{ct.addEventListener("blur",this.onPopupChildBlur_),ct.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Ie,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(Ie.view.element),or({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:ct=>ct.rawValue,backward:(ct,yt)=>yt.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Le(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(M){if(!this.popC_)return;const N=this.view.element,le=M.relatedTarget;le&&N.contains(le)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(M){if(!this.popC_)return;const N=this.popC_.view.element,le=Gt(M);le&&N.contains(le)||le&&le===this.swatchC_.view.buttonElement&&!nn(N.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(M){this.popC_?M.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&M.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function ic(ee){return hl(ee.getComponents("rgb")).reduce((M,N)=>M<<8|255&Math.floor(N),0)}function Sh(ee){return ee.getComponents("rgb").reduce((M,N,le)=>M<<8|255&Math.floor(le===3?255*N:N),0)>>>0}function Cd(ee){return typeof ee!="number"?qr.black():new qr([(M=ee)>>16&255,M>>8&255,255&M],"rgb");var M}function of(ee){return typeof ee!="number"?qr.black():new qr([(M=ee)>>24&255,M>>16&255,M>>8&255,ss(255&M,0,255,0,1)],"rgb");var M}function Bc(ee){var M;return!(!(ee!=null&&ee.alpha)&&!(!((M=ee==null?void 0:ee.color)===null||M===void 0)&&M.alpha))}function Sr(ee){return ee?M=>Am(M,"0x"):M=>ca(M,"0x")}const ds={id:"input-color-number",type:"input",accept:(ee,M)=>{if(typeof ee!="number"||!function(le){return"color"in le||"view"in le&&le.view==="color"}(M))return null;const N=Ta(M);return N?{initialValue:ee,params:N}:null},binding:{reader:ee=>Bc(ee.params)?of:Cd,equals:qr.equals,writer:ee=>function(M){const N=M?Sh:ic;return(le,Ie)=>{Mc(le,N(Ie))}}(Bc(ee.params))},controller:ee=>{const M=Bc(ee.params),N="expanded"in ee.params?ee.params.expanded:void 0,le="picker"in ee.params?ee.params.picker:void 0;return new Uu(ee.document,{colorType:"int",expanded:N!=null&&N,formatter:Sr(M),parser:Yr("int"),pickerLayout:le??"popup",supportsAlpha:M,value:ee.value,viewProps:ee.viewProps})}};function Uo(ee){return M=>function(N,le){return qr.isColorObject(N)?qr.fromObject(N,le):qr.black(le)}(M,ee)}function fl(ee,M){return N=>ee?Eh(N,M):At(N,M)}const Oc={id:"input-color-object",type:"input",accept:(ee,M)=>{if(!qr.isColorObject(ee))return null;const N=Ta(M);return N?{initialValue:ee,params:N}:null},binding:{reader:ee=>Uo(Dr(ee.params)),equals:qr.equals,writer:ee=>{return le=ee.initialValue,M=qr.isRgbaColorObject(le),N=Dr(ee.params),(Ie,ct)=>{M?function(yt,on,ei){const Ci=on.toRgbaObject(ei);yt.writeProperty("r",Ci.r),yt.writeProperty("g",Ci.g),yt.writeProperty("b",Ci.b),yt.writeProperty("a",Ci.a)}(Ie,ct,N):function(yt,on,ei){const Ci=on.toRgbaObject(ei);yt.writeProperty("r",Ci.r),yt.writeProperty("g",Ci.g),yt.writeProperty("b",Ci.b)}(Ie,ct,N)};var M,N,le}},controller:ee=>{var M;const N=qr.isRgbaColorObject(ee.initialValue),le="expanded"in ee.params?ee.params.expanded:void 0,Ie="picker"in ee.params?ee.params.picker:void 0,ct=(M=Dr(ee.params))!==null&&M!==void 0?M:"int";return new Uu(ee.document,{colorType:ct,expanded:le!=null&&le,formatter:fl(N,ct),parser:Yr(ct),pickerLayout:Ie??"popup",supportsAlpha:N,value:ee.value,viewProps:ee.viewProps})}},qa={id:"input-color-string",type:"input",accept:(ee,M)=>{if(typeof ee!="string"||"view"in M&&M.view==="text")return null;const N=Ra(ee,Dr(M));if(!N||!Rl(N))return null;const le=Ta(M);return le?{initialValue:ee,params:le}:null},binding:{reader:ee=>{var M;return function(N){const le=Vs[N];return Ie=>{if(typeof Ie!="string")return qr.black(N);const ct=le.reduce((yt,on)=>yt||on(Ie),null);return ct??qr.black(N)}}((M=Dr(ee.params))!==null&&M!==void 0?M:"int")},equals:qr.equals,writer:ee=>{const M=Ra(ee.initialValue,Dr(ee.params));if(!M)throw J.shouldNeverHappen();const N=function(le){const Ie=Rl(le);return Ie?(ct,yt)=>{Mc(ct,Ie(yt))}:null}(M);if(!N)throw J.notBindable();return N}},controller:ee=>{const M=Ra(ee.initialValue,Dr(ee.params));if(!M)throw J.shouldNeverHappen();const N=Rl(M);if(!N)throw J.shouldNeverHappen();const le="expanded"in ee.params?ee.params.expanded:void 0,Ie="picker"in ee.params?ee.params.picker:void 0;return new Uu(ee.document,{colorType:M.type,expanded:le!=null&&le,formatter:N,parser:Yr(M.type),pickerLayout:Ie??"popup",supportsAlpha:M.alpha,value:ee.value,viewProps:ee.viewProps})}};class ml{constructor(M){this.components=M.components,this.asm_=M.assembly}constrain(M){const N=this.asm_.toComponents(M).map((le,Ie)=>{var ct,yt;return(yt=(ct=this.components[Ie])===null||ct===void 0?void 0:ct.constrain(le))!==null&&yt!==void 0?yt:le});return this.asm_.fromComponents(N)}}const ua=V("pndtxt");class bm{constructor(M,N){this.textViews=N.textViews,this.element=M.createElement("div"),this.element.classList.add(ua()),this.textViews.forEach(le=>{const Ie=M.createElement("div");Ie.classList.add(ua("a")),Ie.appendChild(le.element),this.element.appendChild(Ie)})}}class Rd{constructor(M,N){this.value=N.value,this.viewProps=N.viewProps,this.acs_=N.axes.map((le,Ie)=>function(ct,yt,on){return new Ms(ct,{arrayPosition:on===0?"fst":on===yt.axes.length-1?"lst":"mid",baseStep:yt.axes[on].baseStep,parser:yt.parser,props:yt.axes[on].textProps,value:me(0,{constraint:yt.axes[on].constraint}),viewProps:yt.viewProps})}(M,N,Ie)),this.acs_.forEach((le,Ie)=>{or({primary:this.value,secondary:le.value,forward:ct=>N.assembly.toComponents(ct.rawValue)[Ie],backward:(ct,yt)=>{const on=N.assembly.toComponents(ct.rawValue);return on[Ie]=yt.rawValue,N.assembly.fromComponents(on)}})}),this.view=new bm(M,{textViews:this.acs_.map(le=>le.view)})}}function Nc(ee,M){return"step"in ee&&!D(ee.step)?new je(ee.step,M):null}function Zo(ee){return D(ee.max)||D(ee.min)?D(ee.max)&&D(ee.min)?null:new it({max:ee.max,min:ee.min}):new Ee({max:ee.max,min:ee.min})}const af={id:"input-number",type:"input",accept:(ee,M)=>{if(typeof ee!="number")return null;const N=Fe,le=Ve(M,{format:N.optional.function,max:N.optional.number,min:N.optional.number,options:N.optional.custom(qp),step:N.optional.number});return le?{initialValue:ee,params:le}:null},binding:{reader:ee=>Oo,constraint:ee=>function(M,N){const le=[],Ie=Nc(M,N);Ie&&le.push(Ie);const ct=Zo(M);ct&&le.push(ct);const yt=_m(M.options);return yt&&le.push(yt),new Ni(le)}(ee.params,ee.initialValue),writer:ee=>Mc},controller:ee=>{var M;const N=ee.value,le=ee.constraint,Ie=le&&Me(le,We);if(Ie)return new lt(ee.document,{props:new ye({options:Ie.values.value("options")}),value:N,viewProps:ee.viewProps});const ct=(M="format"in ee.params?ee.params.format:void 0)!==null&&M!==void 0?M:$i(Yp(le,N.rawValue)),yt=le&&Me(le,Ee);return yt?new Ed(ee.document,{baseStep:vh(le),parser:Ur,sliderProps:new ye({maxValue:yt.values.value("max"),minValue:yt.values.value("min")}),textProps:ye.fromObject({draggingScale:yh(le,N.rawValue),formatter:ct}),value:N,viewProps:ee.viewProps}):new Ms(ee.document,{baseStep:vh(le),parser:Ur,props:ye.fromObject({draggingScale:yh(le,N.rawValue),formatter:ct}),value:N,viewProps:ee.viewProps})}};class Ya{constructor(M=0,N=0){this.x=M,this.y=N}getComponents(){return[this.x,this.y]}static isObject(M){if(D(M))return!1;const N=M.x,le=M.y;return typeof N=="number"&&typeof le=="number"}static equals(M,N){return M.x===N.x&&M.y===N.y}toObject(){return{x:this.x,y:this.y}}}const To={toComponents:ee=>ee.getComponents(),fromComponents:ee=>new Ya(...ee)},Mo=V("p2d");class Ka{constructor(M,N){this.element=M.createElement("div"),this.element.classList.add(Mo()),N.viewProps.bindClassModifiers(this.element),ce(N.expanded,he(this.element,Mo(void 0,"expanded")));const le=M.createElement("div");le.classList.add(Mo("h")),this.element.appendChild(le);const Ie=M.createElement("button");Ie.classList.add(Mo("b")),Ie.appendChild(Ue(M,"p2dpad")),N.viewProps.bindDisabled(Ie),le.appendChild(Ie),this.buttonElement=Ie;const ct=M.createElement("div");if(ct.classList.add(Mo("t")),le.appendChild(ct),this.textElement=ct,N.pickerLayout==="inline"){const yt=M.createElement("div");yt.classList.add(Mo("p")),this.element.appendChild(yt),this.pickerElement=yt}else this.pickerElement=null}}const Fo=V("p2dp");class lf{constructor(M,N){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=N.invertsY,this.maxValue_=N.maxValue,this.element=M.createElement("div"),this.element.classList.add(Fo()),N.layout==="popup"&&this.element.classList.add(Fo(void 0,"p")),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("div");le.classList.add(Fo("p")),N.viewProps.bindTabIndex(le),this.element.appendChild(le),this.padElement=le;const Ie=M.createElementNS(wt,"svg");Ie.classList.add(Fo("g")),this.padElement.appendChild(Ie),this.svgElem_=Ie;const ct=M.createElementNS(wt,"line");ct.classList.add(Fo("ax")),ct.setAttributeNS(null,"x1","0"),ct.setAttributeNS(null,"y1","50%"),ct.setAttributeNS(null,"x2","100%"),ct.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(ct);const yt=M.createElementNS(wt,"line");yt.classList.add(Fo("ax")),yt.setAttributeNS(null,"x1","50%"),yt.setAttributeNS(null,"y1","0"),yt.setAttributeNS(null,"x2","50%"),yt.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(yt);const on=M.createElementNS(wt,"line");on.classList.add(Fo("l")),on.setAttributeNS(null,"x1","50%"),on.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(on),this.lineElem_=on;const ei=M.createElement("div");ei.classList.add(Fo("m")),this.padElement.appendChild(ei),this.markerElem_=ei,N.value.emitter.on("change",this.onValueChange_),this.value=N.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[M,N]=this.value.rawValue.getComponents(),le=this.maxValue_,Ie=ss(M,-le,+le,0,100),ct=ss(N,-le,+le,0,100),yt=this.invertsY_?100-ct:ct;this.lineElem_.setAttributeNS(null,"x2",`${Ie}%`),this.lineElem_.setAttributeNS(null,"y2",`${yt}%`),this.markerElem_.style.left=`${Ie}%`,this.markerElem_.style.top=`${yt}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Id(ee,M,N){return[ws(M[0],Ha(ee)),ws(M[1],Sc(ee))*(N?1:-1)]}class cf{constructor(M,N){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=N.value,this.viewProps=N.viewProps,this.baseSteps_=N.baseSteps,this.maxValue_=N.maxValue,this.invertsY_=N.invertsY,this.view=new lf(M,{invertsY:this.invertsY_,layout:N.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tc(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(M,N){if(!M.point)return;const le=this.maxValue_,Ie=ss(M.point.x,0,M.bounds.width,-le,+le),ct=ss(this.invertsY_?M.bounds.height-M.point.y:M.point.y,0,M.bounds.height,-le,+le);this.value.setRawValue(new Ya(Ie,ct),N)}onPointerDown_(M){this.handlePointerEvent_(M.data,{forceEmit:!1,last:!1})}onPointerMove_(M){this.handlePointerEvent_(M.data,{forceEmit:!1,last:!1})}onPointerUp_(M){this.handlePointerEvent_(M.data,{forceEmit:!0,last:!0})}onPadKeyDown_(M){Xp(M.key)&&M.preventDefault();const[N,le]=Id(M,this.baseSteps_,this.invertsY_);N===0&&le===0||this.value.setRawValue(new Ya(this.value.rawValue.x+N,this.value.rawValue.y+le),{forceEmit:!1,last:!1})}onPadKeyUp_(M){const[N,le]=Id(M,this.baseSteps_,this.invertsY_);N===0&&le===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Fu{constructor(M,N){var le,Ie;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=N.value,this.viewProps=N.viewProps,this.foldable_=de.create(N.expanded),this.popC_=N.pickerLayout==="popup"?new Xt(M,{viewProps:this.viewProps}):null;const ct=new cf(M,{baseSteps:[N.axes[0].baseStep,N.axes[1].baseStep],invertsY:N.invertsY,layout:N.pickerLayout,maxValue:N.maxValue,value:this.value,viewProps:this.viewProps});ct.view.allFocusableElements.forEach(yt=>{yt.addEventListener("blur",this.onPopupChildBlur_),yt.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=ct,this.textC_=new Rd(M,{assembly:To,axes:N.axes,parser:N.parser,value:this.value,viewProps:this.viewProps}),this.view=new Ka(M,{expanded:this.foldable_.value("expanded"),pickerLayout:N.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(le=this.view.buttonElement)===null||le===void 0||le.addEventListener("blur",this.onPadButtonBlur_),(Ie=this.view.buttonElement)===null||Ie===void 0||Ie.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),or({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:yt=>yt.rawValue,backward:(yt,on)=>on.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Le(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(M){if(!this.popC_)return;const N=this.view.element,le=M.relatedTarget;le&&N.contains(le)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(M){if(!this.popC_)return;const N=this.popC_.view.element,le=Gt(M);le&&N.contains(le)||le&&le===this.view.buttonElement&&!nn(N.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(M){this.popC_?M.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&M.key==="Escape"&&this.view.buttonElement.focus()}}class Il{constructor(M=0,N=0,le=0){this.x=M,this.y=N,this.z=le}getComponents(){return[this.x,this.y,this.z]}static isObject(M){if(D(M))return!1;const N=M.x,le=M.y,Ie=M.z;return typeof N=="number"&&typeof le=="number"&&typeof Ie=="number"}static equals(M,N){return M.x===N.x&&M.y===N.y&&M.z===N.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const uf={toComponents:ee=>ee.getComponents(),fromComponents:ee=>new Il(...ee)};function xm(ee){return Il.isObject(ee)?new Il(ee.x,ee.y,ee.z):new Il}function Gr(ee,M){ee.writeProperty("x",M.x),ee.writeProperty("y",M.y),ee.writeProperty("z",M.z)}function Pa(ee,M){return{baseStep:vh(M),constraint:M,textProps:ye.fromObject({draggingScale:yh(M,ee),formatter:$i(Yp(M,ee))})}}const rc={id:"input-point3d",type:"input",accept:(ee,M)=>{if(!Il.isObject(ee))return null;const N=Fe,le=Ve(M,{x:N.optional.custom(su),y:N.optional.custom(su),z:N.optional.custom(su)});return le?{initialValue:ee,params:le}:null},binding:{reader:ee=>xm,constraint:ee=>{return M=ee.params,N=ee.initialValue,new ml({assembly:uf,components:[fs("x"in M?M.x:void 0,N.x),fs("y"in M?M.y:void 0,N.y),fs("z"in M?M.z:void 0,N.z)]});var M,N},equals:Il.equals,writer:ee=>Gr},controller:ee=>{const M=ee.value,N=ee.constraint;if(!(N instanceof ml))throw J.shouldNeverHappen();return new Rd(ee.document,{assembly:uf,axes:[Pa(M.rawValue.x,N.components[0]),Pa(M.rawValue.y,N.components[1]),Pa(M.rawValue.z,N.components[2])],parser:Ur,value:M,viewProps:ee.viewProps})}};class $a{constructor(M=0,N=0,le=0,Ie=0){this.x=M,this.y=N,this.z=le,this.w=Ie}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(M){if(D(M))return!1;const N=M.x,le=M.y,Ie=M.z,ct=M.w;return typeof N=="number"&&typeof le=="number"&&typeof Ie=="number"&&typeof ct=="number"}static equals(M,N){return M.x===N.x&&M.y===N.y&&M.z===N.z&&M.w===N.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const gl={toComponents:ee=>ee.getComponents(),fromComponents:ee=>new $a(...ee)};function _l(ee){return $a.isObject(ee)?new $a(ee.x,ee.y,ee.z,ee.w):new $a}function sc(ee,M){ee.writeProperty("x",M.x),ee.writeProperty("y",M.y),ee.writeProperty("z",M.z),ee.writeProperty("w",M.w)}const wm={id:"input-point4d",type:"input",accept:(ee,M)=>{if(!$a.isObject(ee))return null;const N=Fe,le=Ve(M,{x:N.optional.custom(su),y:N.optional.custom(su),z:N.optional.custom(su),w:N.optional.custom(su)});return le?{initialValue:ee,params:le}:null},binding:{reader:ee=>_l,constraint:ee=>{return M=ee.params,N=ee.initialValue,new ml({assembly:gl,components:[fs("x"in M?M.x:void 0,N.x),fs("y"in M?M.y:void 0,N.y),fs("z"in M?M.z:void 0,N.z),fs("w"in M?M.w:void 0,N.w)]});var M,N},equals:$a.equals,writer:ee=>sc},controller:ee=>{const M=ee.value,N=ee.constraint;if(!(N instanceof ml))throw J.shouldNeverHappen();return new Rd(ee.document,{assembly:gl,axes:M.rawValue.getComponents().map((le,Ie)=>{return ct=le,{baseStep:vh(yt=N.components[Ie]),constraint:yt,textProps:ye.fromObject({draggingScale:yh(yt,ct),formatter:$i(Yp(yt,ct))})};var ct,yt}),parser:Ur,value:M,viewProps:ee.viewProps})}},Th={id:"input-string",type:"input",accept:(ee,M)=>{if(typeof ee!="string")return null;const N=Ve(M,{options:Fe.optional.custom(qp)});return N?{initialValue:ee,params:N}:null},binding:{reader:ee=>uo,constraint:ee=>function(M){const N=[],le=_m(M.options);return le&&N.push(le),new Ni(N)}(ee.params),writer:ee=>Mc},controller:ee=>{const M=ee.document,N=ee.value,le=ee.constraint,Ie=le&&Me(le,We);return Ie?new lt(M,{props:new ye({options:Ie.values.value("options")}),value:N,viewProps:ee.viewProps}):new Zn(M,{parser:ct=>ct,props:ye.fromObject({formatter:Eo}),value:N,viewProps:ee.viewProps})}},du={monitor:{defaultInterval:200,defaultLineCount:3}},kc=V("mll");class Uc{constructor(M,N){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=N.formatter,this.element=M.createElement("div"),this.element.classList.add(kc()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("textarea");le.classList.add(kc("i")),le.style.height=`calc(var(--bld-us) * ${N.lineCount})`,le.readOnly=!0,N.viewProps.bindDisabled(le),this.element.appendChild(le),this.textareaElem_=le,N.value.emitter.on("change",this.onValueUpdate_),this.value=N.value,this.update_()}update_(){const M=this.textareaElem_,N=M.scrollTop===M.scrollHeight-M.clientHeight,le=[];this.value.rawValue.forEach(Ie=>{Ie!==void 0&&le.push(this.formatter_(Ie))}),M.textContent=le.join(`
`),N&&(M.scrollTop=M.scrollHeight)}onValueUpdate_(){this.update_()}}class zo{constructor(M,N){this.value=N.value,this.viewProps=N.viewProps,this.view=new Uc(M,{formatter:N.formatter,lineCount:N.lineCount,value:this.value,viewProps:this.viewProps})}}const Em=V("sgl");class Vo{constructor(M,N){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=N.formatter,this.element=M.createElement("div"),this.element.classList.add(Em()),N.viewProps.bindClassModifiers(this.element);const le=M.createElement("input");le.classList.add(Em("i")),le.readOnly=!0,le.type="text",N.viewProps.bindDisabled(le),this.element.appendChild(le),this.inputElement=le,N.value.emitter.on("change",this.onValueUpdate_),this.value=N.value,this.update_()}update_(){const M=this.value.rawValue,N=M[M.length-1];this.inputElement.value=N!==void 0?this.formatter_(N):""}onValueUpdate_(){this.update_()}}class Pd{constructor(M,N){this.value=N.value,this.viewProps=N.viewProps,this.view=new Vo(M,{formatter:N.formatter,value:this.value,viewProps:this.viewProps})}}const Fc={id:"monitor-bool",type:"monitor",accept:(ee,M)=>{if(typeof ee!="boolean")return null;const N=Ve(M,{lineCount:Fe.optional.number});return N?{initialValue:ee,params:N}:null},binding:{reader:ee=>On},controller:ee=>{var M;return ee.value.rawValue.length===1?new Pd(ee.document,{formatter:Yt,value:ee.value,viewProps:ee.viewProps}):new zo(ee.document,{formatter:Yt,lineCount:(M=ee.params.lineCount)!==null&&M!==void 0?M:du.monitor.defaultLineCount,value:ee.value,viewProps:ee.viewProps})}},ho=V("grl");class zc{constructor(M,N){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=M.createElement("div"),this.element.classList.add(ho()),N.viewProps.bindClassModifiers(this.element),this.formatter_=N.formatter,this.props_=N.props,this.cursor_=N.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const le=M.createElementNS(wt,"svg");le.classList.add(ho("g")),le.style.height=`calc(var(--bld-us) * ${N.lineCount})`,this.element.appendChild(le),this.svgElem_=le;const Ie=M.createElementNS(wt,"polyline");this.svgElem_.appendChild(Ie),this.lineElem_=Ie;const ct=M.createElement("div");ct.classList.add(ho("t"),V("tt")()),this.element.appendChild(ct),this.tooltipElem_=ct,N.value.emitter.on("change",this.onValueUpdate_),this.value=N.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const M=this.svgElem_.getBoundingClientRect(),N=this.value.rawValue.length-1,le=this.props_.get("minValue"),Ie=this.props_.get("maxValue"),ct=[];this.value.rawValue.forEach((yr,Es)=>{if(yr===void 0)return;const da=ss(Es,0,N,0,M.width),jo=ss(yr,le,Ie,M.height,0);ct.push([da,jo].join(","))}),this.lineElem_.setAttributeNS(null,"points",ct.join(" "));const yt=this.tooltipElem_,on=this.value.rawValue[this.cursor_.rawValue];if(on===void 0)return void yt.classList.remove(ho("t","a"));const ei=ss(this.cursor_.rawValue,0,N,0,M.width),Ci=ss(on,le,Ie,M.height,0);yt.style.left=`${ei}px`,yt.style.top=`${Ci}px`,yt.textContent=`${this.formatter_(on)}`,yt.classList.contains(ho("t","a"))||(yt.classList.add(ho("t","a"),ho("t","in")),Zt(yt),yt.classList.remove(ho("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Da{constructor(M,N){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=N.props,this.value=N.value,this.viewProps=N.viewProps,this.cursor_=me(-1),this.view=new zc(M,{cursor:this.cursor_,formatter:N.formatter,lineCount:N.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),nn(M)){const le=new Tc(this.view.element);le.emitter.on("down",this.onGraphPointerDown_),le.emitter.on("move",this.onGraphPointerMove_),le.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(M){const N=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(ss(M.offsetX,0,N.width,0,this.value.rawValue.length))}onGraphPointerDown_(M){this.onGraphPointerMove_(M)}onGraphPointerMove_(M){M.data.point?this.cursor_.rawValue=Math.floor(ss(M.data.point.x,0,M.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Mi(ee){return"format"in ee&&!D(ee.format)?ee.format:$i(2)}function us(ee){return"view"in ee&&ee.view==="graph"}const ys={id:"monitor-number",type:"monitor",accept:(ee,M)=>{if(typeof ee!="number")return null;const N=Fe,le=Ve(M,{format:N.optional.function,lineCount:N.optional.number,max:N.optional.number,min:N.optional.number,view:N.optional.string});return le?{initialValue:ee,params:le}:null},binding:{defaultBufferSize:ee=>us(ee)?64:1,reader:ee=>Oo},controller:ee=>us(ee.params)?function(M){var N,le,Ie;return new Da(M.document,{formatter:Mi(M.params),lineCount:(N=M.params.lineCount)!==null&&N!==void 0?N:du.monitor.defaultLineCount,props:ye.fromObject({maxValue:(le="max"in M.params?M.params.max:null)!==null&&le!==void 0?le:100,minValue:(Ie="min"in M.params?M.params.min:null)!==null&&Ie!==void 0?Ie:0}),value:M.value,viewProps:M.viewProps})}(ee):function(M){var N;return M.value.rawValue.length===1?new Pd(M.document,{formatter:Mi(M.params),value:M.value,viewProps:M.viewProps}):new zo(M.document,{formatter:Mi(M.params),lineCount:(N=M.params.lineCount)!==null&&N!==void 0?N:du.monitor.defaultLineCount,value:M.value,viewProps:M.viewProps})}(ee)},Pl={id:"monitor-string",type:"monitor",accept:(ee,M)=>{if(typeof ee!="string")return null;const N=Fe,le=Ve(M,{lineCount:N.optional.number,multiline:N.optional.boolean});return le?{initialValue:ee,params:le}:null},binding:{reader:ee=>uo},controller:ee=>{var M;const N=ee.value;return N.rawValue.length>1||"multiline"in ee.params&&ee.params.multiline?new zo(ee.document,{formatter:Eo,lineCount:(M=ee.params.lineCount)!==null&&M!==void 0?M:du.monitor.defaultLineCount,value:N,viewProps:ee.viewProps}):new Pd(ee.document,{formatter:Eo,value:N,viewProps:ee.viewProps})}};function ps(ee,M){return M===0?new ln:new mn(ee,M??du.monitor.defaultInterval)}class ea{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(M){M.type==="blade"?this.pluginsMap_.blades.unshift(M):M.type==="input"?this.pluginsMap_.inputs.unshift(M):M.type==="monitor"&&this.pluginsMap_.monitors.unshift(M)}createInput(M,N,le){if(D(N.read()))throw new J({context:{key:N.key},type:"nomatchingcontroller"});const Ie=this.pluginsMap_.inputs.reduce((ct,yt)=>ct??function(on,ei){const Ci=on.accept(ei.target.read(),ei.params);if(D(Ci))return null;const yr=Fe,Es={target:ei.target,initialValue:Ci.initialValue,params:Ci.params},da=on.binding.reader(Es),jo=on.binding.constraint?on.binding.constraint(Es):void 0,Dl=me(da(Ci.initialValue),{constraint:jo,equals:on.binding.equals}),ju=new Pi({reader:da,target:ei.target,value:Dl,writer:on.binding.writer(Es)}),fu=yr.optional.boolean(ei.params.disabled).value,Ld=yr.optional.boolean(ei.params.hidden).value,Gu=on.controller({constraint:jo,document:ei.document,initialValue:Ci.initialValue,params:Ci.params,value:ju.value,viewProps:Pt.create({disabled:fu,hidden:Ld})}),Ch=yr.optional.string(ei.params.label).value;return new Mt(ei.document,{binding:ju,blade:Bn(),props:ye.fromObject({label:Ch??ei.target.key}),valueController:Gu})}(yt,{document:M,target:N,params:le}),null);if(Ie)return Ie;throw new J({context:{key:N.key},type:"nomatchingcontroller"})}createMonitor(M,N,le){const Ie=this.pluginsMap_.monitors.reduce((ct,yt)=>ct??function(on,ei){var Ci,yr,Es;const da=Fe,jo=on.accept(ei.target.read(),ei.params);if(D(jo))return null;const Dl={target:ei.target,initialValue:jo.initialValue,params:jo.params},ju=on.binding.reader(Dl),fu=(yr=(Ci=da.optional.number(ei.params.bufferSize).value)!==null&&Ci!==void 0?Ci:on.binding.defaultBufferSize&&on.binding.defaultBufferSize(jo.params))!==null&&yr!==void 0?yr:1,Ld=da.optional.number(ei.params.interval).value,Gu=new Hn({reader:ju,target:ei.target,ticker:ps(ei.document,Ld),value:En(fu)}),Ch=da.optional.boolean(ei.params.disabled).value,Bd=da.optional.boolean(ei.params.hidden).value,pf=on.controller({document:ei.document,params:jo.params,value:Gu.value,viewProps:Pt.create({disabled:Ch,hidden:Bd})}),Co=(Es=da.optional.string(ei.params.label).value)!==null&&Es!==void 0?Es:ei.target.key;return new xt(ei.document,{binding:Gu,blade:Bn(),props:ye.fromObject({label:Co}),valueController:pf})}(yt,{document:M,params:le,target:N}),null);if(Ie)return Ie;throw new J({context:{key:N.key},type:"nomatchingcontroller"})}createBlade(M,N){const le=this.pluginsMap_.blades.reduce((Ie,ct)=>Ie??function(yt,on){const ei=yt.accept(on.params);if(!ei)return null;const Ci=Fe.optional.boolean(on.params.disabled).value,yr=Fe.optional.boolean(on.params.hidden).value;return yt.controller({blade:Bn(),document:on.document,params:Object.assign(Object.assign({},ei.params),{disabled:Ci,hidden:yr}),viewProps:Pt.create({disabled:Ci,hidden:yr})})}(ct,{document:M,params:N}),null);if(!le)throw new J({type:"nomatchingview",context:{params:N}});return le}createBladeApi(M){if(M instanceof Mt)return new pt(M);if(M instanceof xt)return new Bt(M);if(M instanceof Dn)return new en(M,this);const N=this.pluginsMap_.blades.reduce((le,Ie)=>le??Ie.api({controller:M,pool:this}),null);if(!N)throw J.shouldNeverHappen();return N}}function zu(ee){return Ya.isObject(ee)?new Ya(ee.x,ee.y):new Ya}function x_(ee,M){ee.writeProperty("x",M.x),ee.writeProperty("y",M.y)}function fs(ee,M){if(!ee)return;const N=[],le=Nc(ee,M);le&&N.push(le);const Ie=Zo(ee);return Ie&&N.push(Ie),new Ni(N)}function Vu(ee,M){const[N,le]=ee?function(ct){const yt=Me(ct,Ee);if(yt)return[yt.values.get("min"),yt.values.get("max")];const on=Me(ct,it);return on?[on.minValue,on.maxValue]:[void 0,void 0]}(ee):[];if(!D(N)||!D(le))return Math.max(Math.abs(N??0),Math.abs(le??0));const Ie=vh(ee);return Math.max(10*Math.abs(Ie),10*Math.abs(M))}function As(ee,M){const N=M instanceof ml?M.components[0]:void 0,le=M instanceof ml?M.components[1]:void 0,Ie=Vu(N,ee.x),ct=Vu(le,ee.y);return Math.max(Ie,ct)}function hf(ee,M){return{baseStep:vh(M),constraint:M,textProps:ye.fromObject({draggingScale:yh(M,ee),formatter:$i(Yp(M,ee))})}}function oc(ee){if(!("y"in ee))return!1;const M=ee.y;return!!M&&"inverted"in M&&!!M.inverted}const w_={id:"input-point2d",type:"input",accept:(ee,M)=>{if(!Ya.isObject(ee))return null;const N=Fe,le=Ve(M,{expanded:N.optional.boolean,picker:N.optional.custom(ts),x:N.optional.custom(su),y:N.optional.object({inverted:N.optional.boolean,max:N.optional.number,min:N.optional.number,step:N.optional.number})});return le?{initialValue:ee,params:le}:null},binding:{reader:ee=>zu,constraint:ee=>{return M=ee.params,N=ee.initialValue,new ml({assembly:To,components:[fs("x"in M?M.x:void 0,N.x),fs("y"in M?M.y:void 0,N.y)]});var M,N},equals:Ya.equals,writer:ee=>x_},controller:ee=>{const M=ee.document,N=ee.value,le=ee.constraint;if(!(le instanceof ml))throw J.shouldNeverHappen();const Ie="expanded"in ee.params?ee.params.expanded:void 0,ct="picker"in ee.params?ee.params.picker:void 0;return new Fu(M,{axes:[hf(N.rawValue.x,le.components[0]),hf(N.rawValue.y,le.components[1])],expanded:Ie!=null&&Ie,invertsY:oc(ee.params),maxValue:As(N.rawValue,le),parser:Ur,pickerLayout:ct??"popup",value:N,viewProps:ee.viewProps})}};class Sm extends m{constructor(M){super(M),this.emitter_=new ne,this.controller_.valueController.value.emitter.on("change",N=>{this.emitter_.emit("change",{event:new A(this,N.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(M){this.controller_.props.set("label",M)}get options(){return this.controller_.valueController.props.get("options")}set options(M){this.controller_.valueController.props.set("options",M)}get value(){return this.controller_.valueController.value.rawValue}set value(M){this.controller_.valueController.value.rawValue=M}on(M,N){const le=N.bind(this);return this.emitter_.on(M,Ie=>{le(Ie.event)}),this}}class pu extends m{constructor(M){super(M),this.emitter_=new ne,this.controller_.valueController.value.emitter.on("change",N=>{this.emitter_.emit("change",{event:new A(this,N.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(M){this.controller_.props.set("label",M)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(M){this.controller_.valueController.sliderController.props.set("maxValue",M)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(M){this.controller_.valueController.sliderController.props.set("minValue",M)}get value(){return this.controller_.valueController.value.rawValue}set value(M){this.controller_.valueController.value.rawValue=M}on(M,N){const le=N.bind(this);return this.emitter_.on(M,Ie=>{le(Ie.event)}),this}}class ha extends m{constructor(M){super(M),this.emitter_=new ne,this.controller_.valueController.value.emitter.on("change",N=>{this.emitter_.emit("change",{event:new A(this,N.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(M){this.controller_.props.set("label",M)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(M){this.controller_.valueController.props.set("formatter",M)}get value(){return this.controller_.valueController.value.rawValue}set value(M){this.controller_.valueController.value.rawValue=M}on(M,N){const le=N.bind(this);return this.emitter_.on(M,Ie=>{le(Ie.event)}),this}}const Dd={id:"list",type:"blade",accept(ee){const M=Fe,N=Ve(ee,{options:M.required.custom(qp),value:M.required.raw,view:M.required.constant("list"),label:M.optional.string});return N?{params:N}:null},controller(ee){const M=new We(v_(ee.params.options)),N=me(ee.params.value,{constraint:M}),le=new lt(ee.document,{props:new ye({options:M.values.value("options")}),value:N,viewProps:ee.viewProps});return new wr(ee.document,{blade:ee.blade,props:ye.fromObject({label:ee.params.label}),valueController:le})},api(ee){return ee.controller instanceof wr&&ee.controller.valueController instanceof lt?new Sm(ee.controller):null}};class Tm extends xn{constructor(M,N){super(M,N)}get element(){return this.controller_.view.element}importPreset(M){(function(N,le){N.forEach(Ie=>{const ct=le[Ie.target.presetKey];ct!==void 0&&Ie.writer(Ie.target,Ie.reader(ct))})})(this.controller_.rackController.rack.find(Mt).map(N=>N.binding),M),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(Mt).map(M=>M.binding.target).reduce((M,N)=>Object.assign(M,{[N.presetKey]:N.read()}),{})}refresh(){this.controller_.rackController.rack.find(Mt).forEach(M=>{M.binding.read()}),this.controller_.rackController.rack.find(xt).forEach(M=>{M.binding.read()})}}class ki extends Nr{constructor(M,N){super(M,{expanded:N.expanded,blade:N.blade,props:N.props,root:!0,viewProps:N.viewProps})}}const df={id:"slider",type:"blade",accept(ee){const M=Fe,N=Ve(ee,{max:M.required.number,min:M.required.number,view:M.required.constant("slider"),format:M.optional.function,label:M.optional.string,value:M.optional.number});return N?{params:N}:null},controller(ee){var M,N;const le=(M=ee.params.value)!==null&&M!==void 0?M:0,Ie=new Ee({max:ee.params.max,min:ee.params.min}),ct=new Ed(ee.document,{baseStep:1,parser:Ur,sliderProps:new ye({maxValue:Ie.values.value("max"),minValue:Ie.values.value("min")}),textProps:ye.fromObject({draggingScale:yh(void 0,le),formatter:(N=ee.params.format)!==null&&N!==void 0?N:Er}),value:me(le,{constraint:Ie}),viewProps:ee.viewProps});return new wr(ee.document,{blade:ee.blade,props:ye.fromObject({label:ee.params.label}),valueController:ct})},api(ee){return ee.controller instanceof wr&&ee.controller.valueController instanceof Ed?new pu(ee.controller):null}},E_={id:"text",type:"blade",accept(ee){const M=Fe,N=Ve(ee,{parse:M.required.function,value:M.required.raw,view:M.required.constant("text"),format:M.optional.function,label:M.optional.string});return N?{params:N}:null},controller(ee){var M;const N=new Zn(ee.document,{parser:ee.params.parse,props:ye.fromObject({formatter:(M=ee.params.format)!==null&&M!==void 0?M:le=>String(le)}),value:me(ee.params.value),viewProps:ee.viewProps});return new wr(ee.document,{blade:ee.blade,props:ye.fromObject({label:ee.params.label}),valueController:N})},api(ee){return ee.controller instanceof wr&&ee.controller.valueController instanceof Zn?new ha(ee.controller):null}};function La(ee,M,N){if(ee.querySelector(`style[data-tp-style=${M}]`))return;const le=ee.createElement("style");le.dataset.tpStyle=M,le.textContent=N,ee.head.appendChild(le)}const Mh=new class{constructor(ee){const[M,N]=ee.split("-"),le=M.split(".");this.major=parseInt(le[0],10),this.minor=parseInt(le[1],10),this.patch=parseInt(le[2],10),this.prerelease=N??null}toString(){const ee=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[ee,this.prerelease].join("-"):ee}}("3.1.6");i.BladeApi=m,i.ButtonApi=oe,i.FolderApi=xn,i.InputBindingApi=pt,i.ListApi=Sm,i.MonitorBindingApi=Bt,i.Pane=class extends Tm{constructor(ee){var M,N;const le=ee??{},Ie=(M=le.document)!==null&&M!==void 0?M:Vn(),ct=function(){const yt=new ea;return[w_,rc,wm,Th,af,qa,Oc,ds,Cc,Fc,Pl,ys,An,Pr,xs,bn].forEach(on=>{yt.register(on)}),yt}();super(new ki(Ie,{expanded:le.expanded,blade:Bn(),props:ye.fromObject({title:le.title}),viewProps:Pt.create()}),ct),this.pool_=ct,this.containerElem_=(N=le.container)!==null&&N!==void 0?N:function(yt){const on=yt.createElement("div");return on.classList.add(V("dfw")()),yt.body&&yt.body.appendChild(on),on}(Ie),this.containerElem_.appendChild(this.element),this.doc_=Ie,this.usesDefaultWrapper_=!le.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw J.alreadyDisposed();return this.doc_}dispose(){const ee=this.containerElem_;if(!ee)throw J.alreadyDisposed();if(this.usesDefaultWrapper_){const M=ee.parentElement;M&&M.removeChild(ee)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(ee){("plugin"in ee?[ee.plugin]:"plugins"in ee?ee.plugins:[]).forEach(M=>{this.pool_.register(M),this.embedPluginStyle_(M)})}embedPluginStyle_(ee){ee.css&&La(this.document,`plugin-${ee.id}`,ee.css)}setUpDefaultPlugins_(){La(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(ee=>{this.embedPluginStyle_(ee)}),this.registerPlugin({plugins:[df,Dd,bn,E_]})}},i.SeparatorApi=es,i.SliderApi=pu,i.TabApi=Jl,i.TabPageApi=co,i.TextApi=ha,i.TpChangeEvent=A,i.VERSION=Mh,Object.defineProperty(i,"__esModule",{value:!0})})(r)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(u){super(u),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}transform(u,r){return u?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(u,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(u=!0,r=!1){return u&&super.preload(),r&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var u;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(u=eval(jsContent+`
DracoEncoderModule;`))==null?void 0:u()}),this.encoderPending}async initDecoder(){var u;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async r=>r.text()).then(r=>{const i=r.indexOf("/* worker */");if(i<1)throw new Error("unable to load decoder module");return r.substring(0,i-1)});return(u=eval(jsContent+`
DracoDecoderModule;`))==null?void 0:u()}}},988:function(u,r,i){i.d(r,{$TI:function(){return NE},$V:function(){return Vb},$Vf:function(){return Mg},$YQ:function(){return z_},A5E:function(){return x_},AXT:function(){return Zd},Aip:function(){return XE},B02:function(){return D},BFQ:function(){return bn},BG$:function(){return qe},BKK:function(){return My},BVF:function(){return Et},BVQ:function(){return Au},BbS:function(){return fp},Bf4:function(){return Le},BtG:function(){return Mm},CJI:function(){return zo},CP7:function(){return O0},CaW:function(){return nr},CdI:function(){return fn},Cne:function(){return Cg},CtA:function(){return ul},CtF:function(){return Wc},D1R:function(){return Gi},D9w:function(){return Jl},DT1:function(){return Kb},Djp:function(){return _t},DqL:function(){return qf},DvJ:function(){return ac},E2K:function(){return gt},EB7:function(){return H0},EJi:function(){return _s},EoG:function(){return Gt},F5T:function(){return Vo},FDw:function(){return Pe},FE5:function(){return op},FIo:function(){return Cb},FM8:function(){return jn},FT0:function(){return Wf},FUD:function(){return Ut},FvO:function(){return Wb},GG6:function(){return Xt},GQ:function(){return zE},GUF:function(){return ws},GVz:function(){return Am},GZb:function(){return $b},G_r:function(){return Ha},Gih:function(){return In},Gql:function(){return ly},H$k:function(){return Ju},HTd:function(){return ht},HW6:function(){return QE},HdW:function(){return si},HgB:function(){return Yp},HkE:function(){return Xu},Hmr:function(){return bg},Hw6:function(){return Ic},Hy8:function(){return Ye},Hyl:function(){return Gc},IEO:function(){return Yu},IFH:function(){return to},IKL:function(){return Hf},ILR:function(){return mn},IOt:function(){return Fs},Ilk:function(){return Mi},Ir4:function(){return _m},JOQ:function(){return Ih},JQ4:function(){return Nr},JUT:function(){return nf},JWc:function(){return su},KI_:function(){return or},Kgo:function(){return Hh},KhW:function(){return Te},Kj0:function(){return Co},Kz5:function(){return ui},L5g:function(){return qE},L5s:function(){return Fa},LBq:function(){return jb},LSk:function(){return vm},LY2:function(){return qt},L_r:function(){return $p},Lcc:function(){return Jb},LgZ:function(){return Ve},LsT:function(){return kn},Ltg:function(){return Yr},Lun:function(){return xf},M5h:function(){return he},M6v:function(){return Jn},M8C:function(){return Ta},Mig:function(){return cv},MyG:function(){return g_},N$j:function(){return ls},N4l:function(){return ue},NDo:function(){return Lt},NMF:function(){return kr},NYV:function(){return lt},Ns1:function(){return Ue},NwF:function(){return xl},Ny0:function(){return Y_},O7d:function(){return fg},OAl:function(){return gm},OM3:function(){return df},OTo:function(){return cl},OdW:function(){return Rf},OoA:function(){return Mt},Ox3:function(){return Vl},PA7:function(){return uo},PMe:function(){return oy},Pa4:function(){return At},PeU:function(){return w},Pnf:function(){return ur},PpQ:function(){return Sd},QM0:function(){return v_},QRU:function(){return PE},QZ1:function(){return ts},QmN:function(){return A},Qpg:function(){return Qb},R2R:function(){return Ro},REq:function(){return GE},RNb:function(){return hf},ROQ:function(){return W0},RSm:function(){return Rb},Rki:function(){return Tu},RlZ:function(){return Pt},RsA:function(){return _},RvT:function(){return _h},S2y:function(){return R},S3k:function(){return Yf},S9g:function(){return Zo},SJI:function(){return LE},SPe:function(){return Jm},SUY:function(){return hp},Se2:function(){return Ne},Sm8:function(){return ae},So8:function(){return uy},SvJ:function(){return On},Syv:function(){return Zi},T95:function(){return pn},TOt:function(){return q0},TUj:function(){return Gb},TUv:function(){return ma},T_1:function(){return Yb},T_J:function(){return m_},T__:function(){return Q0},T_f:function(){return Nb},TlE:function(){return As},Tme:function(){return Gr},Tn7:function(){return ro},TyD:function(){return Bt},U7:function(){return $_},USm:function(){return Nc},UY4:function(){return Q_},UZH:function(){return m},Uk6:function(){return iv},UlW:function(){return as},Uol:function(){return Hc},V1s:function(){return Hu},V4E:function(){return WE},VLJ:function(){return Xb},VYz:function(){return mv},Vdb:function(){return Ze},Vj0:function(){return Ja},Vkp:function(){return Dr},VzW:function(){return Pr},W2J:function(){return Mc},WMw:function(){return ce},WTc:function(){return oc},WXh:function(){return Vf},Wbm:function(){return ie},WdD:function(){return Hr},Wid:function(){return ga},Wjw:function(){return Sv},Wl3:function(){return $},Wpd:function(){return tt},Wqd:function(){return Z_},WwZ:function(){return Ln},Wzm:function(){return EE},XZw:function(){return YE},Xaj:function(){return K},Xcj:function(){return OE},XvJ:function(){return bu},Y8D:function(){return wo},YBo:function(){return ny},YGz:function(){return hn},YKA:function(){return Oi},YLQ:function(){return xt},YN5:function(){return rh},YT8:function(){return Bf},Ywn:function(){return g0},Z6B:function(){return yh},ZAu:function(){return Uh},ZQ6:function(){return J_},ZRs:function(){return ss},ZTh:function(){return _i},ZZA:function(){return sv},Z_g:function(){return SE},Zp0:function(){return cp},Zr5:function(){return et},ZzF:function(){return ec},Zzh:function(){return Av},_12:function(){return Nd},_3:function(){return Sy},_AM:function(){return Pi},_C8:function(){return _g},_Li:function(){return oe},_MY:function(){return U},_YM:function(){return eh},_YX:function(){return nl},_am:function(){return zA},_fP:function(){return No},_iA:function(){return k},_kC:function(){return wu},_lf:function(){return eo},_sL:function(){return Jo},a$l:function(){return ki},aCh:function(){return Eo},aH4:function(){return zt},aLr:function(){return ko},aNw:function(){return wl},aVm:function(){return Sm},ad5:function(){return Xp},anP:function(){return I_},aq0:function(){return yy},av9:function(){return mh},b5g:function(){return wf},bBp:function(){return vv},bGH:function(){return Y},b_z:function(){return Of},bdR:function(){return z},blk:function(){return G0},bnF:function(){return tp},brP:function(){return Bo},bsb:function(){return Yt},c8b:function(){return me},cBI:function(){return xy},cBK:function(){return Db},cJO:function(){return mg},cLu:function(){return wr},cPb:function(){return Go},cRx:function(){return Cl},cU9:function(){return Wh},ce8:function(){return Tc},cek:function(){return Bb},cum:function(){return Ed},dSO:function(){return Ae},dUE:function(){return lp},dYG:function(){return Qf},dZ3:function(){return An},dd2:function(){return vo},dj0:function(){return qp},dpR:function(){return Lb},dwk:function(){return J},e62:function(){return Tm},eD:function(){return Zt},eMJ:function(){return Wa},eaV:function(){return En},ehD:function(){return ne},ejS:function(){return bl},ekQ:function(){return Me},epp:function(){return Ca},fHI:function(){return ep},fO1:function(){return wE},fQA:function(){return FE},fQK:function(){return vb},fSK:function(){return ot},fY$:function(){return Bn},fto:function(){return Hn},g8_:function(){return Oe},gH0:function(){return Fb},gSk:function(){return gs},g_z:function(){return rg},ghN:function(){return ye},gi4:function(){return je},gti:function(){return sg},hEm:function(){return co},hH6:function(){return po},iAb:function(){return Dn},iDF:function(){return pc},iKG:function(){return C_},iLg:function(){return th},iMs:function(){return UE},iUV:function(){return ns},iWC:function(){return ke},iWj:function(){return T_},i_9:function(){return Eu},iiP:function(){return Zn},irR:function(){return Ps},j4z:function(){return m0},j87:function(){return ha},jAl:function(){return Yn},jFi:function(){return V},jZA:function(){return We},jfJ:function(){return wd},jwo:function(){return gh},jyi:function(){return Qd},jyz:function(){return ta},k0A:function(){return es},k74:function(){return Fe},kB5:function(){return Ho},kFz:function(){return Td},kaV:function(){return Ib},knz:function(){return Er},kqm:function(){return xg},ksN:function(){return nn},l0P:function(){return Ni},l8J:function(){return vh},lCJ:function(){return Dd},lDi:function(){return kb},lGU:function(){return Ii},lLk:function(){return ry},lRF:function(){return Qm},lRj:function(){return wi},lb7:function(){return Vh},lfu:function(){return xu},lk7:function(){return uv},m7l:function(){return Xf},mSO:function(){return ir},mTL:function(){return cy},mXe:function(){return X0},m_w:function(){return Ty},mzJ:function(){return fy},nls:function(){return ka},ntZ:function(){return X},ntt:function(){return Sc},nvb:function(){return jE},o8S:function(){return gg},oAp:function(){return VA},oa8:function(){return Ff},oqc:function(){return no},p3g:function(){return ca},p7y:function(){return yu},pBf:function(){return Cc},pIN:function(){return sr},pKu:function(){return cn},pQR:function(){return sp},ptH:function(){return Ee},qhX:function(){return St},qkB:function(){return Zs},qlB:function(){return pu},qyh:function(){return xn},rAo:function(){return w_},rBU:function(){return Ri},rDY:function(){return v0},rOj:function(){return ve},r_:function(){return re},rnI:function(){return Oo},rpg:function(){return $e},s4_:function(){return ay},sYA:function(){return CE},tEQ:function(){return Pb},tGC:function(){return wy},tJx:function(){return VE},tUh:function(){return Qo},tf:function(){return gv},tm_:function(){return T},trn:function(){return Tg},u37:function(){return dy},u7G:function(){return hv},u9r:function(){return Ie},uEv:function(){return Ki},uL9:function(){return jt},uWy:function(){return pt},uXU:function(){return Ms},ub3:function(){return H},ujx:function(){return HE},v3W:function(){return ln},v9Y:function(){return Kp},vBJ:function(){return ys},vCF:function(){return wt},vCx:function(){return Di},vZf:function(){return dn},vmT:function(){return Qh},vpT:function(){return Km},vuL:function(){return Tn},vxC:function(){return de},w$m:function(){return Vn},wJv:function(){return Jr},wem:function(){return en},wk1:function(){return xs},woe:function(){return q_},wuA:function(){return Wt},x12:function(){return Ku},x5V:function(){return _o},xEZ:function(){return Vs},xG9:function(){return bv},xJs:function(){return Nt},xWb:function(){return Su},xeV:function(){return Gd},xfE:function(){return _n},xo$:function(){return zf},xoR:function(){return Gf},xsS:function(){return qu},y$t:function(){return og},y2t:function(){return it},y8_:function(){return Ey},yC1:function(){return ra},yGw:function(){return Sr},ybr:function(){return Ef},yj7:function(){return ig},ylh:function(){return kE},yo9:function(){return Ym},yt0:function(){return __},ywz:function(){return oi},yxD:function(){return av},z$h:function(){return Ur},z81:function(){return $i},z8B:function(){return N0},zHn:function(){return Bc},zbs:function(){return iy},zf8:function(){return ag}});const m="152",_={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},A={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},w=0,T=1,R=2,D=3,U=0,k=1,X=2,J=3,$=0,oe=1,ne=2,H=2,V=0,z=1,ce=2,ue=3,he=4,K=5,Y=100,ie=101,ve=102,re=103,ae=104,me=200,ye=201,Te=202,ke=203,Fe=204,Ve=205,ot=206,Ye=207,Ze=208,tt=209,Pt=210,Et=0,Ne=1,et=2,wt=3,Zt=4,nn=5,Vn=6,Jn=7,Ue=0,St=1,Lt=2,jt=0,Gt=1,fn=2,hn=3,qt=4,An=5,_n=300,Bn=301,de=302,Ae=303,Le=304,Oe=306,$e=1e3,pt=1001,Mt=1002,Bt=1003,xt=1004,ht=1004,zt=1005,dn=1005,en=1006,xn=1007,wi=1007,Gi=1008,Pe=1008,oi=1009,pn=1010,Dn=1011,kn=1012,ui=1013,Nr=1014,Pr=1015,wr=1016,es=1017,Ps=1018,Jr=1020,cl=1021,xs=1023,wo=1024,Cl=1025,Zs=1026,Bo=1027,co=1028,Jl=1029,mh=1030,ul=1031,gt=1033,Wt=33776,bn=33777,ln=33778,mn=33779,Pi=35840,Di=35841,En=35842,nr=35843,Hn=36196,Ni=37492,Me=37496,Ee=37808,We=37809,it=37810,je=37811,_t=37812,qe=37813,lt=37814,Nt=37815,cn=37816,Xt=37817,In=37818,Ut=37819,Zn=37820,On=37821,Yt=36492,si=36283,Tn=36284,_i=36285,Ii=36286,Yn=2200,Oi=2201,Ki=2202,Zi=2300,kr=2301,sr=2302,ur=2400,eo=2401,Jo=2402,to=2500,gs=2501,Ln=0,as=1,Ur=2,Oo=3e3,Er=3001,$i=3200,ir=3201,Fs=0,uo=1,Eo="",or="srgb",ws="srgb-linear",Sc="display-p3",Ha="rgbm-16",Xp=0,_o=7680,Tc=7681,ss=7682,wd=7683,no=34055,m_=34056,Wa=5386,g_=512,Ms=513,gh=514,__=515,gm=516,_h=517,m0=518,Ed=519,Mc=35044,qp=35048,ts=35040,su=35045,v_=35049,_m=35041,Yp=35046,vh=35050,yh=35042,Kp="100",vm="300 es",$p=1035;class Cc{addEventListener(o,d){this._listeners===void 0&&(this._listeners={});const v=this._listeners;v[o]===void 0&&(v[o]=[]),v[o].indexOf(d)===-1&&v[o].push(d)}hasEventListener(o,d){if(this._listeners===void 0)return!1;const v=this._listeners;return v[o]!==void 0&&v[o].indexOf(d)!==-1}removeEventListener(o,d){if(this._listeners===void 0)return;const v=this._listeners[o];if(v!==void 0){const b=v.indexOf(d);b!==-1&&v.splice(b,1)}}dispatchEvent(o){if(this._listeners===void 0)return;const d=this._listeners[o.type];if(d!==void 0){o.target=this;const v=d.slice(0);for(let b=0,E=v.length;b<E;b++)v[b].call(this,o);o.target=null}}}const Hs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let y_=1234567;const ou=Math.PI/180,hl=180/Math.PI;function Sa(){const I=4294967295*Math.random()|0,o=4294967295*Math.random()|0,d=4294967295*Math.random()|0,v=4294967295*Math.random()|0;return(Hs[255&I]+Hs[I>>8&255]+Hs[I>>16&255]+Hs[I>>24&255]+"-"+Hs[255&o]+Hs[o>>8&255]+"-"+Hs[o>>16&15|64]+Hs[o>>24&255]+"-"+Hs[63&d|128]+Hs[d>>8&255]+"-"+Hs[d>>16&255]+Hs[d>>24&255]+Hs[255&v]+Hs[v>>8&255]+Hs[v>>16&255]+Hs[v>>24&255]).toLowerCase()}function zs(I,o,d){return Math.max(o,Math.min(d,I))}function Bu(I,o){return(I%o+o)%o}function Ah(I,o,d){return(1-d)*I+d*o}function bh(I){return(I&I-1)==0&&I!==0}function qr(I){return Math.pow(2,Math.ceil(Math.log(I)/Math.LN2))}function Zl(I){return Math.pow(2,Math.floor(Math.log(I)/Math.LN2))}function Qa(I,o){switch(o.constructor){case Float32Array:return I;case Uint16Array:return I/65535;case Uint8Array:return I/255;case Int16Array:return Math.max(I/32767,-1);case Int8Array:return Math.max(I/127,-1);default:throw new Error("Invalid component type.")}}function Vr(I,o){switch(o.constructor){case Float32Array:return I;case Uint16Array:return Math.round(65535*I);case Uint8Array:return Math.round(255*I);case Int16Array:return Math.round(32767*I);case Int8Array:return Math.round(127*I);default:throw new Error("Invalid component type.")}}const Ta={DEG2RAD:ou,RAD2DEG:hl,generateUUID:Sa,clamp:zs,euclideanModulo:Bu,mapLinear:function(I,o,d,v,b){return v+(I-o)*(b-v)/(d-o)},inverseLerp:function(I,o,d){return I!==o?(d-I)/(o-I):0},lerp:Ah,damp:function(I,o,d,v){return Ah(I,o,1-Math.exp(-d*v))},pingpong:function(I,o=1){return o-Math.abs(Bu(I,2*o)-o)},smoothstep:function(I,o,d){return I<=o?0:I>=d?1:(I=(I-o)/(d-o))*I*(3-2*I)},smootherstep:function(I,o,d){return I<=o?0:I>=d?1:(I=(I-o)/(d-o))*I*I*(I*(6*I-15)+10)},randInt:function(I,o){return I+Math.floor(Math.random()*(o-I+1))},randFloat:function(I,o){return I+Math.random()*(o-I)},randFloatSpread:function(I){return I*(.5-Math.random())},seededRandom:function(I){I!==void 0&&(y_=I);let o=y_+=1831565813;return o=Math.imul(o^o>>>15,1|o),o^=o+Math.imul(o^o>>>7,61|o),((o^o>>>14)>>>0)/4294967296},degToRad:function(I){return I*ou},radToDeg:function(I){return I*hl},isPowerOfTwo:bh,ceilPowerOfTwo:qr,floorPowerOfTwo:Zl,setQuaternionFromProperEuler:function(I,o,d,v,b){const E=Math.cos,P=Math.sin,O=E(d/2),Q=P(d/2),G=E((o+v)/2),te=P((o+v)/2),ge=E((o-v)/2),fe=P((o-v)/2),_e=E((v-o)/2),xe=P((v-o)/2);switch(b){case"XYX":I.set(O*te,Q*ge,Q*fe,O*G);break;case"YZY":I.set(Q*fe,O*te,Q*ge,O*G);break;case"ZXZ":I.set(Q*ge,Q*fe,O*te,O*G);break;case"XZX":I.set(O*te,Q*xe,Q*_e,O*G);break;case"YXY":I.set(Q*_e,O*te,Q*xe,O*G);break;case"ZYZ":I.set(Q*xe,Q*_e,O*te,O*G);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+b)}},normalize:Vr,denormalize:Qa};class jn{constructor(o=0,d=0){jn.prototype.isVector2=!0,this.x=o,this.y=d}get width(){return this.x}set width(o){this.x=o}get height(){return this.y}set height(o){this.y=o}set(o,d){return this.x=o,this.y=d,this}setScalar(o){return this.x=o,this.y=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setComponent(o,d){switch(o){case 0:this.x=d;break;case 1:this.y=d;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y)}copy(o){return this.x=o.x,this.y=o.y,this}add(o){return this.x+=o.x,this.y+=o.y,this}addScalar(o){return this.x+=o,this.y+=o,this}addVectors(o,d){return this.x=o.x+d.x,this.y=o.y+d.y,this}addScaledVector(o,d){return this.x+=o.x*d,this.y+=o.y*d,this}sub(o){return this.x-=o.x,this.y-=o.y,this}subScalar(o){return this.x-=o,this.y-=o,this}subVectors(o,d){return this.x=o.x-d.x,this.y=o.y-d.y,this}multiply(o){return this.x*=o.x,this.y*=o.y,this}multiplyScalar(o){return this.x*=o,this.y*=o,this}divide(o){return this.x/=o.x,this.y/=o.y,this}divideScalar(o){return this.multiplyScalar(1/o)}applyMatrix3(o){const d=this.x,v=this.y,b=o.elements;return this.x=b[0]*d+b[3]*v+b[6],this.y=b[1]*d+b[4]*v+b[7],this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this}clamp(o,d){return this.x=Math.max(o.x,Math.min(d.x,this.x)),this.y=Math.max(o.y,Math.min(d.y,this.y)),this}clampScalar(o,d){return this.x=Math.max(o,Math.min(d,this.x)),this.y=Math.max(o,Math.min(d,this.y)),this}clampLength(o,d){const v=this.length();return this.divideScalar(v||1).multiplyScalar(Math.max(o,Math.min(d,v)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(o){return this.x*o.x+this.y*o.y}cross(o){return this.x*o.y-this.y*o.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(o){const d=Math.sqrt(this.lengthSq()*o.lengthSq());if(d===0)return Math.PI/2;const v=this.dot(o)/d;return Math.acos(zs(v,-1,1))}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const d=this.x-o.x,v=this.y-o.y;return d*d+v*v}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,d){return this.x+=(o.x-this.x)*d,this.y+=(o.y-this.y)*d,this}lerpVectors(o,d,v){return this.x=o.x+(d.x-o.x)*v,this.y=o.y+(d.y-o.y)*v,this}equals(o){return o.x===this.x&&o.y===this.y}fromArray(o,d=0){return this.x=o[d],this.y=o[d+1],this}toArray(o=[],d=0){return o[d]=this.x,o[d+1]=this.y,o}fromBufferAttribute(o,d){return this.x=o.getX(d),this.y=o.getY(d),this}rotateAround(o,d){const v=Math.cos(d),b=Math.sin(d),E=this.x-o.x,P=this.y-o.y;return this.x=E*v-P*b+o.x,this.y=E*b+P*v+o.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dr{constructor(){Dr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(o,d,v,b,E,P,O,Q,G){const te=this.elements;return te[0]=o,te[1]=b,te[2]=O,te[3]=d,te[4]=E,te[5]=Q,te[6]=v,te[7]=P,te[8]=G,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(o){const d=this.elements,v=o.elements;return d[0]=v[0],d[1]=v[1],d[2]=v[2],d[3]=v[3],d[4]=v[4],d[5]=v[5],d[6]=v[6],d[7]=v[7],d[8]=v[8],this}extractBasis(o,d,v){return o.setFromMatrix3Column(this,0),d.setFromMatrix3Column(this,1),v.setFromMatrix3Column(this,2),this}setFromMatrix4(o){const d=o.elements;return this.set(d[0],d[4],d[8],d[1],d[5],d[9],d[2],d[6],d[10]),this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,d){const v=o.elements,b=d.elements,E=this.elements,P=v[0],O=v[3],Q=v[6],G=v[1],te=v[4],ge=v[7],fe=v[2],_e=v[5],xe=v[8],Re=b[0],we=b[3],Ce=b[6],De=b[1],ze=b[4],dt=b[7],rt=b[2],st=b[5],It=b[8];return E[0]=P*Re+O*De+Q*rt,E[3]=P*we+O*ze+Q*st,E[6]=P*Ce+O*dt+Q*It,E[1]=G*Re+te*De+ge*rt,E[4]=G*we+te*ze+ge*st,E[7]=G*Ce+te*dt+ge*It,E[2]=fe*Re+_e*De+xe*rt,E[5]=fe*we+_e*ze+xe*st,E[8]=fe*Ce+_e*dt+xe*It,this}multiplyScalar(o){const d=this.elements;return d[0]*=o,d[3]*=o,d[6]*=o,d[1]*=o,d[4]*=o,d[7]*=o,d[2]*=o,d[5]*=o,d[8]*=o,this}determinant(){const o=this.elements,d=o[0],v=o[1],b=o[2],E=o[3],P=o[4],O=o[5],Q=o[6],G=o[7],te=o[8];return d*P*te-d*O*G-v*E*te+v*O*Q+b*E*G-b*P*Q}invert(){const o=this.elements,d=o[0],v=o[1],b=o[2],E=o[3],P=o[4],O=o[5],Q=o[6],G=o[7],te=o[8],ge=te*P-O*G,fe=O*Q-te*E,_e=G*E-P*Q,xe=d*ge+v*fe+b*_e;if(xe===0)return this.set(0,0,0,0,0,0,0,0,0);const Re=1/xe;return o[0]=ge*Re,o[1]=(b*G-te*v)*Re,o[2]=(O*v-b*P)*Re,o[3]=fe*Re,o[4]=(te*d-b*Q)*Re,o[5]=(b*E-O*d)*Re,o[6]=_e*Re,o[7]=(v*Q-G*d)*Re,o[8]=(P*d-v*E)*Re,this}transpose(){let o;const d=this.elements;return o=d[1],d[1]=d[3],d[3]=o,o=d[2],d[2]=d[6],d[6]=o,o=d[5],d[5]=d[7],d[7]=o,this}getNormalMatrix(o){return this.setFromMatrix4(o).invert().transpose()}transposeIntoArray(o){const d=this.elements;return o[0]=d[0],o[1]=d[3],o[2]=d[6],o[3]=d[1],o[4]=d[4],o[5]=d[7],o[6]=d[2],o[7]=d[5],o[8]=d[8],this}setUvTransform(o,d,v,b,E,P,O){const Q=Math.cos(E),G=Math.sin(E);return this.set(v*Q,v*G,-v*(Q*P+G*O)+P+o,-b*G,b*Q,-b*(-G*P+Q*O)+O+d,0,0,1),this}scale(o,d){return this.premultiply(la.makeScale(o,d)),this}rotate(o){return this.premultiply(la.makeRotation(-o)),this}translate(o,d){return this.premultiply(la.makeTranslation(o,d)),this}makeTranslation(o,d){return this.set(1,0,o,0,1,d,0,0,1),this}makeRotation(o){const d=Math.cos(o),v=Math.sin(o);return this.set(d,-v,0,v,d,0,0,0,1),this}makeScale(o,d){return this.set(o,0,0,0,d,0,0,0,1),this}equals(o){const d=this.elements,v=o.elements;for(let b=0;b<9;b++)if(d[b]!==v[b])return!1;return!0}fromArray(o,d=0){for(let v=0;v<9;v++)this.elements[v]=o[v+d];return this}toArray(o=[],d=0){const v=this.elements;return o[d]=v[0],o[d+1]=v[1],o[d+2]=v[2],o[d+3]=v[3],o[d+4]=v[4],o[d+5]=v[5],o[d+6]=v[6],o[d+7]=v[7],o[d+8]=v[8],o}clone(){return new this.constructor().fromArray(this.elements)}}const la=new Dr;function Jp(I){for(let o=I.length-1;o>=0;--o)if(I[o]>=65535)return!0;return!1}const Zp={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function dl(I,o){return new Zp[I](o)}function xh(I){return document.createElementNS("http://www.w3.org/1999/xhtml",I)}const Rc={};function Ma(I){I in Rc||(Rc[I]=!0,console.warn(I))}function Ou(I){return I<.04045?.0773993808*I:Math.pow(.9478672986*I+.0521327014,2.4)}function ef(I){return I<.0031308?12.92*I:1.055*Math.pow(I,.41666)-.055}const ym=new Dr().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),tf=new Dr().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),A_={[ws]:I=>I,[or]:I=>I.convertSRGBToLinear(),[Sc]:function(I){return I.convertSRGBToLinear().applyMatrix3(tf)}},b_={[ws]:I=>I,[or]:I=>I.convertLinearToSRGB(),[Sc]:function(I){return I.applyMatrix3(ym).convertLinearToSRGB()}},Ca={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(I){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!I},get workingColorSpace(){return ws},set workingColorSpace(I){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(I,o,d){if(this.enabled===!1||o===d||!o||!d)return I;const v=A_[o],b=b_[d];if(v===void 0||b===void 0)throw new Error(`Unsupported color space conversion, "${o}" to "${d}".`);return b(v(I))},fromWorkingColorSpace:function(I,o){return this.convert(I,this.workingColorSpace,o)},toWorkingColorSpace:function(I,o){return this.convert(I,o,this.workingColorSpace)}};let au;class Sd{static getDataURL(o,d=!1){if(/^data:/i.test(o.src)||typeof HTMLCanvasElement>"u")return o.src;let v;if(o instanceof HTMLCanvasElement)v=o;else{au===void 0&&(au=xh("canvas")),au.width=o.width,au.height=o.height;const b=au.getContext("2d");o instanceof ImageData?b.putImageData(o,0,0):b.drawImage(o,0,0,o.width,o.height),v=au}return!d&&(v.width>2048||v.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",o),v.toDataURL("image/jpeg",.6)):v.toDataURL("image/png")}static sRGBToLinear(o){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const d=xh("canvas");d.width=o.width,d.height=o.height;const v=d.getContext("2d");v.drawImage(o,0,0,o.width,o.height);const b=v.getImageData(0,0,o.width,o.height),E=b.data;for(let P=0;P<E.length;P++)E[P]=255*Ou(E[P]/255);return v.putImageData(b,0,0),d}if(o.data){const d=o.data.slice(0);for(let v=0;v<d.length;v++)d instanceof Uint8Array||d instanceof Uint8ClampedArray?d[v]=Math.floor(255*Ou(d[v]/255)):d[v]=Ou(d[v]);return{data:d,width:o.width,height:o.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),o}}class Ic{constructor(o=null){this.isSource=!0,this.uuid=Sa(),this.data=o,this.version=0}set needsUpdate(o){o===!0&&this.version++}toJSON(o){const d=o===void 0||typeof o=="string";if(!d&&o.images[this.uuid]!==void 0)return o.images[this.uuid];const v={uuid:this.uuid,url:""},b=this.data;if(b!==null){let E;if(Array.isArray(b)){E=[];for(let P=0,O=b.length;P<O;P++)b[P].isDataTexture?E.push(lu(b[P].image)):E.push(lu(b[P]))}else E=lu(b);v.url=E}return d||(o.images[this.uuid]=v),v}}function lu(I){if(typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&I instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&I instanceof ImageBitmap)return Sd.getDataURL(I);if(I.data){let o=[];try{o=Array.from(I.data)}catch(d){d.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(d),o=I.data}return{data:o,width:I.width,height:I.height,type:I.data.constructor.name}}return I.url!==void 0?I.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Ra=0;class Vs extends Cc{constructor(o=Vs.DEFAULT_IMAGE,d=Vs.DEFAULT_MAPPING,v=pt,b=pt,E=en,P=Gi,O=xs,Q=oi,G=Vs.DEFAULT_ANISOTROPY,te=Eo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Ra++}),this.uuid=Sa(),this.name="",this.source=new Ic(o),this.mipmaps=[],this.mapping=d,this.channel=0,this.wrapS=v,this.wrapT=b,this.magFilter=E,this.minFilter=P,this.anisotropy=G,this.format=O,this.internalFormat=null,this.type=Q,this.offset=new jn(0,0),this.repeat=new jn(1,1),this.center=new jn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof te=="string"?this.colorSpace=te:(Ma("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=te===Er?or:Eo),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(o=null){this.source.data=o}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(o){return this.name=o.name,this.source=o.source,this.mipmaps=o.mipmaps.slice(0),this.mapping=o.mapping,this.channel=o.channel,this.wrapS=o.wrapS,this.wrapT=o.wrapT,this.magFilter=o.magFilter,this.minFilter=o.minFilter,this.anisotropy=o.anisotropy,this.format=o.format,this.internalFormat=o.internalFormat,this.type=o.type,this.offset.copy(o.offset),this.repeat.copy(o.repeat),this.center.copy(o.center),this.rotation=o.rotation,this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrix.copy(o.matrix),this.generateMipmaps=o.generateMipmaps,this.premultiplyAlpha=o.premultiplyAlpha,this.flipY=o.flipY,this.unpackAlignment=o.unpackAlignment,this.colorSpace=o.colorSpace,this.userData=JSON.parse(JSON.stringify(o.userData)),this.needsUpdate=!0,this}toJSON(o){const d=o===void 0||typeof o=="string";if(!d&&o.textures[this.uuid]!==void 0)return o.textures[this.uuid];const v={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(o).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===or?Er:Oo,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(v.userData=this.userData),d||(o.textures[this.uuid]=v),v}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(o){if(this.mapping!==_n)return o;if(o.applyMatrix3(this.matrix),o.x<0||o.x>1)switch(this.wrapS){case $e:o.x=o.x-Math.floor(o.x);break;case pt:o.x=o.x<0?0:1;break;case Mt:Math.abs(Math.floor(o.x)%2)===1?o.x=Math.ceil(o.x)-o.x:o.x=o.x-Math.floor(o.x)}if(o.y<0||o.y>1)switch(this.wrapT){case $e:o.y=o.y-Math.floor(o.y);break;case pt:o.y=o.y<0?0:1;break;case Mt:Math.abs(Math.floor(o.y)%2)===1?o.y=Math.ceil(o.y)-o.y:o.y=o.y-Math.floor(o.y)}return this.flipY&&(o.y=1-o.y),o}set needsUpdate(o){o===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return Ma("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===or?Er:Oo}set encoding(o){Ma("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=o===Er?or:Eo}}Vs.DEFAULT_IMAGE=null,Vs.DEFAULT_MAPPING=_n,Vs.DEFAULT_ANISOTROPY=1;class Yr{constructor(o=0,d=0,v=0,b=1){Yr.prototype.isVector4=!0,this.x=o,this.y=d,this.z=v,this.w=b}get width(){return this.z}set width(o){this.z=o}get height(){return this.w}set height(o){this.w=o}set(o,d,v,b){return this.x=o,this.y=d,this.z=v,this.w=b,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this.w=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setW(o){return this.w=o,this}setComponent(o,d){switch(o){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;case 3:this.w=d;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w!==void 0?o.w:1,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this.w+=o.w,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this.w+=o,this}addVectors(o,d){return this.x=o.x+d.x,this.y=o.y+d.y,this.z=o.z+d.z,this.w=o.w+d.w,this}addScaledVector(o,d){return this.x+=o.x*d,this.y+=o.y*d,this.z+=o.z*d,this.w+=o.w*d,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this.w-=o.w,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this.w-=o,this}subVectors(o,d){return this.x=o.x-d.x,this.y=o.y-d.y,this.z=o.z-d.z,this.w=o.w-d.w,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this.w*=o.w,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this.w*=o,this}applyMatrix4(o){const d=this.x,v=this.y,b=this.z,E=this.w,P=o.elements;return this.x=P[0]*d+P[4]*v+P[8]*b+P[12]*E,this.y=P[1]*d+P[5]*v+P[9]*b+P[13]*E,this.z=P[2]*d+P[6]*v+P[10]*b+P[14]*E,this.w=P[3]*d+P[7]*v+P[11]*b+P[15]*E,this}divideScalar(o){return this.multiplyScalar(1/o)}setAxisAngleFromQuaternion(o){this.w=2*Math.acos(o.w);const d=Math.sqrt(1-o.w*o.w);return d<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=o.x/d,this.y=o.y/d,this.z=o.z/d),this}setAxisAngleFromRotationMatrix(o){let d,v,b,E;const Q=o.elements,G=Q[0],te=Q[4],ge=Q[8],fe=Q[1],_e=Q[5],xe=Q[9],Re=Q[2],we=Q[6],Ce=Q[10];if(Math.abs(te-fe)<.01&&Math.abs(ge-Re)<.01&&Math.abs(xe-we)<.01){if(Math.abs(te+fe)<.1&&Math.abs(ge+Re)<.1&&Math.abs(xe+we)<.1&&Math.abs(G+_e+Ce-3)<.1)return this.set(1,0,0,0),this;d=Math.PI;const ze=(G+1)/2,dt=(_e+1)/2,rt=(Ce+1)/2,st=(te+fe)/4,It=(ge+Re)/4,Kt=(xe+we)/4;return ze>dt&&ze>rt?ze<.01?(v=0,b=.707106781,E=.707106781):(v=Math.sqrt(ze),b=st/v,E=It/v):dt>rt?dt<.01?(v=.707106781,b=0,E=.707106781):(b=Math.sqrt(dt),v=st/b,E=Kt/b):rt<.01?(v=.707106781,b=.707106781,E=0):(E=Math.sqrt(rt),v=It/E,b=Kt/E),this.set(v,b,E,d),this}let De=Math.sqrt((we-xe)*(we-xe)+(ge-Re)*(ge-Re)+(fe-te)*(fe-te));return Math.abs(De)<.001&&(De=1),this.x=(we-xe)/De,this.y=(ge-Re)/De,this.z=(fe-te)/De,this.w=Math.acos((G+_e+Ce-1)/2),this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this.w=Math.min(this.w,o.w),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this.w=Math.max(this.w,o.w),this}clamp(o,d){return this.x=Math.max(o.x,Math.min(d.x,this.x)),this.y=Math.max(o.y,Math.min(d.y,this.y)),this.z=Math.max(o.z,Math.min(d.z,this.z)),this.w=Math.max(o.w,Math.min(d.w,this.w)),this}clampScalar(o,d){return this.x=Math.max(o,Math.min(d,this.x)),this.y=Math.max(o,Math.min(d,this.y)),this.z=Math.max(o,Math.min(d,this.z)),this.w=Math.max(o,Math.min(d,this.w)),this}clampLength(o,d){const v=this.length();return this.divideScalar(v||1).multiplyScalar(Math.max(o,Math.min(d,v)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z+this.w*o.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,d){return this.x+=(o.x-this.x)*d,this.y+=(o.y-this.y)*d,this.z+=(o.z-this.z)*d,this.w+=(o.w-this.w)*d,this}lerpVectors(o,d,v){return this.x=o.x+(d.x-o.x)*v,this.y=o.y+(d.y-o.y)*v,this.z=o.z+(d.z-o.z)*v,this.w=o.w+(d.w-o.w)*v,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z&&o.w===this.w}fromArray(o,d=0){return this.x=o[d],this.y=o[d+1],this.z=o[d+2],this.w=o[d+3],this}toArray(o=[],d=0){return o[d]=this.x,o[d+1]=this.y,o[d+2]=this.z,o[d+3]=this.w,o}fromBufferAttribute(o,d){return this.x=o.getX(d),this.y=o.getY(d),this.z=o.getZ(d),this.w=o.getW(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class vo extends Cc{constructor(o=1,d=1,v={}){super(),this.isWebGLRenderTarget=!0,this.width=o,this.height=d,this.depth=1,this.scissor=new Yr(0,0,o,d),this.scissorTest=!1,this.viewport=new Yr(0,0,o,d);const b={width:o,height:d,depth:1};v.encoding!==void 0&&(Ma("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),v.colorSpace=v.encoding===Er?or:Eo),this.texture=new Vs(b,v.mapping,v.wrapS,v.wrapT,v.magFilter,v.minFilter,v.format,v.type,v.anisotropy,v.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=v.generateMipmaps!==void 0&&v.generateMipmaps,this.texture.internalFormat=v.internalFormat!==void 0?v.internalFormat:null,this.texture.minFilter=v.minFilter!==void 0?v.minFilter:en,this.depthBuffer=v.depthBuffer===void 0||v.depthBuffer,this.stencilBuffer=v.stencilBuffer!==void 0&&v.stencilBuffer,this.depthTexture=v.depthTexture!==void 0?v.depthTexture:null,this.samples=v.samples!==void 0?v.samples:0}setSize(o,d,v=1){this.width===o&&this.height===d&&this.depth===v||(this.width=o,this.height=d,this.depth=v,this.texture.image.width=o,this.texture.image.height=d,this.texture.image.depth=v,this.dispose()),this.viewport.set(0,0,o,d),this.scissor.set(0,0,o,d)}clone(){return new this.constructor().copy(this)}copy(o){this.width=o.width,this.height=o.height,this.depth=o.depth,this.scissor.copy(o.scissor),this.scissorTest=o.scissorTest,this.viewport.copy(o.viewport),this.texture=o.texture.clone(),this.texture.isRenderTargetTexture=!0;const d=Object.assign({},o.texture.image);return this.texture.source=new Ic(d),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.samples=o.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ca extends Vs{constructor(o=null,d=1,v=1,b=1){super(null),this.isDataArrayTexture=!0,this.image={data:o,width:d,height:v,depth:b},this.magFilter=Bt,this.minFilter=Bt,this.wrapR=pt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Am extends vo{constructor(o=1,d=1,v=1){super(o,d),this.isWebGLArrayRenderTarget=!0,this.depth=v,this.texture=new ca(null,o,d,v),this.texture.isRenderTargetTexture=!0}}class nf extends Vs{constructor(o=null,d=1,v=1,b=1){super(null),this.isData3DTexture=!0,this.image={data:o,width:d,height:v,depth:b},this.magFilter=Bt,this.minFilter=Bt,this.wrapR=pt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class g0 extends vo{constructor(o=1,d=1,v=1){super(o,d),this.isWebGL3DRenderTarget=!0,this.depth=v,this.texture=new nf(null,o,d,v),this.texture.isRenderTargetTexture=!0}}class Td extends vo{constructor(o=1,d=1,v=1,b={}){super(o,d,b),this.isWebGLMultipleRenderTargets=!0;const E=this.texture;this.texture=[];for(let P=0;P<v;P++)this.texture[P]=E.clone(),this.texture[P].isRenderTargetTexture=!0}setSize(o,d,v=1){if(this.width!==o||this.height!==d||this.depth!==v){this.width=o,this.height=d,this.depth=v;for(let b=0,E=this.texture.length;b<E;b++)this.texture[b].image.width=o,this.texture[b].image.height=d,this.texture[b].image.depth=v;this.dispose()}return this.viewport.set(0,0,o,d),this.scissor.set(0,0,o,d),this}copy(o){this.dispose(),this.width=o.width,this.height=o.height,this.depth=o.depth,this.scissor.copy(o.scissor),this.scissorTest=o.scissorTest,this.viewport.copy(o.viewport),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.texture.length=0;for(let d=0,v=o.texture.length;d<v;d++)this.texture[d]=o.texture[d].clone(),this.texture[d].isRenderTargetTexture=!0;return this}}class No{constructor(o=0,d=0,v=0,b=1){this.isQuaternion=!0,this._x=o,this._y=d,this._z=v,this._w=b}static slerpFlat(o,d,v,b,E,P,O){let Q=v[b+0],G=v[b+1],te=v[b+2],ge=v[b+3];const fe=E[P+0],_e=E[P+1],xe=E[P+2],Re=E[P+3];if(O===0)return o[d+0]=Q,o[d+1]=G,o[d+2]=te,void(o[d+3]=ge);if(O===1)return o[d+0]=fe,o[d+1]=_e,o[d+2]=xe,void(o[d+3]=Re);if(ge!==Re||Q!==fe||G!==_e||te!==xe){let we=1-O;const Ce=Q*fe+G*_e+te*xe+ge*Re,De=Ce>=0?1:-1,ze=1-Ce*Ce;if(ze>Number.EPSILON){const rt=Math.sqrt(ze),st=Math.atan2(rt,Ce*De);we=Math.sin(we*st)/rt,O=Math.sin(O*st)/rt}const dt=O*De;if(Q=Q*we+fe*dt,G=G*we+_e*dt,te=te*we+xe*dt,ge=ge*we+Re*dt,we===1-O){const rt=1/Math.sqrt(Q*Q+G*G+te*te+ge*ge);Q*=rt,G*=rt,te*=rt,ge*=rt}}o[d]=Q,o[d+1]=G,o[d+2]=te,o[d+3]=ge}static multiplyQuaternionsFlat(o,d,v,b,E,P){const O=v[b],Q=v[b+1],G=v[b+2],te=v[b+3],ge=E[P],fe=E[P+1],_e=E[P+2],xe=E[P+3];return o[d]=O*xe+te*ge+Q*_e-G*fe,o[d+1]=Q*xe+te*fe+G*ge-O*_e,o[d+2]=G*xe+te*_e+O*fe-Q*ge,o[d+3]=te*xe-O*ge-Q*fe-G*_e,o}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get w(){return this._w}set w(o){this._w=o,this._onChangeCallback()}set(o,d,v,b){return this._x=o,this._y=d,this._z=v,this._w=b,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(o){return this._x=o.x,this._y=o.y,this._z=o.z,this._w=o.w,this._onChangeCallback(),this}setFromEuler(o,d){const v=o._x,b=o._y,E=o._z,P=o._order,O=Math.cos,Q=Math.sin,G=O(v/2),te=O(b/2),ge=O(E/2),fe=Q(v/2),_e=Q(b/2),xe=Q(E/2);switch(P){case"XYZ":this._x=fe*te*ge+G*_e*xe,this._y=G*_e*ge-fe*te*xe,this._z=G*te*xe+fe*_e*ge,this._w=G*te*ge-fe*_e*xe;break;case"YXZ":this._x=fe*te*ge+G*_e*xe,this._y=G*_e*ge-fe*te*xe,this._z=G*te*xe-fe*_e*ge,this._w=G*te*ge+fe*_e*xe;break;case"ZXY":this._x=fe*te*ge-G*_e*xe,this._y=G*_e*ge+fe*te*xe,this._z=G*te*xe+fe*_e*ge,this._w=G*te*ge-fe*_e*xe;break;case"ZYX":this._x=fe*te*ge-G*_e*xe,this._y=G*_e*ge+fe*te*xe,this._z=G*te*xe-fe*_e*ge,this._w=G*te*ge+fe*_e*xe;break;case"YZX":this._x=fe*te*ge+G*_e*xe,this._y=G*_e*ge+fe*te*xe,this._z=G*te*xe-fe*_e*ge,this._w=G*te*ge-fe*_e*xe;break;case"XZY":this._x=fe*te*ge-G*_e*xe,this._y=G*_e*ge-fe*te*xe,this._z=G*te*xe+fe*_e*ge,this._w=G*te*ge+fe*_e*xe;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+P)}return d!==!1&&this._onChangeCallback(),this}setFromAxisAngle(o,d){const v=d/2,b=Math.sin(v);return this._x=o.x*b,this._y=o.y*b,this._z=o.z*b,this._w=Math.cos(v),this._onChangeCallback(),this}setFromRotationMatrix(o){const d=o.elements,v=d[0],b=d[4],E=d[8],P=d[1],O=d[5],Q=d[9],G=d[2],te=d[6],ge=d[10],fe=v+O+ge;if(fe>0){const _e=.5/Math.sqrt(fe+1);this._w=.25/_e,this._x=(te-Q)*_e,this._y=(E-G)*_e,this._z=(P-b)*_e}else if(v>O&&v>ge){const _e=2*Math.sqrt(1+v-O-ge);this._w=(te-Q)/_e,this._x=.25*_e,this._y=(b+P)/_e,this._z=(E+G)/_e}else if(O>ge){const _e=2*Math.sqrt(1+O-v-ge);this._w=(E-G)/_e,this._x=(b+P)/_e,this._y=.25*_e,this._z=(Q+te)/_e}else{const _e=2*Math.sqrt(1+ge-v-O);this._w=(P-b)/_e,this._x=(E+G)/_e,this._y=(Q+te)/_e,this._z=.25*_e}return this._onChangeCallback(),this}setFromUnitVectors(o,d){let v=o.dot(d)+1;return v<Number.EPSILON?(v=0,Math.abs(o.x)>Math.abs(o.z)?(this._x=-o.y,this._y=o.x,this._z=0,this._w=v):(this._x=0,this._y=-o.z,this._z=o.y,this._w=v)):(this._x=o.y*d.z-o.z*d.y,this._y=o.z*d.x-o.x*d.z,this._z=o.x*d.y-o.y*d.x,this._w=v),this.normalize()}angleTo(o){return 2*Math.acos(Math.abs(zs(this.dot(o),-1,1)))}rotateTowards(o,d){const v=this.angleTo(o);if(v===0)return this;const b=Math.min(1,d/v);return this.slerp(o,b),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(o){return this._x*o._x+this._y*o._y+this._z*o._z+this._w*o._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let o=this.length();return o===0?(this._x=0,this._y=0,this._z=0,this._w=1):(o=1/o,this._x=this._x*o,this._y=this._y*o,this._z=this._z*o,this._w=this._w*o),this._onChangeCallback(),this}multiply(o){return this.multiplyQuaternions(this,o)}premultiply(o){return this.multiplyQuaternions(o,this)}multiplyQuaternions(o,d){const v=o._x,b=o._y,E=o._z,P=o._w,O=d._x,Q=d._y,G=d._z,te=d._w;return this._x=v*te+P*O+b*G-E*Q,this._y=b*te+P*Q+E*O-v*G,this._z=E*te+P*G+v*Q-b*O,this._w=P*te-v*O-b*Q-E*G,this._onChangeCallback(),this}slerp(o,d){if(d===0)return this;if(d===1)return this.copy(o);const v=this._x,b=this._y,E=this._z,P=this._w;let O=P*o._w+v*o._x+b*o._y+E*o._z;if(O<0?(this._w=-o._w,this._x=-o._x,this._y=-o._y,this._z=-o._z,O=-O):this.copy(o),O>=1)return this._w=P,this._x=v,this._y=b,this._z=E,this;const Q=1-O*O;if(Q<=Number.EPSILON){const _e=1-d;return this._w=_e*P+d*this._w,this._x=_e*v+d*this._x,this._y=_e*b+d*this._y,this._z=_e*E+d*this._z,this.normalize(),this._onChangeCallback(),this}const G=Math.sqrt(Q),te=Math.atan2(G,O),ge=Math.sin((1-d)*te)/G,fe=Math.sin(d*te)/G;return this._w=P*ge+this._w*fe,this._x=v*ge+this._x*fe,this._y=b*ge+this._y*fe,this._z=E*ge+this._z*fe,this._onChangeCallback(),this}slerpQuaternions(o,d,v){return this.copy(o).slerp(d,v)}random(){const o=Math.random(),d=Math.sqrt(1-o),v=Math.sqrt(o),b=2*Math.PI*Math.random(),E=2*Math.PI*Math.random();return this.set(d*Math.cos(b),v*Math.sin(E),v*Math.cos(E),d*Math.sin(b))}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._w===this._w}fromArray(o,d=0){return this._x=o[d],this._y=o[d+1],this._z=o[d+2],this._w=o[d+3],this._onChangeCallback(),this}toArray(o=[],d=0){return o[d]=this._x,o[d+1]=this._y,o[d+2]=this._z,o[d+3]=this._w,o}fromBufferAttribute(o,d){return this._x=o.getX(d),this._y=o.getY(d),this._z=o.getZ(d),this._w=o.getW(d),this}toJSON(){return this.toArray()}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class At{constructor(o=0,d=0,v=0){At.prototype.isVector3=!0,this.x=o,this.y=d,this.z=v}set(o,d,v){return v===void 0&&(v=this.z),this.x=o,this.y=d,this.z=v,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setComponent(o,d){switch(o){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this}addVectors(o,d){return this.x=o.x+d.x,this.y=o.y+d.y,this.z=o.z+d.z,this}addScaledVector(o,d){return this.x+=o.x*d,this.y+=o.y*d,this.z+=o.z*d,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this}subVectors(o,d){return this.x=o.x-d.x,this.y=o.y-d.y,this.z=o.z-d.z,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this}multiplyVectors(o,d){return this.x=o.x*d.x,this.y=o.y*d.y,this.z=o.z*d.z,this}applyEuler(o){return this.applyQuaternion(Eh.setFromEuler(o))}applyAxisAngle(o,d){return this.applyQuaternion(Eh.setFromAxisAngle(o,d))}applyMatrix3(o){const d=this.x,v=this.y,b=this.z,E=o.elements;return this.x=E[0]*d+E[3]*v+E[6]*b,this.y=E[1]*d+E[4]*v+E[7]*b,this.z=E[2]*d+E[5]*v+E[8]*b,this}applyNormalMatrix(o){return this.applyMatrix3(o).normalize()}applyMatrix4(o){const d=this.x,v=this.y,b=this.z,E=o.elements,P=1/(E[3]*d+E[7]*v+E[11]*b+E[15]);return this.x=(E[0]*d+E[4]*v+E[8]*b+E[12])*P,this.y=(E[1]*d+E[5]*v+E[9]*b+E[13])*P,this.z=(E[2]*d+E[6]*v+E[10]*b+E[14])*P,this}applyQuaternion(o){const d=this.x,v=this.y,b=this.z,E=o.x,P=o.y,O=o.z,Q=o.w,G=Q*d+P*b-O*v,te=Q*v+O*d-E*b,ge=Q*b+E*v-P*d,fe=-E*d-P*v-O*b;return this.x=G*Q+fe*-E+te*-O-ge*-P,this.y=te*Q+fe*-P+ge*-E-G*-O,this.z=ge*Q+fe*-O+G*-P-te*-E,this}project(o){return this.applyMatrix4(o.matrixWorldInverse).applyMatrix4(o.projectionMatrix)}unproject(o){return this.applyMatrix4(o.projectionMatrixInverse).applyMatrix4(o.matrixWorld)}transformDirection(o){const d=this.x,v=this.y,b=this.z,E=o.elements;return this.x=E[0]*d+E[4]*v+E[8]*b,this.y=E[1]*d+E[5]*v+E[9]*b,this.z=E[2]*d+E[6]*v+E[10]*b,this.normalize()}divide(o){return this.x/=o.x,this.y/=o.y,this.z/=o.z,this}divideScalar(o){return this.multiplyScalar(1/o)}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this}clamp(o,d){return this.x=Math.max(o.x,Math.min(d.x,this.x)),this.y=Math.max(o.y,Math.min(d.y,this.y)),this.z=Math.max(o.z,Math.min(d.z,this.z)),this}clampScalar(o,d){return this.x=Math.max(o,Math.min(d,this.x)),this.y=Math.max(o,Math.min(d,this.y)),this.z=Math.max(o,Math.min(d,this.z)),this}clampLength(o,d){const v=this.length();return this.divideScalar(v||1).multiplyScalar(Math.max(o,Math.min(d,v)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,d){return this.x+=(o.x-this.x)*d,this.y+=(o.y-this.y)*d,this.z+=(o.z-this.z)*d,this}lerpVectors(o,d,v){return this.x=o.x+(d.x-o.x)*v,this.y=o.y+(d.y-o.y)*v,this.z=o.z+(d.z-o.z)*v,this}cross(o){return this.crossVectors(this,o)}crossVectors(o,d){const v=o.x,b=o.y,E=o.z,P=d.x,O=d.y,Q=d.z;return this.x=b*Q-E*O,this.y=E*P-v*Q,this.z=v*O-b*P,this}projectOnVector(o){const d=o.lengthSq();if(d===0)return this.set(0,0,0);const v=o.dot(this)/d;return this.copy(o).multiplyScalar(v)}projectOnPlane(o){return wh.copy(this).projectOnVector(o),this.sub(wh)}reflect(o){return this.sub(wh.copy(o).multiplyScalar(2*this.dot(o)))}angleTo(o){const d=Math.sqrt(this.lengthSq()*o.lengthSq());if(d===0)return Math.PI/2;const v=this.dot(o)/d;return Math.acos(zs(v,-1,1))}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const d=this.x-o.x,v=this.y-o.y,b=this.z-o.z;return d*d+v*v+b*b}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)+Math.abs(this.z-o.z)}setFromSpherical(o){return this.setFromSphericalCoords(o.radius,o.phi,o.theta)}setFromSphericalCoords(o,d,v){const b=Math.sin(d)*o;return this.x=b*Math.sin(v),this.y=Math.cos(d)*o,this.z=b*Math.cos(v),this}setFromCylindrical(o){return this.setFromCylindricalCoords(o.radius,o.theta,o.y)}setFromCylindricalCoords(o,d,v){return this.x=o*Math.sin(d),this.y=v,this.z=o*Math.cos(d),this}setFromMatrixPosition(o){const d=o.elements;return this.x=d[12],this.y=d[13],this.z=d[14],this}setFromMatrixScale(o){const d=this.setFromMatrixColumn(o,0).length(),v=this.setFromMatrixColumn(o,1).length(),b=this.setFromMatrixColumn(o,2).length();return this.x=d,this.y=v,this.z=b,this}setFromMatrixColumn(o,d){return this.fromArray(o.elements,4*d)}setFromMatrix3Column(o,d){return this.fromArray(o.elements,3*d)}setFromEuler(o){return this.x=o._x,this.y=o._y,this.z=o._z,this}setFromColor(o){return this.x=o.r,this.y=o.g,this.z=o.b,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z}fromArray(o,d=0){return this.x=o[d],this.y=o[d+1],this.z=o[d+2],this}toArray(o=[],d=0){return o[d]=this.x,o[d+1]=this.y,o[d+2]=this.z,o}fromBufferAttribute(o,d){return this.x=o.getX(d),this.y=o.getY(d),this.z=o.getZ(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const o=2*(Math.random()-.5),d=Math.random()*Math.PI*2,v=Math.sqrt(1-o**2);return this.x=v*Math.cos(d),this.y=v*Math.sin(d),this.z=o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const wh=new At,Eh=new No;class ec{constructor(o=new At(1/0,1/0,1/0),d=new At(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=o,this.max=d}set(o,d){return this.min.copy(o),this.max.copy(d),this}setFromArray(o){this.makeEmpty();for(let d=0,v=o.length;d<v;d+=3)this.expandByPoint(Rl.fromArray(o,d));return this}setFromBufferAttribute(o){this.makeEmpty();for(let d=0,v=o.count;d<v;d++)this.expandByPoint(Rl.fromBufferAttribute(o,d));return this}setFromPoints(o){this.makeEmpty();for(let d=0,v=o.length;d<v;d++)this.expandByPoint(o[d]);return this}setFromCenterAndSize(o,d){const v=Rl.copy(d).multiplyScalar(.5);return this.min.copy(o).sub(v),this.max.copy(o).add(v),this}setFromObject(o,d=!1){return this.makeEmpty(),this.expandByObject(o,d)}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(o){return this.isEmpty()?o.set(0,0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}expandByObject(o,d=!1){if(o.updateWorldMatrix(!1,!1),o.boundingBox!==void 0)o.boundingBox===null&&o.computeBoundingBox(),tc.copy(o.boundingBox),tc.applyMatrix4(o.matrixWorld),this.union(tc);else{const b=o.geometry;if(b!==void 0)if(d&&b.attributes!==void 0&&b.attributes.position!==void 0){const E=b.attributes.position;for(let P=0,O=E.count;P<O;P++)Rl.fromBufferAttribute(E,P).applyMatrix4(o.matrixWorld),this.expandByPoint(Rl)}else b.boundingBox===null&&b.computeBoundingBox(),tc.copy(b.boundingBox),tc.applyMatrix4(o.matrixWorld),this.union(tc)}const v=o.children;for(let b=0,E=v.length;b<E;b++)this.expandByObject(v[b],d);return this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y||o.z<this.min.z||o.z>this.max.z)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y&&this.min.z<=o.min.z&&o.max.z<=this.max.z}getParameter(o,d){return d.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y),(o.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y||o.max.z<this.min.z||o.min.z>this.max.z)}intersectsSphere(o){return this.clampPoint(o.center,Rl),Rl.distanceToSquared(o.center)<=o.radius*o.radius}intersectsPlane(o){let d,v;return o.normal.x>0?(d=o.normal.x*this.min.x,v=o.normal.x*this.max.x):(d=o.normal.x*this.max.x,v=o.normal.x*this.min.x),o.normal.y>0?(d+=o.normal.y*this.min.y,v+=o.normal.y*this.max.y):(d+=o.normal.y*this.max.y,v+=o.normal.y*this.min.y),o.normal.z>0?(d+=o.normal.z*this.min.z,v+=o.normal.z*this.max.z):(d+=o.normal.z*this.max.z,v+=o.normal.z*this.min.z),d<=-o.constant&&v>=-o.constant}intersectsTriangle(o){if(this.isEmpty())return!1;this.getCenter(Md),cu.subVectors(this.max,Md),Nu.subVectors(o.a,Md),ku.subVectors(o.b,Md),Ia.subVectors(o.c,Md),Dc.subVectors(ku,Nu),Lc.subVectors(Ia,ku),nc.subVectors(Nu,Ia);let d=[0,-Dc.z,Dc.y,0,-Lc.z,Lc.y,0,-nc.z,nc.y,Dc.z,0,-Dc.x,Lc.z,0,-Lc.x,nc.z,0,-nc.x,-Dc.y,Dc.x,0,-Lc.y,Lc.x,0,-nc.y,nc.x,0];return!!jr(d,Nu,ku,Ia,cu)&&(d=[1,0,0,0,1,0,0,0,1],!!jr(d,Nu,ku,Ia,cu)&&(rf.crossVectors(Dc,Lc),d=[rf.x,rf.y,rf.z],jr(d,Nu,ku,Ia,cu)))}clampPoint(o,d){return d.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return this.clampPoint(o,Rl).distanceTo(o)}getBoundingSphere(o){return this.isEmpty()?o.makeEmpty():(this.getCenter(o.center),o.radius=.5*this.getSize(Rl).length()),o}intersect(o){return this.min.max(o.min),this.max.min(o.max),this.isEmpty()&&this.makeEmpty(),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}applyMatrix4(o){return this.isEmpty()||(Pc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(o),Pc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(o),Pc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(o),Pc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(o),Pc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(o),Pc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(o),Pc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(o),Pc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(o),this.setFromPoints(Pc)),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const Pc=[new At,new At,new At,new At,new At,new At,new At,new At],Rl=new At,tc=new ec,Nu=new At,ku=new At,Ia=new At,Dc=new At,Lc=new At,nc=new At,Md=new At,cu=new At,rf=new At,uu=new At;function jr(I,o,d,v,b){for(let E=0,P=I.length-3;E<=P;E+=3){uu.fromArray(I,E);const O=b.x*Math.abs(uu.x)+b.y*Math.abs(uu.y)+b.z*Math.abs(uu.z),Q=o.dot(uu),G=d.dot(uu),te=v.dot(uu);if(Math.max(-Math.max(Q,G,te),Math.min(Q,G,te))>O)return!1}return!0}const So=new ec,pl=new At,hu=new At;class ko{constructor(o=new At,d=-1){this.center=o,this.radius=d}set(o,d){return this.center.copy(o),this.radius=d,this}setFromPoints(o,d){const v=this.center;d!==void 0?v.copy(d):So.setFromPoints(o).getCenter(v);let b=0;for(let E=0,P=o.length;E<P;E++)b=Math.max(b,v.distanceToSquared(o[E]));return this.radius=Math.sqrt(b),this}copy(o){return this.center.copy(o.center),this.radius=o.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(o){return o.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(o){return o.distanceTo(this.center)-this.radius}intersectsSphere(o){const d=this.radius+o.radius;return o.center.distanceToSquared(this.center)<=d*d}intersectsBox(o){return o.intersectsSphere(this)}intersectsPlane(o){return Math.abs(o.distanceToPoint(this.center))<=this.radius}clampPoint(o,d){const v=this.center.distanceToSquared(o);return d.copy(o),v>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d}getBoundingBox(o){return this.isEmpty()?(o.makeEmpty(),o):(o.set(this.center,this.center),o.expandByScalar(this.radius),o)}applyMatrix4(o){return this.center.applyMatrix4(o),this.radius=this.radius*o.getMaxScaleOnAxis(),this}translate(o){return this.center.add(o),this}expandByPoint(o){if(this.isEmpty())return this.center.copy(o),this.radius=0,this;pl.subVectors(o,this.center);const d=pl.lengthSq();if(d>this.radius*this.radius){const v=Math.sqrt(d),b=.5*(v-this.radius);this.center.addScaledVector(pl,b/v),this.radius+=b}return this}union(o){return o.isEmpty()?this:this.isEmpty()?(this.copy(o),this):(this.center.equals(o.center)===!0?this.radius=Math.max(this.radius,o.radius):(hu.subVectors(o.center,this.center).setLength(o.radius),this.expandByPoint(pl.copy(o.center).add(hu)),this.expandByPoint(pl.copy(o.center).sub(hu))),this)}equals(o){return o.center.equals(this.center)&&o.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Xa=new At,sf=new At,Uu=new At,ic=new At,Sh=new At,Cd=new At,of=new At;class Bc{constructor(o=new At,d=new At(0,0,-1)){this.origin=o,this.direction=d}set(o,d){return this.origin.copy(o),this.direction.copy(d),this}copy(o){return this.origin.copy(o.origin),this.direction.copy(o.direction),this}at(o,d){return d.copy(this.origin).addScaledVector(this.direction,o)}lookAt(o){return this.direction.copy(o).sub(this.origin).normalize(),this}recast(o){return this.origin.copy(this.at(o,Xa)),this}closestPointToPoint(o,d){d.subVectors(o,this.origin);const v=d.dot(this.direction);return v<0?d.copy(this.origin):d.copy(this.origin).addScaledVector(this.direction,v)}distanceToPoint(o){return Math.sqrt(this.distanceSqToPoint(o))}distanceSqToPoint(o){const d=Xa.subVectors(o,this.origin).dot(this.direction);return d<0?this.origin.distanceToSquared(o):(Xa.copy(this.origin).addScaledVector(this.direction,d),Xa.distanceToSquared(o))}distanceSqToSegment(o,d,v,b){sf.copy(o).add(d).multiplyScalar(.5),Uu.copy(d).sub(o).normalize(),ic.copy(this.origin).sub(sf);const E=.5*o.distanceTo(d),P=-this.direction.dot(Uu),O=ic.dot(this.direction),Q=-ic.dot(Uu),G=ic.lengthSq(),te=Math.abs(1-P*P);let ge,fe,_e,xe;if(te>0)if(ge=P*Q-O,fe=P*O-Q,xe=E*te,ge>=0)if(fe>=-xe)if(fe<=xe){const Re=1/te;ge*=Re,fe*=Re,_e=ge*(ge+P*fe+2*O)+fe*(P*ge+fe+2*Q)+G}else fe=E,ge=Math.max(0,-(P*fe+O)),_e=-ge*ge+fe*(fe+2*Q)+G;else fe=-E,ge=Math.max(0,-(P*fe+O)),_e=-ge*ge+fe*(fe+2*Q)+G;else fe<=-xe?(ge=Math.max(0,-(-P*E+O)),fe=ge>0?-E:Math.min(Math.max(-E,-Q),E),_e=-ge*ge+fe*(fe+2*Q)+G):fe<=xe?(ge=0,fe=Math.min(Math.max(-E,-Q),E),_e=fe*(fe+2*Q)+G):(ge=Math.max(0,-(P*E+O)),fe=ge>0?E:Math.min(Math.max(-E,-Q),E),_e=-ge*ge+fe*(fe+2*Q)+G);else fe=P>0?-E:E,ge=Math.max(0,-(P*fe+O)),_e=-ge*ge+fe*(fe+2*Q)+G;return v&&v.copy(this.origin).addScaledVector(this.direction,ge),b&&b.copy(sf).addScaledVector(Uu,fe),_e}intersectSphere(o,d){Xa.subVectors(o.center,this.origin);const v=Xa.dot(this.direction),b=Xa.dot(Xa)-v*v,E=o.radius*o.radius;if(b>E)return null;const P=Math.sqrt(E-b),O=v-P,Q=v+P;return Q<0?null:O<0?this.at(Q,d):this.at(O,d)}intersectsSphere(o){return this.distanceSqToPoint(o.center)<=o.radius*o.radius}distanceToPlane(o){const d=o.normal.dot(this.direction);if(d===0)return o.distanceToPoint(this.origin)===0?0:null;const v=-(this.origin.dot(o.normal)+o.constant)/d;return v>=0?v:null}intersectPlane(o,d){const v=this.distanceToPlane(o);return v===null?null:this.at(v,d)}intersectsPlane(o){const d=o.distanceToPoint(this.origin);return d===0||o.normal.dot(this.direction)*d<0}intersectBox(o,d){let v,b,E,P,O,Q;const G=1/this.direction.x,te=1/this.direction.y,ge=1/this.direction.z,fe=this.origin;return G>=0?(v=(o.min.x-fe.x)*G,b=(o.max.x-fe.x)*G):(v=(o.max.x-fe.x)*G,b=(o.min.x-fe.x)*G),te>=0?(E=(o.min.y-fe.y)*te,P=(o.max.y-fe.y)*te):(E=(o.max.y-fe.y)*te,P=(o.min.y-fe.y)*te),v>P||E>b?null:((E>v||isNaN(v))&&(v=E),(P<b||isNaN(b))&&(b=P),ge>=0?(O=(o.min.z-fe.z)*ge,Q=(o.max.z-fe.z)*ge):(O=(o.max.z-fe.z)*ge,Q=(o.min.z-fe.z)*ge),v>Q||O>b?null:((O>v||v!=v)&&(v=O),(Q<b||b!=b)&&(b=Q),b<0?null:this.at(v>=0?v:b,d)))}intersectsBox(o){return this.intersectBox(o,Xa)!==null}intersectTriangle(o,d,v,b,E){Sh.subVectors(d,o),Cd.subVectors(v,o),of.crossVectors(Sh,Cd);let P,O=this.direction.dot(of);if(O>0){if(b)return null;P=1}else{if(!(O<0))return null;P=-1,O=-O}ic.subVectors(this.origin,o);const Q=P*this.direction.dot(Cd.crossVectors(ic,Cd));if(Q<0)return null;const G=P*this.direction.dot(Sh.cross(ic));if(G<0||Q+G>O)return null;const te=-P*ic.dot(of);return te<0?null:this.at(te/O,E)}applyMatrix4(o){return this.origin.applyMatrix4(o),this.direction.transformDirection(o),this}equals(o){return o.origin.equals(this.origin)&&o.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Sr{constructor(){Sr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(o,d,v,b,E,P,O,Q,G,te,ge,fe,_e,xe,Re,we){const Ce=this.elements;return Ce[0]=o,Ce[4]=d,Ce[8]=v,Ce[12]=b,Ce[1]=E,Ce[5]=P,Ce[9]=O,Ce[13]=Q,Ce[2]=G,Ce[6]=te,Ce[10]=ge,Ce[14]=fe,Ce[3]=_e,Ce[7]=xe,Ce[11]=Re,Ce[15]=we,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Sr().fromArray(this.elements)}copy(o){const d=this.elements,v=o.elements;return d[0]=v[0],d[1]=v[1],d[2]=v[2],d[3]=v[3],d[4]=v[4],d[5]=v[5],d[6]=v[6],d[7]=v[7],d[8]=v[8],d[9]=v[9],d[10]=v[10],d[11]=v[11],d[12]=v[12],d[13]=v[13],d[14]=v[14],d[15]=v[15],this}copyPosition(o){const d=this.elements,v=o.elements;return d[12]=v[12],d[13]=v[13],d[14]=v[14],this}setFromMatrix3(o){const d=o.elements;return this.set(d[0],d[3],d[6],0,d[1],d[4],d[7],0,d[2],d[5],d[8],0,0,0,0,1),this}extractBasis(o,d,v){return o.setFromMatrixColumn(this,0),d.setFromMatrixColumn(this,1),v.setFromMatrixColumn(this,2),this}makeBasis(o,d,v){return this.set(o.x,d.x,v.x,0,o.y,d.y,v.y,0,o.z,d.z,v.z,0,0,0,0,1),this}extractRotation(o){const d=this.elements,v=o.elements,b=1/ds.setFromMatrixColumn(o,0).length(),E=1/ds.setFromMatrixColumn(o,1).length(),P=1/ds.setFromMatrixColumn(o,2).length();return d[0]=v[0]*b,d[1]=v[1]*b,d[2]=v[2]*b,d[3]=0,d[4]=v[4]*E,d[5]=v[5]*E,d[6]=v[6]*E,d[7]=0,d[8]=v[8]*P,d[9]=v[9]*P,d[10]=v[10]*P,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromEuler(o){const d=this.elements,v=o.x,b=o.y,E=o.z,P=Math.cos(v),O=Math.sin(v),Q=Math.cos(b),G=Math.sin(b),te=Math.cos(E),ge=Math.sin(E);if(o.order==="XYZ"){const fe=P*te,_e=P*ge,xe=O*te,Re=O*ge;d[0]=Q*te,d[4]=-Q*ge,d[8]=G,d[1]=_e+xe*G,d[5]=fe-Re*G,d[9]=-O*Q,d[2]=Re-fe*G,d[6]=xe+_e*G,d[10]=P*Q}else if(o.order==="YXZ"){const fe=Q*te,_e=Q*ge,xe=G*te,Re=G*ge;d[0]=fe+Re*O,d[4]=xe*O-_e,d[8]=P*G,d[1]=P*ge,d[5]=P*te,d[9]=-O,d[2]=_e*O-xe,d[6]=Re+fe*O,d[10]=P*Q}else if(o.order==="ZXY"){const fe=Q*te,_e=Q*ge,xe=G*te,Re=G*ge;d[0]=fe-Re*O,d[4]=-P*ge,d[8]=xe+_e*O,d[1]=_e+xe*O,d[5]=P*te,d[9]=Re-fe*O,d[2]=-P*G,d[6]=O,d[10]=P*Q}else if(o.order==="ZYX"){const fe=P*te,_e=P*ge,xe=O*te,Re=O*ge;d[0]=Q*te,d[4]=xe*G-_e,d[8]=fe*G+Re,d[1]=Q*ge,d[5]=Re*G+fe,d[9]=_e*G-xe,d[2]=-G,d[6]=O*Q,d[10]=P*Q}else if(o.order==="YZX"){const fe=P*Q,_e=P*G,xe=O*Q,Re=O*G;d[0]=Q*te,d[4]=Re-fe*ge,d[8]=xe*ge+_e,d[1]=ge,d[5]=P*te,d[9]=-O*te,d[2]=-G*te,d[6]=_e*ge+xe,d[10]=fe-Re*ge}else if(o.order==="XZY"){const fe=P*Q,_e=P*G,xe=O*Q,Re=O*G;d[0]=Q*te,d[4]=-ge,d[8]=G*te,d[1]=fe*ge+Re,d[5]=P*te,d[9]=_e*ge-xe,d[2]=xe*ge-_e,d[6]=O*te,d[10]=Re*ge+fe}return d[3]=0,d[7]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromQuaternion(o){return this.compose(fl,o,Oc)}lookAt(o,d,v){const b=this.elements;return ua.subVectors(o,d),ua.lengthSq()===0&&(ua.z=1),ua.normalize(),qa.crossVectors(v,ua),qa.lengthSq()===0&&(Math.abs(v.z)===1?ua.x+=1e-4:ua.z+=1e-4,ua.normalize(),qa.crossVectors(v,ua)),qa.normalize(),ml.crossVectors(ua,qa),b[0]=qa.x,b[4]=ml.x,b[8]=ua.x,b[1]=qa.y,b[5]=ml.y,b[9]=ua.y,b[2]=qa.z,b[6]=ml.z,b[10]=ua.z,this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,d){const v=o.elements,b=d.elements,E=this.elements,P=v[0],O=v[4],Q=v[8],G=v[12],te=v[1],ge=v[5],fe=v[9],_e=v[13],xe=v[2],Re=v[6],we=v[10],Ce=v[14],De=v[3],ze=v[7],dt=v[11],rt=v[15],st=b[0],It=b[4],Kt=b[8],Dt=b[12],an=b[1],Ot=b[5],Mn=b[9],Sn=b[13],ti=b[2],xi=b[6],ni=b[10],Kn=b[14],gi=b[3],Ai=b[7],wn=b[11],qn=b[15];return E[0]=P*st+O*an+Q*ti+G*gi,E[4]=P*It+O*Ot+Q*xi+G*Ai,E[8]=P*Kt+O*Mn+Q*ni+G*wn,E[12]=P*Dt+O*Sn+Q*Kn+G*qn,E[1]=te*st+ge*an+fe*ti+_e*gi,E[5]=te*It+ge*Ot+fe*xi+_e*Ai,E[9]=te*Kt+ge*Mn+fe*ni+_e*wn,E[13]=te*Dt+ge*Sn+fe*Kn+_e*qn,E[2]=xe*st+Re*an+we*ti+Ce*gi,E[6]=xe*It+Re*Ot+we*xi+Ce*Ai,E[10]=xe*Kt+Re*Mn+we*ni+Ce*wn,E[14]=xe*Dt+Re*Sn+we*Kn+Ce*qn,E[3]=De*st+ze*an+dt*ti+rt*gi,E[7]=De*It+ze*Ot+dt*xi+rt*Ai,E[11]=De*Kt+ze*Mn+dt*ni+rt*wn,E[15]=De*Dt+ze*Sn+dt*Kn+rt*qn,this}multiplyScalar(o){const d=this.elements;return d[0]*=o,d[4]*=o,d[8]*=o,d[12]*=o,d[1]*=o,d[5]*=o,d[9]*=o,d[13]*=o,d[2]*=o,d[6]*=o,d[10]*=o,d[14]*=o,d[3]*=o,d[7]*=o,d[11]*=o,d[15]*=o,this}determinant(){const o=this.elements,d=o[0],v=o[4],b=o[8],E=o[12],P=o[1],O=o[5],Q=o[9],G=o[13],te=o[2],ge=o[6],fe=o[10],_e=o[14];return o[3]*(+E*Q*ge-b*G*ge-E*O*fe+v*G*fe+b*O*_e-v*Q*_e)+o[7]*(+d*Q*_e-d*G*fe+E*P*fe-b*P*_e+b*G*te-E*Q*te)+o[11]*(+d*G*ge-d*O*_e-E*P*ge+v*P*_e+E*O*te-v*G*te)+o[15]*(-b*O*te-d*Q*ge+d*O*fe+b*P*ge-v*P*fe+v*Q*te)}transpose(){const o=this.elements;let d;return d=o[1],o[1]=o[4],o[4]=d,d=o[2],o[2]=o[8],o[8]=d,d=o[6],o[6]=o[9],o[9]=d,d=o[3],o[3]=o[12],o[12]=d,d=o[7],o[7]=o[13],o[13]=d,d=o[11],o[11]=o[14],o[14]=d,this}setPosition(o,d,v){const b=this.elements;return o.isVector3?(b[12]=o.x,b[13]=o.y,b[14]=o.z):(b[12]=o,b[13]=d,b[14]=v),this}invert(){const o=this.elements,d=o[0],v=o[1],b=o[2],E=o[3],P=o[4],O=o[5],Q=o[6],G=o[7],te=o[8],ge=o[9],fe=o[10],_e=o[11],xe=o[12],Re=o[13],we=o[14],Ce=o[15],De=ge*we*G-Re*fe*G+Re*Q*_e-O*we*_e-ge*Q*Ce+O*fe*Ce,ze=xe*fe*G-te*we*G-xe*Q*_e+P*we*_e+te*Q*Ce-P*fe*Ce,dt=te*Re*G-xe*ge*G+xe*O*_e-P*Re*_e-te*O*Ce+P*ge*Ce,rt=xe*ge*Q-te*Re*Q-xe*O*fe+P*Re*fe+te*O*we-P*ge*we,st=d*De+v*ze+b*dt+E*rt;if(st===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const It=1/st;return o[0]=De*It,o[1]=(Re*fe*E-ge*we*E-Re*b*_e+v*we*_e+ge*b*Ce-v*fe*Ce)*It,o[2]=(O*we*E-Re*Q*E+Re*b*G-v*we*G-O*b*Ce+v*Q*Ce)*It,o[3]=(ge*Q*E-O*fe*E-ge*b*G+v*fe*G+O*b*_e-v*Q*_e)*It,o[4]=ze*It,o[5]=(te*we*E-xe*fe*E+xe*b*_e-d*we*_e-te*b*Ce+d*fe*Ce)*It,o[6]=(xe*Q*E-P*we*E-xe*b*G+d*we*G+P*b*Ce-d*Q*Ce)*It,o[7]=(P*fe*E-te*Q*E+te*b*G-d*fe*G-P*b*_e+d*Q*_e)*It,o[8]=dt*It,o[9]=(xe*ge*E-te*Re*E-xe*v*_e+d*Re*_e+te*v*Ce-d*ge*Ce)*It,o[10]=(P*Re*E-xe*O*E+xe*v*G-d*Re*G-P*v*Ce+d*O*Ce)*It,o[11]=(te*O*E-P*ge*E-te*v*G+d*ge*G+P*v*_e-d*O*_e)*It,o[12]=rt*It,o[13]=(te*Re*b-xe*ge*b+xe*v*fe-d*Re*fe-te*v*we+d*ge*we)*It,o[14]=(xe*O*b-P*Re*b-xe*v*Q+d*Re*Q+P*v*we-d*O*we)*It,o[15]=(P*ge*b-te*O*b+te*v*Q-d*ge*Q-P*v*fe+d*O*fe)*It,this}scale(o){const d=this.elements,v=o.x,b=o.y,E=o.z;return d[0]*=v,d[4]*=b,d[8]*=E,d[1]*=v,d[5]*=b,d[9]*=E,d[2]*=v,d[6]*=b,d[10]*=E,d[3]*=v,d[7]*=b,d[11]*=E,this}getMaxScaleOnAxis(){const o=this.elements,d=o[0]*o[0]+o[1]*o[1]+o[2]*o[2],v=o[4]*o[4]+o[5]*o[5]+o[6]*o[6],b=o[8]*o[8]+o[9]*o[9]+o[10]*o[10];return Math.sqrt(Math.max(d,v,b))}makeTranslation(o,d,v){return this.set(1,0,0,o,0,1,0,d,0,0,1,v,0,0,0,1),this}makeRotationX(o){const d=Math.cos(o),v=Math.sin(o);return this.set(1,0,0,0,0,d,-v,0,0,v,d,0,0,0,0,1),this}makeRotationY(o){const d=Math.cos(o),v=Math.sin(o);return this.set(d,0,v,0,0,1,0,0,-v,0,d,0,0,0,0,1),this}makeRotationZ(o){const d=Math.cos(o),v=Math.sin(o);return this.set(d,-v,0,0,v,d,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(o,d){const v=Math.cos(d),b=Math.sin(d),E=1-v,P=o.x,O=o.y,Q=o.z,G=E*P,te=E*O;return this.set(G*P+v,G*O-b*Q,G*Q+b*O,0,G*O+b*Q,te*O+v,te*Q-b*P,0,G*Q-b*O,te*Q+b*P,E*Q*Q+v,0,0,0,0,1),this}makeScale(o,d,v){return this.set(o,0,0,0,0,d,0,0,0,0,v,0,0,0,0,1),this}makeShear(o,d,v,b,E,P){return this.set(1,v,E,0,o,1,P,0,d,b,1,0,0,0,0,1),this}compose(o,d,v){const b=this.elements,E=d._x,P=d._y,O=d._z,Q=d._w,G=E+E,te=P+P,ge=O+O,fe=E*G,_e=E*te,xe=E*ge,Re=P*te,we=P*ge,Ce=O*ge,De=Q*G,ze=Q*te,dt=Q*ge,rt=v.x,st=v.y,It=v.z;return b[0]=(1-(Re+Ce))*rt,b[1]=(_e+dt)*rt,b[2]=(xe-ze)*rt,b[3]=0,b[4]=(_e-dt)*st,b[5]=(1-(fe+Ce))*st,b[6]=(we+De)*st,b[7]=0,b[8]=(xe+ze)*It,b[9]=(we-De)*It,b[10]=(1-(fe+Re))*It,b[11]=0,b[12]=o.x,b[13]=o.y,b[14]=o.z,b[15]=1,this}decompose(o,d,v){const b=this.elements;let E=ds.set(b[0],b[1],b[2]).length();const P=ds.set(b[4],b[5],b[6]).length(),O=ds.set(b[8],b[9],b[10]).length();this.determinant()<0&&(E=-E),o.x=b[12],o.y=b[13],o.z=b[14],Uo.copy(this);const Q=1/E,G=1/P,te=1/O;return Uo.elements[0]*=Q,Uo.elements[1]*=Q,Uo.elements[2]*=Q,Uo.elements[4]*=G,Uo.elements[5]*=G,Uo.elements[6]*=G,Uo.elements[8]*=te,Uo.elements[9]*=te,Uo.elements[10]*=te,d.setFromRotationMatrix(Uo),v.x=E,v.y=P,v.z=O,this}makePerspective(o,d,v,b,E,P){const O=this.elements,Q=2*E/(d-o),G=2*E/(v-b),te=(d+o)/(d-o),ge=(v+b)/(v-b),fe=-(P+E)/(P-E),_e=-2*P*E/(P-E);return O[0]=Q,O[4]=0,O[8]=te,O[12]=0,O[1]=0,O[5]=G,O[9]=ge,O[13]=0,O[2]=0,O[6]=0,O[10]=fe,O[14]=_e,O[3]=0,O[7]=0,O[11]=-1,O[15]=0,this}makeOrthographic(o,d,v,b,E,P){const O=this.elements,Q=1/(d-o),G=1/(v-b),te=1/(P-E),ge=(d+o)*Q,fe=(v+b)*G,_e=(P+E)*te;return O[0]=2*Q,O[4]=0,O[8]=0,O[12]=-ge,O[1]=0,O[5]=2*G,O[9]=0,O[13]=-fe,O[2]=0,O[6]=0,O[10]=-2*te,O[14]=-_e,O[3]=0,O[7]=0,O[11]=0,O[15]=1,this}equals(o){const d=this.elements,v=o.elements;for(let b=0;b<16;b++)if(d[b]!==v[b])return!1;return!0}fromArray(o,d=0){for(let v=0;v<16;v++)this.elements[v]=o[v+d];return this}toArray(o=[],d=0){const v=this.elements;return o[d]=v[0],o[d+1]=v[1],o[d+2]=v[2],o[d+3]=v[3],o[d+4]=v[4],o[d+5]=v[5],o[d+6]=v[6],o[d+7]=v[7],o[d+8]=v[8],o[d+9]=v[9],o[d+10]=v[10],o[d+11]=v[11],o[d+12]=v[12],o[d+13]=v[13],o[d+14]=v[14],o[d+15]=v[15],o}}const ds=new At,Uo=new Sr,fl=new At(0,0,0),Oc=new At(1,1,1),qa=new At,ml=new At,ua=new At,bm=new Sr,Rd=new No;class Nc{constructor(o=0,d=0,v=0,b=Nc.DEFAULT_ORDER){this.isEuler=!0,this._x=o,this._y=d,this._z=v,this._order=b}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get order(){return this._order}set order(o){this._order=o,this._onChangeCallback()}set(o,d,v,b=this._order){return this._x=o,this._y=d,this._z=v,this._order=b,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(o){return this._x=o._x,this._y=o._y,this._z=o._z,this._order=o._order,this._onChangeCallback(),this}setFromRotationMatrix(o,d=this._order,v=!0){const b=o.elements,E=b[0],P=b[4],O=b[8],Q=b[1],G=b[5],te=b[9],ge=b[2],fe=b[6],_e=b[10];switch(d){case"XYZ":this._y=Math.asin(zs(O,-1,1)),Math.abs(O)<.9999999?(this._x=Math.atan2(-te,_e),this._z=Math.atan2(-P,E)):(this._x=Math.atan2(fe,G),this._z=0);break;case"YXZ":this._x=Math.asin(-zs(te,-1,1)),Math.abs(te)<.9999999?(this._y=Math.atan2(O,_e),this._z=Math.atan2(Q,G)):(this._y=Math.atan2(-ge,E),this._z=0);break;case"ZXY":this._x=Math.asin(zs(fe,-1,1)),Math.abs(fe)<.9999999?(this._y=Math.atan2(-ge,_e),this._z=Math.atan2(-P,G)):(this._y=0,this._z=Math.atan2(Q,E));break;case"ZYX":this._y=Math.asin(-zs(ge,-1,1)),Math.abs(ge)<.9999999?(this._x=Math.atan2(fe,_e),this._z=Math.atan2(Q,E)):(this._x=0,this._z=Math.atan2(-P,G));break;case"YZX":this._z=Math.asin(zs(Q,-1,1)),Math.abs(Q)<.9999999?(this._x=Math.atan2(-te,G),this._y=Math.atan2(-ge,E)):(this._x=0,this._y=Math.atan2(O,_e));break;case"XZY":this._z=Math.asin(-zs(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(fe,G),this._y=Math.atan2(O,E)):(this._x=Math.atan2(-te,_e),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+d)}return this._order=d,v===!0&&this._onChangeCallback(),this}setFromQuaternion(o,d,v){return bm.makeRotationFromQuaternion(o),this.setFromRotationMatrix(bm,d,v)}setFromVector3(o,d=this._order){return this.set(o.x,o.y,o.z,d)}reorder(o){return Rd.setFromEuler(this),this.setFromQuaternion(Rd,o)}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._order===this._order}fromArray(o){return this._x=o[0],this._y=o[1],this._z=o[2],o[3]!==void 0&&(this._order=o[3]),this._onChangeCallback(),this}toArray(o=[],d=0){return o[d]=this._x,o[d+1]=this._y,o[d+2]=this._z,o[d+3]=this._order,o}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Nc.DEFAULT_ORDER="XYZ";class Zo{constructor(){this.mask=1}set(o){this.mask=(1<<o|0)>>>0}enable(o){this.mask|=1<<o|0}enableAll(){this.mask=-1}toggle(o){this.mask^=1<<o|0}disable(o){this.mask&=~(1<<o|0)}disableAll(){this.mask=0}test(o){return(this.mask&o.mask)!=0}isEnabled(o){return(this.mask&(1<<o|0))!=0}}let af=0;const Ya=new At,To=new No,Mo=new Sr,Ka=new At,Fo=new At,lf=new At,Id=new No,cf=new At(1,0,0),Fu=new At(0,1,0),Il=new At(0,0,1),uf={type:"added"},xm={type:"removed"};class Gr extends Cc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:af++}),this.uuid=Sa(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Gr.DEFAULT_UP.clone();const o=new At,d=new Nc,v=new No,b=new At(1,1,1);d._onChange(function(){v.setFromEuler(d,!1)}),v._onChange(function(){d.setFromQuaternion(v,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:o},rotation:{configurable:!0,enumerable:!0,value:d},quaternion:{configurable:!0,enumerable:!0,value:v},scale:{configurable:!0,enumerable:!0,value:b},modelViewMatrix:{value:new Sr},normalMatrix:{value:new Dr}}),this.matrix=new Sr,this.matrixWorld=new Sr,this.matrixAutoUpdate=Gr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Gr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Zo,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(o,d,v,b,E,P){this.dispatchEvent({type:"beforeRender",renderer:o,scene:d,camera:v,geometry:b,material:E,group:P})}onAfterRender(){}applyMatrix4(o){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(o),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(o){return this.quaternion.premultiply(o),this}setRotationFromAxisAngle(o,d){this.quaternion.setFromAxisAngle(o,d)}setRotationFromEuler(o){this.quaternion.setFromEuler(o,!0)}setRotationFromMatrix(o){this.quaternion.setFromRotationMatrix(o)}setRotationFromQuaternion(o){this.quaternion.copy(o)}rotateOnAxis(o,d){return To.setFromAxisAngle(o,d),this.quaternion.multiply(To),this}rotateOnWorldAxis(o,d){return To.setFromAxisAngle(o,d),this.quaternion.premultiply(To),this}rotateX(o){return this.rotateOnAxis(cf,o)}rotateY(o){return this.rotateOnAxis(Fu,o)}rotateZ(o){return this.rotateOnAxis(Il,o)}translateOnAxis(o,d){return Ya.copy(o).applyQuaternion(this.quaternion),this.position.add(Ya.multiplyScalar(d)),this}translateX(o){return this.translateOnAxis(cf,o)}translateY(o){return this.translateOnAxis(Fu,o)}translateZ(o){return this.translateOnAxis(Il,o)}localToWorld(o){return this.updateWorldMatrix(!0,!1),o.applyMatrix4(this.matrixWorld)}worldToLocal(o){return this.updateWorldMatrix(!0,!1),o.applyMatrix4(Mo.copy(this.matrixWorld).invert())}lookAt(o,d,v){o.isVector3?Ka.copy(o):Ka.set(o,d,v);const b=this.parent;this.updateWorldMatrix(!0,!1),Fo.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Mo.lookAt(Fo,Ka,this.up):Mo.lookAt(Ka,Fo,this.up),this.quaternion.setFromRotationMatrix(Mo),b&&(Mo.extractRotation(b.matrixWorld),To.setFromRotationMatrix(Mo),this.quaternion.premultiply(To.invert()))}add(o){if(arguments.length>1){for(let d=0;d<arguments.length;d++)this.add(arguments[d]);return this}return o===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",o),this):(o&&o.isObject3D?(o.parent!==null&&o.parent.remove(o),o.parent=this,this.children.push(o),o.dispatchEvent(uf)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",o),this)}remove(o){if(arguments.length>1){for(let v=0;v<arguments.length;v++)this.remove(arguments[v]);return this}const d=this.children.indexOf(o);return d!==-1&&(o.parent=null,this.children.splice(d,1),o.dispatchEvent(xm)),this}removeFromParent(){const o=this.parent;return o!==null&&o.remove(this),this}clear(){for(let o=0;o<this.children.length;o++){const d=this.children[o];d.parent=null,d.dispatchEvent(xm)}return this.children.length=0,this}attach(o){return this.updateWorldMatrix(!0,!1),Mo.copy(this.matrixWorld).invert(),o.parent!==null&&(o.parent.updateWorldMatrix(!0,!1),Mo.multiply(o.parent.matrixWorld)),o.applyMatrix4(Mo),this.add(o),o.updateWorldMatrix(!1,!0),this}getObjectById(o){return this.getObjectByProperty("id",o)}getObjectByName(o){return this.getObjectByProperty("name",o)}getObjectByProperty(o,d){if(this[o]===d)return this;for(let v=0,b=this.children.length;v<b;v++){const E=this.children[v].getObjectByProperty(o,d);if(E!==void 0)return E}}getObjectsByProperty(o,d){let v=[];this[o]===d&&v.push(this);for(let b=0,E=this.children.length;b<E;b++){const P=this.children[b].getObjectsByProperty(o,d);P.length>0&&(v=v.concat(P))}return v}getWorldPosition(o){return this.updateWorldMatrix(!0,!1),o.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fo,o,lf),o}getWorldScale(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fo,Id,o),o}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const d=this.matrixWorld.elements;return o.set(d[8],d[9],d[10]).normalize()}raycast(){}traverse(o){o(this);const d=this.children;for(let v=0,b=d.length;v<b;v++)d[v].traverse(o)}traverseVisible(o){if(this.visible===!1)return;o(this);const d=this.children;for(let v=0,b=d.length;v<b;v++)d[v].traverseVisible(o)}traverseAncestors(o){const d=this.parent;d!==null&&(o(d),d.traverseAncestors(o))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(o){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||o)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,o=!0);const d=this.children;for(let v=0,b=d.length;v<b;v++){const E=d[v];E.matrixWorldAutoUpdate!==!0&&o!==!0||E.updateMatrixWorld(o)}}updateWorldMatrix(o,d){const v=this.parent;if(o===!0&&v!==null&&v.matrixWorldAutoUpdate===!0&&v.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),d===!0){const b=this.children;for(let E=0,P=b.length;E<P;E++){const O=b[E];O.matrixWorldAutoUpdate===!0&&O.updateWorldMatrix(!1,!0)}}}toJSON(o){const d=o===void 0||typeof o=="string",v={};d&&(o={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},v.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const b={};function E(O,Q){return O[Q.uuid]===void 0&&(O[Q.uuid]=Q.toJSON(o)),Q.uuid}if(b.uuid=this.uuid,b.type=this.type,this.name!==""&&(b.name=this.name),this.castShadow===!0&&(b.castShadow=!0),this.receiveShadow===!0&&(b.receiveShadow=!0),this.visible===!1&&(b.visible=!1),this.frustumCulled===!1&&(b.frustumCulled=!1),this.renderOrder!==0&&(b.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(b.userData=this.userData),b.layers=this.layers.mask,b.matrix=this.matrix.toArray(),b.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(b.matrixAutoUpdate=!1),this.isInstancedMesh&&(b.type="InstancedMesh",b.count=this.count,b.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(b.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?b.background=this.background.toJSON():this.background.isTexture&&(b.background=this.background.toJSON(o).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(b.environment=this.environment.toJSON(o).uuid);else if(this.isMesh||this.isLine||this.isPoints){b.geometry=E(o.geometries,this.geometry);const O=this.geometry.parameters;if(O!==void 0&&O.shapes!==void 0){const Q=O.shapes;if(Array.isArray(Q))for(let G=0,te=Q.length;G<te;G++){const ge=Q[G];E(o.shapes,ge)}else E(o.shapes,Q)}}if(this.isSkinnedMesh&&(b.bindMode=this.bindMode,b.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(E(o.skeletons,this.skeleton),b.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const O=[];for(let Q=0,G=this.material.length;Q<G;Q++)O.push(E(o.materials,this.material[Q]));b.material=O}else b.material=E(o.materials,this.material);if(this.children.length>0){b.children=[];for(let O=0;O<this.children.length;O++)b.children.push(this.children[O].toJSON(o).object)}if(this.animations.length>0){b.animations=[];for(let O=0;O<this.animations.length;O++){const Q=this.animations[O];b.animations.push(E(o.animations,Q))}}if(d){const O=P(o.geometries),Q=P(o.materials),G=P(o.textures),te=P(o.images),ge=P(o.shapes),fe=P(o.skeletons),_e=P(o.animations),xe=P(o.nodes);O.length>0&&(v.geometries=O),Q.length>0&&(v.materials=Q),G.length>0&&(v.textures=G),te.length>0&&(v.images=te),ge.length>0&&(v.shapes=ge),fe.length>0&&(v.skeletons=fe),_e.length>0&&(v.animations=_e),xe.length>0&&(v.nodes=xe)}return v.object=b,v;function P(O){const Q=[];for(const G in O){const te=O[G];delete te.metadata,Q.push(te)}return Q}}clone(o){return new this.constructor().copy(this,o)}copy(o,d=!0){this.name=o.name,this.up.copy(o.up),this.position.copy(o.position),this.rotation.order=o.rotation.order,this.quaternion.copy(o.quaternion),this.scale.copy(o.scale),this.matrix.copy(o.matrix),this.matrixWorld.copy(o.matrixWorld),this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrixWorldNeedsUpdate=o.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=o.matrixWorldAutoUpdate,this.layers.mask=o.layers.mask,this.visible=o.visible,this.castShadow=o.castShadow,this.receiveShadow=o.receiveShadow,this.frustumCulled=o.frustumCulled,this.renderOrder=o.renderOrder,this.animations=o.animations,this.userData={};for(const[v,b]of Object.entries(o.userData))this.userData[v]=!b||b&&(b.isTexture||b.isObject3D)?b:JSON.parse(JSON.stringify(b));if(d===!0)for(let v=0;v<o.children.length;v++){const b=o.children[v];this.add(b.clone())}return this}}Gr.DEFAULT_UP=new At(0,1,0),Gr.DEFAULT_MATRIX_AUTO_UPDATE=!0,Gr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Pa=new At,rc=new At,$a=new At,gl=new At,_l=new At,sc=new At,wm=new At,Th=new At,du=new At,kc=new At;let Uc=!1;class zo{constructor(o=new At,d=new At,v=new At){this.a=o,this.b=d,this.c=v}static getNormal(o,d,v,b){b.subVectors(v,d),Pa.subVectors(o,d),b.cross(Pa);const E=b.lengthSq();return E>0?b.multiplyScalar(1/Math.sqrt(E)):b.set(0,0,0)}static getBarycoord(o,d,v,b,E){Pa.subVectors(b,d),rc.subVectors(v,d),$a.subVectors(o,d);const P=Pa.dot(Pa),O=Pa.dot(rc),Q=Pa.dot($a),G=rc.dot(rc),te=rc.dot($a),ge=P*G-O*O;if(ge===0)return E.set(-2,-1,-1);const fe=1/ge,_e=(G*Q-O*te)*fe,xe=(P*te-O*Q)*fe;return E.set(1-_e-xe,xe,_e)}static containsPoint(o,d,v,b){return this.getBarycoord(o,d,v,b,gl),gl.x>=0&&gl.y>=0&&gl.x+gl.y<=1}static getUV(o,d,v,b,E,P,O,Q){return Uc===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Uc=!0),this.getInterpolation(o,d,v,b,E,P,O,Q)}static getInterpolation(o,d,v,b,E,P,O,Q){return this.getBarycoord(o,d,v,b,gl),Q.setScalar(0),Q.addScaledVector(E,gl.x),Q.addScaledVector(P,gl.y),Q.addScaledVector(O,gl.z),Q}static isFrontFacing(o,d,v,b){return Pa.subVectors(v,d),rc.subVectors(o,d),Pa.cross(rc).dot(b)<0}set(o,d,v){return this.a.copy(o),this.b.copy(d),this.c.copy(v),this}setFromPointsAndIndices(o,d,v,b){return this.a.copy(o[d]),this.b.copy(o[v]),this.c.copy(o[b]),this}setFromAttributeAndIndices(o,d,v,b){return this.a.fromBufferAttribute(o,d),this.b.fromBufferAttribute(o,v),this.c.fromBufferAttribute(o,b),this}clone(){return new this.constructor().copy(this)}copy(o){return this.a.copy(o.a),this.b.copy(o.b),this.c.copy(o.c),this}getArea(){return Pa.subVectors(this.c,this.b),rc.subVectors(this.a,this.b),.5*Pa.cross(rc).length()}getMidpoint(o){return o.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(o){return zo.getNormal(this.a,this.b,this.c,o)}getPlane(o){return o.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(o,d){return zo.getBarycoord(o,this.a,this.b,this.c,d)}getUV(o,d,v,b,E){return Uc===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Uc=!0),zo.getInterpolation(o,this.a,this.b,this.c,d,v,b,E)}getInterpolation(o,d,v,b,E){return zo.getInterpolation(o,this.a,this.b,this.c,d,v,b,E)}containsPoint(o){return zo.containsPoint(o,this.a,this.b,this.c)}isFrontFacing(o){return zo.isFrontFacing(this.a,this.b,this.c,o)}intersectsBox(o){return o.intersectsTriangle(this)}closestPointToPoint(o,d){const v=this.a,b=this.b,E=this.c;let P,O;_l.subVectors(b,v),sc.subVectors(E,v),Th.subVectors(o,v);const Q=_l.dot(Th),G=sc.dot(Th);if(Q<=0&&G<=0)return d.copy(v);du.subVectors(o,b);const te=_l.dot(du),ge=sc.dot(du);if(te>=0&&ge<=te)return d.copy(b);const fe=Q*ge-te*G;if(fe<=0&&Q>=0&&te<=0)return P=Q/(Q-te),d.copy(v).addScaledVector(_l,P);kc.subVectors(o,E);const _e=_l.dot(kc),xe=sc.dot(kc);if(xe>=0&&_e<=xe)return d.copy(E);const Re=_e*G-Q*xe;if(Re<=0&&G>=0&&xe<=0)return O=G/(G-xe),d.copy(v).addScaledVector(sc,O);const we=te*xe-_e*ge;if(we<=0&&ge-te>=0&&_e-xe>=0)return wm.subVectors(E,b),O=(ge-te)/(ge-te+(_e-xe)),d.copy(b).addScaledVector(wm,O);const Ce=1/(we+Re+fe);return P=Re*Ce,O=fe*Ce,d.copy(v).addScaledVector(_l,P).addScaledVector(sc,O)}equals(o){return o.a.equals(this.a)&&o.b.equals(this.b)&&o.c.equals(this.c)}}let Em=0;class Vo extends Cc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Em++}),this.uuid=Sa(),this.name="",this.type="Material",this.blending=z,this.side=$,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Fe,this.blendDst=Ve,this.blendEquation=Y,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=wt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ed,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=_o,this.stencilZFail=_o,this.stencilZPass=_o,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(o){this._alphaTest>0!=o>0&&this.version++,this._alphaTest=o}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(o){if(o!==void 0)for(const d in o){const v=o[d];if(v===void 0){console.warn(`THREE.Material: parameter '${d}' has value of undefined.`);continue}const b=this[d];b!==void 0&&(b&&b.isColor?b.set(v):b&&b.isVector3&&v&&v.isVector3?b.copy(v):Array.isArray(v)&&b&&typeof b.fromArray=="function"?b.fromArray(v):this[d]=v)}}toJSON(o){const d=o===void 0||typeof o=="string";d&&(o={textures:{},images:{}});const v={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function b(E){const P=[];for(const O in E){const Q=E[O];delete Q.metadata,P.push(Q)}return P}if(v.uuid=this.uuid,v.type=this.type,this.name!==""&&(v.name=this.name),this.color&&this.color.isColor&&(v.color=this.color.getHex()),this.roughness!==void 0&&(v.roughness=this.roughness),this.metalness!==void 0&&(v.metalness=this.metalness),this.sheen!==void 0&&(v.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(v.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(v.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(v.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(v.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(v.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(v.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(v.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(v.shininess=this.shininess),this.clearcoat!==void 0&&(v.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(v.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(v.clearcoatMap=this.clearcoatMap.toJSON(o).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(v.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(o).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(v.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(o).uuid,v.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(v.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(v.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(v.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(v.iridescenceMap=this.iridescenceMap.toJSON(o).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(v.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(o).uuid),this.map&&this.map.isTexture&&(v.map=this.map.toJSON(o).uuid),this.matcap&&this.matcap.isTexture&&(v.matcap=this.matcap.toJSON(o).uuid),this.alphaMap&&this.alphaMap.isTexture&&(v.alphaMap=this.alphaMap.toJSON(o).uuid),this.lightMap&&this.lightMap.isTexture&&(v.lightMap=this.lightMap.toJSON(o).uuid,v.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(v.aoMap=this.aoMap.toJSON(o).uuid,v.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(v.bumpMap=this.bumpMap.toJSON(o).uuid,v.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(v.normalMap=this.normalMap.toJSON(o).uuid,v.normalMapType=this.normalMapType,v.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(v.displacementMap=this.displacementMap.toJSON(o).uuid,v.displacementScale=this.displacementScale,v.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(v.roughnessMap=this.roughnessMap.toJSON(o).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(v.metalnessMap=this.metalnessMap.toJSON(o).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(v.emissiveMap=this.emissiveMap.toJSON(o).uuid),this.specularMap&&this.specularMap.isTexture&&(v.specularMap=this.specularMap.toJSON(o).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(v.specularIntensityMap=this.specularIntensityMap.toJSON(o).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(v.specularColorMap=this.specularColorMap.toJSON(o).uuid),this.envMap&&this.envMap.isTexture&&(v.envMap=this.envMap.toJSON(o).uuid,this.combine!==void 0&&(v.combine=this.combine)),this.envMapIntensity!==void 0&&(v.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(v.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(v.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(v.gradientMap=this.gradientMap.toJSON(o).uuid),this.transmission!==void 0&&(v.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(v.transmissionMap=this.transmissionMap.toJSON(o).uuid),this.thickness!==void 0&&(v.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(v.thicknessMap=this.thicknessMap.toJSON(o).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(v.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(v.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(v.size=this.size),this.shadowSide!==null&&(v.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(v.sizeAttenuation=this.sizeAttenuation),this.blending!==z&&(v.blending=this.blending),this.side!==$&&(v.side=this.side),this.vertexColors&&(v.vertexColors=!0),this.opacity<1&&(v.opacity=this.opacity),this.transparent===!0&&(v.transparent=this.transparent),v.depthFunc=this.depthFunc,v.depthTest=this.depthTest,v.depthWrite=this.depthWrite,v.colorWrite=this.colorWrite,v.stencilWrite=this.stencilWrite,v.stencilWriteMask=this.stencilWriteMask,v.stencilFunc=this.stencilFunc,v.stencilRef=this.stencilRef,v.stencilFuncMask=this.stencilFuncMask,v.stencilFail=this.stencilFail,v.stencilZFail=this.stencilZFail,v.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(v.rotation=this.rotation),this.polygonOffset===!0&&(v.polygonOffset=!0),this.polygonOffsetFactor!==0&&(v.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(v.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(v.linewidth=this.linewidth),this.dashSize!==void 0&&(v.dashSize=this.dashSize),this.gapSize!==void 0&&(v.gapSize=this.gapSize),this.scale!==void 0&&(v.scale=this.scale),this.dithering===!0&&(v.dithering=!0),this.alphaTest>0&&(v.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(v.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(v.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(v.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(v.wireframe=this.wireframe),this.wireframeLinewidth>1&&(v.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(v.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(v.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(v.flatShading=this.flatShading),this.visible===!1&&(v.visible=!1),this.toneMapped===!1&&(v.toneMapped=!1),this.fog===!1&&(v.fog=!1),Object.keys(this.userData).length>0&&(v.userData=this.userData),d){const E=b(o.textures),P=b(o.images);E.length>0&&(v.textures=E),P.length>0&&(v.images=P)}return v}clone(){return new this.constructor().copy(this)}copy(o){this.name=o.name,this.blending=o.blending,this.side=o.side,this.vertexColors=o.vertexColors,this.opacity=o.opacity,this.transparent=o.transparent,this.blendSrc=o.blendSrc,this.blendDst=o.blendDst,this.blendEquation=o.blendEquation,this.blendSrcAlpha=o.blendSrcAlpha,this.blendDstAlpha=o.blendDstAlpha,this.blendEquationAlpha=o.blendEquationAlpha,this.depthFunc=o.depthFunc,this.depthTest=o.depthTest,this.depthWrite=o.depthWrite,this.stencilWriteMask=o.stencilWriteMask,this.stencilFunc=o.stencilFunc,this.stencilRef=o.stencilRef,this.stencilFuncMask=o.stencilFuncMask,this.stencilFail=o.stencilFail,this.stencilZFail=o.stencilZFail,this.stencilZPass=o.stencilZPass,this.stencilWrite=o.stencilWrite;const d=o.clippingPlanes;let v=null;if(d!==null){const b=d.length;v=new Array(b);for(let E=0;E!==b;++E)v[E]=d[E].clone()}return this.clippingPlanes=v,this.clipIntersection=o.clipIntersection,this.clipShadows=o.clipShadows,this.shadowSide=o.shadowSide,this.colorWrite=o.colorWrite,this.precision=o.precision,this.polygonOffset=o.polygonOffset,this.polygonOffsetFactor=o.polygonOffsetFactor,this.polygonOffsetUnits=o.polygonOffsetUnits,this.dithering=o.dithering,this.alphaTest=o.alphaTest,this.alphaToCoverage=o.alphaToCoverage,this.premultipliedAlpha=o.premultipliedAlpha,this.forceSinglePass=o.forceSinglePass,this.visible=o.visible,this.toneMapped=o.toneMapped,this.userData=Pd({},o.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(o){o===!0&&this.version++}}function Pd(I,o){if(!o)return I;for(const d of Object.keys(o)){if(d.startsWith("__")||typeof I[d]=="function"||typeof o[d]=="function")continue;const v=o[d],b=!v||v.isTexture||v.isObject3D||v.isMaterial;b||typeof o[d].clone!="function"?b||typeof o[d]!="object"&&!Array.isArray(o[d])?I[d]=o[d]:I[d]=Pd(Array.isArray(o[d])?[]:{},o[d]):I[d]=o[d].clone()}return I}const Fc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ho={h:0,s:0,l:0},zc={h:0,s:0,l:0};function Da(I,o,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?I+6*(o-I)*d:d<.5?o:d<2/3?I+6*(o-I)*(2/3-d):I}class Mi{constructor(o,d,v){return this.isColor=!0,this.r=1,this.g=1,this.b=1,d===void 0&&v===void 0?this.set(o):this.setRGB(o,d,v)}set(o){return o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o),this}setScalar(o){return this.r=o,this.g=o,this.b=o,this}setHex(o,d=or){return o=Math.floor(o),this.r=(o>>16&255)/255,this.g=(o>>8&255)/255,this.b=(255&o)/255,Ca.toWorkingColorSpace(this,d),this}setRGB(o,d,v,b=Ca.workingColorSpace){return this.r=o,this.g=d,this.b=v,Ca.toWorkingColorSpace(this,b),this}setHSL(o,d,v,b=Ca.workingColorSpace){if(o=Bu(o,1),d=zs(d,0,1),v=zs(v,0,1),d===0)this.r=this.g=this.b=v;else{const E=v<=.5?v*(1+d):v+d-v*d,P=2*v-E;this.r=Da(P,E,o+1/3),this.g=Da(P,E,o),this.b=Da(P,E,o-1/3)}return Ca.toWorkingColorSpace(this,b),this}setStyle(o,d=or){function v(E){E!==void 0&&parseFloat(E)<1&&console.warn("THREE.Color: Alpha component of "+o+" will be ignored.")}let b;if(b=/^(\w+)\(([^\)]*)\)/.exec(o)){let E;const P=b[1],O=b[2];switch(P){case"rgb":case"rgba":if(E=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(O))return v(E[4]),this.setRGB(Math.min(255,parseInt(E[1],10))/255,Math.min(255,parseInt(E[2],10))/255,Math.min(255,parseInt(E[3],10))/255,d);if(E=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(O))return v(E[4]),this.setRGB(Math.min(100,parseInt(E[1],10))/100,Math.min(100,parseInt(E[2],10))/100,Math.min(100,parseInt(E[3],10))/100,d);break;case"hsl":case"hsla":if(E=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(O))return v(E[4]),this.setHSL(parseFloat(E[1])/360,parseFloat(E[2])/100,parseFloat(E[3])/100,d);break;default:console.warn("THREE.Color: Unknown color model "+o)}}else if(b=/^\#([A-Fa-f\d]+)$/.exec(o)){const E=b[1],P=E.length;if(P===3)return this.setRGB(parseInt(E.charAt(0),16)/15,parseInt(E.charAt(1),16)/15,parseInt(E.charAt(2),16)/15,d);if(P===6)return this.setHex(parseInt(E,16),d);console.warn("THREE.Color: Invalid hex color "+o)}else if(o&&o.length>0)return this.setColorName(o,d);return this}setColorName(o,d=or){const v=Fc[o.toLowerCase()];return v!==void 0?this.setHex(v,d):console.warn("THREE.Color: Unknown color "+o),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(o){return this.r=o.r,this.g=o.g,this.b=o.b,this}copySRGBToLinear(o){return this.r=Ou(o.r),this.g=Ou(o.g),this.b=Ou(o.b),this}copyLinearToSRGB(o){return this.r=ef(o.r),this.g=ef(o.g),this.b=ef(o.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(o=or){return Ca.fromWorkingColorSpace(us.copy(this),o),65536*Math.round(zs(255*us.r,0,255))+256*Math.round(zs(255*us.g,0,255))+Math.round(zs(255*us.b,0,255))}getHexString(o=or){return("000000"+this.getHex(o).toString(16)).slice(-6)}getHSL(o,d=Ca.workingColorSpace){Ca.fromWorkingColorSpace(us.copy(this),d);const v=us.r,b=us.g,E=us.b,P=Math.max(v,b,E),O=Math.min(v,b,E);let Q,G;const te=(O+P)/2;if(O===P)Q=0,G=0;else{const ge=P-O;switch(G=te<=.5?ge/(P+O):ge/(2-P-O),P){case v:Q=(b-E)/ge+(b<E?6:0);break;case b:Q=(E-v)/ge+2;break;case E:Q=(v-b)/ge+4}Q/=6}return o.h=Q,o.s=G,o.l=te,o}getRGB(o,d=Ca.workingColorSpace){return Ca.fromWorkingColorSpace(us.copy(this),d),o.r=us.r,o.g=us.g,o.b=us.b,o}getStyle(o=or){Ca.fromWorkingColorSpace(us.copy(this),o);const d=us.r,v=us.g,b=us.b;return o!==or?`color(${o} ${d.toFixed(3)} ${v.toFixed(3)} ${b.toFixed(3)})`:`rgb(${Math.round(255*d)},${Math.round(255*v)},${Math.round(255*b)})`}offsetHSL(o,d,v){return this.getHSL(ho),ho.h+=o,ho.s+=d,ho.l+=v,this.setHSL(ho.h,ho.s,ho.l),this}add(o){return this.r+=o.r,this.g+=o.g,this.b+=o.b,this}addColors(o,d){return this.r=o.r+d.r,this.g=o.g+d.g,this.b=o.b+d.b,this}addScalar(o){return this.r+=o,this.g+=o,this.b+=o,this}sub(o){return this.r=Math.max(0,this.r-o.r),this.g=Math.max(0,this.g-o.g),this.b=Math.max(0,this.b-o.b),this}multiply(o){return this.r*=o.r,this.g*=o.g,this.b*=o.b,this}multiplyScalar(o){return this.r*=o,this.g*=o,this.b*=o,this}lerp(o,d){return this.r+=(o.r-this.r)*d,this.g+=(o.g-this.g)*d,this.b+=(o.b-this.b)*d,this}lerpColors(o,d,v){return this.r=o.r+(d.r-o.r)*v,this.g=o.g+(d.g-o.g)*v,this.b=o.b+(d.b-o.b)*v,this}lerpHSL(o,d){this.getHSL(ho),o.getHSL(zc);const v=Ah(ho.h,zc.h,d),b=Ah(ho.s,zc.s,d),E=Ah(ho.l,zc.l,d);return this.setHSL(v,b,E),this}setFromVector3(o){return this.r=o.x,this.g=o.y,this.b=o.z,this}applyMatrix3(o){const d=this.r,v=this.g,b=this.b,E=o.elements;return this.r=E[0]*d+E[3]*v+E[6]*b,this.g=E[1]*d+E[4]*v+E[7]*b,this.b=E[2]*d+E[5]*v+E[8]*b,this}equals(o){return o.r===this.r&&o.g===this.g&&o.b===this.b}fromArray(o,d=0){return this.r=o[d],this.g=o[d+1],this.b=o[d+2],this}toArray(o=[],d=0){return o[d]=this.r,o[d+1]=this.g,o[d+2]=this.b,o}fromBufferAttribute(o,d){return this.r=o.getX(d),this.g=o.getY(d),this.b=o.getZ(d),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const us=new Mi;Mi.NAMES=Fc;class ys extends Vo{constructor(o){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Mi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ue,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}const Pl=ps();function ps(){const I=new ArrayBuffer(4),o=new Float32Array(I),d=new Uint32Array(I),v=new Uint32Array(512),b=new Uint32Array(512);for(let Q=0;Q<256;++Q){const G=Q-127;G<-27?(v[Q]=0,v[256|Q]=32768,b[Q]=24,b[256|Q]=24):G<-14?(v[Q]=1024>>-G-14,v[256|Q]=1024>>-G-14|32768,b[Q]=-G-1,b[256|Q]=-G-1):G<=15?(v[Q]=G+15<<10,v[256|Q]=G+15<<10|32768,b[Q]=13,b[256|Q]=13):G<128?(v[Q]=31744,v[256|Q]=64512,b[Q]=24,b[256|Q]=24):(v[Q]=31744,v[256|Q]=64512,b[Q]=13,b[256|Q]=13)}const E=new Uint32Array(2048),P=new Uint32Array(64),O=new Uint32Array(64);for(let Q=1;Q<1024;++Q){let G=Q<<13,te=0;for(;!(8388608&G);)G<<=1,te-=8388608;G&=-8388609,te+=947912704,E[Q]=G|te}for(let Q=1024;Q<2048;++Q)E[Q]=939524096+(Q-1024<<13);for(let Q=1;Q<31;++Q)P[Q]=Q<<23;P[31]=1199570944,P[32]=2147483648;for(let Q=33;Q<63;++Q)P[Q]=2147483648+(Q-32<<23);P[63]=3347054592;for(let Q=1;Q<64;++Q)Q!==32&&(O[Q]=1024);return{floatView:o,uint32View:d,baseTable:v,shiftTable:b,mantissaTable:E,exponentTable:P,offsetTable:O}}function ea(I){Math.abs(I)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),I=zs(I,-65504,65504),Pl.floatView[0]=I;const o=Pl.uint32View[0],d=o>>23&511;return Pl.baseTable[d]+((8388607&o)>>Pl.shiftTable[d])}function zu(I){const o=I>>10;return Pl.uint32View[0]=Pl.mantissaTable[Pl.offsetTable[o]+(1023&I)]+Pl.exponentTable[o],Pl.floatView[0]}const x_={toHalfFloat:ea,fromHalfFloat:zu},fs=new At,Vu=new jn;class As{constructor(o,d,v=!1){if(Array.isArray(o))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=o,this.itemSize=d,this.count=o!==void 0?o.length/d:0,this.normalized=v,this.usage=Mc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.name=o.name,this.array=new o.array.constructor(o.array),this.itemSize=o.itemSize,this.count=o.count,this.normalized=o.normalized,this.usage=o.usage,this}copyAt(o,d,v){o*=this.itemSize,v*=d.itemSize;for(let b=0,E=this.itemSize;b<E;b++)this.array[o+b]=d.array[v+b];return this}copyArray(o){return this.array.set(o),this}applyMatrix3(o){if(this.itemSize===2)for(let d=0,v=this.count;d<v;d++)Vu.fromBufferAttribute(this,d),Vu.applyMatrix3(o),this.setXY(d,Vu.x,Vu.y);else if(this.itemSize===3)for(let d=0,v=this.count;d<v;d++)fs.fromBufferAttribute(this,d),fs.applyMatrix3(o),this.setXYZ(d,fs.x,fs.y,fs.z);return this}applyMatrix4(o){for(let d=0,v=this.count;d<v;d++)fs.fromBufferAttribute(this,d),fs.applyMatrix4(o),this.setXYZ(d,fs.x,fs.y,fs.z);return this}applyNormalMatrix(o){for(let d=0,v=this.count;d<v;d++)fs.fromBufferAttribute(this,d),fs.applyNormalMatrix(o),this.setXYZ(d,fs.x,fs.y,fs.z);return this}transformDirection(o){for(let d=0,v=this.count;d<v;d++)fs.fromBufferAttribute(this,d),fs.transformDirection(o),this.setXYZ(d,fs.x,fs.y,fs.z);return this}set(o,d=0){return this.array.set(o,d),this}getX(o){let d=this.array[o*this.itemSize];return this.normalized&&(d=Qa(d,this.array)),d}setX(o,d){return this.normalized&&(d=Vr(d,this.array)),this.array[o*this.itemSize]=d,this}getY(o){let d=this.array[o*this.itemSize+1];return this.normalized&&(d=Qa(d,this.array)),d}setY(o,d){return this.normalized&&(d=Vr(d,this.array)),this.array[o*this.itemSize+1]=d,this}getZ(o){let d=this.array[o*this.itemSize+2];return this.normalized&&(d=Qa(d,this.array)),d}setZ(o,d){return this.normalized&&(d=Vr(d,this.array)),this.array[o*this.itemSize+2]=d,this}getW(o){let d=this.array[o*this.itemSize+3];return this.normalized&&(d=Qa(d,this.array)),d}setW(o,d){return this.normalized&&(d=Vr(d,this.array)),this.array[o*this.itemSize+3]=d,this}setXY(o,d,v){return o*=this.itemSize,this.normalized&&(d=Vr(d,this.array),v=Vr(v,this.array)),this.array[o+0]=d,this.array[o+1]=v,this}setXYZ(o,d,v,b){return o*=this.itemSize,this.normalized&&(d=Vr(d,this.array),v=Vr(v,this.array),b=Vr(b,this.array)),this.array[o+0]=d,this.array[o+1]=v,this.array[o+2]=b,this}setXYZW(o,d,v,b,E){return o*=this.itemSize,this.normalized&&(d=Vr(d,this.array),v=Vr(v,this.array),b=Vr(b,this.array),E=Vr(E,this.array)),this.array[o+0]=d,this.array[o+1]=v,this.array[o+2]=b,this.array[o+3]=E,this}onUpload(o){return this.onUploadCallback=o,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const o={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(o.name=this.name),this.usage!==Mc&&(o.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(o.updateRange=this.updateRange),o}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class hf extends As{constructor(o,d,v){super(new Int8Array(o),d,v)}}class oc extends As{constructor(o,d,v){super(new Uint8Array(o),d,v)}}class w_ extends As{constructor(o,d,v){super(new Uint8ClampedArray(o),d,v)}}class Sm extends As{constructor(o,d,v){super(new Int16Array(o),d,v)}}class pu extends As{constructor(o,d,v){super(new Uint16Array(o),d,v)}}class ha extends As{constructor(o,d,v){super(new Int32Array(o),d,v)}}class Dd extends As{constructor(o,d,v){super(new Uint32Array(o),d,v)}}class Tm extends As{constructor(o,d,v){super(new Uint16Array(o),d,v),this.isFloat16BufferAttribute=!0}getX(o){let d=zu(this.array[o*this.itemSize]);return this.normalized&&(d=Qa(d,this.array)),d}setX(o,d){return this.normalized&&(d=Vr(d,this.array)),this.array[o*this.itemSize]=ea(d),this}getY(o){let d=zu(this.array[o*this.itemSize+1]);return this.normalized&&(d=Qa(d,this.array)),d}setY(o,d){return this.normalized&&(d=Vr(d,this.array)),this.array[o*this.itemSize+1]=ea(d),this}getZ(o){let d=zu(this.array[o*this.itemSize+2]);return this.normalized&&(d=Qa(d,this.array)),d}setZ(o,d){return this.normalized&&(d=Vr(d,this.array)),this.array[o*this.itemSize+2]=ea(d),this}getW(o){let d=zu(this.array[o*this.itemSize+3]);return this.normalized&&(d=Qa(d,this.array)),d}setW(o,d){return this.normalized&&(d=Vr(d,this.array)),this.array[o*this.itemSize+3]=ea(d),this}setXY(o,d,v){return o*=this.itemSize,this.normalized&&(d=Vr(d,this.array),v=Vr(v,this.array)),this.array[o+0]=ea(d),this.array[o+1]=ea(v),this}setXYZ(o,d,v,b){return o*=this.itemSize,this.normalized&&(d=Vr(d,this.array),v=Vr(v,this.array),b=Vr(b,this.array)),this.array[o+0]=ea(d),this.array[o+1]=ea(v),this.array[o+2]=ea(b),this}setXYZW(o,d,v,b,E){return o*=this.itemSize,this.normalized&&(d=Vr(d,this.array),v=Vr(v,this.array),b=Vr(b,this.array),E=Vr(E,this.array)),this.array[o+0]=ea(d),this.array[o+1]=ea(v),this.array[o+2]=ea(b),this.array[o+3]=ea(E),this}}class ki extends As{constructor(o,d,v){super(new Float32Array(o),d,v)}}class df extends As{constructor(o,d,v){super(new Float64Array(o),d,v)}}let E_=0;const La=new Sr,Mh=new Gr,ee=new At,M=new ec,N=new ec,le=new At;class Ie extends Cc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:E_++}),this.uuid=Sa(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(o){return Array.isArray(o)?this.index=new(Jp(o)?Dd:pu)(o,1):this.index=o,this}getAttribute(o){return this.attributes[o]}setAttribute(o,d){return this.attributes[o]=d,this}deleteAttribute(o){return delete this.attributes[o],this}hasAttribute(o){return this.attributes[o]!==void 0}addGroup(o,d,v=0){this.groups.push({start:o,count:d,materialIndex:v})}clearGroups(){this.groups=[]}setDrawRange(o,d){this.drawRange.start=o,this.drawRange.count=d}applyMatrix4(o){const d=this.attributes.position;d!==void 0&&(d.applyMatrix4(o),d.needsUpdate=!0);const v=this.attributes.normal;if(v!==void 0){const E=new Dr().getNormalMatrix(o);v.applyNormalMatrix(E),v.needsUpdate=!0}const b=this.attributes.tangent;return b!==void 0&&(b.transformDirection(o),b.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(o){return La.makeRotationFromQuaternion(o),this.applyMatrix4(La),this}rotateX(o){return La.makeRotationX(o),this.applyMatrix4(La),this}rotateY(o){return La.makeRotationY(o),this.applyMatrix4(La),this}rotateZ(o){return La.makeRotationZ(o),this.applyMatrix4(La),this}translate(o,d,v){return La.makeTranslation(o,d,v),this.applyMatrix4(La),this}scale(o,d,v){return La.makeScale(o,d,v),this.applyMatrix4(La),this}lookAt(o){return Mh.lookAt(o),Mh.updateMatrix(),this.applyMatrix4(Mh.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ee).negate(),this.translate(ee.x,ee.y,ee.z),this}setFromPoints(o){const d=[];for(let v=0,b=o.length;v<b;v++){const E=o[v];d.push(E.x,E.y,E.z||0)}return this.setAttribute("position",new ki(d,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ec);const o=this.attributes.position,d=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new At(-1/0,-1/0,-1/0),new At(1/0,1/0,1/0));if(o!==void 0){if(this.boundingBox.setFromBufferAttribute(o),d)for(let v=0,b=d.length;v<b;v++){const E=d[v];M.setFromBufferAttribute(E),this.morphTargetsRelative?(le.addVectors(this.boundingBox.min,M.min),this.boundingBox.expandByPoint(le),le.addVectors(this.boundingBox.max,M.max),this.boundingBox.expandByPoint(le)):(this.boundingBox.expandByPoint(M.min),this.boundingBox.expandByPoint(M.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ko);const o=this.attributes.position,d=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new At,1/0);if(o){const v=this.boundingSphere.center;if(M.setFromBufferAttribute(o),d)for(let E=0,P=d.length;E<P;E++){const O=d[E];N.setFromBufferAttribute(O),this.morphTargetsRelative?(le.addVectors(M.min,N.min),M.expandByPoint(le),le.addVectors(M.max,N.max),M.expandByPoint(le)):(M.expandByPoint(N.min),M.expandByPoint(N.max))}M.getCenter(v);let b=0;for(let E=0,P=o.count;E<P;E++)le.fromBufferAttribute(o,E),b=Math.max(b,v.distanceToSquared(le));if(d)for(let E=0,P=d.length;E<P;E++){const O=d[E],Q=this.morphTargetsRelative;for(let G=0,te=O.count;G<te;G++)le.fromBufferAttribute(O,G),Q&&(ee.fromBufferAttribute(o,G),le.add(ee)),b=Math.max(b,v.distanceToSquared(le))}this.boundingSphere.radius=Math.sqrt(b),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const o=this.index,d=this.attributes;if(o===null||d.position===void 0||d.normal===void 0||d.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const v=o.array,b=d.position.array,E=d.normal.array,P=d.uv.array,O=b.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new As(new Float32Array(4*O),4));const Q=this.getAttribute("tangent").array,G=[],te=[];for(let an=0;an<O;an++)G[an]=new At,te[an]=new At;const ge=new At,fe=new At,_e=new At,xe=new jn,Re=new jn,we=new jn,Ce=new At,De=new At;function ze(an,Ot,Mn){ge.fromArray(b,3*an),fe.fromArray(b,3*Ot),_e.fromArray(b,3*Mn),xe.fromArray(P,2*an),Re.fromArray(P,2*Ot),we.fromArray(P,2*Mn),fe.sub(ge),_e.sub(ge),Re.sub(xe),we.sub(xe);const Sn=1/(Re.x*we.y-we.x*Re.y);isFinite(Sn)&&(Ce.copy(fe).multiplyScalar(we.y).addScaledVector(_e,-Re.y).multiplyScalar(Sn),De.copy(_e).multiplyScalar(Re.x).addScaledVector(fe,-we.x).multiplyScalar(Sn),G[an].add(Ce),G[Ot].add(Ce),G[Mn].add(Ce),te[an].add(De),te[Ot].add(De),te[Mn].add(De))}let dt=this.groups;dt.length===0&&(dt=[{start:0,count:v.length}]);for(let an=0,Ot=dt.length;an<Ot;++an){const Mn=dt[an],Sn=Mn.start;for(let ti=Sn,xi=Sn+Mn.count;ti<xi;ti+=3)ze(v[ti+0],v[ti+1],v[ti+2])}const rt=new At,st=new At,It=new At,Kt=new At;function Dt(an){It.fromArray(E,3*an),Kt.copy(It);const Ot=G[an];rt.copy(Ot),rt.sub(It.multiplyScalar(It.dot(Ot))).normalize(),st.crossVectors(Kt,Ot);const Mn=st.dot(te[an])<0?-1:1;Q[4*an]=rt.x,Q[4*an+1]=rt.y,Q[4*an+2]=rt.z,Q[4*an+3]=Mn}for(let an=0,Ot=dt.length;an<Ot;++an){const Mn=dt[an],Sn=Mn.start;for(let ti=Sn,xi=Sn+Mn.count;ti<xi;ti+=3)Dt(v[ti+0]),Dt(v[ti+1]),Dt(v[ti+2])}}computeVertexNormals(){const o=this.index,d=this.getAttribute("position");if(d!==void 0){let v=this.getAttribute("normal");if(v===void 0)v=new As(new Float32Array(3*d.count),3),this.setAttribute("normal",v);else for(let fe=0,_e=v.count;fe<_e;fe++)v.setXYZ(fe,0,0,0);const b=new At,E=new At,P=new At,O=new At,Q=new At,G=new At,te=new At,ge=new At;if(o)for(let fe=0,_e=o.count;fe<_e;fe+=3){const xe=o.getX(fe+0),Re=o.getX(fe+1),we=o.getX(fe+2);b.fromBufferAttribute(d,xe),E.fromBufferAttribute(d,Re),P.fromBufferAttribute(d,we),te.subVectors(P,E),ge.subVectors(b,E),te.cross(ge),O.fromBufferAttribute(v,xe),Q.fromBufferAttribute(v,Re),G.fromBufferAttribute(v,we),O.add(te),Q.add(te),G.add(te),v.setXYZ(xe,O.x,O.y,O.z),v.setXYZ(Re,Q.x,Q.y,Q.z),v.setXYZ(we,G.x,G.y,G.z)}else for(let fe=0,_e=d.count;fe<_e;fe+=3)b.fromBufferAttribute(d,fe+0),E.fromBufferAttribute(d,fe+1),P.fromBufferAttribute(d,fe+2),te.subVectors(P,E),ge.subVectors(b,E),te.cross(ge),v.setXYZ(fe+0,te.x,te.y,te.z),v.setXYZ(fe+1,te.x,te.y,te.z),v.setXYZ(fe+2,te.x,te.y,te.z);this.normalizeNormals(),v.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const o=this.attributes.normal;for(let d=0,v=o.count;d<v;d++)le.fromBufferAttribute(o,d),le.normalize(),o.setXYZ(d,le.x,le.y,le.z)}toNonIndexed(){function o(O,Q){const G=O.array,te=O.itemSize,ge=O.normalized,fe=new G.constructor(Q.length*te);let _e=0,xe=0;for(let Re=0,we=Q.length;Re<we;Re++){_e=O.isInterleavedBufferAttribute?Q[Re]*O.data.stride+O.offset:Q[Re]*te;for(let Ce=0;Ce<te;Ce++)fe[xe++]=G[_e++]}return new As(fe,te,ge)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const d=new Ie,v=this.index.array,b=this.attributes;for(const O in b){const Q=o(b[O],v);d.setAttribute(O,Q)}const E=this.morphAttributes;for(const O in E){const Q=[],G=E[O];for(let te=0,ge=G.length;te<ge;te++){const fe=o(G[te],v);Q.push(fe)}d.morphAttributes[O]=Q}d.morphTargetsRelative=this.morphTargetsRelative;const P=this.groups;for(let O=0,Q=P.length;O<Q;O++){const G=P[O];d.addGroup(G.start,G.count,G.materialIndex)}return d}toJSON(){const o={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),Object.keys(this.userData).length>0&&(o.userData=this.userData),this.parameters!==void 0){const Q=this.parameters;for(const G in Q)Q[G]!==void 0&&(o[G]=Q[G]);return o}o.data={attributes:{}};const d=this.index;d!==null&&(o.data.index={type:d.array.constructor.name,array:Array.prototype.slice.call(d.array)});const v=this.attributes;for(const Q in v){const G=v[Q];o.data.attributes[Q]=G.toJSON(o.data)}const b={};let E=!1;for(const Q in this.morphAttributes){const G=this.morphAttributes[Q],te=[];for(let ge=0,fe=G.length;ge<fe;ge++){const _e=G[ge];te.push(_e.toJSON(o.data))}te.length>0&&(b[Q]=te,E=!0)}E&&(o.data.morphAttributes=b,o.data.morphTargetsRelative=this.morphTargetsRelative);const P=this.groups;P.length>0&&(o.data.groups=JSON.parse(JSON.stringify(P)));const O=this.boundingSphere;return O!==null&&(o.data.boundingSphere={center:O.center.toArray(),radius:O.radius}),o}clone(){return new this.constructor().copy(this)}copy(o){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const d={};this.name=o.name;const v=o.index;v!==null&&this.setIndex(v.clone(d));const b=o.attributes;for(const G in b){const te=b[G];this.setAttribute(G,te.clone(d))}const E=o.morphAttributes;for(const G in E){const te=[],ge=E[G];for(let fe=0,_e=ge.length;fe<_e;fe++)te.push(ge[fe].clone(d));this.morphAttributes[G]=te}this.morphTargetsRelative=o.morphTargetsRelative;const P=o.groups;for(let G=0,te=P.length;G<te;G++){const ge=P[G];this.addGroup(ge.start,ge.count,ge.materialIndex)}const O=o.boundingBox;O!==null&&(this.boundingBox=O.clone());const Q=o.boundingSphere;return Q!==null&&(this.boundingSphere=Q.clone()),this.drawRange.start=o.drawRange.start,this.drawRange.count=o.drawRange.count,this.userData=o.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const ct=new Sr,yt=new Bc,on=new ko,ei=new At,Ci=new At,yr=new At,Es=new At,da=new At,jo=new At,Dl=new jn,ju=new jn,fu=new jn,Ld=new At,Gu=new At,Ch=new At,Bd=new At,pf=new At;class Co extends Gr{constructor(o=new Ie,d=new ys){super(),this.isMesh=!0,this.type="Mesh",this.geometry=o,this.material=d,this.updateMorphTargets()}copy(o,d){return super.copy(o,d),o.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=o.morphTargetInfluences.slice()),o.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},o.morphTargetDictionary)),this.material=o.material,this.geometry=o.geometry,this}updateMorphTargets(){const o=this.geometry.morphAttributes,d=Object.keys(o);if(d.length>0){const v=o[d[0]];if(v!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let b=0,E=v.length;b<E;b++){const P=v[b].name||String(b);this.morphTargetInfluences.push(0),this.morphTargetDictionary[P]=b}}}}getVertexPosition(o,d){const v=this.geometry,b=v.attributes.position,E=v.morphAttributes.position,P=v.morphTargetsRelative;d.fromBufferAttribute(b,o);const O=this.morphTargetInfluences;if(E&&O){jo.set(0,0,0);for(let Q=0,G=E.length;Q<G;Q++){const te=O[Q],ge=E[Q];te!==0&&(da.fromBufferAttribute(ge,o),P?jo.addScaledVector(da,te):jo.addScaledVector(da.sub(d),te))}d.add(jo)}return d}raycast(o,d){const v=this.geometry,b=this.material,E=this.matrixWorld;if(b!==void 0){if(v.boundingSphere===null&&v.computeBoundingSphere(),on.copy(v.boundingSphere),on.applyMatrix4(E),yt.copy(o.ray).recast(o.near),on.containsPoint(yt.origin)===!1&&(yt.intersectSphere(on,ei)===null||yt.origin.distanceToSquared(ei)>(o.far-o.near)**2))return;ct.copy(E).invert(),yt.copy(o.ray).applyMatrix4(ct),v.boundingBox!==null&&yt.intersectsBox(v.boundingBox)===!1||this._computeIntersections(o,d)}}_computeIntersections(o,d){let v;const b=this.geometry,E=this.material,P=b.index,O=b.attributes.position,Q=b.attributes.uv,G=b.attributes.uv1,te=b.attributes.normal,ge=b.groups,fe=b.drawRange;if(P!==null)if(Array.isArray(E))for(let _e=0,xe=ge.length;_e<xe;_e++){const Re=ge[_e],we=E[Re.materialIndex];for(let Ce=Math.max(Re.start,fe.start),De=Math.min(P.count,Math.min(Re.start+Re.count,fe.start+fe.count));Ce<De;Ce+=3){const ze=P.getX(Ce),dt=P.getX(Ce+1),rt=P.getX(Ce+2);v=Ll(this,we,o,yt,Q,G,te,ze,dt,rt),v&&(v.faceIndex=Math.floor(Ce/3),v.face.materialIndex=Re.materialIndex,d.push(v))}}else for(let _e=Math.max(0,fe.start),xe=Math.min(P.count,fe.start+fe.count);_e<xe;_e+=3){const Re=P.getX(_e),we=P.getX(_e+1),Ce=P.getX(_e+2);v=Ll(this,E,o,yt,Q,G,te,Re,we,Ce),v&&(v.faceIndex=Math.floor(_e/3),d.push(v))}else if(O!==void 0)if(Array.isArray(E))for(let _e=0,xe=ge.length;_e<xe;_e++){const Re=ge[_e],we=E[Re.materialIndex];for(let Ce=Math.max(Re.start,fe.start),De=Math.min(O.count,Math.min(Re.start+Re.count,fe.start+fe.count));Ce<De;Ce+=3)v=Ll(this,we,o,yt,Q,G,te,Ce,Ce+1,Ce+2),v&&(v.faceIndex=Math.floor(Ce/3),v.face.materialIndex=Re.materialIndex,d.push(v))}else for(let _e=Math.max(0,fe.start),xe=Math.min(O.count,fe.start+fe.count);_e<xe;_e+=3)v=Ll(this,E,o,yt,Q,G,te,_e,_e+1,_e+2),v&&(v.faceIndex=Math.floor(_e/3),d.push(v))}}function Ll(I,o,d,v,b,E,P,O,Q,G){I.getVertexPosition(O,Ci),I.getVertexPosition(Q,yr),I.getVertexPosition(G,Es);const te=function(ge,fe,_e,xe,Re,we,Ce,De){let ze;if(ze=fe.side===oe?xe.intersectTriangle(Ce,we,Re,!0,De):xe.intersectTriangle(Re,we,Ce,fe.side===$,De),ze===null)return null;pf.copy(De),pf.applyMatrix4(ge.matrixWorld);const dt=_e.ray.origin.distanceTo(pf);return dt<_e.near||dt>_e.far?null:{distance:dt,point:pf.clone(),object:ge}}(I,o,d,v,Ci,yr,Es,Bd);if(te){b&&(Dl.fromBufferAttribute(b,O),ju.fromBufferAttribute(b,Q),fu.fromBufferAttribute(b,G),te.uv=zo.getInterpolation(Bd,Ci,yr,Es,Dl,ju,fu,new jn)),E&&(Dl.fromBufferAttribute(E,O),ju.fromBufferAttribute(E,Q),fu.fromBufferAttribute(E,G),te.uv1=zo.getInterpolation(Bd,Ci,yr,Es,Dl,ju,fu,new jn),te.uv2=te.uv1),P&&(Ld.fromBufferAttribute(P,O),Gu.fromBufferAttribute(P,Q),Ch.fromBufferAttribute(P,G),te.normal=zo.getInterpolation(Bd,Ci,yr,Es,Ld,Gu,Ch,new At),te.normal.dot(v.direction)>0&&te.normal.multiplyScalar(-1));const ge={a:O,b:Q,c:G,normal:new At,materialIndex:0};zo.getNormal(Ci,yr,Es,ge.normal),te.face=ge}return te}class ac extends Ie{constructor(o=1,d=1,v=1,b=1,E=1,P=1){super(),this.type="BoxGeometry",this.parameters={width:o,height:d,depth:v,widthSegments:b,heightSegments:E,depthSegments:P};const O=this;b=Math.floor(b),E=Math.floor(E),P=Math.floor(P);const Q=[],G=[],te=[],ge=[];let fe=0,_e=0;function xe(Re,we,Ce,De,ze,dt,rt,st,It,Kt,Dt){const an=dt/It,Ot=rt/Kt,Mn=dt/2,Sn=rt/2,ti=st/2,xi=It+1,ni=Kt+1;let Kn=0,gi=0;const Ai=new At;for(let wn=0;wn<ni;wn++){const qn=wn*Ot-Sn;for(let vi=0;vi<xi;vi++){const ii=vi*an-Mn;Ai[Re]=ii*De,Ai[we]=qn*ze,Ai[Ce]=ti,G.push(Ai.x,Ai.y,Ai.z),Ai[Re]=0,Ai[we]=0,Ai[Ce]=st>0?1:-1,te.push(Ai.x,Ai.y,Ai.z),ge.push(vi/It),ge.push(1-wn/Kt),Kn+=1}}for(let wn=0;wn<Kt;wn++)for(let qn=0;qn<It;qn++){const vi=fe+qn+xi*wn,ii=fe+qn+xi*(wn+1),Si=fe+(qn+1)+xi*(wn+1),rr=fe+(qn+1)+xi*wn;Q.push(vi,ii,rr),Q.push(ii,Si,rr),gi+=6}O.addGroup(_e,gi,Dt),_e+=gi,fe+=Kn}xe("z","y","x",-1,-1,v,d,o,P,E,0),xe("z","y","x",1,-1,v,d,-o,P,E,1),xe("x","z","y",1,1,o,v,d,b,P,2),xe("x","z","y",1,-1,o,v,-d,b,P,3),xe("x","y","z",1,-1,o,d,v,b,E,4),xe("x","y","z",-1,-1,o,d,-v,b,E,5),this.setIndex(Q),this.setAttribute("position",new ki(G,3)),this.setAttribute("normal",new ki(te,3)),this.setAttribute("uv",new ki(ge,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new ac(o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments)}}function Rh(I){const o={};for(const d in I){o[d]={};for(const v in I[d]){const b=I[d][v];b&&(b.isColor||b.isMatrix3||b.isMatrix4||b.isVector2||b.isVector3||b.isVector4||b.isTexture||b.isQuaternion)?b.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),o[d][v]=null):o[d][v]=b.clone():Array.isArray(b)?o[d][v]=b.slice():o[d][v]=b}}return o}function Ba(I){const o={};for(let d=0;d<I.length;d++){const v=Rh(I[d]);for(const b in v)o[b]=v[b]}return o}function _0(I){return I.getRenderTarget()===null?I.outputColorSpace:ws}const v0={clone:Rh,merge:Ba};class ta extends Vo{constructor(o){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,o!==void 0&&this.setValues(o)}copy(o){return super.copy(o),this.fragmentShader=o.fragmentShader,this.vertexShader=o.vertexShader,this.uniforms=Rh(o.uniforms),this.uniformsGroups=function(d){const v=[];for(let b=0;b<d.length;b++)v.push(d[b].clone());return v}(o.uniformsGroups),this.defines=Object.assign({},o.defines),this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.fog=o.fog,this.lights=o.lights,this.clipping=o.clipping,this.extensions=Object.assign({},o.extensions),this.glslVersion=o.glslVersion,this}toJSON(o){const d=super.toJSON(o);d.glslVersion=this.glslVersion,d.uniforms={};for(const b in this.uniforms){const E=this.uniforms[b].value;E&&E.isTexture?d.uniforms[b]={type:"t",value:E.toJSON(o).uuid}:E&&E.isColor?d.uniforms[b]={type:"c",value:E.getHex()}:E&&E.isVector2?d.uniforms[b]={type:"v2",value:E.toArray()}:E&&E.isVector3?d.uniforms[b]={type:"v3",value:E.toArray()}:E&&E.isVector4?d.uniforms[b]={type:"v4",value:E.toArray()}:E&&E.isMatrix3?d.uniforms[b]={type:"m3",value:E.toArray()}:E&&E.isMatrix4?d.uniforms[b]={type:"m4",value:E.toArray()}:d.uniforms[b]={value:E}}Object.keys(this.defines).length>0&&(d.defines=this.defines),d.vertexShader=this.vertexShader,d.fragmentShader=this.fragmentShader,d.lights=this.lights,d.clipping=this.clipping;const v={};for(const b in this.extensions)this.extensions[b]===!0&&(v[b]=!0);return Object.keys(v).length>0&&(d.extensions=v),d}}class Hu extends Gr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Sr,this.projectionMatrix=new Sr,this.projectionMatrixInverse=new Sr}copy(o,d){return super.copy(o,d),this.matrixWorldInverse.copy(o.matrixWorldInverse),this.projectionMatrix.copy(o.projectionMatrix),this.projectionMatrixInverse.copy(o.projectionMatrixInverse),this}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const d=this.matrixWorld.elements;return o.set(-d[8],-d[9],-d[10]).normalize()}updateMatrixWorld(o){super.updateMatrixWorld(o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(o,d){super.updateWorldMatrix(o,d),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Go extends Hu{constructor(o=50,d=1,v=.1,b=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=o,this.zoom=1,this.near=v,this.far=b,this.focus=10,this.aspect=d,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(o,d){return super.copy(o,d),this.fov=o.fov,this.zoom=o.zoom,this.near=o.near,this.far=o.far,this.focus=o.focus,this.aspect=o.aspect,this.view=o.view===null?null:Object.assign({},o.view),this.filmGauge=o.filmGauge,this.filmOffset=o.filmOffset,this}setFocalLength(o){const d=.5*this.getFilmHeight()/o;this.fov=2*hl*Math.atan(d),this.updateProjectionMatrix()}getFocalLength(){const o=Math.tan(.5*ou*this.fov);return .5*this.getFilmHeight()/o}getEffectiveFOV(){return 2*hl*Math.atan(Math.tan(.5*ou*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(o,d,v,b,E,P){this.aspect=o/d,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=d,this.view.offsetX=v,this.view.offsetY=b,this.view.width=E,this.view.height=P,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=this.near;let d=o*Math.tan(.5*ou*this.fov)/this.zoom,v=2*d,b=this.aspect*v,E=-.5*b;const P=this.view;if(this.view!==null&&this.view.enabled){const Q=P.fullWidth,G=P.fullHeight;E+=P.offsetX*b/Q,d-=P.offsetY*v/G,b*=P.width/Q,v*=P.height/G}const O=this.filmOffset;O!==0&&(E+=o*O/this.getFilmWidth()),this.projectionMatrix.makePerspective(E,E+b,d,d-v,o,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const d=super.toJSON(o);return d.object.fov=this.fov,d.object.zoom=this.zoom,d.object.near=this.near,d.object.far=this.far,d.object.focus=this.focus,d.object.aspect=this.aspect,this.view!==null&&(d.object.view=Object.assign({},this.view)),d.object.filmGauge=this.filmGauge,d.object.filmOffset=this.filmOffset,d}}const mu=-90;class zA extends Gr{constructor(o,d,v){super(),this.type="CubeCamera",this.renderTarget=v;const b=new Go(mu,1,o,d);b.layers=this.layers,b.up.set(0,1,0),b.lookAt(1,0,0),this.add(b);const E=new Go(mu,1,o,d);E.layers=this.layers,E.up.set(0,1,0),E.lookAt(-1,0,0),this.add(E);const P=new Go(mu,1,o,d);P.layers=this.layers,P.up.set(0,0,-1),P.lookAt(0,1,0),this.add(P);const O=new Go(mu,1,o,d);O.layers=this.layers,O.up.set(0,0,1),O.lookAt(0,-1,0),this.add(O);const Q=new Go(mu,1,o,d);Q.layers=this.layers,Q.up.set(0,1,0),Q.lookAt(0,0,1),this.add(Q);const G=new Go(mu,1,o,d);G.layers=this.layers,G.up.set(0,1,0),G.lookAt(0,0,-1),this.add(G)}update(o,d){this.parent===null&&this.updateMatrixWorld();const v=this.renderTarget,[b,E,P,O,Q,G]=this.children,te=o.getRenderTarget(),ge=o.toneMapping,fe=o.xr.enabled;o.toneMapping=jt,o.xr.enabled=!1;const _e=v.texture.generateMipmaps;v.texture.generateMipmaps=!1,o.setRenderTarget(v,0),o.render(d,b),o.setRenderTarget(v,1),o.render(d,E),o.setRenderTarget(v,2),o.render(d,P),o.setRenderTarget(v,3),o.render(d,O),o.setRenderTarget(v,4),o.render(d,Q),v.texture.generateMipmaps=_e,o.setRenderTarget(v,5),o.render(d,G),o.setRenderTarget(te),o.toneMapping=ge,o.xr.enabled=fe,v.texture.needsPMREMUpdate=!0}}class Mm extends Vs{constructor(o,d,v,b,E,P,O,Q,G,te){super(o=o!==void 0?o:[],d=d!==void 0?d:Bn,v,b,E,P,O,Q,G,te),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(o){this.image=o}}class VA extends vo{constructor(o=1,d={}){super(o,o,d),this.isWebGLCubeRenderTarget=!0;const v={width:o,height:o,depth:1},b=[v,v,v,v,v,v];d.encoding!==void 0&&(Ma("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),d.colorSpace=d.encoding===Er?or:Eo),this.texture=new Mm(b,d.mapping,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=d.generateMipmaps!==void 0&&d.generateMipmaps,this.texture.minFilter=d.minFilter!==void 0?d.minFilter:en}fromEquirectangularTexture(o,d){this.texture.type=d.type,this.texture.colorSpace=d.colorSpace,this.texture.generateMipmaps=d.generateMipmaps,this.texture.minFilter=d.minFilter,this.texture.magFilter=d.magFilter;const v={tEquirect:{value:null}},b=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,E=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,P=new ac(5,5,5),O=new ta({name:"CubemapFromEquirect",uniforms:Rh(v),vertexShader:b,fragmentShader:E,side:oe,blending:V});O.uniforms.tEquirect.value=d;const Q=new Co(P,O),G=d.minFilter;return d.minFilter===Gi&&(d.minFilter=en),new zA(1,10,this).update(o,Q),d.minFilter=G,Q.geometry.dispose(),Q.material.dispose(),this}clear(o,d,v,b){const E=o.getRenderTarget();for(let P=0;P<6;P++)o.setRenderTarget(this,P),o.clear(d,v,b);o.setRenderTarget(E)}}const y0=new At,A0=new At,jA=new Dr;class Ih{constructor(o=new At(1,0,0),d=0){this.isPlane=!0,this.normal=o,this.constant=d}set(o,d){return this.normal.copy(o),this.constant=d,this}setComponents(o,d,v,b){return this.normal.set(o,d,v),this.constant=b,this}setFromNormalAndCoplanarPoint(o,d){return this.normal.copy(o),this.constant=-d.dot(this.normal),this}setFromCoplanarPoints(o,d,v){const b=y0.subVectors(v,d).cross(A0.subVectors(o,d)).normalize();return this.setFromNormalAndCoplanarPoint(b,o),this}copy(o){return this.normal.copy(o.normal),this.constant=o.constant,this}normalize(){const o=1/this.normal.length();return this.normal.multiplyScalar(o),this.constant*=o,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(o){return this.normal.dot(o)+this.constant}distanceToSphere(o){return this.distanceToPoint(o.center)-o.radius}projectPoint(o,d){return d.copy(o).addScaledVector(this.normal,-this.distanceToPoint(o))}intersectLine(o,d){const v=o.delta(y0),b=this.normal.dot(v);if(b===0)return this.distanceToPoint(o.start)===0?d.copy(o.start):null;const E=-(o.start.dot(this.normal)+this.constant)/b;return E<0||E>1?null:d.copy(o.start).addScaledVector(v,E)}intersectsLine(o){const d=this.distanceToPoint(o.start),v=this.distanceToPoint(o.end);return d<0&&v>0||v<0&&d>0}intersectsBox(o){return o.intersectsPlane(this)}intersectsSphere(o){return o.intersectsPlane(this)}coplanarPoint(o){return o.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(o,d){const v=d||jA.getNormalMatrix(o),b=this.coplanarPoint(y0).applyMatrix4(o),E=this.normal.applyMatrix3(v).normalize();return this.constant=-b.dot(E),this}translate(o){return this.constant-=o.dot(this.normal),this}equals(o){return o.normal.equals(this.normal)&&o.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Od=new ko,S_=new At;class T_{constructor(o=new Ih,d=new Ih,v=new Ih,b=new Ih,E=new Ih,P=new Ih){this.planes=[o,d,v,b,E,P]}set(o,d,v,b,E,P){const O=this.planes;return O[0].copy(o),O[1].copy(d),O[2].copy(v),O[3].copy(b),O[4].copy(E),O[5].copy(P),this}copy(o){const d=this.planes;for(let v=0;v<6;v++)d[v].copy(o.planes[v]);return this}setFromProjectionMatrix(o){const d=this.planes,v=o.elements,b=v[0],E=v[1],P=v[2],O=v[3],Q=v[4],G=v[5],te=v[6],ge=v[7],fe=v[8],_e=v[9],xe=v[10],Re=v[11],we=v[12],Ce=v[13],De=v[14],ze=v[15];return d[0].setComponents(O-b,ge-Q,Re-fe,ze-we).normalize(),d[1].setComponents(O+b,ge+Q,Re+fe,ze+we).normalize(),d[2].setComponents(O+E,ge+G,Re+_e,ze+Ce).normalize(),d[3].setComponents(O-E,ge-G,Re-_e,ze-Ce).normalize(),d[4].setComponents(O-P,ge-te,Re-xe,ze-De).normalize(),d[5].setComponents(O+P,ge+te,Re+xe,ze+De).normalize(),this}intersectsObject(o){if(o.boundingSphere!==void 0)o.boundingSphere===null&&o.computeBoundingSphere(),Od.copy(o.boundingSphere).applyMatrix4(o.matrixWorld);else{const d=o.geometry;d.boundingSphere===null&&d.computeBoundingSphere(),Od.copy(d.boundingSphere).applyMatrix4(o.matrixWorld)}return this.intersectsSphere(Od)}intersectsSprite(o){return Od.center.set(0,0,0),Od.radius=.7071067811865476,Od.applyMatrix4(o.matrixWorld),this.intersectsSphere(Od)}intersectsSphere(o){const d=this.planes,v=o.center,b=-o.radius;for(let E=0;E<6;E++)if(d[E].distanceToPoint(v)<b)return!1;return!0}intersectsBox(o){const d=this.planes;for(let v=0;v<6;v++){const b=d[v];if(S_.x=b.normal.x>0?o.max.x:o.min.x,S_.y=b.normal.y>0?o.max.y:o.min.y,S_.z=b.normal.z>0?o.max.z:o.min.z,b.distanceToPoint(S_)<0)return!1}return!0}containsPoint(o){const d=this.planes;for(let v=0;v<6;v++)if(d[v].distanceToPoint(o)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ff(){let I=null,o=!1,d=null,v=null;function b(E,P){d(E,P),v=I.requestAnimationFrame(b)}return{start:function(){o!==!0&&d!==null&&(v=I.requestAnimationFrame(b),o=!0)},stop:function(){I.cancelAnimationFrame(v),o=!1},setAnimationLoop:function(E){d=E},setContext:function(E){I=E}}}function b0(I,o){const d=o.isWebGL2,v=new WeakMap;return{get:function(b){return b.isInterleavedBufferAttribute&&(b=b.data),v.get(b)},remove:function(b){b.isInterleavedBufferAttribute&&(b=b.data);const E=v.get(b);E&&(I.deleteBuffer(E.buffer),v.delete(b))},update:function(b,E){if(b.isGLBufferAttribute){const O=v.get(b);return void((!O||O.version<b.version)&&v.set(b,{buffer:b.buffer,type:b.type,bytesPerElement:b.elementSize,version:b.version}))}b.isInterleavedBufferAttribute&&(b=b.data);const P=v.get(b);P===void 0?v.set(b,function(O,Q){const G=O.array,te=O.usage,ge=I.createBuffer();let fe;if(I.bindBuffer(Q,ge),I.bufferData(Q,G,te),O.onUploadCallback(),G instanceof Float32Array)fe=I.FLOAT;else if(G instanceof Uint16Array)if(O.isFloat16BufferAttribute){if(!d)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");fe=I.HALF_FLOAT}else fe=I.UNSIGNED_SHORT;else if(G instanceof Int16Array)fe=I.SHORT;else if(G instanceof Uint32Array)fe=I.UNSIGNED_INT;else if(G instanceof Int32Array)fe=I.INT;else if(G instanceof Int8Array)fe=I.BYTE;else if(G instanceof Uint8Array)fe=I.UNSIGNED_BYTE;else{if(!(G instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+G);fe=I.UNSIGNED_BYTE}return{buffer:ge,type:fe,bytesPerElement:G.BYTES_PER_ELEMENT,version:O.version}}(b,E)):P.version<b.version&&(function(O,Q,G){const te=Q.array,ge=Q.updateRange;I.bindBuffer(G,O),ge.count===-1?I.bufferSubData(G,0,te):(d?I.bufferSubData(G,ge.offset*te.BYTES_PER_ELEMENT,te,ge.offset,ge.count):I.bufferSubData(G,ge.offset*te.BYTES_PER_ELEMENT,te.subarray(ge.offset,ge.offset+ge.count)),ge.count=-1),Q.onUploadCallback()}(P.buffer,b,E),P.version=b.version)}}}class Nd extends Ie{constructor(o=1,d=1,v=1,b=1){super(),this.type="PlaneGeometry",this.parameters={width:o,height:d,widthSegments:v,heightSegments:b};const E=o/2,P=d/2,O=Math.floor(v),Q=Math.floor(b),G=O+1,te=Q+1,ge=o/O,fe=d/Q,_e=[],xe=[],Re=[],we=[];for(let Ce=0;Ce<te;Ce++){const De=Ce*fe-P;for(let ze=0;ze<G;ze++){const dt=ze*ge-E;xe.push(dt,-De,0),Re.push(0,0,1),we.push(ze/O),we.push(1-Ce/Q)}}for(let Ce=0;Ce<Q;Ce++)for(let De=0;De<O;De++){const ze=De+G*Ce,dt=De+G*(Ce+1),rt=De+1+G*(Ce+1),st=De+1+G*Ce;_e.push(ze,dt,st),_e.push(dt,rt,st)}this.setIndex(_e),this.setAttribute("position",new ki(xe,3)),this.setAttribute("normal",new ki(Re,3)),this.setAttribute("uv",new ki(we,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new Nd(o.width,o.height,o.widthSegments,o.heightSegments)}}const Hr={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},Ri={common:{diffuse:{value:new Mi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Dr},alphaMap:{value:null},alphaMapTransform:{value:new Dr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Dr}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Dr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Dr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Dr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Dr},normalScale:{value:new jn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Dr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Dr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Dr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Dr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Mi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Mi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Dr}},sprite:{diffuse:{value:new Mi(16777215)},opacity:{value:1},center:{value:new jn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Dr},alphaMap:{value:null},alphaTest:{value:0}}},Ja={basic:{uniforms:Ba([Ri.common,Ri.specularmap,Ri.envmap,Ri.aomap,Ri.lightmap,Ri.fog]),vertexShader:Hr.meshbasic_vert,fragmentShader:Hr.meshbasic_frag},lambert:{uniforms:Ba([Ri.common,Ri.specularmap,Ri.envmap,Ri.aomap,Ri.lightmap,Ri.emissivemap,Ri.bumpmap,Ri.normalmap,Ri.displacementmap,Ri.fog,Ri.lights,{emissive:{value:new Mi(0)}}]),vertexShader:Hr.meshlambert_vert,fragmentShader:Hr.meshlambert_frag},phong:{uniforms:Ba([Ri.common,Ri.specularmap,Ri.envmap,Ri.aomap,Ri.lightmap,Ri.emissivemap,Ri.bumpmap,Ri.normalmap,Ri.displacementmap,Ri.fog,Ri.lights,{emissive:{value:new Mi(0)},specular:{value:new Mi(1118481)},shininess:{value:30}}]),vertexShader:Hr.meshphong_vert,fragmentShader:Hr.meshphong_frag},standard:{uniforms:Ba([Ri.common,Ri.envmap,Ri.aomap,Ri.lightmap,Ri.emissivemap,Ri.bumpmap,Ri.normalmap,Ri.displacementmap,Ri.roughnessmap,Ri.metalnessmap,Ri.fog,Ri.lights,{emissive:{value:new Mi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Hr.meshphysical_vert,fragmentShader:Hr.meshphysical_frag},toon:{uniforms:Ba([Ri.common,Ri.aomap,Ri.lightmap,Ri.emissivemap,Ri.bumpmap,Ri.normalmap,Ri.displacementmap,Ri.gradientmap,Ri.fog,Ri.lights,{emissive:{value:new Mi(0)}}]),vertexShader:Hr.meshtoon_vert,fragmentShader:Hr.meshtoon_frag},matcap:{uniforms:Ba([Ri.common,Ri.bumpmap,Ri.normalmap,Ri.displacementmap,Ri.fog,{matcap:{value:null}}]),vertexShader:Hr.meshmatcap_vert,fragmentShader:Hr.meshmatcap_frag},points:{uniforms:Ba([Ri.points,Ri.fog]),vertexShader:Hr.points_vert,fragmentShader:Hr.points_frag},dashed:{uniforms:Ba([Ri.common,Ri.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Hr.linedashed_vert,fragmentShader:Hr.linedashed_frag},depth:{uniforms:Ba([Ri.common,Ri.displacementmap]),vertexShader:Hr.depth_vert,fragmentShader:Hr.depth_frag},normal:{uniforms:Ba([Ri.common,Ri.bumpmap,Ri.normalmap,Ri.displacementmap,{opacity:{value:1}}]),vertexShader:Hr.meshnormal_vert,fragmentShader:Hr.meshnormal_frag},sprite:{uniforms:Ba([Ri.sprite,Ri.fog]),vertexShader:Hr.sprite_vert,fragmentShader:Hr.sprite_frag},background:{uniforms:{uvTransform:{value:new Dr},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new Mi(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:Hr.background_vert,fragmentShader:Hr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Hr.backgroundCube_vert,fragmentShader:Hr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Hr.cube_vert,fragmentShader:Hr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Hr.equirect_vert,fragmentShader:Hr.equirect_frag},distanceRGBA:{uniforms:Ba([Ri.common,Ri.displacementmap,{referencePosition:{value:new At},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Hr.distanceRGBA_vert,fragmentShader:Hr.distanceRGBA_frag},shadow:{uniforms:Ba([Ri.lights,Ri.fog,{color:{value:new Mi(0)},opacity:{value:1}}]),vertexShader:Hr.shadow_vert,fragmentShader:Hr.shadow_frag}};Ja.physical={uniforms:Ba([Ja.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Dr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Dr},clearcoatNormalScale:{value:new jn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Dr},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Dr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Dr},sheen:{value:0},sheenColor:{value:new Mi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Dr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Dr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Dr},transmissionSamplerSize:{value:new jn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Dr},attenuationDistance:{value:0},attenuationColor:{value:new Mi(0)},specularColor:{value:new Mi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Dr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Dr}}]),vertexShader:Hr.meshphysical_vert,fragmentShader:Hr.meshphysical_frag};const ri={r:0,b:0,g:0};function GA(I,o,d,v,b,E,P){const O=new Mi(0);let Q,G,te=E===!0?0:1,ge=null,fe=0,_e=null;function xe(Re,we){Re.getRGB(ri,_0(I)),v.buffers.color.setClear(ri.r,ri.g,ri.b,we,P)}return{getClearColor:function(){return O},setClearColor:function(Re,we=1){O.set(Re),te=we,xe(O,te)},getClearAlpha:function(){return te},setClearAlpha:function(Re){te=Re,xe(O,te)},getPlaneMesh:function(){return Q},getBoxMesh:function(){return G},getBoxMesh2:function(){return G===void 0&&(G=new Co(new ac(1,1,1),new ta({name:"BackgroundCubeMaterial",uniforms:Rh(Ja.backgroundCube.uniforms),vertexShader:Ja.backgroundCube.vertexShader,fragmentShader:Ja.backgroundCube.fragmentShader,side:oe,depthTest:!1,depthWrite:!1,fog:!1})),G.geometry.deleteAttribute("normal"),G.geometry.deleteAttribute("uv"),G.onBeforeRender=function(Re,we,Ce){this.matrixWorld.copyPosition(Ce.matrixWorld)},Object.defineProperty(G.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),b.update(G)),G},render:function(Re,we){let Ce=!1,De=we.isScene===!0?we.background:null;const ze=we.isScene&&we.backgroundColor!==void 0?we.backgroundColor:null;switch(De==="environment"&&(De=we.environment),De&&De.isTexture&&(De=(we.backgroundBlurriness>0?d:o).get(De)),De===null?xe(O,te):De&&De.isColor&&(xe(De,1),Ce=!0),I.xr.getEnvironmentBlendMode()){case"opaque":Ce=!0;break;case"additive":v.buffers.color.setClear(0,0,0,1,P),Ce=!0;break;case"alpha-blend":v.buffers.color.setClear(0,0,0,0,P),Ce=!0}if((I.autoClear||Ce)&&I.clear(I.autoClearColor,I.autoClearDepth,I.autoClearStencil),De&&(De.isCubeTexture||De.mapping===Oe))G===void 0&&(G=new Co(new ac(1,1,1),new ta({name:"BackgroundCubeMaterial",uniforms:Rh(Ja.backgroundCube.uniforms),vertexShader:Ja.backgroundCube.vertexShader,fragmentShader:Ja.backgroundCube.fragmentShader,side:oe,depthTest:!1,depthWrite:!1,fog:!1})),G.geometry.deleteAttribute("normal"),G.geometry.deleteAttribute("uv"),G.onBeforeRender=function(dt,rt,st){this.matrixWorld.copyPosition(st.matrixWorld)},Object.defineProperty(G.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),b.update(G)),G.material.uniforms.envMap.value=De,G.material.uniforms.envMapRotation.value=De&&De.rotation||0,G.material.uniforms.envMapIntensity.value=De===we.environment&&we.envMapIntensity||1,G.material.uniforms.flipEnvMap.value=De.isCubeTexture&&De.isRenderTargetTexture===!1?-1:1,G.material.uniforms.backgroundBlurriness.value=we.backgroundBlurriness,G.material.uniforms.backgroundIntensity.value=we.backgroundIntensity,G.material.toneMapped=De.colorSpace!==or,ge===De&&fe===De.version&&_e===I.toneMapping||(G.material.needsUpdate=!0,ge=De,fe=De.version,_e=I.toneMapping),G.layers.enableAll(),Re.unshift(G,G.geometry,G.material,0,0,null);else if(De&&De.isTexture||!De&&ze){Q===void 0&&(Q=new Co(new Nd(2,2),new ta({name:"BackgroundMaterial",uniforms:Rh(Ja.background.uniforms),vertexShader:Ja.background.vertexShader,fragmentShader:Ja.background.fragmentShader,side:$,depthTest:!1,depthWrite:!1,fog:!1})),Q.geometry.deleteAttribute("normal"),Object.defineProperty(Q.material,"map",{get:function(){return this.uniforms.t2D.value}}),b.update(Q)),Q.material.uniforms.backgroundColor.value.set(ze||16777215),Q.material.uniforms.t2D.value=De,Q.material.uniforms.backgroundIntensity.value=we.backgroundIntensity,De?(Q.material.toneMapped=De.colorSpace!==or,Q.material.uniforms.flipX.value=De.userData.flipX||!1,Q.material.uniforms.flipY.value=De.userData.flipY||!1,De.matrixAutoUpdate===!0&&De.updateMatrix(),Q.material.uniforms.uvTransform.value.copy(De.matrix),Q.material.defines.HAS_TEXTURE="1"):Q.material.defines.HAS_TEXTURE&&delete Q.material.defines.HAS_TEXTURE;const dt=De?De.version:-1;ge===De&&fe===dt&&_e===I.toneMapping||(Q.material.needsUpdate=!0,ge=De,fe=dt,_e=I.toneMapping),Q.layers.enableAll(),Re.unshift(Q,Q.geometry,Q.material,0,0,null)}}}}function kd(I,o,d,v){const b=I.getParameter(I.MAX_VERTEX_ATTRIBS),E=v.isWebGL2?null:o.get("OES_vertex_array_object"),P=v.isWebGL2||E!==null,O={},Q=_e(null);let G=Q,te=!1;function ge(rt){return v.isWebGL2?I.bindVertexArray(rt):E.bindVertexArrayOES(rt)}function fe(rt){return v.isWebGL2?I.deleteVertexArray(rt):E.deleteVertexArrayOES(rt)}function _e(rt){const st=[],It=[],Kt=[];for(let Dt=0;Dt<b;Dt++)st[Dt]=0,It[Dt]=0,Kt[Dt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:st,enabledAttributes:It,attributeDivisors:Kt,object:rt,attributes:{},index:null}}function xe(){const rt=G.newAttributes;for(let st=0,It=rt.length;st<It;st++)rt[st]=0}function Re(rt){we(rt,0)}function we(rt,st){const It=G.newAttributes,Kt=G.enabledAttributes,Dt=G.attributeDivisors;It[rt]=1,Kt[rt]===0&&(I.enableVertexAttribArray(rt),Kt[rt]=1),Dt[rt]!==st&&((v.isWebGL2?I:o.get("ANGLE_instanced_arrays"))[v.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](rt,st),Dt[rt]=st)}function Ce(){const rt=G.newAttributes,st=G.enabledAttributes;for(let It=0,Kt=st.length;It<Kt;It++)st[It]!==rt[It]&&(I.disableVertexAttribArray(It),st[It]=0)}function De(rt,st,It,Kt,Dt,an){v.isWebGL2!==!0||It!==I.INT&&It!==I.UNSIGNED_INT?I.vertexAttribPointer(rt,st,It,Kt,Dt,an):I.vertexAttribIPointer(rt,st,It,Dt,an)}function ze(){dt(),te=!0,G!==Q&&(G=Q,ge(G.object))}function dt(){Q.geometry=null,Q.program=null,Q.wireframe=!1}return{setup:function(rt,st,It,Kt,Dt){let an=!1;if(P){const Ot=function(Mn,Sn,ti){const xi=ti.wireframe===!0;let ni=O[Mn.id];ni===void 0&&(ni={},O[Mn.id]=ni);let Kn=ni[Sn.id];Kn===void 0&&(Kn={},ni[Sn.id]=Kn);let gi=Kn[xi];return gi===void 0&&(gi=_e(v.isWebGL2?I.createVertexArray():E.createVertexArrayOES()),Kn[xi]=gi),gi}(Kt,It,st);G!==Ot&&(G=Ot,ge(G.object)),an=function(Mn,Sn,ti,xi){const ni=G.attributes,Kn=Sn.attributes;let gi=0;const Ai=ti.getAttributes();for(const wn in Ai)if(Ai[wn].location>=0){const qn=ni[wn];let vi=Kn[wn];if(vi===void 0&&(wn==="instanceMatrix"&&Mn.instanceMatrix&&(vi=Mn.instanceMatrix),wn==="instanceColor"&&Mn.instanceColor&&(vi=Mn.instanceColor)),qn===void 0||qn.attribute!==vi||vi&&qn.data!==vi.data)return!0;gi++}return G.attributesNum!==gi||G.index!==xi}(rt,Kt,It,Dt),an&&function(Mn,Sn,ti,xi){const ni={},Kn=Sn.attributes;let gi=0;const Ai=ti.getAttributes();for(const wn in Ai)if(Ai[wn].location>=0){let qn=Kn[wn];qn===void 0&&(wn==="instanceMatrix"&&Mn.instanceMatrix&&(qn=Mn.instanceMatrix),wn==="instanceColor"&&Mn.instanceColor&&(qn=Mn.instanceColor));const vi={};vi.attribute=qn,qn&&qn.data&&(vi.data=qn.data),ni[wn]=vi,gi++}G.attributes=ni,G.attributesNum=gi,G.index=xi}(rt,Kt,It,Dt)}else{const Ot=st.wireframe===!0;G.geometry===Kt.id&&G.program===It.id&&G.wireframe===Ot||(G.geometry=Kt.id,G.program=It.id,G.wireframe=Ot,an=!0)}Dt!==null&&d.update(Dt,I.ELEMENT_ARRAY_BUFFER),(an||te)&&(te=!1,function(Ot,Mn,Sn,ti){if(v.isWebGL2===!1&&(Ot.isInstancedMesh||ti.isInstancedBufferGeometry)&&o.get("ANGLE_instanced_arrays")===null)return;xe();const xi=ti.attributes,ni=Sn.getAttributes(),Kn=Mn.defaultAttributeValues;for(const gi in ni){const Ai=ni[gi];if(Ai.location>=0){let wn=xi[gi];if(wn===void 0&&(gi==="instanceMatrix"&&Ot.instanceMatrix&&(wn=Ot.instanceMatrix),gi==="instanceColor"&&Ot.instanceColor&&(wn=Ot.instanceColor)),wn!==void 0){const qn=wn.normalized,vi=wn.itemSize,ii=d.get(wn);if(ii===void 0)continue;const Si=ii.buffer,rr=ii.type,Ct=ii.bytesPerElement;if(wn.isInterleavedBufferAttribute){const ut=wn.data,tn=ut.stride,Vt=wn.offset;if(ut.isInstancedInterleavedBuffer){for(let Rt=0;Rt<Ai.locationSize;Rt++)we(Ai.location+Rt,ut.meshPerAttribute);Ot.isInstancedMesh!==!0&&ti._maxInstanceCount===void 0&&(ti._maxInstanceCount=ut.meshPerAttribute*ut.count)}else for(let Rt=0;Rt<Ai.locationSize;Rt++)Re(Ai.location+Rt);I.bindBuffer(I.ARRAY_BUFFER,Si);for(let Rt=0;Rt<Ai.locationSize;Rt++)De(Ai.location+Rt,vi/Ai.locationSize,rr,qn,tn*Ct,(Vt+vi/Ai.locationSize*Rt)*Ct)}else{if(wn.isInstancedBufferAttribute){for(let ut=0;ut<Ai.locationSize;ut++)we(Ai.location+ut,wn.meshPerAttribute);Ot.isInstancedMesh!==!0&&ti._maxInstanceCount===void 0&&(ti._maxInstanceCount=wn.meshPerAttribute*wn.count)}else for(let ut=0;ut<Ai.locationSize;ut++)Re(Ai.location+ut);I.bindBuffer(I.ARRAY_BUFFER,Si);for(let ut=0;ut<Ai.locationSize;ut++)De(Ai.location+ut,vi/Ai.locationSize,rr,qn,vi*Ct,vi/Ai.locationSize*ut*Ct)}}else if(Kn!==void 0){const qn=Kn[gi];if(qn!==void 0)switch(qn.length){case 2:I.vertexAttrib2fv(Ai.location,qn);break;case 3:I.vertexAttrib3fv(Ai.location,qn);break;case 4:I.vertexAttrib4fv(Ai.location,qn);break;default:I.vertexAttrib1fv(Ai.location,qn)}}}}Ce()}(rt,st,It,Kt),Dt!==null&&I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,d.get(Dt).buffer))},reset:ze,resetDefaultState:dt,dispose:function(){ze();for(const rt in O){const st=O[rt];for(const It in st){const Kt=st[It];for(const Dt in Kt)fe(Kt[Dt].object),delete Kt[Dt];delete st[It]}delete O[rt]}},releaseStatesOfGeometry:function(rt){if(O[rt.id]===void 0)return;const st=O[rt.id];for(const It in st){const Kt=st[It];for(const Dt in Kt)fe(Kt[Dt].object),delete Kt[Dt];delete st[It]}delete O[rt.id]},releaseStatesOfProgram:function(rt){for(const st in O){const It=O[st];if(It[rt.id]===void 0)continue;const Kt=It[rt.id];for(const Dt in Kt)fe(Kt[Dt].object),delete Kt[Dt];delete It[rt.id]}},initAttributes:xe,enableAttribute:Re,disableUnusedAttributes:Ce}}function x0(I,o,d,v){const b=v.isWebGL2;let E;this.setMode=function(P){E=P},this.render=function(P,O){I.drawArrays(E,P,O),d.update(O,E,1)},this.renderInstances=function(P,O,Q){if(Q===0)return;let G,te;if(b)G=I,te="drawArraysInstanced";else if(G=o.get("ANGLE_instanced_arrays"),te="drawArraysInstancedANGLE",G===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");G[te](E,P,O,Q),d.update(O,E,Q)}}function mf(I,o,d){let v;function b(dt){if(dt==="highp"){if(I.getShaderPrecisionFormat(I.VERTEX_SHADER,I.HIGH_FLOAT).precision>0&&I.getShaderPrecisionFormat(I.FRAGMENT_SHADER,I.HIGH_FLOAT).precision>0)return"highp";dt="mediump"}return dt==="mediump"&&I.getShaderPrecisionFormat(I.VERTEX_SHADER,I.MEDIUM_FLOAT).precision>0&&I.getShaderPrecisionFormat(I.FRAGMENT_SHADER,I.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const E=typeof WebGL2RenderingContext<"u"&&I.constructor.name==="WebGL2RenderingContext";let P=d.precision!==void 0?d.precision:"highp";const O=b(P);O!==P&&(console.warn("THREE.WebGLRenderer:",P,"not supported, using",O,"instead."),P=O);const Q=E||o.has("WEBGL_draw_buffers"),G=d.logarithmicDepthBuffer===!0,te=I.getParameter(I.MAX_TEXTURE_IMAGE_UNITS),ge=I.getParameter(I.MAX_VERTEX_TEXTURE_IMAGE_UNITS),fe=I.getParameter(I.MAX_TEXTURE_SIZE),_e=I.getParameter(I.MAX_CUBE_MAP_TEXTURE_SIZE),xe=I.getParameter(I.MAX_VERTEX_ATTRIBS),Re=I.getParameter(I.MAX_VERTEX_UNIFORM_VECTORS),we=I.getParameter(I.MAX_VARYING_VECTORS),Ce=I.getParameter(I.MAX_FRAGMENT_UNIFORM_VECTORS),De=ge>0,ze=E||o.has("OES_texture_float");return{isWebGL2:E,drawBuffers:Q,getMaxAnisotropy:function(){if(v!==void 0)return v;if(o.has("EXT_texture_filter_anisotropic")===!0){const dt=o.get("EXT_texture_filter_anisotropic");v=I.getParameter(dt.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else v=0;return v},getMaxPrecision:b,precision:P,logarithmicDepthBuffer:G,maxTextures:te,maxVertexTextures:ge,maxTextureSize:fe,maxCubemapSize:_e,maxAttributes:xe,maxVertexUniforms:Re,maxVaryings:we,maxFragmentUniforms:Ce,vertexTextures:De,floatFragmentTextures:ze,floatVertexTextures:De&&ze,maxSamples:E?I.getParameter(I.MAX_SAMPLES):0}}function Bl(I){const o=this;let d=null,v=0,b=!1,E=!1;const P=new Ih,O=new Dr,Q={value:null,needsUpdate:!1};function G(te,ge,fe,_e){const xe=te!==null?te.length:0;let Re=null;if(xe!==0){if(Re=Q.value,_e!==!0||Re===null){const we=fe+4*xe,Ce=ge.matrixWorldInverse;O.getNormalMatrix(Ce),(Re===null||Re.length<we)&&(Re=new Float32Array(we));for(let De=0,ze=fe;De!==xe;++De,ze+=4)P.copy(te[De]).applyMatrix4(Ce,O),P.normal.toArray(Re,ze),Re[ze+3]=P.constant}Q.value=Re,Q.needsUpdate=!0}return o.numPlanes=xe,o.numIntersection=0,Re}this.uniform=Q,this.numPlanes=0,this.numIntersection=0,this.init=function(te,ge){const fe=te.length!==0||ge||v!==0||b;return b=ge,v=te.length,fe},this.beginShadows=function(){E=!0,G(null)},this.endShadows=function(){E=!1},this.setGlobalState=function(te,ge){d=G(te,ge,0)},this.setState=function(te,ge,fe){const _e=te.clippingPlanes,xe=te.clipIntersection,Re=te.clipShadows,we=I.get(te);if(!b||_e===null||_e.length===0||E&&!Re)E?G(null):(Q.value!==d&&(Q.value=d,Q.needsUpdate=v>0),o.numPlanes=v,o.numIntersection=0);else{const Ce=E?0:v,De=4*Ce;let ze=we.clippingState||null;Q.value=ze,ze=G(_e,ge,De,fe);for(let dt=0;dt!==De;++dt)ze[dt]=d[dt];we.clippingState=ze,this.numIntersection=xe?this.numPlanes:0,this.numPlanes+=Ce}}}function M_(I){let o=new WeakMap;function d(b,E){return E===Ae?b.mapping=Bn:E===Le&&(b.mapping=de),b}function v(b){const E=b.target;E.removeEventListener("dispose",v);const P=o.get(E);P!==void 0&&(o.delete(E),P.dispose())}return{get:function(b){if(b&&b.isTexture&&b.isRenderTargetTexture===!1){const E=b.mapping;if(E===Ae||E===Le){if(o.has(b)){const P=o.get(b).texture;return P.rotation=b.rotation,d(P,b.mapping)}{const P=b.image;if(P&&P.height>0){const O=new VA(P.height/2);return O.fromEquirectangularTexture(I,b),O.texture.rotation=b.rotation,o.set(b,O),b.addEventListener("dispose",v),d(O.texture,b.mapping)}return null}}}return b},dispose:function(){o=new WeakMap}}}class C_ extends Hu{constructor(o=-1,d=1,v=1,b=-1,E=.1,P=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=o,this.right=d,this.top=v,this.bottom=b,this.near=E,this.far=P,this.updateProjectionMatrix()}copy(o,d){return super.copy(o,d),this.left=o.left,this.right=o.right,this.top=o.top,this.bottom=o.bottom,this.near=o.near,this.far=o.far,this.zoom=o.zoom,this.view=o.view===null?null:Object.assign({},o.view),this}setViewOffset(o,d,v,b,E,P){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=d,this.view.offsetX=v,this.view.offsetY=b,this.view.width=E,this.view.height=P,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=(this.right-this.left)/(2*this.zoom),d=(this.top-this.bottom)/(2*this.zoom),v=(this.right+this.left)/2,b=(this.top+this.bottom)/2;let E=v-o,P=v+o,O=b+d,Q=b-d;if(this.view!==null&&this.view.enabled){const G=(this.right-this.left)/this.view.fullWidth/this.zoom,te=(this.top-this.bottom)/this.view.fullHeight/this.zoom;E+=G*this.view.offsetX,P=E+G*this.view.width,O-=te*this.view.offsetY,Q=O-te*this.view.height}this.projectionMatrix.makeOrthographic(E,P,O,Q,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const d=super.toJSON(o);return d.object.zoom=this.zoom,d.object.left=this.left,d.object.right=this.right,d.object.top=this.top,d.object.bottom=this.bottom,d.object.near=this.near,d.object.far=this.far,this.view!==null&&(d.object.view=Object.assign({},this.view)),d}}const HA=[.125,.215,.35,.446,.526,.582],Za=20,R_=new C_,gu=new Mi;let Cm=null;const Ph=(1+Math.sqrt(5))/2,vl=1/Ph,Wu=[new At(1,1,1),new At(-1,1,1),new At(1,1,-1),new At(-1,1,-1),new At(0,Ph,vl),new At(0,Ph,-vl),new At(vl,0,Ph),new At(-vl,0,Ph),new At(Ph,vl,0),new At(-Ph,vl,0)];class I_{constructor(o){this._renderer=o,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(o,d=0,v=.1,b=100){Cm=this._renderer.getRenderTarget(),this._setSize(256);const E=this._allocateTargets();return E.depthBuffer=!0,this._sceneToCubeUV(o,v,b,E),d>0&&this._blur(E,0,0,d),this._applyPMREM(E),this._cleanup(E),E}fromEquirectangular(o,d=null){return this._fromTexture(o,d)}fromCubemap(o,d=null){return this._fromTexture(o,d)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=P_(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Rm(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(o){this._lodMax=Math.floor(Math.log2(o)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let o=0;o<this._lodPlanes.length;o++)this._lodPlanes[o].dispose()}_cleanup(o){this._renderer.setRenderTarget(Cm),o.scissorTest=!1,Dh(o,0,0,o.width,o.height)}_fromTexture(o,d){o.mapping===Bn||o.mapping===de?this._setSize(o.image.length===0?16:o.image[0].width||o.image[0].image.width):this._setSize(o.image.width/4),Cm=this._renderer.getRenderTarget();const v=d||this._allocateTargets();return this._textureToCubeUV(o,v),this._applyPMREM(v),this._cleanup(v),v}_allocateTargets(){const o=3*Math.max(this._cubeSize,112),d=4*this._cubeSize,v={magFilter:en,minFilter:en,generateMipmaps:!1,type:wr,format:xs,colorSpace:ws,depthBuffer:!1},b=lc(o,d,v);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==o||this._pingPongRenderTarget.height!==d){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=lc(o,d,v);const{_lodMax:E}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(P){const O=[],Q=[],G=[];let te=P;const ge=P-4+1+HA.length;for(let fe=0;fe<ge;fe++){const _e=Math.pow(2,te);Q.push(_e);let xe=1/_e;fe>P-4?xe=HA[fe-P+4-1]:fe===0&&(xe=0),G.push(xe);const Re=1/(_e-2),we=-Re,Ce=1+Re,De=[we,we,Ce,we,Ce,Ce,we,we,Ce,Ce,we,Ce],ze=6,dt=6,rt=3,st=2,It=1,Kt=new Float32Array(rt*dt*ze),Dt=new Float32Array(st*dt*ze),an=new Float32Array(It*dt*ze);for(let Mn=0;Mn<ze;Mn++){const Sn=Mn%3*2/3-1,ti=Mn>2?0:-1,xi=[Sn,ti,0,Sn+2/3,ti,0,Sn+2/3,ti+1,0,Sn,ti,0,Sn+2/3,ti+1,0,Sn,ti+1,0];Kt.set(xi,rt*dt*Mn),Dt.set(De,st*dt*Mn);const ni=[Mn,Mn,Mn,Mn,Mn,Mn];an.set(ni,It*dt*Mn)}const Ot=new Ie;Ot.setAttribute("position",new As(Kt,rt)),Ot.setAttribute("uv",new As(Dt,st)),Ot.setAttribute("faceIndex",new As(an,It)),O.push(Ot),te>4&&te--}return{lodPlanes:O,sizeLods:Q,sigmas:G}}(E)),this._blurMaterial=function(P,O,Q){const G=new Float32Array(Za),te=new At(0,1,0);return new ta({name:"SphericalGaussianBlur",defines:{n:Za,CUBEUV_TEXEL_WIDTH:1/O,CUBEUV_TEXEL_HEIGHT:1/Q,CUBEUV_MAX_MIP:`${P}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:G},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:te}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:V,depthTest:!1,depthWrite:!1})}(E,o,d)}return b}_compileMaterial(o){const d=new Co(this._lodPlanes[0],o);this._renderer.compile(d,R_)}_sceneToCubeUV(o,d,v,b){const E=new Go(90,1,d,v),P=[1,-1,1,1,1,1],O=[1,1,1,-1,-1,-1],Q=this._renderer,G=Q.autoClear,te=Q.toneMapping;Q.getClearColor(gu),Q.toneMapping=jt,Q.autoClear=!1;const ge=new ys({name:"PMREM.Background",side:oe,depthWrite:!1,depthTest:!1}),fe=new Co(new ac,ge);let _e=!1;const xe=o.background;xe?xe.isColor&&(ge.color.copy(xe),o.background=null,_e=!0):(ge.color.copy(gu),_e=!0);for(let Re=0;Re<6;Re++){const we=Re%3;we===0?(E.up.set(0,P[Re],0),E.lookAt(O[Re],0,0)):we===1?(E.up.set(0,0,P[Re]),E.lookAt(0,O[Re],0)):(E.up.set(0,P[Re],0),E.lookAt(0,0,O[Re]));const Ce=this._cubeSize;Dh(b,we*Ce,Re>2?Ce:0,Ce,Ce),Q.setRenderTarget(b),_e&&Q.render(fe,E),Q.render(o,E)}fe.geometry.dispose(),fe.material.dispose(),Q.toneMapping=te,Q.autoClear=G,o.background=xe}_textureToCubeUV(o,d){const v=this._renderer,b=o.mapping===Bn||o.mapping===de;b?(this._cubemapMaterial===null&&(this._cubemapMaterial=P_()),this._cubemapMaterial.uniforms.flipEnvMap.value=o.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Rm());const E=b?this._cubemapMaterial:this._equirectMaterial,P=new Co(this._lodPlanes[0],E);E.uniforms.envMap.value=o;const O=this._cubeSize;Dh(d,0,0,3*O,2*O),v.setRenderTarget(d),v.render(P,R_)}_applyPMREM(o){const d=this._renderer,v=d.autoClear;d.autoClear=!1;for(let b=1;b<this._lodPlanes.length;b++){const E=Math.sqrt(this._sigmas[b]*this._sigmas[b]-this._sigmas[b-1]*this._sigmas[b-1]),P=Wu[(b-1)%Wu.length];this._blur(o,b-1,b,E,P)}d.autoClear=v}_blur(o,d,v,b,E){const P=this._pingPongRenderTarget;this._halfBlur(o,P,d,v,b,"latitudinal",E),this._halfBlur(P,o,v,v,b,"longitudinal",E)}_halfBlur(o,d,v,b,E,P,O){const Q=this._renderer,G=this._blurMaterial;P!=="latitudinal"&&P!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const te=new Co(this._lodPlanes[b],G),ge=G.uniforms,fe=this._sizeLods[v]-1,_e=isFinite(E)?Math.PI/(2*fe):2*Math.PI/39,xe=E/_e,Re=isFinite(E)?1+Math.floor(3*xe):Za;Re>Za&&console.warn(`sigmaRadians, ${E}, is too large and will clip, as it requested ${Re} samples when the maximum is set to 20`);const we=[];let Ce=0;for(let dt=0;dt<Za;++dt){const rt=dt/xe,st=Math.exp(-rt*rt/2);we.push(st),dt===0?Ce+=st:dt<Re&&(Ce+=2*st)}for(let dt=0;dt<we.length;dt++)we[dt]=we[dt]/Ce;ge.envMap.value=o.texture,ge.samples.value=Re,ge.weights.value=we,ge.latitudinal.value=P==="latitudinal",O&&(ge.poleAxis.value=O);const{_lodMax:De}=this;ge.dTheta.value=_e,ge.mipInt.value=De-v;const ze=this._sizeLods[b];Dh(d,3*ze*(b>De-4?b-De+4:0),4*(this._cubeSize-ze),3*ze,2*ze),Q.setRenderTarget(d),Q.render(te,R_)}}function lc(I,o,d){const v=new vo(I,o,d);return v.texture.mapping=Oe,v.texture.name="PMREM.cubeUv",v.scissorTest=!0,v}function Dh(I,o,d,v,b){I.viewport.set(o,d,v,b),I.scissor.set(o,d,v,b)}function Rm(){return new ta({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:V,depthTest:!1,depthWrite:!1})}function P_(){return new ta({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:V,depthTest:!1,depthWrite:!1})}function gf(I){let o=new WeakMap,d=null;function v(b){const E=b.target;E.removeEventListener("dispose",v);const P=o.get(E);P!==void 0&&(o.delete(E),P.dispose())}return{get:function(b){if(b&&b.isTexture){const E=b.mapping,P=E===Ae||E===Le,O=E===Bn||E===de;if(P||O){if(b.isRenderTargetTexture&&b.needsPMREMUpdate===!0){b.needsPMREMUpdate=!1;let Q=o.get(b);return d===null&&(d=new I_(I)),Q=P?d.fromEquirectangular(b,Q):d.fromCubemap(b,Q),o.set(b,Q),Q.texture}if(o.has(b))return o.get(b).texture;{const Q=b.image;if(P&&Q&&Q.height>0||O&&Q&&function(G){let te=0;for(let ge=0;ge<6;ge++)G[ge]!==void 0&&te++;return te===6}(Q)){d===null&&(d=new I_(I));const G=P?d.fromEquirectangular(b):d.fromCubemap(b);return o.set(b,G),b.addEventListener("dispose",v),G.texture}return null}}}return b},dispose:function(){o=new WeakMap,d!==null&&(d.dispose(),d=null)}}}function Im(I){const o={};function d(v){if(o[v]!==void 0)return o[v];let b;switch(v){case"WEBGL_depth_texture":b=I.getExtension("WEBGL_depth_texture")||I.getExtension("MOZ_WEBGL_depth_texture")||I.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":b=I.getExtension("EXT_texture_filter_anisotropic")||I.getExtension("MOZ_EXT_texture_filter_anisotropic")||I.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":b=I.getExtension("WEBGL_compressed_texture_s3tc")||I.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||I.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":b=I.getExtension("WEBGL_compressed_texture_pvrtc")||I.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:b=I.getExtension(v)}return o[v]=b,b}return{has:function(v){return d(v)!==null},init:function(v){v.isWebGL2?d("EXT_color_buffer_float"):(d("WEBGL_depth_texture"),d("OES_texture_float"),d("OES_texture_half_float"),d("OES_texture_half_float_linear"),d("OES_standard_derivatives"),d("OES_element_index_uint"),d("OES_vertex_array_object"),d("ANGLE_instanced_arrays")),d("OES_texture_float_linear"),d("EXT_color_buffer_half_float"),d("WEBGL_multisampled_render_to_texture")},get:function(v){const b=d(v);return b===null&&console.warn("THREE.WebGLRenderer: "+v+" extension not supported."),b}}}function Pm(I,o,d,v){const b={},E=new WeakMap;function P(Q){const G=Q.target;G.index!==null&&o.remove(G.index);for(const ge in G.attributes)o.remove(G.attributes[ge]);G.removeEventListener("dispose",P),delete b[G.id];const te=E.get(G);te&&(o.remove(te),E.delete(G)),v.releaseStatesOfGeometry(G),G.isInstancedBufferGeometry===!0&&delete G._maxInstanceCount,d.memory.geometries--}function O(Q){const G=[],te=Q.index,ge=Q.attributes.position;let fe=0;if(te!==null){const Re=te.array;fe=te.version;for(let we=0,Ce=Re.length;we<Ce;we+=3){const De=Re[we+0],ze=Re[we+1],dt=Re[we+2];G.push(De,ze,ze,dt,dt,De)}}else{const Re=ge.array;fe=ge.version;for(let we=0,Ce=Re.length/3-1;we<Ce;we+=3){const De=we+0,ze=we+1,dt=we+2;G.push(De,ze,ze,dt,dt,De)}}const _e=new(Jp(G)?Dd:pu)(G,1);_e.version=fe;const xe=E.get(Q);xe&&o.remove(xe),E.set(Q,_e)}return{get:function(Q,G){return b[G.id]===!0||(G.addEventListener("dispose",P),b[G.id]=!0,d.memory.geometries++),G},update:function(Q){const G=Q.attributes;for(const ge in G)o.update(G[ge],I.ARRAY_BUFFER);const te=Q.morphAttributes;for(const ge in te){const fe=te[ge];for(let _e=0,xe=fe.length;_e<xe;_e++)o.update(fe[_e],I.ARRAY_BUFFER)}},getWireframeAttribute:function(Q){const G=E.get(Q);if(G){const te=Q.index;te!==null&&G.version<te.version&&O(Q)}else O(Q);return E.get(Q)}}}function WA(I,o,d,v){const b=v.isWebGL2;let E,P,O;this.setMode=function(Q){E=Q},this.setIndex=function(Q){P=Q.type,O=Q.bytesPerElement},this.render=function(Q,G){I.drawElements(E,G,P,Q*O),d.update(G,E,1)},this.renderInstances=function(Q,G,te){if(te===0)return;let ge,fe;if(b)ge=I,fe="drawElementsInstanced";else if(ge=o.get("ANGLE_instanced_arrays"),fe="drawElementsInstancedANGLE",ge===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");ge[fe](E,G,P,Q*O,te),d.update(G,E,te)}}function D_(I){const o={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:o,programs:null,autoReset:!0,reset:function(){o.frame++,o.calls=0,o.triangles=0,o.points=0,o.lines=0},update:function(d,v,b){switch(o.calls++,v){case I.TRIANGLES:o.triangles+=b*(d/3);break;case I.LINES:o.lines+=b*(d/2);break;case I.LINE_STRIP:o.lines+=b*(d-1);break;case I.LINE_LOOP:o.lines+=b*d;break;case I.POINTS:o.points+=b*d;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",v)}}}}function cc(I,o){return I[0]-o[0]}function Vc(I,o){return Math.abs(o[1])-Math.abs(I[1])}function Dm(I,o,d){const v={},b=new Float32Array(8),E=new WeakMap,P=new Yr,O=[];for(let Q=0;Q<8;Q++)O[Q]=[Q,0];return{update:function(Q,G,te){const ge=Q.morphTargetInfluences;if(o.isWebGL2===!0){const fe=G.morphAttributes.position||G.morphAttributes.normal||G.morphAttributes.color,_e=fe!==void 0?fe.length:0;let xe=E.get(G);if(xe===void 0||xe.count!==_e){xe!==void 0&&xe.texture.dispose();const Ce=G.morphAttributes.position!==void 0,De=G.morphAttributes.normal!==void 0,ze=G.morphAttributes.color!==void 0,dt=G.morphAttributes.position||[],rt=G.morphAttributes.normal||[],st=G.morphAttributes.color||[];let It=0;Ce===!0&&(It=1),De===!0&&(It=2),ze===!0&&(It=3);let Kt=G.attributes.position.count*It,Dt=1;Kt>o.maxTextureSize&&(Dt=Math.ceil(Kt/o.maxTextureSize),Kt=o.maxTextureSize);const an=new Float32Array(Kt*Dt*4*_e),Ot=new ca(an,Kt,Dt,_e);Ot.type=Pr,Ot.needsUpdate=!0;const Mn=4*It;for(let Sn=0;Sn<_e;Sn++){const ti=dt[Sn],xi=rt[Sn],ni=st[Sn],Kn=Kt*Dt*4*Sn;for(let gi=0;gi<ti.count;gi++){const Ai=gi*Mn;Ce===!0&&(P.fromBufferAttribute(ti,gi),an[Kn+Ai+0]=P.x,an[Kn+Ai+1]=P.y,an[Kn+Ai+2]=P.z,an[Kn+Ai+3]=0),De===!0&&(P.fromBufferAttribute(xi,gi),an[Kn+Ai+4]=P.x,an[Kn+Ai+5]=P.y,an[Kn+Ai+6]=P.z,an[Kn+Ai+7]=0),ze===!0&&(P.fromBufferAttribute(ni,gi),an[Kn+Ai+8]=P.x,an[Kn+Ai+9]=P.y,an[Kn+Ai+10]=P.z,an[Kn+Ai+11]=ni.itemSize===4?P.w:1)}}xe={count:_e,texture:Ot,size:new jn(Kt,Dt)},E.set(G,xe),G.addEventListener("dispose",function Sn(){Ot.dispose(),E.delete(G),G.removeEventListener("dispose",Sn)})}let Re=0;for(let Ce=0;Ce<ge.length;Ce++)Re+=ge[Ce];const we=G.morphTargetsRelative?1:1-Re;te.getUniforms().setValue(I,"morphTargetBaseInfluence",we),te.getUniforms().setValue(I,"morphTargetInfluences",ge),te.getUniforms().setValue(I,"morphTargetsTexture",xe.texture,d),te.getUniforms().setValue(I,"morphTargetsTextureSize",xe.size)}else{const fe=ge===void 0?0:ge.length;let _e=v[G.id];if(_e===void 0||_e.length!==fe){_e=[];for(let De=0;De<fe;De++)_e[De]=[De,0];v[G.id]=_e}for(let De=0;De<fe;De++){const ze=_e[De];ze[0]=De,ze[1]=ge[De]}_e.sort(Vc);for(let De=0;De<8;De++)De<fe&&_e[De][1]?(O[De][0]=_e[De][0],O[De][1]=_e[De][1]):(O[De][0]=Number.MAX_SAFE_INTEGER,O[De][1]=0);O.sort(cc);const xe=G.morphAttributes.position,Re=G.morphAttributes.normal;let we=0;for(let De=0;De<8;De++){const ze=O[De],dt=ze[0],rt=ze[1];dt!==Number.MAX_SAFE_INTEGER&&rt?(xe&&G.getAttribute("morphTarget"+De)!==xe[dt]&&G.setAttribute("morphTarget"+De,xe[dt]),Re&&G.getAttribute("morphNormal"+De)!==Re[dt]&&G.setAttribute("morphNormal"+De,Re[dt]),b[De]=rt,we+=rt):(xe&&G.hasAttribute("morphTarget"+De)===!0&&G.deleteAttribute("morphTarget"+De),Re&&G.hasAttribute("morphNormal"+De)===!0&&G.deleteAttribute("morphNormal"+De),b[De]=0)}const Ce=G.morphTargetsRelative?1:1-we;te.getUniforms().setValue(I,"morphTargetBaseInfluence",Ce),te.getUniforms().setValue(I,"morphTargetInfluences",b)}}}}function QA(I,o,d,v){let b=new WeakMap;function E(P){const O=P.target;O.removeEventListener("dispose",E),d.remove(O.instanceMatrix),O.instanceColor!==null&&d.remove(O.instanceColor)}return{update:function(P){const O=v.render.frame,Q=P.geometry,G=o.get(P,Q);return b.get(G)!==O&&(o.update(G),b.set(G,O)),P.isInstancedMesh&&(P.hasEventListener("dispose",E)===!1&&P.addEventListener("dispose",E),d.update(P.instanceMatrix,I.ARRAY_BUFFER),P.instanceColor!==null&&d.update(P.instanceColor,I.ARRAY_BUFFER)),G},dispose:function(){b=new WeakMap}}}const L_=new Vs,_f=new ca,Lh=new nf,_u=new Mm,uc=[],vf=[],w0=new Float32Array(16),Ud=new Float32Array(9),E0=new Float32Array(4);function yf(I,o,d){const v=I[0];if(v<=0||v>0)return I;const b=o*d;let E=uc[b];if(E===void 0&&(E=new Float32Array(b),uc[b]=E),o!==0){v.toArray(E,0);for(let P=1,O=0;P!==o;++P)O+=d,I[P].toArray(E,O)}return E}function Os(I,o){if(I.length!==o.length)return!1;for(let d=0,v=I.length;d<v;d++)if(I[d]!==o[d])return!1;return!0}function yo(I,o){for(let d=0,v=o.length;d<v;d++)I[d]=o[d]}function Lm(I,o){let d=vf[o];d===void 0&&(d=new Int32Array(o),vf[o]=d);for(let v=0;v!==o;++v)d[v]=I.allocateTextureUnit();return d}function S0(I,o){const d=this.cache;d[0]!==o&&(I.uniform1f(this.addr,o),d[0]=o)}function na(I,o){const d=this.cache;if(o.x!==void 0)d[0]===o.x&&d[1]===o.y||(I.uniform2f(this.addr,o.x,o.y),d[0]=o.x,d[1]=o.y);else{if(Os(d,o))return;I.uniform2fv(this.addr,o),yo(d,o)}}function Qu(I,o){const d=this.cache;if(o.x!==void 0)d[0]===o.x&&d[1]===o.y&&d[2]===o.z||(I.uniform3f(this.addr,o.x,o.y,o.z),d[0]=o.x,d[1]=o.y,d[2]=o.z);else if(o.r!==void 0)d[0]===o.r&&d[1]===o.g&&d[2]===o.b||(I.uniform3f(this.addr,o.r,o.g,o.b),d[0]=o.r,d[1]=o.g,d[2]=o.b);else{if(Os(d,o))return;I.uniform3fv(this.addr,o),yo(d,o)}}function T0(I,o){const d=this.cache;if(o.x!==void 0)d[0]===o.x&&d[1]===o.y&&d[2]===o.z&&d[3]===o.w||(I.uniform4f(this.addr,o.x,o.y,o.z,o.w),d[0]=o.x,d[1]=o.y,d[2]=o.z,d[3]=o.w);else{if(Os(d,o))return;I.uniform4fv(this.addr,o),yo(d,o)}}function Bh(I,o){const d=this.cache,v=o.elements;if(v===void 0){if(Os(d,o))return;I.uniformMatrix2fv(this.addr,!1,o),yo(d,o)}else{if(Os(d,v))return;E0.set(v),I.uniformMatrix2fv(this.addr,!1,E0),yo(d,v)}}function XA(I,o){const d=this.cache,v=o.elements;if(v===void 0){if(Os(d,o))return;I.uniformMatrix3fv(this.addr,!1,o),yo(d,o)}else{if(Os(d,v))return;Ud.set(v),I.uniformMatrix3fv(this.addr,!1,Ud),yo(d,v)}}function Ol(I,o){const d=this.cache,v=o.elements;if(v===void 0){if(Os(d,o))return;I.uniformMatrix4fv(this.addr,!1,o),yo(d,o)}else{if(Os(d,v))return;w0.set(v),I.uniformMatrix4fv(this.addr,!1,w0),yo(d,v)}}function M0(I,o){const d=this.cache;d[0]!==o&&(I.uniform1i(this.addr,o),d[0]=o)}function uE(I,o){const d=this.cache;if(o.x!==void 0)d[0]===o.x&&d[1]===o.y||(I.uniform2i(this.addr,o.x,o.y),d[0]=o.x,d[1]=o.y);else{if(Os(d,o))return;I.uniform2iv(this.addr,o),yo(d,o)}}function hE(I,o){const d=this.cache;if(o.x!==void 0)d[0]===o.x&&d[1]===o.y&&d[2]===o.z||(I.uniform3i(this.addr,o.x,o.y,o.z),d[0]=o.x,d[1]=o.y,d[2]=o.z);else{if(Os(d,o))return;I.uniform3iv(this.addr,o),yo(d,o)}}function Bm(I,o){const d=this.cache;if(o.x!==void 0)d[0]===o.x&&d[1]===o.y&&d[2]===o.z&&d[3]===o.w||(I.uniform4i(this.addr,o.x,o.y,o.z,o.w),d[0]=o.x,d[1]=o.y,d[2]=o.z,d[3]=o.w);else{if(Os(d,o))return;I.uniform4iv(this.addr,o),yo(d,o)}}function qA(I,o){const d=this.cache;d[0]!==o&&(I.uniform1ui(this.addr,o),d[0]=o)}function YA(I,o){const d=this.cache;if(o.x!==void 0)d[0]===o.x&&d[1]===o.y||(I.uniform2ui(this.addr,o.x,o.y),d[0]=o.x,d[1]=o.y);else{if(Os(d,o))return;I.uniform2uiv(this.addr,o),yo(d,o)}}function KA(I,o){const d=this.cache;if(o.x!==void 0)d[0]===o.x&&d[1]===o.y&&d[2]===o.z||(I.uniform3ui(this.addr,o.x,o.y,o.z),d[0]=o.x,d[1]=o.y,d[2]=o.z);else{if(Os(d,o))return;I.uniform3uiv(this.addr,o),yo(d,o)}}function Om(I,o){const d=this.cache;if(o.x!==void 0)d[0]===o.x&&d[1]===o.y&&d[2]===o.z&&d[3]===o.w||(I.uniform4ui(this.addr,o.x,o.y,o.z,o.w),d[0]=o.x,d[1]=o.y,d[2]=o.z,d[3]=o.w);else{if(Os(d,o))return;I.uniform4uiv(this.addr,o),yo(d,o)}}function $A(I,o,d){const v=this.cache,b=d.allocateTextureUnit();v[0]!==b&&(I.uniform1i(this.addr,b),v[0]=b),d.setTexture2D(o||L_,b)}function Fd(I,o,d){const v=this.cache,b=d.allocateTextureUnit();v[0]!==b&&(I.uniform1i(this.addr,b),v[0]=b),d.setTexture3D(o||Lh,b)}function Nm(I,o,d){const v=this.cache,b=d.allocateTextureUnit();v[0]!==b&&(I.uniform1i(this.addr,b),v[0]=b),d.setTextureCube(o||_u,b)}function B_(I,o,d){const v=this.cache,b=d.allocateTextureUnit();v[0]!==b&&(I.uniform1i(this.addr,b),v[0]=b),d.setTexture2DArray(o||_f,b)}function Af(I,o){I.uniform1fv(this.addr,o)}function km(I,o){const d=yf(o,this.size,2);I.uniform2fv(this.addr,d)}function JA(I,o){const d=yf(o,this.size,3);I.uniform3fv(this.addr,d)}function ZA(I,o){const d=yf(o,this.size,4);I.uniform4fv(this.addr,d)}function O_(I,o){const d=yf(o,this.size,4);I.uniformMatrix2fv(this.addr,!1,d)}function Um(I,o){const d=yf(o,this.size,9);I.uniformMatrix3fv(this.addr,!1,d)}function eb(I,o){const d=yf(o,this.size,16);I.uniformMatrix4fv(this.addr,!1,d)}function Fm(I,o){I.uniform1iv(this.addr,o)}function tb(I,o){I.uniform2iv(this.addr,o)}function nb(I,o){I.uniform3iv(this.addr,o)}function ib(I,o){I.uniform4iv(this.addr,o)}function C0(I,o){I.uniform1uiv(this.addr,o)}function R0(I,o){I.uniform2uiv(this.addr,o)}function zd(I,o){I.uniform3uiv(this.addr,o)}function yl(I,o){I.uniform4uiv(this.addr,o)}function Oh(I,o,d){const v=this.cache,b=o.length,E=Lm(d,b);Os(v,E)||(I.uniform1iv(this.addr,E),yo(v,E));for(let P=0;P!==b;++P)d.setTexture2D(o[P]||L_,E[P])}function Ws(I,o,d){const v=this.cache,b=o.length,E=Lm(d,b);Os(v,E)||(I.uniform1iv(this.addr,E),yo(v,E));for(let P=0;P!==b;++P)d.setTexture3D(o[P]||Lh,E[P])}function rb(I,o,d){const v=this.cache,b=o.length,E=Lm(d,b);Os(v,E)||(I.uniform1iv(this.addr,E),yo(v,E));for(let P=0;P!==b;++P)d.setTextureCube(o[P]||_u,E[P])}function I0(I,o,d){const v=this.cache,b=o.length,E=Lm(d,b);Os(v,E)||(I.uniform1iv(this.addr,E),yo(v,E));for(let P=0;P!==b;++P)d.setTexture2DArray(o[P]||_f,E[P])}class sb{constructor(o,d,v){this.id=o,this.addr=v,this.cache=[],this.setValue=function(b){switch(b){case 5126:return S0;case 35664:return na;case 35665:return Qu;case 35666:return T0;case 35674:return Bh;case 35675:return XA;case 35676:return Ol;case 5124:case 35670:return M0;case 35667:case 35671:return uE;case 35668:case 35672:return hE;case 35669:case 35673:return Bm;case 5125:return qA;case 36294:return YA;case 36295:return KA;case 36296:return Om;case 35678:case 36198:case 36298:case 36306:case 35682:return $A;case 35679:case 36299:case 36307:return Fd;case 35680:case 36300:case 36308:case 36293:return Nm;case 36289:case 36303:case 36311:case 36292:return B_}}(d.type)}}class ob{constructor(o,d,v){this.id=o,this.addr=v,this.cache=[],this.size=d.size,this.setValue=function(b){switch(b){case 5126:return Af;case 35664:return km;case 35665:return JA;case 35666:return ZA;case 35674:return O_;case 35675:return Um;case 35676:return eb;case 5124:case 35670:return Fm;case 35667:case 35671:return tb;case 35668:case 35672:return nb;case 35669:case 35673:return ib;case 5125:return C0;case 36294:return R0;case 36295:return zd;case 36296:return yl;case 35678:case 36198:case 36298:case 36306:case 35682:return Oh;case 35679:case 36299:case 36307:return Ws;case 35680:case 36300:case 36308:case 36293:return rb;case 36289:case 36303:case 36311:case 36292:return I0}}(d.type)}}class ab{constructor(o){this.id=o,this.seq=[],this.map={}}setValue(o,d,v){const b=this.seq;for(let E=0,P=b.length;E!==P;++E){const O=b[E];O.setValue(o,d[O.id],v)}}}const P0=/(\w+)(\])?(\[|\.)?/g;function lb(I,o){I.seq.push(o),I.map[o.id]=o}function dE(I,o,d){const v=I.name,b=v.length;for(P0.lastIndex=0;;){const E=P0.exec(v),P=P0.lastIndex;let O=E[1];const Q=E[2]==="]",G=E[3];if(Q&&(O|=0),G===void 0||G==="["&&P+2===b){lb(d,G===void 0?new sb(O,I,o):new ob(O,I,o));break}{let te=d.map[O];te===void 0&&(te=new ab(O),lb(d,te)),d=te}}}class N_{constructor(o,d){this.seq=[],this.map={};const v=o.getProgramParameter(d,o.ACTIVE_UNIFORMS);for(let b=0;b<v;++b){const E=o.getActiveUniform(d,b);dE(E,o.getUniformLocation(d,E.name),this)}}setValue(o,d,v,b){const E=this.map[d];E!==void 0&&E.setValue(o,v,b)}setOptional(o,d,v){const b=d[v];b!==void 0&&this.setValue(o,v,b)}static upload(o,d,v,b){for(let E=0,P=d.length;E!==P;++E){const O=d[E],Q=v[O.id];Q.needsUpdate!==!1&&O.setValue(o,Q.value,b)}}static seqWithValue(o,d){const v=[];for(let b=0,E=o.length;b!==E;++b){const P=o[b];P.id in d&&v.push(P)}return v}}function cb(I,o,d){const v=I.createShader(o);return I.shaderSource(v,d),I.compileShader(v),v}let pE=0;function k_(I){switch(I){case Eo:case ws:return["Linear","( value )"];case or:return["sRGB","( value )"];case Ha:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",I),["Linear","( value )"]}}function zm(I,o,d){const v=I.getShaderParameter(o,I.COMPILE_STATUS),b=I.getShaderInfoLog(o).trim();if(v&&b==="")return"";const E=/ERROR: 0:(\d+)/.exec(b);if(E){const P=parseInt(E[1]);return d.toUpperCase()+`

`+b+`

`+function(O,Q){const G=O.split(`
`),te=[],ge=Math.max(Q-6,0),fe=Math.min(Q+6,G.length);for(let _e=ge;_e<fe;_e++){const xe=_e+1;te.push(`${xe===Q?">":" "} ${xe}: ${G[_e]}`)}return te.join(`
`)}(I.getShaderSource(o),P)}return b}function Ds(I,o){const d=k_(o);return"vec4 "+I+"( vec4 value ) { return "+d[0]+"ToLinear"+d[1]+"; }"}function ub(I,o){const d=k_(o);return"vec4 "+I+"( vec4 value ) { return LinearTo"+d[0]+d[1]+"; }"}function hb(I,o){let d;switch(o){case Gt:d="Linear";break;case fn:d="Reinhard";break;case hn:d="OptimizedCineon";break;case qt:d="ACESFilmic";break;case An:d="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",o),d="Linear"}return"vec3 "+I+"( vec3 color ) { return "+d+"ToneMapping( color ); }"}function Nh(I){return I!==""}function Vm(I,o){const d=o.numSpotLightShadows+o.numSpotLightMaps-o.numSpotLightShadowsWithMaps;return I.replace(/NUM_DIR_LIGHTS/g,o.numDirLights).replace(/NUM_SPOT_LIGHTS/g,o.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,o.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,d).replace(/NUM_RECT_AREA_LIGHTS/g,o.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,o.numPointLights).replace(/NUM_HEMI_LIGHTS/g,o.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,o.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,o.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,o.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,o.numPointLightShadows)}function jc(I,o){return I.replace(/NUM_CLIPPING_PLANES/g,o.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,o.numClippingPlanes-o.numClipIntersection)}const db=/^[ \t]*#include +<([\w\d./]+)>/gm;function Vd(I){return I.replace(db,jd)}function jd(I,o){const d=Hr[o];if(d===void 0)throw new Error("Can not resolve #include <"+o+">");return Vd(d)}const jm=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Gm(I){return I.replace(jm,Hm)}function Hm(I,o,d,v){let b="";for(let E=parseInt(o);E<parseInt(d);E++)b+=v.replace(/\[\s*i\s*\]/g,"[ "+E+" ]").replace(/UNROLLED_LOOP_INDEX/g,E);return b}function bf(I){let o="precision "+I.precision+` float;
precision `+I.precision+" int;";return I.precision==="highp"?o+=`
#define HIGH_PRECISION`:I.precision==="mediump"?o+=`
#define MEDIUM_PRECISION`:I.precision==="lowp"&&(o+=`
#define LOW_PRECISION`),o}function fE(I,o,d,v){const b=I.getContext(),E=d.defines;let P=d.vertexShader,O=d.fragmentShader;const Q=function(Dt){let an="SHADOWMAP_TYPE_BASIC";return Dt.shadowMapType===k?an="SHADOWMAP_TYPE_PCF":Dt.shadowMapType===X?an="SHADOWMAP_TYPE_PCF_SOFT":Dt.shadowMapType===J&&(an="SHADOWMAP_TYPE_VSM"),an}(d),G=function(Dt){let an="ENVMAP_TYPE_CUBE";if(Dt.envMap)switch(Dt.envMapMode){case Bn:case de:an="ENVMAP_TYPE_CUBE";break;case Oe:an="ENVMAP_TYPE_CUBE_UV"}return an}(d),te=function(Dt){let an="ENVMAP_MODE_REFLECTION";return Dt.envMap&&Dt.envMapMode===de&&(an="ENVMAP_MODE_REFRACTION"),an}(d),ge=function(Dt){let an="ENVMAP_BLENDING_NONE";if(Dt.envMap)switch(Dt.combine){case Ue:an="ENVMAP_BLENDING_MULTIPLY";break;case St:an="ENVMAP_BLENDING_MIX";break;case Lt:an="ENVMAP_BLENDING_ADD"}return an}(d),fe=function(Dt){const an=Dt.envMapCubeUVHeight;if(an===null)return null;const Ot=Math.log2(an)-2,Mn=1/an;return{texelWidth:1/(3*Math.max(Math.pow(2,Ot),112)),texelHeight:Mn,maxMip:Ot}}(d),_e=d.isWebGL2?"":function(Dt){return[Dt.extensionDerivatives||Dt.envMapCubeUVHeight||Dt.bumpMap||Dt.normalMapTangentSpace||Dt.clearcoatNormalMap||Dt.flatShading||Dt.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Dt.extensionFragDepth||Dt.logarithmicDepthBuffer)&&Dt.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Dt.extensionDrawBuffers&&Dt.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Dt.extensionShaderTextureLOD||Dt.envMap||Dt.transmission)&&Dt.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Nh).join(`
`)}(d),xe=function(Dt){const an=[];for(const Ot in Dt){const Mn=Dt[Ot];Mn!==!1&&an.push("#define "+Ot+" "+Mn)}return an.join(`
`)}(E),Re=b.createProgram();let we,Ce,De=d.glslVersion?"#version "+d.glslVersion+`
`:"";d.isRawShaderMaterial?(we=[xe].filter(Nh).join(`
`),we.length>0&&(we+=`
`),Ce=[_e,xe].filter(Nh).join(`
`),Ce.length>0&&(Ce+=`
`)):(we=[bf(d),"#define SHADER_NAME "+d.shaderName,xe,d.instancing?"#define USE_INSTANCING":"",d.instancingColor?"#define USE_INSTANCING_COLOR":"",d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+te:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.displacementMap?"#define USE_DISPLACEMENTMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.mapUv?"#define MAP_UV "+d.mapUv:"",d.alphaMapUv?"#define ALPHAMAP_UV "+d.alphaMapUv:"",d.lightMapUv?"#define LIGHTMAP_UV "+d.lightMapUv:"",d.aoMapUv?"#define AOMAP_UV "+d.aoMapUv:"",d.emissiveMapUv?"#define EMISSIVEMAP_UV "+d.emissiveMapUv:"",d.bumpMapUv?"#define BUMPMAP_UV "+d.bumpMapUv:"",d.normalMapUv?"#define NORMALMAP_UV "+d.normalMapUv:"",d.displacementMapUv?"#define DISPLACEMENTMAP_UV "+d.displacementMapUv:"",d.metalnessMapUv?"#define METALNESSMAP_UV "+d.metalnessMapUv:"",d.roughnessMapUv?"#define ROUGHNESSMAP_UV "+d.roughnessMapUv:"",d.clearcoatMapUv?"#define CLEARCOATMAP_UV "+d.clearcoatMapUv:"",d.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+d.clearcoatNormalMapUv:"",d.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+d.clearcoatRoughnessMapUv:"",d.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+d.iridescenceMapUv:"",d.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+d.iridescenceThicknessMapUv:"",d.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+d.sheenColorMapUv:"",d.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+d.sheenRoughnessMapUv:"",d.specularMapUv?"#define SPECULARMAP_UV "+d.specularMapUv:"",d.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+d.specularColorMapUv:"",d.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+d.specularIntensityMapUv:"",d.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+d.transmissionMapUv:"",d.thicknessMapUv?"#define THICKNESSMAP_UV "+d.thicknessMapUv:"",d.vertexTangents?"#define USE_TANGENT":"",d.vertexColors?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.flatShading?"#define FLAT_SHADED":"",d.skinning?"#define USE_SKINNING":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals&&d.flatShading===!1?"#define USE_MORPHNORMALS":"",d.morphColors&&d.isWebGL2?"#define USE_MORPHCOLORS":"",d.morphTargetsCount>0&&d.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",d.morphTargetsCount>0&&d.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+d.morphTextureStride:"",d.morphTargetsCount>0&&d.isWebGL2?"#define MORPHTARGETS_COUNT "+d.morphTargetsCount:"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+Q:"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&d.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Nh).join(`
`),Ce=[_e,bf(d),"#define SHADER_NAME "+d.shaderName,xe,d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.matcap?"#define USE_MATCAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+G:"",d.envMap?"#define "+te:"",d.envMap?"#define "+ge:"",fe?"#define CUBEUV_TEXEL_WIDTH "+fe.texelWidth:"",fe?"#define CUBEUV_TEXEL_HEIGHT "+fe.texelHeight:"",fe?"#define CUBEUV_MAX_MIP "+fe.maxMip+".0":"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.clearcoat?"#define USE_CLEARCOAT":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.iridescence?"#define USE_IRIDESCENCE":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.alphaTest?"#define USE_ALPHATEST":"",d.sheen?"#define USE_SHEEN":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.vertexTangents?"#define USE_TANGENT":"",d.vertexColors||d.instancingColor?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.gradientMap?"#define USE_GRADIENTMAP":"",d.flatShading?"#define FLAT_SHADED":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+Q:"",d.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",d.useLegacyLights?"#define LEGACY_LIGHTS":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&d.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",d.toneMapping!==jt?"#define TONE_MAPPING":"",d.toneMapping!==jt?Hr.tonemapping_pars_fragment:"",d.toneMapping!==jt?hb("toneMapping",d.toneMapping):"",d.dithering?"#define DITHERING":"",d.opaque?"#define OPAQUE":"",Hr.encodings_pars_fragment,ub("linearToOutputTexel",d.outputColorSpace),d.transmissionSamplerMapEncoding?Ds("transmissionSamplerMapTexelToLinear",d.transmissionSamplerMapEncoding):"",d.useDepthPacking?"#define DEPTH_PACKING "+d.depthPacking:"",`
`].filter(Nh).join(`
`)),P=Vd(P),P=Vm(P,d),P=jc(P,d),O=Vd(O),O=Vm(O,d),O=jc(O,d),P=Gm(P),O=Gm(O),d.isWebGL2&&d.isRawShaderMaterial!==!0&&(De=`#version 300 es
`,we=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+we,Ce=["#define varying in",d.glslVersion===vm?"":"layout(location = 0) out highp vec4 pc_fragColor;",d.glslVersion===vm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Ce);const ze=De+we+P,dt=De+Ce+O,rt=cb(b,b.VERTEX_SHADER,ze),st=cb(b,b.FRAGMENT_SHADER,dt);if(b.attachShader(Re,rt),b.attachShader(Re,st),d.index0AttributeName!==void 0?b.bindAttribLocation(Re,0,d.index0AttributeName):d.morphTargets===!0&&b.bindAttribLocation(Re,0,"position"),b.linkProgram(Re),I.debug.checkShaderErrors){const Dt=b.getProgramInfoLog(Re).trim(),an=b.getShaderInfoLog(rt).trim(),Ot=b.getShaderInfoLog(st).trim();let Mn=!0,Sn=!0;if(b.getProgramParameter(Re,b.LINK_STATUS)===!1)if(Mn=!1,typeof I.debug.onShaderError=="function")I.debug.onShaderError(b,Re,rt,st);else{const ti=zm(b,rt,"vertex"),xi=zm(b,st,"fragment");console.error("THREE.WebGLProgram: Shader Error "+b.getError()+" - VALIDATE_STATUS "+b.getProgramParameter(Re,b.VALIDATE_STATUS)+`

Program Info Log: `+Dt+`
`+ti+`
`+xi)}else Dt!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Dt):an!==""&&Ot!==""||(Sn=!1);Sn&&(this.diagnostics={runnable:Mn,programLog:Dt,vertexShader:{log:an,prefix:we},fragmentShader:{log:Ot,prefix:Ce}})}let It,Kt;return b.deleteShader(rt),b.deleteShader(st),this.getUniforms=function(){return It===void 0&&(It=new N_(b,Re)),It},this.getAttributes=function(){return Kt===void 0&&(Kt=function(Dt,an){const Ot={},Mn=Dt.getProgramParameter(an,Dt.ACTIVE_ATTRIBUTES);for(let Sn=0;Sn<Mn;Sn++){const ti=Dt.getActiveAttrib(an,Sn),xi=ti.name;let ni=1;ti.type===Dt.FLOAT_MAT2&&(ni=2),ti.type===Dt.FLOAT_MAT3&&(ni=3),ti.type===Dt.FLOAT_MAT4&&(ni=4),Ot[xi]={type:ti.type,location:Dt.getAttribLocation(an,xi),locationSize:ni}}return Ot}(b,Re)),Kt},this.destroy=function(){v.releaseStatesOfProgram(this),b.deleteProgram(Re),this.program=void 0},this.name=d.shaderName,this.id=pE++,this.cacheKey=o,this.usedTimes=1,this.program=Re,this.vertexShader=rt,this.fragmentShader=st,this}let mE=0;class pb{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(o){const d=o.vertexShader,v=o.fragmentShader,b=this._getShaderStage(d),E=this._getShaderStage(v),P=this._getShaderCacheForMaterial(o);return P.has(b)===!1&&(P.add(b),b.usedTimes++),P.has(E)===!1&&(P.add(E),E.usedTimes++),this}remove(o){const d=this.materialCache.get(o);for(const v of d)v.usedTimes--,v.usedTimes===0&&this.shaderCache.delete(v.code);return this.materialCache.delete(o),this}getVertexShaderID(o){return this._getShaderStage(o.vertexShader).id}getFragmentShaderID(o){return this._getShaderStage(o.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(o){const d=this.materialCache;let v=d.get(o);return v===void 0&&(v=new Set,d.set(o,v)),v}_getShaderStage(o){const d=this.shaderCache;let v=d.get(o);return v===void 0&&(v=new fb(o),d.set(o,v)),v}}class fb{constructor(o){this.id=mE++,this.code=o,this.usedTimes=0}}function Kr(I,o,d,v,b,E,P){const O=new Zo,Q=new pb,G=[],te=b.isWebGL2,ge=b.logarithmicDepthBuffer,fe=b.vertexTextures;let _e=b.precision;const xe={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Re(we){return we===1?"uv1":we===2?"uv2":we===3?"uv3":"uv"}return{getParameters:function(we,Ce,De,ze,dt){const rt=ze.fog,st=dt.geometry,It=we.isMeshStandardMaterial?ze.environment:null,Kt=(we.isMeshStandardMaterial?d:o).get(we.envMap||It),Dt=Kt&&Kt.mapping===Oe?Kt.image.height:null,an=xe[we.type];we.precision!==null&&(_e=b.getMaxPrecision(we.precision),_e!==we.precision&&console.warn("THREE.WebGLProgram.getParameters:",we.precision,"not supported, using",_e,"instead."));const Ot=st.morphAttributes.position||st.morphAttributes.normal||st.morphAttributes.color,Mn=Ot!==void 0?Ot.length:0;let Sn,ti,xi,ni,Kn=0;if(st.morphAttributes.position!==void 0&&(Kn=1),st.morphAttributes.normal!==void 0&&(Kn=2),st.morphAttributes.color!==void 0&&(Kn=3),an){const Zf=Ja[an];Sn=Zf.vertexShader,ti=Zf.fragmentShader}else Sn=we.vertexShader,ti=we.fragmentShader,Q.update(we),xi=Q.getVertexShaderID(we),ni=Q.getFragmentShaderID(we);const gi=I.getRenderTarget(),Ai=I.userData&&I.userData.transmissionRenderTarget,wn=gi?Array.isArray(gi.texture)?gi.texture[0]:gi.texture:null,qn=dt.isInstancedMesh===!0,vi=!!we.map,ii=!!we.matcap,Si=!!Kt,rr=!!we.aoMap,Ct=!!we.lightMap,ut=!!we.bumpMap,tn=!!we.normalMap,Vt=!!we.displacementMap,Rt=!!we.emissiveMap,Jt=!!we.metalnessMap,nt=!!we.roughnessMap,Ft=we.clearcoat>0,kt=we.iridescence>0,Un=we.sheen>0,Nn=we.transmission>0,Wn=Ft&&!!we.clearcoatMap,hi=Ft&&!!we.clearcoatNormalMap,Li=Ft&&!!we.clearcoatRoughnessMap,Fi=kt&&!!we.iridescenceMap,Ei=kt&&!!we.iridescenceThicknessMap,Ar=Un&&!!we.sheenColorMap,mr=Un&&!!we.sheenRoughnessMap,Wi=!!we.specularMap,cs=!!we.specularColorMap,va=!!we.specularIntensityMap,Lr=Nn&&!!we.transmissionMap,Zr=Nn&&!!we.thicknessMap,hs=!!we.gradientMap,Mu=!!we.alphaMap,Pn=we.alphaTest>0,qh=!!we.extensions,Rg=!!st.attributes.uv1,za=!!st.attributes.uv2,Ig=!!st.attributes.uv3;return{isWebGL2:te,shaderID:an,shaderName:we.type,vertexShader:Sn,fragmentShader:ti,defines:we.defines,customVertexShaderID:xi,customFragmentShaderID:ni,isRawShaderMaterial:we.isRawShaderMaterial===!0,glslVersion:we.glslVersion,precision:_e,instancing:qn,instancingColor:qn&&dt.instanceColor!==null,supportsVertexTextures:fe,outputColorSpace:gi===null?I.outputColorSpace:gi.isXRRenderTarget===!0||wn.colorSpace&&wn.colorSpace!==or?wn.colorSpace:ws,map:vi,matcap:ii,envMap:Si,envMapMode:Si&&Kt.mapping,envMapCubeUVHeight:Dt,aoMap:rr,lightMap:Ct,bumpMap:ut,normalMap:tn,displacementMap:fe&&Vt,emissiveMap:Rt,normalMapObjectSpace:tn&&we.normalMapType===uo,normalMapTangentSpace:tn&&we.normalMapType===Fs,metalnessMap:Jt,roughnessMap:nt,clearcoat:Ft,clearcoatMap:Wn,clearcoatNormalMap:hi,clearcoatRoughnessMap:Li,iridescence:kt,iridescenceMap:Fi,iridescenceThicknessMap:Ei,sheen:Un,sheenColorMap:Ar,sheenRoughnessMap:mr,specularMap:Wi,specularColorMap:cs,specularIntensityMap:va,transmission:Nn,transmissionMap:Lr,thicknessMap:Zr,transmissionSamplerMapEncoding:Ai&&Ai.texture.colorSpace||ws,gradientMap:hs,opaque:we.transparent===!1&&we.blending===z&&!(we.transmission>0),alphaMap:Mu,alphaTest:Pn,combine:we.combine,mapUv:vi&&Re(we.map.channel),aoMapUv:rr&&Re(we.aoMap.channel),lightMapUv:Ct&&Re(we.lightMap.channel),bumpMapUv:ut&&Re(we.bumpMap.channel),normalMapUv:tn&&Re(we.normalMap.channel),displacementMapUv:Vt&&Re(we.displacementMap.channel),emissiveMapUv:Rt&&Re(we.emissiveMap.channel),metalnessMapUv:Jt&&Re(we.metalnessMap.channel),roughnessMapUv:nt&&Re(we.roughnessMap.channel),clearcoatMapUv:Wn&&Re(we.clearcoatMap.channel),clearcoatNormalMapUv:hi&&Re(we.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Li&&Re(we.clearcoatRoughnessMap.channel),iridescenceMapUv:Fi&&Re(we.iridescenceMap.channel),iridescenceThicknessMapUv:Ei&&Re(we.iridescenceThicknessMap.channel),sheenColorMapUv:Ar&&Re(we.sheenColorMap.channel),sheenRoughnessMapUv:mr&&Re(we.sheenRoughnessMap.channel),specularMapUv:Wi&&Re(we.specularMap.channel),specularColorMapUv:cs&&Re(we.specularColorMap.channel),specularIntensityMapUv:va&&Re(we.specularIntensityMap.channel),transmissionMapUv:Lr&&Re(we.transmissionMap.channel),thicknessMapUv:Zr&&Re(we.thicknessMap.channel),alphaMapUv:Mu&&Re(we.alphaMap.channel),vertexTangents:tn&&!!st.attributes.tangent,vertexColors:we.vertexColors,vertexAlphas:we.vertexColors===!0&&!!st.attributes.color&&st.attributes.color.itemSize===4,vertexUv1s:Rg,vertexUv2s:za,vertexUv3s:Ig,pointsUvs:dt.isPoints===!0&&!!st.attributes.uv&&(vi||Mu),fog:!!rt,useFog:we.fog===!0,fogExp2:rt&&rt.isFogExp2,flatShading:we.flatShading===!0,sizeAttenuation:we.sizeAttenuation===!0,logarithmicDepthBuffer:ge,skinning:dt.isSkinnedMesh===!0,morphTargets:st.morphAttributes.position!==void 0,morphNormals:st.morphAttributes.normal!==void 0,morphColors:st.morphAttributes.color!==void 0,morphTargetsCount:Mn,morphTextureStride:Kn,numDirLights:Ce.directional.length,numPointLights:Ce.point.length,numSpotLights:Ce.spot.length,numSpotLightMaps:Ce.spotLightMap.length,numRectAreaLights:Ce.rectArea.length,numHemiLights:Ce.hemi.length,numDirLightShadows:Ce.directionalShadowMap.length,numPointLightShadows:Ce.pointShadowMap.length,numSpotLightShadows:Ce.spotShadowMap.length,numSpotLightShadowsWithMaps:Ce.numSpotLightShadowsWithMaps,numClippingPlanes:P.numPlanes,numClipIntersection:P.numIntersection,dithering:we.dithering,shadowMapEnabled:I.shadowMap.enabled&&De.length>0,shadowMapType:I.shadowMap.type,toneMapping:we.toneMapped?I.toneMapping:jt,useLegacyLights:I.useLegacyLights,premultipliedAlpha:we.premultipliedAlpha,doubleSided:we.side===ne,flipSided:we.side===oe,useDepthPacking:we.depthPacking>=0,depthPacking:we.depthPacking||0,index0AttributeName:we.index0AttributeName,extensionDerivatives:qh&&we.extensions.derivatives===!0,extensionFragDepth:qh&&we.extensions.fragDepth===!0,extensionDrawBuffers:qh&&we.extensions.drawBuffers===!0,extensionShaderTextureLOD:qh&&we.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:te||v.has("EXT_frag_depth"),rendererExtensionDrawBuffers:te||v.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:te||v.has("EXT_shader_texture_lod"),customProgramCacheKey:we.customProgramCacheKey()}},getProgramCacheKey:function(we){const Ce=[];if(we.shaderID?Ce.push(we.shaderID):(Ce.push(we.customVertexShaderID),Ce.push(we.customFragmentShaderID)),we.defines!==void 0)for(const De in we.defines)Ce.push(De),Ce.push(we.defines[De]);return we.isRawShaderMaterial===!1&&(function(De,ze){De.push(ze.precision),De.push(ze.outputColorSpace),De.push(ze.envMapMode),De.push(ze.envMapCubeUVHeight),De.push(ze.mapUv),De.push(ze.alphaMapUv),De.push(ze.lightMapUv),De.push(ze.aoMapUv),De.push(ze.bumpMapUv),De.push(ze.normalMapUv),De.push(ze.displacementMapUv),De.push(ze.emissiveMapUv),De.push(ze.metalnessMapUv),De.push(ze.roughnessMapUv),De.push(ze.clearcoatMapUv),De.push(ze.clearcoatNormalMapUv),De.push(ze.clearcoatRoughnessMapUv),De.push(ze.iridescenceMapUv),De.push(ze.iridescenceThicknessMapUv),De.push(ze.sheenColorMapUv),De.push(ze.sheenRoughnessMapUv),De.push(ze.specularMapUv),De.push(ze.specularColorMapUv),De.push(ze.specularIntensityMapUv),De.push(ze.transmissionMapUv),De.push(ze.thicknessMapUv),De.push(ze.combine),De.push(ze.fogExp2),De.push(ze.sizeAttenuation),De.push(ze.morphTargetsCount),De.push(ze.morphAttributeCount),De.push(ze.numDirLights),De.push(ze.numPointLights),De.push(ze.numSpotLights),De.push(ze.numSpotLightMaps),De.push(ze.numHemiLights),De.push(ze.numRectAreaLights),De.push(ze.numDirLightShadows),De.push(ze.numPointLightShadows),De.push(ze.numSpotLightShadows),De.push(ze.numSpotLightShadowsWithMaps),De.push(ze.shadowMapType),De.push(ze.toneMapping),De.push(ze.numClippingPlanes),De.push(ze.numClipIntersection),De.push(ze.depthPacking)}(Ce,we),function(De,ze){O.disableAll(),ze.isWebGL2&&O.enable(0),ze.supportsVertexTextures&&O.enable(1),ze.instancing&&O.enable(2),ze.instancingColor&&O.enable(3),ze.matcap&&O.enable(4),ze.envMap&&O.enable(5),ze.normalMapObjectSpace&&O.enable(6),ze.normalMapTangentSpace&&O.enable(7),ze.clearcoat&&O.enable(8),ze.iridescence&&O.enable(9),ze.alphaTest&&O.enable(10),ze.vertexColors&&O.enable(11),ze.vertexAlphas&&O.enable(12),ze.vertexUv1s&&O.enable(13),ze.vertexUv2s&&O.enable(14),ze.vertexUv3s&&O.enable(15),ze.vertexTangents&&O.enable(16),De.push(O.mask),O.disableAll(),ze.fog&&O.enable(0),ze.useFog&&O.enable(1),ze.flatShading&&O.enable(2),ze.logarithmicDepthBuffer&&O.enable(3),ze.skinning&&O.enable(4),ze.morphTargets&&O.enable(5),ze.morphNormals&&O.enable(6),ze.morphColors&&O.enable(7),ze.premultipliedAlpha&&O.enable(8),ze.shadowMapEnabled&&O.enable(9),ze.useLegacyLights&&O.enable(10),ze.doubleSided&&O.enable(11),ze.flipSided&&O.enable(12),ze.useDepthPacking&&O.enable(13),ze.dithering&&O.enable(14),ze.transmission&&O.enable(15),ze.sheen&&O.enable(16),ze.opaque&&O.enable(17),ze.pointsUvs&&O.enable(18),De.push(O.mask)}(Ce,we),Ce.push(I.outputColorSpace)),Ce.push(we.customProgramCacheKey),Ce.join()},getUniforms:function(we){const Ce=xe[we.type];let De;if(Ce){const ze=Ja[Ce];De=v0.clone(ze.uniforms)}else De=we.uniforms;return De},acquireProgram:function(we,Ce){let De;for(let ze=0,dt=G.length;ze<dt;ze++){const rt=G[ze];if(rt.cacheKey===Ce){De=rt,++De.usedTimes;break}}return De===void 0&&(De=new fE(I,Ce,we,E),G.push(De)),De},releaseProgram:function(we){if(--we.usedTimes==0){const Ce=G.indexOf(we);G[Ce]=G[G.length-1],G.pop(),we.destroy()}},releaseShaderCache:function(we){Q.remove(we)},programs:G,dispose:function(){Q.dispose()}}}function D0(){let I=new WeakMap;return{get:function(o){let d=I.get(o);return d===void 0&&(d={},I.set(o,d)),d},remove:function(o){I.delete(o)},update:function(o,d,v){I.get(o)[d]=v},dispose:function(){I=new WeakMap}}}function U_(I,o){return I.groupOrder!==o.groupOrder?I.groupOrder-o.groupOrder:I.renderOrder!==o.renderOrder?I.renderOrder-o.renderOrder:I.material.id!==o.material.id?I.material.id-o.material.id:I.z!==o.z?I.z-o.z:I.id-o.id}function Oa(I,o){return I.groupOrder!==o.groupOrder?I.groupOrder-o.groupOrder:I.renderOrder!==o.renderOrder?I.renderOrder-o.renderOrder:I.z!==o.z?o.z-I.z:I.id-o.id}function mb(){const I=[];let o=0;const d=[],v=[],b=[];function E(P,O,Q,G,te,ge){let fe=I[o];return fe===void 0?(fe={id:P.id,object:P,geometry:O,material:Q,groupOrder:G,renderOrder:P.renderOrder,z:te,group:ge},I[o]=fe):(fe.id=P.id,fe.object=P,fe.geometry=O,fe.material=Q,fe.groupOrder=G,fe.renderOrder=P.renderOrder,fe.z=te,fe.group=ge),o++,fe}return{opaque:d,transmissive:v,transparent:b,init:function(){o=0,d.length=0,v.length=0,b.length=0},push:function(P,O,Q,G,te,ge){const fe=E(P,O,Q,G,te,ge);Q.transmission>0?v.push(fe):Q.transparent===!0?b.push(fe):d.push(fe)},unshift:function(P,O,Q,G,te,ge){const fe=E(P,O,Q,G,te,ge);Q.transmission>0?v.unshift(fe):Q.transparent===!0?b.unshift(fe):d.unshift(fe)},finish:function(){for(let P=o,O=I.length;P<O;P++){const Q=I[P];if(Q.id===null)break;Q.id=null,Q.object=null,Q.geometry=null,Q.material=null,Q.group=null}},sort:function(P,O){d.length>1&&d.sort(P||U_),v.length>1&&v.sort(O||Oa),b.length>1&&b.sort(O||Oa)}}}function gb(){let I=new WeakMap;return{get:function(o,d){const v=I.get(o);let b;return v===void 0?(b=new mb,I.set(o,[b])):d>=v.length?(b=new mb,v.push(b)):b=v[d],b},dispose:function(){I=new WeakMap}}}function kh(){const I={};return{get:function(o){if(I[o.id]!==void 0)return I[o.id];let d;switch(o.type){case"DirectionalLight":d={direction:new At,color:new Mi};break;case"SpotLight":d={position:new At,direction:new At,color:new Mi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":d={position:new At,color:new Mi,distance:0,decay:0};break;case"HemisphereLight":d={direction:new At,skyColor:new Mi,groundColor:new Mi};break;case"RectAreaLight":d={color:new Mi,position:new At,halfWidth:new At,halfHeight:new At}}return I[o.id]=d,d}}}let pa=0;function Ss(I,o){return(o.castShadow?2:0)-(I.castShadow?2:0)+(o.map?1:0)-(I.map?1:0)}function gE(I,o){const d=new kh,v=function(){const Q={};return{get:function(G){if(Q[G.id]!==void 0)return Q[G.id];let te;switch(G.type){case"DirectionalLight":case"SpotLight":te={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new jn};break;case"PointLight":te={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new jn,shadowCameraNear:1,shadowCameraFar:1e3}}return Q[G.id]=te,te}}}(),b={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let Q=0;Q<9;Q++)b.probe.push(new At);const E=new At,P=new Sr,O=new Sr;return{setup:function(Q,G){let te=0,ge=0,fe=0;for(let Dt=0;Dt<9;Dt++)b.probe[Dt].set(0,0,0);let _e=0,xe=0,Re=0,we=0,Ce=0,De=0,ze=0,dt=0,rt=0,st=0;Q.sort(Ss);const It=G===!0?Math.PI:1;for(let Dt=0,an=Q.length;Dt<an;Dt++){const Ot=Q[Dt],Mn=Ot.color,Sn=Ot.intensity,ti=Ot.distance,xi=Ot.shadow&&Ot.shadow.map?Ot.shadow.map.texture:null;if(Ot.isAmbientLight)te+=Mn.r*Sn*It,ge+=Mn.g*Sn*It,fe+=Mn.b*Sn*It;else if(Ot.isLightProbe)for(let ni=0;ni<9;ni++)b.probe[ni].addScaledVector(Ot.sh.coefficients[ni],Sn);else if(Ot.isDirectionalLight){const ni=d.get(Ot);if(ni.color.copy(Ot.color).multiplyScalar(Ot.intensity*It),Ot.castShadow){const Kn=Ot.shadow,gi=v.get(Ot);gi.shadowBias=Kn.bias,gi.shadowNormalBias=Kn.normalBias,gi.shadowRadius=Kn.radius,gi.shadowMapSize=Kn.mapSize,b.directionalShadow[_e]=gi,b.directionalShadowMap[_e]=xi,b.directionalShadowMatrix[_e]=Ot.shadow.matrix,De++}b.directional[_e]=ni,_e++}else if(Ot.isSpotLight){const ni=d.get(Ot);ni.position.setFromMatrixPosition(Ot.matrixWorld),ni.color.copy(Mn).multiplyScalar(Sn*It),ni.distance=ti,ni.coneCos=Math.cos(Ot.angle),ni.penumbraCos=Math.cos(Ot.angle*(1-Ot.penumbra)),ni.decay=Ot.decay,b.spot[Re]=ni;const Kn=Ot.shadow;if(Ot.map&&(b.spotLightMap[rt]=Ot.map,rt++,Kn.updateMatrices(Ot),Ot.castShadow&&st++),b.spotLightMatrix[Re]=Kn.matrix,Ot.castShadow){const gi=v.get(Ot);gi.shadowBias=Kn.bias,gi.shadowNormalBias=Kn.normalBias,gi.shadowRadius=Kn.radius,gi.shadowMapSize=Kn.mapSize,b.spotShadow[Re]=gi,b.spotShadowMap[Re]=xi,dt++}Re++}else if(Ot.isRectAreaLight){const ni=d.get(Ot);ni.color.copy(Mn).multiplyScalar(Sn),ni.halfWidth.set(.5*Ot.width,0,0),ni.halfHeight.set(0,.5*Ot.height,0),b.rectArea[we]=ni,we++}else if(Ot.isPointLight){const ni=d.get(Ot);if(ni.color.copy(Ot.color).multiplyScalar(Ot.intensity*It),ni.distance=Ot.distance,ni.decay=Ot.decay,Ot.castShadow){const Kn=Ot.shadow,gi=v.get(Ot);gi.shadowBias=Kn.bias,gi.shadowNormalBias=Kn.normalBias,gi.shadowRadius=Kn.radius,gi.shadowMapSize=Kn.mapSize,gi.shadowCameraNear=Kn.camera.near,gi.shadowCameraFar=Kn.camera.far,b.pointShadow[xe]=gi,b.pointShadowMap[xe]=xi,b.pointShadowMatrix[xe]=Ot.shadow.matrix,ze++}b.point[xe]=ni,xe++}else if(Ot.isHemisphereLight){const ni=d.get(Ot);ni.skyColor.copy(Ot.color).multiplyScalar(Sn*It),ni.groundColor.copy(Ot.groundColor).multiplyScalar(Sn*It),b.hemi[Ce]=ni,Ce++}}we>0&&(o.isWebGL2||I.has("OES_texture_float_linear")===!0?(b.rectAreaLTC1=Ri.LTC_FLOAT_1,b.rectAreaLTC2=Ri.LTC_FLOAT_2):I.has("OES_texture_half_float_linear")===!0?(b.rectAreaLTC1=Ri.LTC_HALF_1,b.rectAreaLTC2=Ri.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),b.ambient[0]=te,b.ambient[1]=ge,b.ambient[2]=fe;const Kt=b.hash;Kt.directionalLength===_e&&Kt.pointLength===xe&&Kt.spotLength===Re&&Kt.rectAreaLength===we&&Kt.hemiLength===Ce&&Kt.numDirectionalShadows===De&&Kt.numPointShadows===ze&&Kt.numSpotShadows===dt&&Kt.numSpotMaps===rt||(b.directional.length=_e,b.spot.length=Re,b.rectArea.length=we,b.point.length=xe,b.hemi.length=Ce,b.directionalShadow.length=De,b.directionalShadowMap.length=De,b.pointShadow.length=ze,b.pointShadowMap.length=ze,b.spotShadow.length=dt,b.spotShadowMap.length=dt,b.directionalShadowMatrix.length=De,b.pointShadowMatrix.length=ze,b.spotLightMatrix.length=dt+rt-st,b.spotLightMap.length=rt,b.numSpotLightShadowsWithMaps=st,Kt.directionalLength=_e,Kt.pointLength=xe,Kt.spotLength=Re,Kt.rectAreaLength=we,Kt.hemiLength=Ce,Kt.numDirectionalShadows=De,Kt.numPointShadows=ze,Kt.numSpotShadows=dt,Kt.numSpotMaps=rt,b.version=pa++)},setupView:function(Q,G){let te=0,ge=0,fe=0,_e=0,xe=0;const Re=G.matrixWorldInverse;for(let we=0,Ce=Q.length;we<Ce;we++){const De=Q[we];if(De.isDirectionalLight){const ze=b.directional[te];ze.direction.setFromMatrixPosition(De.matrixWorld),E.setFromMatrixPosition(De.target.matrixWorld),ze.direction.sub(E),ze.direction.transformDirection(Re),te++}else if(De.isSpotLight){const ze=b.spot[fe];ze.position.setFromMatrixPosition(De.matrixWorld),ze.position.applyMatrix4(Re),ze.direction.setFromMatrixPosition(De.matrixWorld),E.setFromMatrixPosition(De.target.matrixWorld),ze.direction.sub(E),ze.direction.transformDirection(Re),fe++}else if(De.isRectAreaLight){const ze=b.rectArea[_e];ze.position.setFromMatrixPosition(De.matrixWorld),ze.position.applyMatrix4(Re),O.identity(),P.copy(De.matrixWorld),P.premultiply(Re),O.extractRotation(P),ze.halfWidth.set(.5*De.width,0,0),ze.halfHeight.set(0,.5*De.height,0),ze.halfWidth.applyMatrix4(O),ze.halfHeight.applyMatrix4(O),_e++}else if(De.isPointLight){const ze=b.point[ge];ze.position.setFromMatrixPosition(De.matrixWorld),ze.position.applyMatrix4(Re),ge++}else if(De.isHemisphereLight){const ze=b.hemi[xe];ze.direction.setFromMatrixPosition(De.matrixWorld),ze.direction.transformDirection(Re),xe++}}},state:b}}function _b(I,o){const d=new gE(I,o),v=[],b=[];return{init:function(){v.length=0,b.length=0},state:{lightsArray:v,shadowsArray:b,lights:d},setupLights:function(E){d.setup(v,E)},setupLightsView:function(E){d.setupView(v,E)},pushLight:function(E){v.push(E)},pushShadow:function(E){b.push(E)}}}function Wm(I,o){let d=new WeakMap;return{get:function(v,b=0){const E=d.get(v);let P;return E===void 0?(P=new _b(I,o),d.set(v,[P])):b>=E.length?(P=new _b(I,o),E.push(P)):P=E[b],P},dispose:function(){d=new WeakMap}}}class Qm extends Vo{constructor(o){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=$i,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(o)}copy(o){return super.copy(o),this.depthPacking=o.depthPacking,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this}}class xf extends Vo{constructor(o){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(o)}copy(o){return super.copy(o),this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this}}const F_=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,hc=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Nl(I,o,d){let v=new T_;const b=new jn,E=new jn,P=new Yr,O=new Qm({depthPacking:ir}),Q=new xf,G={},te=d.maxTextureSize,ge={[$]:oe,[oe]:$,[ne]:ne},fe=new ta({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new jn},radius:{value:4}},vertexShader:F_,fragmentShader:hc}),_e=fe.clone();_e.defines.HORIZONTAL_PASS=1;const xe=new Ie;xe.setAttribute("position",new As(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Re=new Co(xe,fe),we=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=k;let Ce=this.type;function De(rt,st){const It=o.update(Re);fe.defines.VSM_SAMPLES!==rt.blurSamples&&(fe.defines.VSM_SAMPLES=rt.blurSamples,_e.defines.VSM_SAMPLES=rt.blurSamples,fe.needsUpdate=!0,_e.needsUpdate=!0),rt.mapPass===null&&(rt.mapPass=new vo(b.x,b.y)),fe.uniforms.shadow_pass.value=rt.map.texture,fe.uniforms.resolution.value=rt.mapSize,fe.uniforms.radius.value=rt.radius,I.setRenderTarget(rt.mapPass),I.clear(),I.renderBufferDirect(st,null,It,fe,Re,null),_e.uniforms.shadow_pass.value=rt.mapPass.texture,_e.uniforms.resolution.value=rt.mapSize,_e.uniforms.radius.value=rt.radius,I.setRenderTarget(rt.map),I.clear(),I.renderBufferDirect(st,null,It,_e,Re,null)}function ze(rt,st,It,Kt){let Dt=null;const an=It.isPointLight===!0?rt.customDistanceMaterial:rt.customDepthMaterial;if(an!==void 0)Dt=an;else if(Dt=It.isPointLight===!0?Q:O,I.localClippingEnabled&&st.clipShadows===!0&&Array.isArray(st.clippingPlanes)&&st.clippingPlanes.length!==0||st.displacementMap&&st.displacementScale!==0||st.alphaMap&&st.alphaTest>0||st.map&&st.alphaTest>0){const Ot=Dt.uuid,Mn=st.uuid;let Sn=G[Ot];Sn===void 0&&(Sn={},G[Ot]=Sn);let ti=Sn[Mn];ti===void 0&&(ti=Dt.clone(),Sn[Mn]=ti),Dt=ti}return Dt.visible=st.visible,Dt.wireframe=st.wireframe,Dt.side=Kt===J?st.shadowSide!==null?st.shadowSide:st.side:st.shadowSide!==null?st.shadowSide:ge[st.side],Dt.alphaMap=st.alphaMap,Dt.alphaTest=st.alphaTest,Dt.map=st.map,Dt.clipShadows=st.clipShadows,Dt.clippingPlanes=st.clippingPlanes,Dt.clipIntersection=st.clipIntersection,Dt.displacementMap=st.displacementMap,Dt.displacementScale=st.displacementScale,Dt.displacementBias=st.displacementBias,Dt.wireframeLinewidth=st.wireframeLinewidth,Dt.linewidth=st.linewidth,It.isPointLight===!0&&Dt.isMeshDistanceMaterial===!0&&(I.properties.get(Dt).light=It),Dt}function dt(rt,st,It,Kt,Dt){if(rt.visible===!1)return;if(rt.layers.test(st.layers)&&(rt.isMesh||rt.isLine||rt.isPoints)&&(rt.castShadow||rt.receiveShadow&&Dt===J)&&(!rt.frustumCulled||v.intersectsObject(rt))){rt.modelViewMatrix.multiplyMatrices(It.matrixWorldInverse,rt.matrixWorld);const Ot=o.update(rt),Mn=rt.material;if(Array.isArray(Mn)){const Sn=Ot.groups;for(let ti=0,xi=Sn.length;ti<xi;ti++){const ni=Sn[ti],Kn=Mn[ni.materialIndex];if(Kn&&Kn.visible){const gi=ze(rt,Kn,Kt,Dt);I.renderBufferDirect(It,null,Ot,gi,rt,ni)}}}else if(Mn.visible){const Sn=ze(rt,Mn,Kt,Dt);I.renderBufferDirect(It,null,Ot,Sn,rt,null)}}const an=rt.children;for(let Ot=0,Mn=an.length;Ot<Mn;Ot++)dt(an[Ot],st,It,Kt,Dt)}this.render=function(rt,st,It){if(we.enabled===!1||we.autoUpdate===!1&&we.needsUpdate===!1||rt.length===0)return;const Kt=I.getRenderTarget(),Dt=I.getActiveCubeFace(),an=I.getActiveMipmapLevel(),Ot=I.state;Ot.setBlending(V),Ot.buffers.color.setClear(1,1,1,1),Ot.buffers.depth.setTest(!0),Ot.setScissorTest(!1);const Mn=Ce!==J&&this.type===J,Sn=Ce===J&&this.type!==J;for(let ti=0,xi=rt.length;ti<xi;ti++){const ni=rt[ti],Kn=ni.shadow;if(Kn===void 0){console.warn("THREE.WebGLShadowMap:",ni,"has no shadow.");continue}if(Kn.autoUpdate===!1&&Kn.needsUpdate===!1)continue;b.copy(Kn.mapSize);const gi=Kn.getFrameExtents();if(b.multiply(gi),E.copy(Kn.mapSize),(b.x>te||b.y>te)&&(b.x>te&&(E.x=Math.floor(te/gi.x),b.x=E.x*gi.x,Kn.mapSize.x=E.x),b.y>te&&(E.y=Math.floor(te/gi.y),b.y=E.y*gi.y,Kn.mapSize.y=E.y)),Kn.map===null||Mn===!0||Sn===!0){const wn=this.type!==J?{minFilter:Bt,magFilter:Bt}:{};Kn.map!==null&&Kn.map.dispose(),Kn.map=new vo(b.x,b.y,wn),Kn.map.texture.name=ni.name+".shadowMap",Kn.camera.updateProjectionMatrix()}I.setRenderTarget(Kn.map),I.clear();const Ai=Kn.getViewportCount();for(let wn=0;wn<Ai;wn++){const qn=Kn.getViewport(wn);P.set(E.x*qn.x,E.y*qn.y,E.x*qn.z,E.y*qn.w),Ot.viewport(P),Kn.updateMatrices(ni,wn),v=Kn.getFrustum(),dt(st,It,Kn.camera,ni,this.type)}Kn.isPointLightShadow!==!0&&this.type===J&&De(Kn,It),Kn.needsUpdate=!1}Ce=this.type,we.needsUpdate=!1,I.setRenderTarget(Kt,Dt,an)}}function Xm(I,o,d){const v=d.isWebGL2,b=new function(){let nt=!1;const Ft=new Yr;let kt=null;const Un=new Yr(0,0,0,0);return{setMask:function(Nn){kt===Nn||nt||(I.colorMask(Nn,Nn,Nn,Nn),kt=Nn)},setLocked:function(Nn){nt=Nn},setClear:function(Nn,Wn,hi,Li,Fi){Fi===!0&&(Nn*=Li,Wn*=Li,hi*=Li),Ft.set(Nn,Wn,hi,Li),Un.equals(Ft)===!1&&(I.clearColor(Nn,Wn,hi,Li),Un.copy(Ft))},reset:function(){nt=!1,kt=null,Un.set(-1,0,0,0)}}},E=new function(){let nt=!1,Ft=null,kt=null,Un=null;return{setTest:function(Nn){Nn?Si(I.DEPTH_TEST):rr(I.DEPTH_TEST)},setMask:function(Nn){Ft===Nn||nt||(I.depthMask(Nn),Ft=Nn)},setFunc:function(Nn){if(kt!==Nn){switch(Nn){case Et:I.depthFunc(I.NEVER);break;case Ne:I.depthFunc(I.ALWAYS);break;case et:I.depthFunc(I.LESS);break;case wt:I.depthFunc(I.LEQUAL);break;case Zt:I.depthFunc(I.EQUAL);break;case nn:I.depthFunc(I.GEQUAL);break;case Vn:I.depthFunc(I.GREATER);break;case Jn:I.depthFunc(I.NOTEQUAL);break;default:I.depthFunc(I.LEQUAL)}kt=Nn}},setLocked:function(Nn){nt=Nn},setClear:function(Nn){Un!==Nn&&(I.clearDepth(Nn),Un=Nn)},reset:function(){nt=!1,Ft=null,kt=null,Un=null}}},P=new function(){let nt=!1,Ft=null,kt=null,Un=null,Nn=null,Wn=null,hi=null,Li=null,Fi=null;return{setTest:function(Ei){nt||(Ei?Si(I.STENCIL_TEST):rr(I.STENCIL_TEST))},setMask:function(Ei){Ft===Ei||nt||(I.stencilMask(Ei),Ft=Ei)},setFunc:function(Ei,Ar,mr){kt===Ei&&Un===Ar&&Nn===mr||(I.stencilFunc(Ei,Ar,mr),kt=Ei,Un=Ar,Nn=mr)},setOp:function(Ei,Ar,mr){Wn===Ei&&hi===Ar&&Li===mr||(I.stencilOp(Ei,Ar,mr),Wn=Ei,hi=Ar,Li=mr)},setLocked:function(Ei){nt=Ei},setClear:function(Ei){Fi!==Ei&&(I.clearStencil(Ei),Fi=Ei)},reset:function(){nt=!1,Ft=null,kt=null,Un=null,Nn=null,Wn=null,hi=null,Li=null,Fi=null}}},O=new WeakMap,Q=new WeakMap;let G={},te={},ge=new WeakMap,fe=[],_e=null,xe=!1,Re=null,we=null,Ce=null,De=null,ze=null,dt=null,rt=null,st=!1,It=null,Kt=null,Dt=null,an=null,Ot=null;const Mn=I.getParameter(I.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Sn=!1,ti=0;const xi=I.getParameter(I.VERSION);xi.indexOf("WebGL")!==-1?(ti=parseFloat(/^WebGL (\d)/.exec(xi)[1]),Sn=ti>=1):xi.indexOf("OpenGL ES")!==-1&&(ti=parseFloat(/^OpenGL ES (\d)/.exec(xi)[1]),Sn=ti>=2);let ni=null,Kn={};const gi=I.getParameter(I.SCISSOR_BOX),Ai=I.getParameter(I.VIEWPORT),wn=new Yr().fromArray(gi),qn=new Yr().fromArray(Ai);function vi(nt,Ft,kt,Un){const Nn=new Uint8Array(4),Wn=I.createTexture();I.bindTexture(nt,Wn),I.texParameteri(nt,I.TEXTURE_MIN_FILTER,I.NEAREST),I.texParameteri(nt,I.TEXTURE_MAG_FILTER,I.NEAREST);for(let hi=0;hi<kt;hi++)!v||nt!==I.TEXTURE_3D&&nt!==I.TEXTURE_2D_ARRAY?I.texImage2D(Ft+hi,0,I.RGBA,1,1,0,I.RGBA,I.UNSIGNED_BYTE,Nn):I.texImage3D(Ft,0,I.RGBA,1,1,Un,0,I.RGBA,I.UNSIGNED_BYTE,Nn);return Wn}const ii={};function Si(nt){G[nt]!==!0&&(I.enable(nt),G[nt]=!0)}function rr(nt){G[nt]!==!1&&(I.disable(nt),G[nt]=!1)}ii[I.TEXTURE_2D]=vi(I.TEXTURE_2D,I.TEXTURE_2D,1),ii[I.TEXTURE_CUBE_MAP]=vi(I.TEXTURE_CUBE_MAP,I.TEXTURE_CUBE_MAP_POSITIVE_X,6),v&&(ii[I.TEXTURE_2D_ARRAY]=vi(I.TEXTURE_2D_ARRAY,I.TEXTURE_2D_ARRAY,1,1),ii[I.TEXTURE_3D]=vi(I.TEXTURE_3D,I.TEXTURE_3D,1,1)),b.setClear(0,0,0,1),E.setClear(1),P.setClear(0),Si(I.DEPTH_TEST),E.setFunc(wt),Vt(!1),Rt(T),Si(I.CULL_FACE),tn(V);const Ct={[Y]:I.FUNC_ADD,[ie]:I.FUNC_SUBTRACT,[ve]:I.FUNC_REVERSE_SUBTRACT};if(v)Ct[re]=I.MIN,Ct[ae]=I.MAX;else{const nt=o.get("EXT_blend_minmax");nt!==null&&(Ct[re]=nt.MIN_EXT,Ct[ae]=nt.MAX_EXT)}const ut={[me]:I.ZERO,[ye]:I.ONE,[Te]:I.SRC_COLOR,[Fe]:I.SRC_ALPHA,[Pt]:I.SRC_ALPHA_SATURATE,[Ze]:I.DST_COLOR,[ot]:I.DST_ALPHA,[ke]:I.ONE_MINUS_SRC_COLOR,[Ve]:I.ONE_MINUS_SRC_ALPHA,[tt]:I.ONE_MINUS_DST_COLOR,[Ye]:I.ONE_MINUS_DST_ALPHA};function tn(nt,Ft,kt,Un,Nn,Wn,hi,Li){if(nt!==V){if(xe===!1&&(Si(I.BLEND),xe=!0),nt===K)Nn=Nn||Ft,Wn=Wn||kt,hi=hi||Un,Ft===we&&Nn===ze||(I.blendEquationSeparate(Ct[Ft],Ct[Nn]),we=Ft,ze=Nn),kt===Ce&&Un===De&&Wn===dt&&hi===rt||(I.blendFuncSeparate(ut[kt],ut[Un],ut[Wn],ut[hi]),Ce=kt,De=Un,dt=Wn,rt=hi),Re=nt,st=!1;else if(nt!==Re||Li!==st){if(we===Y&&ze===Y||(I.blendEquation(I.FUNC_ADD),we=Y,ze=Y),Li)switch(nt){case z:I.blendFuncSeparate(I.ONE,I.ONE_MINUS_SRC_ALPHA,I.ONE,I.ONE_MINUS_SRC_ALPHA);break;case ce:I.blendFunc(I.ONE,I.ONE);break;case ue:I.blendFuncSeparate(I.ZERO,I.ONE_MINUS_SRC_COLOR,I.ZERO,I.ONE);break;case he:I.blendFuncSeparate(I.ZERO,I.SRC_COLOR,I.ZERO,I.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",nt)}else switch(nt){case z:I.blendFuncSeparate(I.SRC_ALPHA,I.ONE_MINUS_SRC_ALPHA,I.ONE,I.ONE_MINUS_SRC_ALPHA);break;case ce:I.blendFunc(I.SRC_ALPHA,I.ONE);break;case ue:I.blendFuncSeparate(I.ZERO,I.ONE_MINUS_SRC_COLOR,I.ZERO,I.ONE);break;case he:I.blendFunc(I.ZERO,I.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",nt)}Ce=null,De=null,dt=null,rt=null,Re=nt,st=Li}}else xe===!0&&(rr(I.BLEND),xe=!1)}function Vt(nt){It!==nt&&(nt?I.frontFace(I.CW):I.frontFace(I.CCW),It=nt)}function Rt(nt){nt!==w?(Si(I.CULL_FACE),nt!==Kt&&(nt===T?I.cullFace(I.BACK):nt===R?I.cullFace(I.FRONT):I.cullFace(I.FRONT_AND_BACK))):rr(I.CULL_FACE),Kt=nt}function Jt(nt,Ft,kt){nt?(Si(I.POLYGON_OFFSET_FILL),an===Ft&&Ot===kt||(I.polygonOffset(Ft,kt),an=Ft,Ot=kt)):rr(I.POLYGON_OFFSET_FILL)}return{buffers:{color:b,depth:E,stencil:P},enable:Si,disable:rr,bindFramebuffer:function(nt,Ft){return te[nt]!==Ft&&(I.bindFramebuffer(nt,Ft),te[nt]=Ft,v&&(nt===I.DRAW_FRAMEBUFFER&&(te[I.FRAMEBUFFER]=Ft),nt===I.FRAMEBUFFER&&(te[I.DRAW_FRAMEBUFFER]=Ft)),!0)},drawBuffers:function(nt,Ft){let kt=fe,Un=!1;if(nt)if(kt=ge.get(Ft),kt===void 0&&(kt=[],ge.set(Ft,kt)),nt.isWebGLMultipleRenderTargets){const Nn=nt.texture;if(kt.length!==Nn.length||kt[0]!==I.COLOR_ATTACHMENT0){for(let Wn=0,hi=Nn.length;Wn<hi;Wn++)kt[Wn]=I.COLOR_ATTACHMENT0+Wn;kt.length=Nn.length,Un=!0}}else kt[0]!==I.COLOR_ATTACHMENT0&&(kt[0]=I.COLOR_ATTACHMENT0,Un=!0);else kt[0]!==I.BACK&&(kt[0]=I.BACK,Un=!0);Un&&(d.isWebGL2?I.drawBuffers(kt):o.get("WEBGL_draw_buffers").drawBuffersWEBGL(kt))},useProgram:function(nt){return _e!==nt&&(I.useProgram(nt),_e=nt,!0)},setBlending:tn,setMaterial:function(nt,Ft){nt.side===ne?rr(I.CULL_FACE):Si(I.CULL_FACE);let kt=nt.side===oe;Ft&&(kt=!kt),Vt(kt),nt.blending===z&&nt.transparent===!1?tn(V):tn(nt.blending,nt.blendEquation,nt.blendSrc,nt.blendDst,nt.blendEquationAlpha,nt.blendSrcAlpha,nt.blendDstAlpha,nt.premultipliedAlpha),E.setFunc(nt.depthFunc),E.setTest(nt.depthTest),E.setMask(nt.depthWrite),b.setMask(nt.colorWrite);const Un=nt.stencilWrite;P.setTest(Un),Un&&(P.setMask(nt.stencilWriteMask),P.setFunc(nt.stencilFunc,nt.stencilRef,nt.stencilFuncMask),P.setOp(nt.stencilFail,nt.stencilZFail,nt.stencilZPass)),Jt(nt.polygonOffset,nt.polygonOffsetFactor,nt.polygonOffsetUnits),nt.alphaToCoverage===!0?Si(I.SAMPLE_ALPHA_TO_COVERAGE):rr(I.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Vt,setCullFace:Rt,setLineWidth:function(nt){nt!==Dt&&(Sn&&I.lineWidth(nt),Dt=nt)},setPolygonOffset:Jt,setScissorTest:function(nt){nt?Si(I.SCISSOR_TEST):rr(I.SCISSOR_TEST)},activeTexture:function(nt){nt===void 0&&(nt=I.TEXTURE0+Mn-1),ni!==nt&&(I.activeTexture(nt),ni=nt)},bindTexture:function(nt,Ft,kt){kt===void 0&&(kt=ni===null?I.TEXTURE0+Mn-1:ni);let Un=Kn[kt];Un===void 0&&(Un={type:void 0,texture:void 0},Kn[kt]=Un),Un.type===nt&&Un.texture===Ft||(ni!==kt&&(I.activeTexture(kt),ni=kt),I.bindTexture(nt,Ft||ii[nt]),Un.type=nt,Un.texture=Ft)},unbindTexture:function(){const nt=Kn[ni];nt!==void 0&&nt.type!==void 0&&(I.bindTexture(nt.type,null),nt.type=void 0,nt.texture=void 0)},compressedTexImage2D:function(){try{I.compressedTexImage2D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},compressedTexImage3D:function(){try{I.compressedTexImage3D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},texImage2D:function(){try{I.texImage2D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},texImage3D:function(){try{I.texImage3D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},updateUBOMapping:function(nt,Ft){let kt=Q.get(Ft);kt===void 0&&(kt=new WeakMap,Q.set(Ft,kt));let Un=kt.get(nt);Un===void 0&&(Un=I.getUniformBlockIndex(Ft,nt.name),kt.set(nt,Un))},uniformBlockBinding:function(nt,Ft){const kt=Q.get(Ft).get(nt);O.get(Ft)!==kt&&(I.uniformBlockBinding(Ft,kt,nt.__bindingPointIndex),O.set(Ft,kt))},texStorage2D:function(){try{I.texStorage2D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},texStorage3D:function(){try{I.texStorage3D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},texSubImage2D:function(){try{I.texSubImage2D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},texSubImage3D:function(){try{I.texSubImage3D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},compressedTexSubImage2D:function(){try{I.compressedTexSubImage2D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},compressedTexSubImage3D:function(){try{I.compressedTexSubImage3D.apply(I,arguments)}catch(nt){console.error("THREE.WebGLState:",nt)}},scissor:function(nt){wn.equals(nt)===!1&&(I.scissor(nt.x,nt.y,nt.z,nt.w),wn.copy(nt))},viewport:function(nt){qn.equals(nt)===!1&&(I.viewport(nt.x,nt.y,nt.z,nt.w),qn.copy(nt))},reset:function(){I.disable(I.BLEND),I.disable(I.CULL_FACE),I.disable(I.DEPTH_TEST),I.disable(I.POLYGON_OFFSET_FILL),I.disable(I.SCISSOR_TEST),I.disable(I.STENCIL_TEST),I.disable(I.SAMPLE_ALPHA_TO_COVERAGE),I.blendEquation(I.FUNC_ADD),I.blendFunc(I.ONE,I.ZERO),I.blendFuncSeparate(I.ONE,I.ZERO,I.ONE,I.ZERO),I.colorMask(!0,!0,!0,!0),I.clearColor(0,0,0,0),I.depthMask(!0),I.depthFunc(I.LESS),I.clearDepth(1),I.stencilMask(4294967295),I.stencilFunc(I.ALWAYS,0,4294967295),I.stencilOp(I.KEEP,I.KEEP,I.KEEP),I.clearStencil(0),I.cullFace(I.BACK),I.frontFace(I.CCW),I.polygonOffset(0,0),I.activeTexture(I.TEXTURE0),I.bindFramebuffer(I.FRAMEBUFFER,null),v===!0&&(I.bindFramebuffer(I.DRAW_FRAMEBUFFER,null),I.bindFramebuffer(I.READ_FRAMEBUFFER,null)),I.useProgram(null),I.lineWidth(1),I.scissor(0,0,I.canvas.width,I.canvas.height),I.viewport(0,0,I.canvas.width,I.canvas.height),G={},ni=null,Kn={},te={},ge=new WeakMap,fe=[],_e=null,xe=!1,Re=null,we=null,Ce=null,De=null,ze=null,dt=null,rt=null,st=!1,It=null,Kt=null,Dt=null,an=null,Ot=null,wn.set(0,0,I.canvas.width,I.canvas.height),qn.set(0,0,I.canvas.width,I.canvas.height),b.reset(),E.reset(),P.reset()}}}function L0(I,o,d,v,b,E,P){const O=b.isWebGL2,Q=b.maxTextures,G=b.maxCubemapSize,te=b.maxTextureSize,ge=b.maxSamples,fe=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,_e=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),xe=new WeakMap;let Re;const we=new WeakMap;let Ce=!1;try{Ce=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function De(Ct,ut){return Ce?new OffscreenCanvas(Ct,ut):xh("canvas")}function ze(Ct,ut,tn,Vt){let Rt=1;if((Ct.width>Vt||Ct.height>Vt)&&(Rt=Vt/Math.max(Ct.width,Ct.height)),Rt<1||ut===!0){if(typeof HTMLImageElement<"u"&&Ct instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ct instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ct instanceof ImageBitmap){const Jt=ut?Zl:Math.floor,nt=Jt(Rt*Ct.width),Ft=Jt(Rt*Ct.height);Re===void 0&&(Re=De(nt,Ft));const kt=tn?De(nt,Ft):Re;return kt.width=nt,kt.height=Ft,kt.getContext("2d").drawImage(Ct,0,0,nt,Ft),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ct.width+"x"+Ct.height+") to ("+nt+"x"+Ft+")."),kt}return"data"in Ct&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ct.width+"x"+Ct.height+")."),Ct}return Ct}function dt(Ct){return bh(Ct.width)&&bh(Ct.height)}function rt(Ct,ut){return Ct.generateMipmaps&&ut&&Ct.minFilter!==Bt&&Ct.minFilter!==en}function st(Ct){I.generateMipmap(Ct)}function It(Ct,ut,tn,Vt,Rt=!1){if(O===!1)return ut;if(Ct!==null){if(I[Ct]!==void 0)return I[Ct];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ct+"'")}let Jt=ut;return ut===I.RED&&(tn===I.FLOAT&&(Jt=I.R32F),tn===I.HALF_FLOAT&&(Jt=I.R16F),tn===I.UNSIGNED_BYTE&&(Jt=I.R8)),ut===I.RG&&(tn===I.FLOAT&&(Jt=I.RG32F),tn===I.HALF_FLOAT&&(Jt=I.RG16F),tn===I.UNSIGNED_BYTE&&(Jt=I.RG8)),ut===I.RGBA&&(tn===I.FLOAT&&(Jt=I.RGBA32F),tn===I.HALF_FLOAT&&(Jt=I.RGBA16F),tn===I.UNSIGNED_BYTE&&(Jt=Vt===or&&Rt===!1?I.SRGB8_ALPHA8:I.RGBA8),tn===I.UNSIGNED_SHORT_4_4_4_4&&(Jt=I.RGBA4),tn===I.UNSIGNED_SHORT_5_5_5_1&&(Jt=I.RGB5_A1)),Jt!==I.R16F&&Jt!==I.R32F&&Jt!==I.RG16F&&Jt!==I.RG32F&&Jt!==I.RGBA16F&&Jt!==I.RGBA32F||o.get("EXT_color_buffer_float"),Jt}function Kt(Ct,ut,tn){return rt(Ct,tn)===!0||Ct.isFramebufferTexture&&Ct.minFilter!==Bt&&Ct.minFilter!==en?Math.log2(Math.max(ut.width,ut.height))+1:Ct.mipmaps!==void 0&&Ct.mipmaps.length>0?Ct.mipmaps.length:Ct.isCompressedTexture&&Array.isArray(Ct.image)?ut.mipmaps.length:1}function Dt(Ct){return Ct===Bt||Ct===xt||Ct===zt?I.NEAREST:I.LINEAR}function an(Ct){const ut=Ct.target;ut.removeEventListener("dispose",an),function(tn){const Vt=v.get(tn);if(Vt.__webglInit===void 0)return;const Rt=tn.source,Jt=we.get(Rt);if(Jt){const nt=Jt[Vt.__cacheKey];nt.usedTimes--,nt.usedTimes===0&&Mn(tn),Object.keys(Jt).length===0&&we.delete(Rt)}v.remove(tn)}(ut),ut.isVideoTexture&&xe.delete(ut)}function Ot(Ct){const ut=Ct.target;ut.removeEventListener("dispose",Ot),function(tn){const Vt=tn.texture,Rt=v.get(tn),Jt=v.get(Vt);if(Jt.__webglTexture!==void 0&&(I.deleteTexture(Jt.__webglTexture),P.memory.textures--),tn.depthTexture&&tn.depthTexture.dispose(),tn.isWebGLCubeRenderTarget)for(let nt=0;nt<6;nt++)I.deleteFramebuffer(Rt.__webglFramebuffer[nt]),Rt.__webglDepthbuffer&&I.deleteRenderbuffer(Rt.__webglDepthbuffer[nt]);else{if(I.deleteFramebuffer(Rt.__webglFramebuffer),Rt.__webglDepthbuffer&&I.deleteRenderbuffer(Rt.__webglDepthbuffer),Rt.__webglMultisampledFramebuffer&&I.deleteFramebuffer(Rt.__webglMultisampledFramebuffer),Rt.__webglColorRenderbuffer)for(let nt=0;nt<Rt.__webglColorRenderbuffer.length;nt++)Rt.__webglColorRenderbuffer[nt]&&I.deleteRenderbuffer(Rt.__webglColorRenderbuffer[nt]);Rt.__webglDepthRenderbuffer&&I.deleteRenderbuffer(Rt.__webglDepthRenderbuffer)}if(tn.isWebGLMultipleRenderTargets)for(let nt=0,Ft=Vt.length;nt<Ft;nt++){const kt=v.get(Vt[nt]);kt.__webglTexture&&(I.deleteTexture(kt.__webglTexture),P.memory.textures--),v.remove(Vt[nt])}v.remove(Vt),v.remove(tn)}(ut)}function Mn(Ct){const ut=v.get(Ct);I.deleteTexture(ut.__webglTexture);const tn=Ct.source;delete we.get(tn)[ut.__cacheKey],P.memory.textures--}let Sn=0;function ti(Ct,ut){const tn=v.get(Ct);if(Ct.isVideoTexture&&function(Vt){const Rt=P.render.frame;xe.get(Vt)!==Rt&&(xe.set(Vt,Rt),Vt.update())}(Ct),Ct.isRenderTargetTexture===!1&&Ct.version>0&&tn.__version!==Ct.version){const Vt=Ct.image;if(Vt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Vt.complete!==!1)return void Ai(tn,Ct,ut);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}d.bindTexture(I.TEXTURE_2D,tn.__webglTexture,I.TEXTURE0+ut)}const xi={[$e]:I.REPEAT,[pt]:I.CLAMP_TO_EDGE,[Mt]:I.MIRRORED_REPEAT},ni={[Bt]:I.NEAREST,[xt]:I.NEAREST_MIPMAP_NEAREST,[zt]:I.NEAREST_MIPMAP_LINEAR,[en]:I.LINEAR,[xn]:I.LINEAR_MIPMAP_NEAREST,[Gi]:I.LINEAR_MIPMAP_LINEAR};function Kn(Ct,ut,tn){if(tn?(I.texParameteri(Ct,I.TEXTURE_WRAP_S,xi[ut.wrapS]),I.texParameteri(Ct,I.TEXTURE_WRAP_T,xi[ut.wrapT]),Ct!==I.TEXTURE_3D&&Ct!==I.TEXTURE_2D_ARRAY||I.texParameteri(Ct,I.TEXTURE_WRAP_R,xi[ut.wrapR]),I.texParameteri(Ct,I.TEXTURE_MAG_FILTER,ni[ut.magFilter]),I.texParameteri(Ct,I.TEXTURE_MIN_FILTER,ni[ut.minFilter])):(I.texParameteri(Ct,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(Ct,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),Ct!==I.TEXTURE_3D&&Ct!==I.TEXTURE_2D_ARRAY||I.texParameteri(Ct,I.TEXTURE_WRAP_R,I.CLAMP_TO_EDGE),ut.wrapS===pt&&ut.wrapT===pt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),I.texParameteri(Ct,I.TEXTURE_MAG_FILTER,Dt(ut.magFilter)),I.texParameteri(Ct,I.TEXTURE_MIN_FILTER,Dt(ut.minFilter)),ut.minFilter!==Bt&&ut.minFilter!==en&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.has("EXT_texture_filter_anisotropic")===!0){const Vt=o.get("EXT_texture_filter_anisotropic");if(ut.magFilter===Bt||ut.minFilter!==zt&&ut.minFilter!==Gi||ut.type===Pr&&o.has("OES_texture_float_linear")===!1||O===!1&&ut.type===wr&&o.has("OES_texture_half_float_linear")===!1)return;(ut.anisotropy>1||v.get(ut).__currentAnisotropy)&&(I.texParameterf(Ct,Vt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ut.anisotropy,b.getMaxAnisotropy())),v.get(ut).__currentAnisotropy=ut.anisotropy)}}function gi(Ct,ut){let tn=!1;Ct.__webglInit===void 0&&(Ct.__webglInit=!0,ut.addEventListener("dispose",an));const Vt=ut.source;let Rt=we.get(Vt);Rt===void 0&&(Rt={},we.set(Vt,Rt));const Jt=function(nt){const Ft=[];return Ft.push(nt.wrapS),Ft.push(nt.wrapT),Ft.push(nt.wrapR||0),Ft.push(nt.magFilter),Ft.push(nt.minFilter),Ft.push(nt.anisotropy),Ft.push(nt.internalFormat),Ft.push(nt.format),Ft.push(nt.type),Ft.push(nt.generateMipmaps),Ft.push(nt.premultiplyAlpha),Ft.push(nt.flipY),Ft.push(nt.unpackAlignment),Ft.push(nt.colorSpace),Ft.join()}(ut);if(Jt!==Ct.__cacheKey){Rt[Jt]===void 0&&(Rt[Jt]={texture:I.createTexture(),usedTimes:0},P.memory.textures++,tn=!0),Rt[Jt].usedTimes++;const nt=Rt[Ct.__cacheKey];nt!==void 0&&(Rt[Ct.__cacheKey].usedTimes--,nt.usedTimes===0&&Mn(ut)),Ct.__cacheKey=Jt,Ct.__webglTexture=Rt[Jt].texture}return tn}function Ai(Ct,ut,tn){let Vt=I.TEXTURE_2D;(ut.isDataArrayTexture||ut.isCompressedArrayTexture)&&(Vt=I.TEXTURE_2D_ARRAY),ut.isData3DTexture&&(Vt=I.TEXTURE_3D);const Rt=gi(Ct,ut),Jt=ut.source;d.bindTexture(Vt,Ct.__webglTexture,I.TEXTURE0+tn);const nt=v.get(Jt);if(Jt.version!==nt.__version||Rt===!0){d.activeTexture(I.TEXTURE0+tn),I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,ut.flipY),I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ut.premultiplyAlpha),I.pixelStorei(I.UNPACK_ALIGNMENT,ut.unpackAlignment),I.pixelStorei(I.UNPACK_COLORSPACE_CONVERSION_WEBGL,I.NONE);const Ft=function(Wi){return!O&&(Wi.wrapS!==pt||Wi.wrapT!==pt||Wi.minFilter!==Bt&&Wi.minFilter!==en)}(ut)&&dt(ut.image)===!1;let kt=ze(ut.image,Ft,!1,te);kt=rr(ut,kt);const Un=dt(kt)||O,Nn=E.convert(ut.format,ut.colorSpace);let Wn,hi=E.convert(ut.type),Li=It(ut.internalFormat,Nn,hi,ut.colorSpace);Kn(Vt,ut,Un);const Fi=ut.mipmaps,Ei=O&&ut.isVideoTexture!==!0,Ar=nt.__version===void 0||Rt===!0,mr=Kt(ut,kt,Un);if(ut.isDepthTexture)Li=I.DEPTH_COMPONENT,O?Li=ut.type===Pr?I.DEPTH_COMPONENT32F:ut.type===Nr?I.DEPTH_COMPONENT24:ut.type===Jr?I.DEPTH24_STENCIL8:I.DEPTH_COMPONENT16:ut.type===Pr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),ut.format===Zs&&Li===I.DEPTH_COMPONENT&&ut.type!==kn&&ut.type!==Nr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ut.type=Nr,hi=E.convert(ut.type)),ut.format===Bo&&Li===I.DEPTH_COMPONENT&&(Li=I.DEPTH_STENCIL,ut.type!==Jr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ut.type=Jr,hi=E.convert(ut.type))),Ar&&(Ei?d.texStorage2D(I.TEXTURE_2D,1,Li,kt.width,kt.height):d.texImage2D(I.TEXTURE_2D,0,Li,kt.width,kt.height,0,Nn,hi,null));else if(ut.isDataTexture)if(Fi.length>0&&Un){Ei&&Ar&&d.texStorage2D(I.TEXTURE_2D,mr,Li,Fi[0].width,Fi[0].height);for(let Wi=0,cs=Fi.length;Wi<cs;Wi++)Wn=Fi[Wi],Ei?d.texSubImage2D(I.TEXTURE_2D,Wi,0,0,Wn.width,Wn.height,Nn,hi,Wn.data):d.texImage2D(I.TEXTURE_2D,Wi,Li,Wn.width,Wn.height,0,Nn,hi,Wn.data);ut.generateMipmaps=!1}else Ei?(Ar&&d.texStorage2D(I.TEXTURE_2D,mr,Li,kt.width,kt.height),d.texSubImage2D(I.TEXTURE_2D,0,0,0,kt.width,kt.height,Nn,hi,kt.data)):d.texImage2D(I.TEXTURE_2D,0,Li,kt.width,kt.height,0,Nn,hi,kt.data);else if(ut.isCompressedTexture)if(ut.isCompressedArrayTexture){Ei&&Ar&&d.texStorage3D(I.TEXTURE_2D_ARRAY,mr,Li,Fi[0].width,Fi[0].height,kt.depth);for(let Wi=0,cs=Fi.length;Wi<cs;Wi++)Wn=Fi[Wi],ut.format!==xs?Nn!==null?Ei?d.compressedTexSubImage3D(I.TEXTURE_2D_ARRAY,Wi,0,0,0,Wn.width,Wn.height,kt.depth,Nn,Wn.data,0,0):d.compressedTexImage3D(I.TEXTURE_2D_ARRAY,Wi,Li,Wn.width,Wn.height,kt.depth,0,Wn.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ei?d.texSubImage3D(I.TEXTURE_2D_ARRAY,Wi,0,0,0,Wn.width,Wn.height,kt.depth,Nn,hi,Wn.data):d.texImage3D(I.TEXTURE_2D_ARRAY,Wi,Li,Wn.width,Wn.height,kt.depth,0,Nn,hi,Wn.data)}else{Ei&&Ar&&d.texStorage2D(I.TEXTURE_2D,mr,Li,Fi[0].width,Fi[0].height);for(let Wi=0,cs=Fi.length;Wi<cs;Wi++)Wn=Fi[Wi],ut.format!==xs?Nn!==null?Ei?d.compressedTexSubImage2D(I.TEXTURE_2D,Wi,0,0,Wn.width,Wn.height,Nn,Wn.data):d.compressedTexImage2D(I.TEXTURE_2D,Wi,Li,Wn.width,Wn.height,0,Wn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ei?d.texSubImage2D(I.TEXTURE_2D,Wi,0,0,Wn.width,Wn.height,Nn,hi,Wn.data):d.texImage2D(I.TEXTURE_2D,Wi,Li,Wn.width,Wn.height,0,Nn,hi,Wn.data)}else if(ut.isDataArrayTexture)Ei?(Ar&&d.texStorage3D(I.TEXTURE_2D_ARRAY,mr,Li,kt.width,kt.height,kt.depth),d.texSubImage3D(I.TEXTURE_2D_ARRAY,0,0,0,0,kt.width,kt.height,kt.depth,Nn,hi,kt.data)):d.texImage3D(I.TEXTURE_2D_ARRAY,0,Li,kt.width,kt.height,kt.depth,0,Nn,hi,kt.data);else if(ut.isData3DTexture)Ei?(Ar&&d.texStorage3D(I.TEXTURE_3D,mr,Li,kt.width,kt.height,kt.depth),d.texSubImage3D(I.TEXTURE_3D,0,0,0,0,kt.width,kt.height,kt.depth,Nn,hi,kt.data)):d.texImage3D(I.TEXTURE_3D,0,Li,kt.width,kt.height,kt.depth,0,Nn,hi,kt.data);else if(ut.isFramebufferTexture){if(Ar)if(Ei)d.texStorage2D(I.TEXTURE_2D,mr,Li,kt.width,kt.height);else{let Wi=kt.width,cs=kt.height;for(let va=0;va<mr;va++)d.texImage2D(I.TEXTURE_2D,va,Li,Wi,cs,0,Nn,hi,null),Wi>>=1,cs>>=1}}else if(Fi.length>0&&Un){Ei&&Ar&&d.texStorage2D(I.TEXTURE_2D,mr,Li,Fi[0].width,Fi[0].height);for(let Wi=0,cs=Fi.length;Wi<cs;Wi++)Wn=Fi[Wi],Ei?d.texSubImage2D(I.TEXTURE_2D,Wi,0,0,Nn,hi,Wn):d.texImage2D(I.TEXTURE_2D,Wi,Li,Nn,hi,Wn);ut.generateMipmaps=!1}else Ei?(Ar&&d.texStorage2D(I.TEXTURE_2D,mr,Li,kt.width,kt.height),d.texSubImage2D(I.TEXTURE_2D,0,0,0,Nn,hi,kt)):d.texImage2D(I.TEXTURE_2D,0,Li,Nn,hi,kt);rt(ut,Un)&&st(Vt),nt.__version=Jt.version,ut.onUpdate&&ut.onUpdate(ut)}Ct.__version=ut.version}function wn(Ct,ut,tn,Vt,Rt){const Jt=E.convert(tn.format,tn.colorSpace),nt=E.convert(tn.type),Ft=It(tn.internalFormat,Jt,nt,tn.colorSpace);v.get(ut).__hasExternalTextures||(Rt===I.TEXTURE_3D||Rt===I.TEXTURE_2D_ARRAY?d.texImage3D(Rt,0,Ft,ut.width,ut.height,ut.depth,0,Jt,nt,null):d.texImage2D(Rt,0,Ft,ut.width,ut.height,0,Jt,nt,null)),d.bindFramebuffer(I.FRAMEBUFFER,Ct),Si(ut)?fe.framebufferTexture2DMultisampleEXT(I.FRAMEBUFFER,Vt,Rt,v.get(tn).__webglTexture,0,ii(ut)):(Rt===I.TEXTURE_2D||Rt>=I.TEXTURE_CUBE_MAP_POSITIVE_X&&Rt<=I.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&I.framebufferTexture2D(I.FRAMEBUFFER,Vt,Rt,v.get(tn).__webglTexture,0),d.bindFramebuffer(I.FRAMEBUFFER,null)}function qn(Ct,ut,tn){if(I.bindRenderbuffer(I.RENDERBUFFER,Ct),ut.depthBuffer&&!ut.stencilBuffer){let Vt=I.DEPTH_COMPONENT16;if(tn||Si(ut)){const Rt=ut.depthTexture;Rt&&Rt.isDepthTexture&&(Rt.type===Pr?Vt=I.DEPTH_COMPONENT32F:Rt.type===Nr&&(Vt=I.DEPTH_COMPONENT24));const Jt=ii(ut);Si(ut)?fe.renderbufferStorageMultisampleEXT(I.RENDERBUFFER,Jt,Vt,ut.width,ut.height):I.renderbufferStorageMultisample(I.RENDERBUFFER,Jt,Vt,ut.width,ut.height)}else I.renderbufferStorage(I.RENDERBUFFER,Vt,ut.width,ut.height);I.framebufferRenderbuffer(I.FRAMEBUFFER,I.DEPTH_ATTACHMENT,I.RENDERBUFFER,Ct)}else if(ut.depthBuffer&&ut.stencilBuffer){const Vt=ii(ut);tn&&Si(ut)===!1?I.renderbufferStorageMultisample(I.RENDERBUFFER,Vt,I.DEPTH24_STENCIL8,ut.width,ut.height):Si(ut)?fe.renderbufferStorageMultisampleEXT(I.RENDERBUFFER,Vt,I.DEPTH24_STENCIL8,ut.width,ut.height):I.renderbufferStorage(I.RENDERBUFFER,I.DEPTH_STENCIL,ut.width,ut.height),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.DEPTH_STENCIL_ATTACHMENT,I.RENDERBUFFER,Ct)}else{const Vt=ut.isWebGLMultipleRenderTargets===!0?ut.texture:[ut.texture];for(let Rt=0;Rt<Vt.length;Rt++){const Jt=Vt[Rt],nt=E.convert(Jt.format,Jt.colorSpace),Ft=E.convert(Jt.type),kt=It(Jt.internalFormat,nt,Ft,Jt.colorSpace),Un=ii(ut);tn&&Si(ut)===!1?I.renderbufferStorageMultisample(I.RENDERBUFFER,Un,kt,ut.width,ut.height):Si(ut)?fe.renderbufferStorageMultisampleEXT(I.RENDERBUFFER,Un,kt,ut.width,ut.height):I.renderbufferStorage(I.RENDERBUFFER,kt,ut.width,ut.height)}}I.bindRenderbuffer(I.RENDERBUFFER,null)}function vi(Ct){const ut=v.get(Ct),tn=Ct.isWebGLCubeRenderTarget===!0;if(Ct.depthTexture&&!ut.__autoAllocateDepthBuffer){if(tn)throw new Error("target.depthTexture not supported in Cube render targets");(function(Vt,Rt){if(Rt&&Rt.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(d.bindFramebuffer(I.FRAMEBUFFER,Vt),!Rt.depthTexture||!Rt.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");v.get(Rt.depthTexture).__webglTexture&&Rt.depthTexture.image.width===Rt.width&&Rt.depthTexture.image.height===Rt.height||(Rt.depthTexture.image.width=Rt.width,Rt.depthTexture.image.height=Rt.height,Rt.depthTexture.needsUpdate=!0),ti(Rt.depthTexture,0);const Jt=v.get(Rt.depthTexture).__webglTexture,nt=ii(Rt);if(Rt.depthTexture.format===Zs)Si(Rt)?fe.framebufferTexture2DMultisampleEXT(I.FRAMEBUFFER,I.DEPTH_ATTACHMENT,I.TEXTURE_2D,Jt,0,nt):I.framebufferTexture2D(I.FRAMEBUFFER,I.DEPTH_ATTACHMENT,I.TEXTURE_2D,Jt,0);else{if(Rt.depthTexture.format!==Bo)throw new Error("Unknown depthTexture format");Si(Rt)?fe.framebufferTexture2DMultisampleEXT(I.FRAMEBUFFER,I.DEPTH_STENCIL_ATTACHMENT,I.TEXTURE_2D,Jt,0,nt):I.framebufferTexture2D(I.FRAMEBUFFER,I.DEPTH_STENCIL_ATTACHMENT,I.TEXTURE_2D,Jt,0)}})(ut.__webglFramebuffer,Ct)}else if(tn){ut.__webglDepthbuffer=[];for(let Vt=0;Vt<6;Vt++)d.bindFramebuffer(I.FRAMEBUFFER,ut.__webglFramebuffer[Vt]),ut.__webglDepthbuffer[Vt]=I.createRenderbuffer(),qn(ut.__webglDepthbuffer[Vt],Ct,!1)}else d.bindFramebuffer(I.FRAMEBUFFER,ut.__webglFramebuffer),ut.__webglDepthbuffer=I.createRenderbuffer(),qn(ut.__webglDepthbuffer,Ct,!1);d.bindFramebuffer(I.FRAMEBUFFER,null)}function ii(Ct){return Math.min(ge,Ct.samples)}function Si(Ct){const ut=v.get(Ct);return O&&Ct.samples>0&&o.has("WEBGL_multisampled_render_to_texture")===!0&&ut.__useRenderToTexture!==!1}function rr(Ct,ut){const tn=Ct.colorSpace,Vt=Ct.format,Rt=Ct.type;return Ct.isCompressedTexture===!0||Ct.format===$p||tn!==ws&&tn!==Eo&&(tn===or?O===!1?o.has("EXT_sRGB")===!0&&Vt===xs?(Ct.format=$p,Ct.minFilter=en,Ct.generateMipmaps=!1):ut=Sd.sRGBToLinear(ut):Vt===xs&&Rt===oi||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):tn===Ha||console.error("THREE.WebGLTextures: Unsupported texture color space:",tn)),ut}this.allocateTextureUnit=function(){const Ct=Sn;return Ct>=Q&&console.warn("THREE.WebGLTextures: Trying to use "+Ct+" texture units while this GPU supports only "+Q),Sn+=1,Ct},this.resetTextureUnits=function(){Sn=0},this.setTexture2D=ti,this.setTexture2DArray=function(Ct,ut){const tn=v.get(Ct);Ct.version>0&&tn.__version!==Ct.version?Ai(tn,Ct,ut):d.bindTexture(I.TEXTURE_2D_ARRAY,tn.__webglTexture,I.TEXTURE0+ut)},this.setTexture3D=function(Ct,ut){const tn=v.get(Ct);Ct.version>0&&tn.__version!==Ct.version?Ai(tn,Ct,ut):d.bindTexture(I.TEXTURE_3D,tn.__webglTexture,I.TEXTURE0+ut)},this.setTextureCube=function(Ct,ut){const tn=v.get(Ct);Ct.version>0&&tn.__version!==Ct.version?function(Vt,Rt,Jt){if(Rt.image.length!==6)return;const nt=gi(Vt,Rt),Ft=Rt.source;d.bindTexture(I.TEXTURE_CUBE_MAP,Vt.__webglTexture,I.TEXTURE0+Jt);const kt=v.get(Ft);if(Ft.version!==kt.__version||nt===!0){d.activeTexture(I.TEXTURE0+Jt),I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,Rt.flipY),I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Rt.premultiplyAlpha),I.pixelStorei(I.UNPACK_ALIGNMENT,Rt.unpackAlignment),I.pixelStorei(I.UNPACK_COLORSPACE_CONVERSION_WEBGL,I.NONE);const Un=Rt.isCompressedTexture||Rt.image[0].isCompressedTexture,Nn=Rt.image[0]&&Rt.image[0].isDataTexture,Wn=[];for(let Lr=0;Lr<6;Lr++)Wn[Lr]=Un||Nn?Nn?Rt.image[Lr].image:Rt.image[Lr]:ze(Rt.image[Lr],!1,!0,G),Wn[Lr]=rr(Rt,Wn[Lr]);const hi=Wn[0],Li=dt(hi)||O,Fi=E.convert(Rt.format,Rt.colorSpace),Ei=E.convert(Rt.type),Ar=It(Rt.internalFormat,Fi,Ei,Rt.colorSpace),mr=O&&Rt.isVideoTexture!==!0,Wi=kt.__version===void 0||nt===!0;let cs,va=Kt(Rt,hi,Li);if(Kn(I.TEXTURE_CUBE_MAP,Rt,Li),Un){mr&&Wi&&d.texStorage2D(I.TEXTURE_CUBE_MAP,va,Ar,hi.width,hi.height);for(let Lr=0;Lr<6;Lr++){cs=Wn[Lr].mipmaps;for(let Zr=0;Zr<cs.length;Zr++){const hs=cs[Zr];Rt.format!==xs?Fi!==null?mr?d.compressedTexSubImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,Zr,0,0,hs.width,hs.height,Fi,hs.data):d.compressedTexImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,Zr,Ar,hs.width,hs.height,0,hs.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):mr?d.texSubImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,Zr,0,0,hs.width,hs.height,Fi,Ei,hs.data):d.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,Zr,Ar,hs.width,hs.height,0,Fi,Ei,hs.data)}}}else{cs=Rt.mipmaps,mr&&Wi&&(cs.length>0&&va++,d.texStorage2D(I.TEXTURE_CUBE_MAP,va,Ar,Wn[0].width,Wn[0].height));for(let Lr=0;Lr<6;Lr++)if(Nn){mr?d.texSubImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,0,0,0,Wn[Lr].width,Wn[Lr].height,Fi,Ei,Wn[Lr].data):d.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,0,Ar,Wn[Lr].width,Wn[Lr].height,0,Fi,Ei,Wn[Lr].data);for(let Zr=0;Zr<cs.length;Zr++){const hs=cs[Zr].image[Lr].image;mr?d.texSubImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,Zr+1,0,0,hs.width,hs.height,Fi,Ei,hs.data):d.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,Zr+1,Ar,hs.width,hs.height,0,Fi,Ei,hs.data)}}else{mr?d.texSubImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,0,0,0,Fi,Ei,Wn[Lr]):d.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,0,Ar,Fi,Ei,Wn[Lr]);for(let Zr=0;Zr<cs.length;Zr++){const hs=cs[Zr];mr?d.texSubImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,Zr+1,0,0,Fi,Ei,hs.image[Lr]):d.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+Lr,Zr+1,Ar,Fi,Ei,hs.image[Lr])}}}rt(Rt,Li)&&st(I.TEXTURE_CUBE_MAP),kt.__version=Ft.version,Rt.onUpdate&&Rt.onUpdate(Rt)}Vt.__version=Rt.version}(tn,Ct,ut):d.bindTexture(I.TEXTURE_CUBE_MAP,tn.__webglTexture,I.TEXTURE0+ut)},this.rebindTextures=function(Ct,ut,tn){const Vt=v.get(Ct);ut!==void 0&&wn(Vt.__webglFramebuffer,Ct,Ct.texture,I.COLOR_ATTACHMENT0,I.TEXTURE_2D),tn!==void 0&&vi(Ct)},this.setupRenderTarget=function(Ct){const ut=Ct.texture,tn=v.get(Ct),Vt=v.get(ut);Ct.addEventListener("dispose",Ot),Ct.isWebGLMultipleRenderTargets!==!0&&(Vt.__webglTexture===void 0&&(Vt.__webglTexture=I.createTexture()),Vt.__version=ut.version,P.memory.textures++);const Rt=Ct.isWebGLCubeRenderTarget===!0,Jt=Ct.isWebGLMultipleRenderTargets===!0,nt=dt(Ct)||O;if(Rt){tn.__webglFramebuffer=[];for(let Ft=0;Ft<6;Ft++)tn.__webglFramebuffer[Ft]=I.createFramebuffer()}else{if(tn.__webglFramebuffer=I.createFramebuffer(),Jt)if(b.drawBuffers){const Ft=Ct.texture;for(let kt=0,Un=Ft.length;kt<Un;kt++){const Nn=v.get(Ft[kt]);Nn.__webglTexture===void 0&&(Nn.__webglTexture=I.createTexture(),P.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(O&&Ct.samples>0&&Si(Ct)===!1){const Ft=Jt?ut:[ut];tn.__webglMultisampledFramebuffer=I.createFramebuffer(),tn.__webglColorRenderbuffer=[],d.bindFramebuffer(I.FRAMEBUFFER,tn.__webglMultisampledFramebuffer);for(let kt=0;kt<Ft.length;kt++){const Un=Ft[kt];tn.__webglColorRenderbuffer[kt]=I.createRenderbuffer(),I.bindRenderbuffer(I.RENDERBUFFER,tn.__webglColorRenderbuffer[kt]);const Nn=E.convert(Un.format,Un.colorSpace),Wn=E.convert(Un.type),hi=It(Un.internalFormat,Nn,Wn,Un.colorSpace,Ct.isXRRenderTarget===!0),Li=ii(Ct);I.renderbufferStorageMultisample(I.RENDERBUFFER,Li,hi,Ct.width,Ct.height),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0+kt,I.RENDERBUFFER,tn.__webglColorRenderbuffer[kt])}I.bindRenderbuffer(I.RENDERBUFFER,null),Ct.depthBuffer&&(tn.__webglDepthRenderbuffer=I.createRenderbuffer(),qn(tn.__webglDepthRenderbuffer,Ct,!0)),d.bindFramebuffer(I.FRAMEBUFFER,null)}}if(Rt){d.bindTexture(I.TEXTURE_CUBE_MAP,Vt.__webglTexture),Kn(I.TEXTURE_CUBE_MAP,ut,nt);for(let Ft=0;Ft<6;Ft++)wn(tn.__webglFramebuffer[Ft],Ct,ut,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+Ft);rt(ut,nt)&&st(I.TEXTURE_CUBE_MAP),d.unbindTexture()}else if(Jt){const Ft=Ct.texture;for(let kt=0,Un=Ft.length;kt<Un;kt++){const Nn=Ft[kt],Wn=v.get(Nn);d.bindTexture(I.TEXTURE_2D,Wn.__webglTexture),Kn(I.TEXTURE_2D,Nn,nt),wn(tn.__webglFramebuffer,Ct,Nn,I.COLOR_ATTACHMENT0+kt,I.TEXTURE_2D),rt(Nn,nt)&&st(I.TEXTURE_2D)}d.unbindTexture()}else{let Ft=I.TEXTURE_2D;(Ct.isWebGL3DRenderTarget||Ct.isWebGLArrayRenderTarget)&&(O?Ft=Ct.isWebGL3DRenderTarget?I.TEXTURE_3D:I.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),d.bindTexture(Ft,Vt.__webglTexture),Kn(Ft,ut,nt),wn(tn.__webglFramebuffer,Ct,ut,I.COLOR_ATTACHMENT0,Ft),rt(ut,nt)&&st(Ft),d.unbindTexture()}Ct.depthBuffer&&vi(Ct)},this.updateRenderTargetMipmap=function(Ct){const ut=dt(Ct)||O,tn=Ct.isWebGLMultipleRenderTargets===!0?Ct.texture:[Ct.texture],Vt=Ct.isWebGLCubeRenderTarget?I.TEXTURE_CUBE_MAP:I.TEXTURE_2D;for(let Rt=0,Jt=tn.length;Rt<Jt;Rt++){const nt=tn[Rt],Ft=v.get(nt),kt=Ft.__webglTexture;Ft.__version!==nt.version&&(d.bindTexture(Vt,kt),Kn(Vt,nt,ut),d.unbindTexture(),Ft.__version=nt.version),rt(nt,ut)&&(d.bindTexture(Vt,kt),st(Vt),d.unbindTexture())}},this.updateMultisampleRenderTarget=function(Ct){if(O&&Ct.samples>0&&Si(Ct)===!1){const ut=Ct.isWebGLMultipleRenderTargets?Ct.texture:[Ct.texture],tn=Ct.width,Vt=Ct.height;let Rt=I.COLOR_BUFFER_BIT;const Jt=[],nt=Ct.stencilBuffer?I.DEPTH_STENCIL_ATTACHMENT:I.DEPTH_ATTACHMENT,Ft=v.get(Ct),kt=Ct.isWebGLMultipleRenderTargets===!0;if(kt)for(let Un=0;Un<ut.length;Un++)d.bindFramebuffer(I.FRAMEBUFFER,Ft.__webglMultisampledFramebuffer),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0+Un,I.RENDERBUFFER,null),d.bindFramebuffer(I.FRAMEBUFFER,Ft.__webglFramebuffer),I.framebufferTexture2D(I.DRAW_FRAMEBUFFER,I.COLOR_ATTACHMENT0+Un,I.TEXTURE_2D,null,0);d.bindFramebuffer(I.READ_FRAMEBUFFER,Ft.__webglMultisampledFramebuffer),d.bindFramebuffer(I.DRAW_FRAMEBUFFER,Ft.__webglFramebuffer);for(let Un=0;Un<ut.length;Un++){Jt.push(I.COLOR_ATTACHMENT0+Un),Ct.depthBuffer&&Jt.push(nt);const Nn=Ft.__ignoreDepthValues!==void 0&&Ft.__ignoreDepthValues;if(Nn===!1&&(Ct.depthBuffer&&(Rt|=I.DEPTH_BUFFER_BIT),Ct.stencilBuffer&&(Rt|=I.STENCIL_BUFFER_BIT)),kt&&I.framebufferRenderbuffer(I.READ_FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.RENDERBUFFER,Ft.__webglColorRenderbuffer[Un]),Nn===!0&&(I.invalidateFramebuffer(I.READ_FRAMEBUFFER,[nt]),I.invalidateFramebuffer(I.DRAW_FRAMEBUFFER,[nt])),kt){const Wn=v.get(ut[Un]).__webglTexture;I.framebufferTexture2D(I.DRAW_FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,Wn,0)}I.blitFramebuffer(0,0,tn,Vt,0,0,tn,Vt,Rt,I.NEAREST),_e&&I.invalidateFramebuffer(I.READ_FRAMEBUFFER,Jt)}if(d.bindFramebuffer(I.READ_FRAMEBUFFER,null),d.bindFramebuffer(I.DRAW_FRAMEBUFFER,null),kt)for(let Un=0;Un<ut.length;Un++){d.bindFramebuffer(I.FRAMEBUFFER,Ft.__webglMultisampledFramebuffer),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0+Un,I.RENDERBUFFER,Ft.__webglColorRenderbuffer[Un]);const Nn=v.get(ut[Un]).__webglTexture;d.bindFramebuffer(I.FRAMEBUFFER,Ft.__webglFramebuffer),I.framebufferTexture2D(I.DRAW_FRAMEBUFFER,I.COLOR_ATTACHMENT0+Un,I.TEXTURE_2D,Nn,0)}d.bindFramebuffer(I.DRAW_FRAMEBUFFER,Ft.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=vi,this.setupFrameBufferTexture=wn,this.useMultisampledRTT=Si}function vb(I,o,d){const v=d.isWebGL2;return{convert:function(b,E=Eo){let P;if(b===oi)return I.UNSIGNED_BYTE;if(b===es)return I.UNSIGNED_SHORT_4_4_4_4;if(b===Ps)return I.UNSIGNED_SHORT_5_5_5_1;if(b===pn)return I.BYTE;if(b===Dn)return I.SHORT;if(b===kn)return I.UNSIGNED_SHORT;if(b===ui)return I.INT;if(b===Nr)return I.UNSIGNED_INT;if(b===Pr)return I.FLOAT;if(b===wr)return v?I.HALF_FLOAT:(P=o.get("OES_texture_half_float"),P!==null?P.HALF_FLOAT_OES:null);if(b===cl)return I.ALPHA;if(b===xs)return I.RGBA;if(b===wo)return I.LUMINANCE;if(b===Cl)return I.LUMINANCE_ALPHA;if(b===Zs)return I.DEPTH_COMPONENT;if(b===Bo)return I.DEPTH_STENCIL;if(b===$p)return P=o.get("EXT_sRGB"),P!==null?P.SRGB_ALPHA_EXT:null;if(b===co)return I.RED;if(b===Jl)return I.RED_INTEGER;if(b===mh)return I.RG;if(b===ul)return I.RG_INTEGER;if(b===gt)return I.RGBA_INTEGER;if(b===Wt||b===bn||b===ln||b===mn)if(E===or){if(P=o.get("WEBGL_compressed_texture_s3tc_srgb"),P===null)return null;if(b===Wt)return P.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(b===bn)return P.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(b===ln)return P.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(b===mn)return P.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(P=o.get("WEBGL_compressed_texture_s3tc"),P===null)return null;if(b===Wt)return P.COMPRESSED_RGB_S3TC_DXT1_EXT;if(b===bn)return P.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(b===ln)return P.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(b===mn)return P.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(b===Pi||b===Di||b===En||b===nr){if(P=o.get("WEBGL_compressed_texture_pvrtc"),P===null)return null;if(b===Pi)return P.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(b===Di)return P.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(b===En)return P.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(b===nr)return P.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(b===Hn)return P=o.get("WEBGL_compressed_texture_etc1"),P!==null?P.COMPRESSED_RGB_ETC1_WEBGL:null;if(b===Ni||b===Me){if(P=o.get("WEBGL_compressed_texture_etc"),P===null)return null;if(b===Ni)return E===or?P.COMPRESSED_SRGB8_ETC2:P.COMPRESSED_RGB8_ETC2;if(b===Me)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:P.COMPRESSED_RGBA8_ETC2_EAC}if(b===Ee||b===We||b===it||b===je||b===_t||b===qe||b===lt||b===Nt||b===cn||b===Xt||b===In||b===Ut||b===Zn||b===On){if(P=o.get("WEBGL_compressed_texture_astc"),P===null)return null;if(b===Ee)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:P.COMPRESSED_RGBA_ASTC_4x4_KHR;if(b===We)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:P.COMPRESSED_RGBA_ASTC_5x4_KHR;if(b===it)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:P.COMPRESSED_RGBA_ASTC_5x5_KHR;if(b===je)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:P.COMPRESSED_RGBA_ASTC_6x5_KHR;if(b===_t)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:P.COMPRESSED_RGBA_ASTC_6x6_KHR;if(b===qe)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:P.COMPRESSED_RGBA_ASTC_8x5_KHR;if(b===lt)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:P.COMPRESSED_RGBA_ASTC_8x6_KHR;if(b===Nt)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:P.COMPRESSED_RGBA_ASTC_8x8_KHR;if(b===cn)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:P.COMPRESSED_RGBA_ASTC_10x5_KHR;if(b===Xt)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:P.COMPRESSED_RGBA_ASTC_10x6_KHR;if(b===In)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:P.COMPRESSED_RGBA_ASTC_10x8_KHR;if(b===Ut)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:P.COMPRESSED_RGBA_ASTC_10x10_KHR;if(b===Zn)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:P.COMPRESSED_RGBA_ASTC_12x10_KHR;if(b===On)return E===or?P.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:P.COMPRESSED_RGBA_ASTC_12x12_KHR}if(b===Yt){if(P=o.get("EXT_texture_compression_bptc"),P===null)return null;if(b===Yt)return E===or?P.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:P.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(b===si||b===Tn||b===_i||b===Ii){if(P=o.get("EXT_texture_compression_rgtc"),P===null)return null;if(b===Yt)return P.COMPRESSED_RED_RGTC1_EXT;if(b===Tn)return P.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(b===_i)return P.COMPRESSED_RED_GREEN_RGTC2_EXT;if(b===Ii)return P.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return b===Jr?v?I.UNSIGNED_INT_24_8:(P=o.get("WEBGL_depth_texture"),P!==null?P.UNSIGNED_INT_24_8_WEBGL:null):I[b]!==void 0?I[b]:null}}}class Xu extends Go{constructor(o=[]){super(),this.isArrayCamera=!0,this.cameras=o}}class Uh extends Gr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const B0={type:"move"};class qm{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Uh,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Uh,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new At,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new At),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Uh,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new At,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new At),this._grip}dispatchEvent(o){return this._targetRay!==null&&this._targetRay.dispatchEvent(o),this._grip!==null&&this._grip.dispatchEvent(o),this._hand!==null&&this._hand.dispatchEvent(o),this}connect(o){if(o&&o.hand){const d=this._hand;if(d)for(const v of o.hand.values())this._getHandJoint(d,v)}return this.dispatchEvent({type:"connected",data:o}),this}disconnect(o){return this.dispatchEvent({type:"disconnected",data:o}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(o,d,v){let b=null,E=null,P=null;const O=this._targetRay,Q=this._grip,G=this._hand;if(o&&d.session.visibilityState!=="visible-blurred"){if(G&&o.hand){P=!0;for(const Re of o.hand.values()){const we=d.getJointPose(Re,v),Ce=this._getHandJoint(G,Re);we!==null&&(Ce.matrix.fromArray(we.transform.matrix),Ce.matrix.decompose(Ce.position,Ce.rotation,Ce.scale),Ce.matrixWorldNeedsUpdate=!0,Ce.jointRadius=we.radius),Ce.visible=we!==null}const te=G.joints["index-finger-tip"],ge=G.joints["thumb-tip"],fe=te.position.distanceTo(ge.position),_e=.02,xe=.005;G.inputState.pinching&&fe>_e+xe?(G.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:o.handedness,target:this})):!G.inputState.pinching&&fe<=_e-xe&&(G.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:o.handedness,target:this}))}else Q!==null&&o.gripSpace&&(E=d.getPose(o.gripSpace,v),E!==null&&(Q.matrix.fromArray(E.transform.matrix),Q.matrix.decompose(Q.position,Q.rotation,Q.scale),Q.matrixWorldNeedsUpdate=!0,E.linearVelocity?(Q.hasLinearVelocity=!0,Q.linearVelocity.copy(E.linearVelocity)):Q.hasLinearVelocity=!1,E.angularVelocity?(Q.hasAngularVelocity=!0,Q.angularVelocity.copy(E.angularVelocity)):Q.hasAngularVelocity=!1));O!==null&&(b=d.getPose(o.targetRaySpace,v),b===null&&E!==null&&(b=E),b!==null&&(O.matrix.fromArray(b.transform.matrix),O.matrix.decompose(O.position,O.rotation,O.scale),O.matrixWorldNeedsUpdate=!0,b.linearVelocity?(O.hasLinearVelocity=!0,O.linearVelocity.copy(b.linearVelocity)):O.hasLinearVelocity=!1,b.angularVelocity?(O.hasAngularVelocity=!0,O.angularVelocity.copy(b.angularVelocity)):O.hasAngularVelocity=!1,this.dispatchEvent(B0)))}return O!==null&&(O.visible=b!==null),Q!==null&&(Q.visible=E!==null),G!==null&&(G.visible=P!==null),this}_getHandJoint(o,d){if(o.joints[d.jointName]===void 0){const v=new Uh;v.matrixAutoUpdate=!1,v.visible=!1,o.joints[d.jointName]=v,o.add(v)}return o.joints[d.jointName]}}class z_ extends Vs{constructor(o,d,v,b,E,P,O,Q,G,te){if((te=te!==void 0?te:Zs)!==Zs&&te!==Bo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");v===void 0&&te===Zs&&(v=Nr),v===void 0&&te===Bo&&(v=Jr),super(null,b,E,P,O,Q,te,v,G),this.isDepthTexture=!0,this.image={width:o,height:d},this.magFilter=O!==void 0?O:Bt,this.minFilter=Q!==void 0?Q:Bt,this.flipY=!1,this.generateMipmaps=!1}}class _E extends Cc{constructor(o,d){super();const v=this;let b=null,E=1,P=null,O="local-floor",Q=1,G=null,te=null,ge=null,fe=null,_e=null,xe=null;const Re=d.getContextAttributes();let we=null,Ce=null;const De=[],ze=[],dt=new Set,rt=new Map,st=new Go;st.layers.enable(1),st.viewport=new Yr;const It=new Go;It.layers.enable(2),It.viewport=new Yr;const Kt=[st,It],Dt=new Xu;Dt.layers.enable(1),Dt.layers.enable(2);let an=null,Ot=null;function Mn(wn){const qn=ze.indexOf(wn.inputSource);if(qn===-1)return;const vi=De[qn];vi!==void 0&&(vi.update(wn.inputSource,wn.frame,G||P),vi.dispatchEvent({type:wn.type,data:wn.inputSource}))}function Sn(){b.removeEventListener("select",Mn),b.removeEventListener("selectstart",Mn),b.removeEventListener("selectend",Mn),b.removeEventListener("squeeze",Mn),b.removeEventListener("squeezestart",Mn),b.removeEventListener("squeezeend",Mn),b.removeEventListener("end",Sn),b.removeEventListener("inputsourceschange",ti);for(let wn=0;wn<De.length;wn++){const qn=ze[wn];qn!==null&&(ze[wn]=null,De[wn].disconnect(qn))}an=null,Ot=null,o.setRenderTarget(we),_e=null,fe=null,ge=null,b=null,Ce=null,Ai.stop(),v.isPresenting=!1,v.dispatchEvent({type:"sessionend"})}function ti(wn){for(let qn=0;qn<wn.removed.length;qn++){const vi=wn.removed[qn],ii=ze.indexOf(vi);ii>=0&&(ze[ii]=null,De[ii].disconnect(vi))}for(let qn=0;qn<wn.added.length;qn++){const vi=wn.added[qn];let ii=ze.indexOf(vi);if(ii===-1){for(let rr=0;rr<De.length;rr++){if(rr>=ze.length){ze.push(vi),ii=rr;break}if(ze[rr]===null){ze[rr]=vi,ii=rr;break}}if(ii===-1)break}const Si=De[ii];Si&&Si.connect(vi)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(wn){let qn=De[wn];return qn===void 0&&(qn=new qm,De[wn]=qn),qn.getTargetRaySpace()},this.getControllerGrip=function(wn){let qn=De[wn];return qn===void 0&&(qn=new qm,De[wn]=qn),qn.getGripSpace()},this.getHand=function(wn){let qn=De[wn];return qn===void 0&&(qn=new qm,De[wn]=qn),qn.getHandSpace()},this.setFramebufferScaleFactor=function(wn){E=wn,v.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(wn){O=wn,v.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return G||P},this.setReferenceSpace=function(wn){G=wn},this.getBaseLayer=function(){return fe!==null?fe:_e},this.getBinding=function(){return ge},this.getFrame=function(){return xe},this.getSession=function(){return b},this.setSession=async function(wn){if(b=wn,b!==null){if(we=o.getRenderTarget(),b.addEventListener("select",Mn),b.addEventListener("selectstart",Mn),b.addEventListener("selectend",Mn),b.addEventListener("squeeze",Mn),b.addEventListener("squeezestart",Mn),b.addEventListener("squeezeend",Mn),b.addEventListener("end",Sn),b.addEventListener("inputsourceschange",ti),Re.xrCompatible!==!0&&await d.makeXRCompatible(),b.renderState.layers===void 0||o.capabilities.isWebGL2===!1){const qn={antialias:b.renderState.layers!==void 0||Re.antialias,alpha:!0,depth:Re.depth,stencil:Re.stencil,framebufferScaleFactor:E};_e=new XRWebGLLayer(b,d,qn),b.updateRenderState({baseLayer:_e}),Ce=new vo(_e.framebufferWidth,_e.framebufferHeight,{format:xs,type:oi,colorSpace:o.outputColorSpace,stencilBuffer:Re.stencil})}else{let qn=null,vi=null,ii=null;Re.depth&&(ii=Re.stencil?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT24,qn=Re.stencil?Bo:Zs,vi=Re.stencil?Jr:Nr);const Si={colorFormat:d.RGBA8,depthFormat:ii,scaleFactor:E};ge=new XRWebGLBinding(b,d),fe=ge.createProjectionLayer(Si),b.updateRenderState({layers:[fe]}),Ce=new vo(fe.textureWidth,fe.textureHeight,{format:xs,type:oi,depthTexture:new z_(fe.textureWidth,fe.textureHeight,vi,void 0,void 0,void 0,void 0,void 0,void 0,qn),stencilBuffer:Re.stencil,colorSpace:o.outputColorSpace,samples:Re.antialias?4:0}),o.properties.get(Ce).__ignoreDepthValues=fe.ignoreDepthValues}Ce.isXRRenderTarget=!0,this.setFoveation(Q),G=null,P=await b.requestReferenceSpace(O),Ai.setContext(b),Ai.start(),v.isPresenting=!0,v.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(b!==null)return b.environmentBlendMode};const xi=new At,ni=new At;function Kn(wn,qn){qn===null?wn.matrixWorld.copy(wn.matrix):wn.matrixWorld.multiplyMatrices(qn.matrixWorld,wn.matrix),wn.matrixWorldInverse.copy(wn.matrixWorld).invert()}this.updateCamera=function(wn){if(b===null)return;Dt.near=It.near=st.near=wn.near,Dt.far=It.far=st.far=wn.far,an===Dt.near&&Ot===Dt.far||(b.updateRenderState({depthNear:Dt.near,depthFar:Dt.far}),an=Dt.near,Ot=Dt.far);const qn=wn.parent,vi=Dt.cameras;Kn(Dt,qn);for(let ii=0;ii<vi.length;ii++)Kn(vi[ii],qn);vi.length===2?function(ii,Si,rr){xi.setFromMatrixPosition(Si.matrixWorld),ni.setFromMatrixPosition(rr.matrixWorld);const Ct=xi.distanceTo(ni),ut=Si.projectionMatrix.elements,tn=rr.projectionMatrix.elements,Vt=ut[14]/(ut[10]-1),Rt=ut[14]/(ut[10]+1),Jt=(ut[9]+1)/ut[5],nt=(ut[9]-1)/ut[5],Ft=(ut[8]-1)/ut[0],kt=(tn[8]+1)/tn[0],Un=Vt*Ft,Nn=Vt*kt,Wn=Ct/(-Ft+kt),hi=Wn*-Ft;Si.matrixWorld.decompose(ii.position,ii.quaternion,ii.scale),ii.translateX(hi),ii.translateZ(Wn),ii.matrixWorld.compose(ii.position,ii.quaternion,ii.scale),ii.matrixWorldInverse.copy(ii.matrixWorld).invert();const Li=Vt+Wn,Fi=Rt+Wn,Ei=Un-hi,Ar=Nn+(Ct-hi),mr=Jt*Rt/Fi*Li,Wi=nt*Rt/Fi*Li;ii.projectionMatrix.makePerspective(Ei,Ar,mr,Wi,Li,Fi),ii.projectionMatrixInverse.copy(ii.projectionMatrix).invert()}(Dt,st,It):Dt.projectionMatrix.copy(st.projectionMatrix),function(ii,Si,rr){rr===null?ii.matrix.copy(Si.matrixWorld):(ii.matrix.copy(rr.matrixWorld),ii.matrix.invert(),ii.matrix.multiply(Si.matrixWorld)),ii.matrix.decompose(ii.position,ii.quaternion,ii.scale),ii.updateMatrixWorld(!0);const Ct=ii.children;for(let ut=0,tn=Ct.length;ut<tn;ut++)Ct[ut].updateMatrixWorld(!0);ii.projectionMatrix.copy(Si.projectionMatrix),ii.projectionMatrixInverse.copy(Si.projectionMatrixInverse),ii.isPerspectiveCamera&&(ii.fov=2*hl*Math.atan(1/ii.projectionMatrix.elements[5]),ii.zoom=1)}(wn,Dt,qn)},this.getCamera=function(){return Dt},this.getFoveation=function(){if(fe!==null||_e!==null)return Q},this.setFoveation=function(wn){Q=wn,fe!==null&&(fe.fixedFoveation=wn),_e!==null&&_e.fixedFoveation!==void 0&&(_e.fixedFoveation=wn)},this.getPlanes=function(){return dt};let gi=null;this.onPreAnimationFrameCallback=null;const Ai=new ff;Ai.setAnimationLoop(function(wn,qn){if(v.onPreAnimationFrameCallback&&v.onPreAnimationFrameCallback(wn,qn),te=qn.getViewerPose(G||P),xe=qn,te!==null){const vi=te.views;_e!==null&&(o.setRenderTargetFramebuffer(Ce,_e.framebuffer),o.setRenderTarget(Ce));let ii=!1;vi.length!==Dt.cameras.length&&(Dt.cameras.length=0,ii=!0);for(let Si=0;Si<vi.length;Si++){const rr=vi[Si];let Ct=null;if(_e!==null)Ct=_e.getViewport(rr);else{const tn=ge.getViewSubImage(fe,rr);Ct=tn.viewport,Si===0&&(o.setRenderTargetTextures(Ce,tn.colorTexture,fe.ignoreDepthValues?void 0:tn.depthStencilTexture),o.setRenderTarget(Ce))}let ut=Kt[Si];ut===void 0&&(ut=new Go,ut.layers.enable(Si),ut.viewport=new Yr,Kt[Si]=ut),ut.matrix.fromArray(rr.transform.matrix),ut.matrix.decompose(ut.position,ut.quaternion,ut.scale),ut.projectionMatrix.fromArray(rr.projectionMatrix),ut.projectionMatrixInverse.copy(ut.projectionMatrix).invert(),ut.viewport.set(Ct.x,Ct.y,Ct.width,Ct.height),Si===0&&(Dt.matrix.copy(ut.matrix),Dt.matrix.decompose(Dt.position,Dt.quaternion,Dt.scale)),ii===!0&&Dt.cameras.push(ut)}}for(let vi=0;vi<De.length;vi++){const ii=ze[vi],Si=De[vi];ii!==null&&Si!==void 0&&Si.update(ii,qn,G||P)}if(gi&&gi(wn,qn),qn.detectedPlanes){v.dispatchEvent({type:"planesdetected",data:qn.detectedPlanes});let vi=null;for(const ii of dt)qn.detectedPlanes.has(ii)||(vi===null&&(vi=[]),vi.push(ii));if(vi!==null)for(const ii of vi)dt.delete(ii),rt.delete(ii),v.dispatchEvent({type:"planeremoved",data:ii});for(const ii of qn.detectedPlanes)if(dt.has(ii)){const Si=rt.get(ii);ii.lastChangedTime>Si&&(rt.set(ii,ii.lastChangedTime),v.dispatchEvent({type:"planechanged",data:ii}))}else dt.add(ii),rt.set(ii,qn.lastChangedTime),v.dispatchEvent({type:"planeadded",data:ii})}xe=null}),this.setAnimationLoop=function(wn){gi=wn},this.dispose=function(){}}}function vE(I,o){function d(b,E){b.matrixAutoUpdate===!0&&b.updateMatrix(),E.value.copy(b.matrix)}function v(b,E){b.opacity.value=E.opacity,E.color&&b.diffuse.value.copy(E.color),E.emissive&&b.emissive.value.copy(E.emissive).multiplyScalar(E.emissiveIntensity),E.map&&(b.map.value=E.map,d(E.map,b.mapTransform)),E.alphaMap&&(b.alphaMap.value=E.alphaMap,d(E.alphaMap,b.alphaMapTransform)),E.bumpMap&&(b.bumpMap.value=E.bumpMap,d(E.bumpMap,b.bumpMapTransform),b.bumpScale.value=E.bumpScale,E.side===oe&&(b.bumpScale.value*=-1)),E.normalMap&&(b.normalMap.value=E.normalMap,d(E.normalMap,b.normalMapTransform),b.normalScale.value.copy(E.normalScale),E.side===oe&&b.normalScale.value.negate()),E.displacementMap&&(b.displacementMap.value=E.displacementMap,d(E.displacementMap,b.displacementMapTransform),b.displacementScale.value=E.displacementScale,b.displacementBias.value=E.displacementBias),E.emissiveMap&&(b.emissiveMap.value=E.emissiveMap,d(E.emissiveMap,b.emissiveMapTransform)),E.specularMap&&(b.specularMap.value=E.specularMap,d(E.specularMap,b.specularMapTransform)),E.alphaTest>0&&(b.alphaTest.value=E.alphaTest);const P=o.get(E).envMap;if(P){b.envMap.value=P;const O=o.get(E).environment||P;b.envMapRotation.value=O?O.rotation:0,b.flipEnvMap.value=P.isCubeTexture&&P.isRenderTargetTexture===!1?-1:1,b.reflectivity.value=E.reflectivity,b.ior.value=E.ior,b.refractionRatio.value=E.refractionRatio}if(E.lightMap){b.lightMap.value=E.lightMap;const O=I.useLegacyLights===!0?Math.PI:1;b.lightMapIntensity.value=E.lightMapIntensity*O,d(E.lightMap,b.lightMapTransform)}E.aoMap&&(b.aoMap.value=E.aoMap,b.aoMapIntensity.value=E.aoMapIntensity,d(E.aoMap,b.aoMapTransform))}return{refreshFogUniforms:function(b,E){E.color.getRGB(b.fogColor.value,_0(I)),E.isFog?(b.fogNear.value=E.near,b.fogFar.value=E.far):E.isFogExp2&&(b.fogDensity.value=E.density)},refreshMaterialUniforms:function(b,E,P,O,Q){E.isMeshBasicMaterial||E.isMeshLambertMaterial?v(b,E):E.isMeshToonMaterial?(v(b,E),function(G,te){te.gradientMap&&(G.gradientMap.value=te.gradientMap)}(b,E)):E.isMeshPhongMaterial?(v(b,E),function(G,te){G.specular.value.copy(te.specular),G.shininess.value=Math.max(te.shininess,1e-4)}(b,E)):E.isMeshStandardMaterial?(v(b,E),function(G,te){G.metalness.value=te.metalness,te.metalnessMap&&(G.metalnessMap.value=te.metalnessMap,d(te.metalnessMap,G.metalnessMapTransform)),G.roughness.value=te.roughness,te.roughnessMap&&(G.roughnessMap.value=te.roughnessMap,d(te.roughnessMap,G.roughnessMapTransform)),o.get(te).envMap&&(G.envMapIntensity.value=te.envMapIntensity)}(b,E),E.isMeshPhysicalMaterial&&function(G,te,ge){G.ior.value=te.ior,te.sheen>0&&(G.sheenColor.value.copy(te.sheenColor).multiplyScalar(te.sheen),G.sheenRoughness.value=te.sheenRoughness,te.sheenColorMap&&(G.sheenColorMap.value=te.sheenColorMap,d(te.sheenColorMap,G.sheenColorMapTransform)),te.sheenRoughnessMap&&(G.sheenRoughnessMap.value=te.sheenRoughnessMap,d(te.sheenRoughnessMap,G.sheenRoughnessMapTransform))),te.clearcoat>0&&(G.clearcoat.value=te.clearcoat,G.clearcoatRoughness.value=te.clearcoatRoughness,te.clearcoatMap&&(G.clearcoatMap.value=te.clearcoatMap,d(te.clearcoatMap,G.clearcoatMapTransform)),te.clearcoatRoughnessMap&&(G.clearcoatRoughnessMap.value=te.clearcoatRoughnessMap,d(te.clearcoatRoughnessMap,G.clearcoatRoughnessMapTransform)),te.clearcoatNormalMap&&(G.clearcoatNormalMap.value=te.clearcoatNormalMap,d(te.clearcoatNormalMap,G.clearcoatNormalMapTransform),G.clearcoatNormalScale.value.copy(te.clearcoatNormalScale),te.side===oe&&G.clearcoatNormalScale.value.negate())),te.iridescence>0&&(G.iridescence.value=te.iridescence,G.iridescenceIOR.value=te.iridescenceIOR,G.iridescenceThicknessMinimum.value=te.iridescenceThicknessRange[0],G.iridescenceThicknessMaximum.value=te.iridescenceThicknessRange[1],te.iridescenceMap&&(G.iridescenceMap.value=te.iridescenceMap,d(te.iridescenceMap,G.iridescenceMapTransform)),te.iridescenceThicknessMap&&(G.iridescenceThicknessMap.value=te.iridescenceThicknessMap,d(te.iridescenceThicknessMap,G.iridescenceThicknessMapTransform))),te.transmission>0&&(G.transmission.value=te.transmission,G.transmissionSamplerMap.value=ge.texture,G.transmissionSamplerSize.value.set(ge.width,ge.height),te.transmissionMap&&(G.transmissionMap.value=te.transmissionMap,d(te.transmissionMap,G.transmissionMapTransform)),G.thickness.value=te.thickness,te.thicknessMap&&(G.thicknessMap.value=te.thicknessMap,d(te.thicknessMap,G.thicknessMapTransform)),G.attenuationDistance.value=te.attenuationDistance,G.attenuationColor.value.copy(te.attenuationColor)),G.specularIntensity.value=te.specularIntensity,G.specularColor.value.copy(te.specularColor),te.specularColorMap&&(G.specularColorMap.value=te.specularColorMap,d(te.specularColorMap,G.specularColorMapTransform)),te.specularIntensityMap&&(G.specularIntensityMap.value=te.specularIntensityMap,d(te.specularIntensityMap,G.specularIntensityMapTransform))}(b,E,Q)):E.isMeshMatcapMaterial?(v(b,E),function(G,te){te.matcap&&(G.matcap.value=te.matcap)}(b,E)):E.isMeshDepthMaterial?v(b,E):E.isMeshDistanceMaterial?(v(b,E),function(G,te){const ge=o.get(te).light;G.referencePosition.value.setFromMatrixPosition(ge.matrixWorld),G.nearDistance.value=ge.shadow.camera.near,G.farDistance.value=ge.shadow.camera.far}(b,E)):E.isMeshNormalMaterial?v(b,E):E.isLineBasicMaterial?(function(G,te){G.diffuse.value.copy(te.color),G.opacity.value=te.opacity,te.map&&(G.map.value=te.map,d(te.map,G.mapTransform))}(b,E),E.isLineDashedMaterial&&function(G,te){G.dashSize.value=te.dashSize,G.totalSize.value=te.dashSize+te.gapSize,G.scale.value=te.scale}(b,E)):E.isPointsMaterial?function(G,te,ge,fe){G.diffuse.value.copy(te.color),G.opacity.value=te.opacity,G.size.value=te.size*ge,G.scale.value=.5*fe,te.map&&(G.map.value=te.map,d(te.map,G.uvTransform)),te.alphaMap&&(G.alphaMap.value=te.alphaMap),te.alphaTest>0&&(G.alphaTest.value=te.alphaTest)}(b,E,P,O):E.isSpriteMaterial?function(G,te){G.diffuse.value.copy(te.color),G.opacity.value=te.opacity,G.rotation.value=te.rotation,te.map&&(G.map.value=te.map,d(te.map,G.mapTransform)),te.alphaMap&&(G.alphaMap.value=te.alphaMap),te.alphaTest>0&&(G.alphaTest.value=te.alphaTest)}(b,E):E.isShadowMaterial?(b.color.value.copy(E.color),b.opacity.value=E.opacity):E.isShaderMaterial&&(E.transmission!==void 0&&(b.transmission&&(b.transmission.value=E.transmission),b.transmissionSamplerMap&&Q&&(b.transmissionSamplerMap.value=Q?Q.texture:null),b.transmissionSamplerSize&&Q&&b.transmissionSamplerSize.value.set(Q.width,Q.height)),E.uniformsNeedUpdate=!1)}}}function yE(I,o,d,v){let b={},E={},P=[];const O=d.isWebGL2?I.getParameter(I.MAX_UNIFORM_BUFFER_BINDINGS):0;function Q(ge,fe,_e){const xe=ge.value;if(_e[fe]===void 0){if(typeof xe=="number")_e[fe]=xe;else{const Re=Array.isArray(xe)?xe:[xe],we=[];for(let Ce=0;Ce<Re.length;Ce++)we.push(Re[Ce].clone());_e[fe]=we}return!0}if(typeof xe=="number"){if(_e[fe]!==xe)return _e[fe]=xe,!0}else{const Re=Array.isArray(_e[fe])?_e[fe]:[_e[fe]],we=Array.isArray(xe)?xe:[xe];for(let Ce=0;Ce<Re.length;Ce++){const De=Re[Ce];if(De.equals(we[Ce])===!1)return De.copy(we[Ce]),!0}}return!1}function G(ge){const fe={boundary:0,storage:0};return typeof ge=="number"?(fe.boundary=4,fe.storage=4):ge.isVector2?(fe.boundary=8,fe.storage=8):ge.isVector3||ge.isColor?(fe.boundary=16,fe.storage=12):ge.isVector4?(fe.boundary=16,fe.storage=16):ge.isMatrix3?(fe.boundary=48,fe.storage=48):ge.isMatrix4?(fe.boundary=64,fe.storage=64):ge.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",ge),fe}function te(ge){const fe=ge.target;fe.removeEventListener("dispose",te);const _e=P.indexOf(fe.__bindingPointIndex);P.splice(_e,1),I.deleteBuffer(b[fe.id]),delete b[fe.id],delete E[fe.id]}return{bind:function(ge,fe){const _e=fe.program;v.uniformBlockBinding(ge,_e)},update:function(ge,fe){let _e=b[ge.id];_e===void 0&&(function(we){const Ce=we.uniforms;let De=0,ze=0;for(let dt=0,rt=Ce.length;dt<rt;dt++){const st=Ce[dt],It={boundary:0,storage:0},Kt=Array.isArray(st.value)?st.value:[st.value];for(let Dt=0,an=Kt.length;Dt<an;Dt++){const Ot=G(Kt[Dt]);It.boundary+=Ot.boundary,It.storage+=Ot.storage}st.__data=new Float32Array(It.storage/Float32Array.BYTES_PER_ELEMENT),st.__offset=De,dt>0&&(ze=De%16,ze!==0&&16-ze-It.boundary<0&&(De+=16-ze,st.__offset=De)),De+=It.storage}ze=De%16,ze>0&&(De+=16-ze),we.__size=De,we.__cache={}}(ge),_e=function(we){const Ce=function(){for(let rt=0;rt<O;rt++)if(P.indexOf(rt)===-1)return P.push(rt),rt;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();we.__bindingPointIndex=Ce;const De=I.createBuffer(),ze=we.__size,dt=we.usage;return I.bindBuffer(I.UNIFORM_BUFFER,De),I.bufferData(I.UNIFORM_BUFFER,ze,dt),I.bindBuffer(I.UNIFORM_BUFFER,null),I.bindBufferBase(I.UNIFORM_BUFFER,Ce,De),De}(ge),b[ge.id]=_e,ge.addEventListener("dispose",te));const xe=fe.program;v.updateUBOMapping(ge,xe);const Re=o.render.frame;E[ge.id]!==Re&&(function(we){const Ce=b[we.id],De=we.uniforms,ze=we.__cache;I.bindBuffer(I.UNIFORM_BUFFER,Ce);for(let dt=0,rt=De.length;dt<rt;dt++){const st=De[dt];if(Q(st,dt,ze)===!0){const It=st.__offset,Kt=Array.isArray(st.value)?st.value:[st.value];let Dt=0;for(let an=0;an<Kt.length;an++){const Ot=Kt[an],Mn=G(Ot);typeof Ot=="number"?(st.__data[0]=Ot,I.bufferSubData(I.UNIFORM_BUFFER,It+Dt,st.__data)):Ot.isMatrix3?(st.__data[0]=Ot.elements[0],st.__data[1]=Ot.elements[1],st.__data[2]=Ot.elements[2],st.__data[3]=Ot.elements[0],st.__data[4]=Ot.elements[3],st.__data[5]=Ot.elements[4],st.__data[6]=Ot.elements[5],st.__data[7]=Ot.elements[0],st.__data[8]=Ot.elements[6],st.__data[9]=Ot.elements[7],st.__data[10]=Ot.elements[8],st.__data[11]=Ot.elements[0]):(Ot.toArray(st.__data,Dt),Dt+=Mn.storage/Float32Array.BYTES_PER_ELEMENT)}I.bufferSubData(I.UNIFORM_BUFFER,It,st.__data)}}I.bindBuffer(I.UNIFORM_BUFFER,null)}(ge),E[ge.id]=Re)},dispose:function(){for(const ge in b)I.deleteBuffer(b[ge]);P=[],b={},E={}}}}function AE(){const I=xh("canvas");return I.style.display="block",I}class O0{constructor(o={}){const{canvas:d=AE(),context:v=null,depth:b=!0,stencil:E=!0,alpha:P=!1,antialias:O=!1,premultipliedAlpha:Q=!0,preserveDrawingBuffer:G=!1,powerPreference:te="default",failIfMajorPerformanceCaveat:ge=!1}=o;let fe;this.isWebGLRenderer=!0,fe=v!==null?v.getContextAttributes().alpha:P;let _e=null,xe=null;const Re=[],we=[];this.domElement=d,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=or,this.useLegacyLights=!0,this.toneMapping=jt,this.toneMappingExposure=1,this.userData={};const Ce=this;let De=!1,ze=0,dt=0,rt=null,st=-1,It=null;const Kt=new Yr,Dt=new Yr;let an=null,Ot=d.width,Mn=d.height,Sn=1,ti=null,xi=null;const ni=new Yr(0,0,Ot,Mn),Kn=new Yr(0,0,Ot,Mn);let gi=!1;const Ai=new T_;let wn=!1,qn=!1,vi=null;const ii=new Sr,Si=new At,rr={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ct(){return rt===null?Sn:1}let ut,tn,Vt,Rt,Jt,nt,Ft,kt,Un,Nn,Wn,hi,Li,Fi,Ei,Ar,mr,Wi,cs,va,Lr,Zr,hs,Mu,Pn=v;function qh(Tt,Rn){for(let Qn=0;Qn<Tt.length;Qn++){const Xn=Tt[Qn],ci=d.getContext(Xn,Rn);if(ci!==null)return ci}return null}try{const Tt={alpha:!0,depth:b,stencil:E,antialias:O,premultipliedAlpha:Q,preserveDrawingBuffer:G,powerPreference:te,failIfMajorPerformanceCaveat:ge};if("setAttribute"in d&&d.setAttribute("data-engine",`three.js r${m}`),d.addEventListener("webglcontextlost",Ig,!1),d.addEventListener("webglcontextrestored",Zf,!1),d.addEventListener("webglcontextcreationerror",Cy,!1),Pn===null){const Rn=["webgl2","webgl","experimental-webgl"];if(Ce.isWebGL1Renderer===!0&&Rn.shift(),Pn=qh(Rn,Tt),Pn===null)throw qh(Rn)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Pn.getShaderPrecisionFormat===void 0&&(Pn.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Tt){throw console.error("THREE.WebGLRenderer: "+Tt.message),Tt}function Rg(){ut=new Im(Pn),tn=new mf(Pn,ut,o),ut.init(tn),Zr=new vb(Pn,ut,tn),Vt=new Xm(Pn,ut,tn),Rt=new D_(Pn),Jt=new D0,nt=new L0(Pn,ut,Vt,Jt,tn,Zr,Rt),Ft=new M_(Ce),kt=new gf(Ce),Un=new b0(Pn,tn),hs=new kd(Pn,ut,Un,tn),Nn=new Pm(Pn,Un,Rt,hs),Wn=new QA(Pn,Nn,Un,Rt),cs=new Dm(Pn,tn,nt),Ar=new Bl(Jt),hi=new Kr(Ce,Ft,kt,ut,tn,hs,Ar),Li=new vE(Ce,Jt),Fi=new gb,Ei=new Wm(ut,tn),Wi=new GA(Ce,Ft,kt,Vt,Wn,fe,Q),mr=new Nl(Ce,Wn,tn),Mu=new yE(Pn,Rt,tn,Vt),va=new x0(Pn,ut,Rt,tn),Lr=new WA(Pn,ut,Rt,tn),Rt.programs=hi.programs,Ce.capabilities=tn,Ce.extensions=ut,Ce.properties=Jt,Ce.renderLists=Fi,Ce.shadowMap=mr,Ce.state=Vt,Ce.info=Rt,Ce.background=Wi,Ce.cubeuvmaps=kt}Rg();const za=new _E(Ce,Pn);function Ig(Tt){Tt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),De=!0,Ce.onContextLost(Tt)}function Zf(){console.log("THREE.WebGLRenderer: Context Restored."),De=!1;const Tt=Rt.autoReset,Rn=mr.enabled,Qn=mr.autoUpdate,Xn=mr.needsUpdate,ci=mr.type;Rg(),Rt.autoReset=Tt,mr.enabled=Rn,mr.autoUpdate=Qn,mr.needsUpdate=Xn,mr.type=ci,Ce.onContextRestore(),console.log("restored")}function Cy(Tt){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Tt.statusMessage),Ce.onContextCreationError(Tt)}function Ry(Tt){const Rn=Tt.target;Rn.removeEventListener("dispose",Ry),function(Qn){(function(Xn){const ci=Jt.get(Xn).programs;ci!==void 0&&(ci.forEach(function(Qi){hi.releaseProgram(Qi)}),Xn.isShaderMaterial&&hi.releaseShaderCache(Xn))})(Qn),Jt.remove(Qn)}(Rn)}this.xr=za,this.getContext=function(){return Pn},this.getContextAttributes=function(){return Pn.getContextAttributes()},this.forceContextLoss=function(){const Tt=ut.get("WEBGL_lose_context");Tt&&Tt.loseContext()},this.forceContextRestore=function(){const Tt=ut.get("WEBGL_lose_context");Tt&&Tt.restoreContext()},this.getPixelRatio=function(){return Sn},this.setPixelRatio=function(Tt){Tt!==void 0&&(Sn=Tt,this.setSize(Ot,Mn,!1))},this.getSize=function(Tt){return Tt.set(Ot,Mn)},this.setSize=function(Tt,Rn,Qn=!0){za.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Ot=Tt,Mn=Rn,d.width=Math.floor(Tt*Sn),d.height=Math.floor(Rn*Sn),Qn===!0&&(d.style.width=Tt+"px",d.style.height=Rn+"px"),this.setViewport(0,0,Tt,Rn))},this.getDrawingBufferSize=function(Tt){return Tt.set(Ot*Sn,Mn*Sn).floor()},this.setDrawingBufferSize=function(Tt,Rn,Qn){Ot=Tt,Mn=Rn,Sn=Qn,d.width=Math.floor(Tt*Qn),d.height=Math.floor(Rn*Qn),this.setViewport(0,0,Tt,Rn)},this.getCurrentViewport=function(Tt){return Tt.copy(Kt)},this.getViewport=function(Tt){return Tt.copy(ni)},this.setViewport=function(Tt,Rn,Qn,Xn){Tt.isVector4?ni.set(Tt.x,Tt.y,Tt.z,Tt.w):ni.set(Tt,Rn,Qn,Xn),Vt.viewport(Kt.copy(ni).multiplyScalar(Sn).floor())},this.getScissor=function(Tt){return Tt.copy(Kn)},this.setScissor=function(Tt,Rn,Qn,Xn){Tt.isVector4?Kn.set(Tt.x,Tt.y,Tt.z,Tt.w):Kn.set(Tt,Rn,Qn,Xn),Vt.scissor(Dt.copy(Kn).multiplyScalar(Sn).floor())},this.getScissorTest=function(){return gi},this.setScissorTest=function(Tt){Vt.setScissorTest(gi=Tt)},this.setOpaqueSort=function(Tt){ti=Tt},this.setTransparentSort=function(Tt){xi=Tt},this.getClearColor=function(Tt){return Tt.copy(Wi.getClearColor())},this.setClearColor=function(){Wi.setClearColor.apply(Wi,arguments)},this.getClearAlpha=function(){return Wi.getClearAlpha()},this.setClearAlpha=function(){Wi.setClearAlpha.apply(Wi,arguments)},this.clear=function(Tt=!0,Rn=!0,Qn=!0){let Xn=0;Tt&&(Xn|=Pn.COLOR_BUFFER_BIT),Rn&&(Xn|=Pn.DEPTH_BUFFER_BIT),Qn&&(Xn|=Pn.STENCIL_BUFFER_BIT),Pn.clear(Xn)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){d.removeEventListener("webglcontextlost",Ig,!1),d.removeEventListener("webglcontextrestored",Zf,!1),d.removeEventListener("webglcontextcreationerror",Cy,!1),Fi.dispose(),Ei.dispose(),Jt.dispose(),Ft.dispose(),kt.dispose(),Wn.dispose(),hs.dispose(),Mu.dispose(),hi.dispose(),za.dispose(),za.removeEventListener("sessionstart",Iy),za.removeEventListener("sessionend",Py),vi&&(vi.dispose(),vi=null),Ap.stop()},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{},this.renderBufferDirect=function(Tt,Rn,Qn,Xn,ci,Qi){Rn===null&&(Rn=rr);const os=ci.isMesh&&ci.matrixWorld.determinant()<0,gr=function(Ao,Cu,qs,Tr,Ys){Cu.isScene!==!0&&(Cu=rr),nt.resetTextureUnits();const Cv=Cu.fog,ex=Tr.isMeshStandardMaterial?Cu.environment:null,tx=rt===null?Ce.outputColorSpace:rt.isXRRenderTarget===!0||rt.texture.colorSpace&&rt.texture.colorSpace!==or?rt.texture.colorSpace:ws,Pg=(Tr.isMeshStandardMaterial?kt:Ft).get(Tr.envMap||ex),nx=Tr.vertexColors===!0&&!!qs.attributes.color&&qs.attributes.color.itemSize===4,ix=!!Tr.normalMap&&!!qs.attributes.tangent,KE=!!qs.morphAttributes.position,rx=!!qs.morphAttributes.normal,$E=!!qs.morphAttributes.color,sx=Tr.toneMapped?Ce.toneMapping:jt,By=qs.morphAttributes.position||qs.morphAttributes.normal||qs.morphAttributes.color,wp=By!==void 0?By.length:0,Ts=Jt.get(Tr),Oy=xe.state.lights;if(wn===!0&&(qn===!0||Ao!==It)){const ya=Ao===It&&Tr.id===st;Ar.setState(Tr,Ao,ya)}let qc=!1;Tr.version===Ts.__version?Ts.needsLights&&Ts.lightsStateVersion!==Oy.state.version||Ts.outputColorSpace!==tx||Ys.isInstancedMesh&&Ts.instancing===!1?qc=!0:Ys.isInstancedMesh||Ts.instancing!==!0?Ys.isSkinnedMesh&&Ts.skinning===!1?qc=!0:Ys.isSkinnedMesh||Ts.skinning!==!0?Ts.envMap!==Pg||Tr.fog===!0&&Ts.fog!==Cv?qc=!0:Ts.numClippingPlanes===void 0||Ts.numClippingPlanes===Ar.numPlanes&&Ts.numIntersection===Ar.numIntersection?(Ts.vertexAlphas!==nx||Ts.vertexTangents!==ix||Ts.morphTargets!==KE||Ts.morphNormals!==rx||Ts.morphColors!==$E||Ts.toneMapping!==sx||tn.isWebGL2===!0&&Ts.morphTargetsCount!==wp)&&(qc=!0):qc=!0:qc=!0:qc=!0:(qc=!0,Ts.__version=Tr.version);let Kh=Ts.currentProgram;qc===!0&&(Kh=xp(Tr,Cu,Ys));let Ny=!1,Yc=!1,Rv=!1;const Xo=Kh.getUniforms(),$h=Ts.uniforms;if(Vt.useProgram(Kh.program)&&(Ny=!0,Yc=!0,Rv=!0),Tr.id!==st&&(st=Tr.id,Yc=!0),Ny||It!==Ao){if(Xo.setValue(Pn,"projectionMatrix",Ao.projectionMatrix),tn.logarithmicDepthBuffer&&Xo.setValue(Pn,"logDepthBufFC",2/(Math.log(Ao.far+1)/Math.LN2)),It!==Ao&&(It=Ao,Yc=!0,Rv=!0),Tr.isShaderMaterial||Tr.isMeshPhongMaterial||Tr.isMeshToonMaterial||Tr.isMeshStandardMaterial||Tr.envMap){const ya=Xo.map.cameraPosition;ya!==void 0&&ya.setValue(Pn,Si.setFromMatrixPosition(Ao.matrixWorld))}(Tr.isMeshPhongMaterial||Tr.isMeshToonMaterial||Tr.isMeshLambertMaterial||Tr.isMeshBasicMaterial||Tr.isMeshStandardMaterial||Tr.isShaderMaterial)&&Xo.setValue(Pn,"isOrthographic",Ao.isOrthographicCamera===!0),(Tr.isMeshPhongMaterial||Tr.isMeshToonMaterial||Tr.isMeshLambertMaterial||Tr.isMeshBasicMaterial||Tr.isMeshStandardMaterial||Tr.isShaderMaterial||Tr.isShadowMaterial||Ys.isSkinnedMesh)&&Xo.setValue(Pn,"viewMatrix",Ao.matrixWorldInverse)}if(Ys.isSkinnedMesh){Xo.setOptional(Pn,Ys,"bindMatrix"),Xo.setOptional(Pn,Ys,"bindMatrixInverse");const ya=Ys.skeleton;ya&&(tn.floatVertexTextures?(ya.boneTexture===null&&ya.computeBoneTexture(),Xo.setValue(Pn,"boneTexture",ya.boneTexture,nt),Xo.setValue(Pn,"boneTextureSize",ya.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Jh=qs.morphAttributes;var Gl,Hl;(Jh.position!==void 0||Jh.normal!==void 0||Jh.color!==void 0&&tn.isWebGL2===!0)&&cs.update(Ys,qs,Kh),(Yc||Ts.receiveShadow!==Ys.receiveShadow)&&(Ts.receiveShadow=Ys.receiveShadow,Xo.setValue(Pn,"receiveShadow",Ys.receiveShadow)),Tr.isMeshGouraudMaterial&&Tr.envMap!==null&&($h.envMap.value=Pg,$h.flipEnvMap.value=Pg.isCubeTexture&&Pg.isRenderTargetTexture===!1?-1:1),Yc&&(Xo.setValue(Pn,"toneMappingExposure",Ce.toneMappingExposure),Ts.needsLights&&(Hl=Rv,(Gl=$h).ambientLightColor.needsUpdate=Hl,Gl.lightProbe.needsUpdate=Hl,Gl.directionalLights.needsUpdate=Hl,Gl.directionalLightShadows.needsUpdate=Hl,Gl.pointLights.needsUpdate=Hl,Gl.pointLightShadows.needsUpdate=Hl,Gl.spotLights.needsUpdate=Hl,Gl.spotLightShadows.needsUpdate=Hl,Gl.rectAreaLights.needsUpdate=Hl,Gl.hemisphereLights.needsUpdate=Hl),Cv&&Tr.fog===!0&&Li.refreshFogUniforms($h,Cv),Li.refreshMaterialUniforms($h,Tr,Sn,Mn,Ce.userData.transmissionRenderTarget||vi),N_.upload(Pn,Ts.uniformsList,$h,nt)),Tr.isShaderMaterial&&Tr.uniformsNeedUpdate===!0&&(N_.upload(Pn,Ts.uniformsList,$h,nt),Tr.uniformsNeedUpdate=!1),Tr.isSpriteMaterial&&Xo.setValue(Pn,"center",Ys.center),Xo.setValue(Pn,"modelViewMatrix",Ys.modelViewMatrix),Xo.setValue(Pn,"normalMatrix",Ys.normalMatrix),Xo.setValue(Pn,"modelMatrix",Ys.matrixWorld);const ky=Tr.extraUniformsToUpload;if(ky&&Object.entries(ky).forEach(([ya,em])=>Xo.setValue(Pn,ya,em.value,nt)),Tr.isShaderMaterial||Tr.isRawShaderMaterial){const ya=Tr.uniformsGroups;for(let em=0,Ru=ya.length;em<Ru;em++)if(tn.isWebGL2){const Uy=ya[em];Mu.update(Uy,Kh),Mu.bind(Uy,Kh)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Kh}(Tt,Rn,Qn,Xn,ci);Vt.setMaterial(Xn,os);let Qr=Qn.index,vs=1;Xn.wireframe===!0&&(Qr=Nn.getWireframeAttribute(Qn),vs=2);const is=Qn.drawRange,$r=Qn.attributes.position;let Va=is.start*vs,il=(is.start+is.count)*vs;Qi!==null&&(Va=Math.max(Va,Qi.start*vs),il=Math.min(il,(Qi.start+Qi.count)*vs)),Qr!==null?(Va=Math.max(Va,0),il=Math.min(il,Qr.count)):$r!=null&&(Va=Math.max(Va,0),il=Math.min(il,$r.count));const fo=il-Va;if(fo<0||fo===1/0)return;let Yh;hs.setup(ci,Xn,gr,Qn,Qr);let Xs=va;if(Qr!==null&&(Yh=Un.get(Qr),Xs=Lr,Xs.setIndex(Yh)),ci.isMesh)Xn.wireframe===!0?(Vt.setLineWidth(Xn.wireframeLinewidth*Ct()),Xs.setMode(Pn.LINES)):Xs.setMode(Pn.TRIANGLES);else if(ci.isLine){let Ao=Xn.linewidth;Ao===void 0&&(Ao=1),Vt.setLineWidth(Ao*Ct()),ci.isLineSegments?Xs.setMode(Pn.LINES):ci.isLineLoop?Xs.setMode(Pn.LINE_LOOP):Xs.setMode(Pn.LINE_STRIP)}else ci.isPoints?Xs.setMode(Pn.POINTS):ci.isSprite&&Xs.setMode(Pn.TRIANGLES);if(ci.isInstancedMesh)Xs.renderInstances(Va,fo,ci.count);else if(Qn.isInstancedBufferGeometry){const Ao=Qn._maxInstanceCount!==void 0?Qn._maxInstanceCount:1/0,Cu=Math.min(Qn.instanceCount,Ao);Xs.renderInstances(Va,fo,Cu)}else Xs.render(Va,fo)},this.compile=function(Tt,Rn){function Qn(Xn,ci,Qi){Xn.transparent===!0&&Xn.side===ne&&Xn.forceSinglePass===!1?(Xn.side=oe,Xn.needsUpdate=!0,xp(Xn,ci,Qi),Xn.side=$,Xn.needsUpdate=!0,xp(Xn,ci,Qi),Xn.side=ne):xp(Xn,ci,Qi)}xe=Ei.get(Tt),xe.init(),we.push(xe),Tt.traverseVisible(function(Xn){Xn.isLight&&Xn.layers.test(Rn.layers)&&(xe.pushLight(Xn),Xn.castShadow&&xe.pushShadow(Xn))}),xe.setupLights(Ce.useLegacyLights),Tt.traverse(function(Xn){const ci=Xn.material;if(ci)if(Array.isArray(ci))for(let Qi=0;Qi<ci.length;Qi++)Qn(ci[Qi],Tt,Xn);else Qn(ci,Tt,Xn)}),we.pop(),xe=null};let Tv=null;function Iy(){Ap.stop()}function Py(){Ap.start()}const Ap=new ff;function Dy(Tt,Rn,Qn,Xn){if(Tt.visible===!1)return;if(Tt.layers.test(Rn.layers)){if(Tt.isGroup)Qn=Tt.renderOrder;else if(Tt.isLOD)Tt.autoUpdate===!0&&Tt.update(Rn);else if(Tt.isLight)xe.pushLight(Tt),Tt.castShadow&&xe.pushShadow(Tt);else if(Tt.isSprite){if(!Tt.frustumCulled||Ai.intersectsSprite(Tt)){Xn&&Si.setFromMatrixPosition(Tt.matrixWorld).applyMatrix4(ii);const Qi=Wn.update(Tt),os=Tt.material;os.visible&&_e.push(Tt,Qi,os,Qn,Si.z,null)}}else if((Tt.isMesh||Tt.isLine||Tt.isPoints)&&(!Tt.frustumCulled||Ai.intersectsObject(Tt))){Tt.isSkinnedMesh&&Tt.skeleton.frame!==Rt.render.frame&&(Tt.skeleton.update(),Tt.skeleton.frame=Rt.render.frame);const Qi=Wn.update(Tt),os=Tt.material;if(Xn&&(Qi.boundingSphere===null&&Qi.computeBoundingSphere(),Si.copy(Qi.boundingSphere.center).applyMatrix4(Tt.matrixWorld).applyMatrix4(ii)),Array.isArray(os)){const gr=Qi.groups;for(let Qr=0,vs=gr.length;Qr<vs;Qr++){const is=gr[Qr],$r=os[is.materialIndex];$r&&$r.visible&&_e.push(Tt,Qi,$r,Qn,Si.z,is)}}else os.visible&&_e.push(Tt,Qi,os,Qn,Si.z,null)}}const ci=Tt.children;for(let Qi=0,os=ci.length;Qi<os;Qi++)Dy(ci[Qi],Rn,Qn,Xn)}function Ly(Tt,Rn,Qn,Xn){const ci=Tt.opaque,Qi=Tt.transmissive,os=Tt.transparent;if(xe.setupLightsView(Qn),wn===!0&&Ar.setGlobalState(Ce.clippingPlanes,Qn),Ce.userData.transmissionRender===void 0&&Ce.userData.renderTransmissionPass!==!1&&Qi.length>0&&function(gr,Qr,vs,is){if(console.warn("three.js internal render transmission pass should not be called"),vi===null){const fo=tn.isWebGL2;vi=new vo(1024,1024,{generateMipmaps:!0,type:ut.has("EXT_color_buffer_half_float")?wr:oi,minFilter:Gi,samples:fo&&O===!0?4:0})}const $r=Ce.getRenderTarget();Ce.setRenderTarget(vi),Ce.clear();const Va=Ce.toneMapping;Ce.toneMapping=jt,bp(gr,vs,is),nt.updateMultisampleRenderTarget(vi),nt.updateRenderTargetMipmap(vi);let il=!1;for(let fo=0,Yh=Qr.length;fo<Yh;fo++){const Xs=Qr[fo],Ao=Xs.object,Cu=Xs.geometry,qs=Xs.material,Tr=Xs.group;if(qs.side===ne&&Ao.layers.test(is.layers)){const Ys=qs.side;qs.side=oe,qs.needsUpdate=!0,Zb(Ao,vs,is,Cu,qs,Tr),qs.side=Ys,qs.needsUpdate=!0,il=!0}}il===!0&&(nt.updateMultisampleRenderTarget(vi),nt.updateRenderTargetMipmap(vi)),Ce.setRenderTarget($r),Ce.toneMapping=Va}([...ci,...os],Qi,Rn,Qn),Xn&&Vt.viewport(Kt.copy(Xn)),Ce.userData.opaqueRender!==!1&&ci.length>0&&bp(ci,Rn,Qn),Ce.userData.transparentRender!==!1&&os.length>0&&bp(os,Rn,Qn),Ce.userData.transmissionRender!==!1&&Qi.length>0){vi||(vi=new vo(1,1));const gr=(Ce.userData.transmissionRenderTarget||vi).texture,Qr=tn.isWebGL2,vs=gr.generateMipmaps,is=gr.minFilter;Qr&&Ce.userData.blurTransmissionTarget&&Ce.userData.transmissionRenderTarget&&(gr.generateMipmaps=!0,gr.minFilter=Gi,gr.needsUpdate=!0,nt.updateMultisampleRenderTarget(Ce.userData.transmissionRenderTarget),nt.updateRenderTargetMipmap(Ce.userData.transmissionRenderTarget)),bp(Qi,Rn,Qn),Qr&&Ce.userData.blurTransmissionTarget&&Ce.userData.transmissionRenderTarget&&(gr.generateMipmaps=vs,gr.minFilter=is,gr.needsUpdate=!0,nt.updateMultisampleRenderTarget(Ce.userData.transmissionRenderTarget),nt.updateRenderTargetMipmap(Ce.userData.transmissionRenderTarget))}Vt.buffers.depth.setTest(!0),Vt.buffers.depth.setMask(!0),Vt.buffers.color.setMask(!0),Vt.setPolygonOffset(!1)}function bp(Tt,Rn,Qn){const Xn={...Ce.userData};Ce.userData.opaqueRender=void 0,Ce.userData.transparentRender=void 0,Ce.userData.transmissionRender=void 0,Ce.userData.backgroundRender=void 0;const ci=Rn.isScene===!0?Rn.overrideMaterial:null;for(let Qi=0,os=Tt.length;Qi<os;Qi++){const gr=Tt[Qi],Qr=gr.object,vs=gr.geometry,is=ci===null?gr.material:ci,$r=gr.group;Qr.layers.test(Qn.layers)&&Zb(Qr,Rn,Qn,vs,is,$r)}Object.assign(Ce.userData,Xn)}function Zb(Tt,Rn,Qn,Xn,ci,Qi){Tt.onBeforeRender(Ce,Rn,Qn,Xn,ci,Qi),Tt.modelViewMatrix.multiplyMatrices(Qn.matrixWorldInverse,Tt.matrixWorld),Tt.normalMatrix.getNormalMatrix(Tt.modelViewMatrix),ci.onBeforeRender(Ce,Rn,Qn,Xn,Tt,Qi),ci.transparent===!0&&ci.side===ne&&ci.forceSinglePass===!1?(ci.side=oe,ci.needsUpdate=!0,Ce.renderBufferDirect(Qn,Rn,Xn,ci,Tt,Qi),ci.side=$,ci.needsUpdate=!0,Ce.renderBufferDirect(Qn,Rn,Xn,ci,Tt,Qi),ci.side=ne):Ce.renderBufferDirect(Qn,Rn,Xn,ci,Tt,Qi),Tt.onAfterRender(Ce,Rn,Qn,Xn,ci,Qi),ci.onAfterRender(Ce,Rn,Qn,Xn,Tt,Qi)}function xp(Tt,Rn,Qn){Rn.isScene!==!0&&(Rn=rr);const Xn=Jt.get(Tt),ci=xe.state.lights,Qi=xe.state.shadowsArray,os=ci.state.version,gr=hi.getParameters(Tt,ci.state,Qi,Rn,Qn),Qr=hi.getProgramCacheKey(gr);let vs=Xn.programs;Xn.environment=Tt.isMeshStandardMaterial?Rn.environment:null,Xn.fog=Rn.fog,Xn.envMap=(Tt.isMeshStandardMaterial?kt:Ft).get(Tt.envMap||Xn.environment),vs===void 0&&(Tt.addEventListener("dispose",Ry),vs=new Map,Xn.programs=vs);let is=vs.get(Qr);if(is!==void 0){if(Xn.currentProgram===is&&Xn.lightsStateVersion===os)return Mv(Tt,gr),is}else gr.uniforms=hi.getUniforms(Tt),Tt.onBuild(Qn,gr,Ce),Tt.onBeforeCompile(gr,Ce),is=hi.acquireProgram(gr,Qr),vs.set(Qr,is),Xn.uniforms=gr.uniforms;const $r=Xn.uniforms;(Tt.isShaderMaterial||Tt.isRawShaderMaterial)&&Tt.clipping!==!0||($r.clippingPlanes=Ar.uniform),Mv(Tt,gr),Xn.needsLights=function(fo){return fo.isMeshLambertMaterial||fo.isMeshToonMaterial||fo.isMeshPhongMaterial||fo.isMeshStandardMaterial||fo.isShadowMaterial||fo.isShaderMaterial&&fo.lights===!0}(Tt),Xn.lightsStateVersion=os,Xn.needsLights&&($r.ambientLightColor.value=ci.state.ambient,$r.lightProbe.value=ci.state.probe,$r.directionalLights.value=ci.state.directional,$r.directionalLightShadows.value=ci.state.directionalShadow,$r.spotLights.value=ci.state.spot,$r.spotLightShadows.value=ci.state.spotShadow,$r.rectAreaLights.value=ci.state.rectArea,$r.ltc_1.value=ci.state.rectAreaLTC1,$r.ltc_2.value=ci.state.rectAreaLTC2,$r.pointLights.value=ci.state.point,$r.pointLightShadows.value=ci.state.pointShadow,$r.hemisphereLights.value=ci.state.hemi,$r.directionalShadowMap.value=ci.state.directionalShadowMap,$r.directionalShadowMatrix.value=ci.state.directionalShadowMatrix,$r.spotShadowMap.value=ci.state.spotShadowMap,$r.spotLightMatrix.value=ci.state.spotLightMatrix,$r.spotLightMap.value=ci.state.spotLightMap,$r.pointShadowMap.value=ci.state.pointShadowMap,$r.pointShadowMatrix.value=ci.state.pointShadowMatrix);const Va=is.getUniforms(),il=N_.seqWithValue(Va.seq,$r);return Xn.currentProgram=is,Xn.uniformsList=il,is}function Mv(Tt,Rn){const Qn=Jt.get(Tt);Qn.outputColorSpace=Rn.outputColorSpace,Qn.instancing=Rn.instancing,Qn.skinning=Rn.skinning,Qn.morphTargets=Rn.morphTargets,Qn.morphNormals=Rn.morphNormals,Qn.morphColors=Rn.morphColors,Qn.morphTargetsCount=Rn.morphTargetsCount,Qn.numClippingPlanes=Rn.numClippingPlanes,Qn.numIntersection=Rn.numClipIntersection,Qn.vertexAlphas=Rn.vertexAlphas,Qn.vertexTangents=Rn.vertexTangents,Qn.toneMapping=Rn.toneMapping}Ap.setAnimationLoop(function(Tt){Tv&&Tv(Tt)}),typeof self<"u"&&Ap.setContext(self),this.setAnimationLoop=function(Tt){Tv=Tt,za.setAnimationLoop(Tt),Tt===null?Ap.stop():Ap.start()},za.addEventListener("sessionstart",Iy),za.addEventListener("sessionend",Py),this.render=function(Tt,Rn){if(Rn===void 0||Rn.isCamera===!0){if(De!==!0){if(Tt.matrixWorldAutoUpdate===!0&&Tt.updateMatrixWorld(),Rn.parent===null&&Rn.matrixWorldAutoUpdate===!0&&Rn.updateMatrixWorld(),za.enabled===!0&&za.isPresenting===!0&&(za.cameraAutoUpdate===!0&&za.updateCamera(Rn),Rn=za.getCamera()),Tt.isScene===!0&&Tt.onBeforeRender(Ce,Tt,Rn,rt),xe=Ei.get(Tt,we.length),xe.init(),we.push(xe),ii.multiplyMatrices(Rn.projectionMatrix,Rn.matrixWorldInverse),Ai.setFromProjectionMatrix(ii),qn=this.localClippingEnabled,wn=Ar.init(this.clippingPlanes,qn),_e=Fi.get(Tt,Re.length),_e.init(),Re.push(_e),Dy(Tt,Rn,0,Ce.sortObjects),_e.finish(),Ce.sortObjects===!0&&_e.sort(ti,xi),Ce.userData.shadowMapRender!==!1){wn===!0&&Ar.beginShadows();const Qn=xe.state.shadowsArray;Qn.length>0&&mr.render(Qn,Tt,Rn),wn===!0&&Ar.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),Ce.userData.backgroundRender!==!1&&Wi.render(_e,Tt),Ce.userData.sceneRender!==!1)if(xe.setupLights(Ce.useLegacyLights),Rn.isArrayCamera){const Qn=Rn.cameras;for(let Xn=0,ci=Qn.length;Xn<ci;Xn++){const Qi=Qn[Xn];Ly(_e,Tt,Qi,Qi.viewport)}}else Ly(_e,Tt,Rn);rt!==null&&(nt.updateMultisampleRenderTarget(rt),nt.updateRenderTargetMipmap(rt)),Tt.isScene===!0&&Tt.onAfterRender(Ce,Tt,Rn),hs.resetDefaultState(),st=-1,It=null,we.pop(),xe=we.length>0?we[we.length-1]:null,Re.pop(),_e=Re.length>0?Re[Re.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return ze},this.getActiveMipmapLevel=function(){return dt},this.getRenderTarget=function(){return rt},this.setRenderTargetTextures=function(Tt,Rn,Qn){Jt.get(Tt.texture).__webglTexture=Rn,Jt.get(Tt.depthTexture).__webglTexture=Qn;const Xn=Jt.get(Tt);Xn.__hasExternalTextures=!0,Xn.__hasExternalTextures&&(Xn.__autoAllocateDepthBuffer=Qn===void 0,Xn.__autoAllocateDepthBuffer||ut.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Xn.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Tt,Rn){const Qn=Jt.get(Tt);Qn.__webglFramebuffer=Rn,Qn.__useDefaultFramebuffer=Rn===void 0},this.setRenderTarget=function(Tt,Rn=0,Qn=0){rt=Tt,ze=Rn,dt=Qn;let Xn=!0,ci=null,Qi=!1,os=!1;if(Tt){const gr=Jt.get(Tt);gr.__useDefaultFramebuffer!==void 0?(Vt.bindFramebuffer(Pn.FRAMEBUFFER,null),Xn=!1):gr.__webglFramebuffer===void 0?nt.setupRenderTarget(Tt):gr.__hasExternalTextures&&nt.rebindTextures(Tt,Jt.get(Tt.texture).__webglTexture,Jt.get(Tt.depthTexture).__webglTexture);const Qr=Tt.texture;(Qr.isData3DTexture||Qr.isDataArrayTexture||Qr.isCompressedArrayTexture)&&(os=!0);const vs=Jt.get(Tt).__webglFramebuffer;Tt.isWebGLCubeRenderTarget?(ci=vs[Rn],Qi=!0):ci=tn.isWebGL2&&Tt.samples>0&&nt.useMultisampledRTT(Tt)===!1?Jt.get(Tt).__webglMultisampledFramebuffer:vs,Kt.copy(Tt.viewport),Dt.copy(Tt.scissor),an=Tt.scissorTest}else Kt.copy(ni).multiplyScalar(Sn).floor(),Dt.copy(Kn).multiplyScalar(Sn).floor(),an=gi;if(Vt.bindFramebuffer(Pn.FRAMEBUFFER,ci)&&tn.drawBuffers&&Xn&&Vt.drawBuffers(Tt,ci),Vt.viewport(Kt),Vt.scissor(Dt),Vt.setScissorTest(an),Qi){const gr=Jt.get(Tt.texture);Pn.framebufferTexture2D(Pn.FRAMEBUFFER,Pn.COLOR_ATTACHMENT0,Pn.TEXTURE_CUBE_MAP_POSITIVE_X+Rn,gr.__webglTexture,Qn)}else if(os){const gr=Jt.get(Tt.texture),Qr=Rn||0;Pn.framebufferTextureLayer(Pn.FRAMEBUFFER,Pn.COLOR_ATTACHMENT0,gr.__webglTexture,Qn||0,Qr)}st=-1},this.readRenderTargetPixels=function(Tt,Rn,Qn,Xn,ci,Qi,os){if(!Tt||!Tt.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let gr=Jt.get(Tt).__webglFramebuffer;if(Tt.isWebGLCubeRenderTarget&&os!==void 0&&(gr=gr[os]),gr){Vt.bindFramebuffer(Pn.FRAMEBUFFER,gr);try{const Qr=Tt.texture,vs=Qr.format,is=Qr.type;if(vs!==xs&&Zr.convert(vs)!==Pn.getParameter(Pn.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const $r=is===wr&&(ut.has("EXT_color_buffer_half_float")||tn.isWebGL2&&ut.has("EXT_color_buffer_float"));if(!(is===oi||Zr.convert(is)===Pn.getParameter(Pn.IMPLEMENTATION_COLOR_READ_TYPE)||is===Pr&&(tn.isWebGL2||ut.has("OES_texture_float")||ut.has("WEBGL_color_buffer_float"))||$r))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Rn>=0&&Rn<=Tt.width-Xn&&Qn>=0&&Qn<=Tt.height-ci&&Pn.readPixels(Rn,Qn,Xn,ci,Zr.convert(vs),Zr.convert(is),Qi)}finally{const Qr=rt?Jt.get(rt).__webglFramebuffer:null;Vt.bindFramebuffer(Pn.FRAMEBUFFER,Qr)}}},this.copyFramebufferToTexture=function(Tt,Rn,Qn=0){const Xn=Math.pow(2,-Qn),ci=Math.floor(Rn.image.width*Xn),Qi=Math.floor(Rn.image.height*Xn);nt.setTexture2D(Rn,0),Pn.copyTexSubImage2D(Pn.TEXTURE_2D,Qn,0,0,Tt.x,Tt.y,ci,Qi),Vt.unbindTexture()},this.copyTextureToTexture=function(Tt,Rn,Qn,Xn=0){const ci=Rn.image.width,Qi=Rn.image.height,os=Zr.convert(Qn.format),gr=Zr.convert(Qn.type);nt.setTexture2D(Qn,0),Pn.pixelStorei(Pn.UNPACK_FLIP_Y_WEBGL,Qn.flipY),Pn.pixelStorei(Pn.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Qn.premultiplyAlpha),Pn.pixelStorei(Pn.UNPACK_ALIGNMENT,Qn.unpackAlignment),Rn.isDataTexture?Pn.texSubImage2D(Pn.TEXTURE_2D,Xn,Tt.x,Tt.y,ci,Qi,os,gr,Rn.image.data):Rn.isCompressedTexture?Pn.compressedTexSubImage2D(Pn.TEXTURE_2D,Xn,Tt.x,Tt.y,Rn.mipmaps[0].width,Rn.mipmaps[0].height,os,Rn.mipmaps[0].data):Pn.texSubImage2D(Pn.TEXTURE_2D,Xn,Tt.x,Tt.y,os,gr,Rn.image),Xn===0&&Qn.generateMipmaps&&Pn.generateMipmap(Pn.TEXTURE_2D),Vt.unbindTexture()},this.copyTextureToTexture3D=function(Tt,Rn,Qn,Xn,ci=0){if(Ce.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Qi=Tt.max.x-Tt.min.x+1,os=Tt.max.y-Tt.min.y+1,gr=Tt.max.z-Tt.min.z+1,Qr=Zr.convert(Xn.format),vs=Zr.convert(Xn.type);let is;if(Xn.isData3DTexture)nt.setTexture3D(Xn,0),is=Pn.TEXTURE_3D;else{if(!Xn.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");nt.setTexture2DArray(Xn,0),is=Pn.TEXTURE_2D_ARRAY}Pn.pixelStorei(Pn.UNPACK_FLIP_Y_WEBGL,Xn.flipY),Pn.pixelStorei(Pn.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Xn.premultiplyAlpha),Pn.pixelStorei(Pn.UNPACK_ALIGNMENT,Xn.unpackAlignment);const $r=Pn.getParameter(Pn.UNPACK_ROW_LENGTH),Va=Pn.getParameter(Pn.UNPACK_IMAGE_HEIGHT),il=Pn.getParameter(Pn.UNPACK_SKIP_PIXELS),fo=Pn.getParameter(Pn.UNPACK_SKIP_ROWS),Yh=Pn.getParameter(Pn.UNPACK_SKIP_IMAGES),Xs=Qn.isCompressedTexture?Qn.mipmaps[0]:Qn.image;Pn.pixelStorei(Pn.UNPACK_ROW_LENGTH,Xs.width),Pn.pixelStorei(Pn.UNPACK_IMAGE_HEIGHT,Xs.height),Pn.pixelStorei(Pn.UNPACK_SKIP_PIXELS,Tt.min.x),Pn.pixelStorei(Pn.UNPACK_SKIP_ROWS,Tt.min.y),Pn.pixelStorei(Pn.UNPACK_SKIP_IMAGES,Tt.min.z),Qn.isDataTexture||Qn.isData3DTexture?Pn.texSubImage3D(is,ci,Rn.x,Rn.y,Rn.z,Qi,os,gr,Qr,vs,Xs.data):Qn.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Pn.compressedTexSubImage3D(is,ci,Rn.x,Rn.y,Rn.z,Qi,os,gr,Qr,Xs.data)):Pn.texSubImage3D(is,ci,Rn.x,Rn.y,Rn.z,Qi,os,gr,Qr,vs,Xs),Pn.pixelStorei(Pn.UNPACK_ROW_LENGTH,$r),Pn.pixelStorei(Pn.UNPACK_IMAGE_HEIGHT,Va),Pn.pixelStorei(Pn.UNPACK_SKIP_PIXELS,il),Pn.pixelStorei(Pn.UNPACK_SKIP_ROWS,fo),Pn.pixelStorei(Pn.UNPACK_SKIP_IMAGES,Yh),ci===0&&Xn.generateMipmaps&&Pn.generateMipmap(is),Vt.unbindTexture()},this.initTexture=function(Tt){Tt.isCubeTexture?nt.setTextureCube(Tt,0):Tt.isData3DTexture?nt.setTexture3D(Tt,0):Tt.isDataArrayTexture||Tt.isCompressedArrayTexture?nt.setTexture2DArray(Tt,0):nt.setTexture2D(Tt,0),Vt.unbindTexture()},this.resetState=function(){ze=0,dt=0,rt=null,Vt.reset(),hs.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(o){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!o}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===or?Er:Oo}set outputEncoding(o){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=o===Er?or:ws}}class wf extends O0{}wf.prototype.isWebGL1Renderer=!0;class Ym{constructor(o,d=25e-5){this.isFogExp2=!0,this.name="",this.color=new Mi(o),this.density=d}clone(){return new Ym(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Ef{constructor(o,d=1,v=1e3){this.isFog=!0,this.name="",this.color=new Mi(o),this.near=d,this.far=v}clone(){return new Ef(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class qu extends Gr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(o,d){return super.copy(o,d),o.background!==null&&(this.background=o.background.clone()),o.environment!==null&&(this.environment=o.environment.clone()),o.fog!==null&&(this.fog=o.fog.clone()),this.backgroundBlurriness=o.backgroundBlurriness,this.backgroundIntensity=o.backgroundIntensity,o.overrideMaterial!==null&&(this.overrideMaterial=o.overrideMaterial.clone()),this.matrixAutoUpdate=o.matrixAutoUpdate,this}toJSON(o){const d=super.toJSON(o);return this.fog!==null&&(d.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(d.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(d.object.backgroundIntensity=this.backgroundIntensity),d}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(o){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=o}}class Km{constructor(o,d){this.isInterleavedBuffer=!0,this.array=o,this.stride=d,this.count=o!==void 0?o.length/d:0,this.usage=Mc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Sa()}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.array=new o.array.constructor(o.array),this.count=o.count,this.stride=o.stride,this.usage=o.usage,this}copyAt(o,d,v){o*=this.stride,v*=d.stride;for(let b=0,E=this.stride;b<E;b++)this.array[o+b]=d.array[v+b];return this}set(o,d=0){return this.array.set(o,d),this}clone(o){o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Sa()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const d=new this.array.constructor(o.arrayBuffers[this.array.buffer._uuid]),v=new this.constructor(d,this.stride);return v.setUsage(this.usage),v}onUpload(o){return this.onUploadCallback=o,this}toJSON(o){return o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Sa()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const js=new At;class Ho{constructor(o,d,v,b=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=o,this.itemSize=d,this.offset=v,this.normalized=b}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(o){this.data.needsUpdate=o}applyMatrix4(o){for(let d=0,v=this.data.count;d<v;d++)js.fromBufferAttribute(this,d),js.applyMatrix4(o),this.setXYZ(d,js.x,js.y,js.z);return this}applyNormalMatrix(o){for(let d=0,v=this.count;d<v;d++)js.fromBufferAttribute(this,d),js.applyNormalMatrix(o),this.setXYZ(d,js.x,js.y,js.z);return this}transformDirection(o){for(let d=0,v=this.count;d<v;d++)js.fromBufferAttribute(this,d),js.transformDirection(o),this.setXYZ(d,js.x,js.y,js.z);return this}setX(o,d){return this.normalized&&(d=Vr(d,this.array)),this.data.array[o*this.data.stride+this.offset]=d,this}setY(o,d){return this.normalized&&(d=Vr(d,this.array)),this.data.array[o*this.data.stride+this.offset+1]=d,this}setZ(o,d){return this.normalized&&(d=Vr(d,this.array)),this.data.array[o*this.data.stride+this.offset+2]=d,this}setW(o,d){return this.normalized&&(d=Vr(d,this.array)),this.data.array[o*this.data.stride+this.offset+3]=d,this}getX(o){let d=this.data.array[o*this.data.stride+this.offset];return this.normalized&&(d=Qa(d,this.array)),d}getY(o){let d=this.data.array[o*this.data.stride+this.offset+1];return this.normalized&&(d=Qa(d,this.array)),d}getZ(o){let d=this.data.array[o*this.data.stride+this.offset+2];return this.normalized&&(d=Qa(d,this.array)),d}getW(o){let d=this.data.array[o*this.data.stride+this.offset+3];return this.normalized&&(d=Qa(d,this.array)),d}setXY(o,d,v){return o=o*this.data.stride+this.offset,this.normalized&&(d=Vr(d,this.array),v=Vr(v,this.array)),this.data.array[o+0]=d,this.data.array[o+1]=v,this}setXYZ(o,d,v,b){return o=o*this.data.stride+this.offset,this.normalized&&(d=Vr(d,this.array),v=Vr(v,this.array),b=Vr(b,this.array)),this.data.array[o+0]=d,this.data.array[o+1]=v,this.data.array[o+2]=b,this}setXYZW(o,d,v,b,E){return o=o*this.data.stride+this.offset,this.normalized&&(d=Vr(d,this.array),v=Vr(v,this.array),b=Vr(b,this.array),E=Vr(E,this.array)),this.data.array[o+0]=d,this.data.array[o+1]=v,this.data.array[o+2]=b,this.data.array[o+3]=E,this}clone(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let v=0;v<this.count;v++){const b=v*this.data.stride+this.offset;for(let E=0;E<this.itemSize;E++)d.push(this.data.array[b+E])}return new As(new this.array.constructor(d),this.itemSize,this.normalized)}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.clone(o)),new Ho(o.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let v=0;v<this.count;v++){const b=v*this.data.stride+this.offset;for(let E=0;E<this.itemSize;E++)d.push(this.data.array[b+E])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:d,normalized:this.normalized}}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.toJSON(o)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Gd extends Vo{constructor(o){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Mi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.rotation=o.rotation,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}let Fh;const ia=new At,Sf=new At,Tf=new At,zh=new jn,Mf=new jn,Al=new Sr,Wo=new At,$m=new At,V_=new At,Hd=new jn,Wd=new jn,dc=new jn;class Qd extends Gr{constructor(o){if(super(),this.isSprite=!0,this.type="Sprite",Fh===void 0){Fh=new Ie;const d=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),v=new Km(d,5);Fh.setIndex([0,1,2,0,2,3]),Fh.setAttribute("position",new Ho(v,3,0,!1)),Fh.setAttribute("uv",new Ho(v,2,3,!1))}this.geometry=Fh,this.material=o!==void 0?o:new Gd,this.center=new jn(.5,.5)}raycast(o,d){o.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Sf.setFromMatrixScale(this.matrixWorld),Al.copy(o.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(o.camera.matrixWorldInverse,this.matrixWorld),Tf.setFromMatrixPosition(this.modelViewMatrix),o.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Sf.multiplyScalar(-Tf.z);const v=this.material.rotation;let b,E;v!==0&&(E=Math.cos(v),b=Math.sin(v));const P=this.center;vu(Wo.set(-.5,-.5,0),Tf,P,Sf,b,E),vu($m.set(.5,-.5,0),Tf,P,Sf,b,E),vu(V_.set(.5,.5,0),Tf,P,Sf,b,E),Hd.set(0,0),Wd.set(1,0),dc.set(1,1);let O=o.ray.intersectTriangle(Wo,$m,V_,!1,ia);if(O===null&&(vu($m.set(-.5,.5,0),Tf,P,Sf,b,E),Wd.set(0,1),O=o.ray.intersectTriangle(Wo,V_,$m,!1,ia),O===null))return;const Q=o.ray.origin.distanceTo(ia);Q<o.near||Q>o.far||d.push({distance:Q,point:ia.clone(),uv:zo.getInterpolation(ia,Wo,$m,V_,Hd,Wd,dc,new jn),face:null,object:this})}copy(o,d){return super.copy(o,d),o.center!==void 0&&this.center.copy(o.center),this.material=o.material,this}}function vu(I,o,d,v,b,E){zh.subVectors(I,d).addScalar(.5).multiply(v),b!==void 0?(Mf.x=E*zh.x-b*zh.y,Mf.y=b*zh.x+E*zh.y):Mf.copy(zh),I.copy(o),I.x+=Mf.x,I.y+=Mf.y,I.applyMatrix4(Al)}const fa=new At,Cf=new At;class N0 extends Gr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(o){super.copy(o,!1);const d=o.levels;for(let v=0,b=d.length;v<b;v++){const E=d[v];this.addLevel(E.object.clone(),E.distance,E.hysteresis)}return this.autoUpdate=o.autoUpdate,this}addLevel(o,d=0,v=0){d=Math.abs(d);const b=this.levels;let E;for(E=0;E<b.length&&!(d<b[E].distance);E++);return b.splice(E,0,{distance:d,hysteresis:v,object:o}),this.add(o),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(o){const d=this.levels;if(d.length>0){let v,b;for(v=1,b=d.length;v<b;v++){let E=d[v].distance;if(d[v].object.visible&&(E-=E*d[v].hysteresis),o<E)break}return d[v-1].object}return null}raycast(o,d){if(this.levels.length>0){fa.setFromMatrixPosition(this.matrixWorld);const v=o.ray.origin.distanceTo(fa);this.getObjectForDistance(v).raycast(o,d)}}update(o){const d=this.levels;if(d.length>1){fa.setFromMatrixPosition(o.matrixWorld),Cf.setFromMatrixPosition(this.matrixWorld);const v=fa.distanceTo(Cf)/o.zoom;let b,E;for(d[0].object.visible=!0,b=1,E=d.length;b<E;b++){let P=d[b].distance;if(d[b].object.visible&&(P-=P*d[b].hysteresis),!(v>=P))break;d[b-1].object.visible=!1,d[b].object.visible=!0}for(this._currentLevel=b-1;b<E;b++)d[b].object.visible=!1}}toJSON(o){const d=super.toJSON(o);this.autoUpdate===!1&&(d.object.autoUpdate=!1),d.object.levels=[];const v=this.levels;for(let b=0,E=v.length;b<E;b++){const P=v[b];d.object.levels.push({object:P.object.uuid,distance:P.distance,hysteresis:P.hysteresis})}return d}}const yb=new At,k0=new Yr,Ab=new Yr,bE=new At,U0=new Sr,Xd=new At;class ma extends Co{constructor(o,d){super(o,d),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Sr,this.bindMatrixInverse=new Sr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const o=this.geometry;this.boundingBox===null&&(this.boundingBox=new ec),this.boundingBox.makeEmpty();const d=o.getAttribute("position");for(let v=0;v<d.count;v++)Xd.fromBufferAttribute(d,v),this.applyBoneTransform(v,Xd),this.boundingBox.expandByPoint(Xd)}computeBoundingSphere(){const o=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new ko),this.boundingSphere.makeEmpty();const d=o.getAttribute("position");for(let v=0;v<d.count;v++)Xd.fromBufferAttribute(d,v),this.applyBoneTransform(v,Xd),this.boundingSphere.expandByPoint(Xd)}copy(o,d){return super.copy(o,d),this.bindMode=o.bindMode,this.bindMatrix.copy(o.bindMatrix),this.bindMatrixInverse.copy(o.bindMatrixInverse),this.skeleton=o.skeleton,this}getVertexPosition(o,d){return super.getVertexPosition(o,d),this.applyBoneTransform(o,d),d}bind(o,d){this.skeleton=o,d===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),d=this.matrixWorld),this.bindMatrix.copy(d),this.bindMatrixInverse.copy(d).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const o=new Yr,d=this.geometry.attributes.skinWeight;for(let v=0,b=d.count;v<b;v++){o.fromBufferAttribute(d,v);const E=1/o.manhattanLength();E!==1/0?o.multiplyScalar(E):o.set(1,0,0,0),d.setXYZW(v,o.x,o.y,o.z,o.w)}}updateMatrixWorld(o){super.updateMatrixWorld(o),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(o,d){const v=this.skeleton,b=this.geometry;k0.fromBufferAttribute(b.attributes.skinIndex,o),Ab.fromBufferAttribute(b.attributes.skinWeight,o),yb.copy(d).applyMatrix4(this.bindMatrix),d.set(0,0,0);for(let E=0;E<4;E++){const P=Ab.getComponent(E);if(P!==0){const O=k0.getComponent(E);U0.multiplyMatrices(v.bones[O].matrixWorld,v.boneInverses[O]),d.addScaledVector(bE.copy(yb).applyMatrix4(U0),P)}}return d.applyMatrix4(this.bindMatrixInverse)}boneTransform(o,d){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(o,d)}}class ls extends Gr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Yu extends Vs{constructor(o=null,d=1,v=1,b,E,P,O,Q,G=Bt,te=Bt,ge,fe){super(null,P,O,Q,G,te,b,E,ge,fe),this.isDataTexture=!0,this.image={data:o,width:d,height:v},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ls=new Sr,xE=new Sr;class Rf{constructor(o=[],d=[]){this.uuid=Sa(),this.bones=o.slice(0),this.boneInverses=d,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const o=this.bones,d=this.boneInverses;if(this.boneMatrices=new Float32Array(16*o.length),d.length===0)this.calculateInverses();else if(o.length!==d.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let v=0,b=this.bones.length;v<b;v++)this.boneInverses.push(new Sr)}}calculateInverses(){this.boneInverses.length=0;for(let o=0,d=this.bones.length;o<d;o++){const v=new Sr;this.bones[o]&&v.copy(this.bones[o].matrixWorld).invert(),this.boneInverses.push(v)}}pose(){for(let o=0,d=this.bones.length;o<d;o++){const v=this.bones[o];v&&v.matrixWorld.copy(this.boneInverses[o]).invert()}for(let o=0,d=this.bones.length;o<d;o++){const v=this.bones[o];v&&(v.parent&&v.parent.isBone?(v.matrix.copy(v.parent.matrixWorld).invert(),v.matrix.multiply(v.matrixWorld)):v.matrix.copy(v.matrixWorld),v.matrix.decompose(v.position,v.quaternion,v.scale))}}update(){const o=this.bones,d=this.boneInverses,v=this.boneMatrices,b=this.boneTexture;for(let E=0,P=o.length;E<P;E++){const O=o[E]?o[E].matrixWorld:xE;Ls.multiplyMatrices(O,d[E]),Ls.toArray(v,16*E)}b!==null&&(b.needsUpdate=!0)}clone(){return new Rf(this.bones,this.boneInverses)}computeBoneTexture(){let o=Math.sqrt(4*this.bones.length);o=qr(o),o=Math.max(o,4);const d=new Float32Array(o*o*4);d.set(this.boneMatrices);const v=new Yu(d,o,o,xs,Pr);return v.needsUpdate=!0,this.boneMatrices=d,this.boneTexture=v,this.boneTextureSize=o,this}getBoneByName(o){for(let d=0,v=this.bones.length;d<v;d++){const b=this.bones[d];if(b.name===o)return b}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(o,d){this.uuid=o.uuid;for(let v=0,b=o.bones.length;v<b;v++){const E=o.bones[v];let P=d[E];P===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",E),P=new ls),this.bones.push(P),this.boneInverses.push(new Sr().fromArray(o.boneInverses[v]))}return this.init(),this}toJSON(){const o={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};o.uuid=this.uuid;const d=this.bones,v=this.boneInverses;for(let b=0,E=d.length;b<E;b++){const P=d[b];o.bones.push(P.uuid);const O=v[b];o.boneInverses.push(O.toArray())}return o}}class Vh extends As{constructor(o,d,v,b=1){super(o,d,v),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=b}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}toJSON(){const o=super.toJSON();return o.meshPerAttribute=this.meshPerAttribute,o.isInstancedBufferAttribute=!0,o}}const Na=new Sr,If=new Sr,qd=[],F0=new ec,z0=new Sr,Pf=new Co,Yd=new ko;class Jm extends Co{constructor(o,d,v){super(o,d),this.isInstancedMesh=!0,this.instanceMatrix=new Vh(new Float32Array(16*v),16),this.instanceColor=null,this.count=v,this.boundingBox=null,this.boundingSphere=null;for(let b=0;b<v;b++)this.setMatrixAt(b,z0)}computeBoundingBox(){const o=this.geometry,d=this.count;this.boundingBox===null&&(this.boundingBox=new ec),o.boundingBox===null&&o.computeBoundingBox(),this.boundingBox.makeEmpty();for(let v=0;v<d;v++)this.getMatrixAt(v,Na),F0.copy(o.boundingBox).applyMatrix4(Na),this.boundingBox.union(F0)}computeBoundingSphere(){const o=this.geometry,d=this.count;this.boundingSphere===null&&(this.boundingSphere=new ko),o.boundingSphere===null&&o.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let v=0;v<d;v++)this.getMatrixAt(v,Na),Yd.copy(o.boundingSphere).applyMatrix4(Na),this.boundingSphere.union(Yd)}copy(o,d){return super.copy(o,d),this.instanceMatrix.copy(o.instanceMatrix),o.instanceColor!==null&&(this.instanceColor=o.instanceColor.clone()),this.count=o.count,this}getColorAt(o,d){d.fromArray(this.instanceColor.array,3*o)}getMatrixAt(o,d){d.fromArray(this.instanceMatrix.array,16*o)}raycast(o,d){const v=this.matrixWorld,b=this.count;if(Pf.geometry=this.geometry,Pf.material=this.material,Pf.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Yd.copy(this.boundingSphere),Yd.applyMatrix4(v),o.ray.intersectsSphere(Yd)!==!1))for(let E=0;E<b;E++){this.getMatrixAt(E,Na),If.multiplyMatrices(v,Na),Pf.matrixWorld=If,Pf.raycast(o,qd);for(let P=0,O=qd.length;P<O;P++){const Q=qd[P];Q.instanceId=E,Q.object=this,d.push(Q)}qd.length=0}}setColorAt(o,d){this.instanceColor===null&&(this.instanceColor=new Vh(new Float32Array(3*this.instanceMatrix.count),3)),d.toArray(this.instanceColor.array,3*o)}setMatrixAt(o,d){d.toArray(this.instanceMatrix.array,16*o)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class ka extends Vo{constructor(o){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Mi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.linewidth=o.linewidth,this.linecap=o.linecap,this.linejoin=o.linejoin,this.fog=o.fog,this}}const j_=new At,G_=new At,H_=new Sr,W_=new Bc,Kd=new ko;class Ku extends Gr{constructor(o=new Ie,d=new ka){super(),this.isLine=!0,this.type="Line",this.geometry=o,this.material=d,this.updateMorphTargets()}copy(o,d){return super.copy(o,d),this.material=o.material,this.geometry=o.geometry,this}computeLineDistances(){const o=this.geometry;if(o.index===null){const d=o.attributes.position,v=[0];for(let b=1,E=d.count;b<E;b++)j_.fromBufferAttribute(d,b-1),G_.fromBufferAttribute(d,b),v[b]=v[b-1],v[b]+=j_.distanceTo(G_);o.setAttribute("lineDistance",new ki(v,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(o,d){const v=this.geometry,b=this.matrixWorld,E=o.params.Line.threshold,P=v.drawRange;if(v.boundingSphere===null&&v.computeBoundingSphere(),Kd.copy(v.boundingSphere),Kd.applyMatrix4(b),Kd.radius+=E,o.ray.intersectsSphere(Kd)===!1)return;H_.copy(b).invert(),W_.copy(o.ray).applyMatrix4(H_);const O=E/((this.scale.x+this.scale.y+this.scale.z)/3),Q=O*O,G=new At,te=new At,ge=new At,fe=new At,_e=this.isLineSegments?2:1,xe=v.index,Re=v.attributes.position;if(xe!==null)for(let we=Math.max(0,P.start),Ce=Math.min(xe.count,P.start+P.count)-1;we<Ce;we+=_e){const De=xe.getX(we),ze=xe.getX(we+1);if(G.fromBufferAttribute(Re,De),te.fromBufferAttribute(Re,ze),W_.distanceSqToSegment(G,te,fe,ge)>Q)continue;fe.applyMatrix4(this.matrixWorld);const dt=o.ray.origin.distanceTo(fe);dt<o.near||dt>o.far||d.push({distance:dt,point:ge.clone().applyMatrix4(this.matrixWorld),index:we,face:null,faceIndex:null,object:this})}else for(let we=Math.max(0,P.start),Ce=Math.min(Re.count,P.start+P.count)-1;we<Ce;we+=_e){if(G.fromBufferAttribute(Re,we),te.fromBufferAttribute(Re,we+1),W_.distanceSqToSegment(G,te,fe,ge)>Q)continue;fe.applyMatrix4(this.matrixWorld);const De=o.ray.origin.distanceTo(fe);De<o.near||De>o.far||d.push({distance:De,point:ge.clone().applyMatrix4(this.matrixWorld),index:we,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const o=this.geometry.morphAttributes,d=Object.keys(o);if(d.length>0){const v=o[d[0]];if(v!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let b=0,E=v.length;b<E;b++){const P=v[b].name||String(b);this.morphTargetInfluences.push(0),this.morphTargetDictionary[P]=b}}}}}const V0=new At,j0=new At;class bl extends Ku{constructor(o,d){super(o,d),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const o=this.geometry;if(o.index===null){const d=o.attributes.position,v=[];for(let b=0,E=d.count;b<E;b+=2)V0.fromBufferAttribute(d,b),j0.fromBufferAttribute(d,b+1),v[b]=b===0?0:v[b-1],v[b+1]=v[b]+V0.distanceTo(j0);o.setAttribute("lineDistance",new ki(v,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class G0 extends Ku{constructor(o,d){super(o,d),this.isLineLoop=!0,this.type="LineLoop"}}class Q_ extends Vo{constructor(o){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Mi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.size=o.size,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}const io=new Sr,X_=new Bc,Df=new ko,jh=new At;class q_ extends Gr{constructor(o=new Ie,d=new Q_){super(),this.isPoints=!0,this.type="Points",this.geometry=o,this.material=d,this.updateMorphTargets()}copy(o,d){return super.copy(o,d),this.material=o.material,this.geometry=o.geometry,this}raycast(o,d){const v=this.geometry,b=this.matrixWorld,E=o.params.Points.threshold,P=v.drawRange;if(v.boundingSphere===null&&v.computeBoundingSphere(),Df.copy(v.boundingSphere),Df.applyMatrix4(b),Df.radius+=E,o.ray.intersectsSphere(Df)===!1)return;io.copy(b).invert(),X_.copy(o.ray).applyMatrix4(io);const O=E/((this.scale.x+this.scale.y+this.scale.z)/3),Q=O*O,G=v.index,te=v.attributes.position;if(G!==null)for(let ge=Math.max(0,P.start),fe=Math.min(G.count,P.start+P.count);ge<fe;ge++){const _e=G.getX(ge);jh.fromBufferAttribute(te,_e),bb(jh,_e,Q,b,o,d,this)}else for(let ge=Math.max(0,P.start),fe=Math.min(te.count,P.start+P.count);ge<fe;ge++)jh.fromBufferAttribute(te,ge),bb(jh,ge,Q,b,o,d,this)}updateMorphTargets(){const o=this.geometry.morphAttributes,d=Object.keys(o);if(d.length>0){const v=o[d[0]];if(v!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let b=0,E=v.length;b<E;b++){const P=v[b].name||String(b);this.morphTargetInfluences.push(0),this.morphTargetDictionary[P]=b}}}}}function bb(I,o,d,v,b,E,P){const O=X_.distanceSqToPoint(I);if(O<d){const Q=new At;X_.closestPointToPoint(I,Q),Q.applyMatrix4(v);const G=b.ray.origin.distanceTo(Q);if(G<b.near||G>b.far)return;E.push({distance:G,distanceToRay:Math.sqrt(O),point:Q,index:o,face:null,object:P})}}class wE extends Vs{constructor(o,d,v,b,E,P,O,Q,G){super(o,d,v,b,E,P,O,Q,G),this.isVideoTexture=!0,this.minFilter=P!==void 0?P:en,this.magFilter=E!==void 0?E:en,this.generateMipmaps=!1;const te=this;"requestVideoFrameCallback"in o&&o.requestVideoFrameCallback(function ge(){te.needsUpdate=!0,o.requestVideoFrameCallback(ge)})}clone(){return new this.constructor(this.image).copy(this)}update(){const o=this.image;!("requestVideoFrameCallback"in o)&&o.readyState>=o.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class EE extends Vs{constructor(o,d,v){super({width:o,height:d}),this.isFramebufferTexture=!0,this.format=v,this.magFilter=Bt,this.minFilter=Bt,this.generateMipmaps=!1,this.needsUpdate=!0}}class H0 extends Vs{constructor(o,d,v,b,E,P,O,Q,G,te,ge,fe){super(null,P,O,Q,G,te,b,E,ge,fe),this.isCompressedTexture=!0,this.image={width:d,height:v},this.mipmaps=o,this.flipY=!1,this.generateMipmaps=!1}}class SE extends H0{constructor(o,d,v,b,E,P){super(o,d,v,E,P),this.isCompressedArrayTexture=!0,this.image.depth=b,this.wrapR=pt}}class W0 extends Vs{constructor(o,d,v,b,E,P,O,Q,G){super(o,d,v,b,E,P,O,Q,G),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Gc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(o,d){const v=this.getUtoTmapping(o);return this.getPoint(v,d)}getPoints(o=5){const d=[];for(let v=0;v<=o;v++)d.push(this.getPoint(v/o));return d}getSpacedPoints(o=5){const d=[];for(let v=0;v<=o;v++)d.push(this.getPointAt(v/o));return d}getLength(){const o=this.getLengths();return o[o.length-1]}getLengths(o=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===o+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const d=[];let v,b=this.getPoint(0),E=0;d.push(0);for(let P=1;P<=o;P++)v=this.getPoint(P/o),E+=v.distanceTo(b),d.push(E),b=v;return this.cacheArcLengths=d,d}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(o,d){const v=this.getLengths();let b=0;const E=v.length;let P;P=d||o*v[E-1];let O,Q=0,G=E-1;for(;Q<=G;)if(b=Math.floor(Q+(G-Q)/2),O=v[b]-P,O<0)Q=b+1;else{if(!(O>0)){G=b;break}G=b-1}if(b=G,v[b]===P)return b/(E-1);const te=v[b];return(b+(P-te)/(v[b+1]-te))/(E-1)}getTangent(o,d){let b=o-1e-4,E=o+1e-4;b<0&&(b=0),E>1&&(E=1);const P=this.getPoint(b),O=this.getPoint(E),Q=d||(P.isVector2?new jn:new At);return Q.copy(O).sub(P).normalize(),Q}getTangentAt(o,d){const v=this.getUtoTmapping(o);return this.getTangent(v,d)}computeFrenetFrames(o,d){const v=new At,b=[],E=[],P=[],O=new At,Q=new Sr;for(let _e=0;_e<=o;_e++){const xe=_e/o;b[_e]=this.getTangentAt(xe,new At)}E[0]=new At,P[0]=new At;let G=Number.MAX_VALUE;const te=Math.abs(b[0].x),ge=Math.abs(b[0].y),fe=Math.abs(b[0].z);te<=G&&(G=te,v.set(1,0,0)),ge<=G&&(G=ge,v.set(0,1,0)),fe<=G&&v.set(0,0,1),O.crossVectors(b[0],v).normalize(),E[0].crossVectors(b[0],O),P[0].crossVectors(b[0],E[0]);for(let _e=1;_e<=o;_e++){if(E[_e]=E[_e-1].clone(),P[_e]=P[_e-1].clone(),O.crossVectors(b[_e-1],b[_e]),O.length()>Number.EPSILON){O.normalize();const xe=Math.acos(zs(b[_e-1].dot(b[_e]),-1,1));E[_e].applyMatrix4(Q.makeRotationAxis(O,xe))}P[_e].crossVectors(b[_e],E[_e])}if(d===!0){let _e=Math.acos(zs(E[0].dot(E[o]),-1,1));_e/=o,b[0].dot(O.crossVectors(E[0],E[o]))>0&&(_e=-_e);for(let xe=1;xe<=o;xe++)E[xe].applyMatrix4(Q.makeRotationAxis(b[xe],_e*xe)),P[xe].crossVectors(b[xe],E[xe])}return{tangents:b,normals:E,binormals:P}}clone(){return new this.constructor().copy(this)}copy(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}toJSON(){const o={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return o.arcLengthDivisions=this.arcLengthDivisions,o.type=this.type,o}fromJSON(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}}class Y_ extends Gc{constructor(o=0,d=0,v=1,b=1,E=0,P=2*Math.PI,O=!1,Q=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=o,this.aY=d,this.xRadius=v,this.yRadius=b,this.aStartAngle=E,this.aEndAngle=P,this.aClockwise=O,this.aRotation=Q}getPoint(o,d){const v=d||new jn,b=2*Math.PI;let E=this.aEndAngle-this.aStartAngle;const P=Math.abs(E)<Number.EPSILON;for(;E<0;)E+=b;for(;E>b;)E-=b;E<Number.EPSILON&&(E=P?0:b),this.aClockwise!==!0||P||(E===b?E=-b:E-=b);const O=this.aStartAngle+o*E;let Q=this.aX+this.xRadius*Math.cos(O),G=this.aY+this.yRadius*Math.sin(O);if(this.aRotation!==0){const te=Math.cos(this.aRotation),ge=Math.sin(this.aRotation),fe=Q-this.aX,_e=G-this.aY;Q=fe*te-_e*ge+this.aX,G=fe*ge+_e*te+this.aY}return v.set(Q,G)}copy(o){return super.copy(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}toJSON(){const o=super.toJSON();return o.aX=this.aX,o.aY=this.aY,o.xRadius=this.xRadius,o.yRadius=this.yRadius,o.aStartAngle=this.aStartAngle,o.aEndAngle=this.aEndAngle,o.aClockwise=this.aClockwise,o.aRotation=this.aRotation,o}fromJSON(o){return super.fromJSON(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}}class Q0 extends Y_{constructor(o,d,v,b,E,P){super(o,d,v,v,b,E,P),this.isArcCurve=!0,this.type="ArcCurve"}}function Lf(){let I=0,o=0,d=0,v=0;function b(E,P,O,Q){I=E,o=O,d=-3*E+3*P-2*O-Q,v=2*E-2*P+O+Q}return{initCatmullRom:function(E,P,O,Q,G){b(P,O,G*(O-E),G*(Q-P))},initNonuniformCatmullRom:function(E,P,O,Q,G,te,ge){let fe=(P-E)/G-(O-E)/(G+te)+(O-P)/te,_e=(O-P)/te-(Q-P)/(te+ge)+(Q-O)/ge;fe*=te,_e*=te,b(P,O,fe,_e)},calc:function(E){const P=E*E;return I+o*E+d*P+v*(P*E)}}}const Zm=new At,eg=new Lf,$d=new Lf,K_=new Lf;class Bf extends Gc{constructor(o=[],d=!1,v="centripetal",b=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=o,this.closed=d,this.curveType=v,this.tension=b}getPoint(o,d=new At){const v=d,b=this.points,E=b.length,P=(E-(this.closed?0:1))*o;let O,Q,G=Math.floor(P),te=P-G;this.closed?G+=G>0?0:(Math.floor(Math.abs(G)/E)+1)*E:te===0&&G===E-1&&(G=E-2,te=1),this.closed||G>0?O=b[(G-1)%E]:(Zm.subVectors(b[0],b[1]).add(b[0]),O=Zm);const ge=b[G%E],fe=b[(G+1)%E];if(this.closed||G+2<E?Q=b[(G+2)%E]:(Zm.subVectors(b[E-1],b[E-2]).add(b[E-1]),Q=Zm),this.curveType==="centripetal"||this.curveType==="chordal"){const _e=this.curveType==="chordal"?.5:.25;let xe=Math.pow(O.distanceToSquared(ge),_e),Re=Math.pow(ge.distanceToSquared(fe),_e),we=Math.pow(fe.distanceToSquared(Q),_e);Re<1e-4&&(Re=1),xe<1e-4&&(xe=Re),we<1e-4&&(we=Re),eg.initNonuniformCatmullRom(O.x,ge.x,fe.x,Q.x,xe,Re,we),$d.initNonuniformCatmullRom(O.y,ge.y,fe.y,Q.y,xe,Re,we),K_.initNonuniformCatmullRom(O.z,ge.z,fe.z,Q.z,xe,Re,we)}else this.curveType==="catmullrom"&&(eg.initCatmullRom(O.x,ge.x,fe.x,Q.x,this.tension),$d.initCatmullRom(O.y,ge.y,fe.y,Q.y,this.tension),K_.initCatmullRom(O.z,ge.z,fe.z,Q.z,this.tension));return v.set(eg.calc(te),$d.calc(te),K_.calc(te)),v}copy(o){super.copy(o),this.points=[];for(let d=0,v=o.points.length;d<v;d++){const b=o.points[d];this.points.push(b.clone())}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}toJSON(){const o=super.toJSON();o.points=[];for(let d=0,v=this.points.length;d<v;d++){const b=this.points[d];o.points.push(b.toArray())}return o.closed=this.closed,o.curveType=this.curveType,o.tension=this.tension,o}fromJSON(o){super.fromJSON(o),this.points=[];for(let d=0,v=o.points.length;d<v;d++){const b=o.points[d];this.points.push(new At().fromArray(b))}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}}function tg(I,o,d,v,b){const E=.5*(v-o),P=.5*(b-d),O=I*I;return(2*d-2*v+E+P)*(I*O)+(-3*d+3*v-2*E-P)*O+E*I+d}function Jd(I,o,d,v){return function(b,E){const P=1-b;return P*P*E}(I,o)+function(b,E){return 2*(1-b)*b*E}(I,d)+function(b,E){return b*b*E}(I,v)}function ng(I,o,d,v,b){return function(E,P){const O=1-E;return O*O*O*P}(I,o)+function(E,P){const O=1-E;return 3*O*O*E*P}(I,d)+function(E,P){return 3*(1-E)*E*E*P}(I,v)+function(E,P){return E*E*E*P}(I,b)}class Zd extends Gc{constructor(o=new jn,d=new jn,v=new jn,b=new jn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=o,this.v1=d,this.v2=v,this.v3=b}getPoint(o,d=new jn){const v=d,b=this.v0,E=this.v1,P=this.v2,O=this.v3;return v.set(ng(o,b.x,E.x,P.x,O.x),ng(o,b.y,E.y,P.y,O.y)),v}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class ig extends Gc{constructor(o=new At,d=new At,v=new At,b=new At){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=o,this.v1=d,this.v2=v,this.v3=b}getPoint(o,d=new At){const v=d,b=this.v0,E=this.v1,P=this.v2,O=this.v3;return v.set(ng(o,b.x,E.x,P.x,O.x),ng(o,b.y,E.y,P.y,O.y),ng(o,b.z,E.z,P.z,O.z)),v}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class rg extends Gc{constructor(o=new jn,d=new jn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=o,this.v2=d}getPoint(o,d=new jn){const v=d;return o===1?v.copy(this.v2):(v.copy(this.v2).sub(this.v1),v.multiplyScalar(o).add(this.v1)),v}getPointAt(o,d){return this.getPoint(o,d)}getTangent(o,d=new jn){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(o,d){return this.getTangent(o,d)}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class $_ extends Gc{constructor(o=new At,d=new At){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=o,this.v2=d}getPoint(o,d=new At){const v=d;return o===1?v.copy(this.v2):(v.copy(this.v2).sub(this.v1),v.multiplyScalar(o).add(this.v1)),v}getPointAt(o,d){return this.getPoint(o,d)}getTangent(o,d=new At){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(o,d){return this.getTangent(o,d)}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class J_ extends Gc{constructor(o=new jn,d=new jn,v=new jn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=o,this.v1=d,this.v2=v}getPoint(o,d=new jn){const v=d,b=this.v0,E=this.v1,P=this.v2;return v.set(Jd(o,b.x,E.x,P.x),Jd(o,b.y,E.y,P.y)),v}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class X0 extends Gc{constructor(o=new At,d=new At,v=new At){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=o,this.v1=d,this.v2=v}getPoint(o,d=new At){const v=d,b=this.v0,E=this.v1,P=this.v2;return v.set(Jd(o,b.x,E.x,P.x),Jd(o,b.y,E.y,P.y),Jd(o,b.z,E.z,P.z)),v}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class sg extends Gc{constructor(o=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=o}getPoint(o,d=new jn){const v=d,b=this.points,E=(b.length-1)*o,P=Math.floor(E),O=E-P,Q=b[P===0?P:P-1],G=b[P],te=b[P>b.length-2?b.length-1:P+1],ge=b[P>b.length-3?b.length-1:P+2];return v.set(tg(O,Q.x,G.x,te.x,ge.x),tg(O,Q.y,G.y,te.y,ge.y)),v}copy(o){super.copy(o),this.points=[];for(let d=0,v=o.points.length;d<v;d++){const b=o.points[d];this.points.push(b.clone())}return this}toJSON(){const o=super.toJSON();o.points=[];for(let d=0,v=this.points.length;d<v;d++){const b=this.points[d];o.points.push(b.toArray())}return o}fromJSON(o){super.fromJSON(o),this.points=[];for(let d=0,v=o.points.length;d<v;d++){const b=o.points[d];this.points.push(new jn().fromArray(b))}return this}}var Gh=Object.freeze({__proto__:null,ArcCurve:Q0,CatmullRomCurve3:Bf,CubicBezierCurve:Zd,CubicBezierCurve3:ig,EllipseCurve:Y_,LineCurve:rg,LineCurve3:$_,QuadraticBezierCurve:J_,QuadraticBezierCurve3:X0,SplineCurve:sg});class Z_ extends Gc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(o){this.curves.push(o)}closePath(){const o=this.curves[0].getPoint(0),d=this.curves[this.curves.length-1].getPoint(1);o.equals(d)||this.curves.push(new rg(d,o))}getPoint(o,d){const v=o*this.getLength(),b=this.getCurveLengths();let E=0;for(;E<b.length;){if(b[E]>=v){const P=b[E]-v,O=this.curves[E],Q=O.getLength(),G=Q===0?0:1-P/Q;return O.getPointAt(G,d)}E++}return null}getLength(){const o=this.getCurveLengths();return o[o.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const o=[];let d=0;for(let v=0,b=this.curves.length;v<b;v++)d+=this.curves[v].getLength(),o.push(d);return this.cacheLengths=o,o}getSpacedPoints(o=40){const d=[];for(let v=0;v<=o;v++)d.push(this.getPoint(v/o));return this.autoClose&&d.push(d[0]),d}getPoints(o=12){const d=[];let v;for(let b=0,E=this.curves;b<E.length;b++){const P=E[b],O=P.isEllipseCurve?2*o:P.isLineCurve||P.isLineCurve3?1:P.isSplineCurve?o*P.points.length:o,Q=P.getPoints(O);for(let G=0;G<Q.length;G++){const te=Q[G];v&&v.equals(te)||(d.push(te),v=te)}}return this.autoClose&&d.length>1&&!d[d.length-1].equals(d[0])&&d.push(d[0]),d}copy(o){super.copy(o),this.curves=[];for(let d=0,v=o.curves.length;d<v;d++){const b=o.curves[d];this.curves.push(b.clone())}return this.autoClose=o.autoClose,this}toJSON(){const o=super.toJSON();o.autoClose=this.autoClose,o.curves=[];for(let d=0,v=this.curves.length;d<v;d++){const b=this.curves[d];o.curves.push(b.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.autoClose=o.autoClose,this.curves=[];for(let d=0,v=o.curves.length;d<v;d++){const b=o.curves[d];this.curves.push(new Gh[b.type]().fromJSON(b))}return this}}class og extends Z_{constructor(o){super(),this.type="Path",this.currentPoint=new jn,o&&this.setFromPoints(o)}setFromPoints(o){this.moveTo(o[0].x,o[0].y);for(let d=1,v=o.length;d<v;d++)this.lineTo(o[d].x,o[d].y);return this}moveTo(o,d){return this.currentPoint.set(o,d),this}lineTo(o,d){const v=new rg(this.currentPoint.clone(),new jn(o,d));return this.curves.push(v),this.currentPoint.set(o,d),this}quadraticCurveTo(o,d,v,b){const E=new J_(this.currentPoint.clone(),new jn(o,d),new jn(v,b));return this.curves.push(E),this.currentPoint.set(v,b),this}bezierCurveTo(o,d,v,b,E,P){const O=new Zd(this.currentPoint.clone(),new jn(o,d),new jn(v,b),new jn(E,P));return this.curves.push(O),this.currentPoint.set(E,P),this}splineThru(o){const d=[this.currentPoint.clone()].concat(o),v=new sg(d);return this.curves.push(v),this.currentPoint.copy(o[o.length-1]),this}arc(o,d,v,b,E,P){const O=this.currentPoint.x,Q=this.currentPoint.y;return this.absarc(o+O,d+Q,v,b,E,P),this}absarc(o,d,v,b,E,P){return this.absellipse(o,d,v,v,b,E,P),this}ellipse(o,d,v,b,E,P,O,Q){const G=this.currentPoint.x,te=this.currentPoint.y;return this.absellipse(o+G,d+te,v,b,E,P,O,Q),this}absellipse(o,d,v,b,E,P,O,Q){const G=new Y_(o,d,v,b,E,P,O,Q);if(this.curves.length>0){const ge=G.getPoint(0);ge.equals(this.currentPoint)||this.lineTo(ge.x,ge.y)}this.curves.push(G);const te=G.getPoint(1);return this.currentPoint.copy(te),this}copy(o){return super.copy(o),this.currentPoint.copy(o.currentPoint),this}toJSON(){const o=super.toJSON();return o.currentPoint=this.currentPoint.toArray(),o}fromJSON(o){return super.fromJSON(o),this.currentPoint.fromArray(o.currentPoint),this}}class yu extends Ie{constructor(o=[new jn(0,-.5),new jn(.5,0),new jn(0,.5)],d=12,v=0,b=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:o,segments:d,phiStart:v,phiLength:b},d=Math.floor(d),b=zs(b,0,2*Math.PI);const E=[],P=[],O=[],Q=[],G=[],te=1/d,ge=new At,fe=new jn,_e=new At,xe=new At,Re=new At;let we=0,Ce=0;for(let De=0;De<=o.length-1;De++)switch(De){case 0:we=o[De+1].x-o[De].x,Ce=o[De+1].y-o[De].y,_e.x=1*Ce,_e.y=-we,_e.z=0*Ce,Re.copy(_e),_e.normalize(),Q.push(_e.x,_e.y,_e.z);break;case o.length-1:Q.push(Re.x,Re.y,Re.z);break;default:we=o[De+1].x-o[De].x,Ce=o[De+1].y-o[De].y,_e.x=1*Ce,_e.y=-we,_e.z=0*Ce,xe.copy(_e),_e.x+=Re.x,_e.y+=Re.y,_e.z+=Re.z,_e.normalize(),Q.push(_e.x,_e.y,_e.z),Re.copy(xe)}for(let De=0;De<=d;De++){const ze=v+De*te*b,dt=Math.sin(ze),rt=Math.cos(ze);for(let st=0;st<=o.length-1;st++){ge.x=o[st].x*dt,ge.y=o[st].y,ge.z=o[st].x*rt,P.push(ge.x,ge.y,ge.z),fe.x=De/d,fe.y=st/(o.length-1),O.push(fe.x,fe.y);const It=Q[3*st+0]*dt,Kt=Q[3*st+1],Dt=Q[3*st+0]*rt;G.push(It,Kt,Dt)}}for(let De=0;De<d;De++)for(let ze=0;ze<o.length-1;ze++){const dt=ze+De*o.length,rt=dt,st=dt+o.length,It=dt+o.length+1,Kt=dt+1;E.push(rt,st,Kt),E.push(It,Kt,st)}this.setIndex(E),this.setAttribute("position",new ki(P,3)),this.setAttribute("uv",new ki(O,2)),this.setAttribute("normal",new ki(G,3))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new yu(o.points,o.segments,o.phiStart,o.phiLength)}}class Au extends yu{constructor(o=1,d=1,v=4,b=8){const E=new og;E.absarc(0,-d/2,o,1.5*Math.PI,0),E.absarc(0,d/2,o,0,.5*Math.PI),super(E.getPoints(v),b),this.type="CapsuleGeometry",this.parameters={radius:o,height:d,capSegments:v,radialSegments:b}}static fromJSON(o){return new Au(o.radius,o.length,o.capSegments,o.radialSegments)}}class ag extends Ie{constructor(o=1,d=32,v=0,b=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:o,segments:d,thetaStart:v,thetaLength:b},d=Math.max(3,d);const E=[],P=[],O=[],Q=[],G=new At,te=new jn;P.push(0,0,0),O.push(0,0,1),Q.push(.5,.5);for(let ge=0,fe=3;ge<=d;ge++,fe+=3){const _e=v+ge/d*b;G.x=o*Math.cos(_e),G.y=o*Math.sin(_e),P.push(G.x,G.y,G.z),O.push(0,0,1),te.x=(P[fe]/o+1)/2,te.y=(P[fe+1]/o+1)/2,Q.push(te.x,te.y)}for(let ge=1;ge<=d;ge++)E.push(ge,ge+1,0);this.setIndex(E),this.setAttribute("position",new ki(P,3)),this.setAttribute("normal",new ki(O,3)),this.setAttribute("uv",new ki(Q,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new ag(o.radius,o.segments,o.thetaStart,o.thetaLength)}}class ep extends Ie{constructor(o=1,d=1,v=1,b=32,E=1,P=!1,O=0,Q=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:o,radiusBottom:d,height:v,radialSegments:b,heightSegments:E,openEnded:P,thetaStart:O,thetaLength:Q};const G=this;b=Math.floor(b),E=Math.floor(E);const te=[],ge=[],fe=[],_e=[];let xe=0;const Re=[],we=v/2;let Ce=0;function De(ze){const dt=xe,rt=new jn,st=new At;let It=0;const Kt=ze===!0?o:d,Dt=ze===!0?1:-1;for(let Ot=1;Ot<=b;Ot++)ge.push(0,we*Dt,0),fe.push(0,Dt,0),_e.push(.5,.5),xe++;const an=xe;for(let Ot=0;Ot<=b;Ot++){const Mn=Ot/b*Q+O,Sn=Math.cos(Mn),ti=Math.sin(Mn);st.x=Kt*ti,st.y=we*Dt,st.z=Kt*Sn,ge.push(st.x,st.y,st.z),fe.push(0,Dt,0),rt.x=.5*Sn+.5,rt.y=.5*ti*Dt+.5,_e.push(rt.x,rt.y),xe++}for(let Ot=0;Ot<b;Ot++){const Mn=dt+Ot,Sn=an+Ot;ze===!0?te.push(Sn,Sn+1,Mn):te.push(Sn+1,Sn,Mn),It+=3}G.addGroup(Ce,It,ze===!0?1:2),Ce+=It}(function(){const ze=new At,dt=new At;let rt=0;const st=(d-o)/v;for(let It=0;It<=E;It++){const Kt=[],Dt=It/E,an=Dt*(d-o)+o;for(let Ot=0;Ot<=b;Ot++){const Mn=Ot/b,Sn=Mn*Q+O,ti=Math.sin(Sn),xi=Math.cos(Sn);dt.x=an*ti,dt.y=-Dt*v+we,dt.z=an*xi,ge.push(dt.x,dt.y,dt.z),ze.set(ti,st,xi).normalize(),fe.push(ze.x,ze.y,ze.z),_e.push(Mn,1-Dt),Kt.push(xe++)}Re.push(Kt)}for(let It=0;It<b;It++)for(let Kt=0;Kt<E;Kt++){const Dt=Re[Kt][It],an=Re[Kt+1][It],Ot=Re[Kt+1][It+1],Mn=Re[Kt][It+1];te.push(Dt,an,Mn),te.push(an,Ot,Mn),rt+=6}G.addGroup(Ce,rt,0),Ce+=rt})(),P===!1&&(o>0&&De(!0),d>0&&De(!1)),this.setIndex(te),this.setAttribute("position",new ki(ge,3)),this.setAttribute("normal",new ki(fe,3)),this.setAttribute("uv",new ki(_e,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new ep(o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class Of extends ep{constructor(o=1,d=1,v=32,b=1,E=!1,P=0,O=2*Math.PI){super(0,o,d,v,b,E,P,O),this.type="ConeGeometry",this.parameters={radius:o,height:d,radialSegments:v,heightSegments:b,openEnded:E,thetaStart:P,thetaLength:O}}static fromJSON(o){return new Of(o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class Hc extends Ie{constructor(o=[],d=[],v=1,b=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:o,indices:d,radius:v,detail:b};const E=[],P=[];function O(fe,_e,xe,Re){const we=Re+1,Ce=[];for(let De=0;De<=we;De++){Ce[De]=[];const ze=fe.clone().lerp(xe,De/we),dt=_e.clone().lerp(xe,De/we),rt=we-De;for(let st=0;st<=rt;st++)Ce[De][st]=st===0&&De===we?ze:ze.clone().lerp(dt,st/rt)}for(let De=0;De<we;De++)for(let ze=0;ze<2*(we-De)-1;ze++){const dt=Math.floor(ze/2);ze%2==0?(Q(Ce[De][dt+1]),Q(Ce[De+1][dt]),Q(Ce[De][dt])):(Q(Ce[De][dt+1]),Q(Ce[De+1][dt+1]),Q(Ce[De+1][dt]))}}function Q(fe){E.push(fe.x,fe.y,fe.z)}function G(fe,_e){const xe=3*fe;_e.x=o[xe+0],_e.y=o[xe+1],_e.z=o[xe+2]}function te(fe,_e,xe,Re){Re<0&&fe.x===1&&(P[_e]=fe.x-1),xe.x===0&&xe.z===0&&(P[_e]=Re/2/Math.PI+.5)}function ge(fe){return Math.atan2(fe.z,-fe.x)}(function(fe){const _e=new At,xe=new At,Re=new At;for(let we=0;we<d.length;we+=3)G(d[we+0],_e),G(d[we+1],xe),G(d[we+2],Re),O(_e,xe,Re,fe)})(b),function(fe){const _e=new At;for(let xe=0;xe<E.length;xe+=3)_e.x=E[xe+0],_e.y=E[xe+1],_e.z=E[xe+2],_e.normalize().multiplyScalar(fe),E[xe+0]=_e.x,E[xe+1]=_e.y,E[xe+2]=_e.z}(v),function(){const fe=new At;for(let xe=0;xe<E.length;xe+=3){fe.x=E[xe+0],fe.y=E[xe+1],fe.z=E[xe+2];const Re=ge(fe)/2/Math.PI+.5,we=(_e=fe,Math.atan2(-_e.y,Math.sqrt(_e.x*_e.x+_e.z*_e.z))/Math.PI+.5);P.push(Re,1-we)}var _e;(function(){const xe=new At,Re=new At,we=new At,Ce=new At,De=new jn,ze=new jn,dt=new jn;for(let rt=0,st=0;rt<E.length;rt+=9,st+=6){xe.set(E[rt+0],E[rt+1],E[rt+2]),Re.set(E[rt+3],E[rt+4],E[rt+5]),we.set(E[rt+6],E[rt+7],E[rt+8]),De.set(P[st+0],P[st+1]),ze.set(P[st+2],P[st+3]),dt.set(P[st+4],P[st+5]),Ce.copy(xe).add(Re).add(we).divideScalar(3);const It=ge(Ce);te(De,st+0,xe,It),te(ze,st+2,Re,It),te(dt,st+4,we,It)}})(),function(){for(let xe=0;xe<P.length;xe+=6){const Re=P[xe+0],we=P[xe+2],Ce=P[xe+4],De=Math.max(Re,we,Ce),ze=Math.min(Re,we,Ce);De>.9&&ze<.1&&(Re<.2&&(P[xe+0]+=1),we<.2&&(P[xe+2]+=1),Ce<.2&&(P[xe+4]+=1))}}()}(),this.setAttribute("position",new ki(E,3)),this.setAttribute("normal",new ki(E.slice(),3)),this.setAttribute("uv",new ki(P,2)),b===0?this.computeVertexNormals():this.normalizeNormals()}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new Hc(o.vertices,o.indices,o.radius,o.details)}}class Hh extends Hc{constructor(o=1,d=0){const v=(1+Math.sqrt(5))/2,b=1/v;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-b,-v,0,-b,v,0,b,-v,0,b,v,-b,-v,0,-b,v,0,b,-v,0,b,v,0,-v,0,-b,v,0,-b,-v,0,b,v,0,b],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o,d),this.type="DodecahedronGeometry",this.parameters={radius:o,detail:d}}static fromJSON(o){return new Hh(o.radius,o.detail)}}const lg=new At,cg=new At,ev=new At,ug=new zo;class q0 extends Ie{constructor(o=null,d=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:o,thresholdAngle:d},o!==null){const b=Math.pow(10,4),E=Math.cos(ou*d),P=o.getIndex(),O=o.getAttribute("position"),Q=P?P.count:O.count,G=[0,0,0],te=["a","b","c"],ge=new Array(3),fe={},_e=[];for(let xe=0;xe<Q;xe+=3){P?(G[0]=P.getX(xe),G[1]=P.getX(xe+1),G[2]=P.getX(xe+2)):(G[0]=xe,G[1]=xe+1,G[2]=xe+2);const{a:Re,b:we,c:Ce}=ug;if(Re.fromBufferAttribute(O,G[0]),we.fromBufferAttribute(O,G[1]),Ce.fromBufferAttribute(O,G[2]),ug.getNormal(ev),ge[0]=`${Math.round(Re.x*b)},${Math.round(Re.y*b)},${Math.round(Re.z*b)}`,ge[1]=`${Math.round(we.x*b)},${Math.round(we.y*b)},${Math.round(we.z*b)}`,ge[2]=`${Math.round(Ce.x*b)},${Math.round(Ce.y*b)},${Math.round(Ce.z*b)}`,ge[0]!==ge[1]&&ge[1]!==ge[2]&&ge[2]!==ge[0])for(let De=0;De<3;De++){const ze=(De+1)%3,dt=ge[De],rt=ge[ze],st=ug[te[De]],It=ug[te[ze]],Kt=`${dt}_${rt}`,Dt=`${rt}_${dt}`;Dt in fe&&fe[Dt]?(ev.dot(fe[Dt].normal)<=E&&(_e.push(st.x,st.y,st.z),_e.push(It.x,It.y,It.z)),fe[Dt]=null):Kt in fe||(fe[Kt]={index0:G[De],index1:G[ze],normal:ev.clone()})}}for(const xe in fe)if(fe[xe]){const{index0:Re,index1:we}=fe[xe];lg.fromBufferAttribute(O,Re),cg.fromBufferAttribute(O,we),_e.push(lg.x,lg.y,lg.z),_e.push(cg.x,cg.y,cg.z)}this.setAttribute("position",new ki(_e,3))}}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}}class tp extends og{constructor(o){super(o),this.uuid=Sa(),this.type="Shape",this.holes=[]}getPointsHoles(o){const d=[];for(let v=0,b=this.holes.length;v<b;v++)d[v]=this.holes[v].getPoints(o);return d}extractPoints(o){return{shape:this.getPoints(o),holes:this.getPointsHoles(o)}}copy(o){super.copy(o),this.holes=[];for(let d=0,v=o.holes.length;d<v;d++){const b=o.holes[d];this.holes.push(b.clone())}return this}toJSON(){const o=super.toJSON();o.uuid=this.uuid,o.holes=[];for(let d=0,v=this.holes.length;d<v;d++){const b=this.holes[d];o.holes.push(b.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.uuid=o.uuid,this.holes=[];for(let d=0,v=o.holes.length;d<v;d++){const b=o.holes[d];this.holes.push(new og().fromJSON(b))}return this}}function Y0(I,o,d,v,b){let E,P;if(b===function(O,Q,G,te){let ge=0;for(let fe=Q,_e=G-te;fe<G;fe+=te)ge+=(O[_e]-O[fe])*(O[fe+1]+O[_e+1]),_e=fe;return ge}(I,o,d,v)>0)for(E=o;E<d;E+=v)P=nv(E,I[E],I[E+1],P);else for(E=d-v;E>=o;E-=v)P=nv(E,I[E],I[E+1],P);return P&&dg(P,P.next)&&($u(P),P=P.next),P}function np(I,o){if(!I)return I;o||(o=I);let d,v=I;do if(d=!1,v.steiner||!dg(v,v.next)&&Qs(v.prev,v,v.next)!==0)v=v.next;else{if($u(v),v=o=v.prev,v===v.next)break;d=!0}while(d||v!==o);return o}function ip(I,o,d,v,b,E,P){if(!I)return;!P&&E&&function(te,ge,fe,_e){let xe=te;do xe.z===0&&(xe.z=J0(xe.x,xe.y,ge,fe,_e)),xe.prevZ=xe.prev,xe.nextZ=xe.next,xe=xe.next;while(xe!==te);xe.prevZ.nextZ=null,xe.prevZ=null,function(Re){let we,Ce,De,ze,dt,rt,st,It,Kt=1;do{for(Ce=Re,Re=null,dt=null,rt=0;Ce;){for(rt++,De=Ce,st=0,we=0;we<Kt&&(st++,De=De.nextZ,De);we++);for(It=Kt;st>0||It>0&&De;)st!==0&&(It===0||!De||Ce.z<=De.z)?(ze=Ce,Ce=Ce.nextZ,st--):(ze=De,De=De.nextZ,It--),dt?dt.nextZ=ze:Re=ze,ze.prevZ=dt,dt=ze;Ce=De}dt.nextZ=null,Kt*=2}while(rt>1)}(xe)}(I,v,b,E);let O,Q,G=I;for(;I.prev!==I.next;)if(O=I.prev,Q=I.next,E?K0(I,v,b,E):TE(I))o.push(O.i/d|0),o.push(I.i/d|0),o.push(Q.i/d|0),$u(I),I=Q.next,G=Q.next;else if((I=Q)===G){P?P===1?ip(I=xb(np(I),o,d),o,d,v,b,E,2):P===2&&wb(I,o,d,v,b,E):ip(np(I),o,d,v,b,E,1);break}}function TE(I){const o=I.prev,d=I,v=I.next;if(Qs(o,d,v)>=0)return!1;const b=o.x,E=d.x,P=v.x,O=o.y,Q=d.y,G=v.y,te=b<E?b<P?b:P:E<P?E:P,ge=O<Q?O<G?O:G:Q<G?Q:G,fe=b>E?b>P?b:P:E>P?E:P,_e=O>Q?O>G?O:G:Q>G?Q:G;let xe=v.next;for(;xe!==o;){if(xe.x>=te&&xe.x<=fe&&xe.y>=ge&&xe.y<=_e&&Nf(b,O,E,Q,P,G,xe.x,xe.y)&&Qs(xe.prev,xe,xe.next)>=0)return!1;xe=xe.next}return!0}function K0(I,o,d,v){const b=I.prev,E=I,P=I.next;if(Qs(b,E,P)>=0)return!1;const O=b.x,Q=E.x,G=P.x,te=b.y,ge=E.y,fe=P.y,_e=O<Q?O<G?O:G:Q<G?Q:G,xe=te<ge?te<fe?te:fe:ge<fe?ge:fe,Re=O>Q?O>G?O:G:Q>G?Q:G,we=te>ge?te>fe?te:fe:ge>fe?ge:fe,Ce=J0(_e,xe,o,d,v),De=J0(Re,we,o,d,v);let ze=I.prevZ,dt=I.nextZ;for(;ze&&ze.z>=Ce&&dt&&dt.z<=De;){if(ze.x>=_e&&ze.x<=Re&&ze.y>=xe&&ze.y<=we&&ze!==b&&ze!==P&&Nf(O,te,Q,ge,G,fe,ze.x,ze.y)&&Qs(ze.prev,ze,ze.next)>=0||(ze=ze.prevZ,dt.x>=_e&&dt.x<=Re&&dt.y>=xe&&dt.y<=we&&dt!==b&&dt!==P&&Nf(O,te,Q,ge,G,fe,dt.x,dt.y)&&Qs(dt.prev,dt,dt.next)>=0))return!1;dt=dt.nextZ}for(;ze&&ze.z>=Ce;){if(ze.x>=_e&&ze.x<=Re&&ze.y>=xe&&ze.y<=we&&ze!==b&&ze!==P&&Nf(O,te,Q,ge,G,fe,ze.x,ze.y)&&Qs(ze.prev,ze,ze.next)>=0)return!1;ze=ze.prevZ}for(;dt&&dt.z<=De;){if(dt.x>=_e&&dt.x<=Re&&dt.y>=xe&&dt.y<=we&&dt!==b&&dt!==P&&Nf(O,te,Q,ge,G,fe,dt.x,dt.y)&&Qs(dt.prev,dt,dt.next)>=0)return!1;dt=dt.nextZ}return!0}function xb(I,o,d){let v=I;do{const b=v.prev,E=v.next.next;!dg(b,E)&&ey(b,v,v.next,E)&&rp(b,E)&&rp(E,b)&&(o.push(b.i/d|0),o.push(v.i/d|0),o.push(E.i/d|0),$u(v),$u(v.next),v=I=E),v=v.next}while(v!==I);return np(v)}function wb(I,o,d,v,b,E){let P=I;do{let O=P.next.next;for(;O!==P.prev;){if(P.i!==O.i&&hg(P,O)){let Q=kf(P,O);return P=np(P,P.next),Q=np(Q,Q.next),ip(P,o,d,v,b,E,0),void ip(Q,o,d,v,b,E,0)}O=O.next}P=P.next}while(P!==I)}function ME(I,o){return I.x-o.x}function Eb(I,o){const d=function(b,E){let P,O=E,Q=-1/0;const G=b.x,te=b.y;do{if(te<=O.y&&te>=O.next.y&&O.next.y!==O.y){const we=O.x+(te-O.y)*(O.next.x-O.x)/(O.next.y-O.y);if(we<=G&&we>Q&&(Q=we,P=O.x<O.next.x?O:O.next,we===G))return P}O=O.next}while(O!==E);if(!P)return null;const ge=P,fe=P.x,_e=P.y;let xe,Re=1/0;O=P;do G>=O.x&&O.x>=fe&&G!==O.x&&Nf(te<_e?G:Q,te,fe,_e,te<_e?Q:G,te,O.x,O.y)&&(xe=Math.abs(te-O.y)/(G-O.x),rp(O,b)&&(xe<Re||xe===Re&&(O.x>P.x||O.x===P.x&&$0(P,O)))&&(P=O,Re=xe)),O=O.next;while(O!==ge);return P}(I,o);if(!d)return o;const v=kf(d,I);return np(v,v.next),np(d,d.next)}function $0(I,o){return Qs(I.prev,I,o.prev)<0&&Qs(o.next,I,I.next)<0}function J0(I,o,d,v,b){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=(I-d)*b|0)|I<<8))|I<<4))|I<<2))|I<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-v)*b|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Z0(I){let o=I,d=I;do(o.x<d.x||o.x===d.x&&o.y<d.y)&&(d=o),o=o.next;while(o!==I);return d}function Nf(I,o,d,v,b,E,P,O){return(b-P)*(o-O)>=(I-P)*(E-O)&&(I-P)*(v-O)>=(d-P)*(o-O)&&(d-P)*(E-O)>=(b-P)*(v-O)}function hg(I,o){return I.next.i!==o.i&&I.prev.i!==o.i&&!function(d,v){let b=d;do{if(b.i!==d.i&&b.next.i!==d.i&&b.i!==v.i&&b.next.i!==v.i&&ey(b,b.next,d,v))return!0;b=b.next}while(b!==d);return!1}(I,o)&&(rp(I,o)&&rp(o,I)&&function(d,v){let b=d,E=!1;const P=(d.x+v.x)/2,O=(d.y+v.y)/2;do b.y>O!=b.next.y>O&&b.next.y!==b.y&&P<(b.next.x-b.x)*(O-b.y)/(b.next.y-b.y)+b.x&&(E=!E),b=b.next;while(b!==d);return E}(I,o)&&(Qs(I.prev,I,o.prev)||Qs(I,o.prev,o))||dg(I,o)&&Qs(I.prev,I,I.next)>0&&Qs(o.prev,o,o.next)>0)}function Qs(I,o,d){return(o.y-I.y)*(d.x-o.x)-(o.x-I.x)*(d.y-o.y)}function dg(I,o){return I.x===o.x&&I.y===o.y}function ey(I,o,d,v){const b=pg(Qs(I,o,d)),E=pg(Qs(I,o,v)),P=pg(Qs(d,v,I)),O=pg(Qs(d,v,o));return b!==E&&P!==O||!(b!==0||!tv(I,d,o))||!(E!==0||!tv(I,v,o))||!(P!==0||!tv(d,I,v))||!(O!==0||!tv(d,o,v))}function tv(I,o,d){return o.x<=Math.max(I.x,d.x)&&o.x>=Math.min(I.x,d.x)&&o.y<=Math.max(I.y,d.y)&&o.y>=Math.min(I.y,d.y)}function pg(I){return I>0?1:I<0?-1:0}function rp(I,o){return Qs(I.prev,I,I.next)<0?Qs(I,o,I.next)>=0&&Qs(I,I.prev,o)>=0:Qs(I,o,I.prev)<0||Qs(I,I.next,o)<0}function kf(I,o){const d=new Uf(I.i,I.x,I.y),v=new Uf(o.i,o.x,o.y),b=I.next,E=o.prev;return I.next=o,o.prev=I,d.next=b,b.prev=d,v.next=d,d.prev=v,E.next=v,v.prev=E,v}function nv(I,o,d,v){const b=new Uf(I,o,d);return v?(b.next=v.next,b.prev=v,v.next.prev=b,v.next=b):(b.prev=b,b.next=b),b}function $u(I){I.next.prev=I.prev,I.prev.next=I.next,I.prevZ&&(I.prevZ.nextZ=I.nextZ),I.nextZ&&(I.nextZ.prevZ=I.prevZ)}function Uf(I,o,d){this.i=I,this.x=o,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class pc{static area(o){const d=o.length;let v=0;for(let b=d-1,E=0;E<d;b=E++)v+=o[b].x*o[E].y-o[E].x*o[b].y;return .5*v}static isClockWise(o){return pc.area(o)<0}static triangulateShape(o,d){const v=[],b=[],E=[];Sb(o),Tb(v,o);let P=o.length;d.forEach(Sb);for(let Q=0;Q<d.length;Q++)b.push(P),P+=d[Q].length,Tb(v,d[Q]);const O=function(Q,G,te=2){const ge=G&&G.length,fe=ge?G[0]*te:Q.length;let _e=Y0(Q,0,fe,te,!0);const xe=[];if(!_e||_e.next===_e.prev)return xe;let Re,we,Ce,De,ze,dt,rt;if(ge&&(_e=function(st,It,Kt,Dt){const an=[];let Ot,Mn,Sn,ti,xi;for(Ot=0,Mn=It.length;Ot<Mn;Ot++)Sn=It[Ot]*Dt,ti=Ot<Mn-1?It[Ot+1]*Dt:st.length,xi=Y0(st,Sn,ti,Dt,!1),xi===xi.next&&(xi.steiner=!0),an.push(Z0(xi));for(an.sort(ME),Ot=0;Ot<an.length;Ot++)Kt=Eb(an[Ot],Kt);return Kt}(Q,G,_e,te)),Q.length>80*te){Re=Ce=Q[0],we=De=Q[1];for(let st=te;st<fe;st+=te)ze=Q[st],dt=Q[st+1],ze<Re&&(Re=ze),dt<we&&(we=dt),ze>Ce&&(Ce=ze),dt>De&&(De=dt);rt=Math.max(Ce-Re,De-we),rt=rt!==0?32767/rt:0}return ip(_e,xe,te,Re,we,rt,0),xe}(v,b);for(let Q=0;Q<O.length;Q+=3)E.push(O.slice(Q,Q+3));return E}}function Sb(I){const o=I.length;o>2&&I[o-1].equals(I[0])&&I.pop()}function Tb(I,o){for(let d=0;d<o.length;d++)I.push(o[d].x),I.push(o[d].y)}class fg extends Ie{constructor(o=new tp([new jn(.5,.5),new jn(-.5,.5),new jn(-.5,-.5),new jn(.5,-.5)]),d={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:o,options:d},o=Array.isArray(o)?o:[o];const v=this,b=[],E=[];for(let O=0,Q=o.length;O<Q;O++)P(o[O]);function P(O){const Q=[],G=d.curveSegments!==void 0?d.curveSegments:12,te=d.steps!==void 0?d.steps:1,ge=d.depth!==void 0?d.depth:1;let fe=d.bevelEnabled===void 0||d.bevelEnabled,_e=d.bevelThickness!==void 0?d.bevelThickness:.2,xe=d.bevelSize!==void 0?d.bevelSize:_e-.1,Re=d.bevelOffset!==void 0?d.bevelOffset:0,we=d.bevelSegments!==void 0?d.bevelSegments:3;const Ce=d.extrudePath,De=d.UVGenerator!==void 0?d.UVGenerator:Mb;let ze,dt,rt,st,It,Kt=!1;Ce&&(ze=Ce.getSpacedPoints(te),Kt=!0,fe=!1,dt=Ce.computeFrenetFrames(te,!1),rt=new At,st=new At,It=new At),fe||(we=0,_e=0,xe=0,Re=0);const Dt=O.extractPoints(G);let an=Dt.shape;const Ot=Dt.holes;if(!pc.isClockWise(an)){an=an.reverse();for(let Vt=0,Rt=Ot.length;Vt<Rt;Vt++){const Jt=Ot[Vt];pc.isClockWise(Jt)&&(Ot[Vt]=Jt.reverse())}}const Mn=pc.triangulateShape(an,Ot),Sn=an;for(let Vt=0,Rt=Ot.length;Vt<Rt;Vt++){const Jt=Ot[Vt];an=an.concat(Jt)}function ti(Vt,Rt,Jt){return Rt||console.error("THREE.ExtrudeGeometry: vec does not exist"),Vt.clone().addScaledVector(Rt,Jt)}const xi=an.length,ni=Mn.length;function Kn(Vt,Rt,Jt){let nt,Ft,kt;const Un=Vt.x-Rt.x,Nn=Vt.y-Rt.y,Wn=Jt.x-Vt.x,hi=Jt.y-Vt.y,Li=Un*Un+Nn*Nn,Fi=Un*hi-Nn*Wn;if(Math.abs(Fi)>Number.EPSILON){const Ei=Math.sqrt(Li),Ar=Math.sqrt(Wn*Wn+hi*hi),mr=Rt.x-Nn/Ei,Wi=Rt.y+Un/Ei,cs=((Jt.x-hi/Ar-mr)*hi-(Jt.y+Wn/Ar-Wi)*Wn)/(Un*hi-Nn*Wn);nt=mr+Un*cs-Vt.x,Ft=Wi+Nn*cs-Vt.y;const va=nt*nt+Ft*Ft;if(va<=2)return new jn(nt,Ft);kt=Math.sqrt(va/2)}else{let Ei=!1;Un>Number.EPSILON?Wn>Number.EPSILON&&(Ei=!0):Un<-Number.EPSILON?Wn<-Number.EPSILON&&(Ei=!0):Math.sign(Nn)===Math.sign(hi)&&(Ei=!0),Ei?(nt=-Nn,Ft=Un,kt=Math.sqrt(Li)):(nt=Un,Ft=Nn,kt=Math.sqrt(Li/2))}return new jn(nt/kt,Ft/kt)}const gi=[];for(let Vt=0,Rt=Sn.length,Jt=Rt-1,nt=Vt+1;Vt<Rt;Vt++,Jt++,nt++)Jt===Rt&&(Jt=0),nt===Rt&&(nt=0),gi[Vt]=Kn(Sn[Vt],Sn[Jt],Sn[nt]);const Ai=[];let wn,qn=gi.concat();for(let Vt=0,Rt=Ot.length;Vt<Rt;Vt++){const Jt=Ot[Vt];wn=[];for(let nt=0,Ft=Jt.length,kt=Ft-1,Un=nt+1;nt<Ft;nt++,kt++,Un++)kt===Ft&&(kt=0),Un===Ft&&(Un=0),wn[nt]=Kn(Jt[nt],Jt[kt],Jt[Un]);Ai.push(wn),qn=qn.concat(wn)}for(let Vt=0;Vt<we;Vt++){const Rt=Vt/we,Jt=_e*Math.cos(Rt*Math.PI/2),nt=xe*Math.sin(Rt*Math.PI/2)+Re;for(let Ft=0,kt=Sn.length;Ft<kt;Ft++){const Un=ti(Sn[Ft],gi[Ft],nt);Si(Un.x,Un.y,-Jt)}for(let Ft=0,kt=Ot.length;Ft<kt;Ft++){const Un=Ot[Ft];wn=Ai[Ft];for(let Nn=0,Wn=Un.length;Nn<Wn;Nn++){const hi=ti(Un[Nn],wn[Nn],nt);Si(hi.x,hi.y,-Jt)}}}const vi=xe+Re;for(let Vt=0;Vt<xi;Vt++){const Rt=fe?ti(an[Vt],qn[Vt],vi):an[Vt];Kt?(st.copy(dt.normals[0]).multiplyScalar(Rt.x),rt.copy(dt.binormals[0]).multiplyScalar(Rt.y),It.copy(ze[0]).add(st).add(rt),Si(It.x,It.y,It.z)):Si(Rt.x,Rt.y,0)}for(let Vt=1;Vt<=te;Vt++)for(let Rt=0;Rt<xi;Rt++){const Jt=fe?ti(an[Rt],qn[Rt],vi):an[Rt];Kt?(st.copy(dt.normals[Vt]).multiplyScalar(Jt.x),rt.copy(dt.binormals[Vt]).multiplyScalar(Jt.y),It.copy(ze[Vt]).add(st).add(rt),Si(It.x,It.y,It.z)):Si(Jt.x,Jt.y,ge/te*Vt)}for(let Vt=we-1;Vt>=0;Vt--){const Rt=Vt/we,Jt=_e*Math.cos(Rt*Math.PI/2),nt=xe*Math.sin(Rt*Math.PI/2)+Re;for(let Ft=0,kt=Sn.length;Ft<kt;Ft++){const Un=ti(Sn[Ft],gi[Ft],nt);Si(Un.x,Un.y,ge+Jt)}for(let Ft=0,kt=Ot.length;Ft<kt;Ft++){const Un=Ot[Ft];wn=Ai[Ft];for(let Nn=0,Wn=Un.length;Nn<Wn;Nn++){const hi=ti(Un[Nn],wn[Nn],nt);Kt?Si(hi.x,hi.y+ze[te-1].y,ze[te-1].x+Jt):Si(hi.x,hi.y,ge+Jt)}}}function ii(Vt,Rt){let Jt=Vt.length;for(;--Jt>=0;){const nt=Jt;let Ft=Jt-1;Ft<0&&(Ft=Vt.length-1);for(let kt=0,Un=te+2*we;kt<Un;kt++){const Nn=xi*kt,Wn=xi*(kt+1);Ct(Rt+nt+Nn,Rt+Ft+Nn,Rt+Ft+Wn,Rt+nt+Wn)}}}function Si(Vt,Rt,Jt){Q.push(Vt),Q.push(Rt),Q.push(Jt)}function rr(Vt,Rt,Jt){ut(Vt),ut(Rt),ut(Jt);const nt=b.length/3,Ft=De.generateTopUV(v,b,nt-3,nt-2,nt-1);tn(Ft[0]),tn(Ft[1]),tn(Ft[2])}function Ct(Vt,Rt,Jt,nt){ut(Vt),ut(Rt),ut(nt),ut(Rt),ut(Jt),ut(nt);const Ft=b.length/3,kt=De.generateSideWallUV(v,b,Ft-6,Ft-3,Ft-2,Ft-1);tn(kt[0]),tn(kt[1]),tn(kt[3]),tn(kt[1]),tn(kt[2]),tn(kt[3])}function ut(Vt){b.push(Q[3*Vt+0]),b.push(Q[3*Vt+1]),b.push(Q[3*Vt+2])}function tn(Vt){E.push(Vt.x),E.push(Vt.y)}(function(){const Vt=b.length/3;if(fe){let Rt=0,Jt=xi*Rt;for(let nt=0;nt<ni;nt++){const Ft=Mn[nt];rr(Ft[2]+Jt,Ft[1]+Jt,Ft[0]+Jt)}Rt=te+2*we,Jt=xi*Rt;for(let nt=0;nt<ni;nt++){const Ft=Mn[nt];rr(Ft[0]+Jt,Ft[1]+Jt,Ft[2]+Jt)}}else{for(let Rt=0;Rt<ni;Rt++){const Jt=Mn[Rt];rr(Jt[2],Jt[1],Jt[0])}for(let Rt=0;Rt<ni;Rt++){const Jt=Mn[Rt];rr(Jt[0]+xi*te,Jt[1]+xi*te,Jt[2]+xi*te)}}v.addGroup(Vt,b.length/3-Vt,0)})(),function(){const Vt=b.length/3;let Rt=0;ii(Sn,Rt),Rt+=Sn.length;for(let Jt=0,nt=Ot.length;Jt<nt;Jt++){const Ft=Ot[Jt];ii(Ft,Rt),Rt+=Ft.length}v.addGroup(Vt,b.length/3-Vt,1)}()}this.setAttribute("position",new ki(b,3)),this.setAttribute("uv",new ki(E,2)),this.computeVertexNormals()}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}toJSON(){const o=super.toJSON();return function(d,v,b){if(b.shapes=[],Array.isArray(d))for(let E=0,P=d.length;E<P;E++){const O=d[E];b.shapes.push(O.uuid)}else b.shapes.push(d.uuid);return b.options=Object.assign({},v),v.extrudePath!==void 0&&(b.options.extrudePath=v.extrudePath.toJSON()),b}(this.parameters.shapes,this.parameters.options,o)}static fromJSON(o,d){const v=[];for(let E=0,P=o.shapes.length;E<P;E++){const O=d[o.shapes[E]];v.push(O)}const b=o.options.extrudePath;return b!==void 0&&(o.options.extrudePath=new Gh[b.type]().fromJSON(b)),new fg(v,o.options)}}const Mb={generateTopUV:function(I,o,d,v,b){const E=o[3*d],P=o[3*d+1],O=o[3*v],Q=o[3*v+1],G=o[3*b],te=o[3*b+1];return[new jn(E,P),new jn(O,Q),new jn(G,te)]},generateSideWallUV:function(I,o,d,v,b,E){const P=o[3*d],O=o[3*d+1],Q=o[3*d+2],G=o[3*v],te=o[3*v+1],ge=o[3*v+2],fe=o[3*b],_e=o[3*b+1],xe=o[3*b+2],Re=o[3*E],we=o[3*E+1],Ce=o[3*E+2];return Math.abs(O-te)<Math.abs(P-G)?[new jn(P,1-Q),new jn(G,1-ge),new jn(fe,1-xe),new jn(Re,1-Ce)]:[new jn(O,1-Q),new jn(te,1-ge),new jn(_e,1-xe),new jn(we,1-Ce)]}};class mg extends Hc{constructor(o=1,d=0){const v=(1+Math.sqrt(5))/2;super([-1,v,0,1,v,0,-1,-v,0,1,-v,0,0,-1,v,0,1,v,0,-1,-v,0,1,-v,v,0,-1,v,0,1,-v,0,-1,-v,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],o,d),this.type="IcosahedronGeometry",this.parameters={radius:o,detail:d}}static fromJSON(o){return new mg(o.radius,o.detail)}}class sp extends Hc{constructor(o=1,d=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],o,d),this.type="OctahedronGeometry",this.parameters={radius:o,detail:d}}static fromJSON(o){return new sp(o.radius,o.detail)}}class gg extends Ie{constructor(o=.5,d=1,v=32,b=1,E=0,P=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:o,outerRadius:d,thetaSegments:v,phiSegments:b,thetaStart:E,thetaLength:P},v=Math.max(3,v);const O=[],Q=[],G=[],te=[];let ge=o;const fe=(d-o)/(b=Math.max(1,b)),_e=new At,xe=new jn;for(let Re=0;Re<=b;Re++){for(let we=0;we<=v;we++){const Ce=E+we/v*P;_e.x=ge*Math.cos(Ce),_e.y=ge*Math.sin(Ce),Q.push(_e.x,_e.y,_e.z),G.push(0,0,1),xe.x=(_e.x/d+1)/2,xe.y=(_e.y/d+1)/2,te.push(xe.x,xe.y)}ge+=fe}for(let Re=0;Re<b;Re++){const we=Re*(v+1);for(let Ce=0;Ce<v;Ce++){const De=Ce+we,ze=De,dt=De+v+1,rt=De+v+2,st=De+1;O.push(ze,dt,st),O.push(dt,rt,st)}}this.setIndex(O),this.setAttribute("position",new ki(Q,3)),this.setAttribute("normal",new ki(G,3)),this.setAttribute("uv",new ki(te,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new gg(o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength)}}class Ff extends Ie{constructor(o=new tp([new jn(0,.5),new jn(-.5,-.5),new jn(.5,-.5)]),d=12){super(),this.type="ShapeGeometry",this.parameters={shapes:o,curveSegments:d};const v=[],b=[],E=[],P=[];let O=0,Q=0;if(Array.isArray(o)===!1)G(o);else for(let te=0;te<o.length;te++)G(o[te]),this.addGroup(O,Q,te),O+=Q,Q=0;function G(te){const ge=b.length/3,fe=te.extractPoints(d);let _e=fe.shape;const xe=fe.holes;pc.isClockWise(_e)===!1&&(_e=_e.reverse());for(let we=0,Ce=xe.length;we<Ce;we++){const De=xe[we];pc.isClockWise(De)===!0&&(xe[we]=De.reverse())}const Re=pc.triangulateShape(_e,xe);for(let we=0,Ce=xe.length;we<Ce;we++){const De=xe[we];_e=_e.concat(De)}for(let we=0,Ce=_e.length;we<Ce;we++){const De=_e[we];b.push(De.x,De.y,0),E.push(0,0,1),P.push(De.x,De.y)}for(let we=0,Ce=Re.length;we<Ce;we++){const De=Re[we],ze=De[0]+ge,dt=De[1]+ge,rt=De[2]+ge;v.push(ze,dt,rt),Q+=3}}this.setIndex(v),this.setAttribute("position",new ki(b,3)),this.setAttribute("normal",new ki(E,3)),this.setAttribute("uv",new ki(P,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}toJSON(){const o=super.toJSON();return function(d,v){if(v.shapes=[],Array.isArray(d))for(let b=0,E=d.length;b<E;b++){const P=d[b];v.shapes.push(P.uuid)}else v.shapes.push(d.uuid);return v}(this.parameters.shapes,o)}static fromJSON(o,d){const v=[];for(let b=0,E=o.shapes.length;b<E;b++){const P=d[o.shapes[b]];v.push(P)}return new Ff(v,o.curveSegments)}}class zf extends Ie{constructor(o=1,d=32,v=16,b=0,E=2*Math.PI,P=0,O=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:o,widthSegments:d,heightSegments:v,phiStart:b,phiLength:E,thetaStart:P,thetaLength:O},d=Math.max(3,Math.floor(d)),v=Math.max(2,Math.floor(v));const Q=Math.min(P+O,Math.PI);let G=0;const te=[],ge=new At,fe=new At,_e=[],xe=[],Re=[],we=[];for(let Ce=0;Ce<=v;Ce++){const De=[],ze=Ce/v;let dt=0;Ce===0&&P===0?dt=.5/d:Ce===v&&Q===Math.PI&&(dt=-.5/d);for(let rt=0;rt<=d;rt++){const st=rt/d;ge.x=-o*Math.cos(b+st*E)*Math.sin(P+ze*O),ge.y=o*Math.cos(P+ze*O),ge.z=o*Math.sin(b+st*E)*Math.sin(P+ze*O),xe.push(ge.x,ge.y,ge.z),fe.copy(ge).normalize(),Re.push(fe.x,fe.y,fe.z),we.push(st+dt,1-ze),De.push(G++)}te.push(De)}for(let Ce=0;Ce<v;Ce++)for(let De=0;De<d;De++){const ze=te[Ce][De+1],dt=te[Ce][De],rt=te[Ce+1][De],st=te[Ce+1][De+1];(Ce!==0||P>0)&&_e.push(ze,dt,st),(Ce!==v-1||Q<Math.PI)&&_e.push(dt,rt,st)}this.setIndex(_e),this.setAttribute("position",new ki(xe,3)),this.setAttribute("normal",new ki(Re,3)),this.setAttribute("uv",new ki(we,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new zf(o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength)}}class Ju extends Hc{constructor(o=1,d=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],o,d),this.type="TetrahedronGeometry",this.parameters={radius:o,detail:d}}static fromJSON(o){return new Ju(o.radius,o.detail)}}class bu extends Ie{constructor(o=1,d=.4,v=12,b=48,E=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:o,tube:d,radialSegments:v,tubularSegments:b,arc:E},v=Math.floor(v),b=Math.floor(b);const P=[],O=[],Q=[],G=[],te=new At,ge=new At,fe=new At;for(let _e=0;_e<=v;_e++)for(let xe=0;xe<=b;xe++){const Re=xe/b*E,we=_e/v*Math.PI*2;ge.x=(o+d*Math.cos(we))*Math.cos(Re),ge.y=(o+d*Math.cos(we))*Math.sin(Re),ge.z=d*Math.sin(we),O.push(ge.x,ge.y,ge.z),te.x=o*Math.cos(Re),te.y=o*Math.sin(Re),fe.subVectors(ge,te).normalize(),Q.push(fe.x,fe.y,fe.z),G.push(xe/b),G.push(_e/v)}for(let _e=1;_e<=v;_e++)for(let xe=1;xe<=b;xe++){const Re=(b+1)*_e+xe-1,we=(b+1)*(_e-1)+xe-1,Ce=(b+1)*(_e-1)+xe,De=(b+1)*_e+xe;P.push(Re,we,De),P.push(we,Ce,De)}this.setIndex(P),this.setAttribute("position",new ki(O,3)),this.setAttribute("normal",new ki(Q,3)),this.setAttribute("uv",new ki(G,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new bu(o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc)}}class op extends Ie{constructor(o=1,d=.4,v=64,b=8,E=2,P=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:o,tube:d,tubularSegments:v,radialSegments:b,p:E,q:P},v=Math.floor(v),b=Math.floor(b);const O=[],Q=[],G=[],te=[],ge=new At,fe=new At,_e=new At,xe=new At,Re=new At,we=new At,Ce=new At;for(let ze=0;ze<=v;++ze){const dt=ze/v*E*Math.PI*2;De(dt,E,P,o,_e),De(dt+.01,E,P,o,xe),we.subVectors(xe,_e),Ce.addVectors(xe,_e),Re.crossVectors(we,Ce),Ce.crossVectors(Re,we),Re.normalize(),Ce.normalize();for(let rt=0;rt<=b;++rt){const st=rt/b*Math.PI*2,It=-d*Math.cos(st),Kt=d*Math.sin(st);ge.x=_e.x+(It*Ce.x+Kt*Re.x),ge.y=_e.y+(It*Ce.y+Kt*Re.y),ge.z=_e.z+(It*Ce.z+Kt*Re.z),Q.push(ge.x,ge.y,ge.z),fe.subVectors(ge,_e).normalize(),G.push(fe.x,fe.y,fe.z),te.push(ze/v),te.push(rt/b)}}for(let ze=1;ze<=v;ze++)for(let dt=1;dt<=b;dt++){const rt=(b+1)*(ze-1)+(dt-1),st=(b+1)*ze+(dt-1),It=(b+1)*ze+dt,Kt=(b+1)*(ze-1)+dt;O.push(rt,st,Kt),O.push(st,It,Kt)}function De(ze,dt,rt,st,It){const Kt=Math.cos(ze),Dt=Math.sin(ze),an=rt/dt*ze,Ot=Math.cos(an);It.x=st*(2+Ot)*.5*Kt,It.y=st*(2+Ot)*Dt*.5,It.z=st*Math.sin(an)*.5}this.setIndex(O),this.setAttribute("position",new ki(Q,3)),this.setAttribute("normal",new ki(G,3)),this.setAttribute("uv",new ki(te,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}static fromJSON(o){return new op(o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q)}}class Vf extends Ie{constructor(o=new X0(new At(-1,-1,0),new At(-1,1,0),new At(1,1,0)),d=64,v=1,b=8,E=!1){super(),this.type="TubeGeometry",this.parameters={path:o,tubularSegments:d,radius:v,radialSegments:b,closed:E};const P=o.computeFrenetFrames(d,E);this.tangents=P.tangents,this.normals=P.normals,this.binormals=P.binormals;const O=new At,Q=new At,G=new jn;let te=new At;const ge=[],fe=[],_e=[],xe=[];function Re(we){te=o.getPointAt(we/d,te);const Ce=P.normals[we],De=P.binormals[we];for(let ze=0;ze<=b;ze++){const dt=ze/b*Math.PI*2,rt=Math.sin(dt),st=-Math.cos(dt);Q.x=st*Ce.x+rt*De.x,Q.y=st*Ce.y+rt*De.y,Q.z=st*Ce.z+rt*De.z,Q.normalize(),fe.push(Q.x,Q.y,Q.z),O.x=te.x+v*Q.x,O.y=te.y+v*Q.y,O.z=te.z+v*Q.z,ge.push(O.x,O.y,O.z)}}(function(){for(let we=0;we<d;we++)Re(we);Re(E===!1?d:0),function(){for(let we=0;we<=d;we++)for(let Ce=0;Ce<=b;Ce++)G.x=we/d,G.y=Ce/b,_e.push(G.x,G.y)}(),function(){for(let we=1;we<=d;we++)for(let Ce=1;Ce<=b;Ce++){const De=(b+1)*(we-1)+(Ce-1),ze=(b+1)*we+(Ce-1),dt=(b+1)*we+Ce,rt=(b+1)*(we-1)+Ce;xe.push(De,ze,rt),xe.push(ze,dt,rt)}}()})(),this.setIndex(xe),this.setAttribute("position",new ki(ge,3)),this.setAttribute("normal",new ki(fe,3)),this.setAttribute("uv",new ki(_e,2))}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}toJSON(){const o=super.toJSON();return o.path=this.parameters.path.toJSON(),o}static fromJSON(o){return new Vf(new Gh[o.path.type]().fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed)}}class iv extends Ie{constructor(o=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:o},o!==null){const d=[],v=new Set,b=new At,E=new At;if(o.index!==null){const P=o.attributes.position,O=o.index;let Q=o.groups;Q.length===0&&(Q=[{start:0,count:O.count,materialIndex:0}]);for(let G=0,te=Q.length;G<te;++G){const ge=Q[G],fe=ge.start;for(let _e=fe,xe=fe+ge.count;_e<xe;_e+=3)for(let Re=0;Re<3;Re++){const we=O.getX(_e+Re),Ce=O.getX(_e+(Re+1)%3);b.fromBufferAttribute(P,we),E.fromBufferAttribute(P,Ce),ty(b,E,v)===!0&&(d.push(b.x,b.y,b.z),d.push(E.x,E.y,E.z))}}}else{const P=o.attributes.position;for(let O=0,Q=P.count/3;O<Q;O++)for(let G=0;G<3;G++){const te=3*O+G,ge=3*O+(G+1)%3;b.fromBufferAttribute(P,te),E.fromBufferAttribute(P,ge),ty(b,E,v)===!0&&(d.push(b.x,b.y,b.z),d.push(E.x,E.y,E.z))}}this.setAttribute("position",new ki(d,3))}}copy(o){return super.copy(o),this.parameters=Object.assign({},o.parameters),this}}function ty(I,o,d){const v=`${I.x},${I.y},${I.z}-${o.x},${o.y},${o.z}`,b=`${o.x},${o.y},${o.z}-${I.x},${I.y},${I.z}`;return d.has(v)!==!0&&d.has(b)!==!0&&(d.add(v),d.add(b),!0)}var jf=Object.freeze({__proto__:null,BoxGeometry:ac,CapsuleGeometry:Au,CircleGeometry:ag,ConeGeometry:Of,CylinderGeometry:ep,DodecahedronGeometry:Hh,EdgesGeometry:q0,ExtrudeGeometry:fg,IcosahedronGeometry:mg,LatheGeometry:yu,OctahedronGeometry:sp,PlaneGeometry:Nd,PolyhedronGeometry:Hc,RingGeometry:gg,ShapeGeometry:Ff,SphereGeometry:zf,TetrahedronGeometry:Ju,TorusGeometry:bu,TorusKnotGeometry:op,TubeGeometry:Vf,WireframeGeometry:iv});class ro extends Vo{constructor(o){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Mi(0),this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.fog=o.fog,this}}class Cb extends ta{constructor(o){super(o),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class ga extends Vo{constructor(o){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Mi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fs,this.normalScale=new jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={STANDARD:""},this.color.copy(o.color),this.roughness=o.roughness,this.metalness=o.metalness,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.roughnessMap=o.roughnessMap,this.metalnessMap=o.metalnessMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.envMapIntensity=o.envMapIntensity,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class _s extends ga{constructor(o){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new jn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return zs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(d){this.ior=(1+.4*d)/(1-.4*d)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Mi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Mi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Mi(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(o)}get sheen(){return this._sheen}set sheen(o){this._sheen>0!=o>0&&this.version++,this._sheen=o}get clearcoat(){return this._clearcoat}set clearcoat(o){this._clearcoat>0!=o>0&&this.version++,this._clearcoat=o}get iridescence(){return this._iridescence}set iridescence(o){this._iridescence>0!=o>0&&this.version++,this._iridescence=o}get transmission(){return this._transmission}set transmission(o){this._transmission>0!=o>0&&this.version++,this._transmission=o}copy(o){return super.copy(o),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=o.clearcoat,this.clearcoatMap=o.clearcoatMap,this.clearcoatRoughness=o.clearcoatRoughness,this.clearcoatRoughnessMap=o.clearcoatRoughnessMap,this.clearcoatNormalMap=o.clearcoatNormalMap,this.clearcoatNormalScale.copy(o.clearcoatNormalScale),this.ior=o.ior,this.iridescence=o.iridescence,this.iridescenceMap=o.iridescenceMap,this.iridescenceIOR=o.iridescenceIOR,this.iridescenceThicknessRange=[...o.iridescenceThicknessRange],this.iridescenceThicknessMap=o.iridescenceThicknessMap,this.sheen=o.sheen,this.sheenColor.copy(o.sheenColor),this.sheenColorMap=o.sheenColorMap,this.sheenRoughness=o.sheenRoughness,this.sheenRoughnessMap=o.sheenRoughnessMap,this.transmission=o.transmission,this.transmissionMap=o.transmissionMap,this.thickness=o.thickness,this.thicknessMap=o.thicknessMap,this.attenuationDistance=o.attenuationDistance,this.attenuationColor.copy(o.attenuationColor),this.specularIntensity=o.specularIntensity,this.specularIntensityMap=o.specularIntensityMap,this.specularColor.copy(o.specularColor),this.specularColorMap=o.specularColorMap,this}}class Gf extends Vo{constructor(o){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Mi(16777215),this.specular=new Mi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fs,this.normalScale=new jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ue,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.specular.copy(o.specular),this.shininess=o.shininess,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class Hf extends Vo{constructor(o){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Mi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fs,this.normalScale=new jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.gradientMap=o.gradientMap,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}class Rb extends Vo{constructor(o){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fs,this.normalScale=new jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(o)}copy(o){return super.copy(o),this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.flatShading=o.flatShading,this}}class ny extends Vo{constructor(o){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Mi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fs,this.normalScale=new jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ue,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class Ib extends Vo{constructor(o){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Mi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fs,this.normalScale=new jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={MATCAP:""},this.color.copy(o.color),this.matcap=o.matcap,this.map=o.map,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.flatShading=o.flatShading,this.fog=o.fog,this}}class Wf extends ka{constructor(o){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(o)}copy(o){return super.copy(o),this.scale=o.scale,this.dashSize=o.dashSize,this.gapSize=o.gapSize,this}}function el(I,o,d){return ap(I)?new I.constructor(I.subarray(o,d!==void 0?d:I.length)):I.slice(o,d)}function kl(I,o,d){return!I||!d&&I.constructor===o?I:typeof o.BYTES_PER_ELEMENT=="number"?new o(I):Array.prototype.slice.call(I)}function ap(I){return ArrayBuffer.isView(I)&&!(I instanceof DataView)}function Zu(I){const o=I.length,d=new Array(o);for(let v=0;v!==o;++v)d[v]=v;return d.sort(function(v,b){return I[v]-I[b]}),d}function Ua(I,o,d){const v=I.length,b=new I.constructor(v);for(let E=0,P=0;P!==v;++E){const O=d[E]*o;for(let Q=0;Q!==o;++Q)b[P++]=I[O+Q]}return b}function rv(I,o,d,v){let b=1,E=I[0];for(;E!==void 0&&E[v]===void 0;)E=I[b++];if(E===void 0)return;let P=E[v];if(P!==void 0)if(Array.isArray(P))do P=E[v],P!==void 0&&(o.push(E.time),d.push.apply(d,P)),E=I[b++];while(E!==void 0);else if(P.toArray!==void 0)do P=E[v],P!==void 0&&(o.push(E.time),P.toArray(d,d.length)),E=I[b++];while(E!==void 0);else do P=E[v],P!==void 0&&(o.push(E.time),d.push(P)),E=I[b++];while(E!==void 0)}const sv={arraySlice:el,convertArray:kl,isTypedArray:ap,getKeyframeOrder:Zu,sortedArray:Ua,flattenJSON:rv,subclip:function(I,o,d,v,b=30){const E=I.clone();E.name=o;const P=[];for(let Q=0;Q<E.tracks.length;++Q){const G=E.tracks[Q],te=G.getValueSize(),ge=[],fe=[];for(let _e=0;_e<G.times.length;++_e){const xe=G.times[_e]*b;if(!(xe<d||xe>=v)){ge.push(G.times[_e]);for(let Re=0;Re<te;++Re)fe.push(G.values[_e*te+Re])}}ge.length!==0&&(G.times=kl(ge,G.times.constructor),G.values=kl(fe,G.values.constructor),P.push(G))}E.tracks=P;let O=1/0;for(let Q=0;Q<E.tracks.length;++Q)O>E.tracks[Q].times[0]&&(O=E.tracks[Q].times[0]);for(let Q=0;Q<E.tracks.length;++Q)E.tracks[Q].shift(-1*O);return E.resetDuration(),E},makeClipAdditive:function(I,o=0,d=I,v=30){v<=0&&(v=30);const b=d.tracks.length,E=o/v;for(let P=0;P<b;++P){const O=d.tracks[P],Q=O.ValueTypeName;if(Q==="bool"||Q==="string")continue;const G=I.tracks.find(function(Ce){return Ce.name===O.name&&Ce.ValueTypeName===Q});if(G===void 0)continue;let te=0;const ge=O.getValueSize();O.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(te=ge/3);let fe=0;const _e=G.getValueSize();G.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(fe=_e/3);const xe=O.times.length-1;let Re;if(E<=O.times[0]){const Ce=te,De=ge-te;Re=el(O.values,Ce,De)}else if(E>=O.times[xe]){const Ce=xe*ge+te,De=Ce+ge-te;Re=el(O.values,Ce,De)}else{const Ce=O.createInterpolant(),De=te,ze=ge-te;Ce.evaluate(E),Re=el(Ce.resultBuffer,De,ze)}Q==="quaternion"&&new No().fromArray(Re).normalize().conjugate().toArray(Re);const we=G.times.length;for(let Ce=0;Ce<we;++Ce){const De=Ce*_e+fe;if(Q==="quaternion")No.multiplyQuaternionsFlat(G.values,De,Re,0,G.values,De);else{const ze=_e-2*fe;for(let dt=0;dt<ze;++dt)G.values[De+dt]-=Re[dt]}}}return I.blendMode=gs,I}};class _g{constructor(o,d,v,b){this.parameterPositions=o,this._cachedIndex=0,this.resultBuffer=b!==void 0?b:new d.constructor(v),this.sampleValues=d,this.valueSize=v,this.settings=null,this.DefaultSettings_={}}evaluate(o){const d=this.parameterPositions;let v=this._cachedIndex,b=d[v],E=d[v-1];t:{e:{let P;n:{i:if(!(o<b)){for(let O=v+2;;){if(b===void 0){if(o<E)break i;return v=d.length,this._cachedIndex=v,this.copySampleValue_(v-1)}if(v===O)break;if(E=b,b=d[++v],o<b)break e}P=d.length;break n}if(o>=E)break t;{const O=d[1];o<O&&(v=2,E=O);for(let Q=v-2;;){if(E===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(v===Q)break;if(b=E,E=d[--v-1],o>=E)break e}P=v,v=0}}for(;v<P;){const O=v+P>>>1;o<d[O]?P=O:v=O+1}if(b=d[v],E=d[v-1],E===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(b===void 0)return v=d.length,this._cachedIndex=v,this.copySampleValue_(v-1)}this._cachedIndex=v,this.intervalChanged_(v,E,b)}return this.interpolate_(v,E,o,b)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(o){const d=this.resultBuffer,v=this.sampleValues,b=this.valueSize,E=o*b;for(let P=0;P!==b;++P)d[P]=v[E+P];return d}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Qf extends _g{constructor(o,d,v,b){super(o,d,v,b),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ur,endingEnd:ur}}intervalChanged_(o,d,v){const b=this.parameterPositions;let E=o-2,P=o+1,O=b[E],Q=b[P];if(O===void 0)switch(this.getSettings_().endingStart){case eo:E=o,O=2*d-v;break;case Jo:E=b.length-2,O=d+b[E]-b[E+1];break;default:E=o,O=v}if(Q===void 0)switch(this.getSettings_().endingEnd){case eo:P=o,Q=2*v-d;break;case Jo:P=1,Q=v+b[1]-b[0];break;default:P=o-1,Q=d}const G=.5*(v-d),te=this.valueSize;this._weightPrev=G/(d-O),this._weightNext=G/(Q-v),this._offsetPrev=E*te,this._offsetNext=P*te}interpolate_(o,d,v,b){const E=this.resultBuffer,P=this.sampleValues,O=this.valueSize,Q=o*O,G=Q-O,te=this._offsetPrev,ge=this._offsetNext,fe=this._weightPrev,_e=this._weightNext,xe=(v-d)/(b-d),Re=xe*xe,we=Re*xe,Ce=-fe*we+2*fe*Re-fe*xe,De=(1+fe)*we+(-1.5-2*fe)*Re+(-.5+fe)*xe+1,ze=(-1-_e)*we+(1.5+_e)*Re+.5*xe,dt=_e*we-_e*Re;for(let rt=0;rt!==O;++rt)E[rt]=Ce*P[te+rt]+De*P[G+rt]+ze*P[Q+rt]+dt*P[ge+rt];return E}}class xu extends _g{constructor(o,d,v,b){super(o,d,v,b)}interpolate_(o,d,v,b){const E=this.resultBuffer,P=this.sampleValues,O=this.valueSize,Q=o*O,G=Q-O,te=(v-d)/(b-d),ge=1-te;for(let fe=0;fe!==O;++fe)E[fe]=P[G+fe]*ge+P[Q+fe]*te;return E}}class Wh extends _g{constructor(o,d,v,b){super(o,d,v,b)}interpolate_(o){return this.copySampleValue_(o-1)}}class Qo{constructor(o,d,v,b){if(o===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(d===void 0||d.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+o);this.name=o,this.times=kl(d,this.TimeBufferType),this.values=kl(v,this.ValueBufferType),this.setInterpolation(b||this.DefaultInterpolation)}static toJSON(o){const d=o.constructor;let v;if(d.toJSON!==this.toJSON)v=d.toJSON(o);else{v={name:o.name,times:kl(o.times,Array),values:kl(o.values,Array)};const b=o.getInterpolation();b!==o.DefaultInterpolation&&(v.interpolation=b)}return v.type=o.ValueTypeName,v}InterpolantFactoryMethodDiscrete(o){return new Wh(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodLinear(o){return new xu(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodSmooth(o){return new Qf(this.times,this.values,this.getValueSize(),o)}setInterpolation(o){let d;switch(o){case Zi:d=this.InterpolantFactoryMethodDiscrete;break;case kr:d=this.InterpolantFactoryMethodLinear;break;case sr:d=this.InterpolantFactoryMethodSmooth}if(d===void 0){const v="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(o===this.DefaultInterpolation)throw new Error(v);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",v),this}return this.createInterpolant=d,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Zi;case this.InterpolantFactoryMethodLinear:return kr;case this.InterpolantFactoryMethodSmooth:return sr}}getValueSize(){return this.values.length/this.times.length}shift(o){if(o!==0){const d=this.times;for(let v=0,b=d.length;v!==b;++v)d[v]+=o}return this}scale(o){if(o!==1){const d=this.times;for(let v=0,b=d.length;v!==b;++v)d[v]*=o}return this}trim(o,d){const v=this.times,b=v.length;let E=0,P=b-1;for(;E!==b&&v[E]<o;)++E;for(;P!==-1&&v[P]>d;)--P;if(++P,E!==0||P!==b){E>=P&&(P=Math.max(P,1),E=P-1);const O=this.getValueSize();this.times=el(v,E,P),this.values=el(this.values,E*O,P*O)}return this}validate(){let o=!0;const d=this.getValueSize();d-Math.floor(d)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),o=!1);const v=this.times,b=this.values,E=v.length;E===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),o=!1);let P=null;for(let O=0;O!==E;O++){const Q=v[O];if(typeof Q=="number"&&isNaN(Q)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,O,Q),o=!1;break}if(P!==null&&P>Q){console.error("THREE.KeyframeTrack: Out of order keys.",this,O,Q,P),o=!1;break}P=Q}if(b!==void 0&&ap(b))for(let O=0,Q=b.length;O!==Q;++O){const G=b[O];if(isNaN(G)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,O,G),o=!1;break}}return o}optimize(){const o=el(this.times),d=el(this.values),v=this.getValueSize(),b=this.getInterpolation()===sr,E=o.length-1;let P=1;for(let O=1;O<E;++O){let Q=!1;const G=o[O];if(G!==o[O+1]&&(O!==1||G!==o[0]))if(b)Q=!0;else{const te=O*v,ge=te-v,fe=te+v;for(let _e=0;_e!==v;++_e){const xe=d[te+_e];if(xe!==d[ge+_e]||xe!==d[fe+_e]){Q=!0;break}}}if(Q){if(O!==P){o[P]=o[O];const te=O*v,ge=P*v;for(let fe=0;fe!==v;++fe)d[ge+fe]=d[te+fe]}++P}}if(E>0){o[P]=o[E];for(let O=E*v,Q=P*v,G=0;G!==v;++G)d[Q+G]=d[O+G];++P}return P!==o.length?(this.times=el(o,0,P),this.values=el(d,0,P*v)):(this.times=o,this.values=d),this}clone(){const o=el(this.times,0),d=el(this.values,0),v=new this.constructor(this.name,o,d);return v.createInterpolant=this.createInterpolant,v}}Qo.prototype.TimeBufferType=Float32Array,Qo.prototype.ValueBufferType=Float32Array,Qo.prototype.DefaultInterpolation=kr;class eh extends Qo{}eh.prototype.ValueTypeName="bool",eh.prototype.ValueBufferType=Array,eh.prototype.DefaultInterpolation=Zi,eh.prototype.InterpolantFactoryMethodLinear=void 0,eh.prototype.InterpolantFactoryMethodSmooth=void 0;class Ro extends Qo{}Ro.prototype.ValueTypeName="color";class lp extends Qo{}lp.prototype.ValueTypeName="number";class iy extends _g{constructor(o,d,v,b){super(o,d,v,b)}interpolate_(o,d,v,b){const E=this.resultBuffer,P=this.sampleValues,O=this.valueSize,Q=(v-d)/(b-d);let G=o*O;for(let te=G+O;G!==te;G+=4)No.slerpFlat(E,0,P,G-O,P,G,Q);return E}}class th extends Qo{InterpolantFactoryMethodLinear(o){return new iy(this.times,this.values,this.getValueSize(),o)}}th.prototype.ValueTypeName="quaternion",th.prototype.DefaultInterpolation=kr,th.prototype.InterpolantFactoryMethodSmooth=void 0;class xl extends Qo{}xl.prototype.ValueTypeName="string",xl.prototype.ValueBufferType=Array,xl.prototype.DefaultInterpolation=Zi,xl.prototype.InterpolantFactoryMethodLinear=void 0,xl.prototype.InterpolantFactoryMethodSmooth=void 0;class ra extends Qo{}ra.prototype.ValueTypeName="vector";class Xf{constructor(o,d=-1,v,b=to){this.name=o,this.tracks=v,this.duration=d,this.blendMode=b,this.uuid=Sa(),this.duration<0&&this.resetDuration()}static parse(o){const d=[],v=o.tracks,b=1/(o.fps||1);for(let P=0,O=v.length;P!==O;++P)d.push(Ul(v[P]).scale(b));const E=new this(o.name,o.duration,d,o.blendMode);return E.uuid=o.uuid,E}static toJSON(o){const d=[],v=o.tracks,b={name:o.name,duration:o.duration,tracks:d,uuid:o.uuid,blendMode:o.blendMode};for(let E=0,P=v.length;E!==P;++E)d.push(Qo.toJSON(v[E]));return b}static CreateFromMorphTargetSequence(o,d,v,b){const E=d.length,P=[];for(let O=0;O<E;O++){let Q=[],G=[];Q.push((O+E-1)%E,O,(O+1)%E),G.push(0,1,0);const te=Zu(Q);Q=Ua(Q,1,te),G=Ua(G,1,te),b||Q[0]!==0||(Q.push(E),G.push(G[0])),P.push(new lp(".morphTargetInfluences["+d[O].name+"]",Q,G).scale(1/v))}return new this(o,-1,P)}static findByName(o,d){let v=o;if(!Array.isArray(o)){const b=o;v=b.geometry&&b.geometry.animations||b.animations}for(let b=0;b<v.length;b++)if(v[b].name===d)return v[b];return null}static CreateClipsFromMorphTargetSequences(o,d,v){const b={},E=/^([\w-]*?)([\d]+)$/;for(let O=0,Q=o.length;O<Q;O++){const G=o[O],te=G.name.match(E);if(te&&te.length>1){const ge=te[1];let fe=b[ge];fe||(b[ge]=fe=[]),fe.push(G)}}const P=[];for(const O in b)P.push(this.CreateFromMorphTargetSequence(O,b[O],d,v));return P}static parseAnimation(o,d){if(!o)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const v=function(te,ge,fe,_e,xe){if(fe.length!==0){const Re=[],we=[];rv(fe,Re,we,_e),Re.length!==0&&xe.push(new te(ge,Re,we))}},b=[],E=o.name||"default",P=o.fps||30,O=o.blendMode;let Q=o.length||-1;const G=o.hierarchy||[];for(let te=0;te<G.length;te++){const ge=G[te].keys;if(ge&&ge.length!==0)if(ge[0].morphTargets){const fe={};let _e;for(_e=0;_e<ge.length;_e++)if(ge[_e].morphTargets)for(let xe=0;xe<ge[_e].morphTargets.length;xe++)fe[ge[_e].morphTargets[xe]]=-1;for(const xe in fe){const Re=[],we=[];for(let Ce=0;Ce!==ge[_e].morphTargets.length;++Ce){const De=ge[_e];Re.push(De.time),we.push(De.morphTarget===xe?1:0)}b.push(new lp(".morphTargetInfluence["+xe+"]",Re,we))}Q=fe.length*P}else{const fe=".bones["+d[te].name+"]";v(ra,fe+".position",ge,"pos",b),v(th,fe+".quaternion",ge,"rot",b),v(ra,fe+".scale",ge,"scl",b)}}return b.length===0?null:new this(E,Q,b,O)}resetDuration(){let o=0;for(let d=0,v=this.tracks.length;d!==v;++d){const b=this.tracks[d];o=Math.max(o,b.times[b.times.length-1])}return this.duration=o,this}trim(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].trim(0,this.duration);return this}validate(){let o=!0;for(let d=0;d<this.tracks.length;d++)o=o&&this.tracks[d].validate();return o}optimize(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].optimize();return this}clone(){const o=[];for(let d=0;d<this.tracks.length;d++)o.push(this.tracks[d].clone());return new this.constructor(this.name,this.duration,o,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ul(I){if(I.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const o=function(d){switch(d.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return lp;case"vector":case"vector2":case"vector3":case"vector4":return ra;case"color":return Ro;case"quaternion":return th;case"bool":case"boolean":return eh;case"string":return xl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+d)}(I.type);if(I.times===void 0){const d=[],v=[];rv(I.keys,d,v,"value"),I.times=d,I.values=v}return o.parse!==void 0?o.parse(I):new o(I.name,I.times,I.values,I.interpolation)}const Wc={enabled:!1,files:{},add:function(I,o){this.enabled!==!1&&(this.files[I]=o)},get:function(I,o){return this.enabled===!1?o?Promise.resolve():void 0:o?Promise.resolve(this.files[I]):this.files[I]},remove:function(I){delete this.files[I]},clear:function(){this.files={}}};class ry{constructor(o,d,v){const b=this;let E,P=!1,O=0,Q=0;const G=[];this.onStart=void 0,this.onLoad=o,this.onProgress=d,this.onError=v,this.itemStart=function(te){Q++,P===!1&&b.onStart!==void 0&&b.onStart(te,O,Q),P=!0},this.itemEnd=function(te){O++,b.onProgress!==void 0&&b.onProgress(te,O,Q),O===Q&&(P=!1,b.onLoad!==void 0&&b.onLoad())},this.itemError=function(te){b.onError!==void 0&&b.onError(te)},this.resolveURL=function(te){return E?E(te):te},this.setURLModifier=function(te){return E=te,this},this.addHandler=function(te,ge){return G.push(te,ge),this},this.removeHandler=function(te){const ge=G.indexOf(te);return ge!==-1&&G.splice(ge,2),this},this.getHandler=function(te){for(let ge=0,fe=G.length;ge<fe;ge+=2){const _e=G[ge],xe=G[ge+1];if(_e.global&&(_e.lastIndex=0),_e.test(te))return xe}return null}}}const Pb=new ry;class wl{constructor(o){this.manager=o!==void 0?o:Pb,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(o,d){const v=this;return new Promise(function(b,E){v.load(o,b,d,E)})}parse(){}setCrossOrigin(o){return this.crossOrigin=o,this}setWithCredentials(o){return this.withCredentials=o,this}setPath(o){return this.path=o,this}setResourcePath(o){return this.resourcePath=o,this}setRequestHeader(o){return this.requestHeader=o,this}}const Fl={};class ov extends Error{constructor(o,d){super(o),this.response=d}}class po extends wl{constructor(o){super(o),this.responseType="text",this.useCache=!0}load(o,d,v,b){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o),(this.useCache?Wc.get(o,this.responseType,this.mimeType):Promise.resolve(void 0)).then(E=>{if(E!==void 0)return this.manager.itemStart(o),setTimeout(()=>{d&&d(E),this.manager.itemEnd(o)},0),E;if(Fl[o]!==void 0)return void Fl[o].push({onLoad:d,onProgress:v,onError:b});Fl[o]=[],Fl[o].push({onLoad:d,onProgress:v,onError:b});const P=new Request(o,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),O=this.mimeType,Q=this.responseType;fetch(P).then(G=>{if(G.status===200||G.status===0){if(G.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||G.body===void 0||G.body.getReader===void 0)return G;const te=Fl[o],ge=G.body.getReader(),fe=G.headers.get("Content-Length")||G.headers.get("X-File-Size"),_e=fe?parseInt(fe):0,xe=_e!==0;let Re=0;const we=new ReadableStream({start(Ce){(function De(){ge.read().then(({done:ze,value:dt})=>{if(ze)Ce.close();else{Re+=dt.byteLength;const rt=new ProgressEvent("progress",{lengthComputable:xe,loaded:Re,total:_e});for(let st=0,It=te.length;st<It;st++){const Kt=te[st];Kt.onProgress&&Kt.onProgress(rt)}Ce.enqueue(dt),De()}})})()}});return new Response(we)}throw new ov(`fetch for "${G.url}" responded with ${G.status}: ${G.statusText}`,G)}).then(G=>{switch(Q){case"arraybuffer":return G.arrayBuffer();case"blob":return G.blob();case"document":return G.text().then(te=>new DOMParser().parseFromString(te,O));case"json":return G.json();default:if(O===void 0)return G.text();{const te=/charset="?([^;"\s]*)"?/i.exec(O),ge=te&&te[1]?te[1].toLowerCase():void 0,fe=new TextDecoder(ge);return G.arrayBuffer().then(_e=>fe.decode(_e))}}}).then(G=>{this.useCache&&Wc.add(o,G,this.responseType);const te=Fl[o];delete Fl[o];for(let ge=0,fe=te.length;ge<fe;ge++){const _e=te[ge];_e.onLoad&&_e.onLoad(G)}}).catch(G=>{const te=Fl[o];if(te===void 0)throw this.manager.itemError(o),G;delete Fl[o];for(let ge=0,fe=te.length;ge<fe;ge++){const _e=te[ge];_e.onError&&_e.onError(G)}this.manager.itemError(o)}).finally(()=>{this.useCache&&this.manager.itemEnd(o)}),this.useCache&&this.manager.itemStart(o)})}setResponseType(o){return this.responseType=o,this}setMimeType(o){return this.mimeType=o,this}}class CE extends wl{constructor(o){super(o)}load(o,d,v,b){const E=this,P=new po(this.manager);P.setPath(this.path),P.setRequestHeader(this.requestHeader),P.setWithCredentials(this.withCredentials),P.load(o,function(O){try{d(E.parse(JSON.parse(O)))}catch(Q){b?b(Q):console.error(Q),E.manager.itemError(o)}},v,b)}parse(o){const d=[];for(let v=0;v<o.length;v++){const b=Xf.parse(o[v]);d.push(b)}return d}}class qf extends wl{constructor(o){super(o)}load(o,d,v,b){const E=this,P=[],O=new H0,Q=new po(this.manager);Q.setPath(this.path),Q.setResponseType("arraybuffer"),Q.setRequestHeader(this.requestHeader),Q.setWithCredentials(E.withCredentials);let G=0;function te(ge){Q.load(o[ge],function(fe){const _e=E.parse(fe,!0);P[ge]={width:_e.width,height:_e.height,format:_e.format,mipmaps:_e.mipmaps},G+=1,G===6&&(_e.mipmapCount===1&&(O.minFilter=en),O.image=P,O.format=_e.format,O.needsUpdate=!0,d&&d(O))},v,b)}if(Array.isArray(o))for(let ge=0,fe=o.length;ge<fe;++ge)te(ge);else Q.load(o,function(ge){const fe=E.parse(ge,!0);if(fe.isCubemap){const _e=fe.mipmaps.length/fe.mipmapCount;for(let xe=0;xe<_e;xe++){P[xe]={mipmaps:[]};for(let Re=0;Re<fe.mipmapCount;Re++)P[xe].mipmaps.push(fe.mipmaps[xe*fe.mipmapCount+Re]),P[xe].format=fe.format,P[xe].width=fe.width,P[xe].height=fe.height}O.image=P}else O.image.width=fe.width,O.image.height=fe.height,O.mipmaps=fe.mipmaps;fe.mipmapCount===1&&(O.minFilter=en),O.format=fe.format,O.needsUpdate=!0,d&&d(O)},v,b);return O}}class Yf extends wl{constructor(o){super(o)}load(o,d,v,b){const E=o;this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const P=this,O=Wc.get(o);if(O!==void 0)return P.manager.itemStart(o),setTimeout(function(){d&&d(O),P.manager.itemEnd(o)},0),O;const Q=xh("img");function G(){ge(),Wc.add(o,this),d&&d(this),P.manager.itemEnd(o)}function te(fe){ge(),b&&b(fe),P.manager.itemError(o),P.manager.itemEnd(o)}function ge(){Q.removeEventListener("load",G,!1),Q.removeEventListener("error",te,!1)}return Q.addEventListener("load",G,!1),Q.addEventListener("error",te,!1),o.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(Q.crossOrigin=this.crossOrigin),P.manager.itemStart(o),Wc.get(o,"blob").then(fe=>{if(fe!==void 0&&!fe.type.startsWith("text/plain"))return fe.type||(o.endsWith(".svg")||o.startsWith("data:image/svg"))&&(fe=new Blob([fe],{type:"image/svg+xml"})),void(Q.src=URL.createObjectURL(fe));const _e=new po(this.manager);_e.useCache=!1,_e.setPath(this.path),_e.setCrossOrigin(this.crossOrigin),_e.setResponseType("blob"),_e.load(E,function(xe){xe.type||(o.endsWith(".svg")||o.startsWith("data:image/svg"))&&(xe=new Blob([xe],{type:"image/svg+xml"})),Wc.add(o,xe,"blob"),Q.src=URL.createObjectURL(xe)},v,xe=>{ge(),b&&b(xe)})}),Q}}class Db extends wl{constructor(o){super(o)}load(o,d,v,b){const E=new Mm,P=new Yf(this.manager);P.setCrossOrigin(this.crossOrigin),P.setPath(this.path);let O=0;function Q(G){P.load(o[G],function(te){E.images[G]=te,O++,O===6&&(E.needsUpdate=!0,d&&d(E))},void 0,b)}for(let G=0;G<o.length;++G)Q(G);return E}}class av extends wl{constructor(o){super(o)}load(o,d,v,b){const E=this,P=new Yu,O=new po(this.manager);return O.setResponseType("arraybuffer"),O.setRequestHeader(this.requestHeader),O.setPath(this.path),O.setWithCredentials(E.withCredentials),O.load(o,function(Q){const G=E.parse(Q);G&&(G.image!==void 0?P.image=G.image:G.data!==void 0&&(P.image.width=G.width,P.image.height=G.height,P.image.data=G.data,P.image.complete=!0),P.wrapS=G.wrapS!==void 0?G.wrapS:pt,P.wrapT=G.wrapT!==void 0?G.wrapT:pt,P.magFilter=G.magFilter!==void 0?G.magFilter:en,P.minFilter=G.minFilter!==void 0?G.minFilter:en,P.anisotropy=G.anisotropy!==void 0?G.anisotropy:1,G.colorSpace!==void 0?P.colorSpace=G.colorSpace:G.encoding!==void 0&&(P.encoding=G.encoding),G.flipY!==void 0&&(P.flipY=G.flipY),G.format!==void 0&&(P.format=G.format),G.type!==void 0&&(P.type=G.type),G.mipmaps!==void 0&&(P.mipmaps=G.mipmaps,P.minFilter=Gi),G.mipmapCount===1&&(P.minFilter=en),G.generateMipmaps!==void 0&&(P.generateMipmaps=G.generateMipmaps),P.needsUpdate=!0,d&&d(P,G))},v,b),P}}class Lb extends wl{constructor(o){super(o)}load(o,d,v,b){const E=new Vs,P=new Yf(this.manager);return P.setCrossOrigin(this.crossOrigin),P.setPath(this.path),P.load(o,function(O){E.image=O,E.needsUpdate=!0,d!==void 0&&d(E)},v,b),E}}class wu extends Gr{constructor(o,d=1){super(),this.isLight=!0,this.type="Light",this.color=new Mi(o),this.intensity=d}dispose(){}copy(o,d){return super.copy(o,d),this.color.copy(o.color),this.intensity=o.intensity,this}toJSON(o){const d=super.toJSON(o);return d.object.color=this.color.getHex(),d.object.intensity=this.intensity,this.groundColor!==void 0&&(d.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(d.object.distance=this.distance),this.angle!==void 0&&(d.object.angle=this.angle),this.decay!==void 0&&(d.object.decay=this.decay),this.penumbra!==void 0&&(d.object.penumbra=this.penumbra),this.shadow!==void 0&&(d.object.shadow=this.shadow.toJSON()),d}}class Qh extends wu{constructor(o,d,v){super(o,v),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Gr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Mi(d)}copy(o,d){return super.copy(o,d),this.groundColor.copy(o.groundColor),this}}const vg=new Sr,yg=new At,Qc=new At;class sy{constructor(o){this.camera=o,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new jn(512,512),this.map=null,this.mapPass=null,this.matrix=new Sr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new T_,this._frameExtents=new jn(1,1),this._viewportCount=1,this._viewports=[new Yr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(o){const d=this.camera,v=this.matrix;yg.setFromMatrixPosition(o.matrixWorld),d.position.copy(yg),Qc.setFromMatrixPosition(o.target.matrixWorld),d.lookAt(Qc),d.updateMatrixWorld(),vg.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vg),v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(vg)}getViewport(o){return this._viewports[o]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(o){return this.camera=o.camera.clone(),this.bias=o.bias,this.normalBias=o.normalBias,this.radius=o.radius,this.mapSize.copy(o.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const o={};return this.bias!==0&&(o.bias=this.bias),this.normalBias!==0&&(o.normalBias=this.normalBias),this.radius!==1&&(o.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(o.mapSize=this.mapSize.toArray()),o.camera=this.camera.toJSON(!1).object,delete o.camera.matrix,o}}class RE extends sy{constructor(){super(new Go(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(o){const d=this.camera,v=2*hl*o.angle*this.focus,b=this.mapSize.width/this.mapSize.height,E=o.distance||d.far;v===d.fov&&b===d.aspect&&E===d.far||(d.fov=v,d.aspect=b,d.far=E,d.updateProjectionMatrix()),super.updateMatrices(o)}copy(o){return super.copy(o),this.focus=o.focus,this}}class oy extends wu{constructor(o,d,v=0,b=Math.PI/3,E=0,P=2){super(o,d),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Gr.DEFAULT_UP),this.updateMatrix(),this.target=new Gr,this.distance=v,this.angle=b,this.penumbra=E,this.decay=P,this.map=null,this.shadow=new RE}get power(){return this.intensity*Math.PI}set power(o){this.intensity=o/Math.PI}dispose(){this.shadow.dispose()}copy(o,d){return super.copy(o,d),this.distance=o.distance,this.angle=o.angle,this.penumbra=o.penumbra,this.decay=o.decay,this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}const lv=new Sr,Kf=new At,zl=new At;class IE extends sy{constructor(){super(new Go(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new jn(4,2),this._viewportCount=6,this._viewports=[new Yr(2,1,1,1),new Yr(0,1,1,1),new Yr(3,1,1,1),new Yr(1,1,1,1),new Yr(3,0,1,1),new Yr(1,0,1,1)],this._cubeDirections=[new At(1,0,0),new At(-1,0,0),new At(0,0,1),new At(0,0,-1),new At(0,1,0),new At(0,-1,0)],this._cubeUps=[new At(0,1,0),new At(0,1,0),new At(0,1,0),new At(0,1,0),new At(0,0,1),new At(0,0,-1)]}updateMatrices(o,d=0){const v=this.camera,b=this.matrix,E=o.distance||v.far;E!==v.far&&(v.far=E,v.updateProjectionMatrix()),Kf.setFromMatrixPosition(o.matrixWorld),v.position.copy(Kf),zl.copy(v.position),zl.add(this._cubeDirections[d]),v.up.copy(this._cubeUps[d]),v.lookAt(zl),v.updateMatrixWorld(),b.makeTranslation(-Kf.x,-Kf.y,-Kf.z),lv.multiplyMatrices(v.projectionMatrix,v.matrixWorldInverse),this._frustum.setFromProjectionMatrix(lv)}}class Bb extends wu{constructor(o,d,v=0,b=2){super(o,d),this.isPointLight=!0,this.type="PointLight",this.distance=v,this.decay=b,this.shadow=new IE}get power(){return 4*this.intensity*Math.PI}set power(o){this.intensity=o/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(o,d){return super.copy(o,d),this.distance=o.distance,this.decay=o.decay,this.shadow=o.shadow.clone(),this}}class Ob extends sy{constructor(){super(new C_(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Vl extends wu{constructor(o,d){super(o,d),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Gr.DEFAULT_UP),this.updateMatrix(),this.target=new Gr,this.shadow=new Ob}dispose(){this.shadow.dispose()}copy(o){return super.copy(o),this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}class cv extends wu{constructor(o,d){super(o,d),this.isAmbientLight=!0,this.type="AmbientLight"}}class Nb extends wu{constructor(o,d,v=10,b=10){super(o,d),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=v,this.height=b}get power(){return this.intensity*this.width*this.height*Math.PI}set power(o){this.intensity=o/(this.width*this.height*Math.PI)}copy(o){return super.copy(o),this.width=o.width,this.height=o.height,this}toJSON(o){const d=super.toJSON(o);return d.object.width=this.width,d.object.height=this.height,d}}class kb{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let o=0;o<9;o++)this.coefficients.push(new At)}set(o){for(let d=0;d<9;d++)this.coefficients[d].copy(o[d]);return this}zero(){for(let o=0;o<9;o++)this.coefficients[o].set(0,0,0);return this}getAt(o,d){const v=o.x,b=o.y,E=o.z,P=this.coefficients;return d.copy(P[0]).multiplyScalar(.282095),d.addScaledVector(P[1],.488603*b),d.addScaledVector(P[2],.488603*E),d.addScaledVector(P[3],.488603*v),d.addScaledVector(P[4],v*b*1.092548),d.addScaledVector(P[5],b*E*1.092548),d.addScaledVector(P[6],.315392*(3*E*E-1)),d.addScaledVector(P[7],v*E*1.092548),d.addScaledVector(P[8],.546274*(v*v-b*b)),d}getIrradianceAt(o,d){const v=o.x,b=o.y,E=o.z,P=this.coefficients;return d.copy(P[0]).multiplyScalar(.886227),d.addScaledVector(P[1],1.023328*b),d.addScaledVector(P[2],1.023328*E),d.addScaledVector(P[3],1.023328*v),d.addScaledVector(P[4],.858086*v*b),d.addScaledVector(P[5],.858086*b*E),d.addScaledVector(P[6],.743125*E*E-.247708),d.addScaledVector(P[7],.858086*v*E),d.addScaledVector(P[8],.429043*(v*v-b*b)),d}add(o){for(let d=0;d<9;d++)this.coefficients[d].add(o.coefficients[d]);return this}addScaledSH(o,d){for(let v=0;v<9;v++)this.coefficients[v].addScaledVector(o.coefficients[v],d);return this}scale(o){for(let d=0;d<9;d++)this.coefficients[d].multiplyScalar(o);return this}lerp(o,d){for(let v=0;v<9;v++)this.coefficients[v].lerp(o.coefficients[v],d);return this}equals(o){for(let d=0;d<9;d++)if(!this.coefficients[d].equals(o.coefficients[d]))return!1;return!0}copy(o){return this.set(o.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(o,d=0){const v=this.coefficients;for(let b=0;b<9;b++)v[b].fromArray(o,d+3*b);return this}toArray(o=[],d=0){const v=this.coefficients;for(let b=0;b<9;b++)v[b].toArray(o,d+3*b);return o}static getBasisAt(o,d){const v=o.x,b=o.y,E=o.z;d[0]=.282095,d[1]=.488603*b,d[2]=.488603*E,d[3]=.488603*v,d[4]=1.092548*v*b,d[5]=1.092548*b*E,d[6]=.315392*(3*E*E-1),d[7]=1.092548*v*E,d[8]=.546274*(v*v-b*b)}}class uv extends wu{constructor(o=new kb,d=1){super(void 0,d),this.isLightProbe=!0,this.sh=o}copy(o){return super.copy(o),this.sh.copy(o.sh),this}fromJSON(o){return this.intensity=o.intensity,this.sh.fromArray(o.sh),this}toJSON(o){const d=super.toJSON(o);return d.object.sh=this.sh.toArray(),d}}class hv extends wl{constructor(o){super(o),this.textures={}}load(o,d,v,b){const E=this,P=new po(E.manager);P.setPath(E.path),P.setRequestHeader(E.requestHeader),P.setWithCredentials(E.withCredentials),P.load(o,function(O){try{d(E.parse(JSON.parse(O)))}catch(Q){b?b(Q):console.error(Q),E.manager.itemError(o)}},v,b)}parse(o){const d=this.textures;function v(P){return d[P]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",P),d[P]}const b=o.metadata&&o.metadata.version<=4.5?ws:void 0,E=hv.createMaterialFromType(o.type);if(o.uuid!==void 0&&(E.uuid=o.uuid),o.name!==void 0&&(E.name=o.name),o.color!==void 0&&E.color!==void 0&&E.color.setHex(o.color,b),o.roughness!==void 0&&(E.roughness=o.roughness),o.metalness!==void 0&&(E.metalness=o.metalness),o.sheen!==void 0&&(E.sheen=o.sheen),o.sheenColor!==void 0&&(E.sheenColor=new Mi().setHex(o.sheenColor,b)),o.sheenRoughness!==void 0&&(E.sheenRoughness=o.sheenRoughness),o.emissive!==void 0&&E.emissive!==void 0&&E.emissive.setHex(o.emissive,b),o.specular!==void 0&&E.specular!==void 0&&E.specular.setHex(o.specular,b),o.specularIntensity!==void 0&&(E.specularIntensity=o.specularIntensity),o.specularColor!==void 0&&E.specularColor!==void 0&&E.specularColor.setHex(o.specularColor,b),o.shininess!==void 0&&(E.shininess=o.shininess),o.clearcoat!==void 0&&(E.clearcoat=o.clearcoat),o.clearcoatRoughness!==void 0&&(E.clearcoatRoughness=o.clearcoatRoughness),o.iridescence!==void 0&&(E.iridescence=o.iridescence),o.iridescenceIOR!==void 0&&(E.iridescenceIOR=o.iridescenceIOR),o.iridescenceThicknessRange!==void 0&&(E.iridescenceThicknessRange=o.iridescenceThicknessRange),o.transmission!==void 0&&(E.transmission=o.transmission),o.thickness!==void 0&&(E.thickness=o.thickness),o.attenuationDistance!==void 0&&(E.attenuationDistance=o.attenuationDistance),o.attenuationColor!==void 0&&E.attenuationColor!==void 0&&E.attenuationColor.setHex(o.attenuationColor,b),o.fog!==void 0&&(E.fog=o.fog),o.flatShading!==void 0&&(E.flatShading=o.flatShading),o.blending!==void 0&&(E.blending=o.blending),o.combine!==void 0&&(E.combine=o.combine),o.side!==void 0&&(E.side=o.side),o.shadowSide!==void 0&&(E.shadowSide=o.shadowSide),o.opacity!==void 0&&(E.opacity=o.opacity),o.transparent!==void 0&&(E.transparent=o.transparent),o.alphaTest!==void 0&&(E.alphaTest=o.alphaTest),o.depthTest!==void 0&&(E.depthTest=o.depthTest),o.depthWrite!==void 0&&(E.depthWrite=o.depthWrite),o.colorWrite!==void 0&&(E.colorWrite=o.colorWrite),o.stencilWrite!==void 0&&(E.stencilWrite=o.stencilWrite),o.stencilWriteMask!==void 0&&(E.stencilWriteMask=o.stencilWriteMask),o.stencilFunc!==void 0&&(E.stencilFunc=o.stencilFunc),o.stencilRef!==void 0&&(E.stencilRef=o.stencilRef),o.stencilFuncMask!==void 0&&(E.stencilFuncMask=o.stencilFuncMask),o.stencilFail!==void 0&&(E.stencilFail=o.stencilFail),o.stencilZFail!==void 0&&(E.stencilZFail=o.stencilZFail),o.stencilZPass!==void 0&&(E.stencilZPass=o.stencilZPass),o.wireframe!==void 0&&(E.wireframe=o.wireframe),o.wireframeLinewidth!==void 0&&(E.wireframeLinewidth=o.wireframeLinewidth),o.wireframeLinecap!==void 0&&(E.wireframeLinecap=o.wireframeLinecap),o.wireframeLinejoin!==void 0&&(E.wireframeLinejoin=o.wireframeLinejoin),o.rotation!==void 0&&(E.rotation=o.rotation),o.linewidth!==1&&(E.linewidth=o.linewidth),o.dashSize!==void 0&&(E.dashSize=o.dashSize),o.gapSize!==void 0&&(E.gapSize=o.gapSize),o.scale!==void 0&&(E.scale=o.scale),o.polygonOffset!==void 0&&(E.polygonOffset=o.polygonOffset),o.polygonOffsetFactor!==void 0&&(E.polygonOffsetFactor=o.polygonOffsetFactor),o.polygonOffsetUnits!==void 0&&(E.polygonOffsetUnits=o.polygonOffsetUnits),o.dithering!==void 0&&(E.dithering=o.dithering),o.alphaToCoverage!==void 0&&(E.alphaToCoverage=o.alphaToCoverage),o.premultipliedAlpha!==void 0&&(E.premultipliedAlpha=o.premultipliedAlpha),o.forceSinglePass!==void 0&&(E.forceSinglePass=o.forceSinglePass),o.visible!==void 0&&(E.visible=o.visible),o.toneMapped!==void 0&&(E.toneMapped=o.toneMapped),o.userData!==void 0&&(E.userData=o.userData),o.vertexColors!==void 0&&(typeof o.vertexColors=="number"?E.vertexColors=o.vertexColors>0:E.vertexColors=o.vertexColors),o.uniforms!==void 0)for(const P in o.uniforms){const O=o.uniforms[P];switch(E.uniforms[P]={},O.type){case"t":E.uniforms[P].value=v(O.value);break;case"c":E.uniforms[P].value=new Mi().setHex(O.value,b);break;case"v2":E.uniforms[P].value=new jn().fromArray(O.value);break;case"v3":E.uniforms[P].value=new At().fromArray(O.value);break;case"v4":E.uniforms[P].value=new Yr().fromArray(O.value);break;case"m3":E.uniforms[P].value=new Dr().fromArray(O.value);break;case"m4":E.uniforms[P].value=new Sr().fromArray(O.value);break;default:E.uniforms[P].value=O.value}}if(o.defines!==void 0&&(E.defines=o.defines),o.vertexShader!==void 0&&(E.vertexShader=o.vertexShader),o.fragmentShader!==void 0&&(E.fragmentShader=o.fragmentShader),o.glslVersion!==void 0&&(E.glslVersion=o.glslVersion),o.extensions!==void 0)for(const P in o.extensions)E.extensions[P]=o.extensions[P];if(o.lights!==void 0&&(E.lights=o.lights),o.clipping!==void 0&&(E.clipping=o.clipping),o.size!==void 0&&(E.size=o.size),o.sizeAttenuation!==void 0&&(E.sizeAttenuation=o.sizeAttenuation),o.map!==void 0&&(E.map=v(o.map)),o.matcap!==void 0&&(E.matcap=v(o.matcap)),o.alphaMap!==void 0&&(E.alphaMap=v(o.alphaMap)),o.bumpMap!==void 0&&(E.bumpMap=v(o.bumpMap)),o.bumpScale!==void 0&&(E.bumpScale=o.bumpScale),o.normalMap!==void 0&&(E.normalMap=v(o.normalMap)),o.normalMapType!==void 0&&(E.normalMapType=o.normalMapType),o.normalScale!==void 0){let P=o.normalScale;Array.isArray(P)===!1&&(P=[P,P]),E.normalScale=new jn().fromArray(P)}return o.displacementMap!==void 0&&(E.displacementMap=v(o.displacementMap)),o.displacementScale!==void 0&&(E.displacementScale=o.displacementScale),o.displacementBias!==void 0&&(E.displacementBias=o.displacementBias),o.roughnessMap!==void 0&&(E.roughnessMap=v(o.roughnessMap)),o.metalnessMap!==void 0&&(E.metalnessMap=v(o.metalnessMap)),o.emissiveMap!==void 0&&(E.emissiveMap=v(o.emissiveMap)),o.emissiveIntensity!==void 0&&(E.emissiveIntensity=o.emissiveIntensity),o.specularMap!==void 0&&(E.specularMap=v(o.specularMap)),o.specularIntensityMap!==void 0&&(E.specularIntensityMap=v(o.specularIntensityMap)),o.specularColorMap!==void 0&&(E.specularColorMap=v(o.specularColorMap)),o.envMap!==void 0&&(E.envMap=v(o.envMap)),o.envMapIntensity!==void 0&&(E.envMapIntensity=o.envMapIntensity),o.reflectivity!==void 0&&(E.reflectivity=o.reflectivity),o.refractionRatio!==void 0&&(E.refractionRatio=o.refractionRatio),o.lightMap!==void 0&&(E.lightMap=v(o.lightMap)),o.lightMapIntensity!==void 0&&(E.lightMapIntensity=o.lightMapIntensity),o.aoMap!==void 0&&(E.aoMap=v(o.aoMap)),o.aoMapIntensity!==void 0&&(E.aoMapIntensity=o.aoMapIntensity),o.gradientMap!==void 0&&(E.gradientMap=v(o.gradientMap)),o.clearcoatMap!==void 0&&(E.clearcoatMap=v(o.clearcoatMap)),o.clearcoatRoughnessMap!==void 0&&(E.clearcoatRoughnessMap=v(o.clearcoatRoughnessMap)),o.clearcoatNormalMap!==void 0&&(E.clearcoatNormalMap=v(o.clearcoatNormalMap)),o.clearcoatNormalScale!==void 0&&(E.clearcoatNormalScale=new jn().fromArray(o.clearcoatNormalScale)),o.iridescenceMap!==void 0&&(E.iridescenceMap=v(o.iridescenceMap)),o.iridescenceThicknessMap!==void 0&&(E.iridescenceThicknessMap=v(o.iridescenceThicknessMap)),o.transmissionMap!==void 0&&(E.transmissionMap=v(o.transmissionMap)),o.thicknessMap!==void 0&&(E.thicknessMap=v(o.thicknessMap)),o.sheenColorMap!==void 0&&(E.sheenColorMap=v(o.sheenColorMap)),o.sheenRoughnessMap!==void 0&&(E.sheenRoughnessMap=v(o.sheenRoughnessMap)),E}setTextures(o){return this.textures=o,this}static createMaterialFromType(o){return new{ShadowMaterial:ro,SpriteMaterial:Gd,RawShaderMaterial:Cb,ShaderMaterial:ta,PointsMaterial:Q_,MeshPhysicalMaterial:_s,MeshStandardMaterial:ga,MeshPhongMaterial:Gf,MeshToonMaterial:Hf,MeshNormalMaterial:Rb,MeshLambertMaterial:ny,MeshDepthMaterial:Qm,MeshDistanceMaterial:xf,MeshBasicMaterial:ys,MeshMatcapMaterial:Ib,LineDashedMaterial:Wf,LineBasicMaterial:ka,Material:Vo}[o]}}class cp{static decodeText(o){if(typeof TextDecoder<"u")return new TextDecoder().decode(o);let d="";for(let v=0,b=o.length;v<b;v++)d+=String.fromCharCode(o[v]);try{return decodeURIComponent(escape(d))}catch{return d}}static extractUrlBase(o){const d=o.lastIndexOf("/");return d===-1?"./":o.slice(0,d+1)}static resolveURL(o,d){return typeof o!="string"||o===""?"":(/^https?:\/\//i.test(d)&&/^\//.test(o)&&(d=d.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(o)||/^data:.*,.*$/i.test(o)||/^blob:.*$/i.test(o)?o:d+o)}}class Fa extends Ie{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(o){return super.copy(o),this.instanceCount=o.instanceCount,this}toJSON(){const o=super.toJSON();return o.instanceCount=this.instanceCount,o.isInstancedBufferGeometry=!0,o}}class ay extends wl{constructor(o){super(o)}load(o,d,v,b){const E=this,P=new po(E.manager);P.setPath(E.path),P.setRequestHeader(E.requestHeader),P.setWithCredentials(E.withCredentials),P.load(o,function(O){try{d(E.parse(JSON.parse(O)))}catch(Q){b?b(Q):console.error(Q),E.manager.itemError(o)}},v,b)}parse(o){const d={},v={};function b(ge,fe){if(d[fe]!==void 0)return d[fe];const _e=ge.interleavedBuffers[fe],xe=function(Ce,De){if(v[De]!==void 0)return v[De];const ze=Ce.arrayBuffers[De],dt=new Uint32Array(ze).buffer;return v[De]=dt,dt}(ge,_e.buffer),Re=dl(_e.type,xe),we=new Km(Re,_e.stride);return we.uuid=_e.uuid,d[fe]=we,we}const E=o.isInstancedBufferGeometry?new Fa:new Ie,P=o.data.index;if(P!==void 0){const ge=dl(P.type,P.array);E.setIndex(new As(ge,1))}const O=o.data.attributes;for(const ge in O){const fe=O[ge];let _e;if(fe.isInterleavedBufferAttribute){const xe=b(o.data,fe.data);_e=new Ho(xe,fe.itemSize,fe.offset,fe.normalized)}else{const xe=dl(fe.type,fe.array);_e=new(fe.isInstancedBufferAttribute?Vh:As)(xe,fe.itemSize,fe.normalized)}fe.name!==void 0&&(_e.name=fe.name),fe.usage!==void 0&&_e.setUsage(fe.usage),fe.updateRange!==void 0&&(_e.updateRange.offset=fe.updateRange.offset,_e.updateRange.count=fe.updateRange.count),E.setAttribute(ge,_e)}const Q=o.data.morphAttributes;if(Q)for(const ge in Q){const fe=Q[ge],_e=[];for(let xe=0,Re=fe.length;xe<Re;xe++){const we=fe[xe];let Ce;if(we.isInterleavedBufferAttribute){const De=b(o.data,we.data);Ce=new Ho(De,we.itemSize,we.offset,we.normalized)}else{const De=dl(we.type,we.array);Ce=new As(De,we.itemSize,we.normalized)}we.name!==void 0&&(Ce.name=we.name),_e.push(Ce)}E.morphAttributes[ge]=_e}o.data.morphTargetsRelative&&(E.morphTargetsRelative=!0);const G=o.data.groups||o.data.drawcalls||o.data.offsets;if(G!==void 0)for(let ge=0,fe=G.length;ge!==fe;++ge){const _e=G[ge];E.addGroup(_e.start,_e.count,_e.materialIndex)}const te=o.data.boundingSphere;if(te!==void 0){const ge=new At;te.center!==void 0&&ge.fromArray(te.center),E.boundingSphere=new ko(ge,te.radius)}return o.name&&(E.name=o.name),o.userData&&(E.userData=o.userData),E}}class ly extends wl{constructor(o){super(o)}load(o,d,v,b){const E=this,P=this.path===""?cp.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||P;const O=new po(this.manager);O.setPath(this.path),O.setRequestHeader(this.requestHeader),O.setWithCredentials(this.withCredentials),O.load(o,function(Q){let G=null;try{G=JSON.parse(Q)}catch(ge){return b!==void 0&&b(ge),void console.error("THREE:ObjectLoader: Can't parse "+o+".",ge.message)}const te=G.metadata;if(te===void 0||te.type===void 0||te.type.toLowerCase()==="geometry")return b!==void 0&&b(new Error("THREE.ObjectLoader: Can't load "+o)),void console.error("THREE.ObjectLoader: Can't load "+o);E.parse(G,d)},v,b)}async loadAsync(o,d){const v=this.path===""?cp.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||v;const b=new po(this.manager);b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials);const E=await b.loadAsync(o,d),P=JSON.parse(E),O=P.metadata;if(O===void 0||O.type===void 0||O.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+o);return await this.parseAsync(P)}parse(o,d){const v=this.parseAnimations(o.animations),b=this.parseShapes(o.shapes),E=this.parseGeometries(o.geometries,b),P=this.parseImages(o.images,function(){d!==void 0&&d(G)}),O=this.parseTextures(o.textures,P),Q=this.parseMaterials(o.materials,O),G=this.parseObject(o.object,E,Q,O,v),te=this.parseSkeletons(o.skeletons,G);if(this.bindSkeletons(G,te),d!==void 0){let ge=!1;for(const fe in P)if(P[fe].data instanceof HTMLImageElement){ge=!0;break}ge===!1&&d(G)}return G}async parseAsync(o){const d=this.parseAnimations(o.animations),v=this.parseShapes(o.shapes),b=this.parseGeometries(o.geometries,v),E=await this.parseImagesAsync(o.images),P=this.parseTextures(o.textures,E),O=this.parseMaterials(o.materials,P),Q=this.parseObject(o.object,b,O,P,d),G=this.parseSkeletons(o.skeletons,Q);return this.bindSkeletons(Q,G),Q}parseShapes(o){const d={};if(o!==void 0)for(let v=0,b=o.length;v<b;v++){const E=new tp().fromJSON(o[v]);d[E.uuid]=E}return d}parseSkeletons(o,d){const v={},b={};if(d.traverse(function(E){E.isBone&&(b[E.uuid]=E)}),o!==void 0)for(let E=0,P=o.length;E<P;E++){const O=new Rf().fromJSON(o[E],b);v[O.uuid]=O}return v}parseGeometries(o,d){const v={};if(o!==void 0){const b=new ay;for(let E=0,P=o.length;E<P;E++){let O;const Q=o[E];switch(Q.type){case"BufferGeometry":case"InstancedBufferGeometry":O=b.parse(Q);break;default:Q.type in jf?O=jf[Q.type].fromJSON(Q,d):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${Q.type}"`)}O.uuid=Q.uuid,Q.name!==void 0&&(O.name=Q.name),Q.userData!==void 0&&(O.userData=Q.userData),v[Q.uuid]=O}}return v}parseMaterials(o,d){const v={},b={};if(o!==void 0){const E=new hv;E.setTextures(d);for(let P=0,O=o.length;P<O;P++){const Q=o[P];v[Q.uuid]===void 0&&(v[Q.uuid]=E.parse(Q)),b[Q.uuid]=v[Q.uuid]}}return b}parseAnimations(o){const d={};if(o!==void 0)for(let v=0;v<o.length;v++){const b=o[v],E=Xf.parse(b);d[E.uuid]=E}return d}parseImages(o,d){const v=this,b={};let E;function P(O){if(typeof O=="string"){const Q=O;return function(G){return v.manager.itemStart(G),E.load(G,function(){v.manager.itemEnd(G)},void 0,function(){v.manager.itemError(G),v.manager.itemEnd(G)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Q)?Q:v.resourcePath+Q)}return O.data?{data:dl(O.type,O.data),width:O.width,height:O.height,complete:!0}:null}if(o!==void 0&&o.length>0){const O=new ry(d);E=new Yf(O),E.setCrossOrigin(this.crossOrigin);for(let Q=0,G=o.length;Q<G;Q++){const te=o[Q],ge=te.url;if(Array.isArray(ge)){const fe=[];for(let _e=0,xe=ge.length;_e<xe;_e++){const Re=P(ge[_e]);Re!==null&&(Re instanceof HTMLImageElement?fe.push(Re):fe.push(new Yu(Re.data,Re.width,Re.height)))}b[te.uuid]=new Ic(fe)}else{const fe=P(te.url);b[te.uuid]=new Ic(fe)}}}return b}async parseImagesAsync(o){const d=this,v={};let b;async function E(P){if(typeof P=="string"){const O=P,Q=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(O)?O:d.resourcePath+O;return await b.loadAsync(Q)}return P.data?{data:dl(P.type,P.data),width:P.width,height:P.height,complete:!0}:null}if(o!==void 0&&o.length>0){b=new Yf(this.manager),b.setCrossOrigin(this.crossOrigin);for(let P=0,O=o.length;P<O;P++){const Q=o[P],G=Q.url;if(Array.isArray(G)){const te=[];for(let ge=0,fe=G.length;ge<fe;ge++){const _e=G[ge],xe=await E(_e);xe!==null&&(xe instanceof HTMLImageElement?te.push(xe):te.push(new Yu(xe.data,xe.width,xe.height)))}v[Q.uuid]=new Ic(te)}else{const te=await E(Q.url);v[Q.uuid]=new Ic(te)}}}return v}parseTextures(o,d){function v(E,P){return typeof E=="number"?E:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",E),P[E])}const b={};if(o!==void 0)for(let E=0,P=o.length;E<P;E++){const O=o[E];O.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',O.uuid),d[O.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",O.image);const Q=d[O.image],G=Q?Q.data:void 0;let te;Array.isArray(G)?(te=new Mm,G.length===6&&(te.needsUpdate=!0)):(te=G&&G.data?new Yu:new Vs,G&&G.complete&&(te.needsUpdate=!0)),te.source=Q,te.uuid=O.uuid,O.name!==void 0&&(te.name=O.name),O.mapping!==void 0&&(te.mapping=v(O.mapping,nh)),O.channel!==void 0&&(te.channel=O.channel),O.offset!==void 0&&te.offset.fromArray(O.offset),O.repeat!==void 0&&te.repeat.fromArray(O.repeat),O.center!==void 0&&te.center.fromArray(O.center),O.rotation!==void 0&&(te.rotation=O.rotation),O.wrap!==void 0&&(te.wrapS=v(O.wrap[0],dv),te.wrapT=v(O.wrap[1],dv)),O.format!==void 0&&(te.format=O.format),O.internalFormat!==void 0&&(te.internalFormat=O.internalFormat),O.type!==void 0&&(te.type=O.type),O.colorSpace!==void 0?te.colorSpace=O.colorSpace:O.encoding!==void 0&&(te.encoding=O.encoding),O.minFilter!==void 0&&(te.minFilter=v(O.minFilter,pv)),O.magFilter!==void 0&&(te.magFilter=v(O.magFilter,pv)),O.anisotropy!==void 0&&(te.anisotropy=O.anisotropy),O.flipY!==void 0&&(te.flipY=O.flipY),O.generateMipmaps!==void 0&&(te.generateMipmaps=O.generateMipmaps),O.premultiplyAlpha!==void 0&&(te.premultiplyAlpha=O.premultiplyAlpha),O.unpackAlignment!==void 0&&(te.unpackAlignment=O.unpackAlignment),O.userData!==void 0&&(te.userData=O.userData),b[O.uuid]=te}return b}parseObject(o,d,v,b,E){let P;const O=o.metadata&&o.metadata.version<=4.5?ws:void 0;function Q(_e){return d[_e]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",_e),d[_e]}function G(_e){if(_e!==void 0){if(Array.isArray(_e)){const xe=[];for(let Re=0,we=_e.length;Re<we;Re++){const Ce=_e[Re];v[Ce]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Ce),xe.push(v[Ce])}return xe}return v[_e]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",_e),v[_e]}}function te(_e){return b[_e]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",_e),b[_e]}let ge,fe;switch(o.type){case"Scene":P=new qu,o.background!==void 0&&(Number.isInteger(o.background)?P.background=new Mi().setHex(o.background,O):P.background=te(o.background)),o.environment!==void 0&&(P.environment=te(o.environment)),o.fog!==void 0&&(o.fog.type==="Fog"?P.fog=new Ef(o.fog.color,o.fog.near,o.fog.far):o.fog.type==="FogExp2"&&(P.fog=new Ym(o.fog.color,o.fog.density))),o.backgroundBlurriness!==void 0&&(P.backgroundBlurriness=o.backgroundBlurriness),o.backgroundIntensity!==void 0&&(P.backgroundIntensity=o.backgroundIntensity);break;case"PerspectiveCamera":P=new Go(o.fov,o.aspect,o.near,o.far),o.focus!==void 0&&(P.focus=o.focus),o.zoom!==void 0&&(P.zoom=o.zoom),o.filmGauge!==void 0&&(P.filmGauge=o.filmGauge),o.filmOffset!==void 0&&(P.filmOffset=o.filmOffset),o.view!==void 0&&(P.view=Object.assign({},o.view));break;case"OrthographicCamera":P=new C_(o.left,o.right,o.top,o.bottom,o.near,o.far),o.zoom!==void 0&&(P.zoom=o.zoom),o.view!==void 0&&(P.view=Object.assign({},o.view));break;case"AmbientLight":P=new cv(o.color,o.intensity);break;case"DirectionalLight":P=new Vl(o.color,o.intensity);break;case"PointLight":P=new Bb(o.color,o.intensity,o.distance,o.decay);break;case"RectAreaLight":P=new Nb(o.color,o.intensity,o.width,o.height);break;case"SpotLight":P=new oy(o.color,o.intensity,o.distance,o.angle,o.penumbra,o.decay);break;case"HemisphereLight":P=new Qh(o.color,o.groundColor,o.intensity);break;case"LightProbe":P=new uv().fromJSON(o);break;case"SkinnedMesh":ge=Q(o.geometry),fe=G(o.material),P=new ma(ge,fe),o.bindMode!==void 0&&(P.bindMode=o.bindMode),o.bindMatrix!==void 0&&P.bindMatrix.fromArray(o.bindMatrix),o.skeleton!==void 0&&(P.skeleton=o.skeleton);break;case"Mesh":ge=Q(o.geometry),fe=G(o.material),P=new Co(ge,fe);break;case"InstancedMesh":ge=Q(o.geometry),fe=G(o.material);const _e=o.count,xe=o.instanceMatrix,Re=o.instanceColor;P=new Jm(ge,fe,_e),P.instanceMatrix=new Vh(new Float32Array(xe.array),16),Re!==void 0&&(P.instanceColor=new Vh(new Float32Array(Re.array),Re.itemSize));break;case"LOD":P=new N0;break;case"Line":P=new Ku(Q(o.geometry),G(o.material));break;case"LineLoop":P=new G0(Q(o.geometry),G(o.material));break;case"LineSegments":P=new bl(Q(o.geometry),G(o.material));break;case"PointCloud":case"Points":P=new q_(Q(o.geometry),G(o.material));break;case"Sprite":P=new Qd(G(o.material));break;case"Group":P=new Uh;break;case"Bone":P=new ls;break;default:P=new Gr}if(P.uuid=o.uuid,o.name!==void 0&&(P.name=o.name),o.matrix!==void 0?(P.matrix.fromArray(o.matrix),o.matrixAutoUpdate!==void 0&&(P.matrixAutoUpdate=o.matrixAutoUpdate),P.matrixAutoUpdate&&P.matrix.decompose(P.position,P.quaternion,P.scale)):(o.position!==void 0&&P.position.fromArray(o.position),o.rotation!==void 0&&P.rotation.fromArray(o.rotation),o.quaternion!==void 0&&P.quaternion.fromArray(o.quaternion),o.scale!==void 0&&P.scale.fromArray(o.scale)),o.up!==void 0&&P.up.fromArray(o.up),o.castShadow!==void 0&&(P.castShadow=o.castShadow),o.receiveShadow!==void 0&&(P.receiveShadow=o.receiveShadow),o.shadow&&(o.shadow.bias!==void 0&&(P.shadow.bias=o.shadow.bias),o.shadow.normalBias!==void 0&&(P.shadow.normalBias=o.shadow.normalBias),o.shadow.radius!==void 0&&(P.shadow.radius=o.shadow.radius),o.shadow.mapSize!==void 0&&P.shadow.mapSize.fromArray(o.shadow.mapSize),o.shadow.camera!==void 0&&(P.shadow.camera=this.parseObject(o.shadow.camera))),o.visible!==void 0&&(P.visible=o.visible),o.frustumCulled!==void 0&&(P.frustumCulled=o.frustumCulled),o.renderOrder!==void 0&&(P.renderOrder=o.renderOrder),o.userData!==void 0&&(P.userData=o.userData),o.layers!==void 0&&(P.layers.mask=o.layers),o.children!==void 0){const _e=o.children;for(let xe=0;xe<_e.length;xe++)P.add(this.parseObject(_e[xe],d,v,b,E))}if(o.animations!==void 0){const _e=o.animations;for(let xe=0;xe<_e.length;xe++){const Re=_e[xe];P.animations.push(E[Re])}}if(o.type==="LOD"){o.autoUpdate!==void 0&&(P.autoUpdate=o.autoUpdate);const _e=o.levels;for(let xe=0;xe<_e.length;xe++){const Re=_e[xe],we=P.getObjectByProperty("uuid",Re.object);we!==void 0&&P.addLevel(we,Re.distance,Re.hysteresis)}}return P}bindSkeletons(o,d){Object.keys(d).length!==0&&o.traverse(function(v){if(v.isSkinnedMesh===!0&&v.skeleton!==void 0){const b=d[v.skeleton];b===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",v.skeleton):v.bind(b,v.bindMatrix)}})}}const nh={UVMapping:_n,CubeReflectionMapping:Bn,CubeRefractionMapping:de,EquirectangularReflectionMapping:Ae,EquirectangularRefractionMapping:Le,CubeUVReflectionMapping:Oe},dv={RepeatWrapping:$e,ClampToEdgeWrapping:pt,MirroredRepeatWrapping:Mt},pv={NearestFilter:Bt,NearestMipmapNearestFilter:xt,NearestMipmapLinearFilter:zt,LinearFilter:en,LinearMipmapNearestFilter:xn,LinearMipmapLinearFilter:Gi};class PE extends wl{constructor(o){super(o),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(o){return this.options=o,this}load(o,d,v,b){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const E=this;Wc.get(o,"blob").then(P=>{if(P!==void 0)return E.manager.itemStart(o),void createImageBitmap(P,Object.assign(E.options,{colorSpaceConversion:"none"})).then(function(Q){d&&d(Q),E.manager.itemEnd(o)}).catch(function(Q){b&&b(Q),E.manager.itemError(o),E.manager.itemEnd(o)});const O={};O.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",O.headers=this.requestHeader,fetch(o,O).then(function(Q){return Q.blob()}).then(function(Q){return Wc.add(o,Q,"blob"),createImageBitmap(Q,Object.assign(E.options,{colorSpaceConversion:"none"}))}).then(function(Q){d&&d(Q),E.manager.itemEnd(o)}).catch(function(Q){b&&b(Q),E.manager.itemError(o),E.manager.itemEnd(o)}),E.manager.itemStart(o)})}}let Ag;class bg{static getContext(){return Ag===void 0&&(Ag=new(window.AudioContext||window.webkitAudioContext)),Ag}static setContext(o){Ag=o}}class cy extends wl{constructor(o){super(o)}load(o,d,v,b){const E=this,P=new po(this.manager);function O(Q){b?b(Q):console.error(Q),E.manager.itemError(o)}P.setResponseType("arraybuffer"),P.setPath(this.path),P.setRequestHeader(this.requestHeader),P.setWithCredentials(this.withCredentials),P.load(o,function(Q){try{const G=Q.slice(0);bg.getContext().decodeAudioData(G,function(te){d(te)},O)}catch(G){O(G)}},v,b)}}class uy extends uv{constructor(o,d,v=1){super(void 0,v),this.isHemisphereLightProbe=!0;const b=new Mi().set(o),E=new Mi().set(d),P=new At(b.r,b.g,b.b),O=new At(E.r,E.g,E.b),Q=Math.sqrt(Math.PI),G=Q*Math.sqrt(.75);this.sh.coefficients[0].copy(P).add(O).multiplyScalar(Q),this.sh.coefficients[1].copy(P).sub(O).multiplyScalar(G)}}class Eu extends uv{constructor(o,d=1){super(void 0,d),this.isAmbientLightProbe=!0;const v=new Mi().set(o);this.sh.coefficients[0].set(v.r,v.g,v.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const hy=new Sr,fv=new Sr,up=new Sr;class dy{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Go,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Go,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(o){const d=this._cache;if(d.focus!==o.focus||d.fov!==o.fov||d.aspect!==o.aspect*this.aspect||d.near!==o.near||d.far!==o.far||d.zoom!==o.zoom||d.eyeSep!==this.eyeSep){d.focus=o.focus,d.fov=o.fov,d.aspect=o.aspect*this.aspect,d.near=o.near,d.far=o.far,d.zoom=o.zoom,d.eyeSep=this.eyeSep,up.copy(o.projectionMatrix);const v=d.eyeSep/2,b=v*d.near/d.focus,E=d.near*Math.tan(ou*d.fov*.5)/d.zoom;let P,O;fv.elements[12]=-v,hy.elements[12]=v,P=-E*d.aspect+b,O=E*d.aspect+b,up.elements[0]=2*d.near/(O-P),up.elements[8]=(O+P)/(O-P),this.cameraL.projectionMatrix.copy(up),P=-E*d.aspect-b,O=E*d.aspect-b,up.elements[0]=2*d.near/(O-P),up.elements[8]=(O+P)/(O-P),this.cameraR.projectionMatrix.copy(up)}this.cameraL.matrixWorld.copy(o.matrixWorld).multiply(fv),this.cameraR.matrixWorld.copy(o.matrixWorld).multiply(hy)}}class hp{constructor(o=!0){this.autoStart=o,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Ub(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let o=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const d=Ub();o=(d-this.oldTime)/1e3,this.oldTime=d,this.elapsedTime+=o}return o}}function Ub(){return(typeof performance>"u"?Date:performance).now()}const dp=new At,pp=new No,DE=new At,fc=new At;class LE extends Gr{constructor(){super(),this.type="AudioListener",this.context=bg.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new hp}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(o){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=o,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}updateMatrixWorld(o){super.updateMatrixWorld(o);const d=this.context.listener,v=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(dp,pp,DE),fc.set(0,0,-1).applyQuaternion(pp),d.positionX){const b=this.context.currentTime+this.timeDelta;d.positionX.linearRampToValueAtTime(dp.x,b),d.positionY.linearRampToValueAtTime(dp.y,b),d.positionZ.linearRampToValueAtTime(dp.z,b),d.forwardX.linearRampToValueAtTime(fc.x,b),d.forwardY.linearRampToValueAtTime(fc.y,b),d.forwardZ.linearRampToValueAtTime(fc.z,b),d.upX.linearRampToValueAtTime(v.x,b),d.upY.linearRampToValueAtTime(v.y,b),d.upZ.linearRampToValueAtTime(v.z,b)}else d.setPosition(dp.x,dp.y,dp.z),d.setOrientation(fc.x,fc.y,fc.z,v.x,v.y,v.z)}}class fp extends Gr{constructor(o){super(),this.type="Audio",this.listener=o,this.context=o.context,this.gain=this.context.createGain(),this.gain.connect(o.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(o){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=o,this.connect(),this}setMediaElementSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(o),this.connect(),this}setMediaStreamSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(o),this.connect(),this}setBuffer(o){return this.buffer=o,this.sourceType="buffer",this.autoplay&&this.play(),this}play(o=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+o;const d=this.context.createBufferSource();return d.buffer=this.buffer,d.loop=this.loop,d.loopStart=this.loopStart,d.loopEnd=this.loopEnd,d.onended=this.onEnded.bind(this),d.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=d,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let o=1,d=this.filters.length;o<d;o++)this.filters[o-1].connect(this.filters[o]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let o=1,d=this.filters.length;o<d;o++)this.filters[o-1].disconnect(this.filters[o]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(o){return o||(o=[]),this._connected===!0?(this.disconnect(),this.filters=o.slice(),this.connect()):this.filters=o.slice(),this}setDetune(o){if(this.detune=o,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(o){return this.setFilters(o?[o]:[])}setPlaybackRate(o){if(this.hasPlaybackControl!==!1)return this.playbackRate=o,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(o){if(this.hasPlaybackControl!==!1)return this.loop=o,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(o){return this.loopStart=o,this}setLoopEnd(o){return this.loopEnd=o,this}getVolume(){return this.gain.gain.value}setVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}}const mp=new At,gp=new No,BE=new At,mc=new At;class mv extends fp{constructor(o){super(o),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(o){return this.panner.refDistance=o,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(o){return this.panner.rolloffFactor=o,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(o){return this.panner.distanceModel=o,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(o){return this.panner.maxDistance=o,this}setDirectionalCone(o,d,v){return this.panner.coneInnerAngle=o,this.panner.coneOuterAngle=d,this.panner.coneOuterGain=v,this}updateMatrixWorld(o){if(super.updateMatrixWorld(o),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(mp,gp,BE),mc.set(0,0,1).applyQuaternion(gp);const d=this.panner;if(d.positionX){const v=this.context.currentTime+this.listener.timeDelta;d.positionX.linearRampToValueAtTime(mp.x,v),d.positionY.linearRampToValueAtTime(mp.y,v),d.positionZ.linearRampToValueAtTime(mp.z,v),d.orientationX.linearRampToValueAtTime(mc.x,v),d.orientationY.linearRampToValueAtTime(mc.y,v),d.orientationZ.linearRampToValueAtTime(mc.z,v)}else d.setPosition(mp.x,mp.y,mp.z),d.setOrientation(mc.x,mc.y,mc.z)}}class xg{constructor(o,d=2048){this.analyser=o.context.createAnalyser(),this.analyser.fftSize=d,this.data=new Uint8Array(this.analyser.frequencyBinCount),o.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let o=0;const d=this.getFrequencyData();for(let v=0;v<d.length;v++)o+=d[v];return o/d.length}}class gv{constructor(o,d,v){let b,E,P;switch(this.binding=o,this.valueSize=v,d){case"quaternion":b=this._slerp,E=this._slerpAdditive,P=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*v),this._workIndex=5;break;case"string":case"bool":b=this._select,E=this._select,P=this._setAdditiveIdentityOther,this.buffer=new Array(5*v);break;default:b=this._lerp,E=this._lerpAdditive,P=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*v)}this._mixBufferRegion=b,this._mixBufferRegionAdditive=E,this._setIdentity=P,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(o,d){const v=this.buffer,b=this.valueSize,E=o*b+b;let P=this.cumulativeWeight;if(P===0){for(let O=0;O!==b;++O)v[E+O]=v[O];P=d}else{P+=d;const O=d/P;this._mixBufferRegion(v,E,0,O,b)}this.cumulativeWeight=P}accumulateAdditive(o){const d=this.buffer,v=this.valueSize,b=v*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(d,b,0,o,v),this.cumulativeWeightAdditive+=o}apply(o){const d=this.valueSize,v=this.buffer,b=o*d+d,E=this.cumulativeWeight,P=this.cumulativeWeightAdditive,O=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,E<1){const Q=d*this._origIndex;this._mixBufferRegion(v,b,Q,1-E,d)}P>0&&this._mixBufferRegionAdditive(v,b,this._addIndex*d,1,d);for(let Q=d,G=d+d;Q!==G;++Q)if(v[Q]!==v[Q+d]){O.setValue(v,b);break}}saveOriginalState(){const o=this.binding,d=this.buffer,v=this.valueSize,b=v*this._origIndex;o.getValue(d,b);for(let E=v,P=b;E!==P;++E)d[E]=d[b+E%v];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const o=3*this.valueSize;this.binding.setValue(this.buffer,o)}_setAdditiveIdentityNumeric(){const o=this._addIndex*this.valueSize,d=o+this.valueSize;for(let v=o;v<d;v++)this.buffer[v]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const o=this._origIndex*this.valueSize,d=this._addIndex*this.valueSize;for(let v=0;v<this.valueSize;v++)this.buffer[d+v]=this.buffer[o+v]}_select(o,d,v,b,E){if(b>=.5)for(let P=0;P!==E;++P)o[d+P]=o[v+P]}_slerp(o,d,v,b){No.slerpFlat(o,d,o,d,o,v,b)}_slerpAdditive(o,d,v,b,E){const P=this._workIndex*E;No.multiplyQuaternionsFlat(o,P,o,d,o,v),No.slerpFlat(o,d,o,d,o,P,b)}_lerp(o,d,v,b,E){const P=1-b;for(let O=0;O!==E;++O){const Q=d+O;o[Q]=o[Q]*P+o[v+O]*b}}_lerpAdditive(o,d,v,b,E){for(let P=0;P!==E;++P){const O=d+P;o[O]=o[O]+o[v+P]*b}}}const wg="\\[\\]\\.:\\/",_p=new RegExp("["+wg+"]","g"),py="[^"+wg+"]",Eg="[^"+wg.replace("\\.","")+"]",vp=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",py)+/(WCOD+)?/.source.replace("WCOD",Eg)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",py)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",py)+"$"),_v=["material","materials","bones","map"];class ns{constructor(o,d,v){this.path=d,this.parsedPath=v||ns.parseTrackName(d),this.node=ns.findNode(o,this.parsedPath.nodeName),this.rootNode=o,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(o,d,v){return o&&o.isAnimationObjectGroup?new ns.Composite(o,d,v):new ns(o,d,v)}static sanitizeNodeName(o){return o.replace(/\s/g,"_").replace(_p,"")}static parseTrackName(o){const d=vp.exec(o);if(d===null)throw new Error("PropertyBinding: Cannot parse trackName: "+o);const v={nodeName:d[2],objectName:d[3],objectIndex:d[4],propertyName:d[5],propertyIndex:d[6]},b=v.nodeName&&v.nodeName.lastIndexOf(".");if(b!==void 0&&b!==-1){const E=v.nodeName.substring(b+1);_v.indexOf(E)!==-1&&(v.nodeName=v.nodeName.substring(0,b),v.objectName=E)}if(v.propertyName===null||v.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+o);return v}static findNode(o,d){if(d===void 0||d===""||d==="."||d===-1||d===o.name||d===o.uuid)return o;if(o.skeleton){const v=o.skeleton.getBoneByName(d);if(v!==void 0)return v}if(o.children){const v=function(E){for(let P=0;P<E.length;P++){const O=E[P];if(O.name===d||O.uuid===d)return O;const Q=v(O.children);if(Q)return Q}return null},b=v(o.children);if(b)return b}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(o,d){o[d]=this.targetObject[this.propertyName]}_getValue_array(o,d){const v=this.resolvedProperty;for(let b=0,E=v.length;b!==E;++b)o[d++]=v[b]}_getValue_arrayElement(o,d){o[d]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(o,d){this.resolvedProperty.toArray(o,d)}_setValue_direct(o,d){this.targetObject[this.propertyName]=o[d]}_setValue_direct_setNeedsUpdate(o,d){this.targetObject[this.propertyName]=o[d],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(o,d){this.targetObject[this.propertyName]=o[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(o,d){const v=this.resolvedProperty;for(let b=0,E=v.length;b!==E;++b)v[b]=o[d++]}_setValue_array_setNeedsUpdate(o,d){const v=this.resolvedProperty;for(let b=0,E=v.length;b!==E;++b)v[b]=o[d++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(o,d){const v=this.resolvedProperty;for(let b=0,E=v.length;b!==E;++b)v[b]=o[d++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(o,d){this.resolvedProperty[this.propertyIndex]=o[d]}_setValue_arrayElement_setNeedsUpdate(o,d){this.resolvedProperty[this.propertyIndex]=o[d],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(o,d){this.resolvedProperty[this.propertyIndex]=o[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(o,d){this.resolvedProperty.fromArray(o,d)}_setValue_fromArray_setNeedsUpdate(o,d){this.resolvedProperty.fromArray(o,d),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(o,d){this.resolvedProperty.fromArray(o,d),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(o,d){this.bind(),this.getValue(o,d)}_setValue_unbound(o,d){this.bind(),this.setValue(o,d)}bind(){let o=this.node;const d=this.parsedPath,v=d.objectName,b=d.propertyName;let E=d.propertyIndex;if(o||(o=ns.findNode(this.rootNode,d.nodeName),this.node=o),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!o)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(v){let G=d.objectIndex;switch(v){case"materials":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);o=o.material.materials;break;case"bones":if(!o.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);o=o.skeleton.bones;for(let te=0;te<o.length;te++)if(o[te].name===G){G=te;break}break;case"map":if("map"in o){o=o.map;break}if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);o=o.material.map;break;default:if(o[v]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);o=o[v]}if(G!==void 0){if(o[G]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,o);o=o[G]}}const P=o[b];if(P===void 0){const G=d.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+G+"."+b+" but it wasn't found.",o)}let O=this.Versioning.None;this.targetObject=o,o.needsUpdate!==void 0?O=this.Versioning.NeedsUpdate:o.matrixWorldNeedsUpdate!==void 0&&(O=this.Versioning.MatrixWorldNeedsUpdate);let Q=this.BindingType.Direct;if(E!==void 0){if(b==="morphTargetInfluences"){if(!o.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!o.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);o.morphTargetDictionary[E]!==void 0&&(E=o.morphTargetDictionary[E])}Q=this.BindingType.ArrayElement,this.resolvedProperty=P,this.propertyIndex=E}else P.fromArray!==void 0&&P.toArray!==void 0?(Q=this.BindingType.HasFromToArray,this.resolvedProperty=P):Array.isArray(P)?(Q=this.BindingType.EntireArray,this.resolvedProperty=P):this.propertyName=b;this.getValue=this.GetterByBindingType[Q],this.setValue=this.SetterByBindingTypeAndVersioning[Q][O]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ns.Composite=class{constructor(I,o,d){const v=d||ns.parseTrackName(o);this._targetGroup=I,this._bindings=I.subscribe_(o,v)}getValue(I,o){this.bind();const d=this._targetGroup.nCachedObjects_,v=this._bindings[d];v!==void 0&&v.getValue(I,o)}setValue(I,o){const d=this._bindings;for(let v=this._targetGroup.nCachedObjects_,b=d.length;v!==b;++v)d[v].setValue(I,o)}bind(){const I=this._bindings;for(let o=this._targetGroup.nCachedObjects_,d=I.length;o!==d;++o)I[o].bind()}unbind(){const I=this._bindings;for(let o=this._targetGroup.nCachedObjects_,d=I.length;o!==d;++o)I[o].unbind()}},ns.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ns.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ns.prototype.GetterByBindingType=[ns.prototype._getValue_direct,ns.prototype._getValue_array,ns.prototype._getValue_arrayElement,ns.prototype._getValue_toArray],ns.prototype.SetterByBindingTypeAndVersioning=[[ns.prototype._setValue_direct,ns.prototype._setValue_direct_setNeedsUpdate,ns.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ns.prototype._setValue_array,ns.prototype._setValue_array_setNeedsUpdate,ns.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ns.prototype._setValue_arrayElement,ns.prototype._setValue_arrayElement_setNeedsUpdate,ns.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ns.prototype._setValue_fromArray,ns.prototype._setValue_fromArray_setNeedsUpdate,ns.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class fy{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Sa(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const o={};this._indicesByUUID=o;for(let v=0,b=arguments.length;v!==b;++v)o[arguments[v].uuid]=v;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}add(){const o=this._objects,d=this._indicesByUUID,v=this._paths,b=this._parsedPaths,E=this._bindings,P=E.length;let O,Q=o.length,G=this.nCachedObjects_;for(let te=0,ge=arguments.length;te!==ge;++te){const fe=arguments[te],_e=fe.uuid;let xe=d[_e];if(xe===void 0){xe=Q++,d[_e]=xe,o.push(fe);for(let Re=0,we=P;Re!==we;++Re)E[Re].push(new ns(fe,v[Re],b[Re]))}else if(xe<G){O=o[xe];const Re=--G,we=o[Re];d[we.uuid]=xe,o[xe]=we,d[_e]=Re,o[Re]=fe;for(let Ce=0,De=P;Ce!==De;++Ce){const ze=E[Ce],dt=ze[Re];let rt=ze[xe];ze[xe]=dt,rt===void 0&&(rt=new ns(fe,v[Ce],b[Ce])),ze[Re]=rt}}else o[xe]!==O&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=G}remove(){const o=this._objects,d=this._indicesByUUID,v=this._bindings,b=v.length;let E=this.nCachedObjects_;for(let P=0,O=arguments.length;P!==O;++P){const Q=arguments[P],G=Q.uuid,te=d[G];if(te!==void 0&&te>=E){const ge=E++,fe=o[ge];d[fe.uuid]=te,o[te]=fe,d[G]=ge,o[ge]=Q;for(let _e=0,xe=b;_e!==xe;++_e){const Re=v[_e],we=Re[ge],Ce=Re[te];Re[te]=we,Re[ge]=Ce}}}this.nCachedObjects_=E}uncache(){const o=this._objects,d=this._indicesByUUID,v=this._bindings,b=v.length;let E=this.nCachedObjects_,P=o.length;for(let O=0,Q=arguments.length;O!==Q;++O){const G=arguments[O].uuid,te=d[G];if(te!==void 0)if(delete d[G],te<E){const ge=--E,fe=o[ge],_e=--P,xe=o[_e];d[fe.uuid]=te,o[te]=fe,d[xe.uuid]=ge,o[ge]=xe,o.pop();for(let Re=0,we=b;Re!==we;++Re){const Ce=v[Re],De=Ce[ge],ze=Ce[_e];Ce[te]=De,Ce[ge]=ze,Ce.pop()}}else{const ge=--P,fe=o[ge];ge>0&&(d[fe.uuid]=te),o[te]=fe,o.pop();for(let _e=0,xe=b;_e!==xe;++_e){const Re=v[_e];Re[te]=Re[ge],Re.pop()}}}this.nCachedObjects_=E}subscribe_(o,d){const v=this._bindingsIndicesByPath;let b=v[o];const E=this._bindings;if(b!==void 0)return E[b];const P=this._paths,O=this._parsedPaths,Q=this._objects,G=Q.length,te=this.nCachedObjects_,ge=new Array(G);b=E.length,v[o]=b,P.push(o),O.push(d),E.push(ge);for(let fe=te,_e=Q.length;fe!==_e;++fe){const xe=Q[fe];ge[fe]=new ns(xe,o,d)}return ge}unsubscribe_(o){const d=this._bindingsIndicesByPath,v=d[o];if(v!==void 0){const b=this._paths,E=this._parsedPaths,P=this._bindings,O=P.length-1,Q=P[O];d[o[O]]=v,P[v]=Q,P.pop(),E[v]=E[O],E.pop(),b[v]=b[O],b.pop()}}}class vv{constructor(o,d,v=null,b=d.blendMode){this._mixer=o,this._clip=d,this._localRoot=v,this.blendMode=b;const E=d.tracks,P=E.length,O=new Array(P),Q={endingStart:ur,endingEnd:ur};for(let G=0;G!==P;++G){const te=E[G].createInterpolant(null);O[G]=te,te.settings=Q}this._interpolantSettings=Q,this._interpolants=O,this._propertyBindings=new Array(P),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Oi,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(o){return this._startTime=o,this}setLoop(o,d){return this.loop=o,this.repetitions=d,this}setEffectiveWeight(o){return this.weight=o,this._effectiveWeight=this.enabled?o:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(o){return this._scheduleFading(o,0,1)}fadeOut(o){return this._scheduleFading(o,1,0)}crossFadeFrom(o,d,v){if(o.fadeOut(d),this.fadeIn(d),v){const b=this._clip.duration,E=o._clip.duration,P=E/b,O=b/E;o.warp(1,P,d),this.warp(O,1,d)}return this}crossFadeTo(o,d,v){return o.crossFadeFrom(this,d,v)}stopFading(){const o=this._weightInterpolant;return o!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}setEffectiveTimeScale(o){return this.timeScale=o,this._effectiveTimeScale=this.paused?0:o,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(o){return this.timeScale=this._clip.duration/o,this.stopWarping()}syncWith(o){return this.time=o.time,this.timeScale=o.timeScale,this.stopWarping()}halt(o){return this.warp(this._effectiveTimeScale,0,o)}warp(o,d,v){const b=this._mixer,E=b.time,P=this.timeScale;let O=this._timeScaleInterpolant;O===null&&(O=b._lendControlInterpolant(),this._timeScaleInterpolant=O);const Q=O.parameterPositions,G=O.sampleValues;return Q[0]=E,Q[1]=E+v,G[0]=o/P,G[1]=d/P,this}stopWarping(){const o=this._timeScaleInterpolant;return o!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(o,d,v,b){if(!this.enabled)return void this._updateWeight(o);const E=this._startTime;if(E!==null){const Q=(o-E)*v;Q<0||v===0?d=0:(this._startTime=null,d=v*Q)}d*=this._updateTimeScale(o);const P=this._updateTime(d),O=this._updateWeight(o);if(O>0){const Q=this._interpolants,G=this._propertyBindings;if(this.blendMode===gs)for(let te=0,ge=Q.length;te!==ge;++te)Q[te].evaluate(P),G[te].accumulateAdditive(O);else for(let te=0,ge=Q.length;te!==ge;++te)Q[te].evaluate(P),G[te].accumulate(b,O)}}_updateWeight(o){let d=0;if(this.enabled){d=this.weight;const v=this._weightInterpolant;if(v!==null){const b=v.evaluate(o)[0];d*=b,o>v.parameterPositions[1]&&(this.stopFading(),b===0&&(this.enabled=!1))}}return this._effectiveWeight=d,d}_updateTimeScale(o){let d=0;if(!this.paused){d=this.timeScale;const v=this._timeScaleInterpolant;v!==null&&(d*=v.evaluate(o)[0],o>v.parameterPositions[1]&&(this.stopWarping(),d===0?this.paused=!0:this.timeScale=d))}return this._effectiveTimeScale=d,d}_updateTime(o){const d=this._clip.duration,v=this.loop;let b=this.time+o,E=this._loopCount;const P=v===Ki;if(o===0)return E===-1?b:P&&(1&E)==1?d-b:b;if(v===Yn){E===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(b>=d)b=d;else{if(!(b<0)){this.time=b;break t}b=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=b,this._mixer.dispatchEvent({type:"finished",action:this,direction:o<0?-1:1})}}else{if(E===-1&&(o>=0?(E=0,this._setEndings(!0,this.repetitions===0,P)):this._setEndings(this.repetitions===0,!0,P)),b>=d||b<0){const O=Math.floor(b/d);b-=d*O,E+=Math.abs(O);const Q=this.repetitions-E;if(Q<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=o>0?d:0,this.time=b,this._mixer.dispatchEvent({type:"finished",action:this,direction:o>0?1:-1});else{if(Q===1){const G=o<0;this._setEndings(G,!G,P)}else this._setEndings(!1,!1,P);this._loopCount=E,this.time=b,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:O})}}else this.time=b;if(P&&(1&E)==1)return d-b}return b}_setEndings(o,d,v){const b=this._interpolantSettings;v?(b.endingStart=eo,b.endingEnd=eo):(b.endingStart=o?this.zeroSlopeAtStart?eo:ur:Jo,b.endingEnd=d?this.zeroSlopeAtEnd?eo:ur:Jo)}_scheduleFading(o,d,v){const b=this._mixer,E=b.time;let P=this._weightInterpolant;P===null&&(P=b._lendControlInterpolant(),this._weightInterpolant=P);const O=P.parameterPositions,Q=P.sampleValues;return O[0]=E,Q[0]=d,O[1]=E+o,Q[1]=v,this}}const yp=new Float32Array(1);class OE extends Cc{constructor(o){super(),this._root=o,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(o,d){const v=o._localRoot||this._root,b=o._clip.tracks,E=b.length,P=o._propertyBindings,O=o._interpolants,Q=v.uuid,G=this._bindingsByRootAndName;let te=G[Q];te===void 0&&(te={},G[Q]=te);for(let ge=0;ge!==E;++ge){const fe=b[ge],_e=fe.name;let xe=te[_e];if(xe!==void 0)++xe.referenceCount,P[ge]=xe;else{if(xe=P[ge],xe!==void 0){xe._cacheIndex===null&&(++xe.referenceCount,this._addInactiveBinding(xe,Q,_e));continue}const Re=d&&d._propertyBindings[ge].binding.parsedPath;xe=new gv(ns.create(v,_e,Re),fe.ValueTypeName,fe.getValueSize()),++xe.referenceCount,this._addInactiveBinding(xe,Q,_e),P[ge]=xe}O[ge].resultBuffer=xe.buffer}}_activateAction(o){if(!this._isActiveAction(o)){if(o._cacheIndex===null){const v=(o._localRoot||this._root).uuid,b=o._clip.uuid,E=this._actionsByClip[b];this._bindAction(o,E&&E.knownActions[0]),this._addInactiveAction(o,b,v)}const d=o._propertyBindings;for(let v=0,b=d.length;v!==b;++v){const E=d[v];E.useCount++==0&&(this._lendBinding(E),E.saveOriginalState())}this._lendAction(o)}}_deactivateAction(o){if(this._isActiveAction(o)){const d=o._propertyBindings;for(let v=0,b=d.length;v!==b;++v){const E=d[v];--E.useCount==0&&(E.restoreOriginalState(),this._takeBackBinding(E))}this._takeBackAction(o)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const o=this;this.stats={actions:{get total(){return o._actions.length},get inUse(){return o._nActiveActions}},bindings:{get total(){return o._bindings.length},get inUse(){return o._nActiveBindings}},controlInterpolants:{get total(){return o._controlInterpolants.length},get inUse(){return o._nActiveControlInterpolants}}}}_isActiveAction(o){const d=o._cacheIndex;return d!==null&&d<this._nActiveActions}_addInactiveAction(o,d,v){const b=this._actions,E=this._actionsByClip;let P=E[d];if(P===void 0)P={knownActions:[o],actionByRoot:{}},o._byClipCacheIndex=0,E[d]=P;else{const O=P.knownActions;o._byClipCacheIndex=O.length,O.push(o)}o._cacheIndex=b.length,b.push(o),P.actionByRoot[v]=o}_removeInactiveAction(o){const d=this._actions,v=d[d.length-1],b=o._cacheIndex;v._cacheIndex=b,d[b]=v,d.pop(),o._cacheIndex=null;const E=o._clip.uuid,P=this._actionsByClip,O=P[E],Q=O.knownActions,G=Q[Q.length-1],te=o._byClipCacheIndex;G._byClipCacheIndex=te,Q[te]=G,Q.pop(),o._byClipCacheIndex=null,delete O.actionByRoot[(o._localRoot||this._root).uuid],Q.length===0&&delete P[E],this._removeInactiveBindingsForAction(o)}_removeInactiveBindingsForAction(o){const d=o._propertyBindings;for(let v=0,b=d.length;v!==b;++v){const E=d[v];--E.referenceCount==0&&this._removeInactiveBinding(E)}}_lendAction(o){const d=this._actions,v=o._cacheIndex,b=this._nActiveActions++,E=d[b];o._cacheIndex=b,d[b]=o,E._cacheIndex=v,d[v]=E}_takeBackAction(o){const d=this._actions,v=o._cacheIndex,b=--this._nActiveActions,E=d[b];o._cacheIndex=b,d[b]=o,E._cacheIndex=v,d[v]=E}_addInactiveBinding(o,d,v){const b=this._bindingsByRootAndName,E=this._bindings;let P=b[d];P===void 0&&(P={},b[d]=P),P[v]=o,o._cacheIndex=E.length,E.push(o)}_removeInactiveBinding(o){const d=this._bindings,v=o.binding,b=v.rootNode.uuid,E=v.path,P=this._bindingsByRootAndName,O=P[b],Q=d[d.length-1],G=o._cacheIndex;Q._cacheIndex=G,d[G]=Q,d.pop(),delete O[E],Object.keys(O).length===0&&delete P[b]}_lendBinding(o){const d=this._bindings,v=o._cacheIndex,b=this._nActiveBindings++,E=d[b];o._cacheIndex=b,d[b]=o,E._cacheIndex=v,d[v]=E}_takeBackBinding(o){const d=this._bindings,v=o._cacheIndex,b=--this._nActiveBindings,E=d[b];o._cacheIndex=b,d[b]=o,E._cacheIndex=v,d[v]=E}_lendControlInterpolant(){const o=this._controlInterpolants,d=this._nActiveControlInterpolants++;let v=o[d];return v===void 0&&(v=new xu(new Float32Array(2),new Float32Array(2),1,yp),v.__cacheIndex=d,o[d]=v),v}_takeBackControlInterpolant(o){const d=this._controlInterpolants,v=o.__cacheIndex,b=--this._nActiveControlInterpolants,E=d[b];o.__cacheIndex=b,d[b]=o,E.__cacheIndex=v,d[v]=E}clipAction(o,d,v){const b=d||this._root,E=b.uuid;let P=typeof o=="string"?Xf.findByName(b,o):o;const O=P!==null?P.uuid:o,Q=this._actionsByClip[O];let G=null;if(v===void 0&&(v=P!==null?P.blendMode:to),Q!==void 0){const ge=Q.actionByRoot[E];if(ge!==void 0&&ge.blendMode===v)return ge;G=Q.knownActions[0],P===null&&(P=G._clip)}if(P===null)return null;const te=new vv(this,P,d,v);return this._bindAction(te,G),this._addInactiveAction(te,O,E),te}existingAction(o,d){const v=d||this._root,b=v.uuid,E=typeof o=="string"?Xf.findByName(v,o):o,P=E?E.uuid:o,O=this._actionsByClip[P];return O!==void 0&&O.actionByRoot[b]||null}stopAllAction(){const o=this._actions;for(let d=this._nActiveActions-1;d>=0;--d)o[d].stop();return this}update(o){o*=this.timeScale;const d=this._actions,v=this._nActiveActions,b=this.time+=o,E=Math.sign(o),P=this._accuIndex^=1;for(let G=0;G!==v;++G)d[G]._update(b,o,E,P);const O=this._bindings,Q=this._nActiveBindings;for(let G=0;G!==Q;++G)O[G].apply(P);return this}setTime(o){this.time=0;for(let d=0;d<this._actions.length;d++)this._actions[d].time=0;return this.update(o)}getRoot(){return this._root}uncacheClip(o){const d=this._actions,v=o.uuid,b=this._actionsByClip,E=b[v];if(E!==void 0){const P=E.knownActions;for(let O=0,Q=P.length;O!==Q;++O){const G=P[O];this._deactivateAction(G);const te=G._cacheIndex,ge=d[d.length-1];G._cacheIndex=null,G._byClipCacheIndex=null,ge._cacheIndex=te,d[te]=ge,d.pop(),this._removeInactiveBindingsForAction(G)}delete b[v]}}uncacheRoot(o){const d=o.uuid,v=this._actionsByClip;for(const E in v){const P=v[E].actionByRoot[d];P!==void 0&&(this._deactivateAction(P),this._removeInactiveAction(P))}const b=this._bindingsByRootAndName[d];if(b!==void 0)for(const E in b){const P=b[E];P.restoreOriginalState(),this._removeInactiveBinding(P)}}uncacheAction(o,d){const v=this.existingAction(o,d);v!==null&&(this._deactivateAction(v),this._removeInactiveAction(v))}}class Su{constructor(o){this.value=o}clone(){return new Su(this.value.clone===void 0?this.value:this.value.clone())}}let ih=0;class Fb extends Cc{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:ih++}),this.name="",this.usage=Mc,this.uniforms=[]}add(o){return this.uniforms.push(o),this}remove(o){const d=this.uniforms.indexOf(o);return d!==-1&&this.uniforms.splice(d,1),this}setName(o){return this.name=o,this}setUsage(o){return this.usage=o,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(o){this.name=o.name,this.usage=o.usage;const d=o.uniforms;this.uniforms.length=0;for(let v=0,b=d.length;v<b;v++)this.uniforms.push(d[v].clone());return this}clone(){return new this.constructor().copy(this)}}class NE extends Km{constructor(o,d,v=1){super(o,d),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=v}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}clone(o){const d=super.clone(o);return d.meshPerAttribute=this.meshPerAttribute,d}toJSON(o){const d=super.toJSON(o);return d.isInstancedInterleavedBuffer=!0,d.meshPerAttribute=this.meshPerAttribute,d}}class kE{constructor(o,d,v,b,E){this.isGLBufferAttribute=!0,this.name="",this.buffer=o,this.type=d,this.itemSize=v,this.elementSize=b,this.count=E,this.version=0}set needsUpdate(o){o===!0&&this.version++}setBuffer(o){return this.buffer=o,this}setType(o,d){return this.type=o,this.elementSize=d,this}setItemSize(o){return this.itemSize=o,this}setCount(o){return this.count=o,this}}class UE{constructor(o,d,v=0,b=1/0){this.ray=new Bc(o,d),this.near=v,this.far=b,this.camera=null,this.layers=new Zo,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(o,d){this.ray.set(o,d)}setFromCamera(o,d){d.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(d.matrixWorld),this.ray.direction.set(o.x,o.y,.5).unproject(d).sub(this.ray.origin).normalize(),this.camera=d):d.isOrthographicCamera?(this.ray.origin.set(o.x,o.y,(d.near+d.far)/(d.near-d.far)).unproject(d),this.ray.direction.set(0,0,-1).transformDirection(d.matrixWorld),this.camera=d):console.error("THREE.Raycaster: Unsupported camera type: "+d.type)}intersectObject(o,d=!0,v=[]){return my(o,this,v,d),v.sort(zb),v}intersectObjects(o,d=!0,v=[]){for(let b=0,E=o.length;b<E;b++)my(o[b],this,v,d);return v.sort(zb),v}}function zb(I,o){return I.distance-o.distance}function my(I,o,d,v){if(I.layers.test(o.layers)&&I.raycast(o,d),v===!0){const b=I.children;for(let E=0,P=b.length;E<P;E++)my(b[E],o,d,!0)}}class Vb{constructor(o=1,d=0,v=0){return this.radius=o,this.phi=d,this.theta=v,this}set(o,d,v){return this.radius=o,this.phi=d,this.theta=v,this}copy(o){return this.radius=o.radius,this.phi=o.phi,this.theta=o.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,d,v){return this.radius=Math.sqrt(o*o+d*d+v*v),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(o,v),this.phi=Math.acos(zs(d/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class jb{constructor(o=1,d=0,v=0){return this.radius=o,this.theta=d,this.y=v,this}set(o,d,v){return this.radius=o,this.theta=d,this.y=v,this}copy(o){return this.radius=o.radius,this.theta=o.theta,this.y=o.y,this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,d,v){return this.radius=Math.sqrt(o*o+v*v),this.theta=Math.atan2(o,v),this.y=d,this}clone(){return new this.constructor().copy(this)}}const yv=new jn;class Gb{constructor(o=new jn(1/0,1/0),d=new jn(-1/0,-1/0)){this.isBox2=!0,this.min=o,this.max=d}set(o,d){return this.min.copy(o),this.max.copy(d),this}setFromPoints(o){this.makeEmpty();for(let d=0,v=o.length;d<v;d++)this.expandByPoint(o[d]);return this}setFromCenterAndSize(o,d){const v=yv.copy(d).multiplyScalar(.5);return this.min.copy(o).sub(v),this.max.copy(o).add(v),this}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(o){return this.isEmpty()?o.set(0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y}getParameter(o,d){return d.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y)}clampPoint(o,d){return d.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return this.clampPoint(o,yv).distanceTo(o)}intersect(o){return this.min.max(o.min),this.max.min(o.max),this.isEmpty()&&this.makeEmpty(),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const gy=new At,tl=new At;class Av{constructor(o=new At,d=new At){this.start=o,this.end=d}set(o,d){return this.start.copy(o),this.end.copy(d),this}copy(o){return this.start.copy(o.start),this.end.copy(o.end),this}getCenter(o){return o.addVectors(this.start,this.end).multiplyScalar(.5)}delta(o){return o.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(o,d){return this.delta(d).multiplyScalar(o).add(this.start)}closestPointToPointParameter(o,d){gy.subVectors(o,this.start),tl.subVectors(this.end,this.start);const v=tl.dot(tl);let b=tl.dot(gy)/v;return d&&(b=zs(b,0,1)),b}closestPointToPoint(o,d,v){const b=this.closestPointToPointParameter(o,d);return this.delta(v).multiplyScalar(b).add(this.start)}applyMatrix4(o){return this.start.applyMatrix4(o),this.end.applyMatrix4(o),this}equals(o){return o.start.equals(this.start)&&o.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Hb=new At;class Wb extends Gr{constructor(o,d){super(),this.light=o,this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=d,this.type="SpotLightHelper";const v=new Ie,b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let P=0,O=1,Q=32;P<Q;P++,O++){const G=P/Q*Math.PI*2,te=O/Q*Math.PI*2;b.push(Math.cos(G),Math.sin(G),1,Math.cos(te),Math.sin(te),1)}v.setAttribute("position",new ki(b,3));const E=new ka({fog:!1,toneMapped:!1});this.cone=new bl(v,E),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const o=this.light.distance?this.light.distance:1e3,d=o*Math.tan(this.light.angle);this.cone.scale.set(d,d,o),Hb.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Hb),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Xc=new At,Sg=new Sr,_a=new Sr;class nl extends bl{constructor(o){const d=$f(o),v=new Ie,b=[],E=[],P=new Mi(0,0,1),O=new Mi(0,1,0);for(let Q=0;Q<d.length;Q++){const G=d[Q];G.parent&&G.parent.isBone&&(b.push(0,0,0),b.push(0,0,0),E.push(P.r,P.g,P.b),E.push(O.r,O.g,O.b))}v.setAttribute("position",new ki(b,3)),v.setAttribute("color",new ki(E,3)),super(v,new ka({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=o,this.bones=d,this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(o){const d=this.bones,v=this.geometry,b=v.getAttribute("position");_a.copy(this.root.matrixWorld).invert();for(let E=0,P=0;E<d.length;E++){const O=d[E];O.parent&&O.parent.isBone&&(Sg.multiplyMatrices(_a,O.matrixWorld),Xc.setFromMatrixPosition(Sg),b.setXYZ(P,Xc.x,Xc.y,Xc.z),Sg.multiplyMatrices(_a,O.parent.matrixWorld),Xc.setFromMatrixPosition(Sg),b.setXYZ(P+1,Xc.x,Xc.y,Xc.z),P+=2)}v.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(o)}dispose(){this.geometry.dispose(),this.material.dispose()}}function $f(I){const o=[];I.isBone===!0&&o.push(I);for(let d=0;d<I.children.length;d++)o.push.apply(o,$f(I.children[d]));return o}class bv extends Co{constructor(o,d,v){super(new zf(d,4,2),new ys({wireframe:!0,fog:!1,toneMapped:!1})),this.light=o,this.color=v,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const xv=new At,wv=new Mi,vy=new Mi;class Qb extends Gr{constructor(o,d,v){super(),this.light=o,this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=v,this.type="HemisphereLightHelper";const b=new sp(d);b.rotateY(.5*Math.PI),this.material=new ys({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const E=b.getAttribute("position"),P=new Float32Array(3*E.count);b.setAttribute("color",new As(P,3)),this.add(new Co(b,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const o=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const d=o.geometry.getAttribute("color");wv.copy(this.light.color),vy.copy(this.light.groundColor);for(let v=0,b=d.count;v<b;v++){const E=v<b/2?wv:vy;d.setXYZ(v,E.r,E.g,E.b)}d.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),o.lookAt(xv.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Xb extends bl{constructor(o=10,d=10,v=4473924,b=8947848){v=new Mi(v),b=new Mi(b);const E=d/2,P=o/d,O=o/2,Q=[],G=[];for(let ge=0,fe=0,_e=-O;ge<=d;ge++,_e+=P){Q.push(-O,0,_e,O,0,_e),Q.push(_e,0,-O,_e,0,O);const xe=ge===E?v:b;xe.toArray(G,fe),fe+=3,xe.toArray(G,fe),fe+=3,xe.toArray(G,fe),fe+=3,xe.toArray(G,fe),fe+=3}const te=new Ie;te.setAttribute("position",new ki(Q,3)),te.setAttribute("color",new ki(G,3)),super(te,new ka({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class yy extends bl{constructor(o=10,d=16,v=8,b=64,E=4473924,P=8947848){E=new Mi(E),P=new Mi(P);const O=[],Q=[];if(d>1)for(let te=0;te<d;te++){const ge=te/d*(2*Math.PI),fe=Math.sin(ge)*o,_e=Math.cos(ge)*o;O.push(0,0,0),O.push(fe,0,_e);const xe=1&te?E:P;Q.push(xe.r,xe.g,xe.b),Q.push(xe.r,xe.g,xe.b)}for(let te=0;te<v;te++){const ge=1&te?E:P,fe=o-o/v*te;for(let _e=0;_e<b;_e++){let xe=_e/b*(2*Math.PI),Re=Math.sin(xe)*fe,we=Math.cos(xe)*fe;O.push(Re,0,we),Q.push(ge.r,ge.g,ge.b),xe=(_e+1)/b*(2*Math.PI),Re=Math.sin(xe)*fe,we=Math.cos(xe)*fe,O.push(Re,0,we),Q.push(ge.r,ge.g,ge.b)}}const G=new Ie;G.setAttribute("position",new ki(O,3)),G.setAttribute("color",new ki(Q,3)),super(G,new ka({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Ay=new At,Ev=new At,by=new At;class xy extends Gr{constructor(o,d,v){super(),this.light=o,this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=v,this.type="DirectionalLightHelper",d===void 0&&(d=1);let b=new Ie;b.setAttribute("position",new ki([-d,d,0,d,d,0,d,-d,0,-d,-d,0,-d,d,0],3));const E=new ka({fog:!1,toneMapped:!1});this.lightPlane=new Ku(b,E),this.add(this.lightPlane),b=new Ie,b.setAttribute("position",new ki([0,0,0,0,0,1],3)),this.targetLine=new Ku(b,E),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Ay.setFromMatrixPosition(this.light.matrixWorld),Ev.setFromMatrixPosition(this.light.target.matrixWorld),by.subVectors(Ev,Ay),this.lightPlane.lookAt(Ev),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ev),this.targetLine.scale.z=by.length()}}const Cs=new At,Rs=new Hu;class Tu extends bl{constructor(o){const d=new Ie,v=new ka({color:16777215,vertexColors:!0,toneMapped:!1}),b=[],E=[],P={};function O(xe,Re){Q(xe),Q(Re)}function Q(xe){b.push(0,0,0),E.push(0,0,0),P[xe]===void 0&&(P[xe]=[]),P[xe].push(b.length/3-1)}O("n1","n2"),O("n2","n4"),O("n4","n3"),O("n3","n1"),O("f1","f2"),O("f2","f4"),O("f4","f3"),O("f3","f1"),O("n1","f1"),O("n2","f2"),O("n3","f3"),O("n4","f4"),O("p","n1"),O("p","n2"),O("p","n3"),O("p","n4"),O("u1","u2"),O("u2","u3"),O("u3","u1"),O("c","t"),O("p","c"),O("cn1","cn2"),O("cn3","cn4"),O("cf1","cf2"),O("cf3","cf4"),d.setAttribute("position",new ki(b,3)),d.setAttribute("color",new ki(E,3)),super(d,v),this.type="CameraHelper",this.camera=o,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=P,this.update();const G=new Mi(16755200),te=new Mi(16711680),ge=new Mi(43775),fe=new Mi(16777215),_e=new Mi(3355443);this.setColors(G,te,ge,fe,_e)}setColors(o,d,v,b,E){const P=this.geometry.getAttribute("color");P.setXYZ(0,o.r,o.g,o.b),P.setXYZ(1,o.r,o.g,o.b),P.setXYZ(2,o.r,o.g,o.b),P.setXYZ(3,o.r,o.g,o.b),P.setXYZ(4,o.r,o.g,o.b),P.setXYZ(5,o.r,o.g,o.b),P.setXYZ(6,o.r,o.g,o.b),P.setXYZ(7,o.r,o.g,o.b),P.setXYZ(8,o.r,o.g,o.b),P.setXYZ(9,o.r,o.g,o.b),P.setXYZ(10,o.r,o.g,o.b),P.setXYZ(11,o.r,o.g,o.b),P.setXYZ(12,o.r,o.g,o.b),P.setXYZ(13,o.r,o.g,o.b),P.setXYZ(14,o.r,o.g,o.b),P.setXYZ(15,o.r,o.g,o.b),P.setXYZ(16,o.r,o.g,o.b),P.setXYZ(17,o.r,o.g,o.b),P.setXYZ(18,o.r,o.g,o.b),P.setXYZ(19,o.r,o.g,o.b),P.setXYZ(20,o.r,o.g,o.b),P.setXYZ(21,o.r,o.g,o.b),P.setXYZ(22,o.r,o.g,o.b),P.setXYZ(23,o.r,o.g,o.b),P.setXYZ(24,d.r,d.g,d.b),P.setXYZ(25,d.r,d.g,d.b),P.setXYZ(26,d.r,d.g,d.b),P.setXYZ(27,d.r,d.g,d.b),P.setXYZ(28,d.r,d.g,d.b),P.setXYZ(29,d.r,d.g,d.b),P.setXYZ(30,d.r,d.g,d.b),P.setXYZ(31,d.r,d.g,d.b),P.setXYZ(32,v.r,v.g,v.b),P.setXYZ(33,v.r,v.g,v.b),P.setXYZ(34,v.r,v.g,v.b),P.setXYZ(35,v.r,v.g,v.b),P.setXYZ(36,v.r,v.g,v.b),P.setXYZ(37,v.r,v.g,v.b),P.setXYZ(38,b.r,b.g,b.b),P.setXYZ(39,b.r,b.g,b.b),P.setXYZ(40,E.r,E.g,E.b),P.setXYZ(41,E.r,E.g,E.b),P.setXYZ(42,E.r,E.g,E.b),P.setXYZ(43,E.r,E.g,E.b),P.setXYZ(44,E.r,E.g,E.b),P.setXYZ(45,E.r,E.g,E.b),P.setXYZ(46,E.r,E.g,E.b),P.setXYZ(47,E.r,E.g,E.b),P.setXYZ(48,E.r,E.g,E.b),P.setXYZ(49,E.r,E.g,E.b),P.needsUpdate=!0}update(){const o=this.geometry,d=this.pointMap;Rs.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Is("c",d,o,Rs,0,0,-1),Is("t",d,o,Rs,0,0,1),Is("n1",d,o,Rs,-1,-1,-1),Is("n2",d,o,Rs,1,-1,-1),Is("n3",d,o,Rs,-1,1,-1),Is("n4",d,o,Rs,1,1,-1),Is("f1",d,o,Rs,-1,-1,1),Is("f2",d,o,Rs,1,-1,1),Is("f3",d,o,Rs,-1,1,1),Is("f4",d,o,Rs,1,1,1),Is("u1",d,o,Rs,.7,1.1,-1),Is("u2",d,o,Rs,-.7,1.1,-1),Is("u3",d,o,Rs,0,2,-1),Is("cf1",d,o,Rs,-1,0,1),Is("cf2",d,o,Rs,1,0,1),Is("cf3",d,o,Rs,0,-1,1),Is("cf4",d,o,Rs,0,1,1),Is("cn1",d,o,Rs,-1,0,-1),Is("cn2",d,o,Rs,1,0,-1),Is("cn3",d,o,Rs,0,-1,-1),Is("cn4",d,o,Rs,0,1,-1),o.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Is(I,o,d,v,b,E,P){Cs.set(b,E,P).unproject(v);const O=o[I];if(O!==void 0){const Q=d.getAttribute("position");for(let G=0,te=O.length;G<te;G++)Q.setXYZ(O[G],Cs.x,Cs.y,Cs.z)}}const Xh=new ec;class FE extends bl{constructor(o,d=16776960){const v=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),b=new Float32Array(24),E=new Ie;E.setIndex(new As(v,1)),E.setAttribute("position",new As(b,3)),super(E,new ka({color:d,toneMapped:!1})),this.object=o,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(o){if(o!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Xh.setFromObject(this.object),Xh.isEmpty())return;const d=Xh.min,v=Xh.max,b=this.geometry.attributes.position,E=b.array;E[0]=v.x,E[1]=v.y,E[2]=v.z,E[3]=d.x,E[4]=v.y,E[5]=v.z,E[6]=d.x,E[7]=d.y,E[8]=v.z,E[9]=v.x,E[10]=d.y,E[11]=v.z,E[12]=v.x,E[13]=v.y,E[14]=d.z,E[15]=d.x,E[16]=v.y,E[17]=d.z,E[18]=d.x,E[19]=d.y,E[20]=d.z,E[21]=v.x,E[22]=d.y,E[23]=d.z,b.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(o){return this.object=o,this.update(),this}copy(o,d){return super.copy(o,d),this.object=o.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class zE extends bl{constructor(o,d=16776960){const v=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),b=new Ie;b.setIndex(new As(v,1)),b.setAttribute("position",new ki([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(b,new ka({color:d,toneMapped:!1})),this.box=o,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(o){const d=this.box;d.isEmpty()||(d.getCenter(this.position),d.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(o))}dispose(){this.geometry.dispose(),this.material.dispose()}}class VE extends Ku{constructor(o,d=1,v=16776960){const b=v,E=new Ie;E.setAttribute("position",new ki([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),E.computeBoundingSphere(),super(E,new ka({color:b,toneMapped:!1})),this.type="PlaneHelper",this.plane=o,this.size=d;const P=new Ie;P.setAttribute("position",new ki([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),P.computeBoundingSphere(),this.add(new Co(P,new ys({color:b,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(o){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(o)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const qb=new At;let Jf,jl;class wy extends Gr{constructor(o=new At(0,0,1),d=new At(0,0,0),v=1,b=16776960,E=.2*v,P=.2*E){super(),this.type="ArrowHelper",Jf===void 0&&(Jf=new Ie,Jf.setAttribute("position",new ki([0,0,0,0,1,0],3)),jl=new ep(0,.5,1,5,1),jl.translate(0,-.5,0)),this.position.copy(d),this.line=new Ku(Jf,new ka({color:b,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Co(jl,new ys({color:b,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(o),this.setLength(v,E,P)}setDirection(o){if(o.y>.99999)this.quaternion.set(0,0,0,1);else if(o.y<-.99999)this.quaternion.set(1,0,0,0);else{qb.set(o.z,0,-o.x).normalize();const d=Math.acos(o.y);this.quaternion.setFromAxisAngle(qb,d)}}setLength(o,d=.2*o,v=.2*d){this.line.scale.set(1,Math.max(1e-4,o-d),1),this.line.updateMatrix(),this.cone.scale.set(v,d,v),this.cone.position.y=o,this.cone.updateMatrix()}setColor(o){this.line.material.color.set(o),this.cone.material.color.set(o)}copy(o){return super.copy(o,!1),this.line.copy(o.line),this.cone.copy(o.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Ey extends bl{constructor(o=1){const d=[0,0,0,o,0,0,0,0,0,0,o,0,0,0,0,0,0,o],v=new Ie;v.setAttribute("position",new ki(d,3)),v.setAttribute("color",new ki([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(v,new ka({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(o,d,v){const b=new Mi,E=this.geometry.attributes.color.array;return b.set(o),b.toArray(E,0),b.toArray(E,3),b.set(d),b.toArray(E,6),b.toArray(E,9),b.set(v),b.toArray(E,12),b.toArray(E,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Yb{constructor(){this.type="ShapePath",this.color=new Mi,this.subPaths=[],this.currentPath=null}moveTo(o,d){return this.currentPath=new og,this.subPaths.push(this.currentPath),this.currentPath.moveTo(o,d),this}lineTo(o,d){return this.currentPath.lineTo(o,d),this}quadraticCurveTo(o,d,v,b){return this.currentPath.quadraticCurveTo(o,d,v,b),this}bezierCurveTo(o,d,v,b,E,P){return this.currentPath.bezierCurveTo(o,d,v,b,E,P),this}splineThru(o){return this.currentPath.splineThru(o),this}toShapes(o){function d(we,Ce){const De=Ce.length;let ze=!1;for(let dt=De-1,rt=0;rt<De;dt=rt++){let st=Ce[dt],It=Ce[rt],Kt=It.x-st.x,Dt=It.y-st.y;if(Math.abs(Dt)>Number.EPSILON){if(Dt<0&&(st=Ce[rt],Kt=-Kt,It=Ce[dt],Dt=-Dt),we.y<st.y||we.y>It.y)continue;if(we.y===st.y){if(we.x===st.x)return!0}else{const an=Dt*(we.x-st.x)-Kt*(we.y-st.y);if(an===0)return!0;if(an<0)continue;ze=!ze}}else{if(we.y!==st.y)continue;if(It.x<=we.x&&we.x<=st.x||st.x<=we.x&&we.x<=It.x)return!0}}return ze}const v=pc.isClockWise,b=this.subPaths;if(b.length===0)return[];let E,P,O;const Q=[];if(b.length===1)return P=b[0],O=new tp,O.curves=P.curves,Q.push(O),Q;let G=!v(b[0].getPoints());G=o?!G:G;const te=[],ge=[];let fe,_e,xe=[],Re=0;ge[Re]=void 0,xe[Re]=[];for(let we=0,Ce=b.length;we<Ce;we++)P=b[we],fe=P.getPoints(),E=v(fe),E=o?!E:E,E?(!G&&ge[Re]&&Re++,ge[Re]={s:new tp,p:fe},ge[Re].s.curves=P.curves,G&&Re++,xe[Re]=[]):xe[Re].push({h:P,p:fe[0]});if(!ge[0])return function(we){const Ce=[];for(let De=0,ze=we.length;De<ze;De++){const dt=we[De],rt=new tp;rt.curves=dt.curves,Ce.push(rt)}return Ce}(b);if(ge.length>1){let we=!1,Ce=0;for(let De=0,ze=ge.length;De<ze;De++)te[De]=[];for(let De=0,ze=ge.length;De<ze;De++){const dt=xe[De];for(let rt=0;rt<dt.length;rt++){const st=dt[rt];let It=!0;for(let Kt=0;Kt<ge.length;Kt++)d(st.p,ge[Kt].p)&&(De!==Kt&&Ce++,It?(It=!1,te[Kt].push(st)):we=!0);It&&te[De].push(st)}}Ce>0&&we===!1&&(xe=te)}for(let we=0,Ce=ge.length;we<Ce;we++){O=ge[we].s,Q.push(O),_e=xe[we];for(let De=0,ze=_e.length;De<ze;De++)O.holes.push(_e[De].h)}return Q}}class jE extends ac{constructor(o,d,v,b,E,P){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(o,d,v,b,E,P)}}class rh extends Au{constructor(o,d,v,b){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(o,d,v,b)}}class Tg extends ag{constructor(o,d,v,b){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(o,d,v,b)}}class Sy extends Of{constructor(o,d,v,b,E,P,O){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(o,d,v,b,E,P,O)}}class Ty extends ep{constructor(o,d,v,b,E,P,O,Q){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(o,d,v,b,E,P,O,Q)}}class Kb extends Hh{constructor(o,d){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(o,d)}}class Mg extends fg{constructor(o,d){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(o,d)}}class Sv extends mg{constructor(o,d){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(o,d)}}class $b extends yu{constructor(o,d,v,b){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(o,d,v,b)}}class GE extends sp{constructor(o,d){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(o,d)}}class My extends Nd{constructor(o,d,v,b){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(o,d,v,b)}}class HE extends Hc{constructor(o,d,v,b){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(o,d,v,b)}}class WE extends gg{constructor(o,d,v,b,E,P){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(o,d,v,b,E,P)}}class QE extends Ff{constructor(o,d){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(o,d)}}class XE extends zf{constructor(o,d,v,b,E,P,O){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(o,d,v,b,E,P,O)}}class qE extends Ju{constructor(o,d){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(o,d)}}class Cg extends bu{constructor(o,d,v,b,E){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(o,d,v,b,E)}}class YE extends op{constructor(o,d,v,b,E,P){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(o,d,v,b,E,P)}}class Jb extends Vf{constructor(o,d,v,b,E){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(o,d,v,b,E)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:m}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=m)},553:function(u,r,i){i.d(r,{_:function(){return A}});var m=i(988);const _=new WeakMap;class A extends m.aNw{constructor(R){super(R),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(R){return this.decoderPath=R,this}setDecoderConfig(R){return this.decoderConfig=R,this}setWorkerLimit(R){return this.workerLimit=R,this}load(R,D,U,k){const X=new m.hH6(this.manager);X.setPath(this.path),X.setResponseType("arraybuffer"),X.setRequestHeader(this.requestHeader),X.setWithCredentials(this.withCredentials),X.load(R,J=>{this.parse(J,D,k)},U,k)}parse(R,D,U){this.decodeDracoFile(R,D,null,null,m.KI_).catch(U)}decodeDracoFile(R,D,U,k,X=m.GUF){const J={attributeIDs:U||this.defaultAttributeIDs,attributeTypes:k||this.defaultAttributeTypes,useUniqueIDs:!!U,vertexColorSpace:X};return this.decodeGeometry(R,J).then(D)}decodeGeometry(R,D){const U=JSON.stringify(D);if(_.has(R)){const oe=_.get(R);if(oe.key===U)return oe.promise;if(R.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let k;const X=this.workerNextTaskID++,J=R.byteLength,$=this._getWorker(X,J).then(oe=>(k=oe,new Promise((ne,H)=>{k._callbacks[X]={resolve:ne,reject:H},k.postMessage({type:"decode",id:X,taskConfig:D,buffer:R},[R])}))).then(oe=>this._createGeometry(oe.geometry));return $.catch(()=>!0).then(()=>{k&&X&&this._releaseTask(k,X)}),_.set(R,{key:U,promise:$}),$}_createGeometry(R){const D=new m.u9r;R.index&&D.setIndex(new m.TlE(R.index.array,1));for(let U=0;U<R.attributes.length;U++){const k=R.attributes[U],X=k.name,J=k.array,$=k.itemSize,oe=new m.TlE(J,$);X==="color"&&this._assignVertexColorSpace(oe,k.vertexColorSpace),D.setAttribute(X,oe)}return D}_assignVertexColorSpace(R,D){if(D!==m.KI_)return;const U=new m.Ilk;for(let k=0,X=R.count;k<X;k++)U.fromBufferAttribute(R,k).convertSRGBToLinear(),R.setXYZ(k,U.r,U.g,U.b)}_loadLibrary(R,D){const U=new m.hH6(this.manager);return U.setPath(this.decoderPath),U.setResponseType(D),U.setWithCredentials(this.withCredentials),new Promise((k,X)=>{U.load(R,k,void 0,X)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const R=typeof WebAssembly!="object"||this.decoderConfig.type==="js",D=[];return R?D.push(this._loadLibrary("draco_decoder.js","text")):(D.push(this._loadLibrary("draco_wasm_wrapper.js","text")),D.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(D).then(U=>{const k=U[0];R||(this.decoderConfig.wasmBinary=U[1]);const X=w,J=["/* draco decoder */",k,"","/* worker */",X.substring(X.indexOf("{")+1,X.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([J]))}),this.decoderPending}_getWorker(R,D){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const k=new Worker(this.workerSourceURL);k._callbacks={},k._taskCosts={},k._taskLoad=0,k.postMessage({type:"init",decoderConfig:this.decoderConfig}),k.onmessage=function(X){const J=X.data;switch(J.type){case"decode":k._callbacks[J.id].resolve(J);break;case"error":k._callbacks[J.id].reject(J);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+J.type+'"')}},this.workerPool.push(k)}else this.workerPool.sort(function(k,X){return k._taskLoad>X._taskLoad?-1:1});const U=this.workerPool[this.workerPool.length-1];return U._taskCosts[R]=D,U._taskLoad+=D,U})}_releaseTask(R,D){R._taskLoad-=R._taskCosts[D],delete R._callbacks[D],delete R._taskCosts[D]}debug(){console.log("Task load: ",this.workerPool.map(R=>R._taskLoad))}dispose(){for(let R=0;R<this.workerPool.length;++R)this.workerPool[R].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const w=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__(u){var r=__webpackgi_module_cache__[u];if(r!==void 0)return r.exports;var i=__webpackgi_module_cache__[u]={id:u,exports:{}};return __webpackgi_modules__[u].call(i.exports,i,i.exports,__webpackgi_require__),i.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function(u){var r=u&&u.__esModule?function(){return u.default}:function(){return u};return __webpackgi_require__.d(r,{a:r}),r},getProto=Object.getPrototypeOf?function(u){return Object.getPrototypeOf(u)}:function(u){return u.__proto__},__webpackgi_require__.t=function(u,r){if(1&r&&(u=this(u)),8&r||typeof u=="object"&&u&&(4&r&&u.__esModule||16&r&&typeof u.then=="function"))return u;var i=Object.create(null);__webpackgi_require__.r(i);var m={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var _=2&r&&u;typeof _=="object"&&!~leafPrototypes.indexOf(_);_=getProto(_))Object.getOwnPropertyNames(_).forEach(function(A){m[A]=function(){return u[A]}});return m.default=function(){return u},__webpackgi_require__.d(i,m),i},__webpackgi_require__.d=function(u,r){for(var i in r)__webpackgi_require__.o(r,i)&&!__webpackgi_require__.o(u,i)&&Object.defineProperty(u,i,{enumerable:!0,get:r[i]})},__webpackgi_require__.f={},__webpackgi_require__.e=function(u){return Promise.all(Object.keys(__webpackgi_require__.f).reduce(function(r,i){return __webpackgi_require__.f[i](u,r),r},[]))},__webpackgi_require__.u=function(u){return u+".mjs"},__webpackgi_require__.o=function(u,r){return Object.prototype.hasOwnProperty.call(u,r)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function(u,r,i,m){if(inProgress[u])inProgress[u].push(r);else{var _,A;if(i!==void 0)for(var w=document.getElementsByTagName("script"),T=0;T<w.length;T++){var R=w[T];if(R.getAttribute("src")==u||R.getAttribute("data-webpack")==dataWebpackPrefix+i){_=R;break}}_||(A=!0,(_=document.createElement("script")).type="module",_.charset="utf-8",_.timeout=120,__webpackgi_require__.nc&&_.setAttribute("nonce",__webpackgi_require__.nc),_.setAttribute("data-webpack",dataWebpackPrefix+i),_.src=u),inProgress[u]=[r];var D=function(k,X){_.onerror=_.onload=null,clearTimeout(U);var J=inProgress[u];if(delete inProgress[u],_.parentNode&&_.parentNode.removeChild(_),J&&J.forEach(function($){return $(X)}),k)return k(X)},U=setTimeout(D.bind(null,void 0,{type:"timeout",target:_}),12e4);_.onerror=D.bind(null,_.onerror),_.onload=D.bind(null,_.onload),A&&document.head.appendChild(_)}},__webpackgi_require__.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},function(){var u;if(typeof import.meta.url=="string"&&(u=import.meta.url),!u)throw new Error("Automatic publicPath is not supported in this browser");u=u.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=u+"../../"}(),function(){var u={698:0};__webpackgi_require__.f.j=function(m,_){var A=__webpackgi_require__.o(u,m)?u[m]:void 0;if(A!==0)if(A)_.push(A[2]);else{var w=new Promise(function(D,U){A=u[m]=[D,U]});_.push(A[2]=w);var T=__webpackgi_require__.p+__webpackgi_require__.u(m),R=new Error;__webpackgi_require__.l(T,function(D){if(__webpackgi_require__.o(u,m)&&((A=u[m])!==0&&(u[m]=void 0),A)){var U=D&&(D.type==="load"?"missing":D.type),k=D&&D.target&&D.target.src;R.message="Loading chunk "+m+` failed.
(`+U+": "+k+")",R.name="ChunkLoadError",R.type=U,R.request=k,A[1](R)}},"chunk-"+m,m)}};var r=function(m,_){var A,w,T=_[0],R=_[1],D=_[2],U=0;if(T.some(function(k){return u[k]!==0})){for(A in R)__webpackgi_require__.o(R,A)&&(__webpackgi_require__.m[A]=R[A]);D&&D(__webpackgi_require__)}for(m&&m(_);U<T.length;U++)w=T[U],__webpackgi_require__.o(u,w)&&u[w]&&u[w][0](),u[w]=0},i=self.webpackChunkwebgi=self.webpackChunkwebgi||[];i.forEach(r.bind(null,0)),i.push=r.bind(null,i.push.bind(i))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){var u;__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return Eg},LY2:function(){return i.LY2},GYo:function(){return ww},GPz:function(){return $x},HRj:function(){return Wa},li4:function(){return JM},FO5:function(){return Rp},Nlh:function(){return ZM},Mp4:function(){return Ki},QvI:function(){return Ln},PrA:function(){return iu},JHp:function(){return yo},bGH:function(){return i.bGH},NDo:function(){return i.NDo},gSk:function(){return i.gSk},WMw:function(){return i.WMw},OTo:function(){return i.OTo},Se2:function(){return i.Se2},cum:function(){return i.cum},Mig:function(){return i.Mig},B$7:function(){return nc},i_9:function(){return i.i_9},bBp:function(){return i.bBp},m7l:function(){return i.m7l},sYA:function(){return i.sYA},Xcj:function(){return i.Xcj},mzJ:function(){return i.mzJ},ZZA:function(){return i.ZZA},$Ph:function(){return ia},T__:function(){return i.T__},HkE:function(){return i.HkE},tGC:function(){return i.tGC},g1S:function(){return TT},I$C:function(){return im},QIH:function(){return Nd},_JE:function(){return Su},SwW:function(){return vp},ksm:function(){return ri},jl_:function(){return E_},b7R:function(){return jo},BDV:function(){return w_},Ea_:function(){return M},qff:function(){return E_},tmC:function(){return Dd},BON:function(){return Od},P40:function(){return Ci},wLL:function(){return Mm},iHO:function(){return ct},BbS:function(){return i.BbS},kqm:function(){return i.kqm},Hmr:function(){return i.Hmr},SJI:function(){return i.SJI},mTL:function(){return i.mTL},y8_:function(){return i.y8_},_Li:function(){return i._Li},w7U:function(){return qA},g56:function(){return El},bj3:function(){return Ps},z81:function(){return i.z81},_MY:function(){return i._MY},yEv:function(){return RI},dFZ:function(){return vf},N$j:function(){return i.N$j},_YM:function(){return i._YM},TUj:function(){return i.TUj},ZzF:function(){return i.ZzF},qzb:function(){return V},GQ:function(){return i.GQ},nvb:function(){return i.nvb},DvJ:function(){return i.DvJ},fQA:function(){return i.fQA},cPz:function(){return R0},TlE:function(){return i.TlE},u9r:function(){return i.u9r},s4_:function(){return i.s4_},T95:function(){return i.T95},F5w:function(){return rA},NlP:function(){return mA},$8Z:function(){return Ip},YYN:function(){return cd},CtF:function(){return i.CtF},V1s:function(){return i.V1s},jOv:function(){return Tn},Rki:function(){return i.Rki},pzV:function(){return DA},itZ:function(){return ga},MMq:function(){return gd},qKx:function(){return _s},Hmi:function(){return bd},X4S:function(){return tA},vlJ:function(){return tE},nPO:function(){return ah},zcQ:function(){return Rf},GH1:function(){return Na},ROQ:function(){return i.ROQ},YN5:function(){return i.YN5},BVQ:function(){return i.BVQ},YT8:function(){return i.YT8},_DE:function(){return Im},YGz:function(){return i.YGz},trn:function(){return i.trn},zf8:function(){return i.zf8},uWy:function(){return i.uWy},wYQ:function(){return Vl},SUY:function(){return i.SUY},Ilk:function(){return i.Ilk},R2R:function(){return i.R2R},epp:function(){return i.epp},xmJ:function(){return Za},GD$:function(){return df},Z_g:function(){return i.Z_g},EB7:function(){return i.EB7},DqL:function(){return i.DqL},_3:function(){return i._3},b_z:function(){return i.b_z},OCn:function(){return Pu},N_j:function(){return sN},hNv:function(){return oT},_am:function(){return i._am},kB7:function(){return Cf},fY$:function(){return i.fY$},vxC:function(){return i.vxC},BtG:function(){return i.BtG},cBK:function(){return i.cBK},g8_:function(){return i.g8_},AXT:function(){return i.AXT},yj7:function(){return i.yj7},dYG:function(){return i.dYG},tm_:function(){return i.tm_},S2y:function(){return i.S2y},B02:function(){return i.B02},PeU:function(){return i.PeU},Hyl:function(){return i.Hyl},Wqd:function(){return i.Wqd},c0Q:function(){return WC},re0:function(){return QC},Xaj:function(){return i.Xaj},DUb:function(){return Oa},dZ3:function(){return i.dZ3},m_w:function(){return i.m_w},fHI:function(){return i.fHI},LBq:function(){return i.LBq},Qww:function(){return Nu.Q},CGV:function(){return r.Damper},JUT:function(){return i.JUT},p3g:function(){return i.p3g},IEO:function(){return i.IEO},yxD:function(){return i.yxD},CUS:function(){return fT},A5E:function(){return i.A5E},zqG:function(){return ih},PfX:function(){return pf},Q1o:function(){return da},jfJ:function(){return i.jfJ},T_J:function(){return i.T_J},tEQ:function(){return i.tEQ},gb4:function(){return oc},qkB:function(){return i.qkB},cvk:function(){return Os},HWo:function(){return Bh},brP:function(){return i.brP},$YQ:function(){return i.$YQ},X8d:function(){return gA},Zdt:function(){return hS},yNB:function(){return ls},h7x:function(){return Ls},Ox3:function(){return i.Ox3},qtn:function(){return Ia},cBI:function(){return i.cBI},cU9:function(){return i.cU9},ntt:function(){return i.ntt},DT1:function(){return i.DT1},Kgo:function(){return i.Kgo},ehD:function(){return i.ehD},fhJ:function(){return GA},y1s:function(){return kd},fSK:function(){return i.fSK},Vdb:function(){return i.Vdb},l8J:function(){return i.l8J},dj0:function(){return i.dj0},QM0:function(){return i.QM0},n94:function(){return fx},OIS:function(){return s1},q8b:function(){return bu},TOt:function(){return i.TOt},xaN:function(){return X},Ny0:function(){return i.Ny0},NeD:function(){return V1},Zof:function(){return Co},N1Y:function(){return Vy},itK:function(){return YA},eD:function(){return i.eD},jwo:function(){return i.jwo},dSO:function(){return i.dSO},Bf4:function(){return i.Bf4},USm:function(){return i.USm},pBf:function(){return i.pBf},eBg:function(){return FS},$Vf:function(){return i.$Vf},O7d:function(){return i.O7d},ksq:function(){return Kt},hFL:function(){return jv},gXf:function(){return n1},hH6:function(){return i.hH6},izP:function(){return _A},kpi:function(){return km},DwZ:function(){return ba},kN3:function(){return fS},e62:function(){return i.e62},a$l:function(){return i.a$l},OM3:function(){return i.OM3},VzW:function(){return i.VzW},ybr:function(){return i.ybr},yo9:function(){return i.yo9},Dzq:function(){return Al},zCA:function(){return Wo},$Bt:function(){return Qu},Wzm:function(){return i.Wzm},Wl3:function(){return i.Wl3},iWj:function(){return i.iWj},DNz:function(){return po},m1M:function(){return ir},ylh:function(){return i.ylh},v9Y:function(){return i.v9Y},LSk:function(){return i.LSk},LHE:function(){return Ss},KE0:function(){return L1},KCF:function(){return WM},a4n:function(){return g1},NKC:function(){return Lb},jrv:function(){return Qh},zIH:function(){return au},Hfk:function(){return wh},png:function(){return No},tAj:function(){return At},Eb_:function(){return Eh},SJj:function(){return Yf},BT2:function(){return l1},_8p:function(){return wT},V5Z:function(){return oy},s5b:function(){return lv},BHZ:function(){return KA},hkn:function(){return Jo},GFY:function(){return Ur},w$m:function(){return i.w$m},ksN:function(){return i.ksN},j4z:function(){return i.j4z},OAl:function(){return i.OAl},VLJ:function(){return i.VLJ},C73:function(){return $c},ZAu:function(){return i.ZAu},ibP:function(){return ee},lth:function(){return lp},_fI:function(){return df},hUN:function(){return dc},cLu:function(){return i.cLu},vmT:function(){return i.vmT},Qpg:function(){return i.Qpg},So8:function(){return i.So8},eOv:function(){return RA},Wjw:function(){return i.Wjw},cJO:function(){return i.cJO},QRU:function(){return i.QRU},S3k:function(){return i.S3k},OPJ:function(){return eC},PpQ:function(){return i.PpQ},q_9:function(){return Ms},ZRs:function(){return i.ZRs},oqc:function(){return i.oqc},T_x:function(){return ha},lb7:function(){return i.lb7},L5s:function(){return i.L5s},$TI:function(){return i.$TI},SPe:function(){return i.SPe},aVm:function(){return i.aVm},j87:function(){return i.j87},RNb:function(){return i.RNb},Kz5:function(){return i.Kz5},vpT:function(){return i.vpT},kB5:function(){return i.kB5},_C8:function(){return i._C8},Syv:function(){return i.Syv},NMF:function(){return i.NMF},pIN:function(){return i.pIN},eMJ:function(){return i.eMJ},rN7:function(){return dy},iUp:function(){return hp},GFd:function(){return u1},x5V:function(){return i.x5V},tUh:function(){return i.tUh},z8B:function(){return i.z8B},vcl:function(){return Ro},GZb:function(){return i.GZb},p7y:function(){return i.p7y},S9g:function(){return i.S9g},Zr5:function(){return i.Zr5},vCF:function(){return i.vCF},yt0:function(){return i.yt0},uXU:function(){return i.uXU},_kC:function(){return i._kC},lk7:function(){return i.lk7},USc:function(){return IA},x12:function(){return i.x12},w_R:function(){return xI},Zzh:function(){return i.Zzh},nls:function(){return i.nls},g_z:function(){return i.g_z},U7:function(){return i.U7},FT0:function(){return i.FT0},L1_:function(){return pT},blk:function(){return i.blk},YRm:function(){return Fm},ejS:function(){return i.ejS},wUb:function(){return dT},zOz:function(){return Um},rnI:function(){return i.rnI},wem:function(){return i.wem},lfu:function(){return i.lfu},FDw:function(){return i.FDw},lRj:function(){return i.lRj},D1R:function(){return i.D1R},qyh:function(){return i.qyh},GUF:function(){return i.GUF},EoG:function(){return i.EoG},aNw:function(){return i.aNw},Zp0:function(){return i.Zp0},lLk:function(){return i.lLk},jAl:function(){return i.jAl},uEv:function(){return i.uEv},YKA:function(){return i.YKA},cRx:function(){return i.cRx},Y8D:function(){return i.Y8D},RsA:function(){return i.RsA},Y0m:function(){return Fb},F5T:function(){return i.F5T},EDU:function(){return Mn},z$Q:function(){return Ep},KA8:function(){return Oi},ZqF:function(){return $A},XUj:function(){return ax},Me$:function(){return Zh},u7G:function(){return i.u7G},PEk:function(){return g_},BG4:function(){return Ot},M8C:function(){return i.M8C},Vkp:function(){return i.Vkp},yGw:function(){return i.yGw},Sm8:function(){return i.Sm8},Kj0:function(){return i.Kj0},vBJ:function(){return i.vBJ},QfV:function(){return ss},lRF:function(){return i.lRF},Lun:function(){return i.Lun},YBo:function(){return i.YBo},kaV:function(){return i.kaV},RSm:function(){return i.RSm},xoR:function(){return i.xoR},EJi:function(){return i.EJi},Wid:function(){return i.Wid},iuj:function(){return _o},IKL:function(){return i.IKL},r_:function(){return i.r_},OoA:function(){return i.OoA},qhX:function(){return i.qhX},CRe:function(){return iy},qPT:function(){return Pm},M5h:function(){return i.M5h},Ns1:function(){return i.Ns1},TyD:function(){return i.TyD},vZf:function(){return i.vZf},HTd:function(){return i.HTd},aH4:function(){return i.aH4},YLQ:function(){return i.YLQ},BVF:function(){return i.BVF},MyG:function(){return i.MyG},jFi:function(){return i.jFi},aCh:function(){return i.aCh},uL9:function(){return i.uL9},TNj:function(){return Ul},IFH:function(){return i.IFH},bdR:function(){return i.bdR},RPs:function(){return Xu},kM_:function(){return N0},M6v:function(){return i.M6v},RvT:function(){return i.RvT},dUE:function(){return i.dUE},oe_:function(){return Wb},BuN:function(){return Xc},Tme:function(){return i.Tme},N9P:function(){return gh},Gql:function(){return i.Gql},$XY:function(){return lu},O9d:function(){return JA},zEO:function(){return gm},qfx:function(){return lh},PA7:function(){return i.PA7},REq:function(){return i.REq},pQR:function(){return i.pQR},ghN:function(){return i.ghN},Hy8:function(){return i.Hy8},Wpd:function(){return i.Wpd},LgZ:function(){return i.LgZ},iWC:function(){return i.iWC},mqn:function(){return UO},SKe:function(){return Yt},iKG:function(){return i.iKG},rCq:function(){return eA},_iA:function(){return i._iA},ntZ:function(){return i.ntZ},anP:function(){return i.anP},X2e:function(){return XM},oxT:function(){return ra},FCo:function(){return Du},y$t:function(){return i.y$t},cPb:function(){return i.cPb},lmx:function(){return Kr},JOQ:function(){return i.JOQ},BKK:function(){return i.BKK},_12:function(){return i._12},tJx:function(){return i.tJx},mjX:function(){return Om},cek:function(){return i.cek},qD0:function(){return Lc},xG9:function(){return i.xG9},eqi:function(){return r.PointerDragHelper},wI8:function(){return Np},Sgv:function(){return mS},woe:function(){return i.woe},UY4:function(){return i.UY4},aq0:function(){return i.aq0},ujx:function(){return i.ujx},Uol:function(){return i.Uol},JiH:function(){return Wv},VYz:function(){return i.VYz},B2H:function(){return Bm},_Pm:function(){return Fd},EsW:function(){return na},iUV:function(){return i.iUV},tf:function(){return i.tf},ZQ6:function(){return i.ZQ6},mXe:function(){return i.mXe},_fP:function(){return i._fP},iLg:function(){return i.iLg},zbs:function(){return i.zbs},ZTh:function(){return i.ZTh},HdW:function(){return i.HdW},UZH:function(){return i.UZH},mSO:function(){return i.mSO},wk1:function(){return i.wk1},E2K:function(){return i.E2K},FUD:function(){return i.FUD},pKu:function(){return i.pKu},GG6:function(){return i.GG6},Gih:function(){return i.Gih},iiP:function(){return i.iiP},SvJ:function(){return i.SvJ},ptH:function(){return i.ptH},jZA:function(){return i.jZA},y2t:function(){return i.y2t},gi4:function(){return i.gi4},Djp:function(){return i.Djp},BG$:function(){return i.BG$},NYV:function(){return i.NYV},xJs:function(){return i.xJs},bsb:function(){return i.bsb},ekQ:function(){return i.ekQ},CaW:function(){return i.CaW},eaV:function(){return i.eaV},BFQ:function(){return i.BFQ},v3W:function(){return i.v3W},ILR:function(){return i.ILR},G_r:function(){return i.G_r},N3F:function(){return K},fto:function(){return i.fto},l0P:function(){return i.l0P},vCx:function(){return i.vCx},_AM:function(){return i._AM},wuA:function(){return i.wuA},av9:function(){return i.av9},CtA:function(){return i.CtA},BvQ:function(){return wf},FZJ:function(){return qu},FIo:function(){return i.FIo},zHn:function(){return i.zHn},iMs:function(){return i.iMs},T_f:function(){return i.T_f},hEm:function(){return i.hEm},D9w:function(){return i.D9w},sHH:function(){return Dg},CdI:function(){return i.CdI},rkc:function(){return nu},rpg:function(){return i.rpg},ce8:function(){return i.ce8},rOj:function(){return i.rOj},P6m:function(){return a1},JA6:function(){return id},V4E:function(){return i.V4E},o8S:function(){return i.o8S},flB:function(){return Ii},lGU:function(){return i.lGU},vuL:function(){return i.vuL},KI_:function(){return i.KI_},iLN:function(){return _f},X6w:function(){return yg},rz_:function(){return Qc},jsw:function(){return fa},srG:function(){return Xm},i6Z:function(){return Gd},vfv:function(){return c1},xsS:function(){return i.xsS},or:function(){return PA},EQj:function(){return Ua},Rnn:function(){return gS},TyN:function(){return pm},ov0:function(){return C0},WdD:function(){return i.WdD},Vj0:function(){return i.Vj0},jyz:function(){return i.jyz},mTM:function(){return Zi},Mn1:function(){return kr},Hlq:function(){return ur},Fi7:function(){return Kc},Tn7:function(){return i.Tn7},bnF:function(){return i.bnF},HW6:function(){return i.HW6},oa8:function(){return i.oa8},T_1:function(){return i.T_1},zHJ:function(){return yc},iDF:function(){return i.iDF},iAb:function(){return i.iAb},d4E:function(){return nm},lBg:function(){return MA},JeJ:function(){return bI},FKY:function(){return r.SimpleEventDispatcher},zlZ:function(){return mT},vkg:function(){return _h},brh:function(){return gT},kZK:function(){return Ac},puG:function(){return CA},OdW:function(){return i.OdW},_YX:function(){return i._YX},TUv:function(){return i.TUv},Hw6:function(){return i.Hw6},aLr:function(){return i.aLr},Aip:function(){return i.Aip},xo$:function(){return i.xo$},bIn:function(){return FO},$V:function(){return i.$V},lDi:function(){return i.lDi},gti:function(){return i.gti},PMe:function(){return i.PMe},iwP:function(){return Dc},FvO:function(){return i.FvO},jyi:function(){return i.jyi},xeV:function(){return i.xeV},k74:function(){return i.k74},RlZ:function(){return i.RlZ},KhW:function(){return i.KhW},HgB:function(){return i.HgB},W2J:function(){return i.W2J},JWc:function(){return i.JWc},u37:function(){return i.u37},Z6B:function(){return i.Z6B},QZ1:function(){return i.QZ1},Ir4:function(){return i.Ir4},NwF:function(){return i.NwF},Wbm:function(){return i.Wbm},N4l:function(){return i.N4l},Jxm:function(){return t1},ej9:function(){return Sp},QmN:function(){return i.QmN},Y4W:function(){return r.TYPED_ARRAYS},IOt:function(){return i.IOt},NOD:function(){return Fl},L5g:function(){return i.L5g},H$k:function(){return i.H$k},cuP:function(){return oa},xEZ:function(){return i.xEZ},dpR:function(){return i.dpR},wOD:function(){return Ol},KNb:function(){return Ja},IiN:function(){return Dh},Cne:function(){return i.Cne},XvJ:function(){return i.XvJ},XZw:function(){return i.XZw},FE5:function(){return i.FE5},lVp:function(){return pb},CJI:function(){return i.CJI},z$h:function(){return i.z$h},UlW:function(){return i.UlW},WwZ:function(){return i.WwZ},zG7:function(){return zl},Lcc:function(){return i.Lcc},WXh:function(){return i.WXh},Vjr:function(){return F1},LuM:function(){return qw},LP5:function(){return jR},ub3:function(){return i.ub3},OV:function(){return Yl},G_n:function(){return xc},xfE:function(){return i.xfE},qlB:function(){return i.qlB},lCJ:function(){return i.lCJ},WTc:function(){return i.WTc},rAo:function(){return i.rAo},LZj:function(){return I_},xWb:function(){return i.xWb},gH0:function(){return i.gH0},rBU:function(){return i.rBU},rDY:function(){return i.rDY},ywz:function(){return i.ywz},wJv:function(){return i.wJv},JQ4:function(){return i.JQ4},k0A:function(){return i.k0A},irR:function(){return i.irR},LsT:function(){return i.LsT},q5h:function(){return S_},TKh:function(){return Ih},tyg:function(){return jA},Ro5:function(){return ei},dwk:function(){return i.dwk},t0w:function(){return AA},M7$:function(){return a0},ML4:function(){return yA},FM8:function(){return i.FM8},Pa4:function(){return i.Pa4},Ltg:function(){return i.Ltg},yC1:function(){return i.yC1},lHq:function(){return Qf},fO1:function(){return i.fO1},oMA:function(){return Bl},JzW:function(){return u},QEt:function(){return ap},b5g:function(){return i.b5g},Ywn:function(){return i.Ywn},GVz:function(){return i.GVz},oAp:function(){return i.oAp},kFz:function(){return i.kFz},dd2:function(){return i.dd2},CP7:function(){return i.CP7},fQK:function(){return i.fQK},Wd$:function(){return aT},t1_:function(){return US},v27:function(){return ib},Uk6:function(){return i.Uk6},H7Z:function(){return eb},_sL:function(){return i._sL},czO:function(){return Lu},Pnf:function(){return i.Pnf},c8b:function(){return i.c8b},_lf:function(){return i._lf},ad5:function(){return i.ad5},sZV:function(){return VA},TfA:function(){return zA},sKX:function(){return b0},UdM:function(){return mu},P0y:function(){return Ie},L_r:function(){return i.L_r},zC5:function(){return r.absMax},Bve:function(){return cx},UeO:function(){return ku},qCx:function(){return aI},$nx:function(){return _1},Bk6:function(){return Vs},EER:function(){return eh},y4l:function(){return Ed},P39:function(){return vg},HI1:function(){return r.aesGcmDecrypt},ZYi:function(){return r.aesGcmEncrypt},wXW:function(){return Cy},r5x:function(){return za},MSI:function(){return Iy},EUu:function(){return jO},jtH:function(){return Ju},T0T:function(){return ty},gAb:function(){return nE},iwT:function(){return jf},je_:function(){return KR},wBP:function(){return iv},LU2:function(){return j0},wQL:function(){return GO},Zs7:function(){return Qr},sMc:function(){return r.arrayBufferToBase64},x7s:function(){return ex},Mnd:function(){return WO},A0_:function(){return QO},d73:function(){return Ar},HCD:function(){return Ye},RG9:function(){return Ze},G2P:function(){return Kd},XLf:function(){return V0},CGN:function(){return Ku},RGi:function(){return r.base64ToArrayBuffer},mvg:function(){return mr},Hiy:function(){return Tc},XMc:function(){return Ig},N7M:function(){return qh},iv:function(){return Ry},n55:function(){return r.blobToDataURL},IaC:function(){return Li},h9t:function(){return G0},yDW:function(){return Q_},gJv:function(){return bl},l$g:function(){return rC},vQi:function(){return zC},$MY:function(){return ws},wJl:function(){return Eo},Z7Y:function(){return G_},X7D:function(){return W_},BnX:function(){return H_},uZ5:function(){return jh},zVI:function(){return va},Wz1:function(){return r.colorToDataUrl},DpF:function(){return E0},nNb:function(){return La},cqZ:function(){return Mh},pKN:function(){return Xx},CN8:function(){return U0},DdI:function(){return B1},rrX:function(){return qx},KlC:function(){return k0},KVn:function(){return he},oau:function(){return gr},aw9:function(){return xt},Aap:function(){return co},Dxg:function(){return r.copyProps},MjT:function(){return zt},F7Q:function(){return Pf},IFq:function(){return KS},IJl:function(){return z0},O5A:function(){return r.createCanvasElement},wCn:function(){return r.createDiv},gGT:function(){return F0},pEc:function(){return KM},Bi6:function(){return r.createImage},fi_:function(){return ix},TT:function(){return Zb},q2Z:function(){return DO},NyK:function(){return Jr},bgu:function(){return r.createScriptFromURL},kcS:function(){return r.createStyles},rRN:function(){return H1},ivY:function(){return r.css},_s1:function(){return iN},_HO:function(){return Fe},tpL:function(){return Ve},DMK:function(){return Qs},LjN:function(){return Dl},iFs:function(){return ju},qTg:function(){return r.deepAccessObject},Zj8:function(){return zO},Wtl:function(){return Sm},DmK:function(){return pu},Htt:function(){return eI},Hx7:function(){return ui},imt:function(){return Dn},US6:function(){return qs},vZs:function(){return Xd},TE$:function(){return XO},lmu:function(){return r.downloadBlob},SvO:function(){return r.downloadFile},YQY:function(){return Jm},mZN:function(){return j_},VvG:function(){return ka},omp:function(){return r.embedUrlRefs},utz:function(){return cs},TFV:function(){return M_},hrz:function(){return r.escapeRegExp},JKM:function(){return Mv},jZf:function(){return qS},RjL:function(){return Qw},RRI:function(){return Tr},RUq:function(){return iC},_t4:function(){return _t},YHh:function(){return qe},R8g:function(){return Y},f1L:function(){return r.getFileHandle},Bbl:function(){return r.getFilenameFromPath},V9r:function(){return r.getKeyByValue},a95:function(){return r.getNewFileHandle},PZ2:function(){return r.getOrCall},w7A:function(){return r.getPropertyDescriptor},N6S:function(){return re},Uxp:function(){return ae},tAz:function(){return ve},R$F:function(){return ye},N33:function(){return me},JFD:function(){return ie},gw2:function(){return Hr},rfc:function(){return r.getTypedArray},wo6:function(){return r.getUrlQueryParam},V4T:function(){return Sd},H4P:function(){return r.glsl},NLp:function(){return wu},swA:function(){return N},_Z3:function(){return le},ivc:function(){return La},rZ1:function(){return Mh},CpZ:function(){return nx},dyc:function(){return r.html},MxZ:function(){return r.htmlToCanvas},btp:function(){return r.htmlToPng},mXy:function(){return r.htmlToSvg},Ej0:function(){return Zs},ep4:function(){return Bt},DQP:function(){return Bo},VNr:function(){return ht},V7q:function(){return r.imageBitmapToBase64},hiB:function(){return r.imageDataToCanvas},zEk:function(){return r.imageToCanvas},qfq:function(){return r.imageUrlToImageData},piB:function(){return r.includesAll},IIc:function(){return VO},rrF:function(){return Tm},naq:function(){return ki},sXR:function(){return Z0},p5I:function(){return Vf},wps:function(){return iE},wuo:function(){return $S},GpE:function(){return r.isPropertyWritable},F4b:function(){return hg},NN$:function(){return qf},t$v:function(){return Ei},tdn:function(){return Hf},Y9t:function(){return Rb},GEo:function(){return Yd},GGm:function(){return r.longestCommonPrefix},DH3:function(){return Zf},uxM:function(){return r.makeColorSvg},zH3:function(){return r.makeColorSvgCircle},MLs:function(){return as},xXG:function(){return Mt},YM4:function(){return op},B3r:function(){return YS},iAx:function(){return r.makeTextSvg},lDn:function(){return ke},oaQ:function(){return qd},CD7:function(){return $d},Rc0:function(){return Hc},iPG:function(){return $0},TIc:function(){return r.mobileAndTabletCheck},xsC:function(){return Py},zOc:function(){return r.now},i8W:function(){return r.objectHasOwn},r46:function(){return vs},z2C:function(){return r.onChange},N4A:function(){return r.onChange2},hjq:function(){return r.onChange3},_X$:function(){return r.parseFileExtension},_yn:function(){return sr},Dyg:function(){return r.pathJoin},cUc:function(){return Xp},zGw:function(){return K0},Ctq:function(){return Pn},$ch:function(){return qO},k5b:function(){return Zr},kZl:function(){return bp},OCg:function(){return ci},Kd3:function(){return r.prettyScrollbar},YjH:function(){return Cv},Ui8:function(){return ST},YD2:function(){return eg},vi9:function(){return ZR},ij3:function(){return Rg},pJq:function(){return r.readFile},YPW:function(){return hs},_tY:function(){return r.remoteWorkerURL},Bg1:function(){return OO},kon:function(){return r.replaceAll},M3g:function(){return If},F2z:function(){return Fi},pJF:function(){return nC},knz:function(){return i.knz},Ejo:function(){return r.safeSetProperty},BgY:function(){return Pr},qCG:function(){return Pe},HD9:function(){return kn},Rgz:function(){return wr},fEB:function(){return oi},Udc:function(){return Cl},ZQg:function(){return wo},ofC:function(){return ot},yRy:function(){return r.setUrlQueryParam},_NL:function(){return aN},LCA:function(){return xs},Sy1:function(){return qR},Vs_:function(){return YR},j1w:function(){return __},i8J:function(){return oN},p7C:function(){return Yn},ZAS:function(){return Ib},ipH:function(){return YO},$TF:function(){return nI},uZI:function(){return KO},VWG:function(){return an},pQ7:function(){return Gf},STw:function(){return Lf},jc8:function(){return Ha},BL_:function(){return Wi},S6:function(){return rN},T8U:function(){return ac},TD6:function(){return Ll},akS:function(){return r.svgToCanvas},QKE:function(){return r.svgToPng},dKx:function(){return r.svgUrl},OvX:function(){return $R},doP:function(){return xn},$jA:function(){return dn},T99:function(){return en},LJS:function(){return wi},VsW:function(){return r.timeout},YMc:function(){return tI},aPg:function(){return tt},LFn:function(){return r.toTitleCase},wey:function(){return hi},MaE:function(){return Ee},s4x:function(){return it},FJA:function(){return Di},vIA:function(){return Me},Spv:function(){return lt},w8l:function(){return je},riG:function(){return We},Kbh:function(){return nr},BFq:function(){return Nt},t8K:function(){return Hn},Q7n:function(){return En},KGF:function(){return Ni},e5:function(){return Te},Rik:function(){return T_},GZo:function(){return ff},Bds:function(){return yr},HTu:function(){return Es},cTq:function(){return r.uploadFile},X_Y:function(){return or},dA8:function(){return uo},NSm:function(){return cn},bwS:function(){return Mu},Lks:function(){return $O},Rvq:function(){return JR},P4F:function(){return r.verifyPermission},Pd0:function(){return Ra},Pjo:function(){return Lr},Tum:function(){return Yr},dRH:function(){return ca},RX0:function(){return vo},reQ:function(){return JO},cWm:function(){return Tv},NC9:function(){return r.writeFile},$Re:function(){return y0},Xo9:function(){return A0},LNO:function(){return yt},iZP:function(){return on}}),function(a){a[a.Error=-2]="Error",a[a.Destroyed=-1]="Destroyed",a[a.None=0]="None",a[a.Running=1]="Running",a[a.Paused=2]="Paused"}(u||(u={}));var r=__webpackgi_require__(8),i=__webpackgi_require__(988);const m={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class _{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const A=new i.iKG(-1,1,1,-1,0,1),w=new i.u9r;w.setAttribute("position",new i.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),w.setAttribute("uv",new i.a$l([0,2,0,0,2,0],2));class T{constructor(e){this._mesh=new i.Kj0(w,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,A)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class R extends _{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof i.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=i.rDY.clone(e.uniforms),this.material=new i.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new T(this.material),this.useExistingRenderTarget=!1}render(e,t,n){this.uniforms[this.textureID]&&n&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class D extends _{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const s=e.getContext(),l=e.state;let c,f;l.buffers.color.setMask(!1),l.buffers.depth.setMask(!1),l.buffers.color.setLocked(!0),l.buffers.depth.setLocked(!0),this.inverse?(c=0,f=1):(c=1,f=0),l.buffers.stencil.setTest(!0),l.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),l.buffers.stencil.setFunc(s.ALWAYS,c,4294967295),l.buffers.stencil.setClear(f),l.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),l.buffers.color.setLocked(!1),l.buffers.depth.setLocked(!1),l.buffers.stencil.setLocked(!1),l.buffers.stencil.setFunc(s.EQUAL,1,4294967295),l.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),l.buffers.stencil.setLocked(!0)}}class U extends _{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class k{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new i.FM8);this._width=n.width,this._height=n.height,(t=new i.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new R(m),this.clock=new i.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let s=0,l=this.passes.length;s<l;s++){const c=this.passes[s];if(c.enabled!==!1){if(c.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),c.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),c.needsSwap){if(n){const f=this.renderer.getContext(),g=this.renderer.state.buffers.stencil;g.setFunc(f.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),g.setFunc(f.EQUAL,1,4294967295)}this.swapBuffers()}D!==void 0&&(c instanceof D?n=!0:c instanceof U&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new i.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(n,s),this.renderTarget2.setSize(n,s);for(let l=0;l<this.passes.length;l++)this.passes[l].setSize(n,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class X extends k{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const n=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=n)}}const J=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function $(){const a=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(J[255&a]+J[a>>8&255]+J[a>>16&255]+J[a>>24&255]+"-"+J[255&e]+J[e>>8&255]+"-"+J[e>>16&15|64]+J[e>>24&255]+"-"+J[63&t|128]+J[t>>8&255]+"-"+J[t>>16&255]+J[t>>24&255]+J[255&n]+J[n>>8&255]+J[n>>16&255]+J[n>>24&255]).toLowerCase()}function oe(a,e,t){return Math.max(e,Math.min(t,a))}function ne(a,e,t){return(1-t)*a+t*e}class H{constructor(e=0,t=0){H.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(oe(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),l=this.x-e.x,c=this.y-e.y;return this.x=l*n-c*s+e.x,this.y=l*s+c*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class V extends i.ZzF{expandByObject(e,t=!1,n=!1){var c;if(((c=e.userData)==null?void 0:c.bboxVisible)===!1)return this;if(!e.visible&&n)return this;e.updateWorldMatrix(!1,!1);const s=e.geometry;if(s!==void 0)if(t&&s.attributes!=null&&s.attributes.position!==void 0){const f=s.attributes.position;for(let g=0,y=f.count;g<y;g++)ce.fromBufferAttribute(f,g).applyMatrix4(e.matrixWorld),this.expandByPoint(ce)}else s.boundingBox===null&&s.computeBoundingBox(),z.copy(s.boundingBox),z.applyMatrix4(e.matrixWorld),this.union(z);const l=e.children;for(let f=0,g=l.length;f<g;f++)this.expandByObject(l[f],t,n);return this}expandByObjects(e,t=!1,n=!1){for(let s=0,l=e.length;s<l;s++)this.expandByObject(e[s],t,n);return this}getPoints(){return[new i.Pa4(this.min.x,this.min.y,this.min.z),new i.Pa4(this.min.x,this.min.y,this.max.z),new i.Pa4(this.min.x,this.max.y,this.min.z),new i.Pa4(this.min.x,this.max.y,this.max.z),new i.Pa4(this.max.x,this.min.y,this.min.z),new i.Pa4(this.max.x,this.min.y,this.max.z),new i.Pa4(this.max.x,this.max.y,this.min.z),new i.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),n=new i.TUj;for(const s of t){const l=s.project(e);n.min.min(l),n.max.max(l)}return n}}const z=new V,ce=new i.Pa4;function ue(a,e){if(e===i.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(e===i.z$h||e===i.UlW){let t=a.getIndex();if(t===null){const c=[],f=a.getAttribute("position");if(f===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a;for(let g=0;g<f.count;g++)c.push(g);a.setIndex(c),t=a.getIndex()}const n=t.count-2,s=[];if(e===i.z$h)for(let c=1;c<=n;c++)s.push(t.getX(0)),s.push(t.getX(c)),s.push(t.getX(c+1));else for(let c=0;c<n;c++)c%2==0?(s.push(t.getX(c)),s.push(t.getX(c+1)),s.push(t.getX(c+2))):(s.push(t.getX(c+2)),s.push(t.getX(c+1)),s.push(t.getX(c)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const l=a.clone();return l.setIndex(s),l.clearGroups(),l}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),a}function he(a,e){let t,n;if(Array.isArray(a))for(const l of a){const c=he(l,e);t===void 0||n===void 0?(t=c.min.clone(),n=c.max.clone()):(t.min(c.min),n.max(c.max))}const s=a;if(s.geometry!==void 0){const l=s.geometry.vertices;if(l===void 0&&s.geometry.attributes!==void 0&&"position"in s.geometry.attributes){const c=new i.Pa4,f=s.geometry.attributes.position;for(let g=0;g<f.count*f.itemSize;g+=f.itemSize){c.set(f.array[g],f.array[g+1],f.array[3]);const y=c.applyMatrix4(a.matrixWorld).project(e),x=new H(y.x,y.y);t===void 0||n===void 0?(t=x.clone(),n=x.clone()):(t.min(x),n.max(x))}}else for(const c of l){const f=c.clone().applyMatrix4(a.matrixWorld).project(e),g=new H(f.x,f.y);t===void 0||n===void 0?(t=g.clone(),n=g.clone()):(t.min(g),n.max(g))}}if(a.children!==void 0)for(const l of a.children){const c=he(l,e);t===void 0||n===void 0?(t=c.min.clone(),n=c.max.clone()):(t.min(c.min),n.max(c.max))}return new i.TUj(t,n)}const K="rgbm-16";function Y(a){switch(a){case i.aCh:case i.GUF:return["Linear","( value )"];case i.KI_:return["sRGB","( value )"];case K:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorSpace:",a),["Linear","( value )"]}}function ie(a,e){let t;return a&&a.isTexture?t=a.colorSpace:a&&a.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=a.texture.colorSpace):t=i.GUF,e&&a&&a.isTexture&&a.format===i.wk1&&a.type===i.ywz&&a.colorSpace===i.KI_&&(t=i.GUF),t}function ve(a,e){const t=Y(e);return"vec4 "+a+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function re(a,e,t){return ve(a+"TexelToLinear",ie(e,t))+`
`}function ae(a,e){return ve(a+"TexelToLinear",e)+`
`}function me(a,e){const t=Y(e);return"vec4 "+a+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function ye(a,e,t){return me(a,ie(e,t))}function Te({uniforms:a,propKey:e,thisTarget:t=!1}={}){const n=!!a,s=!!e,l=t;return(c,f)=>{const g=y=>{const x=l?y:n?a:y.uniforms||y._uniforms;let S=s?e:f;l&&(S="_"+S);let C=x[S];return C||(C={value:null},x[S]=C),C};Object.defineProperty(c,f,{get(){return g(this).value},set(y){g(this).value=y,(0,r.safeSetProperty)(this,"uniformsNeedUpdate",!0,!0)}})}}function ke(a,e,t=!1,n){const s=!!e,l=!!a;return(c,f)=>{const g=y=>({t:s?e:y.defines||y._defines,p:l?a:f});Object.defineProperty(c,f,{get(){const{t:y,p:x}=g(t?this:this.material);return y[x]},set(y){const{t:x,p:S}=g(t?this:this.material);if((0,r.safeSetProperty)(x,S,y,!0),typeof n=="function"){const C=[S,y];if(n.name){const L=this[n.name];L===n?n.call(this,...C):L.name===`bound ${n.name}`?L(...C):n(...C)}else n(...C)}else(0,r.safeSetProperty)(t?this:this.material,"needsUpdate",!0,!0)}})}}function Fe(a){const e=new i.IEO(new Uint8Array([Math.floor(255*a.r),Math.floor(255*a.g),Math.floor(255*a.b),255]),1,1,i.wk1,i.ywz);return e.needsUpdate=!0,e.colorSpace=i.aCh,e}function Ve(a){const e=new i.IEO(new Uint8Array([Math.floor(255*a.x),Math.floor(255*a.y),Math.floor(255*a.z),Math.floor(255*a.w)]),1,1,i.wk1,i.ywz);return e.needsUpdate=!0,e}function ot(a,e,t){const n=a.userData,{backgroundRender:s,transparentRender:l,shadowMapRender:c,mainRenderPass:f,opaqueRender:g,transmissionRender:y,sceneRender:x,screenSpaceRendering:S}=n;e.backgroundRender!==void 0&&(n.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(n.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(n.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(n.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(n.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(n.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(n.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(n.screenSpaceRendering=e.screenSpaceRendering),t(),n.backgroundRender=s,n.transparentRender=l,n.shadowMapRender=c,n.mainRenderPass=f,n.opaqueRender=g,n.sceneRender=x,n.transmissionRender=y,n.screenSpaceRendering=S}function Ye(a){const e=new V().expandByObject(a,!0,!0).getCenter(new i.Pa4);a.position.sub(e),a.updateMatrix(),a.userData.autoCentered=!0,a.userData.isCentered=!0}function Ze(a,e,t){const n=.5*new V().expandByObject(a,!0,!0).getSize(new i.Pa4).length();e===void 0&&(e=a.userData.autoScaleRadius||1);const s=e/n;return isFinite(s)&&(a.userData.pseudoCentered?a.children.forEach(l=>{l.scale.multiplyScalar(s)}):a.scale.multiplyScalar(s),(t||a.userData.isCentered)&&a.position.multiplyScalar(s),a.traverse(l=>{var c,f;l.isLight&&((f=(c=l.shadow)==null?void 0:c.camera)!=null&&f.right)&&(l.shadow.camera.right*=s,l.shadow.camera.left*=s,l.shadow.camera.top*=s,l.shadow.camera.bottom*=s),l.isCamera&&l.right&&(l.right*=s,l.left*=s,l.top*=s,l.bottom*=s)}),a.userData.autoScaled=!0,a.userData.autoScaleRadius=e,a.dispatchEvent({type:"objectUpdate"})),a}function tt(a,e=-1){return function(t,n=1e-4){const s=n>0;n=Math.max(n,Number.EPSILON);const l={},c=t.getIndex(),f=t.getAttribute("position"),g=c?c.count:f.count;let y=0;const x=Object.keys(t.attributes),S={},C={},L=[],B=["getX","getY","getZ","getW"],W=["setX","setY","setZ","setW"];for(let F=0,se=x.length;F<se;F++){const pe=x[F],be=t.attributes[pe];S[pe]=new i.TlE(new be.array.constructor(be.count*be.itemSize),be.itemSize,be.normalized);const Se=t.morphAttributes[pe];Se&&(C[pe]=new i.TlE(new Se.array.constructor(Se.count*Se.itemSize),Se.itemSize,Se.normalized))}const q=Math.log10(1/n),Z=Math.pow(10,q);for(let F=0;F<g;F++){const se=c?c.getX(F):F;let pe="";for(let be=0,Se=x.length;be<Se&&s;be++){const Be=x[be],Ge=t.getAttribute(Be),Xe=Ge.itemSize;for(let Qe=0;Qe<Xe;Qe++)pe+=~~(Ge[B[Qe]](se)*Z)+","}if(s&&pe in l)L.push(l[pe]);else{for(let be=0,Se=x.length;be<Se;be++){const Be=x[be],Ge=t.getAttribute(Be),Xe=t.morphAttributes[Be],Qe=Ge.itemSize,at=S[Be],Ke=C[Be];for(let Je=0;Je<Qe;Je++){const ft=B[Je],mt=W[Je];if(at[mt](y,Ge[ft](se)),Xe)for(let vt=0,Qt=Xe.length;vt<Qt;vt++)Ke[vt][mt](y,Xe[vt][ft](se))}}s&&(l[pe]=y),L.push(y),y++}}const j=t.clone();for(const F in t.attributes){const se=S[F];if(j.setAttribute(F,new i.TlE(se.array.slice(0,y*se.itemSize),se.itemSize,se.normalized)),F in C)for(let pe=0;pe<C[F].length;pe++){const be=C[F][pe];j.morphAttributes[F][pe]=new i.TlE(be.array.slice(0,y*be.itemSize),be.itemSize,be.normalized)}}return j.setIndex(L),j}(a,e)}const Pt=2,Et=3,Ne=0,et=1,wt=3,Zt=4,nn=1006,Vn=3001,Jn="srgb",Ue="srgb-linear",St="display-p3";class Lt{constructor(){Lt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,s,l,c,f,g,y){const x=this.elements;return x[0]=e,x[1]=s,x[2]=f,x[3]=t,x[4]=l,x[5]=g,x[6]=n,x[7]=c,x[8]=y,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,l=this.elements,c=n[0],f=n[3],g=n[6],y=n[1],x=n[4],S=n[7],C=n[2],L=n[5],B=n[8],W=s[0],q=s[3],Z=s[6],j=s[1],F=s[4],se=s[7],pe=s[2],be=s[5],Se=s[8];return l[0]=c*W+f*j+g*pe,l[3]=c*q+f*F+g*be,l[6]=c*Z+f*se+g*Se,l[1]=y*W+x*j+S*pe,l[4]=y*q+x*F+S*be,l[7]=y*Z+x*se+S*Se,l[2]=C*W+L*j+B*pe,l[5]=C*q+L*F+B*be,l[8]=C*Z+L*se+B*Se,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],l=e[3],c=e[4],f=e[5],g=e[6],y=e[7],x=e[8];return t*c*x-t*f*y-n*l*x+n*f*g+s*l*y-s*c*g}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],l=e[3],c=e[4],f=e[5],g=e[6],y=e[7],x=e[8],S=x*c-f*y,C=f*g-x*l,L=y*l-c*g,B=t*S+n*C+s*L;if(B===0)return this.set(0,0,0,0,0,0,0,0,0);const W=1/B;return e[0]=S*W,e[1]=(s*y-x*n)*W,e[2]=(f*n-s*c)*W,e[3]=C*W,e[4]=(x*t-s*g)*W,e[5]=(s*l-f*t)*W,e[6]=L*W,e[7]=(n*g-y*t)*W,e[8]=(c*t-n*l)*W,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,l,c,f){const g=Math.cos(l),y=Math.sin(l);return this.set(n*g,n*y,-n*(g*c+y*f)+c+e,-s*y,s*g,-s*(-y*c+g*f)+f+t,0,0,1),this}scale(e,t){return this.premultiply(jt.makeScale(e,t)),this}rotate(e){return this.premultiply(jt.makeRotation(-e)),this}translate(e,t){return this.premultiply(jt.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const jt=new Lt;function Gt(a){return a<.04045?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function fn(a){return a<.0031308?12.92*a:1.055*Math.pow(a,.41666)-.055}const hn=new Lt().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),qt=new Lt().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),An={[Ue]:a=>a,[Jn]:a=>a.convertSRGBToLinear(),[St]:function(a){return a.convertSRGBToLinear().applyMatrix3(qt)}},_n={[Ue]:a=>a,[Jn]:a=>a.convertLinearToSRGB(),[St]:function(a){return a.applyMatrix3(hn).convertLinearToSRGB()}},Bn={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(a){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!a},get workingColorSpace(){return Ue},set workingColorSpace(a){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(a,e,t){if(this.enabled===!1||e===t||!e||!t)return a;const n=An[e],s=_n[t];if(n===void 0||s===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return s(n(a))},fromWorkingColorSpace:function(a,e){return this.convert(a,this.workingColorSpace,e)},toWorkingColorSpace:function(a,e){return this.convert(a,e,this.workingColorSpace)}},de={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ae={h:0,s:0,l:0},Le={h:0,s:0,l:0};function Oe(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+6*(e-a)*t:t<.5?e:t<2/3?a+6*(e-a)*(2/3-t):a}class $e{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Jn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Bn.toWorkingColorSpace(this,t),this}setRGB(e,t,n,s=Bn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Bn.toWorkingColorSpace(this,s),this}setHSL(e,t,n,s=Bn.workingColorSpace){if(e=function(l,c){return(l%c+c)%c}(e,1),t=oe(t,0,1),n=oe(n,0,1),t===0)this.r=this.g=this.b=n;else{const l=n<=.5?n*(1+t):n+t-n*t,c=2*n-l;this.r=Oe(c,l,e+1/3),this.g=Oe(c,l,e),this.b=Oe(c,l,e-1/3)}return Bn.toWorkingColorSpace(this,s),this}setStyle(e,t=Jn){function n(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let l;const c=s[1],f=s[2];switch(c){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return n(l[4]),this.setRGB(Math.min(255,parseInt(l[1],10))/255,Math.min(255,parseInt(l[2],10))/255,Math.min(255,parseInt(l[3],10))/255,t);if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return n(l[4]),this.setRGB(Math.min(100,parseInt(l[1],10))/100,Math.min(100,parseInt(l[2],10))/100,Math.min(100,parseInt(l[3],10))/100,t);break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return n(l[4]),this.setHSL(parseFloat(l[1])/360,parseFloat(l[2])/100,parseFloat(l[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const l=s[1],c=l.length;if(c===3)return this.setRGB(parseInt(l.charAt(0),16)/15,parseInt(l.charAt(1),16)/15,parseInt(l.charAt(2),16)/15,t);if(c===6)return this.setHex(parseInt(l,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Jn){const n=de[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Gt(e.r),this.g=Gt(e.g),this.b=Gt(e.b),this}copyLinearToSRGB(e){return this.r=fn(e.r),this.g=fn(e.g),this.b=fn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Jn){return Bn.fromWorkingColorSpace(pt.copy(this),e),65536*Math.round(oe(255*pt.r,0,255))+256*Math.round(oe(255*pt.g,0,255))+Math.round(oe(255*pt.b,0,255))}getHexString(e=Jn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Bn.workingColorSpace){Bn.fromWorkingColorSpace(pt.copy(this),t);const n=pt.r,s=pt.g,l=pt.b,c=Math.max(n,s,l),f=Math.min(n,s,l);let g,y;const x=(f+c)/2;if(f===c)g=0,y=0;else{const S=c-f;switch(y=x<=.5?S/(c+f):S/(2-c-f),c){case n:g=(s-l)/S+(s<l?6:0);break;case s:g=(l-n)/S+2;break;case l:g=(n-s)/S+4}g/=6}return e.h=g,e.s=y,e.l=x,e}getRGB(e,t=Bn.workingColorSpace){return Bn.fromWorkingColorSpace(pt.copy(this),t),e.r=pt.r,e.g=pt.g,e.b=pt.b,e}getStyle(e=Jn){Bn.fromWorkingColorSpace(pt.copy(this),e);const t=pt.r,n=pt.g,s=pt.b;return e!==Jn?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*s)})`}offsetHSL(e,t,n){return this.getHSL(Ae),Ae.h+=e,Ae.s+=t,Ae.l+=n,this.setHSL(Ae.h,Ae.s,Ae.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Ae),e.getHSL(Le);const n=ne(Ae.h,Le.h,t),s=ne(Ae.s,Le.s,t),l=ne(Ae.l,Le.l,t);return this.setHSL(n,s,l),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,s=this.b,l=e.elements;return this.r=l[0]*t+l[3]*n+l[6]*s,this.g=l[1]*t+l[4]*n+l[7]*s,this.b=l[2]*t+l[5]*n+l[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const pt=new $e;function Mt(a,e){return{type:"folder",label:e+" Sampler",hidden:()=>!a[e],children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[a[e],"repeat"],onChange:a==null?void 0:a.setDirty}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[a[e],"offset"],onChange:a==null?void 0:a.setDirty}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[a[e],"center"],onChange:a==null?void 0:a.setDirty}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[a[e],"rotation"],onChange:a==null?void 0:a.setDirty}),()=>({type:"dropdown",label:"Color Space",property:[a[e],"colorSpace"],children:[["Linear",i.GUF],["sRGB",i.KI_]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{const t=a[e];t&&(t.needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var t;return((t=a[e])==null?void 0:t.flipY)??!1},setValue:t=>{var s;const n=a[e];if(n&&n.flipY!==t)if(n.image&&ImageBitmap&&n.image instanceof ImageBitmap){const l=n,c=n.source.data;createImageBitmap(c,{imageOrientation:"flipY"}).then(f=>{var g;c.close&&c.close(),l.flipY=t,l.source.data=f,l.source.needsUpdate=!0,l.needsUpdate=!0,(g=a==null?void 0:a.setDirty)==null||g.call(a)})}else n.flipY=t,n.needsUpdate=!0,(s=a==null?void 0:a.setDirty)==null||s.call(a)}}),()=>({type:"dropdown",label:"Wrap S",property:[a[e],"wrapS"],children:[["ClampToEdge",i.uWy],["MirroredRepeat",i.OoA],["Repeat",i.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[a[e],"wrapT"],children:[["ClampToEdge",i.uWy],["MirroredRepeat",i.OoA],["Repeat",i.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[a[e],"anisotropy"],onChange:[()=>{a[e]&&(a[e].needsUpdate=!0),a.needsUpdate=!0},a==null?void 0:a.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[a[e],"minFilter"],children:[["Linear",nn],["Nearest",i.TyD],["NearestMipmapNearest",i.YLQ],["NearestMipmapLinear",i.vZf],["LinearMipmapNearest",i.qyh],["LinearMipmapLinear",i.D1R]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[a[e],"magFilter"],children:[["Linear",nn],["Nearest",i.TyD]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]})]}}$e.NAMES=de;const Bt=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function xt(a,e,t=!0){if(!e)return a;for(const n of Object.keys(e)){if(t&&Bt.includes(n)||n.startsWith("__"))continue;const s=e[n];if(typeof a[n]=="function"||typeof s=="function")continue;const l=!s||s.isTexture||s.isObject3D||s.isMaterial;l||typeof s.clone!="function"?l||typeof s!="object"&&!Array.isArray(s)?a[n]=s:a[n]=xt(Array.isArray(s)?[]:{},s,!1):a[n]=s.clone()}return a}const ht=["appliedMaterials","uuid"];function zt(a,e){if(e)for(const t of Object.keys(e))ht.includes(t)||t.startsWith("__")||typeof a[t]!="function"&&typeof e[t]!="function"&&(a[t]=e[t]);return a}function dn(a,e,t){const n=(t==null?void 0:t.data)??new Uint8ClampedArray(a.height*a.width*4),s=a.data instanceof Float32Array,l=a.data instanceof Uint16Array;for(let c=0;c<n.length;c++)n[c]=s?255*a.data[c]:l?255*i.A5E.fromHalfFloat(a.data[c]):a.data[c],e===i.GUF&&(n[c]=255*(0,r.LinearToSRGB)(n[c]/255));return t??new ImageData(n,a.width,a.height)}function en(a,e,t=!1){let n;return n=a.isDataTexture?dn(a.image,a.colorSpace):a.image,xn(n,e,t)}function xn(a,e,t=!1){const n=document.createElement("canvas");n.width=Math.min(e,a.width),n.height=Math.floor(1+n.width*a.height/a.width);const s=n.getContext("2d");if(!s)return console.error("textureToDataUrl: could not get canvas context"),n;t===!0&&(s.translate(0,n.height),s.scale(1,-1));let l=!1;if(a.data!==void 0){const c=a;if(a.width!==n.width||a.height!==n.height){const f=document.createElement("canvas");f.width=a.width,f.height=a.height;const g=f.getContext("2d");g?(g.putImageData(c,0,0),s.drawImage(f,0,0,n.width,n.height)):(console.error("textureToDataUrl: could not get temp canvas context"),s.putImageData(c,0,0))}else s.putImageData(c,0,0),t&&(l=!0)}else s.drawImage(a,0,0,n.width,n.height);return l?(0,r.canvasFlipY)(n):n}function wi(a,e,t,n,s){return en(a,e,t).toDataURL(n,s)}String.prototype.replaceAll||(String.prototype.replaceAll=function(a,e){return Object.prototype.toString.call(a).toLowerCase()==="[object regexp]"?this.replace(a,e):this.replace(new RegExp(a,"g"),e)});const Gi=new Map;function Pe(a){return(e,t)=>{const n=e.constructor;if(n===Object)throw new Error("All properties in an object are serialized by default");Gi.has(n)||Gi.set(n,[]),Gi.get(n).push([a||t,t])}}const oi={obj:(a,e)=>Object.fromEntries(Object.entries(a).map(([t,n])=>[t,kn(n,!1,e)])),vec4:a=>({x:a.x,y:a.y,z:a.z,w:a.w,isVector4:!0}),vec3:a=>({x:a.x,y:a.y,z:a.z,isVector3:!0}),vec2:a=>({x:a.x,y:a.y,isVector2:!0}),color:a=>({r:a.r,g:a.g,b:a.b,isColor:!0}),quat:a=>({x:a.x,y:a.y,z:a.z,w:a.w,isQuaternion:!0}),texture:(a,e)=>{var f;if(!(a!=null&&a.isTexture))throw new Error("Expected a texture");if(e!=null&&e.textures[a.uuid])return{uuid:a.uuid,resource:"textures"};if(a.isRenderTargetTexture&&!((f=a.userData)!=null&&f.serializableRenderTarget))return;const t=a.source.data,n=!a.isRenderTargetTexture&&a.userData.rootPath;n&&a.source.data&&(a.userData.__embedUrlImagePreviews?a.source.data=en(a,16,a.flipY):a.source.data=null);const s=a.userData;a.userData={};const l={images:{}};let c=a.toJSON(e||l);return!e&&c.image&&(c.image=n&&!a.userData.__embedUrlImagePreviews?void 0:l.images[c.image]),a.userData=s,c.userData=kn(zt({},s),!1,e),n&&(e&&!a.userData.__embedUrlImagePreviews&&delete e.images[a.source.uuid],a.source.data=t),e!=null&&e.textures&&!c.resource&&(e.textures[c.uuid]||(e.textures[c.uuid]=c),c={uuid:c.uuid,resource:"textures"}),c},material:(a,e)=>{if(!(a!=null&&a.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[a.uuid])return{uuid:a.uuid,resource:"materials"};a.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const t=e??{textures:{},images:{}},n={},s={};for(const[c,f]of Object.entries(a))if(f!=null&&f.isTexture&&!c.startsWith("__")){const g=oi.texture(f,t);n[c]=g,s[c]=f,a[c]=g?{isTexture:!0,toJSON:()=>g}:null}let l=a.toJSON(e);for(const[c,f]of Object.entries(s))a[c]=f,delete s[c];if(e){for(const[c,f]of Object.entries(n))f&&(l[c]=f);e!=null&&e.materials&&(e.materials[l.uuid]||(e.materials[l.uuid]=l),l={uuid:l.uuid,resource:"materials"})}else{for(const[c,f]of Object.entries(n))f&&(l[c]=f.uuid);l.textures=Object.values(t.textures),l.images=Object.values(t.images)}return l}},pn=a=>(e,t)=>{var n;return((n=t==null?void 0:t.copy)==null?void 0:n.call(t,e))??new a().copy(e)},Dn={obj:(a,e,t)=>Object.assign(e,Object.fromEntries(Object.entries(a).map(([n,s])=>[n,ui(s,e==null?void 0:e[n],!1,t)]))),vec4:pn(i.Ltg),vec3:pn(i.Pa4),vec2:pn(H),color:pn($e),quat:pn(i._fP)};function kn(a,e,t){var l;if(typeof a=="function")return;if(Array.isArray(a))return a.map(c=>kn(c,!1,t));if(typeof a!="object"){if(typeof a=="number"){if(a===1/0)return"Infinity";if(a===-1/0)return"-Infinity";if(isNaN(a))return"NaN"}return a}if(!a)return a;let n=a.constructor??Object;if(n===Object)return oi.obj(a,t);if(a.isVector2)return oi.vec2(a);if(a.isVector3)return oi.vec3(a);if(a.isVector4)return oi.vec4(a);if(a.isColor)return oi.color(a);if(a.isQuaternion)return oi.quat(a);if(a.isTexture)return oi.texture(a,t);if(a.isMaterial)return oi.material(a,t);if(!e&&typeof a.toJSON=="function"){const c=a.toJSON(t);return a.serializableClassId&&c&&(c.serializableClassId=a.serializableClassId),c}const s={};for(;n&&n!==Object;)(l=Gi.get(n))==null||l.forEach(([c,f])=>{const g=a[f];s[c]=kn(g,!1,t)}),n=Object.getPrototypeOf(n);return a.serializableClassId&&(s.serializableClassId=a.serializableClassId),s}function ui(a,e,t,n){var f,g;let s=e;if(a===void 0)return s;if(typeof e=="number"){if(a==="Infinity")return 1/0;if(a==="-Infinity")return-1/0;if(a==="NaN")return NaN;if(typeof a=="number"||!a)return a}if(Array.isArray(a)){const y=a.length;Array.isArray(s)||(s=[]);for(let x=0;x<y;x++){const S=a[x],C=s.length>x?ui(S,s[x],!1,n):ui(S,void 0,!1,n);s.length<=x?s.push(C):s[x]=C}return s}let l=!1;if(a&&a.resource&&typeof a.resource=="string"&&(a=(f=n[a.resource])==null?void 0:f[a.uuid],l=!0),!s&&a&&!l)if(a.serializableClassId){const y=Nr.get(a.serializableClassId);y&&(s=y.DataInConstructor?new y(a):new y)}else typeof a!="object"||a.constructor&&a.constructor!==Object||(s={});if(typeof s=="function")return console.error("cannot deserialize over function",s,a),s;if(a&&typeof a=="object"&&!l){if(a.isVector2)return Dn.vec2(a,s);if(a.isVector3)return Dn.vec3(a,s);if(a.isVector4)return Dn.vec4(a,s);if(a.isColor)return Dn.color(a,s);if(a.isQuaternion)return Dn.quat(a,s)}if(a==null||s==null||typeof s!="object"||s.isTexture)return l&&(a?a.__useCount=a.__useCount?a.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),a;let c=s.constructor??Object;if(c===Object)return Dn.obj(a,s,n);if(!t&&typeof s.fromJSON=="function")return s.isMaterial&&(Object.entries(a).forEach(([y,x])=>{var C;if(!x||!x.resource||typeof x.resource!="string")return;const S=(C=n[x.resource])==null?void 0:C[x.uuid];a[y]=S||null}),a.userData&&(a.userData=ui(a.userData,void 0,!1,n))),s.fromJSON(a,n),s;for(;c&&c!==Object;)(g=Gi.get(c))==null||g.forEach(([y,x])=>{const S=s[x],C=ui(a[y],S,!1,n);C!==S&&(0,r.safeSetProperty)(s,x,C,!0)}),c=Object.getPrototypeOf(c);return s}const Nr=new Map;function Pr(a){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=a}},Nr.set(a,e),e)}function wr(a,e,t,n){var c,f,g;if(e!=null&&e.extras[a.uuid])return{uuid:a.uuid,resource:"extras"};let s="";if((c=a.source)!=null&&c._sourceImgBuffer||a.userData.__sourceBuffer){const y=new Uint8Array(((f=a.source)==null?void 0:f._sourceImgBuffer)||a.userData.__sourceBuffer),x=n||a.userData.mimeType||"";s={data:Array.from(y),type:y.constructor.name,path:((g=a.userData.__sourceBlob)==null?void 0:g.name)||a.userData.rootPath||"file."+x.split("/")[1]},x&&(s.mimeType=x)}else a.userData.rootPath?s=a.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const l={uuid:a.uuid,url:s,userData:zt({},a.userData),type:a.type,name:t||a.name};return e!=null&&e.extras?(e.extras[a.uuid]=l,{uuid:a.uuid,resource:"extras"}):l}var es=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Ps=class extends r.SimpleEventDispatcher{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(a){a!==this._displayCanvasScaling&&(this._displayCanvasScaling=a,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(a){this._pipeline=a,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){const a=this._passes,e=[],t={};for(const n of a){if(n.enabled===!1)continue;const s={after:n.after??[],before:n.before??[],dependencies:new Set(n.required??[])};t[n.passId]=s}for(const[n,s]of Object.entries(t)){const l=new Set([...s.after,...s.before]);s.dependencies.forEach(c=>l.has(c)&&l.delete(c)),l.forEach(c=>{const f=t[c];if(f){if(f.dependencies.has(n))throw console.error("cyclic",n,c),"Cyclic dependency";s.dependencies.add(c)}})}for(;;){let n=!1;const s=[...Object.entries(t)];for(const[l,c]of s)if(!e.includes(l)&&(0,r.includesAll)(e,c.dependencies.values())){const f=Math.max(-1,...c.after.map(y=>e.indexOf(y))),g=Math.min(e.length,...c.before.map(y=>{const x=e.indexOf(y);return x<0?e.length:x}));if(f>=g)throw console.error(c,a,e,f,g),"Not possible";e.splice(c.after.length>0?f+1:g,0,l),n=!0,delete t[l]}if(Object.keys(t).length<1)break;if(!n)throw console.error(s,t,e),"Not possible 2"}return this.pipeline=e,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(a,e){const t=a-this._lastTime;this._lastTime=a,this.frameWaitTime-=t,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:t,time:a,renderer:this,xrFrame:e}))}get clock(){return this._composer.clock}registerPass(a,e=!0){var t;if(e)for(const n of[...this._passes])a.passId===n.passId&&this.unregisterPass(n);this._passes.push(a),(t=a.onRegister)==null||t.call(a,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(a){var t;const e=this._passes.indexOf(a);e>=0&&((t=a.onUnregister)==null||t.call(a,this),this._passes.splice(e,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:a,canvas:e,alpha:t=!0,targetOptions:n}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new i.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new i.CP7({canvas:e,antialias:!1,alpha:t,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.useLegacyLights=!1,this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderer.onContextLost=s=>{this.dispatchEvent({type:"contextLost",event:s})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new i.FM8(e.clientWidth,e.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=i.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputColorSpace=i.aCh,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=i._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(n,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new X(this._renderer,this._composerTarget),a&&this.addEventListener("animationLoop",a)}setSize(a,e,t=!1){!t&&(a?Math.abs(a-this._renderSize.width):0)+(e?Math.abs(e-this._renderSize.height):0)<.1||(a&&(this._renderSize.width=a),e&&(this._renderSize.height=e),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(n=>{const s=n,l=s.sizeMultiplier;if(l){const c=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*l);s.setSize(Math.floor(c.width),Math.floor(c.height))}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(a,e,{viewport:t,material:n,shader:s,pass:l,clear:c=!0}={}){const f=this._composer.copyPass,{renderToScreen:g,material:y,uniforms:x,clear:S}=f;n&&(f.material=n);const C=this._renderer.getViewport(new i.Ltg),L=this._renderer.autoClear,B=this._renderer.getRenderTarget();t&&this._renderer.setViewport(new i.Ltg().fromArray(t)),this._renderer.autoClear=!1,f.uniforms=f.material.uniforms,f.renderToScreen=!1,f.clear=c,ot(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{f.render(this._renderer,e??null,{texture:a},0,!1)}),f.renderToScreen=g,f.clear=S,f.material=y,f.uniforms=x,this._renderer.autoClear=L,t&&this._renderer.setViewport(C),this._renderer.setRenderTarget(B)}clearColor({r:a,g:e,b:t,a:n,target:s,depth:l=!0,stencil:c=!0}){const f=this._renderer.getClearColor(new i.Ilk),g=this._renderer.getClearAlpha();this._renderer.setClearAlpha(n??g),this._renderer.setClearColor(new i.Ilk(a??f.r,e??f.g,t??f.b));const y=this._renderer.getRenderTarget(),x=this._renderer.getActiveCubeFace(),S=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget(s??null),this._renderer.clear(!0,l,c),this._renderer.setRenderTarget(y,x,S),this._renderer.setClearColor(f),this._renderer.setClearAlpha(g)}renderModel(a,e){this._renderer.render(a.modelObject,e.cameraObject)}renderScene(a){const e=a.activeCamera;e&&this.renderModel(a,e)}_updated(){this.dispatchEvent({type:"update"})}render(){var a;this._passesNeedsUpdate&&this.refreshPasses();for(const e of this._passes)e.passObject.enabled&&((a=e.update)==null||a.call(e));this._composer.render(),this._frameCount+=1,this._totalFrameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(a=>a.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const a=[];for(const e of this._pipeline){const t=this._passes.find(n=>n.passId===e);t?a.push(t.passObject):console.warn("Unable to find pass: ",e)}[...this._composer.passes].forEach(e=>this._composer.removePass(e)),a.forEach(e=>this._composer.addPass(e)),this._updated()}dispose(){this._trackedTargets.forEach(a=>a.dispose()),this._trackedTargets=[],this._renderer.dispose()}trackTarget(a){this._trackedTargets.push(a)}removeTrackedTarget(a){const e=this._trackedTargets.indexOf(a);e>=0&&this._trackedTargets.splice(e,1)}createTarget({sizeMultiplier:a,samples:e=0,colorSpace:t=i.aCh,type:n=i.ywz,format:s=i.wk1,depthBuffer:l=!0,depthTexture:c=!1,size:f,textureCount:g=1,...y}={},x=!0){this.isWebGL2||(e=0),a!==void 0&&f!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(f=f||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(a=a||1))).width=Math.floor(f.width),f.height=Math.floor(f.height);const S=c?new i.$YQ(f.width,f.height,i.ywz):void 0,C=this.createTargetCustom(g>1?{width:f.width,height:f.height,count:g}:f,{samples:e,colorSpace:t,type:n,format:s,depthBuffer:l,depthTexture:S},g>1?i.kFz:i.dd2);return this._processNewTarget(C,a,x),this._setTargetOptions(C,y),C}_processNewTarget(a,e,t){return e!==void 0&&(a.sizeMultiplier=e),t&&this.trackTarget(a),a}disposeTarget(a){if(a){if(a.isTemporary)return this.releaseTempTarget(a);this.removeTrackedTarget(a),a.dispose()}}createTargetCustom({width:a,height:e,count:t},n={},s){const l=this._processNewTarget,c=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let f=[a,e];if(t&&t>1&&f.push(t),(s==null?void 0:s.prototype)===i.oAp.prototype){if(a!==e)throw"Width and height of cube render target must be equal";f=[a]}n={format:i.wk1,minFilter:i.wem,magFilter:i.wem,generateMipmaps:!1,type:i.ywz,colorSpace:i.aCh,...n};const g=[this,...f,n];return new class extends(s??i.dd2){constructor(y,...x){super(...x),this.renderer=y,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach(S=>{S.colorSpace=n.colorSpace,S.toJSON=()=>(console.warn("Multiple render target texture.toJSON not supported yet."),{})}):(this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(S){console.warn("Render target texture.toJSON might be buggy."),this.source.data.url=c(this.__target,"image/png",90);const C=this.__toJSON.call(this,S);return delete this.source.data.url,C.isRenderTargetTexture=!0,C})}setSize(y,x,S){super.setSize(Math.floor(y),Math.floor(x),S)}clone(y=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const x=super.clone();return x.texture.isRenderTargetTexture=!0,l(x,this.sizeMultiplier||1,y)}}(...g)}getTempTarget(a={}){var n;const e=Jr(a);let t;return(n=this._tempTargets[e])!=null&&n.length&&(t=this._tempTargets[e].pop()),t?this._setTargetOptions(t,a):(t=this.createTarget(a),this._processNewTempTarget(t,e)),t}_processNewTempTarget(a,e){return a.isTemporary=!0,a.targetKey=e,this._tempTargets[e]===void 0&&(this._tempTargets[e]=[]),a}releaseTempTarget(a){const e=a.targetKey;if(!e||!a.isTemporary)throw"Not a temp target";this._tempTargets[e].length>this.maxTempPerKey?a.dispose():this._tempTargets[e].push(a)}updateShaderProperties(a){return this.stableNoise?a.uniforms.frameCount?a.uniforms.frameCount.value=this._totalFrameCount:console.warn("BaseRenderer: no uniform: frameCount"):a.uniforms.frameCount?a.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),a.uniforms.frameCount2&&(a.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(a,e){a.texture.minFilter=e.minFilter??i.wem,a.texture.magFilter=e.magFilter??i.wem,a.texture.generateMipmaps=e.generateMipmaps??!1,a.texture.generateMipmaps&&a.texture.minFilter===i.wem&&(a.texture.minFilter=i.FDw),a.texture.generateMipmaps||a.texture.minFilter!==i.FDw||(a.texture.minFilter=i.wem)}renderTargetToDataUrl(a,e="image/png",t=90){const n=document.createElement("canvas");n.width=a.width,n.height=a.height;const s=n.getContext("2d");if(!s)throw new Error("Unable to get 2d context");const l=s.createImageData(a.width,a.height,{colorSpace:["display-p3","srgb"].includes(a.texture.colorSpace)?a.texture.colorSpace:void 0});if(a.texture.type===i.cLu){const f=new Uint16Array(a.width*a.height*4);this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,f),dn({data:f,width:a.width,height:a.height},a.texture.colorSpace,l)}else if(a.texture.type===i.VzW){const f=new Float32Array(a.width*a.height*4);this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,f),dn({data:f,width:a.width,height:a.height},a.texture.colorSpace,l)}else this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,l.data);s.putImageData(l,0,0);const c=n.toDataURL(e,t);return n.remove(),c}renderTargetToBuffer(a){const e=a.texture.type===i.cLu?new Uint16Array(a.width*a.height*4):new Uint8Array(a.width*a.height*4);return this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,e),e}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(a){this.rendererObject.useLegacyLights=a,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(a){console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=a}};function Jr(a={}){var e,t;return[a.sizeMultiplier,a.samples,a.colorSpace,a.type,a.format,a.depthBuffer,a.depthTexture,(e=a.size)==null?void 0:e.width,(t=a.size)==null?void 0:t.height].join(";")}function cl(a,e){if(a.uiConfig)return a.uiConfig;const t={type:"folder",label:()=>a.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[a,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{a.dispatchEvent({type:"select",ui:!0,value:a,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!a.parent,value:()=>{const l=a.parent;l&&l.dispatchEvent({type:"select",ui:!0,value:l})}},{type:"input",label:"Name",property:[a,"name"],onChange:l=>{var c;l.last&&((c=a.setDirty)==null||c.call(a,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!a.isMesh,property:[a,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!a.isMesh,property:[a,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[a,"frustumCulled"]},{type:"vec3",label:"Position",property:[a,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[a,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[a,"scale"]},{type:"input",label:"Render Order",property:[a,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",a.userData.autoScaleRadius||"2",!0],value:l=>{if(!l)return;const c=parseFloat(l);Math.abs(c)>0&&Ze(a,c)}},{type:"button",label:"Auto Center",value:()=>{confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&Ye(a)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(l=>({type:"button",label:"Rotate "+l+"90",value:()=>{var c;a.rotateOnAxis(new i.Pa4(l.includes("X")?1:0,l.includes("Y")?1:0,l.includes("Z")?1:0),Math.PI/2*(l.includes("-")?-1:1)),(c=a.setDirty)==null||c.call(a,{sceneUpdate:!0,refreshUi:!1})}}))},a.userData.license!==void 0?{type:"input",label:"License/Credits",property:[a.userData,"license"],limitedUi:!0}:{}]},n=a;if(n!=null&&n.isMesh&&e!==!1){const l=[()=>{const c=Object.entries(n.morphTargetDictionary||{});return c.length?{label:"Morph Targets",type:"folder",children:c.map(([f,g])=>({type:"slider",label:f,bounds:[0,1],stepSize:1e-4,property:[n.morphTargetInfluences,g],onChange:y=>{var x;(x=a.setDirty)==null||x.call(a,{sceneUpdate:y.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var c;return(c=n.geometry)==null?void 0:c.uiConfig},()=>{var c;return Array.isArray(n.material)?n.material.length<1?void 0:{label:"Materials",type:"folder",children:n.material.map(f=>f==null?void 0:f.uiConfig).filter(f=>f)}:(c=n.material)==null?void 0:c.uiConfig}];t.children.push(...l)}const s=a;if(s!=null&&s.isCamera){const l=[{type:"button",label:"Set View",value:()=>{var c;a.dispatchEvent({type:"setView",ui:!0,camera:a}),(c=t.uiRefresh)==null||c.call(t,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var c;return(c=a.userData.iCamera)==null?void 0:c.isActiveCamera},value:()=>{var c;a.dispatchEvent({type:"activateMain",ui:!0,camera:a}),(c=t.uiRefresh)==null||c.call(t,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var c;return!((c=a.userData.iCamera)!=null&&c.isActiveCamera)},value:()=>{var c;a.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),(c=t.uiRefresh)==null||c.call(t,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>a.userData.autoLookAtTarget??!1,setValue:c=>{var f;a.userData.autoLookAtTarget=c,(f=t.uiRefresh)==null||f.call(t,"postFrame",!0)}}];t.children.push(...l)}return a.uiConfig=t,t}function xs(a,e,t){if(!a)return void console.warn("setupIModel: object is undefined");if(a.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",a),delete a.__disposed),a.userData||(a.userData={}),a.userData.__iModelSetup&&a.modelObject)return a;a.userData.__iModelSetup=!0;let n=[];n.push(()=>{[...a.children].forEach(x=>{var S;(S=x==null?void 0:x.dispose)==null||S.call(x),a.add(x)}),a.parent&&a.removeFromParent()}),a.isLight&&!a.assetType?(a.assetType="light",a.lightObject=a):a.isCamera?(a.assetType="camera",a.cameraObject=a):a.assetType||(a.assetType="model"),a.modelObject||(a.modelObject=a),a.setDirty||(a.setDirty=(x={})=>{a.dispatchEvent({...x,type:"objectUpdate",object:a})},a.userData.setDirty&&console.warn("userData.setDirty already defined",a.userData.setDirty,a),a.userData.setDirty=x=>{var S;console.warn("userData.setDirty is deprecated, use setDirty directly"),(S=a.setDirty)==null||S.call(a,x)}),a.addEventListener("added",x=>{var C,L;const S=((C=a.parent)==null?void 0:C.userData.parentRoot)??a.parent;S!==a.userData.parentRoot&&a.traverse(B=>{B.userData.parentRoot=S}),(L=a.setDirty)==null||L.call(a,{change:"addedToParent"})}),a.addEventListener("removed",()=>{var x;(x=a.setDirty)==null||x.call(a,{change:"removedFromParent"}),a.userData.parentRoot!==void 0&&a.traverse(S=>{S.userData.parentRoot=void 0})}),n.push(()=>{});const s=a.dispose;a.dispose=()=>{a.dispatchEvent({type:"dispose"}),s==null||s.call(a)},a.userData.dispose&&console.warn("userData.dispose already defined"),a.userData.dispose=()=>{var x;console.warn("userData.dispose is deprecated, use dispose directly"),(x=a.dispose)==null||x.call(a)};const l=a;!l.isMesh&&!l.isLine||l.userData.__meshSetup||(l.userData.__meshSetup=!0,l.setMaterial||(l.setMaterial=x=>wo(l,x)),l.setGeometry||(l.setGeometry=(x,S=!1)=>Cl(l,x,S),l.setGeometry(l.geometry,!0)),a.userData.setMaterial&&console.warn("userData.setMaterial already defined"),a.userData.setMaterial=x=>{var S;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(S=a.setMaterial)==null||S.call(a,x)},a.userData.setGeometry&&console.warn("userData.setGeometry already defined"),a.userData.setGeometry=(x,...S)=>{var C;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(C=a.setGeometry)==null||C.call(a,x,...S)},a.userData.__keepShadowDef||(a.castShadow=!0,a.receiveShadow=!0,a.userData.__keepShadowDef=!0),n.push(()=>{var C,L,B,W,q,Z;const x=((C=l.setMaterial)==null?void 0:C.call(l,void 0))||[],S=(L=l.setGeometry)==null?void 0:L.call(l,void 0);for(const j of x)j&&j.userData&&((B=j.userData.__appliedMeshes)==null?void 0:B.size)===0&&j.userData.disposeOnIdle!==!1&&j.dispose();S&&S.userData&&((W=S.userData.__appliedMeshes)==null?void 0:W.size)===0&&S.userData.disposeOnIdle!==!1&&S.dispose(),(q=l.setMaterial)==null||q.call(l,x),(Z=l.setGeometry)==null||Z.call(l,S)})),a.uiConfig||a.assetType!=="model"&&a.assetType!=="camera"||(cl(a),n.push(()=>{})),a.addEventListener("objectUpdate",({refreshUi:x})=>{var S,C;return x!==!1&&((C=(S=a.uiConfig)==null?void 0:S.uiRefresh)==null?void 0:C.call(S,"postFrame",!0,1))}),a.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(a.userData.__autoParentDispatchEvents=a.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],a.isCamera&&a.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(a.userData.parentRoot=e);const c=a.dispatchEvent;a.dispatchEvent=x=>{var S;(S=a.userData.__autoParentDispatchEvents)!=null&&S.includes(x.type)&&(x.parentDispatch=!0),x.parentDispatch&&(C=>{const L=a.userData.parentRoot??a.parent;L!=null&&L.modelObject&&L.dispatchEvent(C)})(x),c.call(a,x)};const f=a.clone;a.clone=(...x)=>{const S=a.userData;a.userData={};let C=f.call(a,...x);a.userData=S,co(C.userData,S);const L=a.userData.parentRoot;return L&&L.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),C=xs(C,L,t),C.userData.cloneParent=a.uuid,C};const g=a.copy;a.copy=(x,...S)=>{const C=x.userData;x.userData={};const L=g.call(a,x,...S);return x.userData=C,co(a.userData,x),L};const y=a.add;return a.add=(...x)=>(x.forEach(S=>xs(S,a.userData.parentRoot||a,t)),y.call(a,...x)),(a=(t==null?void 0:t(a))??a).addEventListener("dispose",()=>{n.forEach(x=>x()),n=[]}),[...a.children].forEach(x=>xs(x,a,t)),a}function wo(a,e){var l,c,f,g;const t=(Array.isArray(e)?e:[e]).map(y=>y==null?void 0:y.materialObject).filter(y=>y);if(a.material==t||t.length===1&&a.material===t[0])return[];a.userData.__materialUpdater||(a.userData.__materialUpdater=()=>{a.dispatchEvent({type:"materialUpdate"})}),a.userData.__textureUpdater||(a.userData.__textureUpdater=()=>{a.dispatchEvent({type:"textureUpdate"})});const n=Array.isArray(a.material)?[...a.material]:[a.material];for(const y of n)y&&(y.removeEventListener("materialUpdate",a.userData.__materialUpdater),y.removeEventListener("textureUpdate",a.userData.__textureUpdater),(c=(l=y.userData)==null?void 0:l.__appliedMeshes)==null||c.delete(a));const s=[];for(const y of t)y.userData.__appliedMeshes||(y.userData.__appliedMeshes=new Set),s.push(y),y&&(y.addEventListener("materialUpdate",a.userData.__materialUpdater),y.addEventListener("textureUpdate",a.userData.__textureUpdater),y.userData.__appliedMeshes.add(a));return a.material=s.length!==1?s:s[0]??void 0,a.dispatchEvent({type:"materialChanged",material:e,mesh:a}),(g=(f=a.uiConfig)==null?void 0:f.uiRefresh)==null||g.call(f,"postFrame",!0),n}function Cl(a,e,t=!1){var l,c,f,g,y,x;a.userData.__objectUpdater||(a.userData.__objectUpdater=S=>{a.dispatchEvent({...S,type:"objectUpdate"})});let n=a.geometry;const s=n;return(n!==e||t)&&(n&&(n.removeEventListener("geometryUpdate",a.userData.__objectUpdater),(c=(l=n.userData)==null?void 0:l.__appliedMeshes)==null||c.delete(a)),n=e,n&&!n.userData.__appliedMeshes&&(n.userData.__appliedMeshes=new Set),a.geometry=n??void 0,n&&(a.updateMorphTargets(),n.addEventListener("geometryUpdate",a.userData.__objectUpdater),(g=(f=n.userData)==null?void 0:f.__appliedMeshes)==null||g.add(a))),e&&!e.uiConfig&&(e.uiConfig=function(S){return{label:"Geometry",type:"folder",children:[{type:"input",property:[S,"uuid"],disabled:!0},{type:"input",property:[S,"name"]},{type:"button",label:"Center Geometry",value:()=>{S.center()}},{type:"button",label:"Compute vertex normals",value:()=>{S.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{S.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{S.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!S.index,value:()=>{if(S.attributes.index)return;const C=parseFloat(prompt("Tolerance","-1")??"-1");tt(S,C)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!S.index,value:()=>{S.attributes.index&&S.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{S.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||S.setAttribute("uv1",S.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!S.hasAttribute("color"),value:()=>{S.hasAttribute("color")?confirm("Remove color attribute?")&&S.deleteAttribute("color"):prompt("No color attribute found")}},{type:"input",label:"Mesh count",get value(){var C,L;return((L=(C=S.userData)==null?void 0:C.__appliedMeshes)==null?void 0:L.size)??0},set value(C){},disabled:!0}]}}(a.geometry)),a.dispatchEvent({type:"geometryChanged",geometry:e}),(x=(y=a.uiConfig)==null?void 0:y.uiRefresh)==null||x.call(y,"postFrame",!0),s===n?void 0:s||void 0}es([Pe()],Ps.prototype,"stableNoise",void 0),es([Pe()],Ps.prototype,"useLegacyLights",null),Ps=es([Pr("RenderManager")],Ps);const Zs=["appliedMeshes"],Bo=["parentRoot","iCamera","iModel"];function co(a,e){if(e)for(const t of Object.keys(e))Bo.includes(t)||t.startsWith("__")||typeof a[t]!="function"&&typeof e[t]!="function"&&(a[t]=e[t]);return a}var Jl,mh=new Uint8Array(16);function ul(){if(!Jl&&!(Jl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Jl(mh)}for(var gt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Wt=[],bn=0;bn<256;++bn)Wt.push((bn+256).toString(16).substr(1));var ln=function(a){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Wt[a[e+0]]+Wt[a[e+1]]+Wt[a[e+2]]+Wt[a[e+3]]+"-"+Wt[a[e+4]]+Wt[a[e+5]]+"-"+Wt[a[e+6]]+Wt[a[e+7]]+"-"+Wt[a[e+8]]+Wt[a[e+9]]+"-"+Wt[a[e+10]]+Wt[a[e+11]]+Wt[a[e+12]]+Wt[a[e+13]]+Wt[a[e+14]]+Wt[a[e+15]]).toLowerCase();if(!function(n){return typeof n=="string"&&gt.test(n)}(t))throw TypeError("Stringified UUID is invalid");return t},mn=function(a,e,t){var n=(a=a||{}).random||(a.rng||ul)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=n[s];return e}return ln(n)};const Pi=new Map;function Di(a,e){return(t,n)=>{const s=t.constructor;if(s===Object)throw new Error("All properties in an object are serialized by default");Pi.has(s)||Pi.set(s,[]);const l=Pi.get(s);if(!(l.findIndex(c=>c.propKey===n)<0))throw new Error(`Property ${n} already has a uiConfig decorator`);l.push({params:e||{},propKey:n,uiType:a})}}function En(a,e){return Di("checkbox",{label:a,params:e})}function nr(a,e){return Di("monitor",{label:a,params:e})}function Hn(a,e,t,n){return Di("slider",{label:a,bounds:e,stepSize:t,params:n})}function Ni(a,e,t,n){return Di("vec",{label:a,bounds:e,stepSize:t,params:n})}function Me(a,e,t){return Di("dropdown",{label:a,children:e,params:t})}function Ee(a,e){return Di("button",{label:a,params:e})}function We(a,e){return Di("input",{label:a,params:e})}function it(a,e){return Di("color",{label:a,params:e})}function je(a,e){return Di("image",{label:a,params:e})}function _t(a){let e=a==null?void 0:a.constructor;if(!a||!e)return[];const t=[],n=[];for(;e&&e!==Object;)n.push(e),e=Object.getPrototypeOf(e);if(!n.length){const s=typeof a=="object"?Object.keys(a):Array.isArray(a)?a.map((l,c)=>c):[];for(const l of s){const c=a[l];if(c==null)continue;const f=c==null?void 0:c.uiConfig;if(f)t.push(f);else{const g=cn(c);g==="folder"?t.push(qe(l+"",c)):g&&t.push({type:g,label:l+"",property:[a,l]})}}}return n.reverse().forEach(s=>{var l;(l=Pi.get(s))==null||l.forEach(({params:c,propKey:f,uiType:g})=>{let y;if(!g){const x=a[f];y=x==null?void 0:x.uiConfig,y?t.push(y):x!=null&&((g=cn(x))==="folder"?y=qe(f+"",x):g&&(y={type:g,label:f+"",property:[a,f]}))}if(y||(y={property:[a,f],type:g||"input"}),c){const x=typeof c.params=="function"?c.params(a):c.params||{};delete c.params,Object.assign(y,{...c,...x})}t.push(y)})}),t}function qe(a,e,t={},n="folder"){return{type:n,label:a,children:_t(e),uuid:mn(),...t}}function lt(a,e,t="folder"){return n=>class extends n{constructor(){super(...arguments),this.uiConfig=qe(a,this,e||{},t)}}}function Nt(a,e){return lt(a,e,"panel")}function cn(a){return a==null?null:Array.isArray(a)?"folder":typeof a=="boolean"?"checkbox":typeof a=="number"?"number":typeof a=="string"?"input":typeof a=="function"?"button":typeof a.x=="number"?"vec":typeof a.r=="number"?"color":a.isTexture?"image":typeof a=="object"?"folder":null}const Xt={type:"change"},In={type:"start"},Ut={type:"end"};class Zn extends i.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new i.Pa4,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:i.RsA.ROTATE,MIDDLE:i.RsA.DOLLY,RIGHT:i.RsA.PAN},this.touches={ONE:i.QmN.ROTATE,TWO:i.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(vn){vn.addEventListener("keydown",Bi),this._domElementKeyEvents=vn},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Bi),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Xt),n.update(),l=s.NONE},this.update=function(){const vn=new i.Pa4,zn=new i._fP().setFromUnitVectors(e.up,new i.Pa4(0,1,0)),fi=zn.clone().invert(),br=new i.Pa4,Wr=new i._fP,Rr=2*Math.PI;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const xr=n.object.position;vn.copy(xr).sub(n.target),vn.applyQuaternion(zn),f.setFromVector3(vn),n.autoRotate&&l===s.NONE&&Be(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(f.theta+=g.theta*n.dampingFactor,f.phi+=g.phi*n.dampingFactor):(f.theta+=g.theta,f.phi+=g.phi);let vr=n.minAzimuthAngle,ji=n.maxAzimuthAngle;isFinite(vr)&&isFinite(ji)&&(vr<-Math.PI?vr+=Rr:vr>Math.PI&&(vr-=Rr),ji<-Math.PI?ji+=Rr:ji>Math.PI&&(ji-=Rr),f.theta=vr<=ji?Math.max(vr,Math.min(ji,f.theta)):f.theta>(vr+ji)/2?Math.max(vr,f.theta):Math.min(ji,f.theta)),f.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,f.phi)),f.makeSafe(),Math.abs(g.radius)>0&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*(1+g.radius*(n.enableDamping?n.dampingFactor:1)))),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(g.radius=0)),f.radius*=1+g.radius*(n.enableDamping?n.dampingFactor:1)),Math.abs(y-1)>1e-5&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*y)),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(y=1)),f.radius*=y);let sn=0;n.autoPushTarget&&f.radius<n.minDistance&&(sn=n.minDistance-f.radius),n.autoPullTarget&&f.radius>n.maxDistance&&(sn=n.maxDistance-f.radius),f.radius=Math.max(n.minDistance,Math.min(n.maxDistance,f.radius)),n.enableDamping===!0?n.target.addScaledVector(x,n.dampingFactor):n.target.add(x),vn.setFromSpherical(f),vn.applyQuaternion(fi),xr.copy(n.target).add(vn),n.target.add(vn.normalize().multiplyScalar(-sn)),n.object.lookAt(n.target);let pi=!1;return n.enableDamping===!0&&Math.abs(g.theta)+Math.abs(g.phi)+Math.abs(g.radius)+x.length()>.001?(g.theta*=1-n.dampingFactor,g.phi*=1-n.dampingFactor,g.radius*=1-n.dampingFactor,x.multiplyScalar(1-n.dampingFactor),pi=!0):(g.set(0,0,0),x.set(0,0,0)),y=1,!!(S||pi||br.distanceToSquared(n.object.position)>c||8*(1-Wr.dot(n.object.quaternion))>c)&&(n.dispatchEvent(Xt),br.copy(n.object.position),Wr.copy(n.object.quaternion),S=!1,!0)}}(),this.stopDamping=function(){g.set(0,0,0),x.set(0,0,0)},this.dispose=function(){n.domElement.removeEventListener("contextmenu",Br),n.domElement.removeEventListener("pointerdown",Gn),n.domElement.removeEventListener("pointercancel",di),n.domElement.removeEventListener("wheel",bi),n.domElement.removeEventListener("pointermove",Fn),n.domElement.removeEventListener("pointerup",di),n._domElementKeyEvents!==null&&(n._domElementKeyEvents.removeEventListener("keydown",Bi),n._domElementKeyEvents=null)};const n=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=s.NONE;const c=1e-6,f=new i.$V,g=new i.$V(0,0,0);let y=1;const x=new i.Pa4;let S=!1;const C=new i.FM8,L=new i.FM8,B=new i.FM8,W=new i.FM8,q=new i.FM8,Z=new i.FM8,j=new i.FM8,F=new i.FM8,se=new i.FM8,pe=[],be={};function Se(){return n.enableDamping?1:Math.pow(.95,n.zoomSpeed)}function Be(vn){g.theta-=vn}function Ge(vn){g.phi-=vn}this.rotateUp=Ge,this.rotateLeft=Be;const Xe=function(){const vn=new i.Pa4;return function(zn,fi){vn.setFromMatrixColumn(fi,0),vn.multiplyScalar(-zn),x.add(vn)}}(),Qe=function(){const vn=new i.Pa4;return function(zn,fi){n.screenSpacePanning===!0?vn.setFromMatrixColumn(fi,1):(vn.setFromMatrixColumn(fi,0),vn.crossVectors(n.object.up,vn)),vn.multiplyScalar(zn),x.add(vn)}}(),at=function(){const vn=new i.Pa4;return function(zn,fi){const br=n.domElement;if(n.object.isPerspectiveCamera){const Wr=n.object.position;vn.copy(Wr).sub(n.target);let Rr=vn.length();Rr*=Math.tan(n.object.fov/2*Math.PI/180),Xe(2*zn*Rr/br.clientHeight,n.object.matrix),Qe(2*fi*Rr/br.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(Xe(zn*(n.object.right-n.object.left)/n.object.zoom/br.clientWidth,n.object.matrix),Qe(fi*(n.object.top-n.object.bottom)/n.object.zoom/br.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function Ke(vn,zn=0){n.object.isPerspectiveCamera?(y/=vn,g.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,g.radius-zn))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*vn)),n.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Je(vn,zn=0){n.object.isPerspectiveCamera?(y*=vn,g.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,g.radius+zn))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/vn)),n.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ft(vn){C.set(vn.clientX,vn.clientY)}function mt(vn){W.set(vn.clientX,vn.clientY)}function vt(){if(pe.length===1)C.set(pe[0].pageX,pe[0].pageY);else{const vn=.5*(pe[0].pageX+pe[1].pageX),zn=.5*(pe[0].pageY+pe[1].pageY);C.set(vn,zn)}}function Qt(){if(pe.length===1)W.set(pe[0].pageX,pe[0].pageY);else{const vn=.5*(pe[0].pageX+pe[1].pageX),zn=.5*(pe[0].pageY+pe[1].pageY);W.set(vn,zn)}}function Ht(){const vn=pe[0].pageX-pe[1].pageX,zn=pe[0].pageY-pe[1].pageY,fi=Math.sqrt(vn*vn+zn*zn);j.set(0,fi)}function Cn(vn){if(pe.length==1)L.set(vn.pageX,vn.pageY);else{const fi=tr(vn),br=.5*(vn.pageX+fi.x),Wr=.5*(vn.pageY+fi.y);L.set(br,Wr)}B.subVectors(L,C).multiplyScalar(n.rotateSpeed);const zn=n.domElement;Be(2*Math.PI*B.x/zn.clientHeight),Ge(2*Math.PI*B.y/zn.clientHeight),C.copy(L)}function un(vn){if(pe.length===1)q.set(vn.pageX,vn.pageY);else{const zn=tr(vn),fi=.5*(vn.pageX+zn.x),br=.5*(vn.pageY+zn.y);q.set(fi,br)}Z.subVectors(q,W).multiplyScalar(n.panSpeed),at(Z.x,Z.y),W.copy(q)}function rn(vn){const zn=tr(vn),fi=vn.pageX-zn.x,br=vn.pageY-zn.y,Wr=Math.sqrt(fi*fi+br*br);F.set(0,Wr),se.set(0,Math.pow(F.y/j.y,6*n.zoomSpeed)),Ke(se.y),j.copy(F)}function Gn(vn){n.enabled!==!1&&(pe.length===0&&(n.domElement.setPointerCapture(vn.pointerId),n.domElement.addEventListener("pointermove",Fn),n.domElement.addEventListener("pointerup",di)),function(zn){pe.push(zn)}(vn),vn.pointerType==="touch"?function(zn){switch(lr(zn),pe.length){case 1:switch(n.touches.ONE){case i.QmN.ROTATE:if(n.enableRotate===!1)return;vt(),l=s.TOUCH_ROTATE;break;case i.QmN.PAN:if(n.enablePan===!1)return;Qt(),l=s.TOUCH_PAN;break;default:l=s.NONE}break;case 2:switch(n.touches.TWO){case i.QmN.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;n.enableZoom&&Ht(),n.enablePan&&Qt(),l=s.TOUCH_DOLLY_PAN;break;case i.QmN.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;n.enableZoom&&Ht(),n.enableRotate&&vt(),l=s.TOUCH_DOLLY_ROTATE;break;default:l=s.NONE}break;default:l=s.NONE}l!==s.NONE&&n.dispatchEvent(In)}(vn):function(zn){let fi;switch(zn.button){case 0:fi=n.mouseButtons.LEFT;break;case 1:fi=n.mouseButtons.MIDDLE;break;case 2:fi=n.mouseButtons.RIGHT;break;default:fi=-1}switch(fi){case i.RsA.DOLLY:if(n.enableZoom===!1)return;(function(br){j.set(br.clientX,br.clientY)})(zn),l=s.DOLLY;break;case i.RsA.ROTATE:if(zn.ctrlKey||zn.metaKey||zn.shiftKey){if(n.enablePan===!1)return;mt(zn),l=s.PAN}else{if(n.enableRotate===!1)return;ft(zn),l=s.ROTATE}break;case i.RsA.PAN:if(zn.ctrlKey||zn.metaKey||zn.shiftKey){if(n.enableRotate===!1)return;ft(zn),l=s.ROTATE}else{if(n.enablePan===!1)return;mt(zn),l=s.PAN}break;default:l=s.NONE}l!==s.NONE&&n.dispatchEvent(In)}(vn))}function Fn(vn){n.enabled!==!1&&(vn.pointerType==="touch"?function(zn){switch(lr(zn),l){case s.TOUCH_ROTATE:if(n.enableRotate===!1)return;Cn(zn),n.update();break;case s.TOUCH_PAN:if(n.enablePan===!1)return;un(zn),n.update();break;case s.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;(function(fi){n.enableZoom&&rn(fi),n.enablePan&&un(fi)})(zn),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;(function(fi){n.enableZoom&&rn(fi),n.enableRotate&&Cn(fi)})(zn),n.update();break;default:l=s.NONE}}(vn):function(zn){switch(l){case s.ROTATE:if(n.enableRotate===!1)return;(function(fi){L.set(fi.clientX,fi.clientY),B.subVectors(L,C).multiplyScalar(n.rotateSpeed);const br=n.domElement;Be(2*Math.PI*B.x/br.clientHeight),Ge(2*Math.PI*B.y/br.clientHeight),C.copy(L),n.update()})(zn);break;case s.DOLLY:if(n.enableZoom===!1)return;(function(fi){F.set(fi.clientX,fi.clientY),se.subVectors(F,j),se.y>0?Ke(Se()):se.y<0&&Je(Se()),j.copy(F),n.update()})(zn);break;case s.PAN:if(n.enablePan===!1)return;(function(fi){q.set(fi.clientX,fi.clientY),Z.subVectors(q,W).multiplyScalar(n.panSpeed),at(Z.x,Z.y),W.copy(q),n.update()})(zn)}}(vn))}function di(vn){(function(zn){delete be[zn.pointerId];for(let fi=0;fi<pe.length;fi++)if(pe[fi].pointerId==zn.pointerId)return void pe.splice(fi,1)})(vn),pe.length===0&&(n.domElement.releasePointerCapture(vn.pointerId),n.domElement.removeEventListener("pointermove",Fn),n.domElement.removeEventListener("pointerup",di)),n.dispatchEvent(Ut),l=s.NONE}function bi(vn){n.enabled!==!1&&n.enableZoom!==!1&&l===s.NONE&&(vn.preventDefault(),n.dispatchEvent(In),function(zn){let fi=0;switch(zn.deltaMode){case 2:fi+=1*zn.deltaY;break;case 1:fi+=.4*zn.deltaY;break;default:fi+=.01*zn.deltaY}zn.deltaY<0?Je(1,fi*n.zoomSpeed):zn.deltaY>0&&Ke(1,-fi*n.zoomSpeed),n.update()}(vn),n.dispatchEvent(Ut))}function Bi(vn){n.enabled!==!1&&n.enablePan!==!1&&function(zn){let fi=!1;switch(zn.code){case n.keys.UP:zn.ctrlKey||zn.metaKey||zn.shiftKey?Ge(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):at(0,n.keyPanSpeed),fi=!0;break;case n.keys.BOTTOM:zn.ctrlKey||zn.metaKey||zn.shiftKey?Ge(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):at(0,-n.keyPanSpeed),fi=!0;break;case n.keys.LEFT:zn.ctrlKey||zn.metaKey||zn.shiftKey?Be(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):at(n.keyPanSpeed,0),fi=!0;break;case n.keys.RIGHT:zn.ctrlKey||zn.metaKey||zn.shiftKey?Be(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):at(-n.keyPanSpeed,0),fi=!0}fi&&(zn.preventDefault(),n.update())}(vn)}function Br(vn){n.enabled!==!1&&vn.preventDefault()}function lr(vn){let zn=be[vn.pointerId];zn===void 0&&(zn=new i.FM8,be[vn.pointerId]=zn),zn.set(vn.pageX,vn.pageY)}function tr(vn){const zn=vn.pointerId===pe[0].pointerId?pe[1]:pe[0];return be[zn.pointerId]}this.zoomIn=function(vn){Ke(1,vn*n.zoomSpeed)},this.zoomOut=function(vn){Je(1,vn*n.zoomSpeed)},n.domElement.addEventListener("contextmenu",Br),n.domElement.addEventListener("pointerdown",Gn),n.domElement.addEventListener("pointercancel",di),n.domElement.addEventListener("wheel",bi,{passive:!1}),this.update()}}var On=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Yt=class extends Zn{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}zoomIn(a){super.zoomIn(a)}zoomOut(a){super.zoomOut(a)}dispatchEvent(a){super.dispatchEvent(a)}};On([Pe()],Yt.prototype,"type",void 0),On([En()],Yt.prototype,"enabled",void 0),On([En(),Pe()],Yt.prototype,"dollyZoom",void 0),On([En(),Pe()],Yt.prototype,"enableDamping",void 0),On([We(),Pe()],Yt.prototype,"dampingFactor",void 0),On([En(),Pe()],Yt.prototype,"autoRotate",void 0),On([We(),Pe()],Yt.prototype,"autoRotateSpeed",void 0),On([En(),Pe()],Yt.prototype,"enableZoom",void 0),On([We(),Pe()],Yt.prototype,"zoomSpeed",void 0),On([We(),Pe()],Yt.prototype,"maxZoomSpeed",void 0),On([En(),Pe()],Yt.prototype,"enableRotate",void 0),On([We(),Pe()],Yt.prototype,"rotateSpeed",void 0),On([En(),Pe()],Yt.prototype,"enablePan",void 0),On([We(),Pe()],Yt.prototype,"panSpeed",void 0),On([We(),Pe()],Yt.prototype,"autoPushTarget",void 0),On([We(),Pe()],Yt.prototype,"autoPullTarget",void 0),On([We(),Pe()],Yt.prototype,"minDistance",void 0),On([We(),Pe()],Yt.prototype,"maxDistance",void 0),On([We(),Pe()],Yt.prototype,"minZoom",void 0),On([We(),Pe()],Yt.prototype,"maxZoom",void 0),On([We(),Pe()],Yt.prototype,"minPolarAngle",void 0),On([We(),Pe()],Yt.prototype,"maxPolarAngle",void 0),On([We(),Pe()],Yt.prototype,"minAzimuthAngle",void 0),On([We(),Pe()],Yt.prototype,"maxAzimuthAngle",void 0),On([Pe()],Yt.prototype,"screenSpacePanning",void 0),On([Pe()],Yt.prototype,"keyPanSpeed",void 0),Yt=On([Nt("Orbit Controls")],Yt);var si=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class Tn extends r.SimpleEventDispatcher{get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>0;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>0;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){var s,l;const n={...e};(s=n.position)!=null&&s.isVector3&&(n.position=[n.position.x,n.position.y,n.position.z]),(l=n.target)!=null&&l.isVector3&&(n.target=[n.target.x,n.target.y,n.target.z]),Object.keys(n).forEach(c=>c!=="frustumSize"&&n[c]===void 0&&delete n[c]),Object.assign(this._options,n),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty()}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const s=this._options.type==="PerspectiveCamera"?new i.cPb:new i.iKG;s.name=this._camera.name,s.near=this._camera.modelObject.near,s.far=this._camera.modelObject.far,s.zoom=this._camera.modelObject.zoom,s.scale.copy(this._camera.modelObject.scale);const l=this._isActiveCamera;l&&this.deactivateMain(),this._camera=this._setCameraObject(s),t=this._camera.modelObject,l&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let n=this._options.aspect;if(n==="auto"&&(n=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),this._options.type==="PerspectiveCamera"&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=n),this._options.type==="OrthographicCamera"){const s=this._options.frustumSize;s!==void 0?(t.top=s/2,t.bottom=-s/2,t.left=n*s/2,t.right=-n*s/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=xs(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled&&this._options.controlsMode!==""}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(e,t,n){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=c=>{this.setDirty(c)},this._interactionsEnabled=!0,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new i.Pa4(0,0,10),this._target=new i.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(c,f)=>{const g=new Yt(c,f.ownerDocument?f:f.documentElement);return g.screenSpacePanning=!0,g}]]),this._positionWorld=new i.Pa4,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"input",label:"Min Near",getValue:()=>this._camera.userData.minNearPlane??.2,setValue:c=>this._camera.userData.minNearPlane=c,onChange:()=>this.setDirty()},{type:"input",label:"Max Far",getValue:()=>this._camera.userData.maxFarPlane??1e3,setValue:c=>this._camera.userData.maxFarPlane=c,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(c=>({label:c===""?"none":c,value:c})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var c;return(c=this._controls)!=null&&c.zoomIn?{type:"button",label:"Zoom in",value:()=>{var f;(f=this._controls)==null||f.zoomIn(1)}}:{}},()=>{var c;return(c=this._controls)!=null&&c.zoomOut?{type:"button",label:"Zoom out",value:()=>{var f;(f=this._controls)==null||f.zoomOut(1)}}:{}},()=>{var c;return(c=this._controls)==null?void 0:c.uiConfig}]},this.assetType="model",this.uuid=$(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=n??document.body;const s={...t};this._camera=this._setCameraObject(e??(s.type==="OrthographicCamera"?new i.iKG(-1,1,1,-1):new i.cPb)),this._camera.modelObject.userData.iCamera=this;const l=e;e&&(l.isPerspectiveCamera?(s.fov=l.fov,s.focus=l.focus,s.aspect=l.aspect<=0||l.userData.autoAspect?"auto":l.aspect,s.zoom=l.zoom):l.isOrthographicCamera&&(s.left=l.left,s.right=l.right,s.top=l.top,s.bottom=l.bottom,s.zoom=l.zoom),s.near=l.near,s.far=l.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(s)}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(e=4){var t;(t=this._controls)!=null&&t.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this.cameraObject.getWorldPosition(new i.Pa4))}setControlsCtor(e,t,n=!1){n||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var t,n;const e=this._options.controlsMode;this._controls=((t=this._controlsCtors.get(e))==null?void 0:t(this._camera.modelObject,this._container))??void 0,this._controls||e===""||console.error("Unable to create controls with mode "+e+". Are you missing a plugin?"),(n=this._controls)==null||n.addEventListener("change",this.setDirty),this._controlsMode=this._controls?e:""}_disposeCameraControls(){var e,t;this._controlsMode,(e=this._controls)==null||e.removeEventListener("change",this.setDirty),(t=this._controls)==null||t.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var t,n;if(this._options.controlsEnabled){const s=this._options.controlsMode;this._controls?this._controlsMode===s&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=s}if(this._controls){const s=this.interactionsEnabled;this._controls.enabled=s,s&&this._camera.modelObject.up.copy(i.Tme.DEFAULT_UP)}e&&this.setDirty(),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t,"postFrame",!1,1)})}activateMain(e=!0){var t,n;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new i.Pa4)),e&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),(n=(t=this._camera).setDirty)==null||n.call(t,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var n,s;const t=this.target;(s=(n=this._controls)==null?void 0:n.target)==null||s.set(t.x,t.y,t.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this._camera.userData.autoLookAtTarget!==void 0&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(t),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),this.targetUpdated(e)}positionTargetUpdated(e=!0){this.positionUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var t,n,s,l;return(n=(t=e.uniforms.cameraPositionWorld)==null?void 0:t.value)==null||n.copy(this._positionWorld),(l=(s=e.uniforms.cameraNearFar)==null?void 0:s.value)==null||l.set(this._camera.modelObject.near,this._camera.modelObject.far),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){return Object.assign({},kn(this,!0,e))}fromJSON(e,t){return ui(e,this,!0,t),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}si([Pe("camControls")],Tn.prototype,"_controls",void 0),si([Pe()],Tn.prototype,"userData",void 0),si([(0,r.onChange)(Tn.prototype._nearFarChanged)],Tn.prototype,"near",void 0),si([(0,r.onChange)(Tn.prototype._nearFarChanged)],Tn.prototype,"far",void 0),si([Pe("camOptions")],Tn.prototype,"_options",void 0),si([Pe("position")],Tn.prototype,"_position",void 0),si([Pe("target")],Tn.prototype,"_target",void 0);var _i=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class Ii extends i.xsS{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let n=this._cameras.indexOf(e);n<0&&(this._cameras.push(e),n=this._cameras.length-1),this._activeCamera=n}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get modelObject(){return this}constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new V,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new Tn(new i.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=xs(new i.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new i.GQ(this.getBounds())}addModel(e,t={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(e==null?void 0:e.modelObject,t)}addSceneObject(e,t){if(!e)return e;const n=e.assetType;let s=!1;switch(n){case"model":s=e.modelObject.isCamera,s&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("Unknown asset imported",e,n)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:n=2,addToRoot:s=!1}={}){const l=e;l?(t&&!l.userData.autoScaled&&Ze(l,l.userData.autoScaleRadius||n),l.traverse(c=>{c.isMesh&&!c.userData.__keepShadowDef&&(c.castShadow=!0,c.receiveShadow=!0,c.userData.__keepShadowDef=!0)}),s?this.modelObject.add(l):this.modelRoot.add(l),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach(e=>{var t;(e.dispose??((t=e.modelObject)==null?void 0:t.removeFromParent))()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var e;((e=this.environment)==null?void 0:e.mapping)===i.xfE&&(this.environment.mapping=i.dSO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...e){return super.add(...e.map(t=>xs(t))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return void(this.environment=null);if(!e.isTexture)return void console.error("Unknown Environment type",e);e.assetType!=="texture"&&console.warn("Environment asset not processed",e);const t=e.textureObject||e;this.environment=t}getEnvironment(){return this.environment}setBackground(e){let t;if(!e||e.assetType==="texture"||e.isTexture||e.isColor||e==="environment")t=((e==null?void 0:e.assetType)==="texture"||e.isTexture)&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);t=new i.Ilk(e)}this.background=t}setBackgroundColor(e){this.backgroundColor=e?new i.Ilk(e):null}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var t,n,s;return e.sceneUpdate===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(s=(n=(t=this.boxHelper)==null?void 0:t.box)==null?void 0:n.copy)==null||s.call(n,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new i.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){var e;this.disposeSceneModels(),this.clear(),(e=this.environment)==null||e.dispose()}findObjectsByName(e,t){const n=[];return(t??this.modelObject).traverse(s=>{s.name===e&&n.push(s)}),n}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){var s;const n=e.lightObject;n&&((s=n.children)==null||s.length,t?this.add(n):this.modelRoot.add(n))}getBounds(e=!1,t=!0){return new V().expandByObject(this.modelObject,e,t)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;if(e.cameraObject.userData.autoNearFar===!1)return e.near=e.cameraObject.userData.minNearPlane??.01,void(e.far=e.cameraObject.userData.maxFarPlane??1e3);const t=this.getBounds(!1),n=e.cameraObject.getWorldPosition(new i.Pa4).sub(t.getCenter(new i.Pa4)),s=1.5*t.getSize(new i.Pa4).length()/2,l=-n.clone().normalize().dot(e.cameraObject.getWorldDirection(new i.Pa4)),c=n.length(),f=Math.max(e.cameraObject.userData.minNearPlane??.2,l*(c-s)),g=Math.min(Math.max(f+1,l*(c+s)),e.cameraObject.userData.maxFarPlane??1e3);e.near=f,e.far=g}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return kn(this,!0,e)}fromJSON(e,t){const n=e.environment;return n!==void 0&&(this.setEnvironment(ui(n,this.getEnvironment(),!1,t)),delete e.environment),ui(e,this,!0,t),e.environment=n,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get minNearDistance(){return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera.userData.minNearPlane??.02}set minNearDistance(e){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=e)}}_i([Pe()],Ii.prototype,"defaultCamera",void 0),_i([(0,r.onChange2)(Ii.prototype.setDirty),Pe()],Ii.prototype,"envMapIntensity",void 0),_i([(0,r.onChange2)(Ii.prototype.setDirty),Pe()],Ii.prototype,"fixedEnvMapDirection",void 0),_i([(0,r.onChange2)(Ii.prototype.setDirty),Pe()],Ii.prototype,"backgroundIntensity",void 0),_i([Pe(),(0,r.onChange)(Ii.prototype._onEnvironmentChange.name)],Ii.prototype,"environment",void 0),_i([Pe(),(0,r.onChange)(Ii.prototype._onBackgroundChange)],Ii.prototype,"background",void 0),_i([Pe(),(0,r.onChange)(Ii.prototype._onBackgroundChange)],Ii.prototype,"backgroundColor",void 0);function Yn(a,e,t,{replaceAll:n=!1,prepend:s=!1,append:l=!1}={}){if(!a.includes(e))return console.error(`${e} not found in shader`),a;let c=t;return s?c=t+e:l&&(c=e+t),n?a.replaceAll(e,c):a.replace(e,c)}class Oi{static ApplyMaterialExtensions(e,t,n,s){for(const l of n)this.ApplyMaterialExtension(e,t,l,s)}static ApplyMaterialExtension(e,t,n,s){let l=(0,r.getOrCall)(n.parsFragmentSnippet,s,e)??"";l.length&&(t.fragmentShader=Yn(t.fragmentShader,this.VoidMain,`
`+l+`
`,{prepend:!0})),l=(0,r.getOrCall)(n.parsVertexSnippet,s,e)??"",l.length&&(t.vertexShader=Yn(t.vertexShader,this.VoidMain,`
`+l+`
`,{prepend:!0})),n.extraUniforms&&(t.uniforms=Object.assign(t.uniforms,n.extraUniforms)),n.extraDefines&&function(c,f){let g=!1;const y=Object.entries(c);for(const[x,S]of y)S===void 0?f.materialObject.defines[x]!==void 0&&(delete f.materialObject.defines[x],g=!0):f.materialObject.defines[x]!==S&&(f.materialObject.defines[x]=S,g=!0);g&&(f.materialObject.needsUpdate=!0)}(n.extraDefines,e),n.shaderExtender&&n.shaderExtender(t,e,s),e.lastShader=t}static CacheKeyForExtensions(e,t){let n="";for(const s of t)n+=this.CacheKeyForExtension(e,s);return n}static CacheKeyForExtension(e,t){let n="";return t.customCacheKey&&(n+=t.customCacheKey),t.computeCacheKey&&(n+=t.computeCacheKey(e)),t.extraDefines&&Object.values(t.extraDefines).forEach(s=>n+=s),n}static RegisterExtensions(e,t){const n=[];if(t)for(const s of t)s.isCompatible&&s.isCompatible(e)&&(n.push(s),s.uuid||(s.uuid=mn()),s.__setDirty||(s.__setDirty=()=>{s.updateVersion||(s.updateVersion=0),s.updateVersion++}),s.setDirty||(s.setDirty=s.__setDirty));return e.materialExtensions=n,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",s=>function(l,{object:c,renderer:f}){var g;if(l.materialExtensions)for(const y of l.materialExtensions){if((g=y.onObjectRender)==null||g.call(y,c,l,f),l.lastShader){const x=(0,r.getOrCall)(y.updaters)||[];for(const S of x)S&&S.updateShaderProperties(l.lastShader)}y.updateVersion!==l.materialObject.userData["_"+y.uuid+"_version"]&&(l.materialObject.userData["_"+y.uuid+"_version"]=y.updateVersion,l.materialObject.needsUpdate=!0)}}(e,s))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",s=>function(l,{object:c,renderer:f}){var g;if(l.materialExtensions)for(const y of l.materialExtensions)(g=y.onAfterRender)==null||g.call(y,c,l,f)}(e,s))),n}}Oi.VoidMain="void main()";class Ki extends i.jyz{constructor(e,t=!1){super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},t&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=Oi.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Oi.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){Oi.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Oi.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,t,n,s,l){super.onBeforeRender(e,t,n,s,l),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:s,object:l})}onAfterRender(e,t,n,s,l){super.onAfterRender(e,t,n,s,l),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:s,object:l})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class Zi extends Ki{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class kr extends Zi{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map(t=>t.id).join(";")!==e.join(";")&&(this.textures=e.map(t=>({id:t,colorSpace:i.aCh})),this.setDirty())}_setUniformTexSize(e,t){var c,f;if(!t||!e)return;const n=((c=t.image)==null?void 0:c.width)??512,s=((f=t.image)==null?void 0:f.height)??512,l=e.value;l.isVector2||console.warn("uniform is not a Vector2"),l&&Math.abs(l.x-n)+Math.abs(l.y-s)>.1&&(l.x=n,l.y=s,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,n,s,l){var c,f;this._setUniformTexSize(this.uniforms.screenSize,(c=e.getRenderTarget())==null?void 0:c.texture);for(const g of this.textures){const y=g.id,x=(f=this.uniforms[y])==null?void 0:f.value;x&&(this._setUniformTexSize(this.uniforms[y+"Size"],x),x.colorSpace!==g.colorSpace&&(g.colorSpace=x.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,t,n,s,l)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map(n=>`uniform sampler2D ${n.id}; 
`+ae(n.id??"input",n.colorSpace??i.aCh)).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.colorSpace).join(";")}}function sr(a,...e){const t=a.fragmentShader;return new kr({defines:Object.assign({},a.defines),uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:t},e)}class ur extends R{constructor(e,...t){super(e.isMaterial?e:sr(e,...t),t.length<1?ur.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,t,n,s;(t=(e=this.material)==null?void 0:e.dispose)==null||t.call(e),(s=(n=this.fsQuad)==null?void 0:n.dispose)==null||s.call(n),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(t=>t==null?void 0:t.updateShaderProperties(this.material)))}render(e,t,n,s,l){this.enabled&&super.render(e,t||null,n,s,l)}}ur.DEFAULT_TEX_ID="tDiffuse",function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)}([En("Enabled"),Pe()],ur.prototype,"enabled",void 0);class eo extends _{constructor(e,t,n,s,l){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=s,this.clearAlpha=l!==void 0?l:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new i.Ilk}render(e,t,n,s,l,c){if(!this.scene||!this.camera)return;const f=e.autoClear;let g,y;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(y=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),g=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),c){const x=e.getContext();x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,c)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),c){const x=e.getContext();x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,g),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=y),e.autoClear=f}}class Jo extends ur{constructor(e,t="c = a + b;",n="",s){super({vertexShader:m.vertexShader,fragmentShader:r.glsl`
                varying vec2 vUv;
                
                ${n}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${t}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:s},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class to extends Zi{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#glMarker mainStart
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv))<alphaTest)
#else
if(texture2D(alphaMap,vAlphaMapUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new i.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:0},alphaMapTransform:{value:new i.Vkp},flags:{value:new i.Ltg(255,255,255,255)}},defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?i.LSk:i.v9Y}),this._updaters=[]}onBeforeRender(e,t,n,s,l){super.onBeforeRender(e,t,n,s,l);let c=l.material;Array.isArray(c)&&(c=c[0]),this.uniforms.alphaMap.value=(c==null?void 0:c.alphaMap)??null,this.uniforms.alphaTest.value=!c||!c.alphaTest||c.alphaTest<1e-7?.001:c.alphaTest,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(c!=null&&c.userData.matId?c==null?void 0:c.userData.matId:0)/255,this._updaters.forEach(g=>{g(l,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let f=this.uniforms.alphaMap.value?1:void 0;f!==this.defines.USE_ALPHAMAP&&(f===void 0?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=f,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),f=c.userData.ALPHA_I_RGBA_PACKING?1:void 0,f!==this.defines.ALPHA_I_RGBA_PACKING&&(f===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=f,this.needsUpdate=!0),f=c.userData.forcedLinearDepth??void 0,f!==this.defines.FORCED_LINEAR_DEPTH&&(f===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=f,this.needsUpdate=!0),this.side=c.side??i.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){const t=this._updaters.indexOf(e);t!==-1&&this._updaters.splice(t,1)}}var gs=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#endif
`;class Ln extends r.SimpleEventDispatcher{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=kn(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(ui(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e,meta:t}),this)}_storeKey(e){return(e??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var e,t,n;return((t=(e=this._viewer)==null?void 0:e.getPluginByType("AssetManager"))==null?void 0:t.exportPluginPreset(this))??((n=this.toJSON)==null?void 0:n.call(this))}async importState(e){var n,s;const t=(n=this._viewer)==null?void 0:n.getPluginByType("AssetManager");t?await t.importPluginPreset(e,this):(s=this.fromJSON)==null||s.call(this,e)}storeState(e,t,n){(t=t||(window?window.localStorage:void 0))?(n===void 0&&(n=this.exportState()),n&&t.setItem(this._storeKey(e),JSON.stringify(n))):console.warn("Unable to store state")}async loadState(e,t){if(!(t=t||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const n=t.getItem(this._storeKey(e));n&&await this.importState(JSON.parse(n))}}function as(a,e,t){return{...e,get dirty(){return e.dirty||!1},set dirty(n){(0,r.safeSetProperty)(e,"dirty",n,!0)},update(){var n,s,l;this.passObject.enabled&&((s=(n=this.passObject).updateShaderProperties)==null||s.call(n,(0,r.getOrCall)(t)),(l=e.update)==null||l.call(this))},onRegister(n){var s,l,c;this.passObject.materialExtension&&((l=(s=a.getPluginByType("AssetManager"))==null?void 0:s.materials)==null||l.registerMaterialExtension(this.passObject.materialExtension)),(c=e.onRegister)==null||c.call(this,n)},onUnregister(n){var s,l,c;this.passObject.materialExtension&&((l=(s=a.getPluginByType("AssetManager"))==null?void 0:s.materials)==null||l.unregisterMaterialExtension(this.passObject.materialExtension)),(c=e.onUnregister)==null||c.call(this,n)},dispose(){var n,s,l;(s=(n=this.passObject).dispose)==null||s.call(n),(l=e.dispose)==null||l.call(this)}}}class Ur extends Ln{_update(e){var t;return((t=this._pass)==null?void 0:t.enabled)&&this.enabled||!1}get enabled(){var e,t;return((t=(e=this._pass)==null?void 0:e.passObject)==null?void 0:t.enabled)||this._enabledTemp}set enabled(e){var t;(t=this._pass)!=null&&t.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}constructor(){super(),this._enabledTemp=!0}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(n){n&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=as(e,t),t.passObject.onDirty!==void 0&&t.passObject.onDirty.push(()=>t.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var t,n;this._pass&&e.renderer.unregisterPass(this._pass),(n=(t=this._pass)==null?void 0:t.dispose)==null||n.call(t),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=this.pass;return n&&(t.pass=kn((n==null?void 0:n.passObject)??n,!1,e)),t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.pass){const n=this.pass;n&&ui(e.pass,(n==null?void 0:n.passObject)??n,!1,t)}return this}}(function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)})([Pe()],Ur.prototype,"enabled",null);const Oo=new Set,Er=new Set;class $i extends eo{constructor(e,t,n=new $e(1,1,1),s=1){super(void 0,void 0,t,n,s),this.target=e}render(e,t,n,s,l){var y;const c=e.getRenderTarget(),f=e.getActiveCubeFace(),g=e.getActiveMipmapLevel();(y=this.scene)==null||y.traverse(({material:x})=>{x&&((x.transparent&&x.userData.renderToDepth||!x.transparent&&x.transmission===0&&x.userData.renderToDepth===!1)&&(Oo.add(x),x.transparent=!x.transparent),Math.abs(x.transmission||0)>0&&x.userData.renderToDepth&&(Er.add([x,x.transmission]),x.transmission=0))}),ot(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,t,this.target,s,l)),Oo.forEach(x=>x.transparent=!x.transparent),Oo.clear(),Er.forEach(([x,S])=>x.transmission=S),Er.clear(),e.setRenderTarget(c,f,g)}}class ir extends Ur{get material(){return this._material}passCtor(e){var l,c,f;const t=((l=this._viewer)==null?void 0:l.renderer.isWebGL2)&&this.renderFlagsBuffer,n=e.renderer.createTarget({depthBuffer:!0,samples:((c=this._viewer)==null?void 0:c.renderer.composerTarget.samples)||0,type:i.ywz,textureCount:t?2:1});Array.isArray(n.texture)?(n.texture[0].name="gbufferDepthNormal",n.texture[1].name="gbufferFlags",this._gbufferTextures=n.texture):(n.texture.name="gbufferDepthNormal",this._gbufferTextures.push(n.texture)),this._gbufferTarget=n;const s=(f=this._viewer)==null?void 0:f.getPluginByType("debug");return s&&(s.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&s.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),this._material=new to(t),this._material.userData.isGBufferMaterial=!0,new $i(n,this._material)}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return gs}updateShaderProperties(e){var t;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=this.getDepthNormal()??void 0:(t=this._viewer)==null||t.console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=this.getFlagsTexture()??void 0;const n=e.uniforms.tGBufferFlags.value?1:0;n!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=n,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}ir.PluginType="GBuffer";class Fs extends eo{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:i.aCh,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?i.cLu:i.ywz,format:i.wk1,minFilter:i.wem,magFilter:i.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(e,t=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new $e(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new Jo({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}render(e,t,n,s,l){var S;let c=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,n,s,l),this.needsSwap=c,void(e.userData.mainRenderPass=void 0);const f=e.userData;f||console.error("threejs is not patched?");const g=this._viewer.useGBufferDepth;let y;if(g){const C=(S=this._viewer.getPlugin(ir))==null?void 0:S.getTarget();if(C){const L=e.properties.get(C);y=L.__webglDepthRenderbuffer||L.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let x=()=>{super.render(e,void 0,n,s,l,y)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(c=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const C=e.autoClearDepth;e.autoClearDepth=!g,ot(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},x),e.autoClearDepth=C}if(!g){const C=e.properties.get(n);y=C.__webglDepthRenderbuffer||C.__webglDepthbuffer}x=()=>{super.render(e,void 0,this.transparentTarget,s,l,y)};{const C=this.clear,L=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,ot(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},x),this.clear=C,e.autoClearDepth=L}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,s,l),c=!0);{const C=this.clear;this.clear=!1,f.transmissionRenderTarget=c?t:n,f.blurTransmissionTarget=this.blurTransmissionTarget,ot(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},x),f.blurTransmissionTarget=void 0,f.transmissionRenderTarget=void 0,this.clear=C}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,s,l),c=!0)}}else{{const C=this.clear,L=e.autoClearDepth;e.autoClearDepth=!g,this.clear=!0,ot(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},x),this.clear=C,e.autoClearDepth=L}{this._viewer.renderer.blit(n.texture,t,{clear:!0});const C=this.clear;this.clear=!1,f.transmissionRenderTarget=t,f.blurTransmissionTarget=this.blurTransmissionTarget,ot(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},x),f.blurTransmissionTarget=void 0,f.transmissionRenderTarget=void 0,this.clear=C}c=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=c,e.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function uo(a,e){return a.multiplyScalar(a.w*e),a.w=1,a}function Eo(a,e){return uo(a,e),new $e(a.x,a.y,a.z)}function or(a,e){const t=Math.max(a.x,Math.max(a.y,a.z));let n=Math.max(Math.min(t/e,1),0);return n=Math.ceil(255*n)/255,a.divideScalar(n*e),a.w=n,a}function ws(a,e){return or(new i.Ltg(a.r,a.g,a.b,1),e)}const Sc={name:"",blending:i.bdR,side:i.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:i.k74,blendDst:i.LgZ,blendEquation:i.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:i.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:i.cum,stencilRef:0,stencilFuncMask:255,stencilFail:i.x5V,stencilZFail:i.x5V,stencilZPass:i.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},Ha={...Sc,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:i.IOt,normalScale:new i.FM8(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},Xp={...Ha,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new i.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new $e(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new $e(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new $e(1,1,1),specularColorMap:null};class _o extends i.EJi{constructor(e){super(e),this.typeSlug=_o.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=Oi.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Oi.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Mt(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Mt(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Mt(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[0,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Mt(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",i.IOt],["ObjectSpace",i.PA7]].map(e=>({label:e[0],value:e[1]}))},Mt(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Mt(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Mt(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Mt(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Mt(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Mt(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Mt(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Mt(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Mt(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Mt(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",i.BVF],["Always",i.Se2],["Less",i.Zr5],["LessEqual",i.vCF],["Equal",i.eD],["GreaterEqual",i.ksN],["Greater",i.w$m],["NotEqual",i.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Ne],["Normal",et],["Additive",i.WMw],["Subtractive",wt],["Multiply",Zt]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Mt(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Mt(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Mt(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},Mt(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},Mt(this,"iridescenceThicknessMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",i.Wl3],["Back",i._Li],["Double",i.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,t;return((t=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:t.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(kn(this,!1),null,2)],{type:"application/json"});(0,r.downloadBlob)(e,`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)==null?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],s=[["#include <uv_vertex>","mainStart"]];for(const l of s)e.vertexShader=Yn(e.vertexShader,l[0],"#glMarker "+l[1]+`
`+l[0]);for(const l of n)e.fragmentShader=Yn(e.fragmentShader,l[0],"#glMarker "+l[1]+`
`+l[0]);Oi.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Oi.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,s,l){super.onBeforeRender(e,t,n,s,l),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:s,object:l});const c=this.userData.inverseAlphaMap?1:0;c!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=c,this.needsUpdate=!0)}onAfterRender(e,t,n,s,l){super.onAfterRender(e,t,n,s,l),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:s,object:l})}copyProps(e,t=!1,n=!0){if(!t&&!["MeshStandardMaterial",_o.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={},l=Array.from(Object.keys(Xp));(0,r.copyProps)(e,s,l);const c=s.userData;delete s.userData;for(const f of Object.keys(s))s[f]===void 0&&delete s[f];return this.setValues(s),n&&(this.userData={}),c&&xt(this.userData,c),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(e){var l,c;const t=this.userData;this.userData={};const n=super.toJSON(e);this.userData=t,n.userData={},xt(n.userData,t),n.userData.uuid=this.userData.uuid;const s=e||{textures:Object.fromEntries(((l=n.textures)==null?void 0:l.map(f=>[f.uuid,f]))||[]),images:Object.fromEntries(((c=n.images)==null?void 0:c.map(f=>[f.uuid,f]))||[])};n.userData=kn(n.userData,!1,s),e||(Object.keys(s.textures).length>0&&(n.textures=Object.values(s.textures)),Object.keys(s.images).length>0&&(n.images=Object.values(s.images))),n.type=_o.TYPE;for(const f of Object.keys(n))n[f]===void 0&&delete n[f];return n}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}_o.TypeSlug="pmat",_o.TYPE="MeshStandardMaterial2";const Tc={...Sc,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:i.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class ss extends i.vBJ{constructor(e){super(e),this.typeSlug=ss.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.materialExtensions=Oi.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Oi.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Mt(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Ne],["Normal",et],["Additive",i.WMw],["Subtractive",wt],["Multiply",Zt]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Mt(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Mt(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Mt(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",i.Wl3],["Back",i._Li],["Double",i.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,t;return((t=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:t.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(kn(this,!1),null,2)],{type:"application/json"});(0,r.downloadBlob)(e,`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)==null?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],s=[["#include <uv_vertex>","mainStart"]];for(const l of s)e.vertexShader=Yn(e.vertexShader,l[0],"#glMarker "+l[1]+`
`+l[0]);for(const l of n)e.fragmentShader=Yn(e.fragmentShader,l[0],"#glMarker "+l[1]+`
`+l[0]);Oi.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Oi.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,s,l){super.onBeforeRender(e,t,n,s,l),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:s,object:l})}onAfterRender(e,t,n,s,l){super.onAfterRender(e,t,n,s,l),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:s,object:l})}copyProps(e,t=!1){if(!t&&!["MeshBasicMaterial",ss.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const n={},s=Array.from(Object.keys(Tc));(0,r.copyProps)(e,n,s);const l=n.userData;delete n.userData;for(const c of Object.keys(n))n[c]===void 0&&delete n[c];return this.setValues(n),l&&xt(this.userData,l),this.setDirty(),this}toJSON(e){var l,c;const t=this.userData;this.userData={};const n=super.toJSON(e);this.userData=t,n.userData={},xt(n.userData,t),n.userData.uuid=this.userData.uuid;const s=e||{textures:Object.fromEntries(((l=n.textures)==null?void 0:l.map(f=>[f.uuid,f]))||[]),images:Object.fromEntries(((c=n.images)==null?void 0:c.map(f=>[f.uuid,f]))||[])};n.userData=kn(n.userData,!1,s),e||(Object.keys(s.textures).length>0&&(n.textures=Object.values(s.textures)),Object.keys(s.images).length>0&&(n.images=Object.values(s.images))),n.type=ss.TYPE;for(const f of Object.keys(n))n[f]===void 0&&delete n[f];return n}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}ss.TypeSlug="bmat",ss.TYPE="MeshBasicMaterial2";const wd={materialType:_o.TYPE,name:"standard",color:"#ffffff"},no={materialType:ss.TYPE,name:"basic",color:"#ffffff"},m_={[_o.TYPE]:wd.name,MeshStandardMaterial:wd.name,MeshPhysicalMaterial:wd.name,[ss.TYPE]:no.name,MeshBasicMaterial:no.name};class Wa extends r.SimpleEventDispatcher{constructor(){super(),this._templates=[wd,no],this._materials=[],this._disposeMaterial=e=>{const t=e.target;if(!t||t.assetType!=="material")return;this._refreshTextureRefs();const n=this._getMapsForMaterial(t),s=[];n.forEach(l=>{const c=l.userData.__appliedMaterials;c==null||c.delete(t),c&&l.userData.disposeOnIdle!==!1&&c.size===0&&s.push(l)}),s.forEach(l=>{l.dispose()}),this.unregisterMaterial(t)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let n=this.findMaterial(e);return n||(n=this.generateFromTemplate(e,t)),n}generateFromTemplate(e,t){const n=this.findTemplate(e);if(n)return this._generateFromTemplate(n,t??{})}generateFromTemplateType(e,t){const n=this._templates.find(s=>s.materialType===e);if(n)return this._generateFromTemplate(n,t??{})}findTemplate(e){return this._templates.find(t=>t.name===e)}_refreshTextureRefs(e){(e||this.getAllMaterials()).forEach(t=>{this._getMapsForMaterial(t).forEach(n=>{let s=n.userData.__appliedMaterials;s||(n.userData.__appliedMaterials=s=new Set),n.addEventListener("update",()=>t.dispatchEvent({type:"textureUpdate",texture:n})),s.add(t)})})}_getMapsForMaterial(e){const t=new Set;for(const n of Object.values(e))n&&n.isTexture&&t.add(n);for(const n of Object.values(e.userData??{}))n&&n.isTexture&&t.add(n);return t}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e),this._refreshTextureRefs([e]))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter(t=>t.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=mn());const t=this._templates.find(n=>n.templateUUID===e.templateUUID);t?console.warn("MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(t=>t.templateUUID!==e.templateUUID)}dispose(e=!0){const t=this._materials;this._materials=[];for(const n of t)e||!n.userData.runtimeMaterial?n.dispose():this._materials.push(n)}findMaterial(e){return e?this._materials.find(t=>t.uuid===e):void 0}findMaterialsByName(e,t=!1){return this._materials.filter(n=>t?n.name.match(e)!==null:n.name===e)}getMaterialsOfType(e){return e?this._materials.filter(t=>t.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,t){const n=this._processModel(e,t);return(0,r.safeSetProperty)(e,"modelObject",n),e}_processMaterial(e,t){var s,l;if(!e)return;if((s=e.materialObject)!=null&&s.isMaterial)return e;let n=e.mmMaterial;if(!n){const c=((l=e.userData)==null?void 0:l.uuid)||e.uuid;if(n=this.findMaterial(c),n)n.copyProps(e);else{const f=t.useSourceMaterial===!1||!e.isMaterial,g=t.materialTemplate||(f?"standard":m_[e.type]||"standard");n=this.generateFromTemplate(g,f?{}:e)}e.mmMaterial=n}return n}processMaterial(e,t){return e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),t.register!==!1&&this.registerMaterial(e),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,t,n=!0,s=!1){const l=kn(e,!1),c=JSON.stringify(l,null,n?0:2),f=(t||e.name||"physical_material")+"."+e.typeSlug,g=new File([c],f,{type:"application/json"});return s&&(0,r.downloadFile)(g),g}applyMaterial(e,t){var c;const n=Object.getPrototypeOf(e).constructor.TYPE;let s=this.findMaterialsByName(t,!0);(!s||s.length<1)&&(s=[this.findMaterial(t)]);let l=!1;for(const f of s)if(f&&!f.userData.__isVariation&&f!==e)if(Object.getPrototypeOf(f).constructor.TYPE===n){const g=f.name;f.copyProps(e),f.name=g,l=!0}else{const g=f["__"+n]||this.generateFromTemplateType(n);if(!g)continue;const y=f.name;g.copyProps(e),g.name=y;const x=f.userData.__appliedMeshes;for(const S of[...x??[]])(c=S==null?void 0:S.setMaterial)==null||c.call(S,g),S&&(l=!0);f["__"+n]=g}return l}}class g_ extends Wa{_generateFromTemplate(e,t){var f,g,y,x,S;let n;const s={...e};s.customMaterialExtensions=[...s.customMaterialExtensions??[],...this._materialExtensions];const l=(t==null?void 0:t.metadata)&&(t==null?void 0:t.metadata.version)<=4.5;l&&(i.epp.enabled=!1);let c={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":t&&(0,r.copyProps)(t,s,Array.from(Object.keys(Xp))),(t==null?void 0:t.type)==="MeshBasicMaterial"&&(s.roughness=.9,s.metalness=0,(f=s.userData)!=null&&f.uuid&&delete s.userData.uuid),c=(g=s.userData)==null?void 0:g.uuid,c&&delete s.userData.uuid,n=new _o({customMaterialExtensions:s.customMaterialExtensions}).fromJSON(s,void 0,!0),c&&(n.uuid=c),n.userData.uuid=n.uuid,n.setDirty(),t!=null&&t.isMaterial&&t.userData!==void 0&&(t.userData.iMaterial=n);break;case"MeshBasicMaterial2":case"basic":case"unlit":t&&(0,r.copyProps)(t,s,Array.from(Object.keys(Tc))),c=(y=s.userData)==null?void 0:y.uuid,c&&delete s.userData.uuid,n=new ss({customMaterialExtensions:s.customMaterialExtensions}).fromJSON(s,void 0,!0),c&&(n.uuid=c,s.userData.uuid=c),n.userData.uuid=n.uuid,n.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:c=null,t&&t.userData&&(c=t.userData,delete t.userData),n=((x=e.generator)==null?void 0:x.call(e,s,t))||void 0,t&&c&&(t.userData=c),c&&n&&(xt(n.userData,c),c!=null&&c.uuid&&(n.uuid=c.uuid),c=null),n&&(n.userData.uuid=n.uuid)}if(n){t.runtimeMaterial&&(n.userData.__runtimeMaterial=!0);const C=n;if(n.clone=()=>{C.userData.cloneId||(C.userData.cloneId="0"),C.userData.cloneCount||(C.userData.cloneCount=0),C.userData.cloneCount+=1;const L=this.generateFromTemplate(e.name);return L&&(L.copyProps(C),L.userData.cloneId=L.userData.cloneId+"_"+C.userData.cloneCount,L.userData.cloneCount=0,L.name=L.name+"_"+L.userData.cloneId,L.userData.uuid=L.uuid),L==null?void 0:L.materialObject},t){let L=this.findMaterial(t==null?void 0:t.uuid);L&&this.unregisterMaterial(L),L=this.findMaterial((S=t==null?void 0:t.materialObject)==null?void 0:S.uuid),L&&this.unregisterMaterial(L)}}return l&&(i.epp.enabled=!0),n?this.registerMaterialObject(n):void 0}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let n=e.material;if(!n&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),n=this._defaultMaterial,e.material=n),n){let s=!0;Array.isArray(n)||(n=[n],s=!1);const l=[];for(const c of n){const f=this._processMaterial(c,t);l.push(f==null?void 0:f.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(s?l:l[0]))}if(t.recursive!==!1)for(let s=0;s<e.modelObject.children.length;s++)e.modelObject.children[s]=this._processModel(e.modelObject.children[s],t);return e}}class Ms{ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(t,e):t}constructor(e,t,n,s){this.cls=e,this.ext=t,this.root=n,this.onCtor=s}}class gh{get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}constructor(e,{pseudoCenter:t=!1,autoCenter:n=!1,autoScale:s=!1,autoScaleRadius:l=2,license:c=""}={}){if(this.assetType="model",this._modelObject=xs(new i.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!n||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||n||(e.userData.isCentered=!0):Ye(e),this._modelObject=e;else{n&&console.error("cannot use pseudoCenter and autoCenter at the same time");const f=new V().expandByObject(e,!0,!0).getCenter(new i.Pa4);this._modelObject.position.copy(f).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}s&&!this._modelObject.userData.autoScaled?Ze(this._modelObject,e.userData.autoScaleRadius||l):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=c}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var t,n,s,l;(n=(t=this._modelObject)==null?void 0:t.setDirty)==null||n.call(t,e),(l=(s=this._uiConfig)==null?void 0:s.uiRefresh)==null||l.call(s,"postFrame",!0)}setMaterial(e){var t,n;return this._modelObject.isMesh?((n=(t=this._modelObject).setMaterial)==null?void 0:n.call(t,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){var n,s;if(this._modelObject.isMesh)return(s=(n=this._modelObject).setGeometry)==null?void 0:s.call(n,e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=cl(this._modelObject,!1)),this._uiConfig}clone(){return new gh(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function __(a,e){return[a.modelObject,...a.modelObject.children].forEach(t=>{xs(t,t!==a.modelObject?a:void 0,e)}),a}class gm{constructor(){this._processors=new Map}add(e,t){var n;this._processors.has(e)||this._processors.set(e,[]),(n=this._processors.get(e))==null||n.push(t)}remove(e,t){const n=this._processors.get(e),s=(n==null?void 0:n.indexOf(t))||(n==null?void 0:n.findIndex(l=>l.process&&l.process===t.process||l.processAsync&&l.processAsync===t.processAsync));!n||!s||s<0||n.splice(s,1)}get(e){return this._processors.get(e)??[]}async process(e,t,n){var c,f;const s=this.get(e),l=t.assetType;for(const g of s)g.forAssetType===l&&(t=((c=g.process)==null?void 0:c.call(g,t,n))??t,t=await((f=g.processAsync)==null?void 0:f.call(g,t,n))??t);return t}dispose(){this._processors.clear()}}class _h extends i.hH6{load(e,t,n,s){return super.load(e,l=>{try{if(typeof l!="string")throw new Error("Invalid JSON");t==null||t(JSON.parse(l))}catch(c){s==null||s(c)}},n,s)}}class m0 extends i.yxD{constructor(e){super(e),this.type=i.cLu}parse(e){const t=function(g,y){switch(g){case 1:console.error("THREE.RGBELoader Read Error: "+(y||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(y||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(y||""));break;default:console.error("THREE.RGBELoader: Error: "+(y||""))}return-1},n=function(g,y,x){y=y||1024;let S=g.pos,C=-1,L=0,B="",W=String.fromCharCode.apply(null,new Uint16Array(g.subarray(S,S+128)));for(;0>(C=W.indexOf(`
`))&&L<y&&S<g.byteLength;)B+=W,L+=W.length,S+=128,W+=String.fromCharCode.apply(null,new Uint16Array(g.subarray(S,S+128)));return-1<C&&(x!==!1&&(g.pos+=L+C+1),B+W.slice(0,C))},s=function(g,y,x,S){const C=g[y+3],L=Math.pow(2,C-128)/255;x[S+0]=g[y+0]*L,x[S+1]=g[y+1]*L,x[S+2]=g[y+2]*L,x[S+3]=1},l=function(g,y,x,S){const C=g[y+3],L=Math.pow(2,C-128)/255;x[S+0]=i.A5E.toHalfFloat(Math.min(g[y+0]*L,65504)),x[S+1]=i.A5E.toHalfFloat(Math.min(g[y+1]*L,65504)),x[S+2]=i.A5E.toHalfFloat(Math.min(g[y+2]*L,65504)),x[S+3]=i.A5E.toHalfFloat(1)},c=new Uint8Array(e);c.pos=0;const f=function(g){const y=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,x=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,S=/^\s*FORMAT=(\S+)\s*$/,C=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,L={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let B,W;if(g.pos>=g.byteLength||!(B=n(g)))return t(1,"no header found");if(!(W=B.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(L.valid|=1,L.programtype=W[1],L.string+=B+`
`;B=n(g),B!==!1;)if(L.string+=B+`
`,B.charAt(0)!=="#"){if((W=B.match(y))&&(L.gamma=parseFloat(W[1])),(W=B.match(x))&&(L.exposure=parseFloat(W[1])),(W=B.match(S))&&(L.valid|=2,L.format=W[1]),(W=B.match(C))&&(L.valid|=4,L.height=parseInt(W[1],10),L.width=parseInt(W[2],10)),2&L.valid&&4&L.valid)break}else L.comments+=B+`
`;return 2&L.valid?4&L.valid?L:t(3,"missing image size specifier"):t(3,"missing format specifier")}(c);if(f!==-1){const g=f.width,y=f.height,x=function(S,C,L){const B=C;if(B<8||B>32767||S[0]!==2||S[1]!==2||128&S[2])return new Uint8Array(S);if(B!==(S[2]<<8|S[3]))return t(3,"wrong scanline width");const W=new Uint8Array(4*C*L);if(!W.length)return t(4,"unable to allocate buffer space");let q=0,Z=0;const j=4*B,F=new Uint8Array(4),se=new Uint8Array(j);let pe=L;for(;pe>0&&Z<S.byteLength;){if(Z+4>S.byteLength)return t(1);if(F[0]=S[Z++],F[1]=S[Z++],F[2]=S[Z++],F[3]=S[Z++],F[0]!=2||F[1]!=2||(F[2]<<8|F[3])!=B)return t(3,"bad rgbe scanline format");let be,Se=0;for(;Se<j&&Z<S.byteLength;){be=S[Z++];const Ge=be>128;if(Ge&&(be-=128),be===0||Se+be>j)return t(3,"bad scanline data");if(Ge){const Xe=S[Z++];for(let Qe=0;Qe<be;Qe++)se[Se++]=Xe}else se.set(S.subarray(Z,Z+be),Se),Se+=be,Z+=be}const Be=B;for(let Ge=0;Ge<Be;Ge++){let Xe=0;W[q]=se[Ge+Xe],Xe+=B,W[q+1]=se[Ge+Xe],Xe+=B,W[q+2]=se[Ge+Xe],Xe+=B,W[q+3]=se[Ge+Xe],q+=4}pe--}return W}(c.subarray(c.pos),g,y);if(x!==-1){let S,C,L;switch(this.type){case i.VzW:L=x.length/4;const B=new Float32Array(4*L);for(let q=0;q<L;q++)s(x,4*q,B,4*q);S=B,C=i.VzW;break;case i.cLu:L=x.length/4;const W=new Uint16Array(4*L);for(let q=0;q<L;q++)l(x,4*q,W,4*q);S=W,C=i.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:g,height:y,data:S,header:f.string,gamma:f.gamma,exposure:f.exposure,type:C}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,s){return super.load(e,function(l,c){switch(l.type){case i.VzW:case i.cLu:l.colorSpace=i.GUF,l.minFilter=i.wem,l.magFilter=i.wem,l.generateMipmaps=!1,l.flipY=!0}t&&t(l,c)},n,s)}}function Ed(a){return new Ms(class extends m0{constructor(e){super(e),this.setDataType(Hr(a.renderer.rendererObject))}},["hdr"],!1)}class Mc extends i.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Yp(t)}),this.register(function(t){return new Hs(t)}),this.register(function(t){return new y_(t)}),this.register(function(t){return new ou(t)}),this.register(function(t){return new yh(t)}),this.register(function(t){return new Kp(t)}),this.register(function(t){return new vm(t)}),this.register(function(t){return new $p(t)}),this.register(function(t){return new _m(t)}),this.register(function(t){return new Cc(t)}),this.register(function(t){return new vh(t)}),this.register(function(t){return new su(t)}),this.register(function(t){return new hl(t)}),this.register(function(t){return new Sa(t)})}load(e,t,n,s){const l=this;let c;c=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:i.Zp0.extractUrlBase(e),this.manager.itemStart(e);const f=function(y){s?s(y):console.error(y),l.manager.itemError(e),l.manager.itemEnd(e)},g=new i.hH6(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,function(y){try{l.parse(y,c,function(x){t(x),l.manager.itemEnd(e)},f,e)}catch(x){f(x)}},n,f)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s,l){let c;const f={},g={},y=new TextDecoder;if(typeof e=="string")c=JSON.parse(e);else if(e instanceof ArrayBuffer)if(y.decode(new Uint8Array(e,0,4))===zs){try{f[ts.KHR_BINARY_GLTF]=new Bu(e)}catch(S){return void(s&&s(S))}c=JSON.parse(f[ts.KHR_BINARY_GLTF].content)}else c=JSON.parse(y.decode(e));else c=e;if(c.asset===void 0||c.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const x=new b_(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});x.fileLoader.setRequestHeader(this.requestHeader);for(let S=0;S<this.pluginCallbacks.length;S++){const C=this.pluginCallbacks[S](x);g[C.name]=C,f[C.name]=!0}if(c.extensionsUsed)for(let S=0;S<c.extensionsUsed.length;++S){const C=c.extensionsUsed[S],L=c.extensionsRequired||[];switch(C){case ts.KHR_MATERIALS_UNLIT:f[C]=new v_;break;case ts.KHR_DRACO_MESH_COMPRESSION:f[C]=new Ah(c,this.dracoLoader);break;case ts.KHR_TEXTURE_TRANSFORM:f[C]=new bh;break;case ts.KHR_MESH_QUANTIZATION:f[C]=new qr;break;default:L.indexOf(C)>=0&&g[C]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+C+'".')}}x.setExtensions(f),x.setPlugins(g),x.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,l){n.parse(e,t,s,l)})}}function qp(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const ts={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class su{constructor(e){this.parser=e,this.name=ts.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const l=t[n];l.extensions&&l.extensions[this.name]&&l.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,l.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const l=t.json,c=((l.extensions&&l.extensions[this.name]||{}).lights||[])[e];let f;const g=new i.Ilk(16777215);c.color!==void 0&&g.fromArray(c.color);const y=c.range!==void 0?c.range:0;switch(c.type){case"directional":f=new i.Ox3(g),f.target.position.set(0,0,-1),f.add(f.target);break;case"point":f=new i.cek(g),f.distance=y;break;case"spot":f=new i.PMe(g),f.distance=y,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,f.angle=c.spot.outerConeAngle,f.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,f.target.position.set(0,0,-1),f.add(f.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return f.position.set(0,0,0),f.decay=2,Ma(f,c),c.intensity!==void 0&&(f.intensity=c.intensity),f.name=t.createUniqueName(c.name||"light_"+e),s=Promise.resolve(f),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],l=(s.extensions&&s.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(c){return n._getNodeRef(t.cache,l,c)})}}class v_{constructor(){this.name=ts.KHR_MATERIALS_UNLIT}getMaterialType(){return i.vBJ}extendParams(e,t,n){const s=[];e.color=new i.Ilk(1,1,1),e.opacity=1;const l=t.pbrMetallicRoughness;if(l){if(Array.isArray(l.baseColorFactor)){const c=l.baseColorFactor;e.color.fromArray(c),e.opacity=c[3]}l.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",l.baseColorTexture,i.KI_))}return Promise.all(s)}}class _m{constructor(e){this.parser=e,this.name=ts.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class Yp{constructor(e){this.parser=e,this.name=ts.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];if(c.clearcoatFactor!==void 0&&(t.clearcoat=c.clearcoatFactor),c.clearcoatTexture!==void 0&&l.push(n.assignTexture(t,"clearcoatMap",c.clearcoatTexture)),c.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=c.clearcoatRoughnessFactor),c.clearcoatRoughnessTexture!==void 0&&l.push(n.assignTexture(t,"clearcoatRoughnessMap",c.clearcoatRoughnessTexture)),c.clearcoatNormalTexture!==void 0&&(l.push(n.assignTexture(t,"clearcoatNormalMap",c.clearcoatNormalTexture)),c.clearcoatNormalTexture.scale!==void 0)){const f=c.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new i.FM8(f,f)}return Promise.all(l)}}class vh{constructor(e){this.parser=e,this.name=ts.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return c.iridescenceFactor!==void 0&&(t.iridescence=c.iridescenceFactor),c.iridescenceTexture!==void 0&&l.push(n.assignTexture(t,"iridescenceMap",c.iridescenceTexture)),c.iridescenceIor!==void 0&&(t.iridescenceIOR=c.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),c.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=c.iridescenceThicknessMinimum),c.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=c.iridescenceThicknessMaximum),c.iridescenceThicknessTexture!==void 0&&l.push(n.assignTexture(t,"iridescenceThicknessMap",c.iridescenceThicknessTexture)),Promise.all(l)}}class yh{constructor(e){this.parser=e,this.name=ts.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[];t.sheenColor=new i.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const c=s.extensions[this.name];return c.sheenColorFactor!==void 0&&t.sheenColor.fromArray(c.sheenColorFactor),c.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=c.sheenRoughnessFactor),c.sheenColorTexture!==void 0&&l.push(n.assignTexture(t,"sheenColorMap",c.sheenColorTexture,i.KI_)),c.sheenRoughnessTexture!==void 0&&l.push(n.assignTexture(t,"sheenRoughnessMap",c.sheenRoughnessTexture)),s.extras&&s.extras.sheenFactor!==void 0&&(t.sheen=s.extras.sheenFactor,delete s.extras.sheenFactor),Promise.all(l)}}class Kp{constructor(e){this.parser=e,this.name=ts.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return c.transmissionFactor!==void 0&&(t.transmission=c.transmissionFactor),c.transmissionTexture!==void 0&&l.push(n.assignTexture(t,"transmissionMap",c.transmissionTexture)),Promise.all(l)}}class vm{constructor(e){this.parser=e,this.name=ts.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];t.thickness=c.thicknessFactor!==void 0?c.thicknessFactor:0,c.thicknessTexture!==void 0&&l.push(n.assignTexture(t,"thicknessMap",c.thicknessTexture)),t.attenuationDistance=c.attenuationDistance||1/0;const f=c.attenuationColor||[1,1,1];return t.attenuationColor=new i.Ilk(f[0],f[1],f[2]),Promise.all(l)}}class $p{constructor(e){this.parser=e,this.name=ts.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Cc{constructor(e){this.parser=e,this.name=ts.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];t.specularIntensity=c.specularFactor!==void 0?c.specularFactor:1,c.specularTexture!==void 0&&l.push(n.assignTexture(t,"specularIntensityMap",c.specularTexture));const f=c.specularColorFactor||[1,1,1];return t.specularColor=new i.Ilk(f[0],f[1],f[2]),c.specularColorTexture!==void 0&&l.push(n.assignTexture(t,"specularColorMap",c.specularColorTexture,i.KI_)),Promise.all(l)}}class Hs{constructor(e){this.parser=e,this.name=ts.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const l=s.extensions[this.name],c=t.options.ktx2Loader;if(!c){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,l.source,c)}}class y_{constructor(e){this.parser=e,this.name=ts.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,l=s.textures[e];if(!l.extensions||!l.extensions[t])return null;const c=l.extensions[t],f=s.images[c.source];let g=n.textureLoader;if(f.uri){const y=n.options.manager.getHandler(f.uri);y!==null&&(g=y)}return this.detectSupport().then(function(y){if(y)return n.loadTextureImage(e,c.source,g);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ou{constructor(e){this.parser=e,this.name=ts.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,l=s.textures[e];if(!l.extensions||!l.extensions[t])return null;const c=l.extensions[t],f=s.images[c.source];let g=n.textureLoader;if(f.uri){const y=n.options.manager.getHandler(f.uri);y!==null&&(g=y)}return this.detectSupport().then(function(y){if(y)return n.loadTextureImage(e,c.source,g);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class hl{constructor(e){this.name=ts.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],l=this.parser.getDependency("buffer",s.buffer),c=this.parser.options.meshoptDecoder;if(!c||!c.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return l.then(function(f){const g=s.byteOffset||0,y=s.byteLength||0,x=s.count,S=s.byteStride,C=new Uint8Array(f,g,y);return c.decodeGltfBufferAsync?c.decodeGltfBufferAsync(x,S,C,s.mode,s.filter).then(function(L){return L.buffer}):c.ready.then(function(){const L=new ArrayBuffer(x*S);return c.decodeGltfBuffer(new Uint8Array(L),x,S,C,s.mode,s.filter),L})})}return null}}class Sa{constructor(e){this.name=ts.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const g of s.primitives)if(g.mode!==Ta.TRIANGLES&&g.mode!==Ta.TRIANGLE_STRIP&&g.mode!==Ta.TRIANGLE_FAN&&g.mode!==void 0)return null;const l=n.extensions[this.name].attributes,c=[],f={};for(const g in l)c.push(this.parser.getDependency("accessor",l[g]).then(y=>(f[g]=y,f[g])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(g=>{const y=g.pop(),x=y.isGroup?y.children:[y],S=g[0].count,C=[];for(const L of x){const B=new i.yGw,W=new i.Pa4,q=new i._fP,Z=new i.Pa4(1,1,1),j=new i.SPe(L.geometry,L.material,S);for(let F=0;F<S;F++)f.TRANSLATION&&W.fromBufferAttribute(f.TRANSLATION,F),f.ROTATION&&q.fromBufferAttribute(f.ROTATION,F),f.SCALE&&Z.fromBufferAttribute(f.SCALE,F),j.setMatrixAt(F,B.compose(W,q,Z));for(const F in f)F!=="TRANSLATION"&&F!=="ROTATION"&&F!=="SCALE"&&L.geometry.setAttribute(F,f[F]);i.Tme.prototype.copy.call(j,L),this.parser.assignFinalMaterial(j),C.push(j)}return y.isGroup?(y.clear(),y.add(...C),y):C[0]}))}}const zs="glTF";class Bu{constructor(e){this.name=ts.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==zs)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,l=new DataView(e,12);let c=0;for(;c<s;){const f=l.getUint32(c,!0);c+=4;const g=l.getUint32(c,!0);if(c+=4,g===1313821514){const y=new Uint8Array(e,12+c,f);this.content=n.decode(y)}else if(g===5130562){const y=12+c;this.body=e.slice(y,y+f)}c+=f}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ah{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ts.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,l=e.extensions[this.name].bufferView,c=e.extensions[this.name].attributes,f={},g={},y={};for(const x in c){const S=Zp[x]||x.toLowerCase();f[S]=c[x]}for(const x in e.attributes){const S=Zp[x]||x.toLowerCase();if(c[x]!==void 0){const C=n.accessors[e.attributes[x]],L=jn[C.componentType];y[S]=L.name,g[S]=C.normalized===!0}}return t.getDependency("bufferView",l).then(function(x){return new Promise(function(S){s.decodeDracoFile(x,function(C){for(const L in C.attributes){const B=C.attributes[L],W=g[L];W!==void 0&&(B.normalized=W)}S(C)},f,y)})})}}class bh{constructor(){this.name=ts.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord!==void 0&&t.texCoord!==e.channel||t.offset!==void 0||t.rotation!==void 0||t.scale!==void 0)&&(t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class qr{constructor(){this.name=ts.KHR_MESH_QUANTIZATION}}class Zl extends i._C8{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,l=e*s*3+s;for(let c=0;c!==s;c++)t[c]=n[l+c];return t}interpolate_(e,t,n,s){const l=this.resultBuffer,c=this.sampleValues,f=this.valueSize,g=2*f,y=3*f,x=s-t,S=(n-t)/x,C=S*S,L=C*S,B=e*y,W=B-y,q=-2*L+3*C,Z=L-C,j=1-q,F=Z-C+S;for(let se=0;se!==f;se++){const pe=c[W+se+f],be=c[W+se+g]*x,Se=c[B+se+f],Be=c[B+se]*x;l[se]=j*pe+F*be+q*Se+Z*Be}return l}}const Qa=new i._fP;class Vr extends Zl{interpolate_(e,t,n,s){const l=super.interpolate_(e,t,n,s);return Qa.fromArray(l).normalize().toArray(l),l}}const Ta={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},jn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Dr={9728:i.TyD,9729:i.wem,9984:i.YLQ,9985:i.qyh,9986:i.aH4,9987:i.D1R},la={33071:i.uWy,33648:i.OoA,10497:i.rpg},Jp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Zp={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},dl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},xh={CUBICSPLINE:void 0,LINEAR:i.NMF,STEP:i.Syv};function Rc(a,e,t){for(const n in t.extensions)a[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Ma(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ou(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)a.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ef(a){const e=a.extensions&&a.extensions[ts.KHR_DRACO_MESH_COMPRESSION];let t;return t=e?"draco:"+e.bufferView+":"+e.indices+":"+ym(e.attributes):a.indices+":"+ym(a.attributes)+":"+a.mode,t}function ym(a){let e="";const t=Object.keys(a).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+a[t[n]]+";";return e}function tf(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const A_=new i.yGw;class b_{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new qp,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,l=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,l=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||s&&l<98?this.textureLoader=new i.dpR(this.options.manager):this.textureLoader=new i.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new i.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,l=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(c){return c._markDefs&&c._markDefs()}),Promise.all(this._invokeAll(function(c){return c.beforeRoot&&c.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(c){const f={scene:c[0][s.scene||0],scenes:c[0],animations:c[1],cameras:c[2],asset:s.asset,parser:n,userData:{}};Rc(l,f,s),Ma(f,s),Promise.all(n._invokeAll(function(g){return g.afterRoot&&g.afterRoot(f)})).then(function(){e(f)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,l=t.length;s<l;s++){const c=t[s].joints;for(let f=0,g=c.length;f<g;f++)e[c[f]].isBone=!0}for(let s=0,l=e.length;s<l;s++){const c=e[s];c.mesh!==void 0&&(this._addNodeRef(this.meshCache,c.mesh),c.skin!==void 0&&(n[c.mesh].isSkinnedMesh=!0)),c.camera!==void 0&&this._addNodeRef(this.cameraCache,c.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),l=(c,f)=>{const g=this.associations.get(c);g!=null&&this.associations.set(f,g);for(const[y,x]of c.children.entries())l(x,f.children[y])};return l(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const l=e(t[s]);l&&n.push(l)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(l){return l.loadNode&&l.loadNode(t)});break;case"mesh":s=this._invokeOne(function(l){return l.loadMesh&&l.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(l){return l.loadBufferView&&l.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(l){return l.loadMaterial&&l.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(l){return l.loadTexture&&l.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(l){return l.loadAnimation&&l.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(l){return l!=this&&l.getDependency&&l.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e)}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(l,c){return n.getDependency(e,c)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ts.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(l,c){n.load(i.Zp0.resolveURL(t.uri,s.path),l,void 0,function(){c(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,l=t.byteOffset||0;return n.slice(l,l+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const c=Jp[s.type],f=jn[s.componentType],g=s.normalized===!0,y=new f(s.count*c);return Promise.resolve(new i.TlE(y,c,g))}const l=[];return s.bufferView!==void 0?l.push(this.getDependency("bufferView",s.bufferView)):l.push(null),s.sparse!==void 0&&(l.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),l.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(l).then(function(c){const f=c[0],g=Jp[s.type],y=jn[s.componentType],x=y.BYTES_PER_ELEMENT,S=x*g,C=s.byteOffset||0,L=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,B=s.normalized===!0;let W,q;if(L&&L!==S){const Z=Math.floor(C/L),j="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+Z+":"+s.count;let F=t.cache.get(j);F||(W=new y(f,Z*L,s.count*L/x),F=new i.vpT(W,L/x),t.cache.add(j,F)),q=new i.kB5(F,g,C%L/x,B)}else W=f===null?new y(s.count*g):new y(f,C,s.count*g),q=new i.TlE(W,g,B);if(s.sparse!==void 0){const Z=Jp.SCALAR,j=jn[s.sparse.indices.componentType],F=s.sparse.indices.byteOffset||0,se=s.sparse.values.byteOffset||0,pe=new j(c[1],F,s.sparse.count*Z),be=new y(c[2],se,s.sparse.count*g);f!==null&&(q=new i.TlE(q.array.slice(),q.itemSize,q.normalized));for(let Se=0,Be=pe.length;Se<Be;Se++){const Ge=pe[Se];if(q.setX(Ge,be[Se*g]),g>=2&&q.setY(Ge,be[Se*g+1]),g>=3&&q.setZ(Ge,be[Se*g+2]),g>=4&&q.setW(Ge,be[Se*g+3]),g>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return q})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,l=t.images[s];let c=this.textureLoader;if(l.uri){const f=n.manager.getHandler(l.uri);f!==null&&(c=f)}return this.loadTextureImage(e,s,c)}loadTextureImage(e,t,n){const s=this,l=this.json,c=l.textures[e],f=l.images[t],g=(f.uri||f.bufferView)+":"+c.sampler;if(this.textureCache[g])return this.textureCache[g];const y=this.loadImageSource(t,n).then(function(x){x.name=c.name||f.name||"",x.name===""&&typeof f.uri=="string"&&f.uri.startsWith("data:image/")===!1&&(x.name=f.uri);const S=(l.samplers||{})[c.sampler]||{};return x.magFilter=Dr[S.magFilter]||i.wem,x.minFilter=Dr[S.minFilter]||i.D1R,x.wrapS=la[S.wrapS]||i.rpg,x.wrapT=la[S.wrapT]||i.rpg,S.extras&&S.extras.uuid!==void 0&&(x.uuid=S.extras.uuid),s.associations.set(x,{textures:e}),x}).catch(function(){return null});return this.textureCache[g]=y,y}loadImageSource(e,t,n=!1,s=!1){const l=this,c=this.json,f=this.options;if(!s&&this.sourceCache[e]!==void 0)return this.sourceCache[e].then(B=>B.clone());const g=c.images[e],y=self.URL||self.webkitURL;g.uri===void 0&&g.extras&&g.extras.uri&&(g.uri=g.extras.uri);let x=g.uri||"",S=!1,C=null;if(g.bufferView===void 0||n&&x){if(g.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView")}else x=l.getDependency("bufferView",g.bufferView).then(function(B){S=!0;const W=new Blob([B],{type:g.mimeType});return x=y.createObjectURL(W),C=W,x});const L=Promise.resolve(x).then(function(B){return new Promise(function(W,q){let Z=W;t.isImageBitmapLoader===!0&&(Z=function(j){const F=new i.xEZ(j);F.needsUpdate=!0,W(F)}),t.load(i.Zp0.resolveURL(B,f.path),Z,void 0,function(j){t.isImageBitmapLoader===!0?(t=new i.dpR(l.options.manager),Z=W,t.setCrossOrigin(l.options.crossOrigin),t.setRequestHeader(l.options.requestHeader),t.load(i.Zp0.resolveURL(B,f.path),Z,void 0,q)):q(j)})})}).then(function(B){var W;if(S===!0&&y.revokeObjectURL(x),B.userData.mimeType=g.mimeType||((W=g.uri).search(/\.jpe?g($|\?)/i)>0||W.search(/^data\:image\/jpeg/)===0?"image/jpeg":W.search(/\.webp($|\?)/i)>0||W.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),B.flipY=!1,g.extras){if(g.extras.flipY!==void 0){if(t.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let q=B;const Z=g.extras.flipY&&!q.flipY;createImageBitmap(q.source.data,{imageOrientation:Z?"flipY":"none"}).then(function(j){q._newTex&&(q=q._newTex),q.source.data.close&&q.source.data.close(),q.source.data=j,q.source.needsUpdate=!0,q.needsUpdate=!0})}B.flipY=g.extras.flipY,B.needsUpdate=!0,delete g.extras.flipY}g.extras.uuid!==void 0&&(B.source.uuid=g.extras.uuid),g.extras.t_uuid!==void 0&&(B.uuid=g.extras.t_uuid)}return g.uri&&typeof g.uri=="string"&&S===!1&&!g.uri.startsWith("/")&&(B.userData.rootPath=i.Zp0.resolveURL(g.uri,f.path)),C&&(B.userData.__sourceBlob=C),!n&&g.uri&&g.uri!==x&&l.loadImageSource(e,t,!0,!0).then(function(q){B.source.data&&B.source.data.close&&B.source.data.close(),B.dispose(),B.source=q.source,B.source.needsUpdate=!0,B.needsUpdate=!0,B.uuid=q.uuid,B.flipY=q.flipY,B.userData=q.userData,B.setDirty&&B.setDirty(),q._newTex=B}),B}).catch(function(B){throw console.error("THREE.GLTFLoader: Couldn't load texture",x),B});return this.sourceCache[e]=L,L}assignTexture(e,t,n,s){const l=this;return this.getDependency("texture",n.index).then(function(c){if(!c)return null;if(n.texCoord!==void 0&&n.texCoord>0&&((c=c.clone()).channel=n.texCoord),l.extensions[ts.KHR_TEXTURE_TRANSFORM]){const f=n.extensions!==void 0?n.extensions[ts.KHR_TEXTURE_TRANSFORM]:void 0;if(f){const g=l.associations.get(c);c=l.extensions[ts.KHR_TEXTURE_TRANSFORM].extendTexture(c,f),l.associations.set(c,g)}}return s!==void 0&&(c.colorSpace=s),e[t]=c,c})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,l=t.attributes.color!==void 0,c=t.attributes.normal===void 0;if(e.isPoints){const f="PointsMaterial:"+n.uuid;let g=this.cache.get(f);g||(g=new i.UY4,i.F5T.prototype.copy.call(g,n),g.color.copy(n.color),g.map=n.map,g.sizeAttenuation=!1,this.cache.add(f,g)),n=g}else if(e.isLine){const f="LineBasicMaterial:"+n.uuid;let g=this.cache.get(f);g||(g=new i.nls,i.F5T.prototype.copy.call(g,n),g.color.copy(n.color),g.map=n.map,this.cache.add(f,g)),n=g}if(s||l||c){let f="ClonedMaterial:"+n.uuid+":";s&&(f+="derivative-tangents:"),l&&(f+="vertex-colors:"),c&&(f+="flat-shading:");let g=this.cache.get(f);g||(g=n.clone(),l&&(g.vertexColors=!0),c&&(g.flatShading=!0),s&&(g.normalScale&&(g.normalScale.y*=-1),g.clearcoatNormalScale&&(g.clearcoatNormalScale.y*=-1)),this.cache.add(f,g),this.associations.set(g,this.associations.get(n))),n=g}e.material=n}getMaterialType(){return i.Wid}loadMaterial(e){const t=this,n=this.json,s=this.extensions,l=n.materials[e];let c;const f={},g=[];if((l.extensions||{})[ts.KHR_MATERIALS_UNLIT]){const x=s[ts.KHR_MATERIALS_UNLIT];c=x.getMaterialType(),g.push(x.extendParams(f,l,t))}else{const x=l.pbrMetallicRoughness||{};if(f.color=new i.Ilk(1,1,1),f.opacity=1,Array.isArray(x.baseColorFactor)){const S=x.baseColorFactor;f.color.fromArray(S),f.opacity=S[3]}x.baseColorTexture!==void 0&&g.push(t.assignTexture(f,"map",x.baseColorTexture,i.KI_)),f.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,f.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(g.push(t.assignTexture(f,"metalnessMap",x.metallicRoughnessTexture)),g.push(t.assignTexture(f,"roughnessMap",x.metallicRoughnessTexture))),c=this._invokeOne(function(S){return S.getMaterialType&&S.getMaterialType(e)}),g.push(Promise.all(this._invokeAll(function(S){return S.extendMaterialParams&&S.extendMaterialParams(e,f)})))}l.doubleSided===!0&&(f.side=i.ehD);const y=l.alphaMode||"OPAQUE";if(y==="BLEND"?(f.transparent=!0,f.depthWrite=!1):(f.transparent=!1,y==="MASK"&&(f.alphaTest=l.alphaCutoff!==void 0?l.alphaCutoff:.5)),l.normalTexture!==void 0&&c!==i.vBJ&&(g.push(t.assignTexture(f,"normalMap",l.normalTexture)),f.normalScale=new i.FM8(1,1),l.normalTexture.scale!==void 0)){const x=l.normalTexture.scale;f.normalScale.set(x,x)}return l.occlusionTexture!==void 0&&c!==i.vBJ&&(g.push(t.assignTexture(f,"aoMap",l.occlusionTexture)),l.occlusionTexture.strength!==void 0&&(f.aoMapIntensity=l.occlusionTexture.strength)),l.emissiveFactor!==void 0&&c!==i.vBJ&&(f.emissive=new i.Ilk().fromArray(l.emissiveFactor)),l.emissiveTexture!==void 0&&c!==i.vBJ&&g.push(t.assignTexture(f,"emissiveMap",l.emissiveTexture,i.KI_)),Promise.all(g).then(function(){const x=new c(f);return l.name&&(x.name=l.name),Ma(x,l),t.associations.set(x,{materials:e}),l.extensions&&Rc(s,x,l),x})}createUniqueName(e){const t=i.iUV.sanitizeNodeName(e||"");let n=t;for(let s=1;this.nodeNamesUsed[n];++s)n=t+"_"+s;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function l(f){return n[ts.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(f,t).then(function(g){return Ca(g,f,t)})}const c=[];for(let f=0,g=e.length;f<g;f++){const y=e[f],x=ef(y),S=s[x];if(S)c.push(S.promise);else{let C;C=y.extensions&&y.extensions[ts.KHR_DRACO_MESH_COMPRESSION]?l(y):Ca(new i.u9r,y,t),s[x]={primitive:y,promise:C},c.push(C)}}return Promise.all(c)}loadMesh(e){const t=this,n=this.json,s=this.extensions,l=n.meshes[e],c=l.primitives,f=[];for(let y=0,x=c.length;y<x;y++){const S=c[y].material===void 0?((g=this.cache).DefaultMaterial===void 0&&(g.DefaultMaterial=new i.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.Wl3})),g.DefaultMaterial):this.getDependency("material",c[y].material);f.push(S)}var g;return f.push(t.loadGeometries(c)),Promise.all(f).then(function(y){const x=y.slice(0,y.length-1),S=y[y.length-1],C=[];for(let B=0,W=S.length;B<W;B++){const q=S[B],Z=c[B];let j;const F=x[B];if(Z.mode===Ta.TRIANGLES||Z.mode===Ta.TRIANGLE_STRIP||Z.mode===Ta.TRIANGLE_FAN||Z.mode===void 0)j=l.isSkinnedMesh===!0?new i.TUv(q,F):new i.Kj0(q,F),j.isSkinnedMesh===!0&&j.normalizeSkinWeights(),Z.mode===Ta.TRIANGLE_STRIP?j.geometry=ue(j.geometry,i.UlW):Z.mode===Ta.TRIANGLE_FAN&&(j.geometry=ue(j.geometry,i.z$h));else if(Z.mode===Ta.LINES)j=new i.ejS(q,F);else if(Z.mode===Ta.LINE_STRIP)j=new i.x12(q,F);else if(Z.mode===Ta.LINE_LOOP)j=new i.blk(q,F);else{if(Z.mode!==Ta.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+Z.mode);j=new i.woe(q,F)}Object.keys(j.geometry.morphAttributes).length>0&&Ou(j,l),j.name=t.createUniqueName(l.name||"mesh_"+e),j.geometry&&l.extras&&l.extras.isGeometryUserData?(Ma(j.geometry,l),Z.extensions&&Rc(s,j.geometry,Z)):(Ma(j,l),Z.extensions&&Rc(s,j,Z)),t.assignFinalMaterial(j),C.push(j)}l.extensions&&C.forEach(B=>Rc(s,B,l));for(let B=0,W=C.length;B<W;B++)t.associations.set(C[B],{meshes:e,primitives:B});if(C.length===1)return C[0];const L=new i.ZAu;t.associations.set(L,{meshes:e});for(let B=0,W=C.length;B<W;B++)L.add(C[B]);return L})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(s)return n.type==="perspective"?t=new i.cPb(i.M8C.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new i.iKG(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Ma(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,l=t.joints.length;s<l;s++)n.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const l=s.pop(),c=s,f=[],g=[];for(let y=0,x=c.length;y<x;y++){const S=c[y];if(S){f.push(S);const C=new i.yGw;l!==null&&C.fromArray(l.array,16*y),g.push(C)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[y])}return new i.OdW(f,g)})}loadAnimation(e){const t=this.json.animations[e],n=t.name?t.name:"animation_"+e,s=[],l=[],c=[],f=[],g=[];for(let y=0,x=t.channels.length;y<x;y++){const S=t.channels[y],C=t.samplers[S.sampler],L=S.target,B=L.node,W=t.parameters!==void 0?t.parameters[C.input]:C.input,q=t.parameters!==void 0?t.parameters[C.output]:C.output;L.node!==void 0&&(s.push(this.getDependency("node",B)),l.push(this.getDependency("accessor",W)),c.push(this.getDependency("accessor",q)),f.push(C),g.push(L))}return Promise.all([Promise.all(s),Promise.all(l),Promise.all(c),Promise.all(f),Promise.all(g)]).then(function(y){const x=y[0],S=y[1],C=y[2],L=y[3],B=y[4],W=[];for(let q=0,Z=x.length;q<Z;q++){const j=x[q],F=S[q],se=C[q],pe=L[q],be=B[q];if(j===void 0)continue;let Se;switch(j.updateMatrix(),dl[be.path]){case dl.weights:Se=i.dUE;break;case dl.rotation:Se=i.iLg;break;default:Se=i.yC1}const Be=j.name?j.name:j.uuid,Ge=pe.interpolation!==void 0?xh[pe.interpolation]:i.NMF,Xe=[];dl[be.path]===dl.weights?j.traverse(function(at){at.morphTargetInfluences&&Xe.push(at.name?at.name:at.uuid)}):Xe.push(Be);let Qe=se.array;if(se.normalized){const at=tf(Qe.constructor),Ke=new Float32Array(Qe.length);for(let Je=0,ft=Qe.length;Je<ft;Je++)Ke[Je]=Qe[Je]*at;Qe=Ke}for(let at=0,Ke=Xe.length;at<Ke;at++){const Je=new Se(Xe[at]+"."+dl[be.path],F.array,Qe,Ge);pe.interpolation==="CUBICSPLINE"&&(Je.createInterpolant=function(ft){return new(this instanceof i.iLg?Vr:Zl)(this.times,this.values,this.getValueSize()/3,ft)},Je.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),W.push(Je)}}return new i.m7l(n,void 0,W)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(l){const c=n._getNodeRef(n.meshCache,s.mesh,l);return s.weights!==void 0&&c.traverse(function(f){if(f.isMesh)for(let g=0,y=s.weights.length;g<y;g++)f.morphTargetInfluences[g]=s.weights[g]}),c})}loadNode(e){const t=this,n=this.json.nodes[e],s=t._loadNodeShallow(e),l=[],c=n.children||[];for(let g=0,y=c.length;g<y;g++)l.push(t.getDependency("node",c[g]));const f=n.skin===void 0?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([s,Promise.all(l),f]).then(function(g){const y=g[0],x=g[1],S=g[2];S!==null&&y.traverse(function(C){C.isSkinnedMesh&&C.bind(S,A_)});for(let C=0,L=x.length;C<L;C++)y.add(x[C]);return y})}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const l=t.nodes[e],c=l.name?s.createUniqueName(l.name):"",f=[],g=s._invokeOne(function(y){return y.createNodeMesh&&y.createNodeMesh(e)});return g&&f.push(g),l.camera!==void 0&&f.push(s.getDependency("camera",l.camera).then(function(y){return s._getNodeRef(s.cameraCache,l.camera,y)})),s._invokeAll(function(y){return y.createNodeAttachment&&y.createNodeAttachment(e)}).forEach(function(y){f.push(y)}),this.nodeCache[e]=Promise.all(f).then(function(y){let x;if(x=l.isBone===!0?new i.N$j:y.length>1?new i.ZAu:y.length===1?y[0]:new i.Tme,x!==y[0])for(let S=0,C=y.length;S<C;S++)x.add(y[S]);if(l.name&&(x.userData.name=l.name,x.name=c),Ma(x,l),l.extensions&&Rc(n,x,l),l.matrix!==void 0){const S=new i.yGw;S.fromArray(l.matrix),x.applyMatrix4(S)}else l.translation!==void 0&&x.position.fromArray(l.translation),l.rotation!==void 0&&x.quaternion.fromArray(l.rotation),l.scale!==void 0&&x.scale.fromArray(l.scale);return s.associations.has(x)||s.associations.set(x,{}),s.associations.get(x).nodes=e,x}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,l=new i.ZAu;n.name&&(l.name=s.createUniqueName(n.name)),Ma(l,n),n.extensions&&Rc(t,l,n);const c=n.nodes||[],f=[];for(let g=0,y=c.length;g<y;g++)f.push(s.getDependency("node",c[g]));return Promise.all(f).then(function(g){for(let y=0,x=g.length;y<x;y++)l.add(g[y]);return s.associations=(y=>{const x=new Map;for(const[S,C]of s.associations)(S instanceof i.F5T||S instanceof i.xEZ)&&x.set(S,C);return y.traverse(S=>{const C=s.associations.get(S);C!=null&&x.set(S,C)}),x})(l),l})}}function Ca(a,e,t){const n=e.attributes,s=[];function l(c,f){return t.getDependency("accessor",c).then(function(g){a.setAttribute(f,g)})}for(const c in n){const f=Zp[c]||c.toLowerCase();f in a.attributes||s.push(l(n[c],f))}if(e.indices!==void 0&&!a.index){const c=t.getDependency("accessor",e.indices).then(function(f){a.setIndex(f)});s.push(c)}return Ma(a,e),function(c,f,g){const y=f.attributes,x=new i.ZzF;if(y.POSITION===void 0)return;{const L=g.json.accessors[y.POSITION],B=L.min,W=L.max;if(B===void 0||W===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(x.set(new i.Pa4(B[0],B[1],B[2]),new i.Pa4(W[0],W[1],W[2])),L.normalized){const q=tf(jn[L.componentType]);x.min.multiplyScalar(q),x.max.multiplyScalar(q)}}const S=f.targets;if(S!==void 0){const L=new i.Pa4,B=new i.Pa4;for(let W=0,q=S.length;W<q;W++){const Z=S[W];if(Z.POSITION!==void 0){const j=g.json.accessors[Z.POSITION],F=j.min,se=j.max;if(F!==void 0&&se!==void 0){if(B.setX(Math.max(Math.abs(F[0]),Math.abs(se[0]))),B.setY(Math.max(Math.abs(F[1]),Math.abs(se[1]))),B.setZ(Math.max(Math.abs(F[2]),Math.abs(se[2]))),j.normalized){const pe=tf(jn[j.componentType]);B.multiplyScalar(pe)}L.max(B)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}x.expandByVector(L)}c.boundingBox=x;const C=new i.aLr;x.getCenter(C.center),C.radius=x.min.distanceTo(x.max)/2,c.boundingSphere=C}(a,e,t),Promise.all(s).then(function(){return e.targets!==void 0?function(c,f,g){let y=!1,x=!1,S=!1;for(let W=0,q=f.length;W<q;W++){const Z=f[W];if(Z.POSITION!==void 0&&(y=!0),Z.NORMAL!==void 0&&(x=!0),Z.COLOR_0!==void 0&&(S=!0),y&&x&&S)break}if(!y&&!x&&!S)return Promise.resolve(c);const C=[],L=[],B=[];for(let W=0,q=f.length;W<q;W++){const Z=f[W];if(y){const j=Z.POSITION!==void 0?g.getDependency("accessor",Z.POSITION):c.attributes.position;C.push(j)}if(x){const j=Z.NORMAL!==void 0?g.getDependency("accessor",Z.NORMAL):c.attributes.normal;L.push(j)}if(S){const j=Z.COLOR_0!==void 0?g.getDependency("accessor",Z.COLOR_0):c.attributes.color;B.push(j)}}return Promise.all([Promise.all(C),Promise.all(L),Promise.all(B)]).then(function(W){const q=W[0],Z=W[1],j=W[2];return y&&(c.morphAttributes.position=q),x&&(c.morphAttributes.normal=Z),S&&(c.morphAttributes.color=j),c.morphTargetsRelative=!0,c})}(a,e.targets,t):a})}class au extends Mc{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(Sd)}async preparse(e,t){for(const n of this.preparsers)e=await n.process(e,t);return e}parse(e,t,n,s,l){this.preparse.call(this,e,l||t).then(c=>c?super.parse(c,t,n,s):s&&s(new ErrorEvent("no data"))).catch(c=>{console.error(c),s&&s(c??new ErrorEvent("unknown error"))})}transform(e,t){const n=e?e.scene||(e.scenes&&e.scenes.length>0?e.scenes[0]:void 0):void 0;return n&&e.animations.length>0&&(n.animations=e.animations),n==null||n.traverse(s=>{s.userData.gltfUUID&&(s.uuid=s.userData.gltfUUID,delete s.userData.gltfUUID)}),n}register(e){return super.register(e)}}const Sd={key:(a,e,t)=>a.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+t)||"",async process(a,e){var g;if(typeof a=="string"||!new TextDecoder().decode(new Uint8Array(a,0,100)).includes("WebGiGLBWrapper"))return a;const t=new Bu(a),n=JSON.parse(t.content||"{}");let s=t.body||a;const l=(g=n.asset)==null?void 0:g.encryption;if(!l)return s;const c=l.type,f=l.version;if(c==="aesgcm"&&f===1){const y=await(0,r.getOrCall)(this.key,l,n,e)||"";try{s=(await(0,r.aesGcmDecrypt)(new Uint8Array(s),y)).buffer}catch{throw new ErrorEvent("decryption error")}}return s}};class Ic extends i.hH6{constructor(e){super(e),this.type=i.cLu}async loadAsync(e,t){const n=await this.parseAsync(e,t,!1),s=new i.IEO(n.data,n.width,n.height,i.wk1,this.type);return s.needsUpdate=!0,s.flipY=!0,s.colorSpace=i.KI_,s.minFilter=i.wem,s.magFilter=i.wem,s.source.data.complete=!0,s}async parseAsync(e,t,n=!1){let s=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const g=await super.loadAsync(e,t);e=URL.createObjectURL(g),s=!0}const l=await(0,r.imageUrlToImageData)(e);s&&URL.revokeObjectURL(e);let c=Uint8Array;return this.type===i.cLu?c=Uint16Array:this.type===i.VzW&&(c=Uint32Array),{data:function(g,y=3,x=Uint16Array,S=!1){let C;const L=g.byteLength>>2,B=new x(L*y);for(let W=0;W<L;W++)C=Math.pow(2,g[4*W+3]-136),S?(B[W*y]=Math.min(g[4*W]*C,65504),B[W*y+1]=Math.min(g[4*W+1]*C,65504),B[W*y+2]=Math.min(g[4*W+2]*C,65504)):(B[W*y]=i.A5E.toHalfFloat(Math.min(g[4*W]*C,65504)),B[W*y+1]=i.A5E.toHalfFloat(Math.min(g[4*W+1]*C,65504)),B[W*y+2]=i.A5E.toHalfFloat(Math.min(g[4*W+2]*C,65504))),y===4&&(B[W*y+3]=i.A5E.toHalfFloat(1));return B}(l.data,4,c,n),width:l.width,height:l.height}}setDataType(e){return this.type=e,this}}class lu extends i.Gql{constructor(e){super(e),this._imageLoader=new i.S3k(e)}static async LoadRootPathTextures(e,t,n,s=!0){var c;const l=[];for(const f of Array.isArray(e)?e:Object.values(e??{})){const g=(c=f==null?void 0:f.userData)==null?void 0:c.rootPath,y=s&&f.image&&t[f.image];if(!g)continue;const x=n.importPath(g,{processImported:!1}).then(S=>{const C=S==null?void 0:S[0],L=C==null?void 0:C.source;if(!C||!L)return null;const B=new i.Hw6(L.data);return f.image&&(B.uuid=f.image),f.image=B.uuid,y||(t[B.uuid]=B),C.dispose(),B}).catch(S=>(console.error(S),delete f.userData.rootPath,null));y?f.rootPathPromise=x:l.push(x)}await Promise.allSettled(l)}parseTextures2(e,t,n){var c,f;for(const g of e){const y=(c=g==null?void 0:g.userData)==null?void 0:c.rootPath;if(y&&(!g.image||!t[g.image])){const x=new i.Hw6(this._imageLoader.load(y,n));if(!x)continue;g.image&&(x.uuid=g.image),t[x.uuid]=x,g.image=x.uuid}g.userData=ui(g.userData,void 0,!1,{images:t})}const s=super.parseTextures(e,t),l={...s};for(const g of e)(f=g.rootPathPromise)==null||f.then(y=>{if(!y)return;const x=l[g.uuid];x.dispose(),x.source=y,x.source.needsUpdate=!0,x.needsUpdate=!0});return s}parseMaterials2(e,t,n){const s={};return e.forEach(l=>{if(!l)return;const c={...l},f=Object.keys(c);for(const y of f)if(y==="map"||y.endsWith("Map")){const x=c[y];typeof x=="string"&&(t[x]?c[y]=t[x]:(console.warn(`Texture ${x} not found`),delete c[y]))}c.userData&&(c.userData=ui(c.userData,void 0,!1,{textures:t}),c.userData.cloneId&&c.userData.uuid!==l.uuid&&(c.userData.uuid=l.uuid));const g=n.generateFromTemplateType(c.type,c);g&&(s[l.uuid]=g)}),s}}const Ra="WEBGI_viewer";function Vs(a){return new Ms(au,["gltf","glb","data:model/gltf"],!0,(e,t)=>{if(!e)return e;const n=e,s=new lu(t.loadingManager);return n.register(nf(s,a)),n.register(Am()),n.register(g0(s)),n.register(l=>new ec(l)),n.register(l=>new Pc(l)),n.register(l=>new Rl(l)),n.register(l=>new tc(l)),n.register(l=>{var S,C,L,B,W,q,Z,j,F;const c=mn()+".drc",f=mn()+".ktx2",g=(L=(C=(S=l.json)==null?void 0:S.extensionsRequired)==null?void 0:C.includes)==null?void 0:L.call(C,"KHR_draco_mesh_compression");if(g){const se=t.registerFile(c);se&&n.setDRACOLoader(se)}((q=(W=(B=l.json)==null?void 0:B.extensionsUsed)==null?void 0:W.includes)==null?void 0:q.call(W,"EXT_meshopt_compression"))&&(window.MeshoptDecoder?(n.setMeshoptDecoder(window.MeshoptDecoder),l.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const x=(F=(j=(Z=l.json)==null?void 0:Z.extensionsUsed)==null?void 0:j.includes)==null?void 0:F.call(j,"KHR_texture_basisu");if(x){const se=t.registerFile(f);se&&(n.setKTX2Loader(se),l.options.ktx2Loader=se)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async se=>{g&&t.unregisterFile(c),x&&t.unregisterFile(f);const pe=await Td(l,a,s);se.scene&&(se.scene.__importedViewerConfig=pe)}}}),n})}const Yr="WEBGI_light_extras",vo="WEBGI_object3d_extras",ca="WEBGI_material_extras",Am=a=>e=>({name:"__"+vo,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(s=>{var f,g;if(!s.isObject3D)return;const l=(g=(f=s.userData)==null?void 0:f.gltfExtensions)==null?void 0:g[vo];if(!l)return void(s.isLight&&!s.isAmbientLight&&(s.castShadow=!0));const c=l.castShadow!==void 0||l.receiveShadow!==void 0;l.castShadow!==void 0&&(s.castShadow=l.castShadow),l.receiveShadow!==void 0&&(s.receiveShadow=l.receiveShadow),l.visible!==void 0&&(s.visible=l.visible),l.frustumCulled!==void 0&&(s.frustumCulled=l.frustumCulled),l.renderOrder!==void 0&&(s.renderOrder=l.renderOrder),l.layers!==void 0&&(s.layers.mask=l.layers),c&&(s.userData.__keepShadowDef=!0),delete s.userData.gltfExtensions[vo]})})}}),nf=(a,e)=>t=>({name:"__"+ca,afterRoot:async n=>{var l,c,f;const s=n.scenes||(n.scene?[n.scene]:[]);for(const g of s){const y=(c=(l=g.userData)==null?void 0:l.gltfExtensions)==null?void 0:c[ca],x=y&&await((f=e.getPlugin(ri))==null?void 0:f.importConfigResources(y.resources||{}))||{};g.traverse(S=>{var B,W;const C=S==null?void 0:S.material;if(!(C!=null&&C.isMaterial))return;const L=(W=(B=C.userData)==null?void 0:B.gltfExtensions)==null?void 0:W[ca];L&&(L.emissiveIntensity!==void 0&&(C.emissiveIntensity=L.emissiveIntensity),L.fog!==void 0&&(C.fog=L.fog),L.flatShading!==void 0&&(C.flatShading=L.flatShading),L.blending!==void 0&&(C.blending=L.blending),L.side!==void 0&&(C.side=L.side),L.shadowSide!==void 0&&(C.shadowSide=L.shadowSide),L.depthFunc!==void 0&&(C.depthFunc=L.depthFunc),L.depthTest!==void 0&&(C.depthTest=L.depthTest),L.depthWrite!==void 0&&(C.depthWrite=L.depthWrite),L.colorWrite!==void 0&&(C.colorWrite=L.colorWrite),L.vertexColors!==void 0&&(C.vertexColors=L.vertexColors),L.alphaTest!==void 0&&(C.alphaTest=L.alphaTest),L.wireframe!==void 0&&(C.wireframe=L.wireframe),L.wireframeLinewidth!==void 0&&(C.wireframeLinewidth=L.wireframeLinewidth),L.wireframeLinecap!==void 0&&(C.wireframeLinecap=L.wireframeLinecap),L.wireframeLinejoin!==void 0&&(C.wireframeLinejoin=L.wireframeLinejoin),L.rotation!==void 0&&(C.rotation=L.rotation),L.polygonOffset!==void 0&&(C.polygonOffset=L.polygonOffset),L.polygonOffsetFactor!==void 0&&(C.polygonOffsetFactor=L.polygonOffsetFactor),L.polygonOffsetUnits!==void 0&&(C.polygonOffsetUnits=L.polygonOffsetUnits),L.dithering!==void 0&&(C.dithering=L.dithering),L.alphaToCoverage!==void 0&&(C.alphaToCoverage=L.alphaToCoverage),L.premultipliedAlpha!==void 0&&(C.premultipliedAlpha=L.premultipliedAlpha),L.toneMapped!==void 0&&(C.toneMapped=L.toneMapped),L.normalScale!==void 0&&C.normalScale!==void 0&&(Array.isArray(L.normalScale)?C.normalScale.fromArray(L.normalScale):typeof L.normalScale=="number"?C.normalScale.set(L.normalScale,L.normalScale):e.console.warn("normalScale is not an array or number",L.normalScale)),L.reflectivity!==void 0&&(C.reflectivity=L.reflectivity),Object.entries(L).forEach(([q,Z])=>{q.startsWith("_")||Z&&Z.resource&&typeof Z.resource=="string"&&(C[q]=ui(Z,C[q],!1,x))}),delete C.userData.gltfExtensions[ca])}),y&&delete g.userData.gltfExtensions[ca]}}}),g0=a=>e=>({name:"__"+Yr,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(s=>{var c,f;if(!s.isLight)return;const l=(f=(c=s.userData)==null?void 0:c.gltfExtensions)==null?void 0:f[Yr];l&&(!s.shadow&&l.shadow&&console.error("Light has no shadow, cannot import",s,l),l.shadow&&s.shadow&&(l.shadow.bias!==void 0&&(s.shadow.bias=l.shadow.bias),l.shadow.normalBias!==void 0&&(s.shadow.normalBias=l.shadow.normalBias),l.shadow.radius!==void 0&&(s.shadow.radius=l.shadow.radius),l.shadow.mapSize!==void 0&&s.shadow.mapSize.fromArray(l.shadow.mapSize),l.shadow.camera!==void 0&&(s.shadow.camera=a.parseObject(l.shadow.camera))),delete s.userData.gltfExtensions[Yr])})})}});async function Td(a,e,t,n){var g,y,x;if(!n){const S=a.json.scenes||[];if(S.length!==1){for(const C of S)await Td(a,e,t,C);return}n=S[0]}const s=(g=n.extensions)==null?void 0:g[Ra];if(!s)return;const l=[];Object.values(s.resources).forEach(S=>{Object.values(S).forEach(C=>{C.url&&(C.url.type==="Uint16Array"&&C.url.data&&l.push(C.url),C.url.type==="Uint8Array"&&C.url.data&&l.push(C.url))})});for(const S of l){const C=S.data.image,L=a.json.images[C],B=await a.getDependency("bufferView",L.bufferView);if(L.mimeType.startsWith("image/")&&S.type==="Uint16Array"&&S.encoding==="rgbe"){const W=new Blob([B]);let q=URL.createObjectURL(W);(S.encodingVersion||1)<2&&(q="data:image/png;base64,"+btoa(await W.text())),S.data=(await new Ic().parseAsync(q,void 0,!0)).data,URL.revokeObjectURL(q),delete S.encoding,delete S.encodingVersion}else S.data=B}const c={textures:{},materials:{}},f=s.resources;if(f.textures&&a.json.textures)for(const[S,C]of[...Object.entries(f.textures)]){if(C.uuid||!S)continue;delete f.textures[S];const L=a.json.textures.findIndex(B=>{var W,q,Z,j,F,se,pe;return((W=B.extras)==null?void 0:W.uuid)===S||((j=(Z=(q=a.json.samplers)==null?void 0:q[B.sampler])==null?void 0:Z.extras)==null?void 0:j.uuid)===S||((pe=(se=(F=a.json.images)==null?void 0:F[B.source])==null?void 0:se.extras)==null?void 0:pe.t_uuid)===S});L>=0&&(c.textures[S]=await a.getDependency("texture",L))}if(f.materials&&a.json.materials)for(const[S,C]of[...Object.entries(f.materials)]){if(C.uuid||!S)continue;delete f.materials[S];const L=a.json.materials.findIndex(B=>{var W;return((W=B.extras)==null?void 0:W.uuid)===S});L>=0&&(c.materials[S]=await a.getDependency("material",L),c.materials[S]=(x=(y=e.getPlugin(ri))==null?void 0:y.materials)==null?void 0:x.processMaterial(c.materials[S],{}))}return s.resources=await e.getPlugin(ri).importConfigResources(f||{},t,c),s}const No="WEBGI_materials_bumpmap",At="WEBGI_materials_displacementmap",wh="WEBGI_materials_alphamap",Eh="WEBGI_materials_lightmap";class ec{constructor(e){this.parser=e,this.name=No}async extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return c.bumpScale!==void 0&&(t.bumpScale=c.bumpScale),c.bumpTexture!==void 0&&l.push(n.assignTexture(t,"bumpMap",c.bumpTexture)),Promise.all(l)}}class Pc{constructor(e){this.parser=e,this.name=At}async extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return c.displacementScale!==void 0&&(t.displacementScale=c.displacementScale),c.displacementBias!==void 0&&(t.displacementBias=c.displacementBias),c.displacementTexture!==void 0&&l.push(n.assignTexture(t,"displacementMap",c.displacementTexture)),Promise.all(l)}}class Rl{constructor(e){this.parser=e,this.name=Eh}async extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return c.lightMapIntensity!==void 0&&(t.lightMapIntensity=c.lightMapIntensity),c.lightMapTexture!==void 0&&l.push(n.assignTexture(t,"lightMap",c.lightMapTexture)),Promise.all(l)}}class tc{constructor(e){this.parser=e,this.name=wh}async extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];return c.alphaTexture!==void 0&&l.push(n.assignTexture(t,"alphaMap",c.alphaTexture)),Promise.all(l)}}var Nu=__webpackgi_require__(23);function ku(){return new Ms(Nu.Q,["drc"],!0)}class Ia extends i.Ox3{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new i.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,s=e.userData;return e.userData={},super.copy(e,t),co(this.userData,s),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const s=super.toJSON(e);return s.userData=kn(co({},t),!1),this.userData={},this.children=n,s.type="DirectionalLight2",s.target=this.target.position.toArray(),Object.assign(s,kn(this,!0,e))}fromJSON(e,t){if(e.type!=="DirectionalLight2")return null;const n=e.target,s=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,ui(e,this,!0,t),n&&(e.target=n),s&&(s.color!==void 0&&this.color.set(s.color),s.intensity!==void 0&&(this.intensity=s.intensity),e.object=s),this}}class Dc extends i.PMe{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,s,l,c){super(e,t,n,s,l,c),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,s=e.userData;return e.userData={},super.copy(e,t),co(this.userData,s),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const s=super.toJSON(e);return s.userData=kn(co({},t),!1),this.userData={},this.children=n,s.type="SpotLight2",s.target=this.target.position.toArray(),Object.assign(s,kn(this,!0,e))}fromJSON(e,t){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),ui(e,this,!0,t),this):this)}}class Lc extends i.cek{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,s){super(e,t,n,s),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),co(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=kn(co({},t),!1),this.userData={},n.type="PointLight2",Object.assign(n,kn(this,!0,e))}fromJSON(e,t){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),ui(e,this,!0,t),this):this}}class nc extends i.Mig{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(e,t),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),co(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=kn(co({},t),!1),this.userData={},n.type="AmbientLight2",Object.assign(n,kn(this,!0,e))}fromJSON(e,t){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),ui(e,this,!0,t),this):this}}class Md extends i.aNw{load(e,t,n,s){const l=new i.hH6(this.manager);l.setPath(this.path),l.setResponseType("text"),l.load(e,c=>{try{t(this.parse(c))}catch(f){s?s(f):console.error(f),this.manager.itemError(e)}},n,s)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,n=null;const s=new i.Pa4(0,0,0),l=new i.Pa4(1,1,1),c=e.split(/[\n\r]+/g);let f=null,g=0;for(let S=0,C=c.length;S<C;S++){const L=c[S].trim(),B=L.split(/\s/g);switch(B[0]){case"TITLE":t=L.substring(7,L.length-1);break;case"LUT_3D_SIZE":const W=B[1];n=parseFloat(W),f=new Uint8Array(n*n*n*4);break;case"DOMAIN_MIN":s.x=parseFloat(B[1]),s.y=parseFloat(B[2]),s.z=parseFloat(B[3]);break;case"DOMAIN_MAX":l.x=parseFloat(B[1]),l.y=parseFloat(B[2]),l.z=parseFloat(B[3]);break;default:const q=parseFloat(B[0]),Z=parseFloat(B[1]),j=parseFloat(B[2]);if(q>1||q<0||Z>1||Z<0||j>1||j<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");f[g+0]=255*q,f[g+1]=255*Z,f[g+2]=255*j,f[g+3]=255,g+=4}}const y=new i.IEO;y.image.data=f,y.image.width=n,y.image.height=n*n,y.type=i.ywz,y.magFilter=i.wem,y.minFilter=i.wem,y.wrapS=i.uWy,y.wrapT=i.uWy,y.generateMipmaps=!1,y.needsUpdate=!0;const x=new i.JUT;return x.image.data=f,x.image.width=n,x.image.height=n,x.image.depth=n,x.type=i.ywz,x.magFilter=i.wem,x.minFilter=i.wem,x.wrapS=i.uWy,x.wrapT=i.uWy,x.wrapR=i.uWy,x.generateMipmaps=!1,x.needsUpdate=!0,{title:t,size:n,domainMin:s,domainMax:l,texture:y,texture3D:x}}}let cu=class{constructor({domainMax:a,domainMin:e,size:t,texture:n,texture3D:s,title:l}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=a,this.domainMin=e,this.size=t,this.texture=n,this.texture3D=s,this.title=l,this.uuid=$(),this.userData.__needsSourceBuffer=!0}fromJSON(a,e){return a.type!==this.type&&console.warn("type mismatch while import",a,this),console.error("not supported"),this}toJSON(a){return wr(this,a,this.texture.name)}};cu=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c}([Pr("LUTCubeTextureWrapper")],cu);class rf extends Md{parse(e){const t=super.parse(e);return new cu(t)}}var uu={},jr=Uint8Array,So=Uint16Array,pl=Uint32Array,hu=new jr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ko=new jr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Xa=new jr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sf=function(a,e){for(var t=new So(31),n=0;n<31;++n)t[n]=e+=1<<a[n-1];var s=new pl(t[30]);for(n=1;n<30;++n)for(var l=t[n];l<t[n+1];++l)s[l]=l-t[n]<<5|n;return[t,s]},Uu=sf(hu,2),ic=Uu[0],Sh=Uu[1];ic[28]=258,Sh[258]=28;for(var Cd=sf(ko,0),of=Cd[0],Bc=Cd[1],Sr=new So(32768),ds=0;ds<32768;++ds){var Uo=(43690&ds)>>>1|(21845&ds)<<1;Uo=(61680&(Uo=(52428&Uo)>>>2|(13107&Uo)<<2))>>>4|(3855&Uo)<<4,Sr[ds]=((65280&Uo)>>>8|(255&Uo)<<8)>>>1}var fl=function(a,e,t){for(var n=a.length,s=0,l=new So(e);s<n;++s)++l[a[s]-1];var c,f=new So(e);for(s=0;s<e;++s)f[s]=f[s-1]+l[s-1]<<1;if(t){c=new So(1<<e);var g=15-e;for(s=0;s<n;++s)if(a[s])for(var y=s<<4|a[s],x=e-a[s],S=f[a[s]-1]++<<x,C=S|(1<<x)-1;S<=C;++S)c[Sr[S]>>>g]=y}else for(c=new So(n),s=0;s<n;++s)a[s]&&(c[s]=Sr[f[a[s]-1]++]>>>15-a[s]);return c},Oc=new jr(288);for(ds=0;ds<144;++ds)Oc[ds]=8;for(ds=144;ds<256;++ds)Oc[ds]=9;for(ds=256;ds<280;++ds)Oc[ds]=7;for(ds=280;ds<288;++ds)Oc[ds]=8;var qa=new jr(32);for(ds=0;ds<32;++ds)qa[ds]=5;var ml=fl(Oc,9,0),ua=fl(Oc,9,1),bm=fl(qa,5,0),Rd=fl(qa,5,1),Nc=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},Zo=function(a,e,t){var n=e/8|0;return(a[n]|a[n+1]<<8)>>(7&e)&t},af=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(7&e)},Ya=function(a){return(a/8|0)+(7&a&&1)},To=function(a,e,t){(e==null||e<0)&&(e=0),(t==null||t>a.length)&&(t=a.length);var n=new(a instanceof So?So:a instanceof pl?pl:jr)(t-e);return n.set(a.subarray(e,t)),n},Mo=function(a,e,t){var n=a.length;if(!n||t&&!t.l&&n<5)return e||new jr(0);var s=!e||t,l=!t||t.i;t||(t={}),e||(e=new jr(3*n));var c=function(bi){var Bi=e.length;if(bi>Bi){var Br=new jr(Math.max(2*Bi,bi));Br.set(e),e=Br}},f=t.f||0,g=t.p||0,y=t.b||0,x=t.l,S=t.d,C=t.m,L=t.n,B=8*n;do{if(!x){t.f=f=Zo(a,g,1);var W=Zo(a,g+1,3);if(g+=3,!W){var q=a[(Qe=Ya(g)+4)-4]|a[Qe-3]<<8,Z=Qe+q;if(Z>n){if(l)throw"unexpected EOF";break}s&&c(y+q),e.set(a.subarray(Qe,Z),y),t.b=y+=q,t.p=g=8*Z;continue}if(W==1)x=ua,S=Rd,C=9,L=5;else{if(W!=2)throw"invalid block type";var j=Zo(a,g,31)+257,F=Zo(a,g+10,15)+4,se=j+Zo(a,g+5,31)+1;g+=14;for(var pe=new jr(se),be=new jr(19),Se=0;Se<F;++Se)be[Xa[Se]]=Zo(a,g+3*Se,7);g+=3*F;var Be=Nc(be),Ge=(1<<Be)-1,Xe=fl(be,Be,1);for(Se=0;Se<se;){var Qe,at=Xe[Zo(a,g,Ge)];if(g+=15&at,(Qe=at>>>4)<16)pe[Se++]=Qe;else{var Ke=0,Je=0;for(Qe==16?(Je=3+Zo(a,g,3),g+=2,Ke=pe[Se-1]):Qe==17?(Je=3+Zo(a,g,7),g+=3):Qe==18&&(Je=11+Zo(a,g,127),g+=7);Je--;)pe[Se++]=Ke}}var ft=pe.subarray(0,j),mt=pe.subarray(j);C=Nc(ft),L=Nc(mt),x=fl(ft,C,1),S=fl(mt,L,1)}if(g>B){if(l)throw"unexpected EOF";break}}s&&c(y+131072);for(var vt=(1<<C)-1,Qt=(1<<L)-1,Ht=g;;Ht=g){var Cn=(Ke=x[af(a,g)&vt])>>>4;if((g+=15&Ke)>B){if(l)throw"unexpected EOF";break}if(!Ke)throw"invalid length/literal";if(Cn<256)e[y++]=Cn;else{if(Cn==256){Ht=g,x=null;break}var un=Cn-254;if(Cn>264){var rn=hu[Se=Cn-257];un=Zo(a,g,(1<<rn)-1)+ic[Se],g+=rn}var Gn=S[af(a,g)&Qt],Fn=Gn>>>4;if(!Gn)throw"invalid distance";if(g+=15&Gn,mt=of[Fn],Fn>3&&(rn=ko[Fn],mt+=af(a,g)&(1<<rn)-1,g+=rn),g>B){if(l)throw"unexpected EOF";break}s&&c(y+131072);for(var di=y+un;y<di;y+=4)e[y]=e[y-mt],e[y+1]=e[y+1-mt],e[y+2]=e[y+2-mt],e[y+3]=e[y+3-mt];y=di}}t.l=x,t.p=Ht,t.b=y,x&&(f=1,t.m=C,t.d=S,t.n=L)}while(!f);return y==e.length?e:To(e,0,y)},Ka=function(a,e,t){t<<=7&e;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8},Fo=function(a,e,t){t<<=7&e;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8,a[n+2]|=t>>>16},lf=function(a,e){for(var t=[],n=0;n<a.length;++n)a[n]&&t.push({s:n,f:a[n]});var s=t.length,l=t.slice();if(!s)return[Gr,0];if(s==1){var c=new jr(t[0].s+1);return c[t[0].s]=1,[c,1]}t.sort(function(pe,be){return pe.f-be.f}),t.push({s:-1,f:25001});var f=t[0],g=t[1],y=0,x=1,S=2;for(t[0]={s:-1,f:f.f+g.f,l:f,r:g};x!=s-1;)f=t[t[y].f<t[S].f?y++:S++],g=t[y!=x&&t[y].f<t[S].f?y++:S++],t[x++]={s:-1,f:f.f+g.f,l:f,r:g};var C=l[0].s;for(n=1;n<s;++n)l[n].s>C&&(C=l[n].s);var L=new So(C+1),B=Id(t[x-1],L,0);if(B>e){n=0;var W=0,q=B-e,Z=1<<q;for(l.sort(function(pe,be){return L[be.s]-L[pe.s]||pe.f-be.f});n<s;++n){var j=l[n].s;if(!(L[j]>e))break;W+=Z-(1<<B-L[j]),L[j]=e}for(W>>>=q;W>0;){var F=l[n].s;L[F]<e?W-=1<<e-L[F]++-1:++n}for(;n>=0&&W;--n){var se=l[n].s;L[se]==e&&(--L[se],++W)}B=e}return[new jr(L),B]},Id=function(a,e,t){return a.s==-1?Math.max(Id(a.l,e,t+1),Id(a.r,e,t+1)):e[a.s]=t},cf=function(a){for(var e=a.length;e&&!a[--e];);for(var t=new So(++e),n=0,s=a[0],l=1,c=function(g){t[n++]=g},f=1;f<=e;++f)if(a[f]==s&&f!=e)++l;else{if(!s&&l>2){for(;l>138;l-=138)c(32754);l>2&&(c(l>10?l-11<<5|28690:l-3<<5|12305),l=0)}else if(l>3){for(c(s),--l;l>6;l-=6)c(8304);l>2&&(c(l-3<<5|8208),l=0)}for(;l--;)c(s);l=1,s=a[f]}return[t.subarray(0,n),e]},Fu=function(a,e){for(var t=0,n=0;n<e.length;++n)t+=a[n]*e[n];return t},Il=function(a,e,t){var n=t.length,s=Ya(e+2);a[s]=255&n,a[s+1]=n>>>8,a[s+2]=255^a[s],a[s+3]=255^a[s+1];for(var l=0;l<n;++l)a[s+l+4]=t[l];return 8*(s+4+n)},uf=function(a,e,t,n,s,l,c,f,g,y,x){Ka(e,x++,t),++s[256];for(var S=lf(s,15),C=S[0],L=S[1],B=lf(l,15),W=B[0],q=B[1],Z=cf(C),j=Z[0],F=Z[1],se=cf(W),pe=se[0],be=se[1],Se=new So(19),Be=0;Be<j.length;++Be)Se[31&j[Be]]++;for(Be=0;Be<pe.length;++Be)Se[31&pe[Be]]++;for(var Ge=lf(Se,7),Xe=Ge[0],Qe=Ge[1],at=19;at>4&&!Xe[Xa[at-1]];--at);var Ke,Je,ft,mt,vt=y+5<<3,Qt=Fu(s,Oc)+Fu(l,qa)+c,Ht=Fu(s,C)+Fu(l,W)+c+14+3*at+Fu(Se,Xe)+(2*Se[16]+3*Se[17]+7*Se[18]);if(vt<=Qt&&vt<=Ht)return Il(e,x,a.subarray(g,g+y));if(Ka(e,x,1+(Ht<Qt)),x+=2,Ht<Qt){Ke=fl(C,L,0),Je=C,ft=fl(W,q,0),mt=W;var Cn=fl(Xe,Qe,0);for(Ka(e,x,F-257),Ka(e,x+5,be-1),Ka(e,x+10,at-4),x+=14,Be=0;Be<at;++Be)Ka(e,x+3*Be,Xe[Xa[Be]]);x+=3*at;for(var un=[j,pe],rn=0;rn<2;++rn){var Gn=un[rn];for(Be=0;Be<Gn.length;++Be){var Fn=31&Gn[Be];Ka(e,x,Cn[Fn]),x+=Xe[Fn],Fn>15&&(Ka(e,x,Gn[Be]>>>5&127),x+=Gn[Be]>>>12)}}}else Ke=ml,Je=Oc,ft=bm,mt=qa;for(Be=0;Be<f;++Be)if(n[Be]>255){Fn=n[Be]>>>18&31,Fo(e,x,Ke[Fn+257]),x+=Je[Fn+257],Fn>7&&(Ka(e,x,n[Be]>>>23&31),x+=hu[Fn]);var di=31&n[Be];Fo(e,x,ft[di]),x+=mt[di],di>3&&(Fo(e,x,n[Be]>>>5&8191),x+=ko[di])}else Fo(e,x,Ke[n[Be]]),x+=Je[n[Be]];return Fo(e,x,Ke[256]),x+Je[256]},xm=new pl([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Gr=new jr(0),Pa=function(a,e,t,n,s,l){var c=a.length,f=new jr(n+c+5*(1+Math.ceil(c/7e3))+s),g=f.subarray(n,f.length-s),y=0;if(!e||c<8)for(var x=0;x<=c;x+=65535){var S=x+65535;S<c?y=Il(g,y,a.subarray(x,S)):(g[x]=l,y=Il(g,y,a.subarray(x,c)))}else{for(var C=xm[e-1],L=C>>>13,B=8191&C,W=(1<<t)-1,q=new So(32768),Z=new So(W+1),j=Math.ceil(t/3),F=2*j,se=function(zn){return(a[zn]^a[zn+1]<<j^a[zn+2]<<F)&W},pe=new pl(25e3),be=new So(288),Se=new So(32),Be=0,Ge=0,Xe=(x=0,0),Qe=0,at=0;x<c;++x){var Ke=se(x),Je=32767&x,ft=Z[Ke];if(q[Je]=ft,Z[Ke]=Je,Qe<=x){var mt=c-x;if((Be>7e3||Xe>24576)&&mt>423){y=uf(a,g,0,pe,be,Se,Ge,Xe,at,x-at,y),Xe=Be=Ge=0,at=x;for(var vt=0;vt<286;++vt)be[vt]=0;for(vt=0;vt<30;++vt)Se[vt]=0}var Qt=2,Ht=0,Cn=B,un=Je-ft&32767;if(mt>2&&Ke==se(x-un))for(var rn=Math.min(L,mt)-1,Gn=Math.min(32767,x),Fn=Math.min(258,mt);un<=Gn&&--Cn&&Je!=ft;){if(a[x+Qt]==a[x+Qt-un]){for(var di=0;di<Fn&&a[x+di]==a[x+di-un];++di);if(di>Qt){if(Qt=di,Ht=un,di>rn)break;var bi=Math.min(un,di-2),Bi=0;for(vt=0;vt<bi;++vt){var Br=x-un+vt+32768&32767,lr=Br-q[Br]+32768&32767;lr>Bi&&(Bi=lr,ft=Br)}}}un+=(Je=ft)-(ft=q[Je])+32768&32767}if(Ht){pe[Xe++]=268435456|Sh[Qt]<<18|Bc[Ht];var tr=31&Sh[Qt],vn=31&Bc[Ht];Ge+=hu[tr]+ko[vn],++be[257+tr],++Se[vn],Qe=x+Qt,++Be}else pe[Xe++]=a[x],++be[a[x]]}}y=uf(a,g,l,pe,be,Se,Ge,Xe,at,x-at,y),!l&&7&y&&(y=Il(g,y+1,Gr))}return To(f,0,n+Ya(y)+s)},rc=function(){for(var a=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&-306674912)^t>>>1;a[e]=t}return a}(),$a=function(){var a=-1;return{p:function(e){for(var t=a,n=0;n<e.length;++n)t=rc[255&t^e[n]]^t>>>8;a=t},d:function(){return~a}}},gl=function(){var a=1,e=0;return{p:function(t){for(var n=a,s=e,l=t.length,c=0;c!=l;){for(var f=Math.min(c+2655,l);c<f;++c)s+=n+=t[c];n=(65535&n)+15*(n>>16),s=(65535&s)+15*(s>>16)}a=n,e=s},d:function(){return(255&(a%=65521))<<24|a>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},_l=function(a,e,t,n,s){return Pa(a,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+e.mem,t,n,!s)},sc=function(a,e){var t={};for(var n in a)t[n]=a[n];for(var n in e)t[n]=e[n];return t},wm=function(a,e,t){for(var n=a(),s=a.toString(),l=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),c=0;c<n.length;++c){var f=n[c],g=l[c];if(typeof f=="function"){e+=";"+g+"=";var y=f.toString();if(f.prototype)if(y.indexOf("[native code]")!=-1){var x=y.indexOf(" ",8)+1;e+=y.slice(x,y.indexOf("(",x))}else for(var S in e+=y,f.prototype)e+=";"+g+".prototype."+S+"="+f.prototype[S].toString();else e+=y}else t[g]=f}return[e,t]},Th=[],du=function(a,e,t,n){var s;if(!Th[t]){for(var l="",c={},f=a.length-1,g=0;g<f;++g)l=(s=wm(a[g],l,c))[0],c=s[1];Th[t]=wm(a[f],l,c)}var y=sc({},Th[t][1]);return function(x,S,C,L,B){var W=new Worker(uu[S]||(uu[S]=URL.createObjectURL(new Blob([x],{type:"text/javascript"}))));return W.onerror=function(q){return B(q.error,null)},W.onmessage=function(q){return B(null,q.data)},W.postMessage(C,L),W}(Th[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,y,function(x){var S=[];for(var C in x)(x[C]instanceof jr||x[C]instanceof So||x[C]instanceof pl)&&S.push((x[C]=new x[C].constructor(x[C])).buffer);return S}(y),n)},kc=function(){return[jr,So,pl,hu,ko,Xa,ic,of,ua,Rd,Sr,fl,Nc,Zo,af,Ya,To,Mo,ki,Fc,ho]},Uc=function(){return[jr,So,pl,hu,ko,Xa,Sh,Bc,ml,Oc,bm,qa,Sr,xm,Gr,fl,Ka,Fo,lf,Id,cf,Fu,Il,uf,Ya,To,Pa,_l,pu,Fc]},zo=function(){return[ea,fs,ps,$a,rc]},Em=function(){return[zu,x_]},Vo=function(){return[Vu,ps,gl]},Pd=function(){return[As]},Fc=function(a){return postMessage(a,[a.buffer])},ho=function(a){return a&&a.size&&new jr(a.size)},zc=function(a,e,t,n,s,l){var c=du(t,n,s,function(f,g){c.terminate(),l(f,g)});return c.postMessage([a,e],e.consume?[a.buffer]:[]),function(){c.terminate()}},Da=function(a){return a.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return a.push(e.data[0],e.data[1])}},Mi=function(a,e,t,n,s){var l,c=du(a,n,s,function(f,g){f?(c.terminate(),e.ondata.call(e,f)):(g[1]&&c.terminate(),e.ondata.call(e,f,g[0],g[1]))});c.postMessage(t),e.push=function(f,g){if(l)throw"stream finished";if(!e.ondata)throw"no stream handler";c.postMessage([f,l=g],[f.buffer])},e.terminate=function(){c.terminate()}},us=function(a,e){return a[e]|a[e+1]<<8},ys=function(a,e){return(a[e]|a[e+1]<<8|a[e+2]<<16|a[e+3]<<24)>>>0},Pl=function(a,e){return ys(a,e)+4294967296*ys(a,e+4)},ps=function(a,e,t){for(;t;++e)a[e]=t,t>>>=8},ea=function(a,e){var t=e.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=e.level<2?4:e.level==9?2:0,a[9]=3,e.mtime!=0&&ps(a,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){a[3]=8;for(var n=0;n<=t.length;++n)a[n+10]=t.charCodeAt(n)}},zu=function(a){if(a[0]!=31||a[1]!=139||a[2]!=8)throw"invalid gzip data";var e=a[3],t=10;4&e&&(t+=a[10]|2+(a[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!a[t++]);return t+(2&e)},x_=function(a){var e=a.length;return(a[e-4]|a[e-3]<<8|a[e-2]<<16|a[e-1]<<24)>>>0},fs=function(a){return 10+(a.filename&&a.filename.length+1||0)},Vu=function(a,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;a[0]=120,a[1]=n<<6|(n?32-2*n:1)},As=function(a){if((15&a[0])!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(32&a[1])throw"invalid zlib data: preset dictionaries not supported"};function hf(a,e){return e||typeof a!="function"||(e=a,a={}),this.ondata=e,a}var oc=function(){function a(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return a.prototype.p=function(e,t){this.ondata(_l(e,this.o,0,0,!t),t)},a.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},a}(),w_=function(){return function(a,e){Mi([Uc,function(){return[Da,oc]}],this,hf.call(this,a,e),function(t){var n=new oc(t.data);onmessage=Da(n)},6)}}();function Sm(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return zc(a,e,[Uc],function(n){return Fc(pu(n.data[0],n.data[1]))},0,t)}function pu(a,e){return _l(a,e||{},0,0)}var ha=function(){function a(e){this.s={},this.p=new jr(0),this.ondata=e}return a.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new jr(t+e.length);n.set(this.p),n.set(e,t),this.p=n},a.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Mo(this.p,this.o,this.s);this.ondata(To(n,t,this.s.b),this.d),this.o=To(n,this.s.b-32768),this.s.b=this.o.length,this.p=To(this.p,this.s.p/8|0),this.s.p&=7},a.prototype.push=function(e,t){this.e(e),this.c(t)},a}(),Dd=function(){return function(a){this.ondata=a,Mi([kc,function(){return[Da,ha]}],this,0,function(){var e=new ha;onmessage=Da(e)},7)}}();function Tm(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return zc(a,e,[kc],function(n){return Fc(ki(n.data[0],ho(n.data[1])))},1,t)}function ki(a,e){return Mo(a,e)}var df=function(){function a(e,t){this.c=$a(),this.l=0,this.v=1,oc.call(this,e,t)}return a.prototype.push=function(e,t){oc.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=_l(e,this.o,this.v&&fs(this.o),t&&8,!t);this.v&&(ea(n,this.o),this.v=0),t&&(ps(n,n.length-8,this.c.d()),ps(n,n.length-4,this.l)),this.ondata(n,t)},a}(),E_=function(){return function(a,e){Mi([Uc,zo,function(){return[Da,oc,df]}],this,hf.call(this,a,e),function(t){var n=new df(t.data);onmessage=Da(n)},8)}}();function La(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return zc(a,e,[Uc,zo,function(){return[Mh]}],function(n){return Fc(Mh(n.data[0],n.data[1]))},2,t)}function Mh(a,e){e||(e={});var t=$a(),n=a.length;t.p(a);var s=_l(a,e,fs(e),8),l=s.length;return ea(s,e),ps(s,l-8,t.d()),ps(s,l-4,n),s}var ee=function(){function a(e){this.v=1,ha.call(this,e)}return a.prototype.push=function(e,t){if(ha.prototype.e.call(this,e),this.v){var n=this.p.length>3?zu(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ha.prototype.c.call(this,t)},a}(),M=function(){return function(a){this.ondata=a,Mi([kc,Em,function(){return[Da,ha,ee]}],this,0,function(){var e=new ee;onmessage=Da(e)},9)}}();function N(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return zc(a,e,[kc,Em,function(){return[le]}],function(n){return Fc(le(n.data[0]))},3,t)}function le(a,e){return Mo(a.subarray(zu(a),-8),e||new jr(x_(a)))}var Ie=function(){function a(e,t){this.c=gl(),this.v=1,oc.call(this,e,t)}return a.prototype.push=function(e,t){oc.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e);var n=_l(e,this.o,this.v&&2,t&&4,!t);this.v&&(Vu(n,this.o),this.v=0),t&&ps(n,n.length-4,this.c.d()),this.ondata(n,t)},a}(),ct=function(){return function(a,e){Mi([Uc,Vo,function(){return[Da,oc,Ie]}],this,hf.call(this,a,e),function(t){var n=new Ie(t.data);onmessage=Da(n)},10)}}();function yt(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return zc(a,e,[Uc,Vo,function(){return[on]}],function(n){return Fc(on(n.data[0],n.data[1]))},4,t)}function on(a,e){e||(e={});var t=gl();t.p(a);var n=_l(a,e,2,4);return Vu(n,e),ps(n,n.length-4,t.d()),n}var ei=function(){function a(e){this.v=1,ha.call(this,e)}return a.prototype.push=function(e,t){if(ha.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ha.prototype.c.call(this,t)},a}(),Ci=function(){return function(a){this.ondata=a,Mi([kc,Pd,function(){return[Da,ha,ei]}],this,0,function(){var e=new ei;onmessage=Da(e)},11)}}();function yr(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return zc(a,e,[kc,Pd,function(){return[Es]}],function(n){return Fc(Es(n.data[0],ho(n.data[1])))},5,t)}function Es(a,e){return Mo((As(a),a.subarray(2,-4)),e)}var da=function(){function a(e){this.G=ee,this.I=ha,this.Z=ei,this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new jr(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var s=this,l=function(){s.ondata.apply(s,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(l):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(l):new this.Z(l),this.s.push(this.p,t),this.p=null}}},a}(),jo=function(){function a(e){this.G=M,this.I=Dd,this.Z=Ci,this.ondata=e}return a.prototype.push=function(e,t){da.prototype.push.call(this,e,t)},a}();function Dl(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return a[0]==31&&a[1]==139&&a[2]==8?N(a,e,t):(15&a[0])!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?Tm(a,e,t):yr(a,e,t)}function ju(a,e){return a[0]==31&&a[1]==139&&a[2]==8?le(a,e):(15&a[0])!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?ki(a,e):Es(a,e)}var fu=function(a,e,t,n){for(var s in a){var l=a[s],c=e+s;l instanceof jr?t[c]=[l,n]:Array.isArray(l)?t[c]=[l[0],sc(n,l[1])]:fu(l,c+"/",t,n)}},Ld=typeof TextEncoder<"u"&&new TextEncoder,Gu=typeof TextDecoder<"u"&&new TextDecoder,Ch=0;try{Gu.decode(Gr,{stream:!0}),Ch=1}catch{}var Bd=function(a){for(var e="",t=0;;){var n=a[t++],s=(n>127)+(n>223)+(n>239);if(t+s>a.length)return[e,To(a,t-1)];s?s==3?(n=((15&n)<<18|(63&a[t++])<<12|(63&a[t++])<<6|63&a[t++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=1&s?String.fromCharCode((31&n)<<6|63&a[t++]):String.fromCharCode((15&n)<<12|(63&a[t++])<<6|63&a[t++]):e+=String.fromCharCode(n)}},pf=function(){function a(e){this.ondata=e,Ch?this.t=new TextDecoder:this.p=Gr}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new jr(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var s=Bd(n),l=s[0],c=s[1];if(t){if(c.length)throw"invalid utf-8 data";this.p=null}else this.p=c;this.ondata(l,t)}},a}(),Co=function(){function a(e){this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Ll(e),this.d=t||!1)},a}();function Ll(a,e){if(e){for(var t=new jr(a.length),n=0;n<a.length;++n)t[n]=a.charCodeAt(n);return t}if(Ld)return Ld.encode(a);var s=a.length,l=new jr(a.length+(a.length>>1)),c=0,f=function(x){l[c++]=x};for(n=0;n<s;++n){if(c+5>l.length){var g=new jr(c+8+(s-n<<1));g.set(l),l=g}var y=a.charCodeAt(n);y<128||e?f(y):y<2048?(f(192|y>>6),f(128|63&y)):y>55295&&y<57344?(f(240|(y=65536+(1047552&y)|1023&a.charCodeAt(++n))>>18),f(128|y>>12&63),f(128|y>>6&63),f(128|63&y)):(f(224|y>>12),f(128|y>>6&63),f(128|63&y))}return To(l,0,c)}function ac(a,e){if(e){for(var t="",n=0;n<a.length;n+=16384)t+=String.fromCharCode.apply(null,a.subarray(n,n+16384));return t}if(Gu)return Gu.decode(a);var s=Bd(a),l=s[0];if(s[1].length)throw"invalid utf-8 data";return l}var Rh=function(a){return a==1?3:a<6?2:a==9?1:0},Ba=function(a,e){return e+30+us(a,e+26)+us(a,e+28)},_0=function(a,e,t){var n=us(a,e+28),s=ac(a.subarray(e+46,e+46+n),!(2048&us(a,e+8))),l=e+46+n,c=ys(a,e+20),f=t&&c==4294967295?v0(a,l):[c,ys(a,e+24),ys(a,e+42)],g=f[0],y=f[1],x=f[2];return[us(a,e+10),g,y,s,l+us(a,e+30)+us(a,e+32),x]},v0=function(a,e){for(;us(a,e)!=1;e+=4+us(a,e+2));return[Pl(a,e+12),Pl(a,e+4),Pl(a,e+20)]},ta=function(a){var e=0;if(a)for(var t in a){var n=a[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Hu=function(a,e,t,n,s,l,c,f){var g=n.length,y=t.extra,x=f&&f.length,S=ta(y);ps(a,e,c!=null?33639248:67324752),e+=4,c!=null&&(a[e++]=20,a[e++]=t.os),a[e]=20,e+=2,a[e++]=t.flag<<1|(l==null&&8),a[e++]=s&&8,a[e++]=255&t.compression,a[e++]=t.compression>>8;var C=new Date(t.mtime==null?Date.now():t.mtime),L=C.getFullYear()-1980;if(L<0||L>119)throw"date not in range 1980-2099";if(ps(a,e,L<<25|C.getMonth()+1<<21|C.getDate()<<16|C.getHours()<<11|C.getMinutes()<<5|C.getSeconds()>>>1),e+=4,l!=null&&(ps(a,e,t.crc),ps(a,e+4,l),ps(a,e+8,t.size)),ps(a,e+12,g),ps(a,e+14,S),e+=16,c!=null&&(ps(a,e,x),ps(a,e+6,t.attrs),ps(a,e+10,c),e+=14),a.set(n,e),e+=g,S)for(var B in y){var W=y[B],q=W.length;ps(a,e,+B),ps(a,e+2,q),a.set(W,e+4),e+=4+q}return x&&(a.set(f,e),e+=x),e},Go=function(a,e,t,n,s){ps(a,e,101010256),ps(a,e+8,t),ps(a,e+10,t),ps(a,e+12,n),ps(a,e+16,s)},mu=function(){function a(e){this.filename=e,this.c=$a(),this.size=0,this.compression=0}return a.prototype.process=function(e,t){this.ondata(null,e,t)},a.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},a}(),zA=function(){function a(e,t){var n=this;t||(t={}),mu.call(this,e),this.d=new oc(t,function(s,l){n.ondata(null,s,l)}),this.compression=8,this.flag=Rh(t.level)}return a.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},a.prototype.push=function(e,t){mu.prototype.push.call(this,e,t)},a}(),Mm=function(){function a(e,t){var n=this;t||(t={}),mu.call(this,e),this.d=new w_(t,function(s,l,c){n.ondata(s,l,c)}),this.compression=8,this.flag=Rh(t.level),this.terminate=this.d.terminate}return a.prototype.process=function(e,t){this.d.push(e,t)},a.prototype.push=function(e,t){mu.prototype.push.call(this,e,t)},a}(),VA=function(){function a(e){this.ondata=e,this.u=[],this.d=1}return a.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=Ll(e.filename),s=n.length,l=e.comment,c=l&&Ll(l),f=s!=e.filename.length||c&&l.length!=c.length,g=s+ta(e.extra)+30;if(s>65535)throw"filename too long";var y=new jr(g);Hu(y,0,e,n,f);var x=[y],S=function(){for(var q=0,Z=x;q<Z.length;q++){var j=Z[q];t.ondata(null,j,!1)}x=[]},C=this.d;this.d=0;var L=this.u.length,B=sc(e,{f:n,u:f,o:c,t:function(){e.terminate&&e.terminate()},r:function(){if(S(),C){var q=t.u[L+1];q?q.r():t.d=1}C=1}}),W=0;e.ondata=function(q,Z,j){if(q)t.ondata(q,Z,j),t.terminate();else if(W+=Z.length,x.push(Z),j){var F=new jr(16);ps(F,0,134695760),ps(F,4,e.crc),ps(F,8,W),ps(F,12,e.size),x.push(F),B.c=W,B.b=g+W+16,B.crc=e.crc,B.size=e.size,C&&B.r(),C=1}else C&&S()},this.u.push(B)},a.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},a.prototype.e=function(){for(var e=0,t=0,n=0,s=0,l=this.u;s<l.length;s++)n+=46+(y=l[s]).f.length+ta(y.extra)+(y.o?y.o.length:0);for(var c=new jr(n+22),f=0,g=this.u;f<g.length;f++){var y=g[f];Hu(c,e,y,y.f,y.u,y.c,t,y.o),e+=46+y.f.length+ta(y.extra)+(y.o?y.o.length:0),t+=y.b}Go(c,e,this.u.length,n,t),this.ondata(null,c,!0),this.d=2},a.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},a}();function y0(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};fu(a,"",n,e);var s=Object.keys(n),l=s.length,c=0,f=0,g=l,y=new Array(l),x=[],S=function(){for(var W=0;W<x.length;++W)x[W]()},C=function(){var W=new jr(f+22),q=c,Z=f-c;f=0;for(var j=0;j<g;++j){var F=y[j];try{var se=F.c.length;Hu(W,f,F,F.f,F.u,se);var pe=30+F.f.length+ta(F.extra),be=f+pe;W.set(F.c,be),Hu(W,c,F,F.f,F.u,se,f,F.m),c+=16+pe+(F.m?F.m.length:0),f=be+se}catch(Se){return t(Se,null)}}Go(W,c,y.length,Z,q),t(null,W)};l||C();for(var L=function(W){var q=s[W],Z=n[q],j=Z[0],F=Z[1],se=$a(),pe=j.length;se.p(j);var be=Ll(q),Se=be.length,Be=F.comment,Ge=Be&&Ll(Be),Xe=Ge&&Ge.length,Qe=ta(F.extra),at=F.level==0?0:8,Ke=function(Je,ft){if(Je)S(),t(Je,null);else{var mt=ft.length;y[W]=sc(F,{size:pe,crc:se.d(),c:ft,f:be,m:Ge,u:Se!=q.length||Ge&&Be.length!=Xe,compression:at}),c+=30+Se+Qe+mt,f+=76+2*(Se+Qe)+(Xe||0)+mt,--l||C()}};if(Se>65535&&Ke("filename too long",null),at)if(pe<16e4)try{Ke(null,pu(j,F))}catch(Je){Ke(Je,null)}else x.push(Sm(j,F,Ke));else Ke(null,j)},B=0;B<g;++B)L(B);return S}function A0(a,e){e||(e={});var t={},n=[];fu(a,"",t,e);var s=0,l=0;for(var c in t){var f=t[c],g=f[0],y=f[1],x=y.level==0?0:8,S=(Se=Ll(c)).length,C=y.comment,L=C&&Ll(C),B=L&&L.length,W=ta(y.extra);if(S>65535)throw"filename too long";var q=x?pu(g,y):g,Z=q.length,j=$a();j.p(g),n.push(sc(y,{size:g.length,crc:j.d(),c:q,f:Se,m:L,u:S!=c.length||L&&C.length!=B,o:s,compression:x})),s+=30+S+W+Z,l+=76+2*(S+W)+(B||0)+Z}for(var F=new jr(l+22),se=s,pe=l-s,be=0;be<n.length;++be){var Se=n[be];Hu(F,Se.o,Se,Se.f,Se.u,Se.c.length);var Be=30+Se.f.length+ta(Se.extra);F.set(Se.c,Se.o+Be),Hu(F,s,Se,Se.f,Se.u,Se.c.length,Se.o,Se.m),s+=16+Be+(Se.m?Se.m.length:0)}return Go(F,s,n.length,pe,se),F}var jA=function(){function a(){}return a.prototype.push=function(e,t){this.ondata(null,e,t)},a.compression=0,a}(),Ih=function(){function a(){var e=this;this.i=new ha(function(t,n){e.ondata(null,t,n)})}return a.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},a.compression=8,a}(),Od=function(){function a(e,t){var n=this;t<32e4?this.i=new ha(function(s,l){n.ondata(null,s,l)}):(this.i=new Dd(function(s,l,c){n.ondata(s,l,c)}),this.terminate=this.i.terminate)}return a.prototype.push=function(e,t){this.i.terminate&&(e=To(e,0)),this.i.push(e,t)},a.compression=8,a}(),S_=function(){function a(e){this.onfile=e,this.k=[],this.o={0:jA},this.p=Gr}return a.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var s=Math.min(this.c,e.length),l=e.subarray(0,s);if(this.c-=s,this.d?this.d.push(l,!this.c):this.k[0].push(l),(e=e.subarray(s)).length)return this.push(e,t)}else{var c=0,f=0,g=void 0,y=void 0;this.p.length?e.length?((y=new jr(this.p.length+e.length)).set(this.p),y.set(e,this.p.length)):y=this.p:y=e;for(var x=y.length,S=this.c,C=S&&this.d,L=function(){var q,Z=ys(y,f);if(Z==67324752){c=1,g=f,B.d=null,B.c=0;var j=us(y,f+6),F=us(y,f+8),se=2048&j,pe=8&j,be=us(y,f+26),Se=us(y,f+28);if(x>f+30+be+Se){var Be=[];B.k.unshift(Be),c=2;var Ge,Xe=ys(y,f+18),Qe=ys(y,f+22),at=ac(y.subarray(f+30,f+=30+be),!se);Xe==4294967295?(q=pe?[-2]:v0(y,f),Xe=q[0],Qe=q[1]):pe&&(Xe=-1),f+=Se,B.c=Xe;var Ke={name:at,compression:F,start:function(){if(!Ke.ondata)throw"no callback";if(Xe){var Je=n.o[F];if(!Je)throw"unknown compression type "+F;(Ge=Xe<0?new Je(at):new Je(at,Xe,Qe)).ondata=function(Qt,Ht,Cn){Ke.ondata(Qt,Ht,Cn)};for(var ft=0,mt=Be;ft<mt.length;ft++){var vt=mt[ft];Ge.push(vt,!1)}n.k[0]==Be&&n.c?n.d=Ge:Ge.push(Gr,!0)}else Ke.ondata(null,Gr,!0)},terminate:function(){Ge&&Ge.terminate&&Ge.terminate()}};Xe>=0&&(Ke.size=Xe,Ke.originalSize=Qe),B.onfile(Ke)}return"break"}if(S){if(Z==134695760)return g=f+=12+(S==-2&&8),c=3,B.c=0,"break";if(Z==33639248)return g=f-=4,c=3,B.c=0,"break"}},B=this;f<x-4&&L()!=="break";++f);if(this.p=Gr,S<0){var W=c?y.subarray(0,g-12-(S==-2&&8)-(ys(y,g-16)==134695760&&4)):y.subarray(0,f);C?C.push(W,!!c):this.k[+(c==2)].push(W)}if(2&c)return this.push(y.subarray(f),t);this.p=y.subarray(f)}if(t){if(this.c)throw"invalid zip file";this.p=null}},a.prototype.register=function(e){this.o[e.compression]=e},a}();function T_(a,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var C=0;C<t.length;++C)t[C]()},s={},l=a.length-22;ys(a,l)!=101010256;--l)if(!l||a.length-l>65558)return void e("invalid zip file",null);var c=us(a,l+8);c||e(null,{});var f=c,g=ys(a,l+16),y=g==4294967295;if(y){if(l=ys(a,l-12),ys(a,l)!=101075792)return void e("invalid zip file",null);f=c=ys(a,l+32),g=ys(a,l+48)}for(var x=function(C){var L=_0(a,g,y),B=L[0],W=L[1],q=L[2],Z=L[3],j=L[4],F=L[5],se=Ba(a,F);g=j;var pe=function(Se,Be){Se?(n(),e(Se,null)):(s[Z]=Be,--c||e(null,s))};if(B)if(B==8){var be=a.subarray(se,se+W);if(W<32e4)try{pe(null,ki(be,new jr(q)))}catch(Se){pe(Se,null)}else t.push(Tm(be,{size:q},pe))}else pe("unknown compression type "+B,null);else pe(null,To(a,se,se+W))},S=0;S<f;++S)x();return n}function ff(a){for(var e={},t=a.length-22;ys(a,t)!=101010256;--t)if(!t||a.length-t>65558)throw"invalid zip file";var n=us(a,t+8);if(!n)return{};var s=ys(a,t+16),l=s==4294967295;if(l){if(t=ys(a,t-12),ys(a,t)!=101075792)throw"invalid zip file";n=ys(a,t+32),s=ys(a,t+48)}for(var c=0;c<n;++c){var f=_0(a,s,l),g=f[0],y=f[1],x=f[2],S=f[3],C=f[4],L=f[5],B=Ba(a,L);if(s=C,g){if(g!=8)throw"unknown compression type "+g;e[S]=ki(a.subarray(B,B+y),new jr(x))}else e[S]=To(a,B,B+y)}return e}class b0 extends i.hH6{load(e,t,n,s){return this.setResponseType("arraybuffer"),super.load(e,l=>{const c=ff(new Uint8Array(l)),f=new Map(Object.entries(c).map(([g,y])=>[g,new File([y],g)]));t==null||t(f)},n,s)}}class Nd extends r.SimpleEventDispatcher{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(e,t=!1){super(),this._processors=new gm,this._logger=console.log,this.Importers=[new Ms(_h,["json"],!1),new Ms(i.hH6,["txt"],!1),new Ms(Ic,["rgbe.png","hdr.png","hdrpng"],!1),new Ms(i.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new Ms(rf,["cube"],!1),new Ms(b0,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new i.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(Ed(e)),this.Importers.push(Vs(e)),this.Importers.push(ku())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,n){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:n})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,n){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:n})}_urlModifier(e){var l;let t=decodeURI(e);const n=(l=this._rootContext)==null?void 0:l.rootUrl;t.includes("://")||!n||t.startsWith(n)||(t=n+t),t=t.replace("./",""),t=t.replace(/^(\/\/)/,"/"),t=t.replace(/\?.*$/,"");const s=this._fileDatabase.get(t);return s?s.ext?(s.objectUrl||(s.objectUrl=URL.createObjectURL(s)+"#"+t),s.objectUrl):(console.error("Unable to determine file extension",s),e):e}_createLoader(e){const t=this._getImporter(e),n=t==null?void 0:t.ctor(this);return n&&(t==null||t.ext.forEach(s=>{const l=new RegExp(s.startsWith("data:")?"^"+s+"\\/":"\\."+s+"$","i");this._loadingManager.addHandler(l,n)})),n&&(this._loaderCache.push({loader:n,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:n})),n}async importFiles(e,t={}){const n=new Map;let{allowedExtensions:s}=t;if(s&&s.length<1&&(s=void 0),e.size===0)return n;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const l=[],c=[];if(e.forEach((f,g)=>{this.registerFile(g,f);const y=f.ext;y&&((s==null?void 0:s.includes(y.toLowerCase()))??1)&&(this._isRootFileExtension(y)?l.push(g):c.push(g))}),l.length>0)for(const f of l){let g=await this._importFile(f,void 0,t);g&&(g=await this.processImported(g,t)),n.set(f,g)}else for(const f of c){let g=await this._importFile(f,void 0,t);g&&(g=await this.processImported(g,t)),n.set(f,g)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((f,g)=>{this.unregisterFile(g)}),n}registerFile(e,t){var l;e=e.replace(/\?.*$/,"");const n=(t==null?void 0:t.ext)??((l=(0,r.parseFileExtension)((t==null?void 0:t.name)??e))==null?void 0:l.toLowerCase());t&&(t.ext||(t.ext=n),this._fileDatabase.set(e,t));let s=this._getLoader(e);if(s||(s=this._createLoader(t??{name:e,ext:n})),s){for(const c of this._loaderCache)if(c.loader===s){c.files.push(e);break}}return s}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);t!=null&&t.objectUrl&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return this.Importers.find(t=>t.root&&t.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,n={},s){var c;if(t!=null&&t.__imported)return t.__imported;let l;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t);const f=this.resolveURL(e),g=e.replace(/\?.*$/,""),y=n.fileHandler??(await this._loadingManager.getHandler(g)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0));if(!y)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:f,rootUrl:i.Zp0.extractUrlBase(e),baseUrl:i.Zp0.extractUrlBase(f)},l=await y.loadAsync(e+(n.queryString?(e.includes("?")?"&":"?")+n.queryString:""),x=>{s&&s(x),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:x.loaded||void 0,totalBytes:x.total||void 0,progress:x.total>0?x.loaded/x.total:1})}),y.transform&&(l=await y.transform(l,n)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(f){return console.error("AssetImporter: Unable to import file",e,t),console.error(f),console.error(f==null?void 0:f.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:f}),t&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),t){t.__imported=l;let f=[];Array.isArray(l)?f=l:(c=l.userData)!=null&&c.rootSceneModelRoot?f.push(...l.children):f.push(l),f.forEach(g=>{var y;(y=g.addEventListener)==null||y.call(g,"dispose",()=>{t.__imported=void 0})})}if(l&&typeof l=="object"){l.__rootPath=e;const f=t||this._fileDatabase.get(e);f&&(l.__rootBlob=f)}return l}_getImporter(e,t=!1){return this.Importers.find(n=>{if(t&&!n.root)return!1;const s=n.ext.find(l=>{var c,f,g;return e.ext&&l===e.ext.toLowerCase()||((f=(c=e.name)==null?void 0:c.toLowerCase())==null?void 0:f.endsWith("."+l.toLowerCase()))||(l==null?void 0:l.startsWith("data:"))&&((g=e.name)==null?void 0:g.startsWith(l))});return!!s&&(e.ext=s,!0)})}_getLoader(e){return this._loadingManager.getHandler(e)??void 0}async importAsset(e,t={},n){var l,c,f;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const y=this._cachedAssets.find(x=>x.path===e.path);y&&Object.assign(e,y)}const g=this._cachedAssets.findIndex(y=>y.path===e.path);g>=0&&this._cachedAssets.splice(g,1),this._cachedAssets.push(e)}let s;if(e!=null&&e.preImported&&(s=await e.preImported),!t.forceImport&&s){const g=await this.processImported(s,t);let y=!1;for(const x of g){if((l=x.userData)!=null&&l.rootSceneModelRoot&&[...x.children,...x.__processedChildren||[]].find(S=>S.__disposed)){y=!0;break}if(x.__disposed){y=!0;break}}if(!y||t.reimportDisposed===!1)return g}if(e.preImported=this._importFile(t.pathOverride||e.path,typeof((c=e.file)==null?void 0:c.arrayBuffer)=="function"?e.file:void 0,t,n),s=await e.preImported,s&&(s=await this.processImported(s,t)),s){const g=[];Array.isArray(s)?g.push(...s):(f=s.userData)!=null&&f.rootSceneModelRoot?g.push(...s.children):g.push(s),g.forEach(y=>{var x;return(x=y.addEventListener)==null?void 0:x.call(y,"dispose",()=>{e!=null&&e.preImported&&(e.preImported=void 0)})})}return s}async importSingle(e,t={}){var n;return typeof e=="string"?await this.importSinglePath(e,t):(n=await this.importAsset(e,t))==null?void 0:n[0]}async importSinglePath(e,t){var n;return(n=await this.importPath(e,t))==null?void 0:n[0]}async importPath(e,t={}){const n={...t};delete n.pathOverride,delete n.forceImport,delete n.reimportDisposed,delete n.fileHandler,delete n.importedFile;const s=JSON.stringify(n);let l;return l=this._cachedAssets.find(c=>c.path===e&&c._options===s)||{path:e},l._options=s,t.importedFile&&(l.file=t.importedFile),await this.importAsset(l,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){var c,f,g,y,x,S,C,L;let n=e;if(!n)return[];if(t.processImported===!1)return[n];if(Array.isArray(n)){const B=[];for(const W of n)B.push(...await this.processImported(W,t));return B}if((c=n.userData)!=null&&c.rootSceneModelRoot){if(t._rootSceneImported=!0,n.__processedChildren&&!t.forceImporterReprocess)return n.__processedChildren;if(!(n.children.length<1))return n.animations&&(n.children[0].animations||(n.children[0].animations=[]),n.children[0].animations.push(...n.animations)),n.__importedViewerConfig&&(n.children[0].__importedViewerConfig=n.__importedViewerConfig),n.userData.__importData&&(n.children[0].userData.__importData=n.userData.__importData),n.__processedChildren=await this.processImported([...n.children],t),n.__processedChildren;if(((f=n.animations)==null?void 0:f.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",n.animations),!n.__importedViewerConfig)return[];n=n.__importedViewerConfig}if((g=n.userData)!=null&&g.iModel&&(n=n.userData.iModel),(y=n.userData)!=null&&y.iMaterial&&(n=n.userData.iMaterial),n.assetImporterProcessed&&!t.forceImporterReprocess)return[n];const s=n.__rootPath,l=n.__rootBlob;if(!n.assetType){if(n.isBufferGeometry&&(n=new i.Kj0(n,new i.Wid)),n.isObject3D)if(n.isLight)n=Ri(n);else{const B=[];n.traverse(W=>{W!==n&&W.isLight&&B.push(W)});for(const W of B)Ri(W);n=new gh(n,t)}n.isTexture&&(n.assetType="texture",t._testDataTextureComplete&&(n.isDataTexture&&((x=n.image)!=null&&x.data)&&(n.image.complete=!0),(S=n.image)!=null&&S.complete&&(n.needsUpdate=!0)),t.generateMipmaps!==void 0&&(n.generateMipmaps=t.generateMipmaps),n.generateMipmaps||n.isRenderTargetTexture||(n.minFilter=n.minFilter===i.D1R?i.wem:n.minFilter,n.magFilter=n.magFilter===i.D1R?i.wem:n.magFilter)),n.isMaterial&&(n.assetType="material")}if(n.assetType!=null)return n.userData&&(n.userData.rootPath||!s||s.startsWith("blob:")||s.startsWith("/")||(n.userData.rootPath=s),l&&(n.userData.__sourceBlob=l,n.userData.__needsSourceBuffer&&(n.userData.__sourceBuffer=await l.arrayBuffer(),delete n.userData.__needsSourceBuffer))),n=await this._processors.process(n.assetType,n,{}),n.assetImporterProcessed=!0,[n];if(n instanceof Map)return[...(await this.importFiles(n,t)).values()].flat();if(n.type&&n.type!=="ViewerApp"&&n.type!=="ThreeViewer"){const B=this._viewer.getPluginByType(n.type);if(B){let W=n._importedResources||{};return n.resources&&(W=await((C=this._viewer.getManager())==null?void 0:C.importConfigResources(n.resources)),delete n.resources,n._importedResources=W),typeof B.fromJSON=="function"&&(await Promise.resolve(B.fromJSON(n,W)),n.assetImporterProcessed=!1),[]}}return n.plugins||n.type==="ViewerApp"||n.type==="ThreeViewer"?(n.resources=await((L=this._viewer.getManager())==null?void 0:L.importConfigResources(n.resources)),await this._viewer.getManager().importViewerConfig(n),n.assetImporterProcessed=!1,[]):(console.warn("unknown/null asset type: ",n,n.plugins),[n])}dispose(){var e;this.clearCache(),(e=this._processors)==null||e.dispose()}clearLoaderCache(){this._loaderCache.forEach(e=>{e.loader.dispose&&e.loader.dispose()}),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function Hr(a){if(!a)return i.ywz;const e=a.extensions.has("EXT_color_buffer_half_float")||a.capabilities.isWebGL2&&a.extensions.has("EXT_color_buffer_float"),t=a.capabilities.isWebGL2||a.extensions.has("OES_texture_float")||a.extensions.has("WEBGL_color_buffer_float");return e?i.cLu:t?i.VzW:i.ywz}function Ri(a){var t,n;if(!a.isLight||a.assetType==="light")return a;if(a.uiConfig)return console.warn("ui config already exists, not supported",a),a;let e;if(a.children.length,a.isDirectionalLight&&(e=new Ia),a.isAmbientLight&&(e=new nc),a.isSpotLight&&(e=new Dc),a.isPointLight&&(e=new Lc),e){(n=(t=e.lightObject).copy)==null||n.call(t,a);const s=a.parent;s!=null&&s.isObject3D&&(s.remove(a),a.dispose(),a.userData.iModel=e,s.add(e.lightObject),e.uuid=a.uuid),xs(e.lightObject,s)}else console.warn("unknown light type: ",a);return e}class Ja extends i.u7G{constructor(e){super(e)}async loadAsync(e,t){var l;const n=new i.hH6(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const s=await n.loadAsync(e,t);try{const c=JSON.parse(s);if(c.images&&this.importer){const f={};let g=c.images;Array.isArray(g)||(g=Object.values(g));for(const y of c.images){if(!y.url||!y.uuid)continue;const x=(l=await this.importer.importPath(y.url,{processImported:!1}))==null?void 0:l[0],S=x==null?void 0:x.source;if(!x||!S)continue;const C=new i.Hw6(S.data);C.uuid=y.uuid,f[C.uuid]=C,x.dispose()}return await lu.LoadRootPathTextures(c.textures,f||c.images,this.importer),this.parse(c,f)}return this.parse(c)}catch(c){throw console.error(c),this.manager.itemError(e),c}}parse(e,t){var g;let n;const s={p:new Promise(y=>{n=y})};if(e.images||e.textures){const y=new lu(this.manager);let x={};const S=W=>{n(),s.p=void 0,Object.values(x).forEach(q=>{var Z;q.isTexture&&((Z=q.image)!=null&&Z.complete)&&(q.needsUpdate=!0)})};let C=e.images||[];Array.isArray(C)||(C=Object.values(C));const L=t||y.parseImages(C,S);let B=e.textures;Array.isArray(B)||(B=Object.values(B)),x=y.parseTextures2(B,L,S),this.setTextures(x)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const l={...e};if(Object.entries(l).forEach(([y,x])=>{x&&typeof x=="string"&&this.textures[x]&&(l[y]=this.textures[x])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?l.vertexColors=e.vertexColors>0:l.vertexColors=e.vertexColors),e.normalScale!==void 0){const y=e.normalScale;Array.isArray(y)===!1&&(l.normalScale=[y,y])}let c=e.type;c!=="MeshPhysicalMaterial"&&c!=="MeshStandardMaterial"&&c!=="PhysicalMaterial"||(c=_o.TYPE),l.userData=ui(l.userData,void 0,!1,this);const f=((g=this.materials)==null?void 0:g.generateFromTemplateType(c,l))??super.parse(e);return this.setTextures({}),f.userData.imageLoadAwaiter=s,f}}class ri extends r.SimpleEventDispatcher{constructor(e,t,{simpleCache:n=!1,storage:s}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(n||s)&&(n&&(i.CtF.enabled=!0),s&&window.Cache&&typeof window.Cache=="function"&&s instanceof window.Cache)){const l={...i.CtF};i.CtF.get=(c,f,g)=>f?c.startsWith("data:")||c.startsWith("blob")||c.startsWith("chrome-extension")?Promise.resolve(void 0):s.match(c).then(y=>{if(y)switch(f){case"arraybuffer":return y.arrayBuffer();case"blob":return y.blob();case"document":return y.text().then(x=>new DOMParser().parseFromString(x,g??"text/html"));case"json":return y.json();default:if(g===void 0)return y.text();{const x=/charset="?([^;"\s]*)"?/i.exec(g),S=x&&x[1]?x[1].toLowerCase():void 0,C=new TextDecoder(S);return y.arrayBuffer().then(L=>C.decode(L))}}}):l.get(c),i.CtF.add=async(c,f,g)=>{if(!g)return l.add(c,f);c.startsWith("data:")||c.startsWith("blob")||c.startsWith("chrome-extension")||(await s.match(c)&&await s.delete(c),await s.put(c,new Response(f,{status:200})))},i.CtF.remove=(c,f)=>{if(!f)return l.remove(c);s.delete(c)}}this.storage=s,this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importAsset(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importPath(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}addProcessedAssets(e,t){return e.map(n=>{var s;return(s=this._viewer)==null?void 0:s.scene.addSceneObject(n,t)})}async addAssetSingle(e,t={}){var n;return e?(n=await(typeof e=="string"?this.addFromPath:this.addAsset).call(this,e,t))==null?void 0:n[0]:void 0}async addImported(e,t={}){var n;return(n=this._importer)==null?void 0:n.processImported(e,t).then(s=>(this.addProcessedAssets(s,t),s))}async addImportedSingle(e,t={}){return this.addImported(e,t).then(n=>n==null?void 0:n[0])}_sceneUpdated(e){var t;if(e.type==="addSceneObject"){const n=e.object;n.assetType==="material"&&((t=this._materials)==null||t.processMaterial(n,{}))}else console.error("Unexpected")}onAdded(e){this._viewer=e,this._materials||(this._materials=new g_,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new Nd(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(n,s)=>(__(n,l=>{var c;return(c=this._materials)==null?void 0:c.processModel(l,{recursive:!1})}),n)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(n,s)=>{var l;return(l=this.materials)!=null&&l.findMaterial(n.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),n.uuid=$(),n.userData.uuid&&(n.userData.uuid=n.uuid)),this._materials.processMaterial(n,s)}})),this._importer.Importers.push(new Ms(Ja,[_o.TypeSlug],!1,n=>(n&&(n.materials=this._materials),n&&(n.importer=this._importer),n)));const t=this.importViewerConfig.bind(this);this._importer.Importers.push(new Ms(class extends _h{async loadAsync(n,s){return t(await super.loadAsync(n,s))}},[ri.ViewerTypeSlug],!0))}onRemove(e){var t,n;e===this._viewer&&((t=this._importer)==null||t.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(n=this._materials)==null||n.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,t;return(t=(e=this._viewer)==null?void 0:e.getPluginByType("AssetExporterPlugin"))==null?void 0:t.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,t){if(!this._viewer)return{};const n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...t},s=this._viewer.toJSON(n);return e||Object.values(n).forEach(l=>{l&&Object.values(l).forEach(c=>{c.url&&(c.url.data instanceof ArrayBuffer||Array.isArray(c.url.data))&&(c.url.type==="Uint16Array"?(c.url.data instanceof Uint16Array||(c.url.data=new Uint16Array(c.url.data)),c.url.data="data:application/octet-stream;base64,"+(0,r.arrayBufferToBase64)(c.url.data.buffer)):c.url.type==="Uint8Array"?(c.url.data instanceof Uint8Array||(c.url.data=new Uint8Array(c.url.data)),c.url.data="data:application/octet-stream;base64,"+(0,r.arrayBufferToBase64)(c.url.data.buffer)):c.url.data instanceof ArrayBuffer?c.url.data="data:application/octet-stream;base64,"+(0,r.arrayBufferToBase64)(c.url.data.buffer):console.warn("Unsupported buffer type",c.url.type))})}),s.resources=n,s}exportPluginPresets(e){var n;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(n=this._viewer)==null?void 0:n.serializePlugins(t,e),resources:t}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},n=e.toJSON(t);return n.resources=t,n}async importPluginPreset(e,t){var c;const n=e.type;if(!(t=t||((c=this._viewer)==null?void 0:c.getPluginByType(n))))return void console.warn(`No plugin found for type ${n} to import preset`);if(!t.fromJSON)return void console.warn(`Plugin ${n} does not support importing presets`);const s=e.resources||{};e.resources&&delete e.resources;const l=await this.importConfigResources(s);return await t.fromJSON(e,l),l&&(e.resources=l),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const n=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,n)}applyViewerConfig(e,t){var n;if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const s of Object.values(t.materials))s.__useCount?delete s.__useCount:(n=this._materials)==null||n.unregisterMaterial(s);for(const s of Object.values(t.textures))s.__useCount&&delete s.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,t,n){var c,f,g;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const s={};Object.values(e).forEach(y=>{y&&Object.values(y).forEach(x=>{if(!x||!x.url||typeof x.url.data!="string")return;const S=x.url.data.match(/^data:.*;base64,(.*)$/);S!=null&&S[1]?x.url.data=(0,r.base64ToArrayBuffer)(S==null?void 0:S[1]):(x.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",x.url.type,"use base64"),x.url.data=new TextEncoder().encode(x.url.data).buffer)})}),t=t??new lu(this._importer.loadingManager),s.animations=e.animations?t.parseAnimations(e.animations):{},n&&n.animations&&(s.animations={...s.animations,...n.animations}),s.shapes=e.shapes?t.parseShapes(e.shapes):{},n&&n.shapes&&(s.shapes={...s.shapes,...n.shapes}),s.geometries=e.geometries?t.parseGeometries(e.geometries,s.shapes):{},n&&n.geometries&&(s.geometries={...s.geometries,...n.geometries}),s.images=e.images?await t.parseImagesAsync(Object.values(e.images)):{},n&&n.images&&(s.images={...s.images,...n.images}),await lu.LoadRootPathTextures(e.textures,s.images,this._importer),s.textures=e.textures?t.parseTextures2(Object.values(e.textures),s.images,()=>{Object.values(s.textures).forEach(y=>{var x;y.isTexture&&((x=y.image)!=null&&x.complete)&&(y.needsUpdate=!0)})}):{};for(const y of Object.entries(s.textures))y[1]=(c=await this._importer.processImported(y[1],{}))==null?void 0:c[0],y[1]?s.textures[y[0]]=y[1]:delete s.textures[y[0]];n&&n.textures&&(s.textures={...s.textures,...n.textures});const l=e.materials?Object.values(e.materials):[];for(const y of l)Object.entries(y).forEach(([x,S])=>{S&&S.resource&&S.uuid&&S.resource==="textures"&&(y[x]=S.uuid)});if(s.materials=t.parseMaterials2(l,s.textures,this._materials),n&&n.materials&&(s.materials={...s.materials,...n.materials}),e.object&&(s.object=t.parseObject(e.object,s.geometries,s.materials,s.textures,s.animations),e.skeletons&&(s.skeletons=t.parseSkeletons(e.skeletons,s.object),t.bindSkeletons(s.object,s.skeletons))),e.extras){s.extras=e.extras;for(const y of Object.values(e.extras))if(y.uuid&&y.url)if(typeof y.url=="string"){const x=await((f=this._importer)==null?void 0:f.importPath(y.url));(x==null?void 0:x.length)>0&&(s.extras[y.uuid]=x[0])}else if(y.url.data){const x=new File([(0,r.getTypedArray)(y.url.type,y.url.data)],y.url.path),S=await((g=this._importer)==null?void 0:g.importAsset({path:x.name,file:x}));(S==null?void 0:S.length)>0&&(s.extras[y.uuid]=S[0])}else console.warn("invalid URL type while loading extra resource")}return n&&n.extras&&(s.extras={...s.extras,...n.extras}),s.__isLoadedResources=!0,s}}ri.PluginType="AssetManager",ri.ViewerTypeSlug="vjson";class GA{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,t,n){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),t==null||t.addEventListener("change",this._onSelect),n&&Object.entries(n).forEach(([s,l])=>l&&this.on(s,l))}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach(n=>n(t)),this}destroy(){const e=this._el,t=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),t==null||t.removeEventListener("change",this._onSelect)}_onDrop(e){var s,l;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const t=Array.from(((s=e.dataTransfer)==null?void 0:s.files)||[]),n=Array.from(((l=e.dataTransfer)==null?void 0:l.items)||[]);if(t.length!==0||n.length!==0)if(n.length>0){const c=n.map(f=>f.webkitGetAsEntry());this._loadNextEntry(new Map,c)}else this._emit("drop",{files:new Map(t.map(c=>(c.filePath=c.name,[c.filePath,c])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const t=[].slice.call(this._inputEl.files??new FileList),n=new Map;t.forEach(s=>{s.filePath=s.webkitRelativePath||s.name,n.set(s.filePath,s)}),this._emit("drop",{files:n})}_loadNextEntry(e,t){const n=t.pop();if(n)if(n.isFile)n.file(s=>{s.filePath=n.fullPath,e.set(n.fullPath,s),this._loadNextEntry(e,t)},()=>console.error("Could not load file: %s",n.fullPath));else if(n.isDirectory){const s=n.createReader(),l=c=>{c.length?(t=t.concat(c),s.readEntries(l)):this._loadNextEntry(e,t)};s.readEntries(l)}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class kd extends r.SimpleEventDispatcher{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new i.Pa4(.5,.5,3)},this.dependencies=[ri],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new GA(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var l,c,f;if(!e)return;const t=this._viewer;if(!t)return;if(this._allowedExtensions!==void 0)for(const g of e.keys())this._allowedExtensions.includes(((l=g.split(".").pop())==null?void 0:l.toLowerCase())??"")||e.delete(g);if(e.size<1)return;const n=t.getPlugin(ri),s={type:"drop",files:e};if(this.importerParams.autoImport){const g={allowedExtensions:this.allowedExtensions,...this.importerParams};if(s.imported=await((c=n.importer)==null?void 0:c.importFiles(e,g)),this.importerParams.autoAdd){const y=[...((f=s.imported)==null?void 0:f.values())??[]].flat(2).filter(x=>!!x)??[];if(s.assets=n.addProcessedAssets(y,{...this.importerParams}),!g._rootSceneImported)for(const x of s.assets)x.modelObject&&x.modelObject.dispatchEvent({type:"select",value:x.modelObject})}}this.dispatchEvent(s)}promptForFile(){var e;(e=this._inputEl)==null||e.click()}onRemove(e){var t;(t=this._dropzone)==null||t.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(t=>"."+t).join(", "):"")}}kd.PluginType="Dropzone";var x0=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};function mf(a){return Object.getPrototypeOf(a).constructor.PluginType}class Bl extends r.SimpleEventDispatcher{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:e=!1,useRgbm:t=!0,useGBufferDepth:n=!0,screenShader:s="",...l}){super(),this.console=console,this._state=u.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(S=>this.resize()):void 0,this._lastSize=new i.FM8,this._onContextRestore=S=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=S=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===M_&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=S=>{var B;if(!S||!S.object)return;const C=S.object.__importedViewerConfig||((B=S.object.modelObject)==null?void 0:B.__importedViewerConfig);if(!C)return;const L=this.getManager();L?L.applyViewerConfig(C,C.resources):this.fromJSON(C,C.resources)},this.alert=async S=>alert(S),this.confirm=async S=>confirm(S),this.prompt=async(S,C,L=!0)=>prompt(S,C),this._useRgbm=t,this._useGBufferDepth=n,this._screenShader=s,this._canvas=l.canvas||(0,r.createCanvasElement)();let c=l.container;if(c&&!l.canvas&&c.appendChild(this._canvas),c||(c=this._canvas.parentElement??void 0),!c)throw new Error("No container.");this._container=c,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var W;const S=window.location.href,C="https://dev-sandbox.pixotronics.com/webgi/";if(!S.startsWith(C)||(0,r.getUrlQueryParam)("noUpdate")!==null)return!0;const L=(W=S.match(/\/webgi\/([0-9.a-zA-Z-]+)/))==null?void 0:W[1],B=(await(await fetch(C+"version.txt")).text()).split(`
`)[0];if(L&&L!==B){if(confirm(`New version ${B} is available, do you want to open?`)){const q=window.location.href.replace(L,B);return window.location.href=q,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const f=new Tn(void 0,void 0,this._canvas);f.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var C,L;const S=y.scene.activeCamera;if(S&&S.interactionsEnabled){const B=(C=this.getPluginByType("Progressive"))==null?void 0:C.postFrameConvergedRecordingDelta();if(B!==void 0&&B===0)return;(L=S.controls)==null||L.update()}}),this.scene=new Ii(f),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new Ps({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,colorSpace:t?K:i.aCh,type:t?i.ywz:i.cLu,depthBuffer:!n}}),this._isAntialiased=e&&this._renderer.isWebGL2;let g=!0;this._renderer.rendererObject.userData||(g=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!g;const y=this;this.renderFilter={passId:"render",passObject:new Fs(this,g),update(){const S=this.passObject;S.scene=y.scene.modelObject,S.camera=y.scene.activeCamera.cameraObject}};const x={passId:"screen",after:["render"],required:["render"],passObject:C_(s)};[this.renderFilter,x].forEach(S=>this._renderer.registerPass(S)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",S=>this.setDirty(this.scene,S)),this.scene.addEventListener("sceneMaterialUpdate",S=>this.setDirty(this.scene,S)),this.scene.addEventListener("sceneUpdate",S=>{this.setDirty(this.scene,S),S.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",S=>this.setDirty(this.scene,S)),this._renderer.addEventListener("update",S=>this.setDirty(this._renderer,S)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.scene.setBackgroundColor("#ffffff"),l.assetManager&&this.addPluginSync(new ri(void 0,void 0,typeof l.assetManager=="boolean"?{}:l.assetManager)),l.dropzone&&this.addPluginSync(new kd),this.console.log("WebGi Viewer instance initialized, version: ",Bl.VERSION)}setDirty(e,t){this._needsReset=!0,e=e??this,this.dispatchEvent({...t??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;for(const t of[...Object.values(this.plugins)])this.removePlugin(t,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)==null||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:e,deltaTime:t,xrFrame:n}){var s,l;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let c=0;c<this.maxFramePerLoop;c++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const y=[this._canvas.clientWidth,this._canvas.clientHeight];if(n){const x=(l=(s=this._renderer.rendererObject.xr.getCamera())==null?void 0:s.cameras[0])==null?void 0:l.viewport;x?(x.x===0&&x.y===0||this.console.warn("x and y must be 0?"),y[0]=x.width,y[1]=x.height,this.console.log("resize for xr",y)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...y),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:n});const f=Object.values(this.plugins).filter(y=>y.dirty);f.length>0&&this.setDirty(f),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const g=this._renderer.dirty;if(g){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(y){this.console.error(y),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!g)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return typeof e=="string"?this.getPluginByType(e):this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async getOrAddPlugin(e,...t){return this.getPlugin(e)||this.addPlugin(e,...t)}getOrAddPluginSync(e,...t){return this.getPlugin(e)||this.addPluginSync(e,...t)}async addPlugin(e,...t){let n;if(e.prototype){const l=this.getPlugin(e);if(l)return console.error(`Plugin of type ${mf(l)} already exists, no new plugin created`,l),l;n=new e(...t)}else n=e;const s=mf(n);if(!s)return this.console.error("PluginType is not defined for",n),n;for(const l of n.dependencies||[])await this.getOrAddPlugin(l);return this.plugins[s]&&(this.console.error(`Plugin of type ${s} already exists, old plugin will be removed and disposed`,this.plugins[s],n),await this.removePlugin(this.plugins[s],!0)),this.plugins[s]=n,await n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}addPluginSync(e,...t){let n;if(e.prototype){const l=this.getPlugin(e);if(l)return console.error(`Plugin of type ${mf(l)} already exists, no new plugin created`,l),l;n=new e(...t)}else n=e;const s=mf(n);if(!s)return this.console.error("PluginType is not defined for",n),n;for(const l of n.dependencies||[])this.getOrAddPluginSync(l);return this.plugins[s]&&(this.console.error(`Plugin of type ${s} already exists, old plugin will be removed and disposed`,this.plugins[s],n),this.removePluginSync(this.plugins[s],!0)),this.plugins[s]=n,n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}async addPlugins(e){for(const t of e)await this.addPlugin(t)}async addPluginsSync(e){for(const t of e)this.addPluginSync(t)}async removePlugin(e,t=!0){const n=mf(e);this.plugins[n]&&(await e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&await e.onDispose(this),this.setDirty(e))}removePluginSync(e,t=!0){const n=mf(e);this.plugins[n]&&(e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&e.onDispose(this),this.setDirty(e))}createCamera(e){const t=e.userData.iCamera??new Tn(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return e.userData.autoLookAtTarget===void 0?(t.autoLookAtTarget=!1,e.userData.autoLookAtTarget=!1):t.autoLookAtTarget=e.userData.autoLookAtTarget,t}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}async doOnce(e,t){return new Promise(n=>{const s=async(...l)=>{this.removeEventListener(e,s),n(await t(...l))};this.addEventListener(e,s)})}setBackgroundColor(e){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(e)}setBackground(e){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=e,e==null||typeof e!="string"&&typeof e!="number"&&!e.isColor)!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(e===M_)return this.scene.setBackground("environment");!e||e!=null&&e.isTexture?(this.scene.setBackground(e),e||this.scene.setBackgroundColor(e)):this.scene.setBackgroundColor(e)}getBackground(e=!1){if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),e)return this._rawBackground;let t=this._rawBackground??this.scene.getBackground();return t?(t!=null&&t.isVector4&&(t=Eo(t,7).getHexString()),t!=null&&t.isColor?t.getHexString():this._rawBackground===M_?this.scene.getEnvironment():t):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(ri)}resetCamera({rootObject:e,centerOffset:t=new i.Pa4(1,1,1),targetOffset:n=new i.Pa4(0,0,0),...s}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const l=e?new V().expandByObject(e,!0,!0):this.scene.getBounds(!0),c=l.getCenter(new i.Pa4),f=.5*l.getSize(new i.Pa4).length();c.add(n.clone().multiplyScalar(f)),this.scene.activeCamera.position=new i.Pa4(c.x+t.x*f,c.y+t.y*f,c.z+t.z*f),this.scene.activeCamera.target=c,this.setDirty()}}async fitToView(e,t=1.5,n,s){var c;const l=this.getPluginByType("CameraViews");l?await(l==null?void 0:l.animateToFitObject(e,t,n,s,{min:(((c=this.scene.activeCamera.getControls())==null?void 0:c.minDistance)??.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(e){var t;return(t=this.getManager())==null?void 0:t.addImportedSingle(e||new i.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){var n,s,l,c;if(t!=null&&t.isMaterial){const f=(s=(n=this.getManager())==null?void 0:n.materials)==null?void 0:s.findMaterial(t.uuid);if(f)return f}return(c=(l=this.getManager())==null?void 0:l.materials)==null?void 0:c.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map(n=>{var s,l;if(!t||t.includes(n[1].constructor.PluginType))return n[1].serializeWithViewer!==!1?(l=(s=n[1]).toJSON)==null?void 0:l.call(s,e):void 0}).filter(n=>!!n)}deserializePlugins(e,t){return e.forEach(n=>{var l;if(!n.type)return void this.console.warn("Invalid plugin to import ",n);const s=this.getPluginByType(n.type);s&&((l=s.fromJSON)==null||l.call(s,n,t))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){const n=Object.assign({version:Bl.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(e,t)},kn(this,!0,e));return n.backgroundIntensity=this.scene.backgroundIntensity,n.useLegacyLights=this.renderer.useLegacyLights,n.background=n.scene.background||n.scene.backgroundColor,n.background==="environment"&&(n.background="envMapBackground"),n}fromJSON(e,t){var s,l,c,f,g;const n={...e};return n.backgroundIntensity!==void 0&&((s=n.scene)==null?void 0:s.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=n.backgroundIntensity,delete n.backgroundIntensity),n.useLegacyLights!==void 0&&((l=n.renderManager)==null?void 0:l.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=n.useLegacyLights,delete n.useLegacyLights),n.background!==void 0&&((c=n.scene)==null?void 0:c.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),n.background==="envMapBackground"?n.background="environment":typeof n.background=="number"?n.background=new $e().setHex(n.background,i.GUF):typeof n.background=="string"?n.background=new $e().setStyle(n.background,i.GUF):(f=n.background)!=null&&f.isColor&&(n.background=new $e(n.background)),(g=n.background)!=null&&g.isColor?(this.scene.backgroundColor=n.background,this.scene.background=null):n.background?(this.scene.backgroundColor=new $e("#ffffff"),n.scene.background=n.background):(this.scene.backgroundColor=null,this.scene.background=null),delete n.background),ui(n,this,!0,t),Array.isArray(n.plugins)&&this.deserializePlugins(n.plugins,t),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(e,t){if(e)return await this.assetManager.addAssetSingle(e,t)}async setEnvironmentMap(e,{setBackground:t=!1,...n}={}){return this.scene.environment=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(e,{setEnvironment:t=!1,...n}={}){return this.scene.background=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void this.console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}Bl.VERSION="0.8.1",x0([Pe("renderManager")],Bl.prototype,"_renderer",void 0),x0([Pe()],Bl.prototype,"scene",void 0),x0([(0,r.onChange)(Bl.prototype._renderEnabledChanged)],Bl.prototype,"renderEnabled",void 0);const M_="envMapBackground";function C_(a){return a!=null&&a.isShaderPass2?a:new ur({...m,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(a)?a[0]:(a==null?void 0:a.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(a)?a[1]:typeof a=="string"?a:(a==null?void 0:a.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}class HA extends ur{constructor(e){super({vertexShader:m.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                    
                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha
                }
                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=i.Wl3}render(e,t,n,s,l){super.render(e,t,n,s,l),this._lastReadBuffer=n,this.needsSwap=!0}reRender(e,t,n,s){this._lastReadBuffer&&this.render(e,t,this._lastReadBuffer,n,s)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class Za extends Ur{get renderToScreen(){return this._renderToScreen}constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[ir],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var n,s;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,(s=(n=this.pass).update)==null||s.call(n),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}async onAdded(e){var t,n;return(n=(t=this._viewer)==null?void 0:t.screenShader)!=null&&n.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&(0,r.safeSetProperty)(e.renderer.passes.find(s=>s.passId==="screen"),"enabled",!1,!0,!0),e.addEventListener("postFrame",this._postFrame),super.onAdded(e)}async onRemove(e){return this._renderToScreen&&(0,r.safeSetProperty)(e.renderer.passes.find(t=>t.passId==="screen"),"enabled",!0,!0,!0),super.onRemove(e)}passCtor(e){var l,c;const t=e.screenShader,n=["",""];this._renderToScreen&&!t.isShaderPass2&&(n[0]=Array.isArray(t)?t[0]:(t==null?void 0:t.pars)||"",n[1]=Array.isArray(t)?t[1]:typeof t=="string"?t:(t==null?void 0:t.main)||"");const s=new HA(n);return(0,r.safeSetProperty)((c=(l=s.uiConfig)==null?void 0:l.children)==null?void 0:c.find(f=>(f==null?void 0:f.label)==="Enabled"),"hidden",!0,!0),s}_update(e){var t,n,s;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((t=this._viewer)==null?void 0:t.getPlugin(ir)),this._pass.passObject.material.uniforms.tTransparent.value=((s=(n=this._viewer)==null?void 0:n.renderFilter.passObject.transparentTarget)==null?void 0:s.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,t;return((t=(e=this.pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig)??{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}Za.PluginType="CombinedPostPlugin";var R_=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class gu extends Ln{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Za]}get uiConfig(){var e;return(e=this._extension)==null?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var t;await super.onAdded(e),this._extension=this.generateExtension(e),(t=e.getPlugin(Za))==null||t.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}function Cm(a,e,t){return a&~(1<<e)|(t?1:0)<<e}function Ph(a,e){return a&~(1<<e)}R_([Pe("extension")],gu.prototype,"_extension",void 0),R_([Pe()],gu.prototype,"enabled",void 0);var vl,Wu=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};const I_=i.dZ3;let lc=vl=class{constructor(a,e=!0){this.depthTonemap=e,this.toneMapping=i.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(t,n)=>this.enabled?r.glsl`
            ${this.depthTonemap?gs:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${`int getToneMapBit(in int number){return(number/2)%2;}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;
#endif
if(depth<0.00001)outColor.a=0.;
#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0
outColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);
#endif
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=a.getPlugin(Za),this._setDirty=this._setDirty.bind(this),this.depthTonemap=e}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Yn(a.fragmentShader,"#glMarker",`
gl_FragColor = ToneMapping(gl_FragColor);
`,{prepend:!0}))}onObjectRender(a,e,t){if(!this.enabled)return;const{toneMapping:n,toneMappingExposure:s,outputColorSpace:l}=t;this._rendererState.toneMapping=n,this._rendererState.toneMappingExposure=s,this._rendererState.outputColorSpace=l;let c=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==c&&(e.materialObject.defines.TONEMAP_BACKGROUND=c,e.materialObject.needsUpdate=!0),c=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==c&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=c,e.materialObject.needsUpdate=!0),c=this.renderDepth?"1":"0",e.materialObject.defines.DEBUG_DEPTH!==c&&(e.materialObject.defines.DEBUG_DEPTH=c,e.materialObject.needsUpdate=!0),t.toneMapping=this.toneMapping,t.toneMappingExposure=this.exposure,t.outputColorSpace=i.KI_,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(a,e,t){t.toneMapping=this._rendererState.toneMapping,t.toneMappingExposure=this._rendererState.toneMappingExposure,t.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}};lc.PluginType="Tonemap",Wu([Me("Mode",[["Linear",i.EoG],["Reinhard",i.CdI],["Cineon",i.YGz],["ACESFilmic",i.LY2],["Uncharted2",I_]].map(a=>({label:a[0],value:a[1]})),{limitedUi:!0}),(0,r.onChange)(vl.prototype._setDirty),Pe()],lc.prototype,"toneMapping",void 0),Wu([(0,r.onChange)(vl.prototype._setDirty),En("Tonemap Background",{limitedUi:!0}),Pe()],lc.prototype,"tonemapBackground",void 0),Wu([(0,r.onChange)(vl.prototype._setDirty),En("Clip Background"),Pe()],lc.prototype,"clipBackground",void 0),Wu([(0,r.onChange)(vl.prototype._setDirty),Hn("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),Pe()],lc.prototype,"exposure",void 0),Wu([(0,r.onChange)(vl.prototype._setDirty),Hn("Saturation",[0,2],.01,{limitedUi:!0}),Pe()],lc.prototype,"saturation",void 0),Wu([(0,r.onChange)(vl.prototype._setDirty),Hn("Contrast",[0,2],.01,{limitedUi:!0}),Pe()],lc.prototype,"contrast",void 0),Wu([(0,r.onChange)(vl.prototype._setDirty),En("Render Depth")],lc.prototype,"renderDepth",void 0),lc=vl=Wu([lt("Tonemapping")],lc);class Dh extends gu{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}async onAdded(e){var t;await super.onAdded(e),(t=e.getPlugin(ir))==null||t.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new lc(e,this.depthTonemap)}get exposure(){var e;return((e=this._extension)==null?void 0:e.exposure)??1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get saturation(){var e;return((e=this._extension)==null?void 0:e.saturation)??1}set saturation(e){this._extension&&(this._extension.saturation=e,this._extension.setDirty())}get contrast(){var e;return((e=this._extension)==null?void 0:e.contrast)??1}set contrast(e){this._extension&&(this._extension.contrast=e,this._extension.setDirty())}get toneMapping(){var e;return((e=this._extension)==null?void 0:e.toneMapping)??i.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,t){var n,s;if(e instanceof i.Kj0&&((n=e.material)!=null&&n.userData)){const l=((s=e.material)==null?void 0:s.userData.postTonemap)===!1?0:1;t.w=Cm(t.w,1,l)}}}Dh.PluginType="Tonemap",i.WdD.tonemapping_pars_fragment=i.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var Rm,P_=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let gf=Rm=class{constructor(a){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?r.glsl`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=a.getPlugin(Za),this._setDirty=this._setDirty.bind(this)}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Yn(a.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(a,e,t){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}};gf.PluginType="ChromaticAberration",P_([(0,r.onChange)(Rm.prototype._setDirty),En("Enable"),Pe()],gf.prototype,"enabled",void 0),P_([(0,r.onChange)(Rm.prototype._setDirty),Hn("Intensity",[0,.1],.001,{limitedUi:!0}),Pe()],gf.prototype,"aberrationIntensity",void 0),gf=Rm=P_([lt("ChromaticAberration")],gf);class Im extends gu{constructor(){super()}generateExtension(e){return new gf(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.aberrationIntensity)??1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Im.PluginType="ChromaticAberration";class Pm extends Ln{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}constructor(){super(),this._pipeline=[]}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map(n=>(n.passId||(console.warn("no id found for pass",n),n.passId=mn()),e.renderer.registerPass(n,!0),[n.passId,n])))}async onRemove(e){var t;if(this._passes){for(const n of[...Object.values(this._passes)]){const s=n;e.renderer.unregisterPass(s),(t=s==null?void 0:s.dispose)==null||t.call(s)}this._passes=void 0}await super.onRemove(e)}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=Object.entries(this.passes);t.passes={};for(const[s,l]of n)t.passes[s]=kn((l==null?void 0:l.passObject)??l,!1,e);return t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.passes){const n=Object.entries(this.passes);for(const[s,l]of n)ui(e.passes[s],(l==null?void 0:l.passObject)??l,!1,t)}return this}}var WA=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class D_ extends ur{constructor(e,t,n="rgba"){super({vertexShader:m.vertexShader,fragmentShader:t+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new i.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new i.FM8}},defines:{B_SRC_ACCESSOR:n}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,n,s,l){var c,f,g,y;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((c=this.uniforms.tDiffuse.value)==null?void 0:c.image.width)||0,((f=this.uniforms.tDiffuse.value)==null?void 0:f.image.height)||0),super.render(e,t,this._target,s,l),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set(((g=this.uniforms.tDiffuse.value)==null?void 0:g.image.width)||0,((y=this.uniforms.tDiffuse.value)==null?void 0:y.image.height)||0),super.render(e,this._target,t,s,l))}}WA([Pe(),Te()],D_.prototype,"smoothEnabled",void 0),WA([Pe(),Te()],D_.prototype,"edgeSharpness",void 0);var cc="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",Vc=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,Dm=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,QA=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class L_ extends ur{constructor(e,t,n){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new i.FM8(512,512)},saoData:{value:new i.Ltg},frameCount:{value:0},cameraNearFar:{value:new i.FM8(.1,1e3)},projection:{value:new i.yGw},saoBiasEpsilon:{value:new i.Pa4(1,1,1)}},vertexShader:cc,fragmentShader:`

${Vc}

${n}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){return(number/4)%2;}float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;bool disableAO=getSelectionBit(getGBufferFlags(vUv).a)>0?true:false;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(s,l,c)=>{s.defines.SSAO_ENABLED&&(s.fragmentShader=s.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`))},onObjectRender:(s,l,c)=>{var x,S;this.materialExtension.extraUniforms.tSSAOMap.value=(x=this._target)==null?void 0:x.texture;const f=l.materialObject,g=!f.transparent&&f.transmission<.001;let y=this.enabled&&g&&c.userData.screenSpaceRendering!==!1&&!((S=l.userData)!=null&&S.ssaoDisabled)?1:0;f.defines.SSAO_ENABLED!==y&&(f.defines.SSAO_ENABLED=y,f.needsUpdate=!0),y=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==y&&(this.materialExtension.extraUniforms.tSSAOMap.value=y,f.needsUpdate=!0)},parsFragmentSnippet:s=>{var l;return r.glsl`
             uniform sampler2D tSSAOMap;
             ${re("tSSAOMap",(l=this._target)==null?void 0:l.texture,s.capabilities.isWebGL2)}
            ${Dm}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:s=>{var l,c;return this.enabled?"1":"0"+((c=(l=this._target)==null?void 0:l.texture)==null?void 0:c.colorSpace)},isCompatible:s=>{var l;return!((l=s.materialObject.userData)!=null&&l.ssaoDisabled)&&s.isMeshStandardMaterial2}},this._renderer=e,this._target=t,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new D_(this._target,n,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,n,s,l){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,s,l),this._smoothEnabled&&this.bilateralPass.render(e,t,n,s,l))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const t=this.material.uniforms.saoBiasEpsilon.value;t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff}}QA([Pe()],L_.prototype,"bilateralPass",void 0),QA([Pe()],L_.prototype,"parameters",void 0);class _f extends Pm{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[ri,ir],this.setDirty=this.setDirty.bind(this)}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var t;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[as(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new L_(e.renderer,this._aoTarget,((t=e.getPlugin(ir))==null?void 0:t.getUnpackSnippet())??""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(ir)])}},()=>[e.getPlugin(ir),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get enabled(){var e,t;return((t=(e=this.passes.ssao)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssao)!=null&&t.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var n;if(this._uiConfig)return this._uiConfig;const e=this,t=e.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[t,"enabled"],onChange:e.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[t.parameters,"intensity"],onChange:e.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[t.parameters,"occlusionWorldRadius"],onChange:e.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[t.parameters,"bias"],onChange:e.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[t.parameters,"falloff"],onChange:e.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(n=t.material)==null?void 0:n.defines,"NUM_SAMPLES"],onChange:[()=>t.material.needsUpdate=!0,e.setDirty]},{type:"checkbox",property:[t.bilateralPass,"smoothEnabled"],onChange:e.setDirty},{type:"vec4",property:[t.bilateralPass,"edgeSharpness"],onChange:e.setDirty}]}}}_f.PluginType="SSAO";var Lh,_u=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let uc=Lh=class extends ur{constructor(){super({vertexShader:m.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new i.FM8},weight:{value:1},tNormalDepth:{value:null}},fragmentShader:gs+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}void main(){
#if PASS_STEP == 0 
gl_FragColor=weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new i.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(a,e,t,n,s){const l=a.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const c=t;let f=.5,g=c.width*f,y=c.height*f;const x=[];let S=l.getTempTarget({sizeMultiplier:.5,type:i.cLu});x.push(S);let C=c;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(a,S,C,n,s),C=S;let L=1;for(;L<this.bloomIterations&&(g/=2,y/=2,f/=2,!(y<2||g<2));L++){S=l.getTempTarget({sizeMultiplier:f,type:i.cLu}),x.push(S),this.material.defines.PASS_STEP=1;let W=this._weights[L];W=this._weights[L-1]!==0?this._weights[L]/this._weights[L-1]:this._weights[L],this.material.uniforms.weight.value=W,this.material.needsUpdate=!0,super.render(a,S,C,n,s),C=S}this.clear=!1;const B=a.autoClear;for(a.autoClear=!1,L-=2;L>=0;L--)S=x[L],x[L]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=i.WMw,this.material.needsUpdate=!0,a.autoClear=!1,super.render(a,S,C,n,s),this.material.blending=i.jFi,l.releaseTempTarget(C),C=S;this.clear=!0,a.autoClear=B,a.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(a,e,C,n,s)):(this.uniforms.tSource.value=c.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(a,e,C,n,s),this.uniforms.tSource.value=null),l.releaseTempTarget(C)}_updateWeights(){if(!this._weights)return;const a=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let t=0;t<this.bloomIterations;t++){let n=t*e+.1,s=1.2-n;n=Math.pow(n,this.power),s=Math.pow(s,this.power),this._weights[t]=s*(1-a)+n*a}this.setDirty()}};_u([Te()],uc.prototype,"prefilter",void 0),_u([Hn("Threshold",[0,2]),(0,r.onChange)(Lh.prototype._thresholdsUpdated),Pe()],uc.prototype,"threshold",void 0),_u([Hn("Soft Threshold",[0,1]),(0,r.onChange)(Lh.prototype._thresholdsUpdated),Pe()],uc.prototype,"softThreshold",void 0),_u([Hn("Intensity",[0,3]),Pe(),Te()],uc.prototype,"intensity",void 0),_u([Hn("Iterations",[0,7],1),(0,r.onChange)(Lh.prototype._updateWeights),Pe()],uc.prototype,"bloomIterations",void 0),_u([Hn("Radius",[0,1],.01),(0,r.onChange)(Lh.prototype._updateWeights),Pe()],uc.prototype,"radius",void 0),_u([Hn("Power",[.2,10],.01),(0,r.onChange)(Lh.prototype._updateWeights),Pe()],uc.prototype,"power",void 0),_u([En("Debug")],uc.prototype,"bloomDebug",void 0),uc=Lh=_u([lt("Bloom")],uc);class vf extends Ur{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"]}passCtor(e){return new uc}_update(e){var t,n;return(n=e.getPlugin(ir))==null||n.updateShaderProperties((t=this.pass)==null?void 0:t.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}vf.PluginType="Bloom";var w0="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",Ud=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};const E0={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new i.FM8},cameraNearFar:{value:new i.FM8}},vertexShader:cc,fragmentShader:gs+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},yf=(sr({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new i.FM8},direction:{value:new i.FM8}},vertexShader:cc,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),sr({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new i.FM8},direction:{value:new i.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:cc,fragmentShader:Vc+`
`+w0+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class Os extends ur{constructor(){super(E0,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=yf,this.nearFarBlurScale=new i.FM8(.25,.25),this.focalDepthRange=new i.FM8(.5,1.5),this.crossCenter=new i.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new $e(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=sr({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:cc,fragmentShader:gs+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=sr({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new i.FM8},direction:{value:new i.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:cc,fragmentShader:gs+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,t,n,s,l){if(!this.enabled)return;const c=e.baseRenderer,f={minFilter:i.TyD,magFilter:i.TyD,type:i.cLu,encoding:i.rnI,sizeMultiplier:.5,isAntialiased:!1,format:i.wk1,depthBuffer:!1,generateMipmaps:!1},g=c.getTempTarget(f),y=c.getTempTarget(f);if(this.computeCocMaterial.uniforms.colorTexture.value=n.texture,c.blit(void 0,g,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=g.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),c.blit(void 0,y,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=y.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),c.blit(void 0,g,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=g.texture,c.blit(void 0,y,{material:this.dofBlurMaterial});else{const x=c.getTempTarget(f);this.dofBlurMaterial.uniforms.cocTexture.value=g.texture,this.dofBlurMaterial.uniforms.colorTexture.value=g.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),c.blit(void 0,x,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=x.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),c.blit(void 0,y,{material:this.dofBlurMaterial}),c.releaseTempTarget(x)}this.material.uniforms.blurTexture.value=y.texture,this.material.uniforms.cocTexture.value=g.texture,super.render(e,t,n,s,l),c.releaseTempTarget(g),c.releaseTempTarget(y)}}Ud([Pe(),Te()],Os.prototype,"nearFarBlurScale",void 0),Ud([Pe(),Te()],Os.prototype,"focalDepthRange",void 0),Ud([Te()],Os.prototype,"crossCenter",void 0),Ud([Te()],Os.prototype,"crossRadius",void 0),Ud([Te()],Os.prototype,"crossAlpha",void 0),Ud([Te()],Os.prototype,"crossColor",void 0);class yo extends ur{constructor(e){super({vertexShader:m.vertexShader,fragmentShader:r.glsl`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new i.Ltg(1,1,1,1)},weight2:{value:new i.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}var Lm=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};const S0=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class na extends Pm{constructor(e=2*S0.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=t=>{const n=t.object;(n.modelObject||n.lightObject)&&(n.modelObject||n.lightObject).traverse(s=>{var l;(l=s==null?void 0:s.shadow)!=null&&l.camera&&s.shadow.mapSize&&this.trackedJitterCameras.add([s.shadow.camera,s.shadow.mapSize])})},this._jitterCamera=t=>{var s;const n=t.target;if(this.jitter&&n.renderer.frameCount>1){const l=(f,g)=>{const y={...S0[n.renderer.frameCount%S0.length]};f.setViewOffset(g.width,g.height,y.x,y.y,g.width,g.height)},c=n.scene.activeCamera.cameraObject;l(c,{width:n.canvas.clientWidth*n.renderer.displayCanvasScaling,height:n.canvas.clientHeight*n.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(f=>l(...f)),this._hasSetOffset=!0,(s=this._viewer)==null||s.renderer.resetShadows()}},this._resetCameraJitter=t=>{const n=t.target;this._hasSetOffset&&(n.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=qe("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this;return[as(e,{passId:"progressive",get dirty(){var n;return t.jitter&&(((n=t._viewer)==null?void 0:n.renderer.frameCount)||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends yo{render(n,s,l,c,f){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((l==null?void 0:l.texture)&&e.renderer.blit(l.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(n,s,l,c,f),e.renderer.blit(s.texture,t.lastFrame,{})}},update(){if(!t.lastFrame)return void console.error("lastFrame render target undefined");let n=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(n,n,n,n),n=1-n,this.passObject.weights2.set(n,n,n,n),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var t;return(((t=this._viewer)==null?void 0:t.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var t;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=((t=this.lastFrame)==null?void 0:t.texture)??void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}na.PluginType="Progressive",Lm([Pe(),We("Frame count")],na.prototype,"maxFrameCount",void 0),Lm([Pe(),En("Jitter")],na.prototype,"jitter",void 0);class Qu extends Ur{async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:i.wem,magFilter:i.wem,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await(0,r.timeout)(e))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[na],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500)},this._onPointerMove=e=>{var c;const t=(c=this._viewer)==null?void 0:c.canvas;if(!t)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==t)return void(this.pointerEnabled=!0);const n=t.getBoundingClientRect(),s=(e.clientX-n.left)/n.width,l=(e.clientY-n.top)/n.height;this.pointerEnabled=s<0||s>1||l<0||l>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const t=this,n=e.getPlugin(na),s=new class extends yo{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=qe("Frame Fade",this)}render(l,c,f,g,y){this.needsSwap=!1;const x=t._target;if(!x||!t.pointerEnabled||!this.enabled||!t.dirty||t._fadeTimeState<.001)return;t._toSaveFrame&&n.lastFrame&&(e.renderer.blit(n.lastFrame.texture,x),this._lastTime=0,t._toSaveFrame=!1),this.blendTexture=x==null?void 0:x.texture;const S=t._fadeTimeState/t._fadeTime;this.weights2.setScalar(S),this.weights2.w=1,this.weights1.setScalar(1-S),this.weights1.w=1,super.render(l,c,f,g,y),this.needsSwap=!0;const C=(0,r.now)();this._lastTime<10&&(this._lastTime=C-10);const L=C-this._lastTime;this._lastTime=C,t._fadeTimeState-=L}};return s.enabled=!0,s}setDirty(){var e;this.enabled&&((e=this._viewer)==null||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,t;return(t=(e=this.pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}Qu.PluginType="FrameFade";var T0=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class Bh extends Ur{passCtor(e){return new Os}constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[ir],this.enableEdit=!1,this._focalPointHit=new i.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new i.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(e,t=!0,n=!1){var s,l;this._focalPointHit.copy(e),t&&((l=(s=this._viewer)==null?void 0:s.getPlugin(Qu))==null||l.startTransition(this._frameFadeTime)),n&&(this._focalPointHitTime=(0,r.now)()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e;return((e=this.pass)==null?void 0:e.passObject.focalDepthRange.y)??0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.x)??0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.y)??0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var t,n;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(n=(t=this._viewer)==null?void 0:t.getPlugin(Qu))==null||n.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var t;await super.onAdded(e),(t=e.getPluginByType("Picking"))==null||t.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var t;return(t=e.getPluginByType("Picking"))==null||t.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_update(e){var c,f;if(!super._update(e))return!1;const t=(c=this.pass)==null?void 0:c.passObject;if(!t)return!1;const n=e.getPlugin(ir);n==null||n.updateShaderProperties(t.material),t.dofBlurMaterial.uniforms.frameCount&&((f=e.renderer)==null||f.updateShaderProperties(t.dofBlurMaterial));const s=e.scene.activeCamera;if(!s)return!1;s.cameraObject.updateMatrixWorld(!0),s.updateShaderProperties(t.material),s.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),t.focalDepthRange.x=this._tempVec.length(),t.focalDepthRange.x*=s.cameraObject.getWorldDirection(new i.Pa4).dot(this._tempVec.normalize());let l=((0,r.now)()-this._focalPointHitTime)/this.crossFadeTime;if(l=1-Math.min(1,Math.max(0,l)),Math.abs(l-t.crossAlpha)>.01&&(t.crossAlpha=l,this.setDirty()),l>0){const g=this._tempVec.copy(this._focalPointHit).project(s.cameraObject).addScalar(1).divideScalar(2);t.crossCenter.set(g.x,g.y),t.computeCocMaterial.uniformsNeedUpdate=!0,t.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var t,n,s,l,c;if(this._uiConfig)return this._uiConfig;const e=(n=(t=this._pass)==null?void 0:t.passObject)==null?void 0:n.uiConfig;return e?((l=(s=e.children)==null?void 0:s.map(f=>(0,r.getOrCall)(f)))==null||l.flat(2).forEach(f=>f&&(f.onChange=this.setDirty)),(c=e.children)==null||c.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=e,e):{}}}Bh.PluginType="DepthOfField",T0([Pe()],Bh.prototype,"enableEdit",void 0),T0([Pe("focalPoint")],Bh.prototype,"_focalPointHit",void 0),T0([Pe()],Bh.prototype,"crossFadeTime",void 0);var XA=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Ol=class extends Ln{addThinFilmLayer(a){return M0(a.materialObject)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new uE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[ri],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new i.Ltg},thinNoiseLayerFactors:{value:new i.Ltg},thinColorNoiseParams:{value:new i.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._thinFilmLayer)!=null&&t.hasThinFilm)?Vc+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(a,e,t)=>{var s;if(!this.enabled||!((s=e.materialObject.userData._thinFilmLayer)!=null&&s.hasThinFilm))return;const n="#glMarker beforeAccumulation";a.fragmentShader=a.fragmentShader.replace(n,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+n),a.defines.USE_UV=""},onObjectRender:(a,e)=>{var s;const t=(s=e.materialObject.userData)==null?void 0:s._thinFilmLayer;if(!(t!=null&&t.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(t.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(t.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(t.colorNoiseParams),this._uniforms.thinFilmFactor.value=t.filmFactor;const n=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==n&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._thinFilmLayer)!=null&&t.hasThinFilm?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2||a.isDiamondMaterial,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=a.materialObject.userData._thinFilmLayer)==null?void 0:n.hasThinFilm)||!1},set value(n){var s,l;n!==((s=a.materialObject.userData._thinFilmLayer)==null?void 0:s.hasThinFilm)&&(n?M0(a.materialObject)||e.alert("Cannot add thin film."):a.materialObject.userData._thinFilmLayer&&(a.materialObject.userData._thinFilmLayer.hasThinFilm=!1,a.materialObject.needsUpdate=!0),(l=t.uiRefresh)==null||l.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var n;return!((n=a.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a;(a=this._viewer)==null||a.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var t,n,s,l,c;await super.onAdded(a);const e=a.getPlugin(ri);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(l=(s=e==null?void 0:e.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:l.extensions)==null||c.push(hE)}async onRemove(a){var e,t,n,s;return(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(s=(n=a.getPlugin(ri))==null?void 0:n.importer)==null||s.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};function M0(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const t=e._thinFilmLayer;return t.hasThinFilm=!0,t.baseLayerFactors===void 0&&(t.baseLayerFactors=[.3,.6,1,.9]),t.noiseLayerFactors===void 0&&(t.noiseLayerFactors=[.7,.5,.9,.7]),t.colorNoiseParams===void 0&&(t.colorNoiseParams=[.5,.5,.5,.7]),t.filmFactor===void 0&&(t.filmFactor=.3),a.isMaterial&&(a.needsUpdate=!0),!0}Ol.PluginType="ThinFilmLayerPlugin",Ol.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",XA([En("Enabled",a=>({onChange:a.setDirty})),Pe()],Ol.prototype,"enabled",void 0),Ol=XA([lt("ThinFilmLayer Materials")],Ol);class uE{constructor(e){this.parser=e,this.name=Ol.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.userData||(t.userData={}),M0(t),t.userData._thinFilmLayer=ui(s,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const hE=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;t.extensions=t.extensions||{};const n=kn(e.userData._thinFilmLayer,!1);t.extensions[Ol.THIN_FILM_LAYER_GLTF_EXTENSION]=n,a.extensionsUsed[Ol.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});class Bm{async apply(e,t,n){var l,c;if(!t)return void(this.selected=void 0);let s=this.presets.find(f=>f.path===t.path);return s||(this.presets.push(t),s=t),this.selected=s,(c=(l=e.getManager())==null?void 0:l.importer)==null?void 0:c.importAsset(s,n)}constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}}class qA extends Bm{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const n=await super.apply(e,t),s=n==null?void 0:n[0];return s&&(s.colorSpace=i.KI_,e.scene.background=s),s}}class YA extends Bm{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const n=await super.apply(e,t),s=n==null?void 0:n[0];return s&&(e.scene.environment=s),s}}class KA extends Bm{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,t){const n=await super.apply(e,t),s=n==null?void 0:n[0];return(0,r.safeSetProperty)(e.getPluginByType("Diamond"),"envMap",s),s}}class Om extends Bm{async apply(e,t){var s,l;const n=await super.apply(e,t,{processImported:!1});return n?(l=(s=e.getManager())==null?void 0:s.importer)==null?void 0:l.processImported(n):void 0}}class $A extends Om{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const n=await super.apply(e,t);return n&&await e.alert("Material Library successfully imported."),n}}class Fd extends Ln{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(t=>({label:t.path.split("/").pop(),value:t.path}))],getValue:()=>{var t;return((t=e.selected)==null?void 0:t.path)||""},setValue:t=>{e.apply(this._viewer,e.presets.find(n=>n.path===t))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();(0,r.downloadFile)(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();(0,r.downloadFile)(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var t,n;await super.onAdded(e),this.presetGroups.push(new qA),this.presetGroups.push(new YA),this.presetGroups.push(new KA),this.presetGroups.push(new Om("Ground")),this.presetGroups.push(new Om("CameraViews")),this.presetGroups.push(new Om("MaterialConfiguration")),this.presetGroups.push(new $A),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(t=>{var n;return[t.name,((n=t.selected)==null?void 0:n.path)||void 0]}).filter(([,t])=>t));return e.type=Fd.PluginType,e}async fromJSON(e,t){var l,c;if(!super.fromJSON(e,t))return null;const n={...e};delete n.type;const s=[];for(const[f,g]of Object.entries(n)){const y=this.presetGroups.find(C=>C.name===f),x=y==null?void 0:y.presets;if(!y||!x)continue;const S=typeof g=="string"?{path:g}:g;s.push(y.apply(this._viewer,S))}return await Promise.all(s),(c=(l=this.uiConfig).uiRefresh)==null||c.call(l,"postFrame",!0),this}loadPresetGroups(e){var t;for(const[n,s]of Object.entries(e)){const l=(t=this.presetGroups.find(c=>c.name===n))==null?void 0:t.presets;l==null||l.push(...s)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(t=>t.path)]).filter(([,e])=>e.length>0))}}Fd.PluginType="PresetLibraryPlugin";var Nm,B_=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Af=Nm=class{constructor(a){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?r.glsl`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=a.getPlugin(Za),this._setDirty=this._setDirty.bind(this)}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Yn(a.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(a,e,t){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}};B_([(0,r.onChange)(Nm.prototype._setDirty),En("Enable"),Pe()],Af.prototype,"enabled",void 0),B_([(0,r.onChange)(Nm.prototype._setDirty),En("Multiply"),Pe()],Af.prototype,"grainMultiply",void 0),B_([(0,r.onChange)(Nm.prototype._setDirty),Hn("Intensity",[0,20],.01,{limitedUi:!0}),Pe()],Af.prototype,"grainIntensity",void 0),Af=Nm=B_([lt("FilmicGrain")],Af);class km extends gu{constructor(){super()}generateExtension(e){return new Af(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.grainIntensity)??1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e;return((e=this._extension)==null?void 0:e.grainMultiply)??!1}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}km.PluginType="FilmicGrain";class JA extends r.SimpleEventDispatcher{get scene(){return this._scene}set scene(e){var t;(t=this._scene)==null||t.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(e,t,n,s){super(),this.hoverEnabled=!1,this._scene=e,this._camera=n??this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=s??(l=>l.userData.userSelectable!==!1&&l.userData.bboxVisible!==!1&&l.material!=null&&l.material.type!=="ShadowMaterial"),this.raycaster=new i.iMs,this.mouse=new i.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",l=>this.onPointerMove(l)),this.domElement.addEventListener("pointerleave",l=>this.onPointerLeave(l)),this.domElement.addEventListener("pointerout",l=>this.onPointerLeave(l)),this.domElement.addEventListener("pointercancel",l=>this.onPointerCancel(l)),this.domElement.addEventListener("pointerenter",l=>this.onPointerEnter(l)),this.domElement.addEventListener("pointerdown",l=>this.onPointerDown(l)),this.domElement.addEventListener("pointerup",l=>this.onPointerUp(l))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=(0,r.now)(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){var t;e.isPrimary!==!1&&(this.updateMouseFromEvent(e),this.hoverEnabled&&(this.hoverObject=((t=this.checkIntersection())==null?void 0:t.intersects[0].object)??null))}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this.hoverObject=null)}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=(t==null?void 0:t.selectedObject)||null}addPasses(){}checkIntersection(){var g;const e=(g=this._camera)==null?void 0:g.cameraObject;if(!e)return null;this.raycaster.setFromCamera(this.mouse,e);let t=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const n=[];t=t.filter(y=>!n.includes(y.object.id)&&(n.push(y.object.id),!0));let l,c=null;const f=[];for(const y of t){for(c=y.object,l=y;!(c==null||c.visible&&this.selectionCondition(c));)c=c.parent;c!=null&&f.push(y)}if(t=f,t.length>0){if(c=t[0].object,l=t[0],this._firstHit&&c.id!==this._firstHit.id)c=l.object;else for(let y=0;y<t.length;y++)if(this.selectedObject&&this.selectedObject.id===t[y].object.id){const x=y+1;if(!(x<t.length))return null;l=t[x],c=l.object}this._firstHit=t[0].object}return c&&l&&c?{selectedObject:c,intersect:l,intersects:t,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const ZA=new i.ZzF,O_=new i.Pa4;class Um extends i.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new i.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new i.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new i.$TI(t,6,1);return this.setAttribute("instanceStart",new i.kB5(n,3,0)),this.setAttribute("instanceEnd",new i.kB5(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new i.$TI(t,6,1);return this.setAttribute("instanceColorStart",new i.kB5(n,3,0)),this.setAttribute("instanceColorEnd",new i.kB5(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new i.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new i.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),ZA.setFromBufferAttribute(t),this.boundingBox.union(ZA))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new i.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let s=0;for(let l=0,c=e.count;l<c;l++)O_.fromBufferAttribute(e,l),s=Math.max(s,n.distanceToSquared(O_)),O_.fromBufferAttribute(t,l),s=Math.max(s,n.distanceToSquared(O_));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class eb extends Um{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new i.Uk6(e))}}i.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new i.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},i.Vj0.line={uniforms:i.rDY.merge([i.rBU.common,i.rBU.fog,i.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Fm extends i.jyz{constructor(e){super({type:"LineMaterial",uniforms:i.rDY.clone(i.Vj0.line.uniforms),vertexShader:i.Vj0.line.vertexShader,fragmentShader:i.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const tb=new i.Pa4,nb=new i.Pa4;class ib extends i.Kj0{constructor(e=new Um,t=new Fm({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,s=new Float32Array(2*t.count);for(let c=0,f=0,g=t.count;c<g;c++,f+=2)tb.fromBufferAttribute(t,c),nb.fromBufferAttribute(n,c),s[f]=f===0?0:s[f-1],s[f+1]=s[f]+tb.distanceTo(nb);const l=new i.$TI(s,2,1);return e.setAttribute("instanceDistanceStart",new i.kB5(l,1,0)),e.setAttribute("instanceDistanceEnd",new i.kB5(l,1,1)),this}}class C0 extends i.ZAu{_updater(){const e=this._object;if(e){const t=new V().expandByObject(e,!1);t.getCenter(this.position);const n=t.getBoundingSphere(new i.aLr).radius;this.scale.setScalar(n*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(e){if(this._geometry)return;const t=new eb(e);this._geometry=t;const n=new Fm({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new i.FM8(1024,1024),dashed:!1,toneMapped:!1}),s=new ib(t,n);s.computeLineDistances(),s.scale.set(1,1,1),s.visible=!0,this.add(s)}setVisible(e){var t;e!==this.visible&&(this.visible=e,(t=this.setDirty)==null||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)==null||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class R0 extends C0{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new i.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new V().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}const zd=new i.iMs,yl=new i.Pa4,Oh=new i.Pa4,Ws=new i._fP,rb={X:new i.Pa4(1,0,0),Y:new i.Pa4(0,1,0),Z:new i.Pa4(0,0,1)},I0={type:"change"},sb={type:"mouseDown"},ob={type:"mouseUp",mode:null},ab={type:"objectChange"};class P0 extends i.Tme{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new fE;this._gizmo=n,this.add(n);const s=new mE;this._plane=s,this.add(s);const l=this;function c(Z,j){let F=j;Object.defineProperty(l,Z,{get:function(){return F!==void 0?F:j},set:function(se){F!==se&&(F=se,s[Z]=se,n[Z]=se,l.dispatchEvent({type:Z+"-changed",value:se}),l.dispatchEvent(I0))}}),l[Z]=j,s[Z]=j,n[Z]=j}c("camera",e),c("object",void 0),c("enabled",!0),c("axis",null),c("mode","translate"),c("translationSnap",null),c("rotationSnap",null),c("scaleSnap",null),c("space","world"),c("size",1),c("dragging",!1),c("showX",!0),c("showY",!0),c("showZ",!0);const f=new i.Pa4,g=new i.Pa4,y=new i._fP,x=new i._fP,S=new i.Pa4,C=new i._fP,L=new i.Pa4,B=new i.Pa4,W=new i.Pa4,q=new i.Pa4;c("worldPosition",f),c("worldPositionStart",g),c("worldQuaternion",y),c("worldQuaternionStart",x),c("cameraPosition",S),c("cameraQuaternion",C),c("pointStart",L),c("pointEnd",B),c("rotationAxis",W),c("rotationAngle",0),c("eye",q),this._offset=new i.Pa4,this._startNorm=new i.Pa4,this._endNorm=new i.Pa4,this._cameraScale=new i.Pa4,this._parentPosition=new i.Pa4,this._parentQuaternion=new i._fP,this._parentQuaternionInv=new i._fP,this._parentScale=new i.Pa4,this._worldScaleStart=new i.Pa4,this._worldQuaternionInv=new i._fP,this._worldScale=new i.Pa4,this._positionStart=new i.Pa4,this._quaternionStart=new i._fP,this._scaleStart=new i.Pa4,this._getPointer=lb.bind(this),this._onPointerDown=N_.bind(this),this._onPointerHover=dE.bind(this),this._onPointerMove=cb.bind(this),this._onPointerUp=pE.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;zd.setFromCamera(e,this.camera);const t=k_(this._gizmo.picker[this.mode],zd);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){zd.setFromCamera(e,this.camera);const t=k_(this._plane,zd,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,sb.mode=this.mode,this.dispatchEvent(sb)}}pointerMove(e){const t=this.axis,n=this.mode,s=this.object;let l=this.space;if(n==="scale"?l="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(l="world"),s===void 0||t===null||this.dragging===!1||e.button!==-1)return;zd.setFromCamera(e,this.camera);const c=k_(this._plane,zd,!0);if(c){if(this.pointEnd.copy(c.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),l==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),l==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(l==="local"&&(s.position.applyQuaternion(Ws.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),l==="world"&&(s.parent&&s.position.add(yl.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(yl.setFromMatrixPosition(s.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let f=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(f*=-1),Oh.set(f,f,f)}else yl.copy(this.pointStart),Oh.copy(this.pointEnd),yl.applyQuaternion(this._worldQuaternionInv),Oh.applyQuaternion(this._worldQuaternionInv),Oh.divide(yl),t.search("X")===-1&&(Oh.x=1),t.search("Y")===-1&&(Oh.y=1),t.search("Z")===-1&&(Oh.z=1);s.scale.copy(this._scaleStart).multiply(Oh),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const f=20/this.worldPosition.distanceTo(yl.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(yl.copy(this.rotationAxis).cross(this.eye))*f):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(rb[t]),yl.copy(rb[t]),l==="local"&&yl.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(yl.cross(this.eye).normalize())*f),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),l==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(Ws.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(Ws.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(I0),this.dispatchEvent(ab)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(ob.mode=this.mode,this.dispatchEvent(ob)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(I0),this.dispatchEvent(ab),this.pointStart.copy(this.pointEnd))}getRaycaster(){return zd}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function lb(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function dE(a){if(this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a))}}function N_(a){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function cb(a){this.enabled&&this.pointerMove(this._getPointer(a))}function pE(a){this.enabled&&(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function k_(a,e,t){const n=e.intersectObject(a,!0);for(let s=0;s<n.length;s++)if(n[s].object.visible||t)return n[s];return!1}const zm=new i.USm,Ds=new i.Pa4(0,1,0),ub=new i.Pa4(0,0,0),hb=new i.yGw,Nh=new i._fP,Vm=new i._fP,jc=new i.Pa4,db=new i.yGw,Vd=new i.Pa4(1,0,0),jd=new i.Pa4(0,1,0),jm=new i.Pa4(0,0,1),Gm=new i.Pa4,Hm=new i.Pa4,bf=new i.Pa4;class fE extends i.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new i.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new i.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const s=t.clone();s.opacity=.5;const l=e.clone();l.color.setHex(16711680);const c=e.clone();c.color.setHex(65280);const f=e.clone();f.color.setHex(255);const g=e.clone();g.color.setHex(16711680),g.opacity=.5;const y=e.clone();y.color.setHex(65280),y.opacity=.5;const x=e.clone();x.color.setHex(255),x.opacity=.5;const S=e.clone();S.opacity=.25;const C=e.clone();C.color.setHex(16776960),C.opacity=.25,e.clone().color.setHex(16776960);const L=e.clone();L.color.setHex(7895160);const B=new i.fHI(0,.04,.1,12);B.translate(0,.05,0);const W=new i.DvJ(.08,.08,.08);W.translate(0,.04,0);const q=new i.u9r;q.setAttribute("position",new i.a$l([0,0,0,1,0,0],3));const Z=new i.fHI(.0075,.0075,.5,3);function j(Ke,Je){const ft=new i.XvJ(Ke,.0075,3,64,Je*Math.PI*2);return ft.rotateY(Math.PI/2),ft.rotateX(Math.PI/2),ft}Z.translate(0,.25,0);const F={X:[[new i.Kj0(B,l),[.5,0,0],[0,0,-Math.PI/2]],[new i.Kj0(B,l),[-.5,0,0],[0,0,Math.PI/2]],[new i.Kj0(Z,l),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new i.Kj0(B,c),[0,.5,0]],[new i.Kj0(B,c),[0,-.5,0],[Math.PI,0,0]],[new i.Kj0(Z,c)]],Z:[[new i.Kj0(B,f),[0,0,.5],[Math.PI/2,0,0]],[new i.Kj0(B,f),[0,0,-.5],[-Math.PI/2,0,0]],[new i.Kj0(Z,f),null,[Math.PI/2,0,0]]],XYZ:[[new i.Kj0(new i.pQR(.1,0),S.clone()),[0,0,0]]],XY:[[new i.Kj0(new i.DvJ(.15,.15,.01),x.clone()),[.15,.15,0]]],YZ:[[new i.Kj0(new i.DvJ(.15,.15,.01),g.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Kj0(new i.DvJ(.15,.15,.01),y.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},se={X:[[new i.Kj0(new i.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new i.Kj0(new i.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new i.Kj0(new i.fHI(.2,0,.6,4),n),[0,.3,0]],[new i.Kj0(new i.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new i.Kj0(new i.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new i.Kj0(new i.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new i.Kj0(new i.pQR(.2,0),n)]],XY:[[new i.Kj0(new i.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new i.Kj0(new i.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Kj0(new i.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},pe={START:[[new i.Kj0(new i.pQR(.01,2),s),null,null,null,"helper"]],END:[[new i.Kj0(new i.pQR(.01,2),s),null,null,null,"helper"]],DELTA:[[new i.x12(function(){const Ke=new i.u9r;return Ke.setAttribute("position",new i.a$l([0,0,0,1,1,1],3)),Ke}(),s),null,null,null,"helper"]],X:[[new i.x12(q,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.x12(q,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.x12(q,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},be={XYZE:[[new i.Kj0(j(.5,1),L),null,[0,Math.PI/2,0]]],X:[[new i.Kj0(j(.5,.5),l)]],Y:[[new i.Kj0(j(.5,.5),c),null,[0,0,-Math.PI/2]]],Z:[[new i.Kj0(j(.5,.5),f),null,[0,Math.PI/2,0]]],E:[[new i.Kj0(j(.75,1),C),null,[0,Math.PI/2,0]]]},Se={AXIS:[[new i.x12(q,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Be={XYZE:[[new i.Kj0(new i.xo$(.25,10,8),n)]],X:[[new i.Kj0(new i.XvJ(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new i.Kj0(new i.XvJ(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new i.Kj0(new i.XvJ(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new i.Kj0(new i.XvJ(.75,.1,2,24),n)]]},Ge={X:[[new i.Kj0(W,l),[.5,0,0],[0,0,-Math.PI/2]],[new i.Kj0(Z,l),[0,0,0],[0,0,-Math.PI/2]],[new i.Kj0(W,l),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new i.Kj0(W,c),[0,.5,0]],[new i.Kj0(Z,c)],[new i.Kj0(W,c),[0,-.5,0],[0,0,Math.PI]]],Z:[[new i.Kj0(W,f),[0,0,.5],[Math.PI/2,0,0]],[new i.Kj0(Z,f),[0,0,0],[Math.PI/2,0,0]],[new i.Kj0(W,f),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new i.Kj0(new i.DvJ(.15,.15,.01),x),[.15,.15,0]]],YZ:[[new i.Kj0(new i.DvJ(.15,.15,.01),g),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Kj0(new i.DvJ(.15,.15,.01),y),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new i.Kj0(new i.DvJ(.1,.1,.1),S.clone())]]},Xe={X:[[new i.Kj0(new i.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new i.Kj0(new i.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new i.Kj0(new i.fHI(.2,0,.6,4),n),[0,.3,0]],[new i.Kj0(new i.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new i.Kj0(new i.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new i.Kj0(new i.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new i.Kj0(new i.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new i.Kj0(new i.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Kj0(new i.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new i.Kj0(new i.DvJ(.2,.2,.2),n),[0,0,0]]]},Qe={X:[[new i.x12(q,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.x12(q,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.x12(q,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function at(Ke){const Je=new i.Tme;for(const ft in Ke)for(let mt=Ke[ft].length;mt--;){const vt=Ke[ft][mt][0].clone(),Qt=Ke[ft][mt][1],Ht=Ke[ft][mt][2],Cn=Ke[ft][mt][3],un=Ke[ft][mt][4];vt.name=ft,vt.tag=un,Qt&&vt.position.set(Qt[0],Qt[1],Qt[2]),Ht&&vt.rotation.set(Ht[0],Ht[1],Ht[2]),Cn&&vt.scale.set(Cn[0],Cn[1],Cn[2]),vt.updateMatrix();const rn=vt.geometry.clone();rn.applyMatrix4(vt.matrix),vt.geometry=rn,vt.renderOrder=1/0,vt.position.set(0,0,0),vt.rotation.set(0,0,0),vt.scale.set(1,1,1),Je.add(vt)}return Je}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=at(F)),this.add(this.gizmo.rotate=at(be)),this.add(this.gizmo.scale=at(Ge)),this.add(this.picker.translate=at(se)),this.add(this.picker.rotate=at(Be)),this.add(this.picker.scale=at(Xe)),this.add(this.helper.translate=at(pe)),this.add(this.helper.rotate=at(Se)),this.add(this.helper.scale=at(Qe)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Vm;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let s=0;s<n.length;s++){const l=n[s];let c;l.visible=!0,l.rotation.set(0,0,0),l.position.copy(this.worldPosition),c=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),l.scale.set(1,1,1).multiplyScalar(c*this.size/4),l.tag!=="helper"?(l.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(l.name==="X"&&Math.abs(Ds.copy(Vd).applyQuaternion(t).dot(this.eye))>.99&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),l.name==="Y"&&Math.abs(Ds.copy(jd).applyQuaternion(t).dot(this.eye))>.99&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),l.name==="Z"&&Math.abs(Ds.copy(jm).applyQuaternion(t).dot(this.eye))>.99&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),l.name==="XY"&&Math.abs(Ds.copy(jm).applyQuaternion(t).dot(this.eye))<.2&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),l.name==="YZ"&&Math.abs(Ds.copy(Vd).applyQuaternion(t).dot(this.eye))<.2&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1),l.name==="XZ"&&Math.abs(Ds.copy(jd).applyQuaternion(t).dot(this.eye))<.2&&(l.scale.set(1e-10,1e-10,1e-10),l.visible=!1)):this.mode==="rotate"&&(Nh.copy(t),Ds.copy(this.eye).applyQuaternion(Ws.copy(t).invert()),l.name.search("E")!==-1&&l.quaternion.setFromRotationMatrix(hb.lookAt(this.eye,ub,jd)),l.name==="X"&&(Ws.setFromAxisAngle(Vd,Math.atan2(-Ds.y,Ds.z)),Ws.multiplyQuaternions(Nh,Ws),l.quaternion.copy(Ws)),l.name==="Y"&&(Ws.setFromAxisAngle(jd,Math.atan2(Ds.x,Ds.z)),Ws.multiplyQuaternions(Nh,Ws),l.quaternion.copy(Ws)),l.name==="Z"&&(Ws.setFromAxisAngle(jm,Math.atan2(Ds.y,Ds.x)),Ws.multiplyQuaternions(Nh,Ws),l.quaternion.copy(Ws))),l.visible=l.visible&&(l.name.indexOf("X")===-1||this.showX),l.visible=l.visible&&(l.name.indexOf("Y")===-1||this.showY),l.visible=l.visible&&(l.name.indexOf("Z")===-1||this.showZ),l.visible=l.visible&&(l.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),l.material._color=l.material._color||l.material.color.clone(),l.material._opacity=l.material._opacity||l.material.opacity,l.material.color.copy(l.material._color),l.material.opacity=l.material._opacity,this.enabled&&this.axis&&(l.name===this.axis||this.axis.split("").some(function(f){return l.name===f}))&&(l.material.color.setHex(16776960),l.material.opacity=1)):(l.visible=!1,l.name==="AXIS"?(l.visible=!!this.axis,this.axis==="X"&&(Ws.setFromEuler(zm.set(0,0,0)),l.quaternion.copy(t).multiply(Ws),Math.abs(Ds.copy(Vd).applyQuaternion(t).dot(this.eye))>.9&&(l.visible=!1)),this.axis==="Y"&&(Ws.setFromEuler(zm.set(0,0,Math.PI/2)),l.quaternion.copy(t).multiply(Ws),Math.abs(Ds.copy(jd).applyQuaternion(t).dot(this.eye))>.9&&(l.visible=!1)),this.axis==="Z"&&(Ws.setFromEuler(zm.set(0,Math.PI/2,0)),l.quaternion.copy(t).multiply(Ws),Math.abs(Ds.copy(jm).applyQuaternion(t).dot(this.eye))>.9&&(l.visible=!1)),this.axis==="XYZE"&&(Ws.setFromEuler(zm.set(0,Math.PI/2,0)),Ds.copy(this.rotationAxis),l.quaternion.setFromRotationMatrix(hb.lookAt(ub,Ds,jd)),l.quaternion.multiply(Ws),l.visible=this.dragging),this.axis==="E"&&(l.visible=!1)):l.name==="START"?(l.position.copy(this.worldPositionStart),l.visible=this.dragging):l.name==="END"?(l.position.copy(this.worldPosition),l.visible=this.dragging):l.name==="DELTA"?(l.position.copy(this.worldPositionStart),l.quaternion.copy(this.worldQuaternionStart),yl.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),yl.applyQuaternion(this.worldQuaternionStart.clone().invert()),l.scale.copy(yl),l.visible=this.dragging):(l.quaternion.copy(t),this.dragging?l.position.copy(this.worldPositionStart):l.position.copy(this.worldPosition),this.axis&&(l.visible=this.axis.search(l.name)!==-1)))}super.updateMatrixWorld(e)}}class mE extends i.Kj0{constructor(){super(new i._12(1e5,1e5,2,2),new i.vBJ({visible:!1,wireframe:!0,side:i.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Gm.copy(Vd).applyQuaternion(t==="local"?this.worldQuaternion:Vm),Hm.copy(jd).applyQuaternion(t==="local"?this.worldQuaternion:Vm),bf.copy(jm).applyQuaternion(t==="local"?this.worldQuaternion:Vm),Ds.copy(Hm),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ds.copy(this.eye).cross(Gm),jc.copy(Gm).cross(Ds);break;case"Y":Ds.copy(this.eye).cross(Hm),jc.copy(Hm).cross(Ds);break;case"Z":Ds.copy(this.eye).cross(bf),jc.copy(bf).cross(Ds);break;case"XY":jc.copy(bf);break;case"YZ":jc.copy(Gm);break;case"XZ":Ds.copy(bf),jc.copy(Hm);break;case"XYZ":case"E":jc.set(0,0,0)}break;default:jc.set(0,0,0)}jc.length()===0?this.quaternion.copy(this.cameraQuaternion):(db.lookAt(yl.set(0,0,0),jc,Ds),this.quaternion.setFromRotationMatrix(db)),super.updateMatrixWorld(e)}}class pb extends P0{_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(i.M8C.degToRad(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var t;(t=this==null?void 0:this.object)==null||t.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",t=>{const n=e==null?void 0:e.getPlugin(Qu);n&&(n.enabled=!t.value),this._scene.activeCamera.interactionsEnabled=!t.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var fb=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class Kr extends Ln{get picker(){return this._picker}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}constructor(e=R0,t=!1,n=!0,s=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=l=>{this._viewer&&(this.enabled?this.dispatchEvent(l):l.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const l=this.getSelectedObject();this.autoFocus&&l&&this.setSelectedObject(l,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=n,this.autoFocus=s}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)==null?void 0:e.selectedObject)||void 0}setSelectedObject(e,t=!1){if(!this.enabled||!this._picker)return;const n=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=n,(n||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new JA(e.scene,e.canvas,void 0,t=>{if(!t.material)return!1;let n=t,s=!1;for(;n;){if(!n.visible||((n.userData.iModel??n).assetType==="model"&&(s=!0),(n.userData.iModel??n).assetType==="widget")||n.userData.userSelectable===!1||n.userData.bboxVisible===!1)return!1;n=n.parent}return s}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new pb(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",t=>{var c,f,g;this.dispatchEvent(t);const n=((c=this._picker)==null?void 0:c.selectedObject)||void 0;if(this._pickUi){const y=n==null?void 0:n.uiConfig,x=this.uiConfig;x.children=[...this._uiConfigChildren],y&&x.children.push(y),(f=x.uiRefresh)==null||f.call(x)}const s=this._widget;s&&this._enableWidget&&(n?s.attach(n):s.detach());const l=this._transformControls;l&&((g=this._viewer)!=null&&g.scene.activeCamera.controls)&&(n&&l.enabled?l.attach(n):l.detach()),e.setDirty(),this.autoFocus&&this.focusObject(n)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",t=>{t.value===void 0?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(t.value,this.autoFocus||t.focusCamera)}),e.scene.addEventListener("addSceneObject",async t=>{var l,c;const n=t.object,s=this.getSelectedObject();if(s&&(n==null?void 0:n.assetType)==="material"&&typeof(s==null?void 0:s.setMaterial)=="function"&&((l=s==null?void 0:s.modelObject)!=null&&l.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const f=s.material;if(Array.isArray(f))console.warn("Dropping on material array not yet fully supported."),s.setMaterial(n);else{let g=Array.from((f==null?void 0:f.userData.__appliedMeshes)??[]);(g.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):g.length<1)&&(g=[s]);for(const y of g)y&&((c=y.setMaterial)==null||c.call(y,n))}}}),e.scene.addEventListener("sceneUpdate",t=>{if(!t.hierarchyChanged)return;const n=this.getSelectedObject();let s=!1;n==null||n.traverseAncestors(l=>{l===e.scene.modelObject&&(s=!0)}),s||this.setSelectedObject(void 0)})}async focusObject(e){var n,s,l;const t=(n=this._viewer)==null?void 0:n.getPluginByType("CameraViews");await(t==null?void 0:t.animateToFitObject(e,1.25,1e3,"easeOut",{min:(((l=(s=this._viewer)==null?void 0:s.scene.activeCamera.getControls())==null?void 0:l.minDistance)??.5)+.5,max:50}))}enableWidget(e){var t,n,s;if(this._enableWidget=e,e){const l=((t=this._picker)==null?void 0:t.selectedObject)||void 0;l&&((n=this._widget)==null||n.attach(l))}else(s=this._widget)==null||s.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}Kr.PluginType="Picking",fb([Pe()],Kr.prototype,"enabled",void 0),fb([Pe()],Kr.prototype,"autoFocus",void 0);var D0,U_=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Oa=D0=class extends Ln{enableCustomBump(a,e,t){var s;const n=(s=a.materialObject)==null?void 0:s.userData;if(!n)return!1;if(n._hasCustomBump===void 0){const l=n.__appliedMeshes;let c=!0;if(l)for(const{geometry:f}of l)!f||f.attributes.position&&f.attributes.normal&&f.attributes.uv||(c=!1);if(!c)return!1}return n._hasCustomBump=!0,n._customBumpScale=t??n._customBumpScale??.001,n._customBumpMap=e??n._customBumpMap,a.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new mb(e))}constructor(){super(),this.enabled=!0,this.dependencies=[ri],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new i.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(a,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(a,e,t)=>{var s;if(!this.enabled||!e.materialObject.userData._hasCustomBump)return;((s=e.materialObject.userData)==null?void 0:s._customBumpMap)&&(a.fragmentShader=Yn(a.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),a.vertexShader=Yn(a.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),a.vertexShader=Yn(a.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),a.defines.USE_UV="")},onObjectRender:(a,e)=>{var c;const t=e.materialObject.userData;if(!(t!=null&&t._hasCustomBump))return;const n=a;if(!n.isMesh||!n.geometry)return;const s=(c=t._customBumpMap)!=null&&c.isTexture?t._customBumpMap:null;this._uniforms.customBumpMap.value=s,this._uniforms.customBumpScale.value=s?t._customBumpScale:0,s&&(s.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(s.matrix));let l=this.enabled&&s?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==l&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=l,e.materialObject.needsUpdate=!0),l=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==l&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=l,e.materialObject.needsUpdate=!0),l=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==l&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=l,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t,n;return(this.enabled?"1":"0")+((e=a.materialObject.userData)!=null&&e._hasCustomBump?"1":"0")+((n=(t=a.materialObject.userData)==null?void 0:t._customBumpMap)==null?void 0:n.uuid)},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t=this.enableCustomBump,n={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return a.materialObject.userData._hasCustomBump||!1},set value(s){var l;s!==a.materialObject.userData._hasCustomBump&&(s?t(a)||e.alert("One or more geometries cannot be made anisotropic."):(a.materialObject.userData._hasCustomBump=!1,a.materialObject.needsUpdate=!0),(l=n.uiRefresh)==null||l.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",hidden:()=>!a.materialObject.userData._hasCustomBump,property:[a.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!a.materialObject.userData._hasCustomBump,property:[a.materialObject.userData,"_customBumpMap"],onChange:()=>{a.materialObject.needsUpdate=!0,this.setDirty()}},Mt(a.materialObject.userData,"_customBumpMap")]};return n}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this.enableCustomBumpSelected=()=>{var e,t,n;const a=(n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Kr))==null?void 0:t.getSelectedObject())==null?void 0:n.material;return(a==null?void 0:a.assetType)==="material"&&this.enableCustomBump(a)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var t,n,s,l,c;await super.onAdded(a);const e=a.getPlugin(ri);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(l=(s=e==null?void 0:e.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:l.extensions)==null||c.push(gb)}async onRemove(a){var t,n,s,l,c,f,g,y,x,S,C,L;(n=(t=a.getPlugin(ri))==null?void 0:t.materials)==null||n.unregisterMaterialExtension(this.materialExtension),(l=(s=a.getPlugin(ri))==null?void 0:s.importer)==null||l.removeEventListener("loaderCreate",this._loaderCreate);const e=(y=(g=(f=(c=a.getPlugin(ri))==null?void 0:c.exporter)==null?void 0:f.getExporter("gltf","glb"))==null?void 0:g.extensions)==null?void 0:y.indexOf(gb);return e!==void 0&&e!==-1&&((L=(C=(S=(x=a.getPlugin(ri))==null?void 0:x.exporter)==null?void 0:S.getExporter("gltf","glb"))==null?void 0:C.extensions)==null||L.splice(e,1)),super.onRemove(a)}};Oa.PluginType="CustomBumpMapPlugin",Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",U_([En("Enabled",a=>({onChange:a.setDirty})),Pe()],Oa.prototype,"enabled",void 0),U_([En("Bicubic",a=>({onChange:a.setDirty})),ke("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,D0.prototype.setDirty),Pe()],Oa.prototype,"bicubicFiltering",void 0),U_([Ee("Enable CustomBumpMap",a=>({hidden:()=>{var e;return!((e=a._viewer)!=null&&e.getPlugin(Kr))}}))],Oa.prototype,"enableCustomBumpSelected",void 0),Oa=D0=U_([lt("CustomBumpMap Materials")],Oa);class mb{constructor(e){this.parser=e,this.name=Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=c.customBumpScale??0;const f=c.customBumpMap;return f&&l.push(n.assignTexture(t.userData,"_customBumpMap",f).then(g=>{g.encoding=i.knz})),Promise.all(l)}}const gb=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const s={index:a.processTexture(e.userData._customBumpMap)};a.applyTextureTransform(s,e.userData._customBumpMap),n.customBumpMap=s}t.extensions[Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=n,a.extensionsUsed[Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var kh,pa=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Ss=kh=class extends Ln{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(a){this._animationTime=Math.max(0,Math.min(a,this._animationDuration))}_wheel({deltaY:a}){this.enabled&&Math.abs(a)>.001&&(this._scrollAnimationState=-1*Math.sign(a))}_drag(a){this.enabled&&this._viewer&&(this.dragAxis==="x"?this._dragAnimationState=a.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=a.delta.y*this._viewer.canvas.height/4)}_postFrame(){var l,c;if(!this._viewer)return;const a=this._viewer,e=this.animateOnScroll,t=this.animateOnDrag;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!e&&!t)return this._lastFrameTime=0,void(this._fadeDisabled&&((l=this._viewer.getPluginByType("FrameFade"))==null||l.enable(kh.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const f=(0,r.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=f-1/30);let g=f-this._lastFrameTime;if(g*=this.animationSpeed,this._lastFrameTime=f,e&&t?g*=(0,r.absMax)(this._scrollAnimationState,this._dragAnimationState):e?g*=this._scrollAnimationState:t&&(g*=this._dragAnimationState),Math.abs(g)<1e-4)return;const y=(c=this._viewer.getPluginByType("Progressive"))==null?void 0:c.postFrameConvergedRecordingDelta();if(y&&y>0&&(g=y),y===0)return;const x=Math.abs(this.timeScale);this._animationTime+=g*(x>0?x:1)}const n=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const s=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(f=>{f.mixer.setTime(s)}),!(Math.abs(n)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:n,time:s}),a.scene.activeCamera.cameraObject.userData.__animatingCamera&&a.scene.activeCamera.setDirty(),a.scene.refreshActiveCameraNearFar(),a.renderer.resetShadows(),a.setDirty(),!this._fadeDisabled){const f=this._viewer.getPluginByType("FrameFade");f&&(f.disable(kh.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[ri],this._pointerDragHelper=new r.PointerDragHelper,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=a=>{const e=a.object;if(e.assetType!=="model"||!e.modelObject||!this._viewer)return;let t=!1;e.modelObject.traverse(n=>{const s=n.animations;if(s.length<1)return;const l=Math.max(...s.map(g=>g.duration)),c=new i.Xcj(this._viewer.scene.modelRoot.modelObject),f=s.map(g=>c.clipAction(g).setLoop(this.loopAnimations?i.YKA:i.jAl,this.loopRepetitions));f.forEach(g=>g.clampWhenFinished=!0),this.animations.push({mixer:c,clips:s,actions:f,duration:l}),t=!0}),t&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new gE(e,this))}async onAdded(a){var t,n,s,l,c,f;(n=(t=a.getPlugin(ri))==null?void 0:t.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),a.scene.addEventListener("addSceneObject",this._objectAdded),(f=(c=(l=(s=a.getPlugin(ri))==null?void 0:s.exporter)==null?void 0:l.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||f.push(_b),a.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=a.canvas;let e=-1;return Object.defineProperty(a.scene.modelRoot,"currentTimelineMarker",{get:()=>e,set:g=>a.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[e=g]})}),a.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:g})=>{var x;if(!this._viewer)return;if(!g)return this._viewer.scene.activeCamera=(x=this._viewer)==null?void 0:x.scene.defaultCamera,void this._viewer.setDirty();const y=g.camera;y&&(y.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(y))}),super.onAdded(a)}async onRemove(a){var e,t;for(;this.animations.length;)this.animations.pop();return a.scene.removeEventListener("addSceneObject",this._objectAdded),(t=(e=a.getPlugin(ri))==null?void 0:e.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),a.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(a)}_onPropertyChange(a=!0){this._animationDuration=Math.max(...this.animations.map(({duration:e})=>e))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&a&&this.playAnimation()}onStateChange(){var a,e;(e=(a=this.uiConfig)==null?void 0:a.children)==null||e.map(t=>t&&(0,r.getOrCall)(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(a,e=!1){return this.playClips([a],e)}async playClips(a,e=!1){const t=[];return this.animations.forEach(({actions:n})=>{n.forEach(s=>{a.includes(s.getClip().name)&&t.push(s)})}),this.playAnimation(e,t)}async playAnimation(a=!1,e){var c;if(!this.enabled)return;let t=!1;this._animationState==="playing"&&(this.stopAnimation(!1),t=!0);let n=0;const s=!e;e||(e=[],this.animations.forEach(({mixer:f,actions:g,clips:y})=>{e.push(...g)})),t?this.resetAnimation():this.animationState!=="paused"&&(e.forEach(f=>{f.reset()}),this._animationTime=0);const l=mn();this._lastAnimId=l;for(const f of e)f.setLoop(this.loopAnimations?i.YKA:i.jAl,this.loopRepetitions),f.play(),n=Math.max(n,f.getClip().duration/Math.abs(f.timeScale));if(this._animationState="playing",(c=this._viewer)==null||c.setDirty(),s){if(!isFinite(this._animationDuration))return;await new Promise((f,g)=>{const y=()=>{this.removeEventListener("checkpointEnd",y),f()};this.addEventListener("checkpointEnd",y)})}else{const f=this.loopAnimations?this.loopRepetitions:1;if(n*=f,!isFinite(n))return;await new Promise((g,y)=>{const x=S=>{S.time>=n&&(this.removeEventListener("animationStep",x),g())};this.addEventListener("animationStep",x)})}l===this._lastAnimId&&this.stopAnimation(a)}pauseAnimation(){var a;this._animationState==="playing"?(this._animationState="paused",(a=this._viewer)==null||a.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var a;this._animationState==="paused"?(this._animationState="playing",(a=this._viewer)==null||a.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(a=!1){var e,t;this._animationState="stopped",a?this.resetAnimation():(e=this._viewer)==null||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((t=this._viewer.getPluginByType("FrameFade"))==null||t.enable(kh.PluginType),this._fadeDisabled=!1)}resetAnimation(){var a;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:e,actions:t,clips:n})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(a=this._viewer)==null||a.setDirty()):this.stopAnimation(!0)}};Ss.PluginType="GLTFAnimation",Ss.AnimationMarkersExtension="WEBGI_animation_markers",pa([Pe()],Ss.prototype,"autoIncrementTime",void 0),pa([nr()],Ss.prototype,"animationState",null),pa([nr()],Ss.prototype,"animationTime",null),pa([nr()],Ss.prototype,"animationDuration",null),pa([(0,r.onChange2)(kh.prototype._onPropertyChange),En("Loop",{limitedUi:!0}),Pe()],Ss.prototype,"loopAnimations",void 0),pa([(0,r.onChange2)(kh.prototype._onPropertyChange),Pe()],Ss.prototype,"loopRepetitions",void 0),pa([Hn("Timescale",[-2,2],.01),Pe()],Ss.prototype,"timeScale",void 0),pa([Hn("Speed",[.1,4],.1,{limitedUi:!0}),Pe()],Ss.prototype,"animationSpeed",void 0),pa([En(),Pe()],Ss.prototype,"animateOnScroll",void 0),pa([En(),Pe()],Ss.prototype,"animateOnDrag",void 0),pa([Me("Drag Axis",[{label:"x"},{label:"y"}]),Pe()],Ss.prototype,"dragAxis",void 0),pa([En(),Pe()],Ss.prototype,"autoplayOnLoad",void 0),pa([(0,r.onChange)(kh.prototype.onStateChange)],Ss.prototype,"_animationState",void 0),pa([Ee("Play/Pause",a=>({label:()=>a.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],Ss.prototype,"playPauseAnimation",null),pa([Ee("Stop",{limitedUi:!0})],Ss.prototype,"stopAnimation",null),pa([Ee("Reset",{limitedUi:!0})],Ss.prototype,"resetAnimation",null),Ss=kh=pa([lt("GLTF Animations")],Ss);class gE{constructor(e,t){this.parser=e,this.name=Ss.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){let t=[];for(const S of this.parser.json.scenes||[]){if(!S.extensions)continue;const C=S.extensions[this.name];for(const L of(C==null?void 0:C.markers)||[]){const B=L.camera!==void 0?await this.parser.getDependency("camera",L.camera):void 0;L.time===void 0&&(L.time=L.frame/30,console.error("Update timeline markers plugin for correct times.")),t.push({name:L.name,frame:L.frame,time:L.time,camera:B})}}if(t.length<1)return;t=t.sort((S,C)=>S.frame-C.frame);const n=e.scene??e.scenes[0];if(!n)return;n.userData.__markers=t;const s=this.plugin.timelineMarkers,l=t.map(S=>S.time);let c=s.length;const f=t.map(S=>c++),g=Math.max(...l)+.01;s.push(...t);const y=new i.dUE(".currentTimelineMarker",l,f,2300),x=new i.m7l("animationTimelineMarker",g,[y]);x.__gltfExport=!1,e.animations.push(x)}}const _b=a=>({afterParse(e){const t=a.json.scenes[a.json.scene||0];t.extensions=t.extensions||{};const n={markers:[]},s=[];if((Array.isArray(e)?e:[e]).forEach(l=>l.traverse(c=>{c.userData.__markers&&s.push(...c.userData.__markers)})),s.sort((l,c)=>l.frame-c.frame),!(s.length<1)){for(const l of s){const c=l.camera;if(c){const f=a.nodeMap.get(c);if(f===void 0){console.warn("Camera not found in gltf export",c,a.nodeMap);continue}const g=a.json.nodes[f].camera;l.camera=g,n.markers.push(l)}}t.extensions[Ss.AnimationMarkersExtension]=n,a.extensionsUsed[Ss.AnimationMarkersExtension]=!0}}});var Wm=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,Qm=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,xf=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,F_=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,hc=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class Nl extends ur{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}constructor(e,t,n,s=!1){super({vertexShader:cc,fragmentShader:`

${F_}
${Wm}
${Vc}
${Qm}
${n}

${xf}

varying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!s},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new i.yGw},screenSize:{value:new i.FM8},cameraPositionWorld:{value:new i.Pa4},cameraNearFar:{value:new i.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:s?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(l,c,f)=>{var S;if(!l.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=(S=this._target)==null?void 0:S.texture;const g=c.materialObject;let y=this.material.defines.SSGI_ENABLED;g.defines.SSGI_ENABLED!==y&&(g.defines.SSGI_ENABLED=y,g.needsUpdate=!0),y=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==y&&(this.materialExtension.extraUniforms.tSSGIMap.value=y,g.needsUpdate=!0);const x="vec3 totalDiffuse =";l.fragmentShader=l.fragmentShader.replace(x,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${x}`),l.fragmentShader=l.fragmentShader.replace("#include <aomap_fragment>",""),l.defines.USE_UV=""},onObjectRender:(l,c,f)=>{var S,C;const g=c.materialObject,y=!g.transparent&&g.transmission<.001,x=this.enabled&&y&&(this.renderWithCamera||this._renderer.frameCount>1)&&f.userData.screenSpaceRendering!==!1&&!((S=g.userData)!=null&&S.ssrtaoDisabled)&&!((C=g.userData)!=null&&C.ssaoDisabled)?1:0;g.defines.SSRTAO_ENABLED!==x&&(g.defines.SSRTAO_ENABLED=x,g.needsUpdate=!0)},parsFragmentSnippet:l=>{var c;return r.glsl`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${re("tSSGIMap",(c=this._target)==null?void 0:c.texture,l.capabilities.isWebGL2)}

            ${Dm}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:l=>{var c,f,g,y;return this.enabled?"1":"0"+((f=(c=this._target)==null?void 0:c.texture)==null?void 0:f.colorSpace)+((y=(g=this._target)==null?void 0:g.texture)==null?void 0:y.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:l=>{var c;return!((c=l.materialObject.userData)!=null&&c.ssaoDisabled)&&l.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[..._t(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=t,this.needsSwap=!0,this._giActivated=s,this.ssgiEnabled=s,this.bilateralPass=new D_(this._target,n,"rgba")}render(e,t,n,s,l){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,s,l),this.smoothEnabled&&this.bilateralPass.render(e,t,n,s,l))}}hc([Pe()],Nl.prototype,"bilateralPass",void 0),hc([Hn("Intensity",[0,4]),Pe(),Te()],Nl.prototype,"intensity",void 0),hc([Hn("Power",[0,3]),Pe(),Te()],Nl.prototype,"power",void 0),hc([En("Auto radius"),Pe(),Te()],Nl.prototype,"autoRadius",void 0),hc([Hn("Object Radius",[.01,10]),Pe(),Te()],Nl.prototype,"objectRadius",void 0),hc([Hn("Tolerance",[.1,5]),Pe(),Te()],Nl.prototype,"tolerance",void 0),hc([Hn("Bias",[-.3,.3]),Pe(),Te()],Nl.prototype,"bias",void 0),hc([Hn("Falloff",[1e-4,4]),Pe(),Te()],Nl.prototype,"falloff",void 0),hc([Hn("Ray Count",[1,5],1),Pe(),Te()],Nl.prototype,"rayCount",void 0),hc([Hn("Step count",[1,16],1),Pe(),ke("RTAO_STEP_COUNT")],Nl.prototype,"stepCount",void 0),hc([En("Smooth Enabled"),Pe()],Nl.prototype,"smoothEnabled",void 0),hc([En("Render with Camera")],Nl.prototype,"renderWithCamera",void 0);class Xm extends Pm{get rtgiTarget(){return this._rtgiTarget}constructor(e=!0){super(),this.dependencies=[ri,ir,na],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}async onAdded(e){var t,n;await super.onAdded(e),this.enabled=this._initEnabled,(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}get enabled(){var e,t;return((t=(e=this.passes.ssrtgi)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssrtgi)!=null&&t.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var t,n;return this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1}),(t=this._viewer)==null||t.getPluginByType("debug"),[as(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Nl(e.renderer,this._rtgiTarget,((n=e.getPlugin(ir))==null?void 0:n.getUnpackSnippet())??"",!0),update:()=>{var l;const s=this.enabled;if(s){const c=(l=this._viewer)==null?void 0:l.getPluginByType("SSAO");c!=null&&c.enabled&&(c.enabled=!1)}s&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(ir)])}},()=>[e.getPlugin(ir),e.getPlugin(na),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var t,n,s,l;const e=((n=(t=this.passes.ssrtgi)==null?void 0:t.passObject)==null?void 0:n.uiConfig)??{};return(l=(s=e.children)==null?void 0:s.map(c=>(0,r.getOrCall)(c)))==null||l.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),e}}Xm.PluginType="SSGI";let L0=class extends eo{constructor(a,e,t){super(a,e,t??new vb,new $e(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(a,e,t,n,s){this.enabled&&super.render(a,e,t,n,s)}};L0=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c}([lt("High precision Normal Buffer")],L0);class vb extends i.RSm{constructor(){super()}onBeforeRender(e,t,n,s,l){let c=l.material;Array.isArray(c)&&(c=c[0]),this.normalMap=(c==null?void 0:c.normalMap)??null,this.bumpMap=(c==null?void 0:c.bumpMap)??null,this.bumpScale=c==null?void 0:c.bumpScale,c!=null&&c.normalScale&&this.normalScale.copy(c==null?void 0:c.normalScale),this.needsUpdate=!0,this.side=c.side??i.ehD}}class Xu extends Ur{passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:i.cLu,minFilter:i.TyD,magFilter:i.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,n=new Set,s=new Set;return new class extends L0{render(l,c,f,g,y){const x=l.getRenderTarget(),S=l.getActiveCubeFace(),C=l.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:L})=>{L&&((L.transparent&&L.userData.renderToDepth||!L.transparent&&L.transmission===0&&L.userData.renderToDepth===!1)&&(n.add(L),L.transparent=!L.transparent),Math.abs(L.transmission||0)>0&&L.userData.renderToDepth&&(s.add([L,L.transmission]),L.transmission=0))}),ot(l,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(l,c,t,g,y)),n.forEach(L=>L.transparent=!L.transparent),n.clear(),s.forEach(([L,B])=>L.transmission=B),s.clear(),l.setRenderTarget(x,S,C))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var t,n;return e.renderer.disposeTarget((n=(t=this._normalTarget)==null?void 0:t.dispose)==null?void 0:n.call(t)),super.onRemove(e)}updateShaderProperties(e){var t;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled?((t=this.getNormalBuffer())==null?void 0:t.texture)??null:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}Xu.PluginType="NormalBufferPlugin";var Uh=function(a,e){return Uh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])},Uh(a,e)};function B0(a,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=a}Uh(a,e),a.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var qm,z_=function(){function a(){}return a._xfnv1a=function(e){for(var t=2166136261,n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},a}(),_E=function(a){function e(t){var n=a.call(this)||this;return n.a=e._xfnv1a(t)(),n}return B0(e,a),e.prototype.next=function(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},e}(z_),vE=function(a){function e(t){var n=a.call(this)||this,s=e._xfnv1a(t);return n.a=s(),n.b=s(),n.c=s(),n.d=s(),n}return B0(e,a),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var t=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,t=t+this.d|0,this.c=this.c+t|0,(t>>>0)/4294967296},e}(z_),yE=function(a){function e(t){var n=a.call(this)||this,s=e._xfnv1a(t);return n.a=s(),n.b=s(),n.c=s(),n.d=s(),n}return B0(e,a),e.prototype.next=function(){var t=this.b<<9,n=5*this.a;return n=n<<7|9*(n>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(n>>>0)/4294967296},e}(z_);(function(a){a.sfc32="sfc32",a.mulberry32="mulberry32",a.xoshiro128ss="xoshiro128ss"})(qm||(qm={}));var AE=function(){function a(e,t){t===void 0&&(t=qm.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return a.prototype.next=function(){return this.generator.next()},a.prototype._initializeGenerator=function(){if(function(t){return t===null}(e=this.str)||function(t){return t===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new vE(this.str);case"mulberry32":return new _E(this.str);case"xoshiro128ss":return new yE(this.str);default:return this.wrap()}},a.prototype.wrap=function(){return{next:function(){return Math.random()}}},a}(),O0=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class wf extends Ia{constructor(e,t,n,s){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new i.Pa4(10,10,10),normalDirection:new i.Pa4(.01,.98,.01).normalize(),direction:new i.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=n??{},this.randomParams=s??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,n=null){const s=new AE(e.toString()),l=new i.FM8(s.next()*Math.PI*2,Math.asin(2*s.next()-1));let c=new i.Pa4(Math.cos(l.x)*Math.cos(l.y),Math.sin(l.y),Math.sin(l.x)*Math.cos(l.y));const f=new i.FM8;for(let g=0;g<5;g++){f.set(s.next(),s.next()),c=Ym(f,this._randomParams.normalDirection,.4),s.next()<Math.sqrt(t??this._randomParams.focus)&&(f.set(s.next(),s.next()),c=Ym(f,this._randomParams.direction,Math.pow((n??this._randomParams.spread)/2,2)));const y=c.dot(this._randomParams.normalDirection);if(y>0&&y<.4)break}c.normalize(),c.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(c.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new i.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function Ym(a,e,t){e=e.clone().normalize();const n=new i.Pa4(0,-e.z,e.y).normalize(),s=new i.Pa4().crossVectors(e,n).normalize(),l=a;l.x=2*l.x*Math.PI,l.y=1-l.y*t;const c=Math.sqrt(1-l.y*l.y);return n.multiplyScalar(Math.cos(l.x)*c).add(s.multiplyScalar(Math.sin(l.x)*c)).add(e.multiplyScalar(l.y))}O0([Pe("shadowParams")],wf.prototype,"_shadowParams",void 0),O0([Pe("randomParams")],wf.prototype,"_randomParams",void 0);var Ef=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class qu extends Ln{get cameraHelper(){return this._cameraHelper}constructor(e=!0){super(),this.enabled=!0,this.light=new wf("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var n,s;if(!this.enabled)return void(this.light.layers.mask=0);const t=((n=this._viewer)==null?void 0:n.renderer.frameCount)??0;this.light.randomizePosition(t<5?0:t),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(s=this._cameraHelper)==null||s.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}async onAdded(e){await super.onAdded(e),this._cameraHelper=new i.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var t,n;e?(t=this._viewer)==null||t.scene.setDirty():(n=this._viewer)==null||n.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}qu.PluginType="RandomizedDirectionalLight",Ef([Pe()],qu.prototype,"enabled",void 0),Ef([Pe("rdLight")],qu.prototype,"light",void 0),Ef([Pe()],qu.prototype,"lightLayers",void 0);var Km=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,js=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Ho=class extends ur{constructor(a,e,t,n=!0){super({vertexShader:cc,fragmentShader:`

varying vec2 vUv;

${F_}
${Wm}
${Vc}
${Qm}
${t}

${xf}

${Km}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new i.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new i.yGw},cameraPositionWorld:{value:new i.Pa4},cameraNearFar:{value:new i.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:n?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(s,l,c)=>{var y,x,S;let f=this.enabled&&c.userData.screenSpaceRendering!==!1&&!((y=l.materialObject.userData)!=null&&y.ssreflDisabled)?1:0;if(l.materialObject.defines.SSR_ENABLED!==f&&(l.materialObject.defines.SSR_ENABLED=f,l.materialObject.needsUpdate=!0),!s.defines.SSR_ENABLED)return;f=this.material.defines.SSR_STEP_COUNT,l.materialObject.defines.SSR_STEP_COUNT!==f&&(l.materialObject.defines.SSR_STEP_COUNT=f,l.materialObject.needsUpdate=!0),f=this.material.defines.SSR_LOW_QUALITY_FRAMES,l.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==f&&(l.materialObject.defines.SSR_LOW_QUALITY_FRAMES=f,l.materialObject.needsUpdate=!0),f=this.material.defines.PERSPECTIVE_CAMERA,l.materialObject.defines.PERSPECTIVE_CAMERA!==f&&(l.materialObject.defines.PERSPECTIVE_CAMERA=f,l.materialObject.needsUpdate=!0),f=this.material.defines.SSR_INLINE,l.materialObject.defines.SSR_INLINE!==f&&(l.materialObject.defines.SSR_INLINE=f,l.materialObject.needsUpdate=!0),f=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,l.materialObject.defines.SSR_MASK_FRONT_RAYS!==f&&(l.materialObject.defines.SSR_MASK_FRONT_RAYS=f,l.materialObject.needsUpdate=!0),f=(x=l.materialObject.userData)!=null&&x.ssreflNonPhysical?"1":"0",l.materialObject.defines.SSR_NON_PHYSICAL!==f&&(l.materialObject.defines.SSR_NON_PHYSICAL=f,l.materialObject.needsUpdate=!0),f=((S=this._target)==null?void 0:S.texture)??null,this.materialExtension.extraUniforms.tSSRMap.value!==f&&(this.materialExtension.extraUniforms.tSSRMap.value=f,l.materialObject.needsUpdate=!0);const g="#glMarker beforeModulation";s.fragmentShader=s.fragmentShader.replace(g,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${g}`)},onObjectRender:(s,l,c)=>{var g;const f=this.enabled&&c.userData.screenSpaceRendering!==!1&&!((g=l.materialObject.userData)!=null&&g.ssreflDisabled)?1:0;l.materialObject.defines.SSR_ENABLED!==f&&(l.materialObject.defines.SSR_ENABLED=f,l.materialObject.needsUpdate=!0)},parsFragmentSnippet:(s,l)=>{var c,f;return!this.enabled||s.userData.screenSpaceRendering===!1||(c=l==null?void 0:l.materialObject.userData)!=null&&c.ssreflDisabled?"":`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+re("tSSRMap",(f=this._target)==null?void 0:f.texture,s.capabilities.isWebGL2)+re("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,s.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${F_}
    
    #define THREE_PACKING_INCLUDED
    ${Wm}
    
    ${Vc}
    ${Qm}
    ${gs}
    
    ${xf}
    
    ${Km}
// #endif // SSR_INLINE
#endif
`:"")+`
${Dm}
        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:s=>{var l,c,f;return this.enabled?"1":"0"+((c=(l=this._target)==null?void 0:l.texture)==null?void 0:c.colorSpace)+(this.enabled&&!((f=s.materialObject.userData)!=null&&f.ssreflDisabled)?1:0)+Object.values(this.material.defines).map(g=>g+"").join(",")},isCompatible:s=>{var l;return!((l=s.materialObject.userData)!=null&&l.ssreflDisabled)&&s.isMeshStandardMaterial2}},this.intensity=1,this.boost=new i.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=a,this._target=e,this.needsSwap=!1,this._inline=n}render(a,e,t,n,s){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(a,this._target,t,n,s),this.needsSwap=!1}}};js([Hn("Intensity",[0,4]),Pe(),Te()],Ho.prototype,"intensity",void 0),js([Ni("Boost"),Pe(),Te()],Ho.prototype,"boost",void 0),js([Hn("Object Radius",[.01,2]),Pe(),Te()],Ho.prototype,"objectRadius",void 0),js([En("Auto radius"),Pe(),Te()],Ho.prototype,"autoRadius",void 0),js([Hn("Power",[0,3]),Pe(),Te()],Ho.prototype,"power",void 0),js([Hn("Tolerance",[.1,5]),Pe(),Te()],Ho.prototype,"tolerance",void 0),js([Hn("Step count",[1,32],1),Pe(),ke("SSR_STEP_COUNT")],Ho.prototype,"stepCount",void 0),js([Hn("Low Quality Frames",[0,4],1),Pe(),ke("SSR_LOW_QUALITY_FRAMES")],Ho.prototype,"lowQualityFrames",void 0),js([En("Ignore front rays"),Pe(),ke("SSR_MASK_FRONT_RAYS")],Ho.prototype,"maskFrontRays",void 0),js([Hn("Mask front rays factor",[-1,1],.01,a=>({hidden:()=>!a.maskFrontRays})),Pe(),Te()],Ho.prototype,"maskFrontFactor",void 0),Ho=js([lt("Screen Space Reflections")],Ho);class Gd extends Pm{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[ri,ir,na],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var e,t;return((t=(e=this.passes.ssr)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssr)!=null&&t.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var t,n;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}createPasses(e){var t;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[as(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Ho(e.renderer,this._ssrTarget,((t=e.getPlugin(ir))==null?void 0:t.getUnpackSnippet())??"",this.inlineSSR)},()=>[e.getPlugin(ir),e.getPlugin(na),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var t,n,s,l;const e=((n=(t=this.passes.ssr)==null?void 0:t.passObject)==null?void 0:n.uiConfig)??{};return(l=(s=e.children)==null?void 0:s.map(c=>(0,r.getOrCall)(c)))==null||l.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),e}}Gd.PluginType="SSReflection";var Fh=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let ia=class extends Ln{makeAnisotropic(a){var t;const e=(t=a.materialObject)==null?void 0:t.userData;if(!e)return!1;if(e._isAnisotropic===void 0){const n=e.__appliedMeshes;let s=!0;if(n)for(const{geometry:l}of n)!l||l.index&&l.attributes.position&&l.attributes.normal&&l.attributes.uv||(s=!1),s&&!l.attributes.tangent&&l.computeTangents();if(!s)return!1}return e._isAnisotropic=!0,e._anisotropyFactor===void 0&&(e._anisotropyFactor=1),e._anisotropyNoise===void 0&&(e._anisotropyNoise=0),e._anisotropyDirectionMode===void 0&&(e._anisotropyDirectionMode="DIRECTION"),a.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new Sf(e))}constructor(){super(),this.enabled=!0,this.dependencies=[ri],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(a,e,t)=>{var f;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const n=(f=e.materialObject.userData)==null?void 0:f._anisotropyDirectionMap,s=r.glsl`
                //#if ANISOTROPY_ENABLED
                ${Vc}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(n?re("anisotropyDirectionMap",n,t.capabilities.isWebGL2):"")+`
`;a.fragmentShader=Yn(a.fragmentShader,"#include <common>",s,{append:!0}),a.fragmentShader=a.fragmentShader.replace("#include <lights_fragment_begin>",i.WdD.lights_fragment_begin),a.fragmentShader=Yn(Yn(a.fragmentShader,"IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));`,{prepend:!0}),"RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let l=Yn(i.WdD.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");l=Yn(l,"BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),a.fragmentShader=Yn(a.fragmentShader,"#include <lights_physical_pars_fragment>",l),a.fragmentShader=Yn(a.fragmentShader,"#include <normal_fragment_begin>",i.WdD.normal_fragment_begin),a.fragmentShader=Yn(a.fragmentShader,"#ifdef USE_NORMALMAP_TANGENTSPACE","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_TANGENT )");let c=r.glsl`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+i.WdD.lights_fragment_maps;c=Yn(c,"getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )"),c=Yn(c,"getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )"),a.fragmentShader=Yn(a.fragmentShader,"#include <lights_fragment_maps>",c),a.defines.USE_UV="",a.vertexTangents=!0},onObjectRender:(a,e)=>{var l;const t=e.materialObject.userData;if(!(t!=null&&t._isAnisotropic))return;const n=a;if(!n.isMesh||!n.geometry)return;if(!n.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=t._anisotropyFactor,this._uniforms.anisotropyNoise.value=t._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=(l=t._anisotropyDirectionMap)!=null&&l.isTexture?t._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=t._anisotropyDirection;let s=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==s&&(e.materialObject.defines.ANISOTROPY_ENABLED=s,e.materialObject.needsUpdate=!0),s=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==s&&(e.materialObject.defines.ANISOTROPY_DEBUG=s,e.materialObject.needsUpdate=!0),s=t._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(s="CONSTANT"),s=s==="DIRECTION"?2:s==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==s&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t,n;return(this.enabled?"1":"0")+((e=a.materialObject.userData)!=null&&e._isAnisotropic?"1":"0")+((n=(t=a.materialObject.userData)==null?void 0:t._anisotropyDirectionMap)==null?void 0:n.uuid)},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>{var a;return[(a=this._viewer)==null?void 0:a.renderer]},getUiConfig:a=>{const e=this._viewer,t=this.makeAnisotropic,n={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return a.materialObject.userData._isAnisotropic||!1},set value(s){var l;s!==a.materialObject.userData._isAnisotropic&&(s?t(a)||e.alert("One or more geometries cannot be made anisotropic."):(a.materialObject.userData._isAnisotropic=!1,a.materialObject.needsUpdate=!0),(l=n.uiRefresh)==null||l.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{a.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(s=>({label:s})),onChange:()=>{a.materialObject.needsUpdate=!0,this.setDirty()}}]};return n}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this.makeSelectedAnisotropic=()=>{var e,t,n;const a=(n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Kr))==null?void 0:t.getSelectedObject())==null?void 0:n.material;return(a==null?void 0:a.assetType)==="material"&&this.makeAnisotropic(a)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var t,n,s,l,c;await super.onAdded(a);const e=a.getPlugin(ri);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(l=(s=e==null?void 0:e.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:l.extensions)==null||c.push(Tf)}async onRemove(a){var e,t,n,s;return(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(s=(n=a.getPlugin(ri))==null?void 0:n.importer)==null||s.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};ia.PluginType="AnisotropyPlugin",ia.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",Fh([En("Enabled",a=>({onChange:a.setDirty})),Pe()],ia.prototype,"enabled",void 0),Fh([Ee("Make Anisotropy",a=>({hidden:()=>{var e;return!((e=a._viewer)!=null&&e.getPlugin(Kr))}}))],ia.prototype,"makeSelectedAnisotropic",void 0),ia=Fh([lt("Anisotropy Materials")],ia);class Sf{constructor(e){this.parser=e,this.name=ia.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],c=s.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=c.anisotropyFactor??0,t.userData._anisotropyNoise=c.anisotropyNoiseFactor??c.anisotropyNoise??0;let{anisotropyDirectionMode:f,anisotropyDirection:g}=c;return f||(f=c.anisotropyTextureMode),g||(g=c.anisotropyRotation),t.userData._anisotropyDirectionMode=f&&typeof(g==null?void 0:g.index)=="number"?f:"CONSTANT",f==="ROTATION"||f==="DIRECTION"?l.push(n.assignTexture(t.userData,"_anisotropyDirectionMap",g).then(y=>{y.colorSpace=i.KI_})):t.userData._anisotropyDirection=g??0,Promise.all(l)}afterRoot(e){var t;return(t=e.scene)==null||t.traverse(n=>{var c,f;if(!((f=(c=n.material)==null?void 0:c.userData)==null?void 0:f._isAnisotropic))return;const l=n.geometry;l.attributes.tangent||(l.computeTangents(),l.attributes.tangent.needsUpdate=!0)}),null}}const Tf=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.anisotropyFactor=e.userData._anisotropyFactor||1,n.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,n.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&n.anisotropyDirectionMode!=="CONSTANT"){const s={index:a.processTexture(e.userData._anisotropyDirectionMap)};a.applyTextureTransform(s,e.userData._anisotropyDirectionMap),n.anisotropyDirection=s}else n.anisotropyDirectionMode="CONSTANT",n.anisotropyDirection=e.userData._anisotropyDirection||0;t.extensions[ia.ANISOTROPY_GLTF_EXTENSION]=n,a.extensionsUsed[ia.ANISOTROPY_GLTF_EXTENSION]=!0}});var zh,Mf=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Al=zh=class extends Ln{static AddFragmentClipping(a,e,t,n,s){var f;const l=(f=a.materialObject)==null?void 0:f.userData;if(!l)return!1;l._fragmentClippingExt||(l._fragmentClippingExt={});const c=l._fragmentClippingExt;return c.clipEnabled=!0,c.clipPosition===void 0&&(c.clipPosition=(e==null?void 0:e.toArray())??[0,0,0,0]),c.clipParams===void 0&&(c.clipParams=(t==null?void 0:t.toArray())??[1,0,0,0]),c.clipMode===void 0&&(c.clipMode=n??Wo.Circle),c.clipInvert===void 0&&(c.clipInvert=s??!1),a.materialObject.isMaterial&&(a.needsUpdate=!0),!0}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new $m(e))}constructor(){super(),this.enabled=!0,this.dependencies=[ri,ir],this._plane=new i.JOQ,this._viewNormalMatrix=new i.Vkp,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new i.Ltg},fragClippingParams:{value:new i.Ltg},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._fragmentClippingExt)!=null&&t.clipEnabled)?Dm+r.glsl`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${Wo.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${Wo.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${Wo.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${Wo.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${Wo.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(a,e,t)=>{var n;this.enabled&&((n=e.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)&&(a.fragmentShader=Yn(a.fragmentShader,"#glMarker mainStart",r.glsl`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${Wo.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${Wo.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${Wo.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${Wo.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${Wo.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <encodings_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(a,e)=>{var s,l,c,f,g,y;let t=(s=e.materialObject.userData)==null?void 0:s._fragmentClippingExt;if(e.materialObject.userData.isGBufferMaterial&&a&&(t=(c=(l=a.material)==null?void 0:l.userData)==null?void 0:c._fragmentClippingExt),!(t!=null&&t.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(t.clipPosition),t.clipMode===Wo.Plane){const x=(f=this._viewer)==null?void 0:f.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(t.clipParams[0],t.clipParams[1],t.clipParams[2]),this._plane.constant=t.clipParams[3],this._viewNormalMatrix.getNormalMatrix(x),this._plane.applyMatrix4(x,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(t.clipParams);((g=this._viewer)==null?void 0:g.scene.activeCamera.cameraObject)instanceof i.cPb?this._uniforms.fragClippingCamAspect.value=(y=this._viewer)==null?void 0:y.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let n=this.enabled?1:0;n=+this._defines.FRAG_CLIPPING_DEBUG,e.materialObject.defines.FRAG_CLIPPING_DEBUG!==n&&(e.materialObject.defines.FRAG_CLIPPING_DEBUG=n,e.materialObject.needsUpdate=!0),n=+t.clipMode,e.materialObject.defines.FRAG_CLIPPING_MODE!==n&&(e.materialObject.defines.FRAG_CLIPPING_MODE=n,e.materialObject.needsUpdate=!0),n=+t.clipInvert,e.materialObject.defines.FRAG_CLIPPING_INVERSE!==n&&(e.materialObject.defines.FRAG_CLIPPING_INVERSE=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._fragmentClippingExt)!=null&&t.clipEnabled?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2||a.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var n;return((n=a.materialObject.userData._fragmentClippingExt)==null?void 0:n.clipEnabled)||!1},setValue:n=>{var s,l;n!==((s=a.materialObject.userData._fragmentClippingExt)==null?void 0:s.clipEnabled)&&(n?zh.AddFragmentClipping(a.materialObject)||e.alert("Cannot add fragment clipping extension."):a.materialObject.userData._fragmentClippingExt&&(a.materialObject.userData._fragmentClippingExt.clipEnabled=!1,a.materialObject.needsUpdate=!0),(l=t.uiRefresh)==null||l.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(Wo).map(n=>({label:n[0],value:n[1]})),hidden:()=>{var n;return!((n=a.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",bounds:[-1,1],hidden:()=>{var n;return!((n=a.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var n;return!((n=a.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var t,n,s,l,c,f,g;await super.onAdded(a);const e=a.getPlugin(ri);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(l=(s=e==null?void 0:e.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:l.extensions)==null||c.push(V_),(g=(f=a.getPlugin(ir))==null?void 0:f.material)==null||g.registerMaterialExtensions([this.materialExtension])}async onRemove(a){var e,t,n,s;return(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(s=(n=a.getPlugin(ri))==null?void 0:n.importer)==null||s.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};var Wo;Al.PluginType="FragmentClippingExtensionPlugin1",Al.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",Mf([En("Enabled",a=>({onChange:a.setDirty})),Pe()],Al.prototype,"enabled",void 0),Al=zh=Mf([lt("FragmentClipping Materials")],Al),function(a){a[a.Circle=0]="Circle",a[a.Ellipse=1]="Ellipse",a[a.Rectangle=2]="Rectangle",a[a.Plane=3]="Plane",a[a.Sphere=4]="Sphere"}(Wo||(Wo={}));class $m{constructor(e){this.parser=e,this.name=Al.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.userData||(t.userData={}),Al.AddFragmentClipping(t),t.userData._fragmentClippingExt=ui(s,t.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const V_=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._fragmentClippingExt||!e.userData._fragmentClippingExt.clipEnabled)return;t.extensions=t.extensions||{};const n=kn(e.userData._fragmentClippingExt,!1);t.extensions[Al.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=n,a.extensionsUsed[Al.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var Hd,Wd=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let dc=Hd=class extends Ln{constructor(a=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new i.Pa4(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=a,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var n,s,l;if(!this._viewer)return;const a=this._viewer.scene.background;if(this.enabled&&a!==this._viewer.scene.environment&&a!=="environment")if(a&&a.isDataTexture)a.mapping=i.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const c=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");c?(c.envmapBg=!0,(s=(n=c.uiConfig).uiRefresh)==null||s.call(n,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const e=(l=this._viewer.renderer.rendererObject.background.getBoxMesh2())==null?void 0:l.material,t=(e==null?void 0:e.uniforms)??i.Vj0.backgroundCube.uniforms;t.tripodHeight||(t.tripodHeight={value:1}),t.worldRadius||(t.worldRadius={value:1}),t.originPosition||(t.originPosition={value:new i.Pa4}),t.tripodHeight.value=this.tripodHeight,t.worldRadius.value=this.worldRadius,t.originPosition.value.copy(this.originPosition),e&&(!this.enabled&&e.defines.HDRi_GROUND_PROJ?delete e.defines.HDRi_GROUND_PROJ:this.enabled&&(e.defines.HDRi_GROUND_PROJ="1"),e.needsUpdate=!0),this._viewer.setDirty()}async onAdded(a){var e,t,n;await super.onAdded(a),(n=(t=(e=this._viewer)==null?void 0:e.renderer)==null?void 0:t.rendererObject)!=null&&n.background.getBoxMesh()&&a.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),i.Vj0.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(i.Vj0.backgroundCube.fragmentShader=Yn(i.Vj0.backgroundCube.fragmentShader,"void main() {",`#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif
`,{prepend:!0}),i.Vj0.backgroundCube.fragmentShader=Yn(i.Vj0.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),a.scene.addEventListener("environmentChanged",this._paramsChanged)}};dc.PluginType="HDRiGroundPlugin",Wd([Pe(),(0,r.onChange)(Hd.prototype._paramsChanged),En("Enabled")],dc.prototype,"enabled",void 0),Wd([Pe(),(0,r.onChange)(Hd.prototype._paramsChanged),Hn("World Radius",[1,1e3],.01)],dc.prototype,"worldRadius",void 0),Wd([Pe(),(0,r.onChange)(Hd.prototype._paramsChanged),Hn("Tripod height",[0,50],.01)],dc.prototype,"tripodHeight",void 0),Wd([Pe(),(0,r.onChange)(Hd.prototype._paramsChanged),Ni("Origin Position",void 0,.001,a=>({onChange:a._paramsChanged}))],dc.prototype,"originPosition",void 0),dc=Hd=Wd([lt("HDRi Ground")],dc);var Qd,vu=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let fa=Qd=class extends Ln{constructor(a=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[ir,ri],this.materialExtension={shaderExtender:(e,t,n)=>{if(!e.defines.SSCS_ENABLED)return;const s=r.glsl`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,l=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${F_}
    
    #define THREE_PACKING_INCLUDED
    ${Wm}
    
    ${gs}
    ${Vc}
    
    ${xf}

#endif
            
            `+i.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${s}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",l),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",i.WdD.lights_fragment_begin),e.fragmentShader=Yn(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),e.fragmentShader=Yn(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,n)=>{var c;const s=t.materialObject;let l=this.enabled&&n.userData.screenSpaceRendering!==!1&&!((c=s.userData)!=null&&c.sscsDisabled)?1:0;s.defines.SSCS_ENABLED!==l&&(s.defines.SSCS_ENABLED=l,s.needsUpdate=!0),l=this._defines.SSCS_STEP_COUNT,s.defines.SSCS_STEP_COUNT!==l&&(s.defines.SSCS_STEP_COUNT=l,s.needsUpdate=!0),l=+this._defines.SSCS_DEBUG,s.defines.SSCS_DEBUG!==l&&(s.defines.SSCS_DEBUG=l,s.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...Qd._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,t,n,s,l;return[(e=this._viewer)==null?void 0:e.getPlugin(ir),(t=this._viewer)==null?void 0:t.getPlugin(na),(n=this._viewer)==null?void 0:n.scene.activeCamera,(s=this._viewer)==null?void 0:s.renderer,(l=this._viewer)==null?void 0:l.scene]}},this.enabled=a,this.userData={setDirty:()=>{var e;(e=this._viewer)==null||e.setDirty()}}}async onAdded(a){var e,t;await super.onAdded(a),(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension)}async onRemove(a){var e,t;return(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),super.onRemove(a)}};fa.PluginType="SSContactShadows",fa._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new i.yGw},cameraPositionWorld:{value:new i.Pa4},cameraNearFar:{value:new i.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},vu([En("Enabled"),Pe()],fa.prototype,"enabled",void 0),vu([Te({uniforms:Qd._uniforms,propKey:"sscsRadius"}),Hn("Radius",[1e-4,.1],1e-4),Pe()],fa.prototype,"radius",void 0),vu([Te({uniforms:Qd._uniforms,propKey:"sscsIntensity"}),Hn("Intensity",[1e-4,1],1e-4),Pe()],fa.prototype,"intensity",void 0),vu([Te({uniforms:Qd._uniforms,propKey:"sscsTolerance"}),Hn("Tolerance",[.1,5]),Pe()],fa.prototype,"tolerance",void 0),vu([ke("SSCS_DEBUG",void 0,!0),En("Debug only SSCS"),Pe()],fa.prototype,"onlySSCSDebug",void 0),vu([ke("SSCS_STEP_COUNT",void 0,!0),Hn("Step count",[1,8],1),Pe()],fa.prototype,"stepCount",void 0),fa=Qd=vu([lt("Screen Space Contact Shadows")],fa);class Cf{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new i.xsS,this._mesh=new i.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new N0}dispose(){var e;(e=this._mesh.geometry)==null||e.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(e){e.split(";").forEach(t=>{var n;return(n=this._normalsCache[t])==null?void 0:n.dispose()})}disposeAllTargets(){Object.values(this._normalsCache).forEach(e=>e.dispose())}hasCapturedNormalMap(e){return!!e.userData._normalsCaptureMap}captureNormalMap(e,t,n=512){if(!e)throw"No geometry";if(this.hasCapturedNormalMap(e))return!1;const s=t==null?void 0:t.split(";").find(f=>this._normalsCache[f]);if(s){const f=this._normalsCache[s];return t==null||t.split(";").forEach(g=>g!==s&&(this._normalsCache[g]=f)),f.width!==n&&console.warn("last cacheKey normalMapRes mismatch, check model",n),e.userData._normalsCaptureMap=f,!1}const l=this._renderer.createTargetCustom({width:n,height:n},{minFilter:i.TyD,magFilter:i.TyD,generateMipmaps:!1,type:i.cLu},i.oAp);if(l.attachedGeometries=[],l.autoDispose=Cf.AutoDisposeTargets,!l)throw"Unable to create render target";const c=()=>{const f=new i._am(1e-4,100,l);this._scene.add(f);const g=e.userData.normalsCaptureOffsets;g.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.fromArray(g.center),g.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(g.offsetMatrixInv),g.radius!==void 0&&(this._mesh.material.uniforms.radius.value=g.radius),this._mesh.geometry=e,f.update(this._renderer.rendererObject,this._scene),this._scene.remove(f),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=l};return c(),this._renderer.addEventListener("contextRestored",c),l.attachedGeometries.push(e),e.addEventListener("dispose",()=>{var f;l.attachedGeometries=((f=l.attachedGeometries)==null?void 0:f.filter(g=>g!==e))??[],delete e.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",c),l.autoDispose&&!l.attachedGeometries.length&&l.dispose()}),t==null||t.split(";").forEach(f=>this._normalsCache[f]=l),l.addEventListener("dispose",()=>{t==null||t.split(";").forEach(f=>delete this._normalsCache[f]),this._renderer.removeEventListener("contextRestored",c),delete e.userData._normalsCaptureMap}),!0}}Cf.AutoDisposeTargets=!0;class N0 extends i.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:i.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new i.yGw().identity()},offsetCenter:{value:new i.Pa4}}})}}var yb=__webpackgi_require__(654);function k0(a){const e=new i.Pa4(0,0,0),t=new i.Pa4(0,0,0),n=new i.Pa4(0,0,0),s=new i.Pa4(0,0,0),l=a.getAttribute("position"),c=a.index;if(c)for(let C=Math.max(0,a.drawRange.start),L=Math.min(c.count,a.drawRange.start+a.drawRange.count)-1;C<L/3;C+=3){const B=c.getX(C),W=c.getX(C+1),q=c.getX(C+2);t.set(l.getX(B),l.getY(B),l.getZ(B)),n.set(l.getX(W),l.getY(W),l.getZ(W)),s.set(l.getX(q),l.getY(q),l.getZ(q)),n.sub(t),s.sub(t),s.cross(n),s.normalize(),e.add(s)}else for(let C=0;C<l.count;C+=3)t.set(l.getX(C),l.getY(C),l.getZ(C)),n.set(l.getX(C+1),l.getY(C+1),l.getZ(C+1)),s.set(l.getX(C+2),l.getY(C+2),l.getZ(C+2)),n.sub(t),s.sub(t),s.cross(n),s.normalize(),e.add(s);e.normalize();let f=!1,g=0;for(;!f;){const C=g/3,L=c?c.getX(C):C,B=c?c.getX(C+1):C+1;t.set(l.getX(L),l.getY(L),l.getZ(L)),n.set(l.getX(B),l.getY(B),l.getZ(B)),t.sub(n),t.normalize();const W=e.dot(t);Math.abs(W-1)>.001&&t.length()>.5&&(f=!0),g+=3}n.crossVectors(t,e),n.normalize(),t.crossVectors(e,n),t.normalize();const y=new i.yGw;y.elements[0]=t.x,y.elements[1]=t.y,y.elements[2]=t.z,y.elements[3]=0,y.elements[4]=e.x,y.elements[5]=e.y,y.elements[6]=e.z,y.elements[7]=0,y.elements[8]=n.x,y.elements[9]=n.y,y.elements[10]=n.z,y.elements[11]=0,y.elements[12]=0,y.elements[13]=0,y.elements[14]=0,y.elements[15]=1,a.computeBoundingSphere();const x=a.boundingSphere.radius,S=new i.yGw().makeScale(x,x,x);return y.multiply(S),y}function Ab(a,e,t){const n=new i.Pa4().copy(a),s=new i.Pa4().copy(e),l=new i.Pa4().copy(t);return n.dot(s.cross(l))/6}function bE(a,e,t){const n=new i.Pa4().copy(a),s=new i.Pa4().copy(e),l=new i.Pa4().copy(t);return s.sub(n),l.sub(n),l.cross(s),.5*l.length()}function U0(a){const e=a.getAttribute("position"),t=a.getAttribute("normal");if(e.count/3>500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",e.count/3),k0(a);const n=new i.Pa4(0,0,0),s=new i.Pa4(0,0,0),l=new i.Pa4(0,0,0),c=a.index,f=[];if(c)for(let Z=Math.max(0,a.drawRange.start),j=Math.min(c.count,a.drawRange.start+a.drawRange.count)-1;Z<j;Z+=3){const F=c.getX(Z),se=c.getX(Z+1),pe=c.getX(Z+2);n.set(e.getX(F),e.getY(F),e.getZ(F)),s.set(e.getX(se),e.getY(se),e.getZ(se)),l.set(e.getX(pe),e.getY(pe),e.getZ(pe)),f.push(n.toArray(),s.toArray(),l.toArray())}else for(let Z=0;Z<e.count;Z++)n.set(e.getX(Z),e.getY(Z),e.getZ(Z)),f.push(n.toArray());const g=function(Z,j){const F=new i.Pa4;for(let Qe=0;Qe<Z.length;Qe+=3)F.x+=Z[Qe],F.y+=Z[Qe+1],F.z+=Z[Qe+2];F.multiplyScalar(1/(Z.length/3));const se=new i.Pa4,pe=new i.Pa4,be=new i.Pa4,Se=new i.Pa4,Be=new i.Pa4;let Ge=0,Xe=0;for(let Qe=0;Qe<j.length;Qe+=3){se.set(j[Qe][0],j[Qe][1],j[Qe][2]),pe.set(j[Qe+1][0],j[Qe+1][1],j[Qe+1][2]),be.set(j[Qe+2][0],j[Qe+2][1],j[Qe+2][2]),Be.copy(se).add(pe).add(be);const at=bE(se,pe,be);Be.multiplyScalar(at/3),Se.add(Be),Ge+=at,Xe+=Ab(se,pe,be)}return Se.multiplyScalar(1/Ge),{centre:F,com:Se,volume:Xe,area:Ge}}(e.array,f);if(g.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let Z=0;Z<t.count;Z++)t.setX(Z,-t.getX(Z)),t.setY(Z,-t.getY(Z)),t.setZ(Z,-t.getZ(Z));t.needsUpdate=!0}const y=[];for(let Z=0;Z<e.array.length;Z+=3)y.push([e.array[Z],e.array[Z+1],e.array[Z+2]]);const x=console.log;console.log=()=>{};const S=(0,yb.getEigenVectors)(y);console.log=x;const C=new i.yGw;C.elements[0]=S[0].vector[0],C.elements[1]=S[0].vector[1],C.elements[2]=S[0].vector[2],C.elements[3]=0,C.elements[4]=S[1].vector[0],C.elements[5]=S[1].vector[1],C.elements[6]=S[1].vector[2],C.elements[7]=0,C.elements[8]=S[2].vector[0],C.elements[9]=S[2].vector[1],C.elements[10]=S[2].vector[2],C.elements[11]=0,C.elements[12]=0,C.elements[13]=0,C.elements[14]=0,C.elements[15]=1;const L=new i.Pa4;L.copy(g.com).sub(g.centre),L.normalize();const B=new i.Pa4(S[2].vector[0],S[2].vector[1],S[2].vector[2]);L.dot(B)<0&&(C.elements[4]=-S[1].vector[0],C.elements[5]=-S[1].vector[1],C.elements[6]=-S[1].vector[2],C.elements[8]=-S[2].vector[0],C.elements[9]=-S[2].vector[1],C.elements[10]=-S[2].vector[2]),a.computeBoundingSphere();const W=a.boundingSphere.radius,q=new i.yGw().makeScale(W,W,W);return C.multiply(q),C}const Xd={...Sc,color:new $e(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new i.Pa4(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var ma=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class ls extends i.jyz{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,n,s,l){var g,y;super.onBeforeRender(e,t,n,s,l),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(((g=this.envMap)==null?void 0:g.rotation)||0)+this.envMapRotationOffset,this.extraUniformsToUpload.inverseModelMatrix.value.copy(l.matrixWorld).invert();const c=s.userData.normalsCaptureOffsets;c&&(this.extraUniformsToUpload.centerOffset.value.fromArray(c.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(c.offsetMatrix).premultiply(l.matrixWorld),this.extraUniformsToUpload.offsetMatrixInv.value.fromArray(c.offsetMatrixInv),this.extraUniformsToUpload.radius.value=c.radius);const f=(y=s.userData._normalsCaptureMap)==null?void 0:y.texture;this.normalsCaptureMap!==f&&(this.normalsCaptureMap=f),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:s,object:l})}onAfterRender(e,t,n,s,l){super.onAfterRender(e,t,n,s,l),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:s,object:l})}constructor(e){super({side:i.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;void main(){vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#include <begin_vertex>
#include <project_vertex>
vViewPosition=-mvPosition.xyz;vNormal=normalize(normalMatrix*normal);vUv=uv;
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform mat4 modelMatrix;uniform mat4 inverseModelMatrix;uniform mat4 offsetMatrixInv;uniform mat4 modelOffsetMatrix;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float radius;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform vec3 centerOffset;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){
#if DIA_ORIENT_ENVMAP < 1
direction=mat3(modelOffsetMatrix)*direction;
#endif
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=centerOffset;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+centerOffset+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-centerOffset);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=centerOffset+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-centerOffset);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=centerOffset+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;newDirection=(offsetMatrixInv*inverseModelMatrix*vec4(newDirection,0.)).xyz;newDirection=normalize(newDirection);origin=(offsetMatrixInv*inverseModelMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-centerOffset);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(modelOffsetMatrix*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(modelOffsetMatrix)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=normalize(mat3(modelOffsetMatrix)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);
#glMarker beforeAccumulation
gl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new i.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new i.Pa4(1,1,1)}}}),this.typeSlug=ls.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new $e(1,1,1),this.envMapIntensity=1,this.envMapRotationOffset=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new i.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new i.yGw().identity()},radius:{value:1},centerOffset:{value:new i.Pa4(0,0,0)},modelOffsetMatrix:{value:new i.yGw().identity()},offsetMatrixInv:{value:new i.yGw().identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=Oi.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Oi.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){Oi.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Oi.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}set envMaps(e){this.__envMap=e,this.refreshEnvUniform()}refreshEnvUniform(){var e;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=(e=this.uniforms.envMap.value)!=null&&e.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){return this.__envMap[this.envMapIndex]??this.__envMap[0]??null}set envMap(e){console.error("Setting separate envmap for indivisual diamond material not supported yet.")}clone(){return super.clone()}toJSON(e){const t={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.envMapIndex=this.envMapIndex,t.envMapRotationOffset=this.envMapRotationOffset,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=ls.TYPE,t.userData={},xt(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map(t=>({label:"env"+(t+1),value:t}))},..._t(this),{type:"input",label:"Mesh count",get value(){var t,n;return((n=(t=e.userData)==null?void 0:t.__appliedMeshes)==null?void 0:n.size)??0},set value(t){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(t){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{const t=new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"});(0,r.downloadBlob)(t,"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(t=>{var n;return(n=t.getUiConfig)==null?void 0:n.call(t,this)})].filter(t=>t),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==ls.TYPE)return console.warn("Material type is not supported",e),this;const t={},n=Array.from(Object.keys(Xd));(0,r.copyProps)(e,t,n);const s=t.userData;return delete t.userData,this.setValues(t),xt(this.userData,s),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}ls.TypeSlug="dmat",ls.TYPE="DiamondMaterial",ma([it("Color",{limitedUi:!0}),Te()],ls.prototype,"color",void 0),ma([Hn("Env Intensity",[0,5],.01,{limitedUi:!0}),Te()],ls.prototype,"envMapIntensity",void 0),ma([Hn("Env Rotation Offset",[-Math.PI,Math.PI],.01),(0,r.onChange2)(ls.prototype.setDirty)],ls.prototype,"envMapRotationOffset",void 0),ma([Hn("Dispersion",[0,.1],1e-4,{limitedUi:!0}),Te({propKey:"rIndexDelta"})],ls.prototype,"dispersion",void 0),ma([Hn("Absorption",[0,15],.01,{limitedUi:!0}),Te()],ls.prototype,"absorptionFactor",void 0),ma([Hn("Refractive Index",[0,4],.01,{limitedUi:!0}),Te()],ls.prototype,"refractiveIndex",void 0),ma([Te()],ls.prototype,"squashFactor",void 0),ma([Te()],ls.prototype,"geometryFactor",void 0),ma([Hn("Gamma",[.1,4],.01,{limitedUi:!0}),Te()],ls.prototype,"gammaFactor",void 0),ma([Ni("RGB Boost",void 0,void 0,{limitedUi:!0}),Te()],ls.prototype,"boostFactors",void 0),ma([Hn("Transmission",[0,1],.01,{limitedUi:!0}),Te()],ls.prototype,"transmission",void 0),ma([Hn("Reflectivity",[0,2],.01,{limitedUi:!0}),Te()],ls.prototype,"reflectivity",void 0),ma([ke("RAY_BOUNCES",void 0,!0),Hn("Ray Bounces",[1,16],1)],ls.prototype,"rayBounces",void 0),ma([ke("DIA_ORIENT_ENVMAP",void 0,!0),Hn("Diamond Oriented Lighting",[0,1],1)],ls.prototype,"diamondOrientedEnvMap",void 0),ma([Te({propKey:"tCubeMapNormals"})],ls.prototype,"normalsCaptureMap",void 0),ma([(0,r.onChange)(ls.prototype.refreshEnvUniform)],ls.prototype,"envMapIndex",void 0);var Yu=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class Ls extends Ln{get envMapRotation(){var e;return((e=this.envMap)==null?void 0:e.rotation)??0}set envMapRotation(e){var n;const t=[this.envMap,this.envMap2,this.envMap3];for(const s of t)s&&(s.rotation=e,(n=this._viewer)==null||n.scene.setDirty())}refreshEnvMaps(){var n,s,l;if(!this._viewer)return;const e=this.getEnvMaps(),t=((s=(n=this._viewer.getPlugin(ri))==null?void 0:n.materials)==null?void 0:s.getMaterialsOfType(ls.TypeSlug))||[];for(const c of t)c&&(c.envMaps=e);(l=this._viewer)==null||l.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var t;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const e=((t=this._viewer)==null?void 0:t.scene.getEnvironment())||null;return[e,e,e]},this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const n=[];return e.modelObject.traverse(s=>{var c,f,g,y;const l=(f=(c=s.userData)==null?void 0:c.gltfExtensions)==null?void 0:f[Ls.DIAMOND_GLTF_EXTENSION];l&&s.geometry&&(this.prepareDiamondMesh(s,l),delete s.userData.gltfExtensions[Ls.DIAMOND_GLTF_EXTENSION]),s.material&&!n.includes(s.material)&&((y=(g=s.material.userData)==null?void 0:g.gltfExtensions)!=null&&y[Ls.DIAMOND_GLTF_EXTENSION])&&(s.material.materialObject||console.warn("material not processed",s.material),n.push(s.material))}),n.forEach(s=>{const l=s.userData.gltfExtensions[Ls.DIAMOND_GLTF_EXTENSION];l&&this._convertToDiamondMaterial(s,l)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var t,n,s;const e=(s=(n=(t=this._viewer)==null?void 0:t.getPlugin(Kr))==null?void 0:n.getSelectedObject())==null?void 0:s.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==_o.TypeSlug},value:async()=>{var s,l,c,f,g,y;const e=(l=(s=this._viewer)==null?void 0:s.getPlugin(Kr))==null?void 0:l.getSelectedObject();if(!(e!=null&&e.material))return;const t=await((c=this._viewer)==null?void 0:c.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let n=parseInt(await((f=this._viewer)==null?void 0:f.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(n)||(n=512),n<64&&(n=64),((g=e.material.userData)==null?void 0:g.__appliedMeshes.size)>1&&await((y=this._viewer)==null?void 0:y.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(e.material,{cacheKey:t||void 0,normalMapRes:n},{}):this.makeDiamondMesh(e,{cacheKey:t||void 0,normalMapRes:n},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var t,n,s;const e=(s=(n=(t=this._viewer)==null?void 0:t.getPlugin(Kr))==null?void 0:n.getSelectedObject())==null?void 0:s.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==ls.TypeSlug},value:async()=>{var l,c,f,g,y,x,S,C;const e=(c=(l=this._viewer)==null?void 0:l.getPlugin(Kr))==null?void 0:c.getSelectedObject(),t=e==null?void 0:e.material;if(!t)return;const n=t.userData._baseMaterial;let s=(y=(g=(f=this._viewer)==null?void 0:f.getManager())==null?void 0:g.materials)==null?void 0:y.findMaterial(n);if(s&&!s.isDiamondMaterial||(s=(x=this._viewer)==null?void 0:x.createPhysicalMaterial({color:t.color})),s){const L=t.userData.__appliedMeshes.size>1&&await((S=this._viewer)==null?void 0:S.confirm("Convert all with this material?"))?Array.from(t.userData.__appliedMeshes):[e];for(const B of L)(C=B==null?void 0:B.setMaterial)==null||C.call(B,s)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var e,t,n;(e=this._viewer)==null||e.setDirty(),(n=(t=this.uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0)}async onAdded(e){var l,c,f,g,y,x,S;this._normalCapture=new Cf(e.renderer),this.offsetCache={},e.scene.addEventListener("materialChanged",C=>{var L,B,W,q;if((L=C.material)!=null&&L.isDiamondMaterial){const Z=C.material,j=C.mesh||C.object;if(j.geometry&&!((B=this._normalCapture)!=null&&B.hasCapturedNormalMap(j))){const se=((q=(W=Z==null?void 0:Z.userData)==null?void 0:W.gltfExtensions)==null?void 0:q[Ls.DIAMOND_GLTF_EXTENSION])??{};se.cacheKey===void 0&&!j.userData._diamondCacheKey&&(Z!=null&&Z.name)&&(se.cacheKey=Z.name),this.prepareDiamondMesh(j,se)}const F=this.getEnvMaps();Z.envMaps=F}}),e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const t=e.getPlugin(ri);(l=t==null?void 0:t.importer)==null||l.processors.add("model",this._modelProcessor),(c=e.getPlugin(Kr))==null||c.addEventListener("selectedObjectChanged",this.refreshUi);const n=this.getEnvMaps,s=new Ms(class extends _h{async loadAsync(C,L){var W;const B=await super.loadAsync(C,L);return B.type===ls.TYPE||B.isDiamondMaterialParameters?(B.envMap=n(),(W=t==null?void 0:t.materials)==null?void 0:W.generateFromTemplate("diamond",B)):(console.error("Invalid material type for Diamond Material.",B),null)}},[ls.TypeSlug],!1);return(f=t==null?void 0:t.importer)==null||f.Importers.push(s),(x=(y=(g=t==null?void 0:t.exporter)==null?void 0:g.getExporter("gltf","glb"))==null?void 0:y.extensions)==null||x.push(xE),(S=t==null?void 0:t.materials)==null||S.registerMaterialTemplate({name:"diamond",materialType:ls.TYPE,isDiamondMaterialParameters:!0,generator:(C,L)=>{const B=!(L!=null&&L.metadata||!L.isDiamondMaterialParameters)||(L==null?void 0:L.metadata)&&(L==null?void 0:L.metadata.version)<=4.5,W=L==null?void 0:L.color;B&&typeof L.color=="number"&&(L.color=new $e().setHex(L.color,i.GUF).getHex());const q=new ls(C);return q.envMaps=this.getEnvMaps(),L&&q.copyProps(L),L.color=W,q}}),super.onAdded(e)}async onRemove(e){var t,n,s,l;return(t=this._normalCapture)==null||t.dispose(),this._normalCapture=void 0,this.offsetCache={},(s=(n=e.getPlugin(ri))==null?void 0:n.importer)==null||s.processors.remove("model",this._modelProcessor),(l=e.getPlugin(Kr))==null||l.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:n}){var c,f;e.userData._diamondCacheKey=t??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=n??e.userData._diamondNormalMapRes,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const s=((c=this._normalCapture)==null?void 0:c.captureNormalMap(e.geometry,t,n))??[void 0,!1],l=(f=this._viewer)==null?void 0:f.getPluginByType("debug");l&&s&&(l.counters.normalsCapture||(l.counters.normalsCapture=0),l.counters.normalsCapture++,console.log("DEBUG: new normal map captured",l.counters.normalsCapture,t),l.addTexture("normal"+l.counters.normalsCapture,()=>{var g,y;return(y=(g=e.geometry)==null?void 0:g.userData._normalsCaptureMap)==null?void 0:y.texture},[40,110*l.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,n){var s;Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(l=>{l!=null&&l.isMesh&&l.geometry&&this.prepareDiamondMesh(l,t)}),this._convertToDiamondMaterial(e,n),(s=this._viewer)==null||s.setDirty()}makeDiamondMesh(e,t,n){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const s=Array.isArray(e.material)?e.material[0]:e.material,l=this._convertToDiamondMaterial(s,n,!1);e.setMaterial(l)}_convertToDiamondMaterial(e,t={isDiamond:!0},n=!0){var c,f,g;let s={...t??{}};s.isDiamond||s.isDiamondMaterialParameters?Array.isArray(s.boostFactors)&&(s.boostFactors=new i.Pa4().fromArray(s.boostFactors)):s={isDiamondMaterialParameters:!0},s.color=s.color??(e==null?void 0:e.color)??new $e(1,1,1),s.name=s.name??(e==null?void 0:e.name)??"diamond";const l=(g=(f=(c=this._viewer)==null?void 0:c.getManager())==null?void 0:f.materials)==null?void 0:g.generateFromTemplate("diamond",s);if(l&&e&&!e.isDiamondMaterial&&(l.userData._baseMaterial=e.uuid),n){const y=x=>x.setMaterial??(S=>{x.material=S.materialObject});Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(x=>{y(x)(l),this.prepareDiamondMesh(x,t)})}return l}_computeOffsets(e,t,n=!1){if(e.userData.normalsCaptureOffsets){if((0,r.getUrlQueryParam)("recomputeOffsets")===null)return e.userData.normalsCaptureOffsets;console.warn("recomputeOffsets",e.userData.normalsCaptureOffsets)}e.computeBoundingBox();const s=e.boundingBox.getCenter(new i.Pa4).toArray(),l=U0(e).toArray(),c=new i.yGw().fromArray(l).invert(),f=new i.Pa4().fromArray(s).applyMatrix4(c).toArray(),g={center:s,offsetMatrix:l,offsetMatrixInv:c.toArray(),radius:1,centerOffset:f};return e.userData.normalsCaptureOffsets=g,(0,r.getUrlQueryParam)("recomputeOffsets")!==null&&console.warn("recomputeOffsets",g),g}disposeCacheMap(e){var t;(t=this._normalCapture)==null||t.disposeTarget(e)}disposeAllCacheMaps(){var e;(e=this._normalCapture)==null||e.disposeAllTargets()}}Ls.PluginType="Diamond",Ls.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",Yu([(0,r.onChange)(Ls.prototype.refreshEnvMaps),Pe()],Ls.prototype,"envMap",void 0),Yu([(0,r.onChange)(Ls.prototype.refreshEnvMaps),Pe()],Ls.prototype,"envMap2",void 0),Yu([(0,r.onChange)(Ls.prototype.refreshEnvMaps),Pe()],Ls.prototype,"envMap3",void 0),Yu([(0,r.onChange)(Ls.prototype.refreshEnvMaps),Pe()],Ls.prototype,"forceSceneEnvMap",void 0);const xE=a=>({writeMaterial:(e,t)=>{e.isDiamondMaterial&&(t.extensions=t.extensions||{},t.extensions[Ls.DIAMOND_GLTF_EXTENSION]=e.toJSON(),a.extensionsUsed[Ls.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,t)=>{var s,l;if(!(e!=null&&e.material.isDiamondMaterial))return;t.extensions=t.extensions||{};const n={};(l=(s=e.userData)==null?void 0:s.gltfExtensions)==null||delete l[Ls.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(n.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(n.cacheKey=e.userData._diamondCacheKey),t.extensions[Ls.DIAMOND_GLTF_EXTENSION]=n,a.extensionsUsed[Ls.DIAMOND_GLTF_EXTENSION]=!0}});class Rf{static async GetClonedCanvas(e,{rect:t={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:n=1,scale:s=1}){var g,y,x;const l=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");l.width=t.width*s*n,l.height=t.height*s*n,t.assumeClientRect&&(t.x*=e.width/(n*e.clientWidth),t.y*=e.height/(n*e.clientHeight),t.width*=e.width/(n*e.clientWidth),t.height*=e.height/(n*e.clientHeight));const c=l.getContext("2d");if(!c)return console.error("snapshot: cannot create context"),l;const f=e.style.background||((g=e.parentElement)==null?void 0:g.style.background)||"";if(f.includes("url")){const S=(y=/url\("(.*)"\)/gi.exec(f))==null?void 0:y[1];if(S){const C=new Image;C.src=S,await new Promise((L,B)=>{C.onload=()=>L(),C.onerror=()=>B(),C.complete&&L()}),c.drawImage(C,C.width*t.x*n/e.width,C.height*t.y*n/e.height,C.width*t.width*n/e.width,C.height*t.height*n/e.height,0,0,l.width,l.height)}}else c.fillStyle=e.style.background||((x=e.parentElement)==null?void 0:x.style.backgroundColor)||"#00000000",c.fillRect(0,0,l.width,l.height);return c==null||c.drawImage(e,t.x*n,t.y*n,t.width*n,t.height*n,0,0,l.width,l.height),this.Debug&&(document.body.appendChild(l),l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.borderWidth="2px",l.style.borderColor="#ff00ff",setTimeout(()=>l.remove(),5e3)),l}static async GetDataUrl(e,{mimeType:t="image/png",...n}){const s=await this.GetClonedCanvas(e,n),l=s.toDataURL(t);return this.Debug||s.remove(),l}static async GetImage(e,{mimeType:t="image/png",...n}={}){const s=await this.GetDataUrl(e,n);return new Promise((l,c)=>{const f=new Image;f.onload=()=>{l(f)},f.src=s})}static async GetBlob(e,t={}){const n=await this.GetClonedCanvas(e,t),s=await new Promise((l,c)=>{n.toBlob(f=>{f?l(f):c()},t.mimeType??"image/png")});return this.Debug||n.remove(),s}static async GetFile(e,t="image.png",n={}){return n.getDataUrl?await this.GetDataUrl(e,n):new File([await this.GetBlob(e,n)],t,{type:n.mimeType??"image/png",lastModified:(0,r.now)()})}}Rf.Debug=!1;var Vh=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Na=class extends Ln{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(a,e={waitForProgressive:!0}){return e.getDataUrl=!1,await this._getFile(a||this.filename,e)}async getDataUrl(a={}){return a.getDataUrl=!0,await this._getFile("",a)??""}async _getFile(a,e={}){var n,s;const t=(n=this._viewer)==null?void 0:n.canvas;if(t){const l=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==l&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const c=(s=this._viewer)==null?void 0:s.getPlugin(na);if(e.waitForProgressive&&c&&e.timeout===void 0)for(;!c.isConverged(!0);)await(0,r.timeout)(64);else await(0,r.timeout)(e.timeout??200);e.displayPixelRatio=1;const f=await Rf.GetFile(t,a,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=l,f}}async downloadSnapshot(a,e={waitForProgressive:!0}){const t=await this.getFile(a,e);t&&await this._downloadBlob(t,t.name)}async _downloadBlob(a,e){var n,s;const t=(n=this._viewer)==null?void 0:n.getPluginByType("FileTransferPlugin");t?await t.exportFile(a,e):(s=this._viewer)==null||s.console.error("FileTransferPlugin required to export/download file")}};Na.PluginType="CanvasSnipper",Vh([We("Filename"),Pe()],Na.prototype,"filename",void 0),Vh([Ee("Download .png",{limitedUi:!0})],Na.prototype,"downloadSnapshot",null),Na=Vh([lt("Image Export")],Na);var If=function(a){return function(e){return 1-a(1-e)}},qd=function(a){return function(e){return e<=.5?a(2*e)/2:(2-a(2*(1-e)))/2}},F0=function(a){return function(e){return Math.pow(e,a)}},z0=function(a){return function(e){return e*e*((a+1)*e-a)}},Pf=function(a){var e=z0(a);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},Yd=function(a){return a},Jm=F0(2),ka=If(Jm),j_=qd(Jm),G_=function(a){return 1-Math.sin(Math.acos(a))},H_=If(G_),W_=qd(H_),Kd=z0(1.525),Ku=If(Kd),V0=qd(Kd),j0=Pf(1.525),bl=function(a){if(a===1||a===0)return a;var e=a*a;return a<.36363636363636365?7.5625*e:a<.7272727272727273?9.075*e-9.9*a+3.4:a<.9?12.066481994459833*e-19.63545706371191*a+8.898060941828255:10.8*a*a-20.52*a+10.72},G0=If(bl),Q_=function(a){return a<.5?.5*(1-bl(1-2*a)):.5*bl(2*a-1)+.5},io=function(){return io=Object.assign||function(a){for(var e,t=1,n=arguments.length;t<n;t++)for(var s in e=arguments[t])Object.prototype.hasOwnProperty.call(e,s)&&(a[s]=e[s]);return a},io.apply(this,arguments)};function X_(a,e){var t={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&e.indexOf(n)<0&&(t[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(n=Object.getOwnPropertySymbols(a);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(a,n[s])&&(t[n[s]]=a[n[s]])}return t}var Df=function(){},jh=function(a,e,t){return Math.min(Math.max(t,a),e)},q_=.001,bb=.01,wE=10,EE=.05,H0=1,SE=12;function W0(a,e){return a*Math.sqrt(1-e*e)}var Gc=["duration","bounce"],Y_=["stiffness","damping","mass"];function Q0(a,e){return e.some(function(t){return a[t]!==void 0})}function Lf(a){var e=a.from,t=e===void 0?0:e,n=a.to,s=n===void 0?1:n,l=a.restSpeed,c=l===void 0?2:l,f=a.restDelta,g=X_(a,["from","to","restSpeed","restDelta"]),y={done:!1,value:t},x=function(se){var pe=io({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},se);if(!Q0(se,Y_)&&Q0(se,Gc)){var be=function(Se){var Be,Ge,Xe=Se.duration,Qe=Xe===void 0?800:Xe,at=Se.bounce,Ke=at===void 0?.25:at,Je=Se.velocity,ft=Je===void 0?0:Je,mt=Se.mass,vt=mt===void 0?1:mt,Qt=1-Ke;Qt=jh(EE,H0,Qt),Qe=jh(bb,wE,Qe/1e3),Qt<1?(Be=function(un){var rn=un*Qt,Gn=rn*Qe,Fn=rn-ft,di=W0(un,Qt),bi=Math.exp(-Gn);return q_-Fn/di*bi},Ge=function(un){var rn=un*Qt*Qe,Gn=rn*ft+ft,Fn=Math.pow(Qt,2)*Math.pow(un,2)*Qe,di=Math.exp(-rn),bi=W0(Math.pow(un,2),Qt);return(-Be(un)+q_>0?-1:1)*((Gn-Fn)*di)/bi}):(Be=function(un){return Math.exp(-un*Qe)*((un-ft)*Qe+1)-q_},Ge=function(un){return Math.exp(-un*Qe)*(Qe*Qe*(ft-un))});var Ht=function(un,rn,Gn){for(var Fn=Gn,di=1;di<SE;di++)Fn-=un(Fn)/rn(Fn);return Fn}(Be,Ge,5/Qe);if(Qe*=1e3,isNaN(Ht))return{stiffness:100,damping:10,duration:Qe};var Cn=Math.pow(Ht,2)*vt;return{stiffness:Cn,damping:2*Qt*Math.sqrt(vt*Cn),duration:Qe}}(se);(pe=io(io(io({},pe),be),{velocity:0,mass:1})).isResolvedFromDuration=!0}return pe}(g),S=x.stiffness,C=x.damping,L=x.mass,B=x.velocity,W=x.duration,q=x.isResolvedFromDuration,Z=Zm,j=Zm;function F(){var se=B?-B/1e3:0,pe=s-t,be=C/(2*Math.sqrt(S*L)),Se=Math.sqrt(S/L)/1e3;if(f!=null||(f=Math.abs(s-t)<=1?.01:.4),be<1){var Be=W0(Se,be);Z=function(Xe){var Qe=Math.exp(-be*Se*Xe);return s-Qe*((se+be*Se*pe)/Be*Math.sin(Be*Xe)+pe*Math.cos(Be*Xe))},j=function(Xe){var Qe=Math.exp(-be*Se*Xe);return be*Se*Qe*(Math.sin(Be*Xe)*(se+be*Se*pe)/Be+pe*Math.cos(Be*Xe))-Qe*(Math.cos(Be*Xe)*(se+be*Se*pe)-Be*pe*Math.sin(Be*Xe))}}else if(be===1)Z=function(Xe){return s-Math.exp(-Se*Xe)*(pe+(se+Se*pe)*Xe)};else{var Ge=Se*Math.sqrt(be*be-1);Z=function(Xe){var Qe=Math.exp(-be*Se*Xe),at=Math.min(Ge*Xe,300);return s-Qe*((se+be*Se*pe)*Math.sinh(at)+Ge*pe*Math.cosh(at))/Ge}}}return F(),{next:function(se){var pe=Z(se);if(q)y.done=se>=W;else{var be=1e3*j(se),Se=Math.abs(be)<=c,Be=Math.abs(s-pe)<=f;y.done=Se&&Be}return y.value=y.done?s:pe,y},flipTarget:function(){var se;B=-B,t=(se=[s,t])[0],s=se[1],F()}}}Lf.needsInterpolation=function(a,e){return typeof a=="string"||typeof e=="string"};var Zm=function(a){return 0},eg=function(a,e,t){var n=e-a;return n===0?1:(t-a)/n},$d=function(a,e,t){return-t*a+t*e+a},K_=function(a,e){return function(t){return Math.max(Math.min(t,e),a)}},Bf=function(a){return a%1?Number(a.toFixed(5)):a},tg=/(-)?([\d]*\.?[\d])+/g,Jd=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,ng=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function Zd(a){return typeof a=="string"}var ig={test:function(a){return typeof a=="number"},parse:parseFloat,transform:function(a){return a}},rg=io(io({},ig),{transform:K_(0,1)}),$_=(io(io({},ig),{default:1}),function(a,e){return function(t){return!!(Zd(t)&&ng.test(t)&&t.startsWith(a)||e&&Object.prototype.hasOwnProperty.call(t,e))}}),J_=function(a,e,t){return function(n){var s;if(!Zd(n))return n;var l=n.match(tg),c=l[0],f=l[1],g=l[2],y=l[3];return(s={})[a]=parseFloat(c),s[e]=parseFloat(f),s[t]=parseFloat(g),s.alpha=y!==void 0?parseFloat(y):1,s}},X0=K_(0,255),sg=io(io({},ig),{transform:function(a){return Math.round(X0(a))}}),Gh={test:$_("rgb","red"),parse:J_("red","green","blue"),transform:function(a){var e=a.red,t=a.green,n=a.blue,s=a.alpha,l=s===void 0?1:s;return"rgba("+sg.transform(e)+", "+sg.transform(t)+", "+sg.transform(n)+", "+Bf(rg.transform(l))+")"}},Z_={test:$_("#"),parse:function(a){var e="",t="",n="",s="";return a.length>5?(e=a.substr(1,2),t=a.substr(3,2),n=a.substr(5,2),s=a.substr(7,2)):(e=a.substr(1,1),t=a.substr(2,1),n=a.substr(3,1),s=a.substr(4,1),e+=e,t+=t,n+=n,s+=s),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:s?parseInt(s,16)/255:1}},transform:Gh.transform},og=function(a){return{test:function(e){return Zd(e)&&e.endsWith(a)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+a}}},yu=og("%"),Au=(io(io({},yu),{parse:function(a){return yu.parse(a)/100},transform:function(a){return yu.transform(100*a)}}),{test:$_("hsl","hue"),parse:J_("hue","saturation","lightness"),transform:function(a){var e=a.hue,t=a.saturation,n=a.lightness,s=a.alpha,l=s===void 0?1:s;return"hsla("+Math.round(e)+", "+yu.transform(Bf(t))+", "+yu.transform(Bf(n))+", "+Bf(rg.transform(l))+")"}}),ag=function(a,e,t){var n=a*a,s=e*e;return Math.sqrt(Math.max(0,t*(s-n)+n))},ep=[Z_,Gh,Au],Of=function(a){return ep.find(function(e){return e.test(a)})},Hc=function(a,e){var t=Of(a),n=Of(e);if(Df(t.transform===n.transform),!t||!n||t.transform!==n.transform)return function(g){return""+(g>0?e:a)};var s=t.parse(a),l=n.parse(e),c=io({},s),f=t===Au?$d:ag;return function(g){for(var y in c)y!=="alpha"&&(c[y]=f(s[y],l[y],g));return c.alpha=$d(s.alpha,l.alpha,g),t.transform(c)}},Hh={test:function(a){return Gh.test(a)||Z_.test(a)||Au.test(a)},parse:function(a){return Gh.test(a)?Gh.parse(a):Au.test(a)?Au.parse(a):Z_.parse(a)},transform:function(a){return Zd(a)?a:a.hasOwnProperty("red")?Gh.transform(a):Au.transform(a)}},lg="${c}",cg="${n}";function ev(a){typeof a=="number"&&(a=""+a);var e=[],t=0,n=a.match(Jd);n&&(t=n.length,a=a.replace(Jd,lg),e.push.apply(e,n.map(Hh.parse)));var s=a.match(tg);return s&&(a=a.replace(tg,cg),e.push.apply(e,s.map(ig.parse))),{values:e,numColors:t,tokenised:a}}function ug(a){return ev(a).values}function q0(a){var e=ev(a),t=e.values,n=e.numColors,s=e.tokenised,l=t.length;return function(c){for(var f=s,g=0;g<l;g++)f=f.replace(g<n?lg:cg,g<n?Hh.transform(c[g]):Bf(c[g]));return f}}var tp=function(a){return typeof a=="number"?0:a},Y0={test:function(a){var e,t,n,s;return isNaN(a)&&Zd(a)&&((t=(e=a.match(tg))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)+((s=(n=a.match(Jd))===null||n===void 0?void 0:n.length)!==null&&s!==void 0?s:0)>0},parse:ug,createTransformer:q0,getAnimatableNone:function(a){var e=ug(a);return q0(a)(e.map(tp))}},np={x:0,y:0,z:0},ip=function(a){return typeof a=="number"},TE=function(a,e){return function(t){return e(a(t))}},K0=function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return a.reduce(TE)};function xb(a,e){return ip(a)?function(t){return $d(a,e,t)}:Hh.test(a)?Hc(a,e):$0(a,e)}var wb=function(a,e){var t=function(l,c,f){if(f||arguments.length===2)for(var g,y=0,x=c.length;y<x;y++)!g&&y in c||(g||(g=Array.prototype.slice.call(c,0,y)),g[y]=c[y]);return l.concat(g||Array.prototype.slice.call(c))}([],a),n=t.length,s=a.map(function(l,c){return xb(l,e[c])});return function(l){for(var c=0;c<n;c++)t[c]=s[c](l);return t}},ME=function(a,e){var t=io(io({},a),e),n={};for(var s in t)a[s]!==void 0&&e[s]!==void 0&&(n[s]=xb(a[s],e[s]));return function(l){for(var c in n)t[c]=n[c](l);return t}};function Eb(a){for(var e=Y0.parse(a),t=e.length,n=0,s=0,l=0,c=0;c<t;c++)n||typeof e[c]=="number"?n++:e[c].hue!==void 0?l++:s++;return{parsed:e,numNumbers:n,numRGB:s,numHSL:l}}var $0=function(a,e){var t=Y0.createTransformer(e),n=Eb(a),s=Eb(e);return n.numHSL===s.numHSL&&n.numRGB===s.numRGB&&n.numNumbers>=s.numNumbers?K0(wb(n.parsed,s.parsed),t):function(l){return""+(l>0?e:a)}},J0=function(a,e){return function(t){return $d(a,e,t)}};function Z0(a,e,t){var n=t===void 0?{}:t,s=n.clamp,l=s===void 0||s,c=n.ease,f=n.mixer,g=a.length;Df(g===e.length),Df(!c||!Array.isArray(c)||c.length===g-1),a[0]>a[g-1]&&(a=[].concat(a),e=[].concat(e),a.reverse(),e.reverse());var y=function(S,C,L){for(var B=[],W=L||(typeof(se=S[0])=="number"?J0:typeof se=="string"?Hh.test(se)?Hc:$0:Array.isArray(se)?wb:typeof se=="object"?ME:void 0),q=S.length-1,Z=0;Z<q;Z++){var j=W(S[Z],S[Z+1]);if(C){var F=Array.isArray(C)?C[Z]:C;j=K0(F,j)}B.push(j)}var se;return B}(e,c,f),x=g===2?function(S,C){var L=S[0],B=S[1],W=C[0];return function(q){return W(eg(L,B,q))}}(a,y):function(S,C){var L=S.length,B=L-1;return function(W){var q=0,Z=!1;if(W<=S[0]?Z=!0:W>=S[B]&&(q=B-1,Z=!0),!Z){for(var j=1;j<L&&!(S[j]>W||j===B);j++);q=j-1}var F=eg(S[q],S[q+1],W);return C[q](F)}}(a,y);return l?function(S){return x(jh(a[0],a[g-1],S))}:x}function Nf(a,e){return a.map(function(){return e||j_}).splice(0,a.length-1)}function hg(a){var e=a.from,t=e===void 0?0:e,n=a.to,s=n===void 0?1:n,l=a.ease,c=a.offset,f=a.duration,g=f===void 0?300:f,y={done:!1,value:t},x=Array.isArray(s)?s:[t,s],S=function(B,W){return B.map(function(q){return q*W})}(c&&c.length===x.length?c:function(B){var W=B.length;return B.map(function(q,Z){return Z!==0?Z/(W-1):0})}(x),g);function C(){return Z0(S,x,{ease:Array.isArray(l)?l:Nf(x,l)})}var L=C();return{next:function(B){return y.value=L(B),y.done=B>=g,y},flipTarget:function(){x.reverse(),L=C()}}}function Qs(a){var e=a.velocity,t=e===void 0?0:e,n=a.from,s=n===void 0?0:n,l=a.power,c=l===void 0?.8:l,f=a.timeConstant,g=f===void 0?350:f,y=a.restDelta,x=y===void 0?.5:y,S=a.modifyTarget,C={done:!1,value:s},L=c*t,B=s+L,W=S===void 0?B:S(B);return W!==B&&(L=W-s),{next:function(q){var Z=-L*Math.exp(-q/g);return C.done=!(Z>x||Z<-x),C.value=C.done?W:W+Z,C},flipTarget:function(){}}}var dg={keyframes:hg,spring:Lf,decay:Qs},ey=1/60*1e3,tv=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},pg=typeof window<"u"?function(a){return window.requestAnimationFrame(a)}:function(a){return setTimeout(function(){return a(tv())},ey)},rp=!0,kf=!1,nv=!1,$u={delta:0,timestamp:0},Uf=["read","update","preRender","render","postRender"],pc=Uf.reduce(function(a,e){return a[e]=function(t){var n=[],s=[],l=0,c=!1,f=new WeakSet,g={schedule:function(y,x,S){x===void 0&&(x=!1),S===void 0&&(S=!1);var C=S&&c,L=C?n:s;return x&&f.add(y),L.indexOf(y)===-1&&(L.push(y),C&&c&&(l=n.length)),y},cancel:function(y){var x=s.indexOf(y);x!==-1&&s.splice(x,1),f.delete(y)},process:function(y){var x;if(c=!0,n=(x=[s,n])[0],(s=x[1]).length=0,l=n.length)for(var S=0;S<l;S++){var C=n[S];C(y),f.has(C)&&(g.schedule(C),t())}c=!1}};return g}(function(){return kf=!0}),a},{}),Sb=Uf.reduce(function(a,e){var t=pc[e];return a[e]=function(n,s,l){return s===void 0&&(s=!1),l===void 0&&(l=!1),kf||mg(),t.schedule(n,s,l)},a},{}),Tb=Uf.reduce(function(a,e){return a[e]=pc[e].cancel,a},{}),fg=function(a){return pc[a].process($u)},Mb=function(a){kf=!1,$u.delta=rp?ey:Math.max(Math.min(a-$u.timestamp,40),1),$u.timestamp=a,nv=!0,Uf.forEach(fg),nv=!1,kf&&(rp=!1,pg(Mb))},mg=function(){kf=!0,rp=!0,nv||pg(Mb)},sp=function(){return $u},gg=Sb;function Ff(a,e,t){return t===void 0&&(t=0),a-e-t}var zf=function(a){var e=function(t){var n=t.delta;return a(n)};return{start:function(){return gg.update(e,!0)},stop:function(){return Tb.update(e)}}};function Ju(a){var e,t,n,s,l,c=a.from,f=a.autoplay,g=f===void 0||f,y=a.driver,x=y===void 0?zf:y,S=a.elapsed,C=S===void 0?0:S,L=a.repeat,B=L===void 0?0:L,W=a.repeatType,q=W===void 0?"loop":W,Z=a.repeatDelay,j=Z===void 0?0:Z,F=a.onPlay,se=a.onStop,pe=a.onComplete,be=a.onRepeat,Se=a.onUpdate,Be=X_(a,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),Ge=Be.to,Xe=0,Qe=Be.duration,at=!1,Ke=!0,Je=function(mt){if(Array.isArray(mt.to))return hg;if(dg[mt.type])return dg[mt.type];var vt=new Set(Object.keys(mt));return vt.has("ease")||vt.has("duration")&&!vt.has("dampingRatio")?hg:vt.has("dampingRatio")||vt.has("stiffness")||vt.has("mass")||vt.has("damping")||vt.has("restSpeed")||vt.has("restDelta")?Lf:hg}(Be);!((t=(e=Je).needsInterpolation)===null||t===void 0)&&t.call(e,c,Ge)&&(l=Z0([0,100],[c,Ge],{clamp:!1}),c=0,Ge=100);var ft=Je(io(io({},Be),{from:c,to:Ge}));return g&&(F==null||F(),(n=x(function(mt){if(Ke||(mt=-mt),C+=mt,!at){var vt=ft.next(Math.max(0,C));s=vt.value,l&&(s=l(s)),at=Ke?vt.done:C<=0}Se==null||Se(s),at&&(Xe===0&&(Qe!=null||(Qe=C)),Xe<B?function(Qt,Ht,Cn,un){return un?Qt>=Ht+Cn:Qt<=-Cn}(C,Qe,j,Ke)&&(Xe++,q==="reverse"?C=function(Qt,Ht,Cn,un){return Cn===void 0&&(Cn=0),un===void 0&&(un=!0),un?Ff(Ht+-Qt,Ht,Cn):Ht-(Qt-Ht)+Cn}(C,Qe,j,Ke=Xe%2==0):(C=Ff(C,Qe,j),q==="mirror"&&ft.flipTarget()),at=!1,be&&be()):(n.stop(),pe&&pe()))})).start()),{stop:function(){se==null||se(),n.stop()}}}const bu={linear:Yd,easeIn:Jm,easeOut:ka,easeInOut:j_,circIn:G_,circOut:H_,circInOut:W_,backIn:Kd,backOut:Ku,backInOut:V0,anticipate:j0,bounceOut:bl,bounceIn:G0,bounceInOut:Q_,easeInOutSine:function(a){return-(Math.cos(Math.PI*a)-1)/2}};function op(a,e,t){const n=a[e],s=()=>{typeof(a==null?void 0:a.setDirty)=="function"&&a.setDirty(),t==null||t()};return n.isVector3||n.isVector2||n.isVector4?l=>{n.copy(l),s()}:l=>{a[e]=l,s()}}function Vf(a){return typeof a!="boolean"}async function iv(a,e,t){e in a||console.error("invalid key",e,a);const n=op(a,e),s=a[e],l=c=>{var f;n(c),(f=t.onUpdate)==null||f.call(t,c)};if(Vf(s))return typeof t.to=="function"&&(t={...t,to:t.to(s,a)}),ty({...t,from:s,onUpdate:l});{const{duration:c}=t;return(0,r.timeout)(c??0).then(()=>l(t.to))}}async function ty(a){return new Promise((e,t)=>{Ju({onComplete:()=>{var n;(n=a.onComplete)==null||n.call(a),e()},onStop:()=>{var n;(n=a.onStop)==null||n.call(a),e()},...a})})}async function jf(a,e){const t=a.onComplete,n=a.onStop;return a={...a},new Promise((s,l)=>{a.onComplete=()=>{t==null||t(),s()},a.onStop=()=>{n==null||n(),s()};const c=Ju(a);e.push(c)})}var ro=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Cb=1,ga=class{constructor(a,e,t,n,s){this.position=new i.Pa4,this.target=new i.Pa4,this.quaternion=new i._fP,this.up=new i.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=qe(this.name,this),a&&(this.position=a),e&&(this.target=e),t&&(this.up=t),n&&(this.quaternion=n),s&&(this.snap=s),this.name="#view"+Cb++}_nameChanged(){var a,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(a=this.uiConfig).uiRefresh)==null||e.call(a))}};ro([Pe(),Ni()],ga.prototype,"position",void 0),ro([Pe(),Ni()],ga.prototype,"target",void 0),ro([Pe(),Ni()],ga.prototype,"quaternion",void 0),ro([Pe(),Ni()],ga.prototype,"up",void 0),ro([Pe(),We()],ga.prototype,"name",void 0),ro([je()],ga.prototype,"snap",void 0),ro([Ee()],ga.prototype,"focusView",void 0),ro([Ee()],ga.prototype,"deleteView",void 0),ga=ro([Pr("CameraView")],ga);class _s extends Ln{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(t=>t.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],..._t(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var t;if(this.enabled&&!this._animating&&this.seekOnScroll){const n=(t=this._viewer)==null?void 0:t.scene.activeCamera;if(!n)return;const s=new i.$V,l=n.position,c=n.target,f=new i._fP().setFromUnitVectors(n.cameraObject.up,new i.Pa4(0,1,0)),g=f.clone().invert(),y=l.clone().sub(c);y.applyQuaternion(f),s.setFromVector3(y),s.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,s.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,s.makeSafe(),y.setFromSpherical(s),y.applyQuaternion(g),l.copy(c).add(y),n.positionUpdated(!1),n.targetUpdated()}}async onAdded(e){await super.onAdded(e);let t=!1;e.addEventListener("preFrame",n=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,t=!0):t&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,t=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var s,l;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((s=this._viewer.getPluginByType("FrameFade"))==null||s.enable(_s.PluginType),this._fadeDisabled=!1));const e=(0,r.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/60);let t=e-this._lastFrameTime;this._lastFrameTime=e,t*=this.animateOnScroll?this._scrollAnimationState:1;const n=(l=this._viewer.getPluginByType("Progressive"))==null?void 0:l.postFrameConvergedRecordingDelta();if(n&&n>0&&(t=n),n!==0&&(t*=1e3,!(t<=0||(this._updaters.forEach(c=>{let f=t;c.time+f<0&&(f=-c.time),c.time+=f,Math.abs(f)>.001&&c.u(f)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const c=this._viewer.getPluginByType("FrameFade");c&&(c.disable(_s.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await(0,r.timeout)(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await(0,r.timeout)(2))}async recordAllViews(e,t=!0){var s;if(!this.enabled)return;const n=(s=this._viewer)==null?void 0:s.getPluginByType("CanvasRecorder");if(n&&n.enabled&&!(this._cameraViews.length<1)){if(await this.resetToFirstView(),!n.isRecording())return new Promise((l,c)=>{const f=()=>{n.removeEventListener("start",g),n.removeEventListener("stop",f),n.removeEventListener("error",y)},g=async()=>{var S;f(),e==null||e(),await this.animateAllViews();const x=await n.stopRecording();if(t){const C=await((S=this._viewer)==null?void 0:S.prompt("Canvas Recorder: Save file as","recording.mp4"));C!==null&&x&&await this._downloadBlob(x,C||"recording.mp4")}l(x)},y=async()=>{f(),c()};n.addEventListener("start",g),n.addEventListener("stop",f),n.addEventListener("error",y),n.startRecording()||console.error("cannot start recording")});console.error("CanvasRecorderPlugin is already recording")}}async addCurrentView(){var n,s,l;if(!this.enabled)return;const e=(n=this._viewer)==null?void 0:n.scene.activeCamera;if(!e)return;const t=this.getCurrentCameraView(e);t.snap=await((l=(s=this._viewer)==null?void 0:s.getPlugin(Na))==null?void 0:l.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this.addView(t)}addView(e){var t,n;this._cameraViews.push(e),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t),this.dispatchEvent({type:"viewAdd",view:e})}getCurrentCameraView(e,t=!0){var y;if(e||(e=(y=this._viewer)==null?void 0:y.scene.activeCamera),!e)return new ga;const n=new i.Pa4;e.cameraObject.updateWorldMatrix(!0,!1);const s=e.cameraObject.matrixWorld;n.x=s.elements[4],n.y=s.elements[5],n.z=s.elements[6],n.normalize();const l=e.target.clone(),c=e.position.clone(),f=e.cameraObject.parent;f&&(t?c.applyMatrix4(f.matrixWorld):n.transformDirection(f.matrixWorld.clone().invert()));const g=new ga(c,l,n,t?e.cameraObject.getWorldQuaternion(new i._fP):e.cameraObject.quaternion.clone(),"");return g.focusView=async()=>this.focusView(g),g.deleteView=()=>this.deleteView(g),g}setCurrentCameraView(e){var n;const t=(n=this._viewer)==null?void 0:n.scene.activeCamera;t&&(t.position.copy(e.position),t.target.copy(e.target),t.cameraObject.up.copy(e.up),t.cameraObject.quaternion.copy(e.quaternion),t.positionUpdated())}async focusView(e){return this.animateToView(e)}deleteView(e){var n,s;const t=this._cameraViews.indexOf(e);t>=0&&this._cameraViews.splice(t,1),(s=(n=this.uiConfig).uiRefresh)==null||s.call(n),this.dispatchEvent({type:"viewDelete",view:e})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var t;return(t=e==null?void 0:e.stop)==null?void 0:t.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await(0,r.timeout)(100)}async animateToView(e,t,n){var y;const s=(y=this._viewer)==null?void 0:y.scene.activeCamera;if(!s)return;if(this._animating&&(this._popAnimations.forEach(x=>{var S;return(S=x==null?void 0:x.stop)==null?void 0:S.call(x)}),await(0,r.timeout)(100),this._animating))return void console.warn("todo: still animating?");this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),t===void 0&&(t=this.animDuration);const l=typeof n=="function"?n:bu[n||this.animEase],c=this._driver,f=[];this._popAnimations=[];const g=this._popAnimations;if(this.interpolateMode==="spherical")f.push(async function(x,S,C,L,B,W){const q=x.target.clone(),Z=new i.Pa4,j=new i.Pa4,F=x.cameraObject.parent,se=x.cameraObject.up.clone(),pe=Gf({position:x.cameraObject.getWorldPosition(new i.Pa4),up:F?se.transformDirection(F.matrixWorld):se},q),be=Gf(S,S.target),Se=new i.$V;function Be(){x.position.copy(F?F.worldToLocal(j):j),x.target.copy(Z),x.positionUpdated()}return jf({from:0,to:1,duration:C,ease:L,driver:B,onUpdate:Ge=>{Se.phi=Hf(pe.phi,be.phi,Ge),Se.theta=Hf(pe.theta,be.theta,Ge),Se.radius=ne(pe.radius,be.radius,Ge),Z.copy(q).lerp(S.target,Ge),j.setFromSpherical(Se),j.add(Z),Be()},onComplete:()=>{j.copy(S.position),Z.copy(S.target),Be()}},W)}(s,e,t,l,c,g));else if(this.interpolateMode==="linear"){f.push(jf({from:s.position.clone(),to:e.position.clone(),duration:t,ease:l,driver:c,onUpdate:C=>s.position=C,onComplete:()=>s.position=e.position},g)),f.push(jf({from:s.target.clone(),to:e.target.clone(),duration:t,ease:l,driver:c,onUpdate:C=>{s.target=C,s.targetUpdated()},onComplete:()=>{s.target=e.target,s.targetUpdated()}},g));const x=s.cameraObject.quaternion.clone(),S=new i._fP;f.push(jf({from:0,to:1,duration:t,ease:l,driver:c,onUpdate:C=>{S.copy(x).slerp(e.quaternion,C),s.cameraObject.quaternion.copy(S),s.cameraObject.updateProjectionMatrix()},onComplete:()=>{s.cameraObject.quaternion.copy(e.quaternion),s.cameraObject.updateProjectionMatrix()}},g))}await Promise.all(f),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await(0,r.timeout)(10)}fromJSON(e,t){var n,s;return this._cameraViews.forEach(l=>this.deleteView(l)),super.fromJSON(e,t)?(this._cameraViews.forEach(l=>l.focusView=async()=>this.focusView(l)),this._cameraViews.forEach(l=>l.deleteView=()=>this.deleteView(l)),(s=(n=this.uiConfig).uiRefresh)==null||s.call(n),this):null}async animateToObject(e,t=4,n,s,l={min:.5,max:5}){if(!this._viewer)return;const c=new V().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),f=c.getCenter(new i.Pa4),g=c.getSize(new i.Pa4).length()/2;await this.animateToTarget(Math.min(l.max,Math.max(l.min,g*t)),f,n,s)}async animateToFitObject(e,t=1.5,n=1e3,s,l={min:.5,max:50}){if(!this._viewer)return;const c=new V().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),f=c.getCenter(new i.Pa4),g=c.getSize(new i.Pa4);let y=this._viewer.scene.activeCamera.cameraObject,x=1;if(y.isPerspectiveCamera){const S=y.fov*(Math.PI/180),C=2*Math.atan(Math.tan(S/2)*y.aspect),L=g.z/2+Math.abs(g.x/2/Math.tan(C/2)),B=g.z/2+Math.abs(g.y/2/Math.tan(S/2));x=Math.max(L,B)}await this.animateToTarget(Math.min(l.max,Math.max(l.min,x*t)),f,n,s)}async animateToTarget(e,t,n,s){const l=this.getCurrentCameraView();l.target.copy(t);const c=new i.Pa4().subVectors(l.target,l.position).normalize();l.position.copy(c.multiplyScalar(-e).add(l.target)),await this.animateToView(l,n,s)}async _downloadBlob(e,t){var s,l;const n=(s=this._viewer)==null?void 0:s.getPluginByType("FileTransferPlugin");n?await n.exportFile(e,t):(l=this._viewer)==null||l.console.error("FileTransferPlugin required to export/download file")}}function Gf(a,e){const t=a.position.clone();t.sub(e);const n=new i.$V().setFromVector3(t);return n.makeSafe(),n}function Hf(a,e,t){const n=e-a;return n>=Math.PI?a+(n-2*Math.PI)*t:n<=-Math.PI?a+(n+2*Math.PI)*t:a+n*t}function Rb(a,e,t){const n=(1-t)*Math.cos(a)+t*Math.cos(e),s=(1-t)*Math.sin(a)+t*Math.sin(e);return Math.atan2(s,n)}_s.PluginType="CameraViews",ro([Pe("cameraViews")],_s.prototype,"_cameraViews",void 0),ro([(0,r.onChange)(_s.prototype._animationLoop),Pe(),En("Loop All Views",{limitedUi:!0})],_s.prototype,"viewLooping",void 0),ro([Pe(),We("View Pause Time")],_s.prototype,"viewPauseTime",void 0),ro([Pe(),Me("Ease",Object.keys(bu).map(a=>({label:a})))],_s.prototype,"animEase",void 0),ro([Pe(),Hn("Duration",[10,1e4],10,{limitedUi:!0})],_s.prototype,"animDuration",void 0),ro([Pe(),Hn("RotationOffset",[.2,.75],.01)],_s.prototype,"rotationOffset",void 0),ro([Pe(),Me("Interpolation",["spherical","linear"].map(a=>({label:a})))],_s.prototype,"interpolateMode",void 0),ro([En(),Pe()],_s.prototype,"seekOnScroll",void 0),ro([Ee("Animate All Views",{limitedUi:!0})],_s.prototype,"animateAllViews",null),ro([Ee("Record All Views")],_s.prototype,"recordAllViews",null),ro([Ee("Add Current View")],_s.prototype,"addCurrentView",null),ro([Ee("Focus Next")],_s.prototype,"focusNext",void 0),ro([Ee("Focus Previous")],_s.prototype,"focusPrevious",void 0);const ny=new i.Pa4;function Ib(a,e,t){let n=a.dot(e);n=Math.min(Math.max(n,-1),1);const s=Math.acos(n)*t;return ny.copy(a).multiplyScalar(n).sub(e).negate().normalize(),a.multiplyScalar(Math.cos(s)).add(ny.multiplyScalar(Math.sin(s)))}var Wf,el=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let kl=Wf=class{constructor(a){this.enabled=!1,this.power=.5,this.bgcolor=new i.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new i.Ilk}},this.parsFragmentSnippet=(e,t)=>this.enabled?r.glsl`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=a.getPlugin(Za),this._setDirty=this._setDirty.bind(this)}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Yn(a.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(a,e,t){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}};kl.PluginType="Vignette",el([(0,r.onChange)(Wf.prototype._setDirty),En("Enable"),Pe()],kl.prototype,"enabled",void 0),el([(0,r.onChange)(Wf.prototype._setDirty),Hn("Power",[.1,4],.01,{limitedUi:!0}),Pe()],kl.prototype,"power",void 0),el([(0,r.onChange)(Wf.prototype._setDirty),it("Color"),Pe()],kl.prototype,"bgcolor",void 0),kl=Wf=el([lt("Vignette")],kl);class ap extends gu{constructor(){super()}generateExtension(e){return new kl(e)}get power(){var e;return((e=this._extension)==null?void 0:e.power)??1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e;return((e=this._extension)==null?void 0:e.bgcolor)??new i.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}ap.PluginType="Vignette";var Zu=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Ua=class extends Ln{constructor(){super(),this.enabled=!0,this.dependencies=[ri],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const a=await(0,r.uploadFile)(!0,!1,"model/gltf");await this.loadScenes(a)}async loadScenes(a){var t,n;const e=await Promise.all(a.map(async s=>await s.arrayBuffer()));for(let s=0;s<a.length;s++){const l=a[s];this.scenes.push({[l.name]:new Uint8Array(e[s])}),this.assets[l.name]={path:l.name,file:l}}(n=(t=this.uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t)}async play(){var s;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const a=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");a==null||a.enabled,a&&(a.enabled=!1);const e=this._viewer.getPluginByType("FrameFade"),t=this._viewer.getPluginByType("GLTFAnimation"),n=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const l of this.scenes){if(!this._isPlaying)break;const c=Object.keys(l);t==null||t.stopAnimation(!1),await(n==null?void 0:n.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const g of c){let y=this.assets[g];y||(y={path:g,file:new File([l[g]],g)},this.assets[g]=y),await((s=this._viewer.getManager())==null?void 0:s.addAssetSingle(y,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,a&&(a.enabled=!1),e&&(e.enabled=!0,await e.startTransition(1e3));const f=[(0,r.timeout)(this.minSceneTime)];t&&f.push(t.playAnimation()),n&&f.push(n.animateAllViews()),await Promise.all(f)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const a={};for(const n of this.scenes)for(const s of Object.keys(n)){const l=a[s]?s+"_":s;a[l]=n[l]}const e=A0(a),t=new Blob([e],{type:"application/zip"});(0,r.downloadBlob)(t,"scenes.glbloop")}async onAdded(a){var t,n;await super.onAdded(a);const e=this;(n=(t=a.getManager())==null?void 0:t.importer)==null||n.Importers.push(new Ms(class extends b0{load(s,l,c,f){super.load(s,g=>{e.loadScenes([...g.values()]),l==null||l(null),(0,r.timeout)(100).then(e.play)},c,f)}},["glbloop"],!0))}};Ua.PluginType="SceneLoopPlugin",Zu([nr("Loaded scenes")],Ua.prototype,"loadedScenes",null),Zu([Ee("Load Scenes")],Ua.prototype,"promptLoadScenes",null),Zu([nr("Playing")],Ua.prototype,"_isPlaying",void 0),Zu([We("Min Scene Time")],Ua.prototype,"minSceneTime",void 0),Zu([Ee("Play")],Ua.prototype,"play",null),Zu([Ee("Stop")],Ua.prototype,"stop",null),Zu([Ee("Download Scenes")],Ua.prototype,"downloadScenes",null),Ua=Zu([lt("Scene Loop")],Ua);var rv=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let sv=class extends eo{constructor(a,e,t){super(a,e,t??new _g,new i.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(a,e,t,n,s){if(!this.enabled||!this.camera)return;const l=this.overrideMaterial;l.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(l.uniforms.lastProjectionViewMatrix.value.copy(l.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(a,e,t,n,s),l.uniforms.lastProjectionViewMatrix.value.copy(l.uniforms.currentProjectionViewMatrix.value)}};rv([En("Enabled")],sv.prototype,"enabled",void 0),sv=rv([lt("Velocity Buffer (TAA)")],sv);class _g extends i.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new i.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new i.Vkp},currentProjectionViewMatrix:{value:new i.yGw},lastProjectionViewMatrix:{value:new i.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new i.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,n,s,l){const c=this._previousWorldMatrices[l.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(c??l.matrixWorld),c?c.copy(l.matrixWorld):this._previousWorldMatrices[l.uuid]=l.matrixWorld.clone();let f=l.material;Array.isArray(f)&&(f=f[0]),this.uniforms.alphaMap.value=(f==null?void 0:f.alphaMap)??null,this.uniforms.alphaTest.value=!f||!f.alphaTest||f.alphaTest<1e-7?.001:f.alphaTest;let g=this.uniforms.alphaMap.value?1:void 0;g!==this.defines.USE_ALPHAMAP&&(g===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=g,this.needsUpdate=!0),g=f.userData.ALPHA_I_RGBA_PACKING?1:void 0,g!==this.defines.ALPHA_I_RGBA_PACKING&&(g===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=g,this.needsUpdate=!0),this.side=f.side??i.ehD}}class Qf extends Ur{passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:i.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const n=new Set,s=new Set;return new class extends sv{render(l,c,f,g,y){var L;if(e.renderer.frameCount>0)return;const x=l.getRenderTarget(),S=l.getActiveCubeFace(),C=l.getActiveMipmapLevel();(L=this.scene)==null||L.traverse(({material:B})=>{B&&((B.transparent&&B.userData.renderToDepth||!B.transparent&&B.transmission===0&&B.userData.renderToDepth===!1)&&(n.add(B),B.transparent=!B.transparent),Math.abs(B.transmission||0)>0&&B.userData.renderToDepth&&(s.add([B,B.transmission]),B.transmission=0))}),ot(l,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(l,c,t,g,y)),n.forEach(B=>B.transparent=!B.transparent),n.clear(),s.forEach(([B,W])=>B.transmission=W),s.clear(),l.setRenderTarget(x,S,C)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(t=>{var n;return e.renderer.disposeTarget((n=t==null?void 0:t.dispose)==null?void 0:n.call(t))}),super.onRemove(e)}updateShaderProperties(e){var t;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled?((t=this.getVelocityBuffer())==null?void 0:t.texture)??null:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}Qf.PluginType="VelocityBuffer";var xu,Wh=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Qo=xu=class{constructor(a){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(e,t)=>this.enabled?`#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;
#if USE_LUT == 1
uniform sampler3D lut3d;
#endif
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
#if USE_LUT == 1
uniform sampler2D lut2d;
#endif
#if USE_LUT1 == 1
uniform sampler2D lut2d1;
#endif
#if USE_LUT2 == 1
uniform sampler2D lut2d2;
#endif
vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
int getLUTBit(in int number){return number%2;}int getLUTIndex(in int number){return number%8;}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));
#if USE_3DTEXTURE == 1
if(lutIndex==0.){
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}
#else
if(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);
#endif
}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._viewer=a,this._combinedPostPlugin=a.getPlugin(Za),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const a=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let e=a?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,e,this.extraUniforms.lutSize,a),this.extraDefines.USE_LUT=this.lutMap?1:0,e=a?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,e,this.extraUniforms.lutSize1,a),this.extraDefines.USE_LUT1=this.lutMap1?1:0,e=a?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,e,this.extraUniforms.lutSize2,a),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=a,this._setDirty()}_updateLUTMap(a,e,t,n){if(a){let s=1;n==1?(e.value=a.texture3D,s=a.texture3D.image.width):a.texture&&(e.value=a.texture,s=a.texture.image.width),e.value.needsUpdate=!0,t.value=s}}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Yn(a.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function eh(a){const e=a==null?void 0:a.userData;if(!e)return!1;e[Ro.PluginType]||(e[Ro.PluginType]={});const t=e[Ro.PluginType];return t.enable=!0,t.index===void 0&&(t.index=0),a.isMaterial&&(a.needsUpdate=!0),!0}Wh([Pe(),(0,r.onChange)(xu.prototype._updateParams),En("Enable")],Qo.prototype,"enabled",void 0),Wh([Pe(),(0,r.onChange)(xu.prototype._updateParams),En("LUT Background")],Qo.prototype,"lutBackground",void 0),Wh([Pe(),(0,r.onChange)(xu.prototype._updateParams),Hn("Intensity")],Qo.prototype,"intensity",void 0),Wh([(0,r.onChange)(xu.prototype._updateParams),je("LUT"),Pe()],Qo.prototype,"lutMap",void 0),Wh([(0,r.onChange)(xu.prototype._updateParams),je("LUT1"),Pe()],Qo.prototype,"lutMap1",void 0),Wh([(0,r.onChange)(xu.prototype._updateParams),je("LUT2"),Pe()],Qo.prototype,"lutMap2",void 0),Qo=xu=Wh([lt("LUT")],Qo);class Ro extends gu{_getUiConfig(e){var n,s;const t={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var l;return((l=e.materialObject.userData[Ro.PluginType])==null?void 0:l.enable)??!0},set value(l){var f;const c=e.materialObject.userData[Ro.PluginType];l!==(c==null?void 0:c.enable)&&(c||eh(e.materialObject),e.materialObject.userData[Ro.PluginType].enable=l,(f=t.uiRefresh)==null||f.call(t,"postFrame",!0))},onChange:(n=this._extension)==null?void 0:n.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(l=>({label:l[0],value:l[1]})),label:"index",hidden:()=>{const l=e.materialObject.userData[Ro.PluginType];return!!l&&!l.enable},get value(){var l;return((l=e.materialObject.userData[Ro.PluginType])==null?void 0:l.index)??0},set value(l){var c;e.materialObject.userData[Ro.PluginType]||eh(e.materialObject),e.materialObject.userData[Ro.PluginType].index=l,(c=t.uiRefresh)==null||c.call(t,"postFrame",!0)},onChange:(s=this._extension)==null?void 0:s.setDirty}]};return t}constructor(){super(),this.materialExtension={uuid:mn(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},computeCacheKey:e=>{var t;return(this.enabled?"1":"0")+((t=e.materialObject.userData[Ro.PluginType])!=null&&t.enable?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var n,s;await super.onAdded(e),(n=e.getPlugin(ir))==null||n.registerGBufferUpdater(this.updateGBuffer);const t=e.getPlugin(ri);(s=t==null?void 0:t.materials)==null||s.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new Qo(e)}updateGBuffer(e,t){var n,s;if(e instanceof i.Kj0&&((n=e.material)!=null&&n.userData)){const l=(s=e.material)==null?void 0:s.userData[Ro.PluginType];if(l){const c=l.enable===!1?0:1;t.w=Cm(t.w,0,c);for(let g=0;g<3;g++)t.y=Ph(t.y,g);let f=l.enable?l.index:0;f=Math.min(f,7),t.y=t.y|f}else t.w=Cm(t.w,0,1)}}}Ro.PluginType="LUTPlugin1";class lp{constructor(e){this._zee=new i.Pa4(0,0,1),this._euler=new i.USm,this._q0=new i._fP,this._q1=new i._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new i._fP,this._initQuaternionDest=new i._fP,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=t=>{this.deviceOrientation=t},this._isConnected=!1,this._viewer=e}getOffsetFromCenter(e=!0){if(!this.deviceOrientation)return new i.FM8;this.getQuaternion(e,this._q2);const t=new i.Pa4(0,0,1);return t.applyQuaternion(this._q2),new i.FM8(t.x,t.y)}getQuaternion(e,t){if(t||(t=new i._fP),!this.deviceOrientation)return t.identity();const n=this.deviceOrientation,s=n.alpha!==null?i.M8C.degToRad(n.alpha):0,l=n.beta!==null?i.M8C.degToRad(n.beta):0,c=n.gamma!==null?i.M8C.degToRad(n.gamma):0,f=this.screenOrientation?i.M8C.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(t,s,l,c,f,e),t}_toQuaternion(e,t,n,s,l,c){this._euler.set(n,t,-s,"YXZ"),e.setFromEuler(this._euler),e.multiply(this._q1);const f=document.getElementById("debug");return f&&(f.textContent=l+""),e.multiply(this._q0.setFromAxisAngle(this._zee,-l)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(e).invert(),this._initQuaternionDest.__init=!0),c&&e.premultiply(this._initQuaternionDest),e}static IsCompatible(){return window.DeviceOrientationEvent!==void 0&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var e;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),(e=this._viewer)==null||e.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),typeof DeviceMotionEvent.requestPermission=="function"&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then(e=>{e=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))}).catch(e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)}))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new i._fP)}}class iy{constructor(){this._mousePos=new i.FM8(0,0),this._isConnected=!1}getOffsetFromCenter(){return new i.FM8(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(e){this._mousePos.set(e.clientX,e.clientY)}}var th,xl=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let ra=th=class extends Ln{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new i.Pa4(0,0,0),this.damping=.5,this.cameraView="",this._target=new i.Pa4,this._center=new i.Pa4,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var f,g;if(!this.enabled)return void((g=(f=this._object)._updateProjectionMatrixParallax)==null?void 0:g.call(f));const a=this._object,e=a.near;let t=e*Math.tan(.5*i.M8C.DEG2RAD*a.fov)/a.zoom,n=2*t,s=a.aspect*n,l=-.5*s;if(a.view!==null&&a.view.enabled){const y=a.view.fullWidth,x=a.view.fullHeight;l+=a.view.offsetX*s/y,t-=a.view.offsetY*n/x,s*=a.view.width/y,n*=a.view.height/x}l-=this._offX*e/this._focalDistance,t-=this._offY*e/this._focalDistance;const c=a.filmOffset;c!==0&&(l+=e*c/a.getFilmWidth()),a.projectionMatrix.makePerspective(l,l+s,t,t-n,e,a.far),a.projectionMatrixInverse.copy(a.projectionMatrix).invert()},this._preFrame=a=>{this.update(a.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new r.Damper,this._yDamper=new r.Damper,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(a){var e,t,n;await super.onAdded(a),lp.IsCompatible()?this._input=new lp(a):this._input=new iy,a.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),a.addEventListener("preFrame",this._preFrame),(e=this._viewer)==null||e.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),(t=this._viewer)==null||t.container.addEventListener("pointerup",this.onPointerUp.bind(this)),(n=a.getPluginByType("Picking"))==null||n.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var a,e,t,n;this._object&&((a=this._object)!=null&&a._updateProjectionMatrixParallax)&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=(e=this._viewer)==null?void 0:e.scene.activeCamera.cameraObject,(t=this._object)!=null&&t.isOrthographicCamera?(n=this._viewer)==null||n.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var a;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",(a=this._viewer)==null||a.container.appendChild(this._indicator))}onPointerDown(a){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=a.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=a.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(a){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.interactionsEnabled=!1,this._updateFocalDistance();const e=this._object.matrixWorld.elements,t=new i.Pa4(e[0],e[1],e[2]),n=new i.Pa4(e[4],e[5],e[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let s=this.sensitivity;this.invert&&(s*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*s,a,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*s,a,1);const l=this._object;l.position.add(n.multiplyScalar(this._offY)).add(t.multiplyScalar(this._offX)),l.updateProjectionMatrix(),l.updateMatrixWorld(),this._dirty=!0}_onObjectHit(a){var e,t;a.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(a.intersects.intersect.point),a.intersects.selectedObject=null,(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout(()=>{var n,s;this._indicator.style.opacity="0",setTimeout(()=>this._indicator.style.display="none",600),(s=(n=this.uiConfig)==null?void 0:n.uiRefresh)==null||s.call(n,"postFrame",!0)},200)))}_updateFocalDistance(){if(!this._object)return;const a=this._object,e=new i.Pa4;a.getWorldDirection(e),e.normalize(),this._focalDistance=this.focalPointHit.clone().sub(a.position).dot(e)}_onEnabledChange(){var a,e,t;if(this._viewer){if(this.enabled){if((a=this._input)==null||a.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.interactionsEnabled=!1;const n=this._viewer.getPluginByType("CameraViews"),s=n==null?void 0:n.camViews.find(l=>l.name===this.cameraView);n&&s&&n.setCurrentCameraView(s),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const n=this._object;n.updateProjectionMatrix(),n.updateMatrixWorld()}(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var a;(a=this._input)==null||a.disconnect()}};ra.PluginType="ParallaxCameraControllerPlugin",xl([(0,r.onChange)(th.prototype._onEnabledChange),Pe(),En("Enabled")],ra.prototype,"enabled",void 0),xl([Pe(),En("enableEdit")],ra.prototype,"enableEdit",void 0),xl([Pe(),En("Invert")],ra.prototype,"invert",void 0),xl([Pe(),Hn("Sensitivity",[.1,2],.01)],ra.prototype,"sensitivity",void 0),xl([Pe("focalPoint"),Ni("Focal Point Hit",void 0,.001)],ra.prototype,"focalPointHit",void 0),xl([(0,r.onChange)(th.prototype._onDampingChange),Pe(),Hn("Damping",[0,1],.001)],ra.prototype,"damping",void 0),xl([Pe(),We("Camera View")],ra.prototype,"cameraView",void 0),ra=th=xl([lt("Parallax Camera Controller")],ra);var Xf=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Ul=class extends Ln{addNoiseBumpMaterial(a){return Wc(a.materialObject)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new ry(e))}constructor(){super(),this.enabled=!0,this.dependencies=[ri],this._uniforms={noiseBumpParams:{value:new i.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new i.Ltg(0,1,3,0)},flakeFallOffParams:{value:new i.Pa4(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._noiseBumpMat)!=null&&t.hasBump)?Vc+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(a,e,t)=>{var s;if(!this.enabled||!((s=e.materialObject.userData._noiseBumpMat)!=null&&s.hasBump))return;const n="#glMarker beforeAccumulation";a.fragmentShader=a.fragmentShader.replace(n,`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif

`+n),a.defines.USE_UV="",a.extensionDerivatives=!0},onObjectRender:(a,e)=>{var s;const t=(s=e.materialObject.userData)==null?void 0:s._noiseBumpMat;if(!(t!=null&&t.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(t.bumpNoiseParams),this._uniforms.noiseBumpScale.value=t.bumpScale,this._uniforms.noiseBumpFlakeScale.value=t.flakeScale,this._uniforms.noiseFlakeClamp.value=t.flakeClamp,this._uniforms.noiseFlakeRadius.value=t.flakeRadius,t.flakeParams&&this._uniforms.flakeParams.value.copy(t.flakeParams),t.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(t.flakeFallOffParams),this._uniforms.useColorFlakes.value=t.useColorFlakes;const n=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==n&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._noiseBumpMat)!=null&&t.hasBump?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.hasBump)||!1},set value(n){var s,l;n!==((s=a.materialObject.userData._noiseBumpMat)==null?void 0:s.hasBump)&&(n?Wc(a.materialObject)||e.alert("Cannot add noise bump."):a.materialObject.userData._noiseBumpMat&&(a.materialObject.userData._noiseBumpMat.hasBump=!1,a.materialObject.needsUpdate=!0),(l=t.uiRefresh)==null||l.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var n;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var s;return!((s=a.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"x"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var s;return!((s=a.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"y"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var s;return!((s=a.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"z"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var s;return!((s=a.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"w"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var s;return!((s=a.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var s;return!((s=a.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var s;return!((s=a.materialObject.userData._noiseBumpMat)!=null&&s.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var t,n,s,l,c;await super.onAdded(a);const e=a.getPlugin(ri);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(l=(s=e==null?void 0:e.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:l.extensions)==null||c.push(Pb)}async onRemove(a){var e,t,n,s;return(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(s=(n=a.getPlugin(ri))==null?void 0:n.importer)==null||s.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};function Wc(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const t=e._noiseBumpMat;return t.hasBump=!0,t.bumpNoiseParams===void 0&&(t.bumpNoiseParams=[.5,.5]),t.bumpScale===void 0&&(t.bumpScale=.05),t.flakeScale===void 0&&(t.flakeScale=.05),t.flakeClamp===void 0&&(t.flakeClamp=1),t.flakeRadius===void 0&&(t.flakeRadius=.3),t.useColorFlakes===void 0&&(t.useColorFlakes=!1),t.flakeParams===void 0&&(t.flakeParams=new i.Ltg(0,1,3,0)),t.flakeFallOffParams===void 0&&(t.flakeFallOffParams=new i.Pa4(0,1,0)),a.isMaterial&&(a.needsUpdate=!0),!0}Ul.PluginType="NoiseBumpMaterialPlugin",Ul.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",Xf([En("Enabled",a=>({onChange:a.setDirty})),Pe()],Ul.prototype,"enabled",void 0),Ul=Xf([lt("NoiseBumpMaterial Materials")],Ul);class ry{constructor(e){this.parser=e,this.name=Ul.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.userData||(t.userData={}),Wc(t),t.userData._noiseBumpMat=ui(s,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const Pb=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;t.extensions=t.extensions||{};const n=kn(e.userData._noiseBumpMat,!1);t.extensions[Ul.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=n,a.extensionsUsed[Ul.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});class wl extends ur{constructor(e,t){super({vertexShader:m.vertexShader,fragmentShader:t+`
`+Wm+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=texture2D(tVelocity,c_frag.xy).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new i.FM8},cameraNearFar:{value:new i.FM8},lastProjectionViewMatrix:{value:new i.yGw},currentProjectionViewMatrix:{value:new i.yGw},projection:{value:new i.yGw},inverseViewMatrix:{value:new i.yGw},jitterSample:{value:new i.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new i.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,n,s,l){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const c=this.uniforms.tVelocity.value?1:0;c!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=c,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,n,s,l),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}(function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)})([Pe(),Te()],wl.prototype,"feedBack",void 0);class Fl extends Ur{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[ir],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(e){if(!e.getPlugin(na))throw"Add ProgressivePlugin before TAA";const t=new wl(e.getPlugin(na).lastFrame,e.getPlugin(ir).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,n=this._pass.passObject;if(n.taaEnabled=t<=1,!n.taaEnabled)return!1;const s=e.scene.activeCamera;return n.updateShaderProperties([e.getPlugin(ir),s,e.getPluginByType("VelocityBuffer")]),n.target=e.getPlugin(na).lastFrame,n.updateCameraProperties(s==null?void 0:s.cameraObject),!0}async onAdded(e){await super.onAdded(e),this.stableNoise=this._stableNoise}get stableNoise(){var e;return((e=this._viewer)==null?void 0:e.renderer.stableNoise)??this._stableNoise}set stableNoise(e){this._viewer&&(this._viewer.renderer.stableNoise=e),this._stableNoise=e}get uiConfig(){var t;const e=(t=this.pass)==null?void 0:t.passObject.uiConfig;if(e&&e.children)return e.children.includes(this._stableNoiseConfig)||e.children.push(this._stableNoiseConfig),e}}Fl.PluginType="TAA";var ov=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let po=class extends Ln{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=a=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const t=this._lastFsElement||((e=this._viewer)==null?void 0:e.canvas);t&&(t.style.width=this._lastSize[0],t.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(a){var t;if(this.isFullScreen())return;const e=a||((t=this._viewer)==null?void 0:t.canvas);return e?(this._lastFsElement=e,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[e.style.width,e.style.height],e.style.width="100%",e.style.height="100%",e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(a){return this.isFullScreen()?this.exit():this.enter(a)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};po.PluginType="FullScreenPlugin",ov([Ee("Enter FullScreen")],po.prototype,"enter",null),ov([Ee("Exit FullScreen")],po.prototype,"exit",null),ov([Ee("Toggle FullScreen")],po.prototype,"toggle",null),po=ov([lt("Full Screen")],po);const CE=(a,e)=>{const t={};for(const n of a.mappings)for(const s of n.variants)t[e[s]]={material:null,gltfMaterialIndex:n.material};return t},qf="KHR_materials_variants";class Yf{constructor(e){this.parser=e,this.name=qf}async afterRoot(e){const t=this.parser,n=t.json;if(!n.extensions||!n.extensions[this.name])return;const s=(l=>{const c=[],f=new Set;for(const g of l){let y=g,x=0;for(;f.has(y);)y=g+"."+ ++x;f.add(y),c.push(y)}return c})((n.extensions[this.name].variants||[]).map(l=>l.name));for(const l of e.scenes)l.traverse(c=>{const f=t.associations.get(c);if(!f||f.meshes===void 0||f.primitives===void 0)return;const g=n.meshes[f.meshes].primitives[f.primitives].extensions;g&&g[this.name]&&(c.userData._variantMaterials=CE(g[this.name],s))});await Promise.all(e.scenes.map(async l=>{const c=[];return l.traverse(f=>{return(g=f).material!==void 0&&g.userData&&g.userData._variantMaterials&&c.push((async y=>{const x=y.material,S=y.userData._variantMaterials,C=[];for(const L in S){const B=S[L];if(B.material)continue;const W=B.gltfMaterialIndex;C.push(t.getDependency("material",W).then(q=>{y.material=q,t.assignFinalMaterial(y),S[L].material=y.material}))}return Promise.all(C).then(()=>{y.material=x})})(f));var g}),l.userData.__importData||(l.userData.__importData={}),l.userData.__importData[qf]={names:s},Promise.all(c)}))}}const Db=a=>a.material!==void 0&&a.userData&&a.userData._variantMaterials&&!!Object.values(a.userData._variantMaterials).filter(e=>av(e==null?void 0:e.material)),av=a=>a&&a.isMaterial&&!Array.isArray(a);class Lb{constructor(e){this.writer=e,this.name=qf,this.variantNames=[]}beforeParse(e){const t=new Set;for(const n of e)n.traverse(s=>{if(!Db(s))return;const l=s.userData._variantMaterials;for(const c in l){const f=l[c];av(f.material)&&t.add(c)}});t.forEach(n=>this.variantNames.push(n))}writeMesh(e,t){if(!Db(e))return;const n=e.userData,s=n._variantMaterials,l={};for(const g in s){const y=s[g].material;if(!av(y))continue;const x=this.variantNames.indexOf(g),S=this.writer.processMaterial(y);l[S]||(l[S]={material:S,variants:[]}),l[S].variants.push(x)}const c=Object.values(l).map(g=>g.variants.sort((y,x)=>y-x)&&g).sort((g,y)=>g.material-y.material);if(c.length===0)return;const f=av(n._originalMaterial)?this.writer.processMaterial(n._originalMaterial)??-1:-1;for(const g of t.primitives)f>=0&&(g.material=f),g.extensions=g.extensions||{},g.extensions[this.name]={mappings:c}}afterParse(e){if(this.variantNames.length===0)return;const t=this.writer.json;t.extensions=t.extensions||{};const n=this.variantNames.map(s=>({name:s}));t.extensions[this.name]={variants:n},this.writer.extensionsUsed[this.name]=!0}}function wu(a){return new Lb(a)}class Qh extends Ln{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[ri],this.variants={},this.selectedVariant="",this._objectAdded=e=>{var n,s;const t=e.object;(t==null?void 0:t.assetType)==="model"&&t.modelObject&&this._viewer&&(t.modelObject.traverse(l=>{var g,y,x,S,C;if(l.userData._variantMaterials)for(const L of Object.values(l.userData._variantMaterials))L!=null&&L.material&&(L.material=((x=(y=(g=this._viewer)==null?void 0:g.getManager())==null?void 0:y.materials)==null?void 0:x.processMaterial(L.material,{}))||L.material);const c=(C=(S=l.userData)==null?void 0:S.__importData)==null?void 0:C[qf];if(!c)return;const f=c.names||[];for(const L of f)this.variants[L]||(this.variants[L]=[]),this.variants[L].push(l);delete l.userData.__importData[qf]}),(s=(n=this.uiConfig).uiRefresh)==null||s.call(n))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(e=>e?{label:e}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var n,s,l,c;await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._objectAdded);const t=e.getPlugin(ri);(n=t==null?void 0:t.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(l=(s=t==null?void 0:t.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:l.extensions)==null||c.push(wu)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new Yf(t))}async onRemove(e){var s,l,c,f,g,y;e.scene.removeEventListener("addSceneObject",this._objectAdded);const t=e.getPlugin(ri);(s=t.importer)==null||s.removeEventListener("loaderCreate",this._loaderCreate);const n=(f=(c=(l=t.exporter)==null?void 0:l.getExporter("gltf","glb"))==null?void 0:c.extensions)==null?void 0:f.indexOf(wu);return n!==void 0&&n!==-1&&((y=(g=t.exporter.getExporter("gltf","glb"))==null?void 0:g.extensions)==null||y.splice(n,1)),this.variants={},super.onRemove(e)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(e,t=!1,n,s=!0){if(!t&&!n&&this.selectedVariant===e||!e)return;n||(this.selectedVariant=e);const l=n?Array.isArray(n)?n:[n]:e?this.variants[e]||[]:Object.values(this.variants).flat();for(const c of l){const f=new Set,g=y=>{var S,C;if(!y.userData._variantMaterials||f.has(y))return;const x=e?(S=y.userData._variantMaterials[e])==null?void 0:S.material:y.userData._originalMaterial;x&&(y.userData._originalMaterial||(y.userData._originalMaterial=y.material),(C=y==null?void 0:y.setMaterial)==null||C.call(y,x)),f.add(y)};s?c.traverse(g):g(c)}}}Qh.PluginType="GLTFKHRMaterialVariantsPlugin",function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)}([(0,r.onChange)(Qh.prototype._variantChanged)],Qh.prototype,"selectedVariant",void 0);function vg(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const t=e._ssBevel;return t.hasSSBevel=!0,t.radius===void 0&&(t.radius=0),a.isMaterial&&(a.needsUpdate=!0),!0}let yg=class extends ur{constructor(a,e,t,n){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new i.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new i.Pa4(1,1,1)}},vertexShader:cc,fragmentShader:`

            ${t}

            ${Vc}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(s,l,c)=>{var f,g;this.enabled&&((g=(f=l.materialObject.userData)==null?void 0:f._ssBevel)!=null&&g.hasSSBevel)&&(s.fragmentShader=Yn(s.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(s,l,c)=>{var y,x;if(!this.enabled||!((x=(y=l.materialObject.userData)==null?void 0:y._ssBevel)!=null&&x.hasSSBevel))return;const f=l.materialObject,g=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==g&&(this.materialExtension.extraUniforms.tSSBevelMap.value=g,f.needsUpdate=!0)},getUiConfig:s=>{const l={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var c;return((c=s.materialObject.userData._ssBevel)==null?void 0:c.hasSSBevel)||!1},set value(c){var f,g;c!==((f=s.materialObject.userData._ssBevel)==null?void 0:f.hasSSBevel)&&(c?vg(s.materialObject)||alert("Cannot add screen space bevel."):s.materialObject.userData._ssBevel&&(s.materialObject.userData._ssBevel.hasSSBevel=!1,s.materialObject.needsUpdate=!0),(g=l.uiRefresh)==null||g.call(l,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var c;return!((c=s.materialObject.userData._ssBevel)!=null&&c.hasSSBevel)},property:[s.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return l},parsFragmentSnippet:(s,l)=>{var c,f;return this.enabled&&((f=(c=l==null?void 0:l.materialObject.userData)==null?void 0:c._ssBevel)!=null&&f.hasSSBevel)?r.glsl`
            uniform sampler2D tSSBevelMap;
            ${Dm}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:s=>{var l,c;return(this.enabled?"1":"0")+((c=(l=s.materialObject.userData)==null?void 0:l._ssBevel)!=null&&c.hasSSBevel?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=n,this._edgeMaterial=new Zi({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new i.FM8(1,1)},cameraPositionWorld:{value:new i.Pa4(1,1,1)}},vertexShader:cc,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new Zi({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new i.FM8(.5,.5)},direction:{value:new i.FM8(.5,.5)}},vertexShader:cc,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(a,e,t,n,s){var g,y;if(!this.enabled)return;const l=a.baseRenderer,c={minFilter:i.wem,magFilter:i.wem,isAntialiased:!1,format:i.wk1,depthBuffer:!1,generateMipmaps:!1},f=l.getTempTarget(c);this._renderEdges(l,f),this._blurEdges(l,f),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),(g=this._viewerApp.getPlugin(ir))==null||g.updateShaderProperties(this.material),(y=this._viewerApp.getPlugin(Xu))==null||y.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=f.texture,super.render(a,this._target,f,n,s),l.releaseTempTarget(f)}_initsamples(){const a=[];return a.push(new i.FM8(-8,0).multiplyScalar(.125)),a.push(new i.FM8(-6,-4).multiplyScalar(.125)),a.push(new i.FM8(-3,-2).multiplyScalar(.125)),a.push(new i.FM8(-2,-6).multiplyScalar(.125)),a.push(new i.FM8(1,-1).multiplyScalar(.125)),a.push(new i.FM8(2,-5).multiplyScalar(.125)),a.push(new i.FM8(6,-7).multiplyScalar(.125)),a.push(new i.FM8(5,-3).multiplyScalar(.125)),a.push(new i.FM8(4,1).multiplyScalar(.125)),a.push(new i.FM8(7,4).multiplyScalar(.125)),a.push(new i.FM8(3,5).multiplyScalar(.125)),a.push(new i.FM8(0,7).multiplyScalar(.125)),a.push(new i.FM8(-1,3).multiplyScalar(.125)),a.push(new i.FM8(-4,6).multiplyScalar(.125)),a.push(new i.FM8(-7,8).multiplyScalar(.125)),a.push(new i.FM8(-5,2).multiplyScalar(.125)),a}_blurEdges(a,e){var c,f;const t={minFilter:i.wem,magFilter:i.wem,isAntialiased:!1,format:i.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},n=a.getTempTarget(t),s=((c=e.texture.image)==null?void 0:c.width)||1,l=((f=e.texture.image)==null?void 0:f.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new i.FM8(s,l),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new i.FM8(1,0),a.blit(void 0,n,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new i.FM8(s/2,l/2),this._separableBlurMaterial.uniforms.colorTexture.value=n.texture,this._separableBlurMaterial.uniforms.direction.value=new i.FM8(0,1),a.blit(void 0,e,{material:this._separableBlurMaterial}),a.releaseTempTarget(n)}_renderEdges(a,e){var s,l,c,f;const t=((s=e.texture.image)==null?void 0:s.width)||1,n=((l=e.texture.image)==null?void 0:l.height)||1;this._edgeMaterial.uniforms.screenSize.value=new i.FM8(t,n),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),(c=this._viewerApp.getPlugin(ir))==null||c.updateShaderProperties(this._edgeMaterial),(f=this._viewerApp.getPlugin(Xu))==null||f.updateShaderProperties(this._edgeMaterial),a.blit(void 0,e,{material:this._edgeMaterial})}};yg=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c}([lt("SSBevel")],yg);class Qc extends Ur{get bevelTarget(){return this._bevelTarget}constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[ri,ir,Xu],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new sy(t))}passCtor(e){var n;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:i.cLu,minFilter:i.TyD,magFilter:i.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const t=e.getPluginByType("debug");return t&&t.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new yg(e.renderer,this._bevelTarget,((n=e.getPlugin(ir))==null?void 0:n.getUnpackSnippet())??"",e)}async onAdded(e){var n,s,l,c,f,g,y,x;await super.onAdded(e);const t=e.getPlugin(ri);return(n=this.pass)!=null&&n.passObject.materialExtension&&((l=t==null?void 0:t.materials)==null||l.registerMaterialExtension((s=this.pass)==null?void 0:s.passObject.materialExtension)),(c=t==null?void 0:t.importer)==null||c.addEventListener("loaderCreate",this._loaderCreate),(y=(g=(f=t==null?void 0:t.exporter)==null?void 0:f.getExporter("gltf","glb"))==null?void 0:g.extensions)==null||y.push(RE),(x=e.getPlugin(ir))==null||x.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,t,n,s;(e=this._viewer)==null||e.setDirty(),(s=(t=this.pass)==null?void 0:(n=t.passObject.materialExtension).setDirty)==null||s.call(n)}_update(e){var n,s;let t=this.enabled;if(t&&!this._lastEnabled){const l=(n=this._viewer)==null?void 0:n.getPluginByType("NormalBufferPlugin");l&&!l.enabled&&(l.enabled=!0),l||((s=this._viewer)==null||s.console.error("SSBevelPlugin needs NormalBufferPlugin"))}return this._lastEnabled=t,t}get uiConfig(){var t,n,s,l;const e=((n=(t=this.pass)==null?void 0:t.passObject)==null?void 0:n.uiConfig)??{};return(l=(s=e.children)==null?void 0:s.map(c=>(0,r.getOrCall)(c)))==null||l.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),e}updateGBuffer(e,t){var n,s,l;if(e instanceof i.Kj0&&((n=e.material)!=null&&n.userData)){for(let f=3;f<8;f++)t.y=Ph(t.y,f);let c=(s=e.material)!=null&&s.userData._ssBevel?(l=e.material)==null?void 0:l.userData._ssBevel.radius:0;c=Math.min(c,31),c<<=3,t.y=t.y|c}}}Qc.PluginType="SSBevelPlugin",Qc.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class sy{constructor(e){this.parser=e,this.name=Qc.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.userData||(t.userData={}),vg(t),t.userData._ssBevel=ui(s,t.userData._ssBevel,!1,{}),Promise.resolve()}}const RE=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;t.extensions=t.extensions||{};const n=kn(e.userData._ssBevel,!1);t.extensions[Qc.SSBEVEL_GLTF_EXTENSION]=n,a.extensionsUsed[Qc.SSBEVEL_GLTF_EXTENSION]=!0}});class oy{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Yn(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class lv extends gu{generateExtension(e){return new oy}}lv.PluginType="GammaCorrection";var Kf=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let zl=class extends Ln{addTriplanarMapping(a){var t;const e=(t=a.materialObject)==null?void 0:t.userData;return!!e&&(e._triplanarMapping||(e._triplanarMapping={}),e._triplanarMapping.enable=!0,e._triplanarMapping.scaleFactor===void 0&&(e._triplanarMapping.scaleFactor=1),e._triplanarMapping.blendFactor===void 0&&(e._triplanarMapping.blendFactor=1),e._triplanarMapping.offsetFactor===void 0&&(e._triplanarMapping.offsetFactor=0),a.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new IE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[ri],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(a,e,t)=>{var g,y;if(!this.enabled||!((y=(g=e.materialObject.userData)==null?void 0:g._triplanarMapping)!=null&&y.enable))return;const n=r.glsl`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;a.vertexShader=Yn(a.vertexShader,"#include <common>",n,{prepend:!0});const s=r.glsl`
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz;
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;a.vertexShader=Yn(a.vertexShader,"#include <worldpos_vertex>",s,{append:!0});const l=r.glsl`
                ${"struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}"}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;a.fragmentShader=Yn(a.fragmentShader,"#include <common>",l,{prepend:!0});const c=r.glsl`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;a.fragmentShader=Yn(a.fragmentShader,"#include <bumpmap_pars_fragment>",c);let f=Yn(i.WdD.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");a.fragmentShader=Yn(a.fragmentShader,"#include <map_fragment>",f),f=Yn(i.WdD.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),a.fragmentShader=Yn(a.fragmentShader,"#include <roughnessmap_fragment>",f),f=Yn(i.WdD.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),a.fragmentShader=Yn(a.fragmentShader,"#include <metalnessmap_fragment>",f),f=Yn(i.WdD.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),a.fragmentShader=Yn(a.fragmentShader,"#include <normal_fragment_maps>",f),a.defines.USE_UV=""},onObjectRender:(a,e)=>{var s,l,c,f;const t=e.materialObject.userData;if(!((s=t==null?void 0:t._triplanarMapping)!=null&&s.enable))return;const n=a;n.isMesh&&n.geometry&&(this._uniforms.triplanarScale.value=(l=t._triplanarMapping)==null?void 0:l.scaleFactor,this._uniforms.triplanarBlend.value=(c=t._triplanarMapping)==null?void 0:c.blendFactor,this._uniforms.triplanarOffset.value=(f=t._triplanarMapping)==null?void 0:f.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._triplanarMapping)!=null&&t.enable?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>{var a;return[(a=this._viewer)==null?void 0:a.renderer]},getUiConfig:a=>{const e=this._viewer,t=this.addTriplanarMapping,n={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=a.materialObject.userData._triplanarMapping)==null?void 0:s.enable)||!1},set value(s){var l,c;s!==((l=a.materialObject.userData._triplanarMapping)==null?void 0:l.enable)&&(s?t(a)||e.alert("Cannot add Triplanar mapping."):a.materialObject.userData._triplanarMapping&&(a.materialObject.userData._triplanarMapping.enable=!1,a.materialObject.needsUpdate=!0),(c=n.uiRefresh)==null||c.call(n,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var s;return!((s=a.materialObject.userData._triplanarMapping)!=null&&s.enable)},property:[a.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var s;return!((s=a.materialObject.userData._triplanarMapping)!=null&&s.enable)},property:[a.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var s;return!((s=a.materialObject.userData._triplanarMapping)!=null&&s.enable)},property:[a.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var t,n,s,l,c;await super.onAdded(a);const e=a.getPlugin(ri);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(l=(s=e==null?void 0:e.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:l.extensions)==null||c.push(Bb)}async onRemove(a){var e,t,n,s;return(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(s=(n=a.getPlugin(ri))==null?void 0:n.importer)==null||s.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};zl.PluginType="TriplanarUVMappingPlugin",zl.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",Kf([En("Enabled",a=>({onChange:a.setDirty})),Pe()],zl.prototype,"enabled",void 0),zl=Kf([lt("Triplanar Mapping")],zl);class IE{constructor(e){this.parser=e,this.name=zl.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];t.userData||(t.userData={});const l=t.userData;return l._triplanarMapping||(l._triplanarMapping={}),l._triplanarMapping.enable=!0,l._triplanarMapping.scaleFactor===void 0&&(l._triplanarMapping.scaleFactor=1),l._triplanarMapping.blendFactor===void 0&&(l._triplanarMapping.blendFactor=1),l._triplanarMapping.offsetFactor===void 0&&(l._triplanarMapping.offsetFactor=0),t.userData._triplanarMapping=ui(s,t.userData._triplanarMapping,!1,{}),Promise.resolve()}}const Bb=a=>({writeMaterial:(e,t)=>{var s;if(!e.isMeshStandardMaterial||!((s=e.userData._triplanarMapping)!=null&&s.enable))return;t.extensions=t.extensions||{};const n=kn(e.userData._triplanarMapping,!1);t.extensions[zl.TRIPLANAR_GLTF_EXTENSION]=n,a.extensionsUsed[zl.TRIPLANAR_GLTF_EXTENSION]=!0}});var Ob=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Vl=class extends Ln{addClearcoatTint(a){return cv(a.materialObject)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new Nb(e))}constructor(){super(),this.enabled=!0,this.dependencies=[ri],this._defines={},this._uniforms={ccTintColor:{value:new $e},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&t.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(a,e,t)=>{var l;if(!(this.enabled&&((l=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&l.enableTint)&&e.materialObject.clearcoat>0))return;const n="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",s="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";a.fragmentShader.includes(s)&&a.fragmentShader.includes(n)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),a.fragmentShader=a.fragmentShader.replace(s,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),a.fragmentShader=a.fragmentShader.replace(n,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+n),a.defines.USE_UV=""},onObjectRender:(a,e)=>{var s;const t=(s=e.materialObject.userData)==null?void 0:s._clearcoatTint;if(!(t!=null&&t.enableTint))return;this._uniforms.ccTintColor.value.set(t.tintColor),this._uniforms.ccThickness.value=t.thickness,this._uniforms.ccIor.value=t.ior;const n=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==n&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._clearcoatTint)!=null&&t.enableTint?"1":"0")+(a.materialObject.clearcoat>0?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=a.materialObject.userData._clearcoatTint)==null?void 0:n.enableTint)||!1},set value(n){var s,l;n!==((s=a.materialObject.userData._clearcoatTint)==null?void 0:s.enableTint)&&(n?cv(a.materialObject)||e.alert("Cannot add clearcoat tint."):a.materialObject.userData._clearcoatTint&&(a.materialObject.userData._clearcoatTint.enableTint=!1,a.materialObject.needsUpdate=!0),(l=t.uiRefresh)==null||l.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var n;return!((n=a.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[a.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var n;return!((n=a.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[a.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var n;return!((n=a.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[a.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var t,n,s,l,c;await super.onAdded(a);const e=a.getPlugin(ri);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(l=(s=e==null?void 0:e.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:l.extensions)==null||c.push(kb)}async onRemove(a){var e,t,n,s;return(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(s=(n=a.getPlugin(ri))==null?void 0:n.importer)==null||s.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};function cv(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const t=e._clearcoatTint;return t.enableTint=!0,t.tintColor===void 0&&(t.tintColor=16777215),t.thickness===void 0&&(t.thickness=.1),t.ior===void 0&&(t.ior=1.5),a.isMaterial&&(a.needsUpdate=!0),!0}Vl.PluginType="ClearcoatTintPlugin",Vl.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",Ob([En("Enabled",a=>({onChange:a.setDirty})),Pe()],Vl.prototype,"enabled",void 0),Vl=Ob([lt("ClearcoatTint Materials")],Vl);class Nb{constructor(e){this.parser=e,this.name=Vl.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.userData||(t.userData={}),cv(t),ui(s,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const kb=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;t.extensions=t.extensions||{};const n=kn(e.userData._clearcoatTint,!1);t.extensions[Vl.CLEARCOAT_TINT_GLTF_EXTENSION]=n,a.extensionsUsed[Vl.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class uv{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:s,msg:l,transfer:c}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(l,c)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=n,this.workers[s].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class hv{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class cp{constructor(e,t,n,s){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const Fa=[171,75,84,88,32,50,48,187,13,10,26,10];function ay(a){return typeof TextDecoder<"u"?new TextDecoder().decode(a):Buffer.from(a).toString("utf8")}let ly,nh,dv;const pv={env:{emscripten_notify_memory_growth:function(a){dv=new Uint8Array(nh.exports.memory.buffer)}}};class PE{init(){return ly||(ly=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Ag).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,pv)).then(this._init):WebAssembly.instantiate(Buffer.from(Ag,"base64"),pv).then(this._init),ly)}_init(e){nh=e.instance,pv.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!nh)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,s=nh.exports.malloc(n);dv.set(e,s),t=t||Number(nh.exports.ZSTD_findDecompressedSize(s,n));const l=nh.exports.malloc(t),c=nh.exports.ZSTD_decompress(l,t,s,n),f=dv.slice(l,l+c);return nh.exports.free(s),nh.exports.free(l),f}}const Ag="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",bg=new WeakMap;let cy,uy=0;class Eu extends i.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new uv,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new i.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new i.hH6(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const s=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([l,c])=>{const f=Eu.BasisWorker,g=["/* constants */","let _EngineFormat = "+JSON.stringify(Eu.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Eu.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Eu.BasisFormat),"/* basis_transcoder.js */",l,"/* worker */",f.substring(f.indexOf("{")+1,f.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([g])),this.transcoderBinary=c,this.workerPool.setWorkerCreator(()=>{const y=new Worker(this.workerSourceURL),x=this.transcoderBinary.slice(0);return y.postMessage({type:"init",config:this.workerConfig,transcoderBinary:x},[x]),y})}),uy>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),uy++}return this.transcoderPending}load(e,t,n,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const l=new i.hH6(this.manager);l.setResponseType("arraybuffer"),l.setWithCredentials(this.withCredentials),l.load(e,c=>{if(bg.has(c))return bg.get(c).promise.then(t).catch(s);this.createTexture(c).then(f=>t?t(f):null).catch(s)},n,s)}_createTextureFrom(e,t){const{mipmaps:n,width:s,height:l,format:c,type:f,error:g,dfdTransferFn:y,dfdFlags:x}=e;if(f==="error")return Promise.reject(g);const S=t.layerCount>1?new i.Z_g(n,s,l,t.layerCount,c,i.ywz):new i.EB7(n,s,l,c,i.ywz);return S.minFilter=n.length===1?i.wem:i.D1R,S.magFilter=i.wem,S.generateMipmaps=!1,S.needsUpdate=!0,S.colorSpace=y===2?i.KI_:i.aCh,S.premultiplyAlpha=!!(1&x),S}async createTexture(e,t={}){const n=function(c){const f=new Uint8Array(c.buffer,c.byteOffset,Fa.length);if(f[0]!==Fa[0]||f[1]!==Fa[1]||f[2]!==Fa[2]||f[3]!==Fa[3]||f[4]!==Fa[4]||f[5]!==Fa[5]||f[6]!==Fa[6]||f[7]!==Fa[7]||f[8]!==Fa[8]||f[9]!==Fa[9]||f[10]!==Fa[10]||f[11]!==Fa[11])throw new Error("Missing KTX 2.0 identifier.");const g=new hv,y=17*Uint32Array.BYTES_PER_ELEMENT,x=new cp(c,Fa.length,y,!0);g.vkFormat=x._nextUint32(),g.typeSize=x._nextUint32(),g.pixelWidth=x._nextUint32(),g.pixelHeight=x._nextUint32(),g.pixelDepth=x._nextUint32(),g.layerCount=x._nextUint32(),g.faceCount=x._nextUint32();const S=x._nextUint32();g.supercompressionScheme=x._nextUint32();const C=x._nextUint32(),L=x._nextUint32(),B=x._nextUint32(),W=x._nextUint32(),q=x._nextUint64(),Z=x._nextUint64(),j=new cp(c,Fa.length+y,3*S*8,!0);for(let Gn=0;Gn<S;Gn++)g.levels.push({levelData:new Uint8Array(c.buffer,c.byteOffset+j._nextUint64(),j._nextUint64()),uncompressedByteLength:j._nextUint64()});const F=new cp(c,C,L,!0),se={vendorId:F._skip(4)._nextUint16(),descriptorType:F._nextUint16(),versionNumber:F._nextUint16(),descriptorBlockSize:F._nextUint16(),colorModel:F._nextUint8(),colorPrimaries:F._nextUint8(),transferFunction:F._nextUint8(),flags:F._nextUint8(),texelBlockDimension:[F._nextUint8(),F._nextUint8(),F._nextUint8(),F._nextUint8()],bytesPlane:[F._nextUint8(),F._nextUint8(),F._nextUint8(),F._nextUint8(),F._nextUint8(),F._nextUint8(),F._nextUint8(),F._nextUint8()],samples:[]},pe=(se.descriptorBlockSize/4-6)/4;for(let Gn=0;Gn<pe;Gn++){const Fn={bitOffset:F._nextUint16(),bitLength:F._nextUint8(),channelType:F._nextUint8(),samplePosition:[F._nextUint8(),F._nextUint8(),F._nextUint8(),F._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Fn.channelType?(Fn.sampleLower=F._nextInt32(),Fn.sampleUpper=F._nextInt32()):(Fn.sampleLower=F._nextUint32(),Fn.sampleUpper=F._nextUint32()),se.samples[Gn]=Fn}g.dataFormatDescriptor.length=0,g.dataFormatDescriptor.push(se);const be=new cp(c,B,W,!0);for(;be._offset<W;){const Gn=be._nextUint32(),Fn=be._scan(Gn),di=ay(Fn),bi=be._scan(Gn-Fn.byteLength);g.keyValue[di]=di.match(/^ktx/i)?ay(bi):bi,be._offset%4&&be._skip(4-be._offset%4)}if(Z<=0)return g;const Se=new cp(c,q,Z,!0),Be=Se._nextUint16(),Ge=Se._nextUint16(),Xe=Se._nextUint32(),Qe=Se._nextUint32(),at=Se._nextUint32(),Ke=Se._nextUint32(),Je=[];for(let Gn=0;Gn<S;Gn++)Je.push({imageFlags:Se._nextUint32(),rgbSliceByteOffset:Se._nextUint32(),rgbSliceByteLength:Se._nextUint32(),alphaSliceByteOffset:Se._nextUint32(),alphaSliceByteLength:Se._nextUint32()});const ft=q+Se._offset,mt=ft+Xe,vt=mt+Qe,Qt=vt+at,Ht=new Uint8Array(c.buffer,c.byteOffset+ft,Xe),Cn=new Uint8Array(c.buffer,c.byteOffset+mt,Qe),un=new Uint8Array(c.buffer,c.byteOffset+vt,at),rn=new Uint8Array(c.buffer,c.byteOffset+Qt,Ke);return g.globalData={endpointCount:Be,selectorCount:Ge,imageDescs:Je,endpointsData:Ht,selectorsData:Cn,tablesData:un,extendedData:rn},g}(new Uint8Array(e));if(n.vkFormat!==0)return async function(c){const{vkFormat:f,pixelWidth:g,pixelHeight:y,pixelDepth:x}=c;if(hy[f]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const S=c.levels[0];let C,L;if(c.supercompressionScheme===0)C=S.levelData;else{if(c.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");cy||(cy=new Promise(async W=>{const q=new PE;await q.init(),W(q)})),C=(await cy).decode(S.levelData,S.uncompressedByteLength)}L=fv[f]===i.VzW?new Float32Array(C.buffer,C.byteOffset,C.byteLength/Float32Array.BYTES_PER_ELEMENT):fv[f]===i.cLu?new Uint16Array(C.buffer,C.byteOffset,C.byteLength/Uint16Array.BYTES_PER_ELEMENT):C;const B=x===0?new i.IEO(L,g,y):new i.JUT(L,g,y,x);return B.type=fv[f],B.format=hy[f],B.colorSpace=up[f]||i.aCh,B.needsUpdate=!0,Promise.resolve(B)}(n);const s=t,l=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:s},[e])).then(c=>this._createTextureFrom(c.data,n));return bg.set(e,{promise:l}),l}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),uy--,this}}Eu.BasisFormat={ETC1S:0,UASTC_4x4:1},Eu.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Eu.EngineFormat={RGBAFormat:i.wk1,RGBA_ASTC_4x4_Format:i.ptH,RGBA_BPTC_Format:i.bsb,RGBA_ETC2_EAC_Format:i.ekQ,RGBA_PVRTC_4BPPV1_Format:i.eaV,RGBA_S3TC_DXT5_Format:i.ILR,RGB_ETC1_Format:i.fto,RGB_ETC2_Format:i.l0P,RGB_PVRTC_4BPPV1_Format:i._AM,RGB_S3TC_DXT1_Format:i.wuA},Eu.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );

						const buffers = [];

						for ( let i = 0; i < mipmaps.length; ++ i ) {

							buffers.push( mipmaps[ i ].data.buffer );

						}

						self.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layers = ktx2File.getLayers() || 1;
		const levels = ktx2File.getLevels();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdTransferFn = ktx2File.getDFDTransferFunc();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levels ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const mipmaps = [];

		for ( let mip = 0; mip < levels; mip ++ ) {

			const layerMips = [];

			let mipWidth, mipHeight;

			for ( let layer = 0; layer < layers; layer ++ ) {

				const levelInfo = ktx2File.getImageLevelInfo( mip, layer, 0 );
				mipWidth = levelInfo.origWidth < 4 ? levelInfo.origWidth : levelInfo.width;
				mipHeight = levelInfo.origHeight < 4 ? levelInfo.origHeight : levelInfo.height;
				const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
				const status = ktx2File.transcodeImage(
					dst,
					mip,
					layer,
					0,
					transcoderFormat,
					0,
					- 1,
					- 1,
				);

				if ( ! status ) {

					cleanup();
					throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

				}

				layerMips.push( dst );

			}

			mipmaps.push( { data: concat( layerMips ), width: mipWidth, height: mipHeight } );

		}

		cleanup();

		return { width, height, hasAlpha, mipmaps, format: engineFormat, dfdTransferFn, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const hy={109:i.wk1,97:i.wk1,37:i.wk1,43:i.wk1,103:i.av9,83:i.av9,16:i.av9,22:i.av9,100:i.hEm,76:i.hEm,15:i.hEm,9:i.hEm},fv={109:i.VzW,97:i.cLu,37:i.ywz,43:i.ywz,103:i.VzW,83:i.cLu,16:i.ywz,22:i.ywz,100:i.VzW,76:i.cLu,15:i.ywz,9:i.ywz},up={43:i.KI_,22:i.KI_,15:i.KI_},dy="KHR_texture_basisu";class hp extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[ri]}async onAdded(e){var t,n,s,l,c,f;this._importer||(this._importer=new Ms(class extends Eu{constructor(g){super(g),this.setTranscoderPath(hp.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderer.rendererObject)}async createTexture(g,y){const x=new Uint8Array(g.slice(0)),S=await super.createTexture(g,y);return S.source._sourceImgBuffer=x,S.userData.mimeType="image/ktx2",S.toJSON=C=>wr(S,C,S.name,"image/ktx2"),S.clone=()=>{throw new Error("ktx2 texture cloning not supported")},S}},["ktx2"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer),(f=(c=(l=(s=e.getManager())==null?void 0:s.exporter)==null?void 0:l.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||f.push(Ub)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}hp.PluginType="KTX2LoadPlugin",hp.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/";const Ub=a=>({writeTexture:(e,t)=>{if(e.userData.mimeType!=="image/ktx2")return;if(t.source!==void 0&&t.source!==null)return void console.warn("ktx2 export: source already set");const n=e.source._sourceImgBuffer||e.userData.__sourceBuffer;if(!n)return void console.warn("ktx2 export: no source buffer for ktx2");t.extensions=t.extensions||{};const s={},l=new Blob([n],{type:"image/ktx2"});s.source=a.processImageBlob(l,e),t.extensions[dy]=s,a.extensionsUsed[dy]=!0}});var dp=__webpackgi_require__(701),pp=__webpackgi_require__.n(dp),DE=__webpackgi_require__(236),fc=__webpackgi_require__.n(DE),LE=__webpackgi_require__(850),fp=__webpackgi_require__.n(LE),mp=__webpackgi_require__(182),gp=__webpackgi_require__.n(mp),BE=__webpackgi_require__(213),mc=__webpackgi_require__.n(BE),mv=__webpackgi_require__(44),xg={};mv.Z&&mv.Z.locals&&(xg.locals=mv.Z.locals);var gv,wg=0,_p={};_p.styleTagTransform=mc(),_p.setAttributes=fp(),_p.insert=function(a,e){(e.target||document.head).appendChild(a)},_p.domAPI=fc(),_p.insertStyleElement=gp(),xg.use=function(a){return _p.options=a||{},wg++||(gv=pp()(mv.Z,_p)),xg},xg.unuse=function(){wg>0&&!--wg&&(gv(),gv=null)};var py=xg;class Eg extends Ln{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(e){super(),this.enabled=!0,this.dependencies=[ri],this._mainDiv=(0,r.createDiv)({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=(0,r.createDiv)({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(e){var n,s,l,c,f,g,y,x;await super.onAdded(e),e.container.appendChild(this._mainDiv);const t=new Map;this._updateMainDiv(t),(s=(n=e.getManager())==null?void 0:n.importer)==null||s.addEventListener("importFile",S=>{S.state!=="done"?t.set(S.path,{state:S.state,progress:S.progress?100*S.progress:void 0}):t.delete(S.path),this._updateMainDiv(t)}),(c=(l=e.getManager())==null?void 0:l.exporter)==null||c.addEventListener("exportFile",S=>{S.state!=="done"?t.set(S.obj.name,{state:S.state,progress:S.progress?100*S.progress:void 0}):t.delete(S.obj.name),this._updateMainDiv(t)}),(f=e.getPluginByType("FileTransferPlugin"))==null||f.addEventListener("transferFile",S=>{S.state!=="done"?t.set(S.path,{state:S.state,progress:S.progress?100*S.progress:void 0}):t.delete(S.path),this._updateMainDiv(t)}),(g=e.getPluginByType("MaterialConfiguratorPlugin"))==null||g.addEventListener("progress",S=>{S.state!=="done"?t.set("MatpreviewGeneration",{state:S.state,progress:0}):t.delete("MatpreviewGeneration"),this._updateMainDiv(t)}),(y=e.getPluginByType("SwitchNodePlugin"))==null||y.addEventListener("progress",S=>{S.state!=="done"?t.set("SwitchNodeGeneration",{state:S.state,progress:0}):t.delete("SwitchNodeGeneration"),this._updateMainDiv(t)}),(x=e.getPluginByType("ThemePlugin"))==null||x.addEventListener("progress",S=>{S.state!=="done"?t.set("ThemeInit",{state:S.state,progress:0}):t.delete("ThemeInit"),this._updateMainDiv(t)})}}(function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)})([En("Enabled"),(0,r.onChange)(Eg.prototype._onEnabledChange),Pe()],Eg.prototype,"enabled",void 0);let vp=class extends Eg{constructor(a=!0){super("LoadingBar"),this.showText=a}_updateMainDiv(a){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e=1,t=1;a.forEach((n,s)=>{e+=n.progress??99,t+=100}),this._contentDiv.innerHTML=this.showText?(100*e/t).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*e/t).toFixed(0)+"%",a.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(a){py.use({target:a.container}),await super.onAdded(a)}};vp.PluginType="AssetManagerLoadingBarPlugin",vp=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c}([lt("Asset manager loading bar")],vp);var _v=__webpackgi_require__(798),ns={};_v.Z&&_v.Z.locals&&(ns.locals=_v.Z.locals);var fy,vv=0,yp={};yp.styleTagTransform=mc(),yp.setAttributes=fp(),yp.insert=function(a,e){(e.target||document.head).appendChild(a)},yp.domAPI=fc(),yp.insertStyleElement=gp(),ns.use=function(a){return yp.options=a||{},vv++||(fy=pp()(_v.Z,yp)),ns},ns.unuse=function(){vv>0&&!--vv&&(fy(),fy=null)};var OE=ns;let Su=class extends Eg{constructor(){super("Popup");const a=(0,r.createDiv)({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});a.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(a)}_updateMainDiv(a){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e="";a.forEach((t,n)=>{e+=`<span class="processState">${t.state}</span>: ${(n||"").split("/").pop()} ${t.progress?" - "+t.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=e,a.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(a){OE.use({target:a.container}),await super.onAdded(a)}};Su.PluginType="AssetManagerBasicPopupPlugin",Su=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c}([lt("Asset manager popup")],Su);class ih extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,t,n,s,l,c="postRender",f=!1){var g;this._generators.has(c)||this._generators.set(c,[]),(g=this._generators.get(c))==null||g.push({key:e,fn:t,rect:n?[...n]:void 0,frag:l||s||f?new i.jyz({vertexShader:m.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:l??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${f?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${f?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${s??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,t="postRender"){var n;this._generators.set(t,((n=this._generators.get(t))==null?void 0:n.filter(s=>s.key!==e))??[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var s;const t=this._viewer,n=t==null?void 0:t.renderer;n&&t&&((s=this._generators.get(e))==null||s.forEach(({key:l,fn:c,rect:f,frag:g})=>{const y=c(t);if(y){if(y.image&&f){const x=y.image.width/y.image.height;f[2]<1&&f[3]<1&&(f[2]=200),f[2]<1&&(f[2]=f[3]*x),f[3]<1&&(f[3]=f[2]/x)}n.blit(y,void 0,{viewport:f,clear:!1,material:g})}}))}}ih.PluginType="debug";class Fb extends i.aNw{constructor(e){super(e)}load(e,t,n,s){const l=this,c=this.path===""?i.Zp0.extractUrlBase(e):this.path,f=new i.hH6(this.manager);f.setPath(this.path),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(e,function(g){try{t(l.parse(g,c))}catch(y){s?s(y):console.error(y),l.manager.itemError(e)}},n,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let s={};const l=/\s+/,c={};for(let g=0;g<n.length;g++){let y=n[g];if(y=y.trim(),y.length===0||y.charAt(0)==="#")continue;const x=y.indexOf(" ");let S=x>=0?y.substring(0,x):y;S=S.toLowerCase();let C=x>=0?y.substring(x+1):"";if(C=C.trim(),S==="newmtl")s={name:C},c[C]=s;else if(S==="ka"||S==="kd"||S==="ks"||S==="ke"){const L=C.split(l,3);s[S]=[parseFloat(L[0]),parseFloat(L[1]),parseFloat(L[2])]}else s[S]=C}const f=new NE(this.resourcePath||t,this.materialOptions);return f.setCrossOrigin(this.crossOrigin),f.setManager(this.manager),f.setMaterials(c),f}}class NE{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:i.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:i.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const s=e[n],l={};t[n]=l;for(const c in s){let f=!0,g=s[c];const y=c.toLowerCase();switch(y){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(g=[g[0]/255,g[1]/255,g[2]/255]),this.options&&this.options.ignoreZeroRGBs&&g[0]===0&&g[1]===0&&g[2]===0&&(f=!1)}f&&(l[y]=g)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,n=this.materialsInfo[e],s={name:e,side:this.side};async function l(g,y){if(s[g])return;const x=t.getTextureParams(y,s);return new Promise((S,C)=>{let L=!1,B=()=>!L&&(L=!0)&&S();const W=t.loadTexture((q=t.baseUrl,typeof(Z=x.url)!="string"||Z===""?"":/^https?:\/\//i.test(Z)?Z:q+Z),void 0,j=>{s[g]=j,B()},void 0,B);var q,Z;setTimeout(B,50),W.repeat.copy(x.scale),W.offset.copy(x.offset),W.wrapS=t.wrap,W.wrapT=t.wrap,g!=="map"&&g!=="emissiveMap"||(W.colorSpace=i.KI_)})}const c=Array.from(Object.keys(n||{}));let f=c.includes("d")||c.includes("D");for(const g of c){const y=n[g];let x;if(y!=="")switch(g.toLowerCase()){case"kd":s.color=new i.Ilk().fromArray(y).convertSRGBToLinear();break;case"ks":s.specular=new i.Ilk().fromArray(y).convertSRGBToLinear();break;case"ke":s.emissive=new i.Ilk().fromArray(y).convertSRGBToLinear();break;case"map_kd":await l("map",y);break;case"map_ks":await l("specularMap",y);break;case"map_ke":await l("emissiveMap",y);break;case"norm":await l("normalMap",y);break;case"map_bump":case"bump":await l("bumpMap",y);break;case"map_d":await l("alphaMap",y),s.transparent=!0;break;case"ns":s.shininess=parseFloat(y);break;case"d":x=parseFloat(y),x<1&&(s.opacity=x,s.transparent=!0);break;case"tr":if(f)break;x=parseFloat(y),this.options&&this.options.invertTrProperty&&(x=1-x),x>0&&(s.opacity=1-x,s.transparent=!0)}}return this.materials[e]=new i.xoR(s),this.materials[e]}getTextureParams(e,t){const n={scale:new i.FM8(1,1),offset:new i.FM8(0,0)},s=e.split(/\s+/);let l;return l=s.indexOf("-bm"),l>=0&&(t.bumpScale=parseFloat(s[l+1]),s.splice(l,2)),l=s.indexOf("-s"),l>=0&&(n.scale.set(parseFloat(s[l+1]),parseFloat(s[l+2])),s.splice(l,4)),l=s.indexOf("-o"),l>=0&&(n.offset.set(parseFloat(s[l+1]),parseFloat(s[l+2])),s.splice(l,4)),n.url=s.join(" ").trim(),n}loadTexture(e,t,n,s,l){const c=this.manager!==void 0?this.manager:i.tEQ;let f=c.getHandler(e);f===null&&(f=new i.dpR(c)),f.setCrossOrigin&&f.setCrossOrigin(this.crossOrigin);const g=f.load(e,n,s,l);return t!==void 0&&(g.mapping=t),g}}const kE=/^[og]\s*(.+)?/,UE=/^mtllib /,zb=/^usemtl /,my=/^usemap /,Vb=/\s+/,jb=new i.Pa4,yv=new i.Pa4,Gb=new i.Pa4,gy=new i.Pa4,tl=new i.Pa4,Av=new i.Ilk;function Hb(){const a={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,l){const c=this._finalize(!1);c&&(c.inherited||c.groupCount<=0)&&this.materials.splice(c.index,1);const f={index:this.materials.length,name:s||"",mtllib:Array.isArray(l)&&l.length>0?l[l.length-1]:"",smooth:c!==void 0?c.smooth:this.smooth,groupStart:c!==void 0?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(g){const y={index:typeof g=="number"?g:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return y.clone=this.clone.bind(y),y}};return this.materials.push(f),f},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const l=this.currentMaterial();if(l&&l.groupEnd===-1&&(l.groupEnd=this.geometry.vertices.length/3,l.groupCount=l.groupEnd-l.groupStart,l.inherited=!1),s&&this.materials.length>1)for(let c=this.materials.length-1;c>=0;c--)this.materials[c].groupCount<=0&&this.materials.splice(c,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),l}},n&&n.name&&typeof n.clone=="function"){const s=n.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const s=this.vertices,l=this.object.geometry.vertices;l.push(s[e+0],s[e+1],s[e+2]),l.push(s[t+0],s[t+1],s[t+2]),l.push(s[n+0],s[n+1],s[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const s=this.normals,l=this.object.geometry.normals;l.push(s[e+0],s[e+1],s[e+2]),l.push(s[t+0],s[t+1],s[t+2]),l.push(s[n+0],s[n+1],s[n+2])},addFaceNormal:function(e,t,n){const s=this.vertices,l=this.object.geometry.normals;jb.fromArray(s,e),yv.fromArray(s,t),Gb.fromArray(s,n),tl.subVectors(Gb,yv),gy.subVectors(jb,yv),tl.cross(gy),tl.normalize(),l.push(tl.x,tl.y,tl.z),l.push(tl.x,tl.y,tl.z),l.push(tl.x,tl.y,tl.z)},addColor:function(e,t,n){const s=this.colors,l=this.object.geometry.colors;s[e]!==void 0&&l.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&l.push(s[t+0],s[t+1],s[t+2]),s[n]!==void 0&&l.push(s[n+0],s[n+1],s[n+2])},addUV:function(e,t,n){const s=this.uvs,l=this.object.geometry.uvs;l.push(s[e+0],s[e+1]),l.push(s[t+0],s[t+1]),l.push(s[n+0],s[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,s,l,c,f,g,y){const x=this.vertices.length;let S=this.parseVertexIndex(e,x),C=this.parseVertexIndex(t,x),L=this.parseVertexIndex(n,x);if(this.addVertex(S,C,L),this.addColor(S,C,L),f!==void 0&&f!==""){const B=this.normals.length;S=this.parseNormalIndex(f,B),C=this.parseNormalIndex(g,B),L=this.parseNormalIndex(y,B),this.addNormal(S,C,L)}else this.addFaceNormal(S,C,L);if(s!==void 0&&s!==""){const B=this.uvs.length;S=this.parseUVIndex(s,B),C=this.parseUVIndex(l,B),L=this.parseUVIndex(c,B),this.addUV(S,C,L),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,s=e.length;n<s;n++){const l=this.parseVertexIndex(e[n],t);this.addVertexPoint(l),this.addColor(l)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,s=this.uvs.length;for(let l=0,c=e.length;l<c;l++)this.addVertexLine(this.parseVertexIndex(e[l],n));for(let l=0,c=t.length;l<c;l++)this.addUVLine(this.parseUVIndex(t[l],s))}};return a.startObject("",!1),a}class Wb extends i.aNw{constructor(e){super(e),this.materials=null}load(e,t,n,s){const l=this,c=new i.hH6(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,async function(f){try{t(await l.parse(f))}catch(g){s?s(g):console.error(g),l.manager.itemError(e)}},n,s)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new Hb;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let s=[];for(let c=0,f=n.length;c<f;c++){const g=n[c].trimStart();if(g.length===0)continue;const y=g.charAt(0);if(y!=="#")if(y==="v"){const x=g.split(Vb);switch(x[0]){case"v":t.vertices.push(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])),x.length>=7?(Av.setRGB(parseFloat(x[4]),parseFloat(x[5]),parseFloat(x[6])).convertSRGBToLinear(),t.colors.push(Av.r,Av.g,Av.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3]));break;case"vt":t.uvs.push(parseFloat(x[1]),parseFloat(x[2]))}}else if(y==="f"){const x=g.slice(1).trim().split(Vb),S=[];for(let L=0,B=x.length;L<B;L++){const W=x[L];if(W.length>0){const q=W.split("/");S.push(q)}}const C=S[0];for(let L=1,B=S.length-1;L<B;L++){const W=S[L],q=S[L+1];t.addFace(C[0],W[0],q[0],C[1],W[1],q[1],C[2],W[2],q[2])}}else if(y==="l"){const x=g.substring(1).trim().split(" ");let S=[];const C=[];if(g.indexOf("/")===-1)S=x;else for(let L=0,B=x.length;L<B;L++){const W=x[L].split("/");W[0]!==""&&S.push(W[0]),W[1]!==""&&C.push(W[1])}t.addLineGeometry(S,C)}else if(y==="p"){const x=g.slice(1).trim().split(" ");t.addPointGeometry(x)}else if((s=kE.exec(g))!==null){const x=(" "+s[0].slice(1).trim()).slice(1);t.startObject(x)}else if(zb.test(g))t.object.startMaterial(g.substring(7).trim(),t.materialLibraries);else if(UE.test(g)){t.materialLibraries.push(g.substring(7).trim());const x=g.substring(7).trim(),S=this.manager.getHandler(x);if(S){const C=await S.loadAsync(x).catch(L=>{console.warn(L)});C&&this.setMaterials(C)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(my.test(g))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(y==="s"){if(s=g.split(" "),s.length>1){const S=s[1].trim().toLowerCase();t.object.smooth=S!=="0"&&S!=="off"}else t.object.smooth=!0;const x=t.object.currentMaterial();x&&(x.smooth=t.object.smooth)}else{if(g==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+g+'"')}}t.finalize();const l=new i.ZAu;if(l.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0))for(let c=0,f=t.objects.length;c<f;c++){const g=t.objects[c],y=g.geometry,x=g.materials,S=y.type==="Line",C=y.type==="Points";let L=!1;if(y.vertices.length===0)continue;const B=new i.u9r;B.setAttribute("position",new i.a$l(y.vertices,3)),y.normals.length>0&&B.setAttribute("normal",new i.a$l(y.normals,3)),y.colors.length>0&&(L=!0,B.setAttribute("color",new i.a$l(y.colors,3))),y.hasUVIndices===!0&&B.setAttribute("uv",new i.a$l(y.uvs,2));const W=[];for(let Z=0,j=x.length;Z<j;Z++){const F=x[Z],se=F.name+"_"+F.smooth+"_"+L;let pe=t.materials[se];if(this.materials!==null)if(pe=await this.materials.create(F.name),!S||!pe||pe instanceof i.nls){if(C&&pe&&!(pe instanceof i.UY4)){const be=new i.UY4({size:10,sizeAttenuation:!1});i.F5T.prototype.copy.call(be,pe),be.color.copy(pe.color),be.map=pe.map,pe=be}}else{const be=new i.nls;i.F5T.prototype.copy.call(be,pe),be.color.copy(pe.color),pe=be}pe===void 0&&(pe=S?new i.nls:C?new i.UY4({size:1,sizeAttenuation:!1}):new i.xoR,pe.name=F.name,pe.flatShading=!F.smooth,pe.vertexColors=L,t.materials[se]=pe),W.push(pe)}let q;if(W.length>1){for(let Z=0,j=x.length;Z<j;Z++){const F=x[Z];B.addGroup(F.groupStart,F.groupCount,Z)}q=S?new i.ejS(B,W):C?new i.woe(B,W):new i.Kj0(B,W)}else q=S?new i.ejS(B,W[0]):C?new i.woe(B,W[0]):new i.Kj0(B,W[0]);q.name=g.name,l.add(q)}else if(t.vertices.length>0){const c=new i.UY4({size:1,sizeAttenuation:!1}),f=new i.u9r;f.setAttribute("position",new i.a$l(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(f.setAttribute("color",new i.a$l(t.colors,3)),c.vertexColors=!0);const g=new i.woe(f,c);l.add(g)}return l}}class Xc extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[ri],this._importer1=new Ms(Wb,["obj"],!0),this._importer2=new Ms(Fb,["mtl"],!1)}async onAdded(e){var t,n,s,l;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer1),(l=(s=e.getManager())==null?void 0:s.importer)==null||l.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&(e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer1),1),e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer2),1))}}Xc.PluginType="ObjMtlLoadPlugin";var Sg=function(a){return URL.createObjectURL(new Blob([a],{type:"text/javascript"}))};try{URL.revokeObjectURL(Sg(""))}catch{Sg=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var _a=Uint8Array,nl=Uint16Array,$f=Uint32Array,bv=new _a([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xv=new _a([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wv=new _a([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vy=function(a,e){for(var t=new nl(31),n=0;n<31;++n)t[n]=e+=1<<a[n-1];var s=new $f(t[30]);for(n=1;n<30;++n)for(var l=t[n];l<t[n+1];++l)s[l]=l-t[n]<<5|n;return[t,s]},Qb=vy(bv,2),Xb=Qb[0],yy=Qb[1];Xb[28]=258,yy[258]=28;for(var Ay=vy(xv,0),Ev=Ay[0],by=Ay[1],xy=new nl(32768),Cs=0;Cs<32768;++Cs){var Rs=(43690&Cs)>>>1|(21845&Cs)<<1;Rs=(61680&(Rs=(52428&Rs)>>>2|(13107&Rs)<<2))>>>4|(3855&Rs)<<4,xy[Cs]=((65280&Rs)>>>8|(255&Rs)<<8)>>>1}var Tu=function(a,e,t){for(var n=a.length,s=0,l=new nl(e);s<n;++s)++l[a[s]-1];var c,f=new nl(e);for(s=0;s<e;++s)f[s]=f[s-1]+l[s-1]<<1;if(t){c=new nl(1<<e);var g=15-e;for(s=0;s<n;++s)if(a[s])for(var y=s<<4|a[s],x=e-a[s],S=f[a[s]-1]++<<x,C=S|(1<<x)-1;S<=C;++S)c[xy[S]>>>g]=y}else for(c=new nl(n),s=0;s<n;++s)a[s]&&(c[s]=xy[f[a[s]-1]++]>>>15-a[s]);return c},Is=new _a(288);for(Cs=0;Cs<144;++Cs)Is[Cs]=8;for(Cs=144;Cs<256;++Cs)Is[Cs]=9;for(Cs=256;Cs<280;++Cs)Is[Cs]=7;for(Cs=280;Cs<288;++Cs)Is[Cs]=8;var Xh=new _a(32);for(Cs=0;Cs<32;++Cs)Xh[Cs]=5;var FE=Tu(Is,9,0),zE=Tu(Is,9,1),VE=Tu(Xh,5,0),qb=Tu(Xh,5,1),Jf=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},jl=function(a,e,t){var n=e/8|0;return(a[n]|a[n+1]<<8)>>(7&e)&t},wy=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(7&e)},Ey=function(a){return(a/8|0)+(7&a&&1)},Yb=function(a,e,t){(e==null||e<0)&&(e=0),(t==null||t>a.length)&&(t=a.length);var n=new(a instanceof nl?nl:a instanceof $f?$f:_a)(t-e);return n.set(a.subarray(e,t)),n},jE=function(a,e,t){var n=a.length;if(!n||t&&!t.l&&n<5)return e||new _a(0);var s=!e||t,l=!t||t.i;t||(t={}),e||(e=new _a(3*n));var c=function(bi){var Bi=e.length;if(bi>Bi){var Br=new _a(Math.max(2*Bi,bi));Br.set(e),e=Br}},f=t.f||0,g=t.p||0,y=t.b||0,x=t.l,S=t.d,C=t.m,L=t.n,B=8*n;do{if(!x){t.f=f=jl(a,g,1);var W=jl(a,g+1,3);if(g+=3,!W){var q=a[(Qe=Ey(g)+4)-4]|a[Qe-3]<<8,Z=Qe+q;if(Z>n){if(l)throw"unexpected EOF";break}s&&c(y+q),e.set(a.subarray(Qe,Z),y),t.b=y+=q,t.p=g=8*Z;continue}if(W==1)x=zE,S=qb,C=9,L=5;else{if(W!=2)throw"invalid block type";var j=jl(a,g,31)+257,F=jl(a,g+10,15)+4,se=j+jl(a,g+5,31)+1;g+=14;for(var pe=new _a(se),be=new _a(19),Se=0;Se<F;++Se)be[wv[Se]]=jl(a,g+3*Se,7);g+=3*F;var Be=Jf(be),Ge=(1<<Be)-1,Xe=Tu(be,Be,1);for(Se=0;Se<se;){var Qe,at=Xe[jl(a,g,Ge)];if(g+=15&at,(Qe=at>>>4)<16)pe[Se++]=Qe;else{var Ke=0,Je=0;for(Qe==16?(Je=3+jl(a,g,3),g+=2,Ke=pe[Se-1]):Qe==17?(Je=3+jl(a,g,7),g+=3):Qe==18&&(Je=11+jl(a,g,127),g+=7);Je--;)pe[Se++]=Ke}}var ft=pe.subarray(0,j),mt=pe.subarray(j);C=Jf(ft),L=Jf(mt),x=Tu(ft,C,1),S=Tu(mt,L,1)}if(g>B){if(l)throw"unexpected EOF";break}}s&&c(y+131072);for(var vt=(1<<C)-1,Qt=(1<<L)-1,Ht=g;;Ht=g){var Cn=(Ke=x[wy(a,g)&vt])>>>4;if((g+=15&Ke)>B){if(l)throw"unexpected EOF";break}if(!Ke)throw"invalid length/literal";if(Cn<256)e[y++]=Cn;else{if(Cn==256){Ht=g,x=null;break}var un=Cn-254;if(Cn>264){var rn=bv[Se=Cn-257];un=jl(a,g,(1<<rn)-1)+Xb[Se],g+=rn}var Gn=S[wy(a,g)&Qt],Fn=Gn>>>4;if(!Gn)throw"invalid distance";if(g+=15&Gn,mt=Ev[Fn],Fn>3&&(rn=xv[Fn],mt+=wy(a,g)&(1<<rn)-1,g+=rn),g>B){if(l)throw"unexpected EOF";break}s&&c(y+131072);for(var di=y+un;y<di;y+=4)e[y]=e[y-mt],e[y+1]=e[y+1-mt],e[y+2]=e[y+2-mt],e[y+3]=e[y+3-mt];y=di}}t.l=x,t.p=Ht,t.b=y,x&&(f=1,t.m=C,t.d=S,t.n=L)}while(!f);return y==e.length?e:Yb(e,0,y)},rh=function(a,e,t){t<<=7&e;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8},Tg=function(a,e,t){t<<=7&e;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8,a[n+2]|=t>>>16},Sy=function(a,e){for(var t=[],n=0;n<a.length;++n)a[n]&&t.push({s:n,f:a[n]});var s=t.length,l=t.slice();if(!s)return[My,0];if(s==1){var c=new _a(t[0].s+1);return c[t[0].s]=1,[c,1]}t.sort(function(pe,be){return pe.f-be.f}),t.push({s:-1,f:25001});var f=t[0],g=t[1],y=0,x=1,S=2;for(t[0]={s:-1,f:f.f+g.f,l:f,r:g};x!=s-1;)f=t[t[y].f<t[S].f?y++:S++],g=t[y!=x&&t[y].f<t[S].f?y++:S++],t[x++]={s:-1,f:f.f+g.f,l:f,r:g};var C=l[0].s;for(n=1;n<s;++n)l[n].s>C&&(C=l[n].s);var L=new nl(C+1),B=Ty(t[x-1],L,0);if(B>e){n=0;var W=0,q=B-e,Z=1<<q;for(l.sort(function(pe,be){return L[be.s]-L[pe.s]||pe.f-be.f});n<s;++n){var j=l[n].s;if(!(L[j]>e))break;W+=Z-(1<<B-L[j]),L[j]=e}for(W>>>=q;W>0;){var F=l[n].s;L[F]<e?W-=1<<e-L[F]++-1:++n}for(;n>=0&&W;--n){var se=l[n].s;L[se]==e&&(--L[se],++W)}B=e}return[new _a(L),B]},Ty=function(a,e,t){return a.s==-1?Math.max(Ty(a.l,e,t+1),Ty(a.r,e,t+1)):e[a.s]=t},Kb=function(a){for(var e=a.length;e&&!a[--e];);for(var t=new nl(++e),n=0,s=a[0],l=1,c=function(g){t[n++]=g},f=1;f<=e;++f)if(a[f]==s&&f!=e)++l;else{if(!s&&l>2){for(;l>138;l-=138)c(32754);l>2&&(c(l>10?l-11<<5|28690:l-3<<5|12305),l=0)}else if(l>3){for(c(s),--l;l>6;l-=6)c(8304);l>2&&(c(l-3<<5|8208),l=0)}for(;l--;)c(s);l=1,s=a[f]}return[t.subarray(0,n),e]},Mg=function(a,e){for(var t=0,n=0;n<e.length;++n)t+=a[n]*e[n];return t},Sv=function(a,e,t){var n=t.length,s=Ey(e+2);a[s]=255&n,a[s+1]=n>>>8,a[s+2]=255^a[s],a[s+3]=255^a[s+1];for(var l=0;l<n;++l)a[s+l+4]=t[l];return 8*(s+4+n)},$b=function(a,e,t,n,s,l,c,f,g,y,x){rh(e,x++,t),++s[256];for(var S=Sy(s,15),C=S[0],L=S[1],B=Sy(l,15),W=B[0],q=B[1],Z=Kb(C),j=Z[0],F=Z[1],se=Kb(W),pe=se[0],be=se[1],Se=new nl(19),Be=0;Be<j.length;++Be)Se[31&j[Be]]++;for(Be=0;Be<pe.length;++Be)Se[31&pe[Be]]++;for(var Ge=Sy(Se,7),Xe=Ge[0],Qe=Ge[1],at=19;at>4&&!Xe[wv[at-1]];--at);var Ke,Je,ft,mt,vt=y+5<<3,Qt=Mg(s,Is)+Mg(l,Xh)+c,Ht=Mg(s,C)+Mg(l,W)+c+14+3*at+Mg(Se,Xe)+(2*Se[16]+3*Se[17]+7*Se[18]);if(vt<=Qt&&vt<=Ht)return Sv(e,x,a.subarray(g,g+y));if(rh(e,x,1+(Ht<Qt)),x+=2,Ht<Qt){Ke=Tu(C,L,0),Je=C,ft=Tu(W,q,0),mt=W;var Cn=Tu(Xe,Qe,0);for(rh(e,x,F-257),rh(e,x+5,be-1),rh(e,x+10,at-4),x+=14,Be=0;Be<at;++Be)rh(e,x+3*Be,Xe[wv[Be]]);x+=3*at;for(var un=[j,pe],rn=0;rn<2;++rn){var Gn=un[rn];for(Be=0;Be<Gn.length;++Be){var Fn=31&Gn[Be];rh(e,x,Cn[Fn]),x+=Xe[Fn],Fn>15&&(rh(e,x,Gn[Be]>>>5&127),x+=Gn[Be]>>>12)}}}else Ke=FE,Je=Is,ft=VE,mt=Xh;for(Be=0;Be<f;++Be)if(n[Be]>255){Fn=n[Be]>>>18&31,Tg(e,x,Ke[Fn+257]),x+=Je[Fn+257],Fn>7&&(rh(e,x,n[Be]>>>23&31),x+=bv[Fn]);var di=31&n[Be];Tg(e,x,ft[di]),x+=mt[di],di>3&&(Tg(e,x,n[Be]>>>5&8191),x+=xv[di])}else Tg(e,x,Ke[n[Be]]),x+=Je[n[Be]];return Tg(e,x,Ke[256]),x+Je[256]},GE=new $f([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),My=new _a(0),HE=function(){var a=1,e=0;return{p:function(t){for(var n=a,s=e,l=t.length,c=0;c!=l;){for(var f=Math.min(c+2655,l);c<f;++c)s+=n+=t[c];n=(65535&n)+15*(n>>16),s=(65535&s)+15*(s>>16)}a=n,e=s},d:function(){return(255&(a%=65521))<<24|a>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},WE=function(a,e,t,n,s){return function(l,c,f,g,y,x){var S=l.length,C=new _a(g+S+5*(1+Math.ceil(S/7e3))+y),L=C.subarray(g,C.length-y),B=0;if(!c||S<8)for(var W=0;W<=S;W+=65535){var q=W+65535;q<S?B=Sv(L,B,l.subarray(W,q)):(L[W]=x,B=Sv(L,B,l.subarray(W,S)))}else{for(var Z=GE[c-1],j=Z>>>13,F=8191&Z,se=(1<<f)-1,pe=new nl(32768),be=new nl(se+1),Se=Math.ceil(f/3),Be=2*Se,Ge=function(xr){return(l[xr]^l[xr+1]<<Se^l[xr+2]<<Be)&se},Xe=new $f(25e3),Qe=new nl(288),at=new nl(32),Ke=0,Je=0,ft=(W=0,0),mt=0,vt=0;W<S;++W){var Qt=Ge(W),Ht=32767&W,Cn=be[Qt];if(pe[Ht]=Cn,be[Qt]=Ht,mt<=W){var un=S-W;if((Ke>7e3||ft>24576)&&un>423){B=$b(l,L,0,Xe,Qe,at,Je,ft,vt,W-vt,B),ft=Ke=Je=0,vt=W;for(var rn=0;rn<286;++rn)Qe[rn]=0;for(rn=0;rn<30;++rn)at[rn]=0}var Gn=2,Fn=0,di=F,bi=Ht-Cn&32767;if(un>2&&Qt==Ge(W-bi))for(var Bi=Math.min(j,un)-1,Br=Math.min(32767,W),lr=Math.min(258,un);bi<=Br&&--di&&Ht!=Cn;){if(l[W+Gn]==l[W+Gn-bi]){for(var tr=0;tr<lr&&l[W+tr]==l[W+tr-bi];++tr);if(tr>Gn){if(Gn=tr,Fn=bi,tr>Bi)break;var vn=Math.min(bi,tr-2),zn=0;for(rn=0;rn<vn;++rn){var fi=W-bi+rn+32768&32767,br=fi-pe[fi]+32768&32767;br>zn&&(zn=br,Cn=fi)}}}bi+=(Ht=Cn)-(Cn=pe[Ht])+32768&32767}if(Fn){Xe[ft++]=268435456|yy[Gn]<<18|by[Fn];var Wr=31&yy[Gn],Rr=31&by[Fn];Je+=bv[Wr]+xv[Rr],++Qe[257+Wr],++at[Rr],mt=W+Gn,++Ke}else Xe[ft++]=l[W],++Qe[l[W]]}}B=$b(l,L,x,Xe,Qe,at,Je,ft,vt,W-vt,B),!x&&7&B&&(B=Sv(L,B+1,My))}return Yb(C,0,g+Ey(B)+y)}(a,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+e.mem,t,n,!s)},QE=function(a,e,t){for(;t;++e)a[e]=t,t>>>=8},XE=function(a,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;a[0]=120,a[1]=n<<6|(n?32-2*n:1)},qE=function(a){if((15&a[0])!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(32&a[1])throw"invalid zlib data: preset dictionaries not supported"};function Cg(a,e){return jE((qE(a),a.subarray(2,-4)),e)}var YE=typeof TextDecoder<"u"&&new TextDecoder;try{YE.decode(My,{stream:!0})}catch{}function Jb(a,e,t){const n=t.length-a-1;if(e>=t[n])return n-1;if(e<=t[a])return a;let s=a,l=n,c=Math.floor((s+l)/2);for(;e<t[c]||e>=t[c+1];)e<t[c]?l=c:s=c,c=Math.floor((s+l)/2);return c}function I(a,e){let t=1;for(let s=2;s<=a;++s)t*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=a-e;++s)n*=s;return t/n}class o extends i.Hyl{constructor(e,t,n,s,l){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=l||this.knots.length-1;for(let c=0;c<n.length;++c){const f=n[c];this.controlPoints[c]=new i.Ltg(f.x,f.y,f.z,f.w)}}getPoint(e,t=new i.Pa4){const n=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),l=function(c,f,g,y){const x=Jb(c,y,f),S=function(L,B,W,q){const Z=[],j=[],F=[];Z[0]=1;for(let se=1;se<=W;++se){j[se]=B-q[L+1-se],F[se]=q[L+se]-B;let pe=0;for(let be=0;be<se;++be){const Se=F[be+1],Be=j[se-be],Ge=Z[be]/(Se+Be);Z[be]=pe+Se*Ge,pe=Be*Ge}Z[se]=pe}return Z}(x,y,c,f),C=new i.Ltg(0,0,0,0);for(let L=0;L<=c;++L){const B=g[x-c+L],W=S[L],q=B.w*W;C.x+=B.x*q,C.y+=B.y*q,C.z+=B.z*q,C.w+=B.w*W}return C}(this.degree,this.knots,this.controlPoints,s);return l.w!==1&&l.divideScalar(l.w),n.set(l.x,l.y,l.z)}getTangent(e,t=new i.Pa4){const n=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),l=function(c,f,g,y,x){const S=function(C,L,B,W,q){const Z=q<C?q:C,j=[],F=Jb(C,W,L),se=function(be,Se,Be,Ge,Xe){const Qe=[];for(let vt=0;vt<=Be;++vt)Qe[vt]=0;const at=[];for(let vt=0;vt<=Ge;++vt)at[vt]=Qe.slice(0);const Ke=[];for(let vt=0;vt<=Be;++vt)Ke[vt]=Qe.slice(0);Ke[0][0]=1;const Je=Qe.slice(0),ft=Qe.slice(0);for(let vt=1;vt<=Be;++vt){Je[vt]=Se-Xe[be+1-vt],ft[vt]=Xe[be+vt]-Se;let Qt=0;for(let Ht=0;Ht<vt;++Ht){const Cn=ft[Ht+1],un=Je[vt-Ht];Ke[vt][Ht]=Cn+un;const rn=Ke[Ht][vt-1]/Ke[vt][Ht];Ke[Ht][vt]=Qt+Cn*rn,Qt=un*rn}Ke[vt][vt]=Qt}for(let vt=0;vt<=Be;++vt)at[0][vt]=Ke[vt][Be];for(let vt=0;vt<=Be;++vt){let Qt=0,Ht=1;const Cn=[];for(let un=0;un<=Be;++un)Cn[un]=Qe.slice(0);Cn[0][0]=1;for(let un=1;un<=Ge;++un){let rn=0;const Gn=vt-un,Fn=Be-un;vt>=un&&(Cn[Ht][0]=Cn[Qt][0]/Ke[Fn+1][Gn],rn=Cn[Ht][0]*Ke[Gn][Fn]);const di=vt-1<=Fn?un-1:Be-vt;for(let Bi=Gn>=-1?1:-Gn;Bi<=di;++Bi)Cn[Ht][Bi]=(Cn[Qt][Bi]-Cn[Qt][Bi-1])/Ke[Fn+1][Gn+Bi],rn+=Cn[Ht][Bi]*Ke[Gn+Bi][Fn];vt<=Fn&&(Cn[Ht][un]=-Cn[Qt][un-1]/Ke[Fn+1][vt],rn+=Cn[Ht][un]*Ke[vt][Fn]),at[un][vt]=rn;const bi=Qt;Qt=Ht,Ht=bi}}let mt=Be;for(let vt=1;vt<=Ge;++vt){for(let Qt=0;Qt<=Be;++Qt)at[vt][Qt]*=mt;mt*=Be-vt}return at}(F,W,C,Z,L),pe=[];for(let be=0;be<B.length;++be){const Se=B[be].clone(),Be=Se.w;Se.x*=Be,Se.y*=Be,Se.z*=Be,pe[be]=Se}for(let be=0;be<=Z;++be){const Se=pe[F-C].clone().multiplyScalar(se[be][0]);for(let Be=1;Be<=C;++Be)Se.add(pe[F-C+Be].clone().multiplyScalar(se[be][Be]));j[be]=Se}for(let be=Z+1;be<=q+1;++be)j[be]=new i.Ltg(0,0,0);return j}(c,f,g,y,x);return function(C){const L=C.length,B=[],W=[];for(let Z=0;Z<L;++Z){const j=C[Z];B[Z]=new i.Pa4(j.x,j.y,j.z),W[Z]=j.w}const q=[];for(let Z=0;Z<L;++Z){const j=B[Z].clone();for(let F=1;F<=Z;++F)j.sub(q[Z-F].clone().multiplyScalar(I(Z,F)*W[F]));q[Z]=j.divideScalar(W[0])}return q}(S)}(this.degree,this.knots,this.controlPoints,s,1);return n.copy(l[1]).normalize(),n}}let d,v,b;class E extends i.aNw{constructor(e){super(e)}load(e,t,n,s){const l=this,c=l.path===""?i.Zp0.extractUrlBase(e):l.path,f=new i.hH6(this.manager);f.setPath(l.path),f.setResponseType("arraybuffer"),f.setRequestHeader(l.requestHeader),f.setWithCredentials(l.withCredentials),f.load(e,function(g){try{t(l.parse(g,c))}catch(y){s?s(y):console.error(y),l.manager.itemError(e)}},n,s)}parse(e,t){if(function(l){const c="Kaydara FBX Binary  \0";return l.byteLength>=c.length&&c===st(l,0,c.length)}(e))d=new te().parse(e);else{const l=st(e);if(!function(c){const f=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let g=0;function y(x){const S=c[x-1];return c=c.slice(g+x),g++,S}for(let x=0;x<f.length;++x)if(y(1)===f[x])return!1;return!0}(l))throw new Error("THREE.FBXLoader: Unknown format.");if(_e(l)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+_e(l));d=new G().parse(l)}const n=new i.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),s=new P(n,this.manager).parse(d);return d=null,v=null,b=null,s}}class P{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){v=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),s=this.parseDeformers(),l=new O().parse(s);return this.parseScene(s,l,n),b}parseConnections(){const e=new Map;return"Connections"in d&&d.Connections.connections.forEach(function(t){const n=t[0],s=t[1],l=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const c={ID:s,relationship:l};e.get(n).parents.push(c),e.has(s)||e.set(s,{parents:[],children:[]});const f={ID:n,relationship:l};e.get(s).children.push(f)}),e}parseImages(){const e={},t={};if("Video"in d.Objects){const n=d.Objects.Video;for(const s in n){const l=n[s];if(e[parseInt(s)]=l.RelativeFilename||l.Filename,"Content"in l){const c=l.Content instanceof ArrayBuffer&&l.Content.byteLength>0,f=typeof l.Content=="string"&&l.Content!=="";if(c||f){const g=this.parseImage(n[s]);t[l.RelativeFilename||l.Filename]=g}}}}for(const n in e){const s=e[n];t[s]!==void 0?e[n]=t[s]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let l;switch(s){case"bmp":l="image/bmp";break;case"jpg":case"jpeg":l="image/jpeg";break;case"png":l="image/png";break;case"tif":l="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),l="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+s+'" is not supported.')}if(typeof t=="string")return"data:"+l+";base64,"+t;{const c=new Uint8Array(t);return window.URL.createObjectURL(new Blob([c],{type:l}))}}parseTextures(e){const t=new Map;if("Texture"in d.Objects){const n=d.Objects.Texture;for(const s in n){const l=this.parseTexture(n[s],e);t.set(parseInt(s),l)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const s=e.WrapModeU,l=e.WrapModeV,c=s!==void 0?s.value:0,f=l!==void 0?l.value:0;if(n.wrapS=c===0?i.rpg:i.uWy,n.wrapT=f===0?i.rpg:i.uWy,"Scaling"in e){const g=e.Scaling.value;n.repeat.x=g[0],n.repeat.y=g[1]}if("Translation"in e){const g=e.Translation.value;n.offset.x=g[0],n.offset.y=g[1]}return n}loadTexture(e,t){let n;const s=this.textureLoader.path,l=v.get(e.id).children;let c;l!==void 0&&l.length>0&&t[l[0].ID]!==void 0&&(n=t[l[0].ID],n.indexOf("blob:")!==0&&n.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const f=e.FileName.slice(-3).toLowerCase();if(f==="tga"){const g=this.manager.getHandler(".tga");g===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),c=new i.xEZ):(g.setPath(this.textureLoader.path),c=g.load(n))}else f==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),c=new i.xEZ):c=this.textureLoader.load(n);return this.textureLoader.setPath(s),c}parseMaterials(e){const t=new Map;if("Material"in d.Objects){const n=d.Objects.Material;for(const s in n){const l=this.parseMaterial(n[s],e);l!==null&&t.set(parseInt(s),l)}}return t}parseMaterial(e,t){const n=e.id,s=e.attrName;let l=e.ShadingModel;if(typeof l=="object"&&(l=l.value),!v.has(n))return null;const c=this.parseParameters(e,t,n);let f;switch(l.toLowerCase()){case"phong":f=new i.xoR;break;case"lambert":f=new i.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',l),f=new i.xoR}return f.setValues(c),f.name=s,f}parseParameters(e,t,n){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new i.Ilk().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(s.color=new i.Ilk().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new i.Ilk().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(s.emissive=new i.Ilk().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new i.Ilk().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new i.Ilk().fromArray(e.SpecularColor.value).convertSRGBToLinear());const l=this;return v.get(n).children.forEach(function(c){const f=c.relationship;switch(f){case"Bump":s.bumpMap=l.getTexture(t,c.ID);break;case"Maya|TEX_ao_map":s.aoMap=l.getTexture(t,c.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=l.getTexture(t,c.ID),s.map!==void 0&&(s.map.colorSpace=i.KI_);break;case"DisplacementColor":s.displacementMap=l.getTexture(t,c.ID);break;case"EmissiveColor":s.emissiveMap=l.getTexture(t,c.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=i.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=l.getTexture(t,c.ID);break;case"ReflectionColor":s.envMap=l.getTexture(t,c.ID),s.envMap!==void 0&&(s.envMap.mapping=i.dSO,s.envMap.colorSpace=i.KI_);break;case"SpecularColor":s.specularMap=l.getTexture(t,c.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=i.KI_);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=l.getTexture(t,c.ID),s.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",f)}}),s}getTexture(e,t){return"LayeredTexture"in d.Objects&&t in d.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=v.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in d.Objects){const n=d.Objects.Deformer;for(const s in n){const l=n[s],c=v.get(parseInt(s));if(l.attrType==="Skin"){const f=this.parseSkeleton(c,n);f.ID=s,c.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),f.geometryID=c.parents[0].ID,e[s]=f}else if(l.attrType==="BlendShape"){const f={id:s};f.rawTargets=this.parseMorphTargets(c,n),f.id=s,c.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=f}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(s){const l=t[s.ID];if(l.attrType!=="Cluster")return;const c={ID:s.ID,indices:[],weights:[],transformLink:new i.yGw().fromArray(l.TransformLink.a)};"Indexes"in l&&(c.indices=l.Indexes.a,c.weights=l.Weights.a),n.push(c)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let s=0;s<e.children.length;s++){const l=e.children[s],c=t[l.ID],f={name:c.attrName,initialWeight:c.DeformPercent,id:c.id,fullWeights:c.FullWeights.a};if(c.attrType!=="BlendShapeChannel")return;f.geoID=v.get(parseInt(l.ID)).children.filter(function(g){return g.relationship===void 0})[0].ID,n.push(f)}return n}parseScene(e,t,n){b=new i.ZAu;const s=this.parseModels(e.skeletons,t,n),l=d.Objects.Model,c=this;s.forEach(function(g){const y=l[g.ID];c.setLookAtProperties(g,y),v.get(g.ID).parents.forEach(function(x){const S=s.get(x.ID);S!==void 0&&S.add(g)}),g.parent===null&&b.add(g)}),this.bindSkeleton(e.skeletons,t,s),this.createAmbientLight(),b.traverse(function(g){if(g.userData.transformData){g.parent&&(g.userData.transformData.parentMatrix=g.parent.matrix,g.userData.transformData.parentMatrixWorld=g.parent.matrixWorld);const y=ze(g.userData.transformData);g.applyMatrix4(y),g.updateWorldMatrix()}});const f=new Q().parse();b.children.length===1&&b.children[0].isGroup&&(b.children[0].animations=f,b=b.children[0]),b.animations=f}parseModels(e,t,n){const s=new Map,l=d.Objects.Model;for(const c in l){const f=parseInt(c),g=l[c],y=v.get(f);let x=this.buildSkeleton(y,e,f,g.attrName);if(!x){switch(g.attrType){case"Camera":x=this.createCamera(y);break;case"Light":x=this.createLight(y);break;case"Mesh":x=this.createMesh(y,t,n);break;case"NurbsCurve":x=this.createCurve(y,t);break;case"LimbNode":case"Root":x=new i.N$j;break;default:x=new i.ZAu}x.name=g.attrName?i.iUV.sanitizeNodeName(g.attrName):"",x.ID=f}this.getTransformData(x,g),s.set(f,x)}return s}buildSkeleton(e,t,n,s){let l=null;return e.parents.forEach(function(c){for(const f in t){const g=t[f];g.rawBones.forEach(function(y,x){if(y.ID===c.ID){const S=l;l=new i.N$j,l.matrixWorld.copy(y.transformLink),l.name=s?i.iUV.sanitizeNodeName(s):"",l.ID=n,g.bones[x]=l,S!==null&&l.add(S)}})}}),l}createCamera(e){let t,n;if(e.children.forEach(function(s){const l=d.Objects.NodeAttribute[s.ID];l!==void 0&&(n=l)}),n===void 0)t=new i.Tme;else{let s=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(s=1);let l=1;n.NearPlane!==void 0&&(l=n.NearPlane.value/1e3);let c=1e3;n.FarPlane!==void 0&&(c=n.FarPlane.value/1e3);let f=window.innerWidth,g=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(f=n.AspectWidth.value,g=n.AspectHeight.value);const y=f/g;let x=45;n.FieldOfView!==void 0&&(x=n.FieldOfView.value);const S=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:t=new i.cPb(x,y,l,c),S!==null&&t.setFocalLength(S);break;case 1:t=new i.iKG(-f/2,f/2,g/2,-g/2,l,c);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new i.Tme}}return t}createLight(e){let t,n;if(e.children.forEach(function(s){const l=d.Objects.NodeAttribute[s.ID];l!==void 0&&(n=l)}),n===void 0)t=new i.Tme;else{let s;s=n.LightType===void 0?0:n.LightType.value;let l=16777215;n.Color!==void 0&&(l=new i.Ilk().fromArray(n.Color.value).convertSRGBToLinear());let c=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(c=0);let f=0;n.FarAttenuationEnd!==void 0&&(f=n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?0:n.FarAttenuationEnd.value);const g=1;switch(s){case 0:t=new i.cek(l,c,f,g);break;case 1:t=new i.Ox3(l,c);break;case 2:let y=Math.PI/3;n.InnerAngle!==void 0&&(y=i.M8C.degToRad(n.InnerAngle.value));let x=0;n.OuterAngle!==void 0&&(x=i.M8C.degToRad(n.OuterAngle.value),x=Math.max(x,1)),t=new i.PMe(l,c,f,y,x,g);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new i.cek(l,c)}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let s,l=null,c=null;const f=[];return e.children.forEach(function(g){t.has(g.ID)&&(l=t.get(g.ID)),n.has(g.ID)&&f.push(n.get(g.ID))}),f.length>1?c=f:f.length>0?c=f[0]:(c=new i.xoR({color:13421772}),f.push(c)),"color"in l.attributes&&f.forEach(function(g){g.vertexColors=!0}),l.FBX_Deformer?(s=new i.TUv(l,c),s.normalizeSkinWeights()):s=new i.Kj0(l,c),s}createCurve(e,t){const n=e.children.reduce(function(l,c){return t.has(c.ID)&&(l=t.get(c.ID)),l},null),s=new i.nls({color:3342591,linewidth:1});return new i.x12(n,s)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?dt(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&v.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const s=d.Objects.Model[n.ID];if("Lcl_Translation"in s){const l=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(l),b.add(e.target)):e.lookAt(new i.Pa4().fromArray(l))}}})}bindSkeleton(e,t,n){const s=this.parsePoseNodes();for(const l in e){const c=e[l];v.get(parseInt(c.ID)).parents.forEach(function(f){if(t.has(f.ID)){const g=f.ID;v.get(g).parents.forEach(function(y){n.has(y.ID)&&n.get(y.ID).bind(new i.OdW(c.bones),s[y.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in d.Objects){const t=d.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const s=t[n].PoseNode;Array.isArray(s)?s.forEach(function(l){e[l.Node]=new i.yGw().fromArray(l.Matrix.a)}):e[s.Node]=new i.yGw().fromArray(s.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in d&&"AmbientColor"in d.GlobalSettings){const e=d.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],s=e[2];if(t!==0||n!==0||s!==0){const l=new i.Ilk(t,n,s).convertSRGBToLinear();b.add(new i.Mig(l,1))}}}}class O{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in d.Objects){const n=d.Objects.Geometry;for(const s in n){const l=v.get(parseInt(s)),c=this.parseGeometry(l,n[s],e);t.set(parseInt(s),c)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const s=n.skeletons,l=[],c=e.parents.map(function(S){return d.Objects.Model[S.ID]});if(c.length===0)return;const f=e.children.reduce(function(S,C){return s[C.ID]!==void 0&&(S=s[C.ID]),S},null);e.children.forEach(function(S){n.morphTargets[S.ID]!==void 0&&l.push(n.morphTargets[S.ID])});const g=c[0],y={};"RotationOrder"in g&&(y.eulerOrder=dt(g.RotationOrder.value)),"InheritType"in g&&(y.inheritType=parseInt(g.InheritType.value)),"GeometricTranslation"in g&&(y.translation=g.GeometricTranslation.value),"GeometricRotation"in g&&(y.rotation=g.GeometricRotation.value),"GeometricScaling"in g&&(y.scale=g.GeometricScaling.value);const x=ze(y);return this.genGeometry(t,f,l,x)}genGeometry(e,t,n,s){const l=new i.u9r;e.attrName&&(l.name=e.attrName);const c=this.parseGeoNode(e,t),f=this.genBuffers(c),g=new i.a$l(f.vertex,3);if(g.applyMatrix4(s),l.setAttribute("position",g),f.colors.length>0&&l.setAttribute("color",new i.a$l(f.colors,3)),t&&(l.setAttribute("skinIndex",new i.qlB(f.weightsIndices,4)),l.setAttribute("skinWeight",new i.a$l(f.vertexWeights,4)),l.FBX_Deformer=t),f.normal.length>0){const y=new i.Vkp().getNormalMatrix(s),x=new i.a$l(f.normal,3);x.applyNormalMatrix(y),l.setAttribute("normal",x)}if(f.uvs.forEach(function(y,x){const S=x===0?"uv":`uv${x}`;l.setAttribute(S,new i.a$l(f.uvs[x],2))}),c.material&&c.material.mappingType!=="AllSame"){let y=f.materialIndex[0],x=0;if(f.materialIndex.forEach(function(S,C){S!==y&&(l.addGroup(x,C-x,y),y=S,x=C)}),l.groups.length>0){const S=l.groups[l.groups.length-1],C=S.start+S.count;C!==f.materialIndex.length&&l.addGroup(C,f.materialIndex.length-C,y)}l.groups.length===0&&l.addGroup(0,f.materialIndex.length,f.materialIndex[0])}return this.addMorphTargets(l,e,n,s),l}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(s,l){s.indices.forEach(function(c,f){n.weightTable[c]===void 0&&(n.weightTable[c]=[]),n.weightTable[c].push({id:l,weight:s.weights[f]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,s=0,l=!1,c=[],f=[],g=[],y=[],x=[],S=[];const C=this;return e.vertexIndices.forEach(function(L,B){let W,q=!1;L<0&&(L^=-1,q=!0);let Z=[],j=[];if(c.push(3*L,3*L+1,3*L+2),e.color){const F=we(B,n,L,e.color);g.push(F[0],F[1],F[2])}if(e.skeleton){if(e.weightTable[L]!==void 0&&e.weightTable[L].forEach(function(F){j.push(F.weight),Z.push(F.id)}),j.length>4){l||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),l=!0);const F=[0,0,0,0],se=[0,0,0,0];j.forEach(function(pe,be){let Se=pe,Be=Z[be];se.forEach(function(Ge,Xe,Qe){if(Se>Ge){Qe[Xe]=Se,Se=Ge;const at=F[Xe];F[Xe]=Be,Be=at}})}),Z=F,j=se}for(;j.length<4;)j.push(0),Z.push(0);for(let F=0;F<4;++F)x.push(j[F]),S.push(Z[F])}if(e.normal){const F=we(B,n,L,e.normal);f.push(F[0],F[1],F[2])}e.material&&e.material.mappingType!=="AllSame"&&(W=we(B,n,L,e.material)[0],W<0&&(C.negativeMaterialIndices=!0,W=0)),e.uv&&e.uv.forEach(function(F,se){const pe=we(B,n,L,F);y[se]===void 0&&(y[se]=[]),y[se].push(pe[0]),y[se].push(pe[1])}),s++,q&&(s>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),C.genFace(t,e,c,W,f,g,y,x,S,s),n++,s=0,c=[],f=[],g=[],y=[],x=[],S=[])}),t}genFace(e,t,n,s,l,c,f,g,y,x){for(let S=2;S<x;S++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(S-1)]]),e.vertex.push(t.vertexPositions[n[3*(S-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(S-1)+2]]),e.vertex.push(t.vertexPositions[n[3*S]]),e.vertex.push(t.vertexPositions[n[3*S+1]]),e.vertex.push(t.vertexPositions[n[3*S+2]]),t.skeleton&&(e.vertexWeights.push(g[0]),e.vertexWeights.push(g[1]),e.vertexWeights.push(g[2]),e.vertexWeights.push(g[3]),e.vertexWeights.push(g[4*(S-1)]),e.vertexWeights.push(g[4*(S-1)+1]),e.vertexWeights.push(g[4*(S-1)+2]),e.vertexWeights.push(g[4*(S-1)+3]),e.vertexWeights.push(g[4*S]),e.vertexWeights.push(g[4*S+1]),e.vertexWeights.push(g[4*S+2]),e.vertexWeights.push(g[4*S+3]),e.weightsIndices.push(y[0]),e.weightsIndices.push(y[1]),e.weightsIndices.push(y[2]),e.weightsIndices.push(y[3]),e.weightsIndices.push(y[4*(S-1)]),e.weightsIndices.push(y[4*(S-1)+1]),e.weightsIndices.push(y[4*(S-1)+2]),e.weightsIndices.push(y[4*(S-1)+3]),e.weightsIndices.push(y[4*S]),e.weightsIndices.push(y[4*S+1]),e.weightsIndices.push(y[4*S+2]),e.weightsIndices.push(y[4*S+3])),t.color&&(e.colors.push(c[0]),e.colors.push(c[1]),e.colors.push(c[2]),e.colors.push(c[3*(S-1)]),e.colors.push(c[3*(S-1)+1]),e.colors.push(c[3*(S-1)+2]),e.colors.push(c[3*S]),e.colors.push(c[3*S+1]),e.colors.push(c[3*S+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(l[0]),e.normal.push(l[1]),e.normal.push(l[2]),e.normal.push(l[3*(S-1)]),e.normal.push(l[3*(S-1)+1]),e.normal.push(l[3*(S-1)+2]),e.normal.push(l[3*S]),e.normal.push(l[3*S+1]),e.normal.push(l[3*S+2])),t.uv&&t.uv.forEach(function(C,L){e.uvs[L]===void 0&&(e.uvs[L]=[]),e.uvs[L].push(f[L][0]),e.uvs[L].push(f[L][1]),e.uvs[L].push(f[L][2*(S-1)]),e.uvs[L].push(f[L][2*(S-1)+1]),e.uvs[L].push(f[L][2*S]),e.uvs[L].push(f[L][2*S+1])})}addMorphTargets(e,t,n,s){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const l=this;n.forEach(function(c){c.rawTargets.forEach(function(f){const g=d.Objects.Geometry[f.geoID];g!==void 0&&l.genMorphGeometry(e,t,g,s,f.name)})})}genMorphGeometry(e,t,n,s,l){const c=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],f=n.Vertices!==void 0?n.Vertices.a:[],g=n.Indexes!==void 0?n.Indexes.a:[],y=3*e.attributes.position.count,x=new Float32Array(y);for(let B=0;B<g.length;B++){const W=3*g[B];x[W]=f[3*B],x[W+1]=f[3*B+1],x[W+2]=f[3*B+2]}const S={vertexIndices:c,vertexPositions:x},C=this.genBuffers(S),L=new i.a$l(C.vertex,3);L.name=l||n.attrName,L.applyMatrix4(s),e.morphAttributes.position.push(L)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Normals.a;let l=[];return n==="IndexToDirect"&&("NormalIndex"in e?l=e.NormalIndex.a:"NormalsIndex"in e&&(l=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:l,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.UV.a;let l=[];return n==="IndexToDirect"&&(l=e.UVIndex.a),{dataSize:2,buffer:s,indices:l,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Colors.a;let l=[];n==="IndexToDirect"&&(l=e.ColorIndex.a);for(let c=0,f=new i.Ilk;c<s.length;c+=4)f.fromArray(s,c).convertSRGBToLinear().toArray(s,c);return{dataSize:4,buffer:s,indices:l,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const s=e.Materials.a,l=[];for(let c=0;c<s.length;++c)l.push(c);return{dataSize:1,buffer:s,indices:l,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new i.u9r;const n=t-1,s=e.KnotVector.a,l=[],c=e.Points.a;for(let x=0,S=c.length;x<S;x+=4)l.push(new i.Ltg().fromArray(c,x));let f,g;if(e.Form==="Closed")l.push(l[0]);else if(e.Form==="Periodic"){f=n,g=s.length-1-f;for(let x=0;x<n;++x)l.push(l[x])}const y=new o(n,s,l,f,g).getPoints(12*l.length);return new i.u9r().setFromPoints(y)}}class Q{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const s=t[n],l=this.addClip(s);e.push(l)}return e}parseClips(){if(d.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=d.Objects.AnimationCurveNode,t=new Map;for(const n in e){const s=e[n];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const l={id:s.id,attr:s.attrName,curves:{}};t.set(l.id,l)}}return t}parseAnimationCurves(e){const t=d.Objects.AnimationCurve;for(const n in t){const s={id:t[n].id,times:t[n].KeyTime.a.map(xe),values:t[n].KeyValueFloat.a},l=v.get(s.id);if(l!==void 0){const c=l.parents[0].ID,f=l.parents[0].relationship;f.match(/X/)?e.get(c).curves.x=s:f.match(/Y/)?e.get(c).curves.y=s:f.match(/Z/)?e.get(c).curves.z=s:f.match(/DeformPercent/)&&e.has(c)&&(e.get(c).curves.morph=s)}}}parseAnimationLayers(e){const t=d.Objects.AnimationLayer,n=new Map;for(const s in t){const l=[],c=v.get(parseInt(s));c!==void 0&&(c.children.forEach(function(f,g){if(e.has(f.ID)){const y=e.get(f.ID);if(y.curves.x!==void 0||y.curves.y!==void 0||y.curves.z!==void 0){if(l[g]===void 0){const x=v.get(f.ID).parents.filter(function(S){return S.relationship!==void 0})[0].ID;if(x!==void 0){const S=d.Objects.Model[x.toString()];if(S===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",f);const C={modelName:S.attrName?i.iUV.sanitizeNodeName(S.attrName):"",ID:S.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};b.traverse(function(L){L.ID===S.id&&(C.transform=L.matrix,L.userData.transformData&&(C.eulerOrder=L.userData.transformData.eulerOrder))}),C.transform||(C.transform=new i.yGw),"PreRotation"in S&&(C.preRotation=S.PreRotation.value),"PostRotation"in S&&(C.postRotation=S.PostRotation.value),l[g]=C}}l[g]&&(l[g][y.attr]=y)}else if(y.curves.morph!==void 0){if(l[g]===void 0){const x=v.get(f.ID).parents.filter(function(q){return q.relationship!==void 0})[0].ID,S=v.get(x).parents[0].ID,C=v.get(S).parents[0].ID,L=v.get(C).parents[0].ID,B=d.Objects.Model[L],W={modelName:B.attrName?i.iUV.sanitizeNodeName(B.attrName):"",morphName:d.Objects.Deformer[x].attrName};l[g]=W}l[g][y.attr]=y}}}),n.set(parseInt(s),l))}return n}parseAnimStacks(e){const t=d.Objects.AnimationStack,n={};for(const s in t){const l=v.get(parseInt(s)).children;l.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const c=e.get(l[0].ID);n[s]={name:t[s].attrName,layer:c}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(s){t=t.concat(n.generateTracks(s))}),new i.m7l(e.name,-1,t)}generateTracks(e){const t=[];let n=new i.Pa4,s=new i._fP,l=new i.Pa4;if(e.transform&&e.transform.decompose(n,s,l),n=n.toArray(),s=new i.USm().setFromQuaternion(s,e.eulerOrder).toArray(),l=l.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const c=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");c!==void 0&&t.push(c)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const c=this.generateRotationTrack(e.modelName,e.R.curves,s,e.preRotation,e.postRotation,e.eulerOrder);c!==void 0&&t.push(c)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const c=this.generateVectorTrack(e.modelName,e.S.curves,l,"scale");c!==void 0&&t.push(c)}if(e.DeformPercent!==void 0){const c=this.generateMorphTrack(e);c!==void 0&&t.push(c)}return t}generateVectorTrack(e,t,n,s){const l=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(l,t,n);return new i.yC1(e+"."+s,l,c)}generateRotationTrack(e,t,n,s,l,c){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(i.M8C.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(i.M8C.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(i.M8C.degToRad));const f=this.getTimesForAllAxes(t),g=this.getKeyframeTrackValues(f,t,n);s!==void 0&&((s=s.map(i.M8C.degToRad)).push(c),s=new i.USm().fromArray(s),s=new i._fP().setFromEuler(s)),l!==void 0&&((l=l.map(i.M8C.degToRad)).push(c),l=new i.USm().fromArray(l),l=new i._fP().setFromEuler(l).invert());const y=new i._fP,x=new i.USm,S=[];for(let C=0;C<g.length;C+=3)x.set(g[C],g[C+1],g[C+2],c),y.setFromEuler(x),s!==void 0&&y.premultiply(s),l!==void 0&&y.multiply(l),y.toArray(S,C/3*4);return new i.iLg(e+".quaternion",f,S)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(l){return l/100}),s=b.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new i.dUE(e.modelName+".morphTargetInfluences["+s+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,s){return n-s}),t.length>1){let n=1,s=t[0];for(let l=1;l<t.length;l++){const c=t[l];c!==s&&(t[n]=c,s=c,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const s=n,l=[];let c=-1,f=-1,g=-1;return e.forEach(function(y){if(t.x&&(c=t.x.times.indexOf(y)),t.y&&(f=t.y.times.indexOf(y)),t.z&&(g=t.z.times.indexOf(y)),c!==-1){const x=t.x.values[c];l.push(x),s[0]=x}else l.push(s[0]);if(f!==-1){const x=t.y.values[f];l.push(x),s[1]=x}else l.push(s[1]);if(g!==-1){const x=t.z.values[g];l.push(x),s[2]=x}else l.push(s[2])}),l}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],s=e.values[t]-n,l=Math.abs(s);if(l>=180){const c=l/180,f=s/c;let g=n+f;const y=e.times[t-1],x=(e.times[t]-y)/c;let S=y+x;const C=[],L=[];for(;S<e.times[t];)C.push(S),S+=x,L.push(g),g+=f;e.times=It(e.times,t,C),e.values=It(e.values,t,L)}}}}class G{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new fe,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(s,l){const c=s.match(/^[\s\t]*;/),f=s.match(/^[\s\t]*$/);if(c||f)return;const g=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),y=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),x=s.match("^\\t{"+(t.currentIndent-1)+"}}");g?t.parseNodeBegin(s,g):y?t.parseNodeProperty(s,y,n[++l]):x?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(g){return g.trim().replace(/^"/,"").replace(/"$/,"")}),l={name:n},c=this.parseNodeAttr(s),f=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,l):n in f?(n==="PoseNode"?f.PoseNode.push(l):f[n].id!==void 0&&(f[n]={},f[n][f[n].id]=f[n]),c.id!==""&&(f[n][c.id]=l)):typeof c.id=="number"?(f[n]={},f[n][c.id]=l):n!=="Properties70"&&(f[n]=n==="PoseNode"?[l]:l),typeof c.id=="number"&&(l.id=c.id),c.name!==""&&(l.attrName=c.name),c.type!==""&&(l.attrType=c.type),this.pushStack(l)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",s="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:n,type:s}}parseNodeProperty(e,t,n){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),l=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&l===","&&(l=n.replace(/"/g,"").replace(/,$/,"").trim());const c=this.getCurrentNode();if(c.name!=="Properties70"){if(s==="C"){const f=l.split(",").slice(1),g=parseInt(f[0]),y=parseInt(f[1]);let x=l.split(",").slice(3);x=x.map(function(S){return S.trim().replace(/^"/,"")}),s="connections",l=[g,y],function(S,C){for(let L=0,B=S.length,W=C.length;L<W;L++,B++)S[B]=C[L]}(l,x),c[s]===void 0&&(c[s]=[])}s==="Node"&&(c.id=l),s in c&&Array.isArray(c[s])?c[s].push(l):s!=="a"?c[s]=l:c.a=l,this.setCurrentProp(c,s),s==="a"&&l.slice(-1)!==","&&(c.a=rt(l))}else this.parseNodeSpecialProperty(e,s,l)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=rt(t.a))}parseNodeSpecialProperty(e,t,n){const s=n.split('",').map(function(x){return x.trim().replace(/^\"/,"").replace(/\s/,"_")}),l=s[0],c=s[1],f=s[2],g=s[3];let y=s[4];switch(c){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":y=parseFloat(y);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":y=rt(y)}this.getPrevNode()[l]={type:c,type2:f,flag:g,value:y},this.setCurrentProp(this.getPrevNode(),l)}}class te{parse(e){const t=new ge(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const s=new fe;for(;!this.endOfContent(t);){const l=this.parseNode(t,n);l!==null&&s.add(l.name,l)}return s}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},s=t>=7500?e.getUint64():e.getUint32(),l=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const c=e.getUint8(),f=e.getString(c);if(s===0)return null;const g=[];for(let C=0;C<l;C++)g.push(this.parseProperty(e));const y=g.length>0?g[0]:"",x=g.length>1?g[1]:"",S=g.length>2?g[2]:"";for(n.singleProperty=l===1&&e.getOffset()===s;s>e.getOffset();){const C=this.parseNode(e,t);C!==null&&this.parseSubNode(f,n,C)}return n.propertyList=g,typeof y=="number"&&(n.id=y),x!==""&&(n.attrName=x),S!==""&&(n.attrType=S),f!==""&&(n.name=f),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const s=n.propertyList[0];Array.isArray(s)?(t[n.name]=n,n.a=s):t[n.name]=s}else if(e==="Connections"&&n.name==="C"){const s=[];n.propertyList.forEach(function(l,c){c!==0&&s.push(l)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){t[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let s=n.propertyList[0],l=n.propertyList[1];const c=n.propertyList[2],f=n.propertyList[3];let g;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),l.indexOf("Lcl ")===0&&(l=l.replace("Lcl ","Lcl_")),g=l==="Color"||l==="ColorRGB"||l==="Vector"||l==="Vector3D"||l.indexOf("Lcl_")===0?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[s]={type:l,type2:c,flag:f,value:g}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),l=e.getUint32(),c=e.getUint32();if(l===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const f=Cg(new Uint8Array(e.getArrayBuffer(c))),g=new ge(f.buffer);switch(t){case"b":case"c":return g.getBooleanArray(s);case"d":return g.getFloat64Array(s);case"f":return g.getFloat32Array(s);case"i":return g.getInt32Array(s);case"l":return g.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class ge{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const s=n.indexOf(0);return s>=0&&(n=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(n)}}class fe{add(e,t){this[e]=t}}function _e(a){const e=a.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function xe(a){return a/46186158e3}const Re=[];function we(a,e,t,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=a;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(s=n.indices[s]);const l=s*n.dataSize,c=l+n.dataSize;return function(f,g,y,x){for(let S=y,C=0;S<x;S++,C++)f[C]=g[S];return f}(Re,n.buffer,l,c)}const Ce=new i.USm,De=new i.Pa4;function ze(a){const e=new i.yGw,t=new i.yGw,n=new i.yGw,s=new i.yGw,l=new i.yGw,c=new i.yGw,f=new i.yGw,g=new i.yGw,y=new i.yGw,x=new i.yGw,S=new i.yGw,C=new i.yGw,L=a.inheritType?a.inheritType:0;if(a.translation&&e.setPosition(De.fromArray(a.translation)),a.preRotation){const Xe=a.preRotation.map(i.M8C.degToRad);Xe.push(a.eulerOrder||i.USm.DEFAULT_ORDER),t.makeRotationFromEuler(Ce.fromArray(Xe))}if(a.rotation){const Xe=a.rotation.map(i.M8C.degToRad);Xe.push(a.eulerOrder||i.USm.DEFAULT_ORDER),n.makeRotationFromEuler(Ce.fromArray(Xe))}if(a.postRotation){const Xe=a.postRotation.map(i.M8C.degToRad);Xe.push(a.eulerOrder||i.USm.DEFAULT_ORDER),s.makeRotationFromEuler(Ce.fromArray(Xe)),s.invert()}a.scale&&l.scale(De.fromArray(a.scale)),a.scalingOffset&&f.setPosition(De.fromArray(a.scalingOffset)),a.scalingPivot&&c.setPosition(De.fromArray(a.scalingPivot)),a.rotationOffset&&g.setPosition(De.fromArray(a.rotationOffset)),a.rotationPivot&&y.setPosition(De.fromArray(a.rotationPivot)),a.parentMatrixWorld&&(S.copy(a.parentMatrix),x.copy(a.parentMatrixWorld));const B=t.clone().multiply(n).multiply(s),W=new i.yGw;W.extractRotation(x);const q=new i.yGw;q.copyPosition(x);const Z=q.clone().invert().multiply(x),j=W.clone().invert().multiply(Z),F=l,se=new i.yGw;if(L===0)se.copy(W).multiply(B).multiply(j).multiply(F);else if(L===1)se.copy(W).multiply(j).multiply(B).multiply(F);else{const Xe=new i.yGw().scale(new i.Pa4().setFromMatrixScale(S)).clone().invert(),Qe=j.clone().multiply(Xe);se.copy(W).multiply(B).multiply(Qe).multiply(F)}const pe=y.clone().invert(),be=c.clone().invert();let Se=e.clone().multiply(g).multiply(y).multiply(t).multiply(n).multiply(s).multiply(pe).multiply(f).multiply(c).multiply(l).multiply(be);const Be=new i.yGw().copyPosition(Se),Ge=x.clone().multiply(Be);return C.copyPosition(Ge),Se=C.clone().multiply(se),Se.premultiply(x.invert()),Se}function dt(a){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(a=a||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[a]}function rt(a){return a.split(",").map(function(e){return parseFloat(e)})}function st(a,e,t){return e===void 0&&(e=0),t===void 0&&(t=a.byteLength),new TextDecoder().decode(new Uint8Array(a,e,t))}function It(a,e,t){return a.slice(0,e).concat(t).concat(a.slice(e))}class Kt extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[ri],this._importer=new Ms(E,["fbx"],!0)}async onAdded(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var t,n,s,l;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&((l=(s=e.getManager())==null?void 0:s.importer)==null||l.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1))}}Kt.PluginType="FBXLoadPlugin";const Dt=new i.cPb(45,1,.1,1e3);function an(a,e,t,n=7,s=new i.Pa4(0,0,1.5)){t=t??a.scene.modelObject;const l=new V().expandByObject(t??e,!0,!0),c=l.getCenter(new i.Pa4),f=l.getSize(new i.Pa4);Dt.position.copy(c).add(s.clone().multiplyScalar(Math.max(f.x,f.y,f.z))),Dt.lookAt(c),e&&e.traverseVisible(x=>{x.layers.enable(n)}),n>0?Dt.layers.set(n):Dt.layers.enableAll();const g=e==null?void 0:e.visible;e&&(e.visible=!0),a.renderer.rendererObject.setRenderTarget(null),a.renderer.rendererObject.render(t,Dt);const y=a.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=g,e.traverseVisible(x=>{x.layers.disable(n)}),Dt.layers.enableAll()),a.setDirty(),y}class Ot{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new i.Kj0(new i.xo$(1)),cube:new i.Kj0(new i.DvJ(1,1,1)),cylinder:new i.Kj0(new i.fHI(.5,.5,1))};const t=new i.xsS;this._channel=7;const n=new i.vmT(16777215,4473924,1);n.position.set(0,10,0),n.layers.set(this._channel),t.add(n),this._lights.push(n),this._scene=t}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,t="sphere"){const n=this.shapes[t]||new i.Kj0(new i.xo$(1));n.material=e.materialObject,n.geometry.attributes.tangent||n.geometry.computeTangents(),this._scene.add(n),this._scene.environment=this.viewer.scene.getEnvironment();const s=n.material.envMapIntensity;typeof s=="number"&&(n.material.envMapIntensity=Math.max(s,2));const l=an(this.viewer,n,this._scene,this._channel,new i.Pa4(0,0,1.5));return typeof s=="number"&&(n.material.envMapIntensity=s),this._scene.remove(n),n.material=void 0,l}}class Mn extends Ln{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e))},this.dependencies=[ri],this.variations=[],this._selectedMaterial=()=>{var e,t;return((t=(e=this._picking)==null?void 0:e.getSelectedObject())==null?void 0:t.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(Ha).filter(t=>t.endsWith("Map"))].map(t=>({label:t,value:t}))},...((e=this.getSelectedVariation())==null?void 0:e.materials.map(t=>t.uiConfig?Object.assign(t.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(t.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(t)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(t=>this.applyVariation(t,t.materials[0].uuid))}}]}]}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),this._previewGenerator=new Ot(this._viewer),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)}async onRemove(e){var t,n;return(t=this._previewGenerator)==null||t.dispose(),this._previewGenerator=void 0,(n=this._picking)==null||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(t=>t.uuid===e):void 0}getSelectedVariation(){var e,t;return this.findVariation((e=this._selectedMaterial())==null?void 0:e.uuid)||this.findVariation((t=this._selectedMaterial())==null?void 0:t.name)}applyVariation(e,t){var l,c;const n=e.materials.find(f=>f.uuid===t),s=(c=(l=this._viewer)==null?void 0:l.getManager())==null?void 0:c.materials;return!!s&&!!n&&s.applyMaterial(n,e.uuid)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var n;const t=(n=e==null?void 0:e.clone)==null?void 0:n.call(e);if(e&&t){let s=this.findVariation(e.uuid);!s&&e.name.length>0&&(s=this.findVariation(e.name)),s||this.variations.push(s={uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),s.materials.push(t),this.refreshUi()}}}Mn.PluginType="MaterialConfiguratorBasePlugin",function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)}([Pe()],Mn.prototype,"variations",void 0);class Sn{static _initialize(){this._inited=!0,(0,r.createStyles)(r.css`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `)}static Create(e,t,n,s,l,c,f){var C;this._inited||this._initialize();const g=(0,r.mobileAndTabletCheck)(),y=g?.15:.25,x=g?1.5:2.5,S=(0,r.createDiv)({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${t} </div>
            `});S.style.top=l+"px",S.style.left=s+"px",S.style.gap=y+"rem",S.style.width=(x+y)*n-y+"rem",S.dataset.tag=e;for(const L of c){const B=(0,r.createDiv)({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${L.image}" class="customContextGridItemImage">
            `});B.style.width=x+"rem",B.style.height=x+"rem",S.appendChild(B),B.onclick=()=>{var W;return(W=L.onClick)==null?void 0:W.call(L,L.id)},f(B,L)}return(C=this.Elements)==null||C.push(S),S}static RemoveAll(e){if(e){const t=this.Elements.filter(n=>n.dataset.tag===e);for(const n of t)n.remove();this.Elements=this.Elements.filter(n=>n.dataset.tag!==e)}else{for(const t of this.Elements)t.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=(0,r.createDiv)({addToBody:!0,classList:["customContextGridParent"]}));for(const n of this.Elements)n.remove();let t=20;for(const n of this.Elements)n.style.top=t+"px",e.appendChild(n),t+=n.clientHeight+20}}function ti(a){if(a==null)return window;if(a.toString()!=="[object Window]"){var e=a.ownerDocument;return e&&e.defaultView||window}return a}function xi(a){return a instanceof ti(a).Element||a instanceof Element}function ni(a){return a instanceof ti(a).HTMLElement||a instanceof HTMLElement}function Kn(a){return typeof ShadowRoot<"u"&&(a instanceof ti(a).ShadowRoot||a instanceof ShadowRoot)}Sn.Elements=[],Sn._inited=!1;var gi=Math.max,Ai=Math.min,wn=Math.round;function qn(){var a=navigator.userAgentData;return a!=null&&a.brands?a.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function vi(){return!/^((?!chrome|android).)*safari/i.test(qn())}function ii(a,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=a.getBoundingClientRect(),s=1,l=1;e&&ni(a)&&(s=a.offsetWidth>0&&wn(n.width)/a.offsetWidth||1,l=a.offsetHeight>0&&wn(n.height)/a.offsetHeight||1);var c=(xi(a)?ti(a):window).visualViewport,f=!vi()&&t,g=(n.left+(f&&c?c.offsetLeft:0))/s,y=(n.top+(f&&c?c.offsetTop:0))/l,x=n.width/s,S=n.height/l;return{width:x,height:S,top:y,right:g+x,bottom:y+S,left:g,x:g,y}}function Si(a){var e=ti(a);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function rr(a){return a?(a.nodeName||"").toLowerCase():null}function Ct(a){return((xi(a)?a.ownerDocument:a.document)||window.document).documentElement}function ut(a){return ii(Ct(a)).left+Si(a).scrollLeft}function tn(a){return ti(a).getComputedStyle(a)}function Vt(a){var e=tn(a),t=e.overflow,n=e.overflowX,s=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+s+n)}function Rt(a,e,t){t===void 0&&(t=!1);var n,s,l=ni(e),c=ni(e)&&function(S){var C=S.getBoundingClientRect(),L=wn(C.width)/S.offsetWidth||1,B=wn(C.height)/S.offsetHeight||1;return L!==1||B!==1}(e),f=Ct(e),g=ii(a,c,t),y={scrollLeft:0,scrollTop:0},x={x:0,y:0};return(l||!l&&!t)&&((rr(e)!=="body"||Vt(f))&&(y=(n=e)!==ti(n)&&ni(n)?{scrollLeft:(s=n).scrollLeft,scrollTop:s.scrollTop}:Si(n)),ni(e)?((x=ii(e,!0)).x+=e.clientLeft,x.y+=e.clientTop):f&&(x.x=ut(f))),{x:g.left+y.scrollLeft-x.x,y:g.top+y.scrollTop-x.y,width:g.width,height:g.height}}function Jt(a){var e=ii(a),t=a.offsetWidth,n=a.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:a.offsetLeft,y:a.offsetTop,width:t,height:n}}function nt(a){return rr(a)==="html"?a:a.assignedSlot||a.parentNode||(Kn(a)?a.host:null)||Ct(a)}function Ft(a){return["html","body","#document"].indexOf(rr(a))>=0?a.ownerDocument.body:ni(a)&&Vt(a)?a:Ft(nt(a))}function kt(a,e){var t;e===void 0&&(e=[]);var n=Ft(a),s=n===((t=a.ownerDocument)==null?void 0:t.body),l=ti(n),c=s?[l].concat(l.visualViewport||[],Vt(n)?n:[]):n,f=e.concat(c);return s?f:f.concat(kt(nt(c)))}function Un(a){return["table","td","th"].indexOf(rr(a))>=0}function Nn(a){return ni(a)&&tn(a).position!=="fixed"?a.offsetParent:null}function Wn(a){for(var e=ti(a),t=Nn(a);t&&Un(t)&&tn(t).position==="static";)t=Nn(t);return t&&(rr(t)==="html"||rr(t)==="body"&&tn(t).position==="static")?e:t||function(n){var s=/firefox/i.test(qn());if(/Trident/i.test(qn())&&ni(n)&&tn(n).position==="fixed")return null;var l=nt(n);for(Kn(l)&&(l=l.host);ni(l)&&["html","body"].indexOf(rr(l))<0;){var c=tn(l);if(c.transform!=="none"||c.perspective!=="none"||c.contain==="paint"||["transform","perspective"].indexOf(c.willChange)!==-1||s&&c.willChange==="filter"||s&&c.filter&&c.filter!=="none")return l;l=l.parentNode}return null}(a)||e}var hi="top",Li="bottom",Fi="right",Ei="left",Ar="auto",mr=[hi,Li,Fi,Ei],Wi="start",cs="end",va="clippingParents",Lr="viewport",Zr="popper",hs="reference",Mu=mr.reduce(function(a,e){return a.concat([e+"-"+Wi,e+"-"+cs])},[]),Pn=[].concat(mr,[Ar]).reduce(function(a,e){return a.concat([e,e+"-"+Wi,e+"-"+cs])},[]),qh="beforeRead",Rg="read",za="afterRead",Ig="beforeMain",Zf="main",Cy="afterMain",Ry="beforeWrite",Tv="write",Iy="afterWrite",Py=[qh,Rg,za,Ig,Zf,Cy,Ry,Tv,Iy];function Ap(a){var e=new Map,t=new Set,n=[];function s(l){t.add(l.name),[].concat(l.requires||[],l.requiresIfExists||[]).forEach(function(c){if(!t.has(c)){var f=e.get(c);f&&s(f)}}),n.push(l)}return a.forEach(function(l){e.set(l.name,l)}),a.forEach(function(l){t.has(l.name)||s(l)}),n}var Dy={placement:"bottom",modifiers:[],strategy:"absolute"};function Ly(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function bp(a){a===void 0&&(a={});var e=a,t=e.defaultModifiers,n=t===void 0?[]:t,s=e.defaultOptions,l=s===void 0?Dy:s;return function(c,f,g){g===void 0&&(g=l);var y,x,S={placement:"bottom",orderedModifiers:[],options:Object.assign({},Dy,l),modifiersData:{},elements:{reference:c,popper:f},attributes:{},styles:{}},C=[],L=!1,B={state:S,setOptions:function(q){var Z=typeof q=="function"?q(S.options):q;W(),S.options=Object.assign({},l,S.options,Z),S.scrollParents={reference:xi(c)?kt(c):c.contextElement?kt(c.contextElement):[],popper:kt(f)};var j,F,se=function(pe){var be=Ap(pe);return Py.reduce(function(Se,Be){return Se.concat(be.filter(function(Ge){return Ge.phase===Be}))},[])}((j=[].concat(n,S.options.modifiers),F=j.reduce(function(pe,be){var Se=pe[be.name];return pe[be.name]=Se?Object.assign({},Se,be,{options:Object.assign({},Se.options,be.options),data:Object.assign({},Se.data,be.data)}):be,pe},{}),Object.keys(F).map(function(pe){return F[pe]})));return S.orderedModifiers=se.filter(function(pe){return pe.enabled}),S.orderedModifiers.forEach(function(pe){var be=pe.name,Se=pe.options,Be=Se===void 0?{}:Se,Ge=pe.effect;if(typeof Ge=="function"){var Xe=Ge({state:S,name:be,instance:B,options:Be});C.push(Xe||function(){})}}),B.update()},forceUpdate:function(){if(!L){var q=S.elements,Z=q.reference,j=q.popper;if(Ly(Z,j)){S.rects={reference:Rt(Z,Wn(j),S.options.strategy==="fixed"),popper:Jt(j)},S.reset=!1,S.placement=S.options.placement,S.orderedModifiers.forEach(function(Ge){return S.modifiersData[Ge.name]=Object.assign({},Ge.data)});for(var F=0;F<S.orderedModifiers.length;F++)if(S.reset!==!0){var se=S.orderedModifiers[F],pe=se.fn,be=se.options,Se=be===void 0?{}:be,Be=se.name;typeof pe=="function"&&(S=pe({state:S,options:Se,name:Be,instance:B})||S)}else S.reset=!1,F=-1}}},update:(y=function(){return new Promise(function(q){B.forceUpdate(),q(S)})},function(){return x||(x=new Promise(function(q){Promise.resolve().then(function(){x=void 0,q(y())})})),x}),destroy:function(){W(),L=!0}};if(!Ly(c,f))return B;function W(){C.forEach(function(q){return q()}),C=[]}return B.setOptions(g).then(function(q){!L&&g.onFirstUpdate&&g.onFirstUpdate(q)}),B}}var Zb=bp(),xp={passive:!0},Mv={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(a){var e=a.state,t=a.instance,n=a.options,s=n.scroll,l=s===void 0||s,c=n.resize,f=c===void 0||c,g=ti(e.elements.popper),y=[].concat(e.scrollParents.reference,e.scrollParents.popper);return l&&y.forEach(function(x){x.addEventListener("scroll",t.update,xp)}),f&&g.addEventListener("resize",t.update,xp),function(){l&&y.forEach(function(x){x.removeEventListener("scroll",t.update,xp)}),f&&g.removeEventListener("resize",t.update,xp)}},data:{}};function Tt(a){return a.split("-")[0]}function Rn(a){return a.split("-")[1]}function Qn(a){return["top","bottom"].indexOf(a)>=0?"x":"y"}function Xn(a){var e,t=a.reference,n=a.element,s=a.placement,l=s?Tt(s):null,c=s?Rn(s):null,f=t.x+t.width/2-n.width/2,g=t.y+t.height/2-n.height/2;switch(l){case hi:e={x:f,y:t.y-n.height};break;case Li:e={x:f,y:t.y+t.height};break;case Fi:e={x:t.x+t.width,y:g};break;case Ei:e={x:t.x-n.width,y:g};break;default:e={x:t.x,y:t.y}}var y=l?Qn(l):null;if(y!=null){var x=y==="y"?"height":"width";switch(c){case Wi:e[y]=e[y]-(t[x]/2-n[x]/2);break;case cs:e[y]=e[y]+(t[x]/2-n[x]/2)}}return e}var ci={name:"popperOffsets",enabled:!0,phase:"read",fn:function(a){var e=a.state,t=a.name;e.modifiersData[t]=Xn({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},Qi={top:"auto",right:"auto",bottom:"auto",left:"auto"};function os(a){var e,t=a.popper,n=a.popperRect,s=a.placement,l=a.variation,c=a.offsets,f=a.position,g=a.gpuAcceleration,y=a.adaptive,x=a.roundOffsets,S=a.isFixed,C=c.x,L=C===void 0?0:C,B=c.y,W=B===void 0?0:B,q=typeof x=="function"?x({x:L,y:W}):{x:L,y:W};L=q.x,W=q.y;var Z=c.hasOwnProperty("x"),j=c.hasOwnProperty("y"),F=Ei,se=hi,pe=window;if(y){var be=Wn(t),Se="clientHeight",Be="clientWidth";be===ti(t)&&tn(be=Ct(t)).position!=="static"&&f==="absolute"&&(Se="scrollHeight",Be="scrollWidth"),(s===hi||(s===Ei||s===Fi)&&l===cs)&&(se=Li,W-=(S&&be===pe&&pe.visualViewport?pe.visualViewport.height:be[Se])-n.height,W*=g?1:-1),s!==Ei&&(s!==hi&&s!==Li||l!==cs)||(F=Fi,L-=(S&&be===pe&&pe.visualViewport?pe.visualViewport.width:be[Be])-n.width,L*=g?1:-1)}var Ge,Xe=Object.assign({position:f},y&&Qi),Qe=x===!0?function(at){var Ke=at.x,Je=at.y,ft=window.devicePixelRatio||1;return{x:wn(Ke*ft)/ft||0,y:wn(Je*ft)/ft||0}}({x:L,y:W}):{x:L,y:W};return L=Qe.x,W=Qe.y,g?Object.assign({},Xe,((Ge={})[se]=j?"0":"",Ge[F]=Z?"0":"",Ge.transform=(pe.devicePixelRatio||1)<=1?"translate("+L+"px, "+W+"px)":"translate3d("+L+"px, "+W+"px, 0)",Ge)):Object.assign({},Xe,((e={})[se]=j?W+"px":"",e[F]=Z?L+"px":"",e.transform="",e))}var gr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(a){var e=a.state,t=a.options,n=t.gpuAcceleration,s=n===void 0||n,l=t.adaptive,c=l===void 0||l,f=t.roundOffsets,g=f===void 0||f,y={placement:Tt(e.placement),variation:Rn(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:s,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,os(Object.assign({},y,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:c,roundOffsets:g})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,os(Object.assign({},y,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:g})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},Qr={name:"applyStyles",enabled:!0,phase:"write",fn:function(a){var e=a.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},s=e.attributes[t]||{},l=e.elements[t];ni(l)&&rr(l)&&(Object.assign(l.style,n),Object.keys(s).forEach(function(c){var f=s[c];f===!1?l.removeAttribute(c):l.setAttribute(c,f===!0?"":f)}))})},effect:function(a){var e=a.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var s=e.elements[n],l=e.attributes[n]||{},c=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]).reduce(function(f,g){return f[g]="",f},{});ni(s)&&rr(s)&&(Object.assign(s.style,c),Object.keys(l).forEach(function(f){s.removeAttribute(f)}))})}},requires:["computeStyles"]},vs={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(a){var e=a.state,t=a.options,n=a.name,s=t.offset,l=s===void 0?[0,0]:s,c=Pn.reduce(function(x,S){return x[S]=function(C,L,B){var W=Tt(C),q=[Ei,hi].indexOf(W)>=0?-1:1,Z=typeof B=="function"?B(Object.assign({},L,{placement:C})):B,j=Z[0],F=Z[1];return j=j||0,F=(F||0)*q,[Ei,Fi].indexOf(W)>=0?{x:F,y:j}:{x:j,y:F}}(S,e.rects,l),x},{}),f=c[e.placement],g=f.x,y=f.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=g,e.modifiersData.popperOffsets.y+=y),e.modifiersData[n]=c}},is={left:"right",right:"left",bottom:"top",top:"bottom"};function $r(a){return a.replace(/left|right|bottom|top/g,function(e){return is[e]})}var Va={start:"end",end:"start"};function il(a){return a.replace(/start|end/g,function(e){return Va[e]})}function fo(a,e){var t=e.getRootNode&&e.getRootNode();if(a.contains(e))return!0;if(t&&Kn(t)){var n=e;do{if(n&&a.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Yh(a){return Object.assign({},a,{left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height})}function Xs(a,e,t){return e===Lr?Yh(function(n,s){var l=ti(n),c=Ct(n),f=l.visualViewport,g=c.clientWidth,y=c.clientHeight,x=0,S=0;if(f){g=f.width,y=f.height;var C=vi();(C||!C&&s==="fixed")&&(x=f.offsetLeft,S=f.offsetTop)}return{width:g,height:y,x:x+ut(n),y:S}}(a,t)):xi(e)?function(n,s){var l=ii(n,!1,s==="fixed");return l.top=l.top+n.clientTop,l.left=l.left+n.clientLeft,l.bottom=l.top+n.clientHeight,l.right=l.left+n.clientWidth,l.width=n.clientWidth,l.height=n.clientHeight,l.x=l.left,l.y=l.top,l}(e,t):Yh(function(n){var s,l=Ct(n),c=Si(n),f=(s=n.ownerDocument)==null?void 0:s.body,g=gi(l.scrollWidth,l.clientWidth,f?f.scrollWidth:0,f?f.clientWidth:0),y=gi(l.scrollHeight,l.clientHeight,f?f.scrollHeight:0,f?f.clientHeight:0),x=-c.scrollLeft+ut(n),S=-c.scrollTop;return tn(f||l).direction==="rtl"&&(x+=gi(l.clientWidth,f?f.clientWidth:0)-g),{width:g,height:y,x,y:S}}(Ct(a)))}function Ao(a){return Object.assign({},{top:0,right:0,bottom:0,left:0},a)}function Cu(a,e){return e.reduce(function(t,n){return t[n]=a,t},{})}function qs(a,e){e===void 0&&(e={});var t=e,n=t.placement,s=n===void 0?a.placement:n,l=t.strategy,c=l===void 0?a.strategy:l,f=t.boundary,g=f===void 0?va:f,y=t.rootBoundary,x=y===void 0?Lr:y,S=t.elementContext,C=S===void 0?Zr:S,L=t.altBoundary,B=L!==void 0&&L,W=t.padding,q=W===void 0?0:W,Z=Ao(typeof q!="number"?q:Cu(q,mr)),j=C===Zr?hs:Zr,F=a.rects.popper,se=a.elements[B?j:C],pe=function(Ke,Je,ft,mt){var vt=Je==="clippingParents"?function(un){var rn=kt(nt(un)),Gn=["absolute","fixed"].indexOf(tn(un).position)>=0&&ni(un)?Wn(un):un;return xi(Gn)?rn.filter(function(Fn){return xi(Fn)&&fo(Fn,Gn)&&rr(Fn)!=="body"}):[]}(Ke):[].concat(Je),Qt=[].concat(vt,[ft]),Ht=Qt[0],Cn=Qt.reduce(function(un,rn){var Gn=Xs(Ke,rn,mt);return un.top=gi(Gn.top,un.top),un.right=Ai(Gn.right,un.right),un.bottom=Ai(Gn.bottom,un.bottom),un.left=gi(Gn.left,un.left),un},Xs(Ke,Ht,mt));return Cn.width=Cn.right-Cn.left,Cn.height=Cn.bottom-Cn.top,Cn.x=Cn.left,Cn.y=Cn.top,Cn}(xi(se)?se:se.contextElement||Ct(a.elements.popper),g,x,c),be=ii(a.elements.reference),Se=Xn({reference:be,element:F,strategy:"absolute",placement:s}),Be=Yh(Object.assign({},F,Se)),Ge=C===Zr?Be:be,Xe={top:pe.top-Ge.top+Z.top,bottom:Ge.bottom-pe.bottom+Z.bottom,left:pe.left-Ge.left+Z.left,right:Ge.right-pe.right+Z.right},Qe=a.modifiersData.offset;if(C===Zr&&Qe){var at=Qe[s];Object.keys(Xe).forEach(function(Ke){var Je=[Fi,Li].indexOf(Ke)>=0?1:-1,ft=[hi,Li].indexOf(Ke)>=0?"y":"x";Xe[Ke]+=at[ft]*Je})}return Xe}var Tr={name:"flip",enabled:!0,phase:"main",fn:function(a){var e=a.state,t=a.options,n=a.name;if(!e.modifiersData[n]._skip){for(var s=t.mainAxis,l=s===void 0||s,c=t.altAxis,f=c===void 0||c,g=t.fallbackPlacements,y=t.padding,x=t.boundary,S=t.rootBoundary,C=t.altBoundary,L=t.flipVariations,B=L===void 0||L,W=t.allowedAutoPlacements,q=e.options.placement,Z=Tt(q),j=g||(Z!==q&&B?function(un){if(Tt(un)===Ar)return[];var rn=$r(un);return[il(un),rn,il(rn)]}(q):[$r(q)]),F=[q].concat(j).reduce(function(un,rn){return un.concat(Tt(rn)===Ar?function(Gn,Fn){Fn===void 0&&(Fn={});var di=Fn,bi=di.placement,Bi=di.boundary,Br=di.rootBoundary,lr=di.padding,tr=di.flipVariations,vn=di.allowedAutoPlacements,zn=vn===void 0?Pn:vn,fi=Rn(bi),br=fi?tr?Mu:Mu.filter(function(xr){return Rn(xr)===fi}):mr,Wr=br.filter(function(xr){return zn.indexOf(xr)>=0});Wr.length===0&&(Wr=br);var Rr=Wr.reduce(function(xr,vr){return xr[vr]=qs(Gn,{placement:vr,boundary:Bi,rootBoundary:Br,padding:lr})[Tt(vr)],xr},{});return Object.keys(Rr).sort(function(xr,vr){return Rr[xr]-Rr[vr]})}(e,{placement:rn,boundary:x,rootBoundary:S,padding:y,flipVariations:B,allowedAutoPlacements:W}):rn)},[]),se=e.rects.reference,pe=e.rects.popper,be=new Map,Se=!0,Be=F[0],Ge=0;Ge<F.length;Ge++){var Xe=F[Ge],Qe=Tt(Xe),at=Rn(Xe)===Wi,Ke=[hi,Li].indexOf(Qe)>=0,Je=Ke?"width":"height",ft=qs(e,{placement:Xe,boundary:x,rootBoundary:S,altBoundary:C,padding:y}),mt=Ke?at?Fi:Ei:at?Li:hi;se[Je]>pe[Je]&&(mt=$r(mt));var vt=$r(mt),Qt=[];if(l&&Qt.push(ft[Qe]<=0),f&&Qt.push(ft[mt]<=0,ft[vt]<=0),Qt.every(function(un){return un})){Be=Xe,Se=!1;break}be.set(Xe,Qt)}if(Se)for(var Ht=function(un){var rn=F.find(function(Gn){var Fn=be.get(Gn);if(Fn)return Fn.slice(0,un).every(function(di){return di})});if(rn)return Be=rn,"break"},Cn=B?3:1;Cn>0&&Ht(Cn)!=="break";Cn--);e.placement!==Be&&(e.modifiersData[n]._skip=!0,e.placement=Be,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Ys(a,e,t){return gi(a,Ai(e,t))}var Cv={name:"preventOverflow",enabled:!0,phase:"main",fn:function(a){var e=a.state,t=a.options,n=a.name,s=t.mainAxis,l=s===void 0||s,c=t.altAxis,f=c!==void 0&&c,g=t.boundary,y=t.rootBoundary,x=t.altBoundary,S=t.padding,C=t.tether,L=C===void 0||C,B=t.tetherOffset,W=B===void 0?0:B,q=qs(e,{boundary:g,rootBoundary:y,padding:S,altBoundary:x}),Z=Tt(e.placement),j=Rn(e.placement),F=!j,se=Qn(Z),pe=se==="x"?"y":"x",be=e.modifiersData.popperOffsets,Se=e.rects.reference,Be=e.rects.popper,Ge=typeof W=="function"?W(Object.assign({},e.rects,{placement:e.placement})):W,Xe=typeof Ge=="number"?{mainAxis:Ge,altAxis:Ge}:Object.assign({mainAxis:0,altAxis:0},Ge),Qe=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,at={x:0,y:0};if(be){if(l){var Ke,Je=se==="y"?hi:Ei,ft=se==="y"?Li:Fi,mt=se==="y"?"height":"width",vt=be[se],Qt=vt+q[Je],Ht=vt-q[ft],Cn=L?-Be[mt]/2:0,un=j===Wi?Se[mt]:Be[mt],rn=j===Wi?-Be[mt]:-Se[mt],Gn=e.elements.arrow,Fn=L&&Gn?Jt(Gn):{width:0,height:0},di=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},bi=di[Je],Bi=di[ft],Br=Ys(0,Se[mt],Fn[mt]),lr=F?Se[mt]/2-Cn-Br-bi-Xe.mainAxis:un-Br-bi-Xe.mainAxis,tr=F?-Se[mt]/2+Cn+Br+Bi+Xe.mainAxis:rn+Br+Bi+Xe.mainAxis,vn=e.elements.arrow&&Wn(e.elements.arrow),zn=vn?se==="y"?vn.clientTop||0:vn.clientLeft||0:0,fi=(Ke=Qe==null?void 0:Qe[se])!=null?Ke:0,br=vt+tr-fi,Wr=Ys(L?Ai(Qt,vt+lr-fi-zn):Qt,vt,L?gi(Ht,br):Ht);be[se]=Wr,at[se]=Wr-vt}if(f){var Rr,xr=se==="x"?hi:Ei,vr=se==="x"?Li:Fi,ji=be[pe],sn=pe==="y"?"height":"width",pi=ji+q[xr],Xi=ji-q[vr],$n=[hi,Ei].indexOf(Z)!==-1,pr=(Rr=Qe==null?void 0:Qe[pe])!=null?Rr:0,Gs=$n?pi:ji-Se[sn]-Be[sn]-pr+Xe.altAxis,oo=$n?ji+Se[sn]+Be[sn]-pr-Xe.altAxis:Xi,Lo=L&&$n?function(ja,ll,wa){var Mr=Ys(ja,ll,wa);return Mr>wa?wa:Mr}(Gs,ji,oo):Ys(L?Gs:pi,ji,L?oo:Xi);be[pe]=Lo,at[pe]=Lo-ji}e.modifiersData[n]=at}},requiresIfExists:["offset"]},ex={name:"arrow",enabled:!0,phase:"main",fn:function(a){var e,t=a.state,n=a.name,s=a.options,l=t.elements.arrow,c=t.modifiersData.popperOffsets,f=Tt(t.placement),g=Qn(f),y=[Ei,Fi].indexOf(f)>=0?"height":"width";if(l&&c){var x=function(Be,Ge){return Ao(typeof(Be=typeof Be=="function"?Be(Object.assign({},Ge.rects,{placement:Ge.placement})):Be)!="number"?Be:Cu(Be,mr))}(s.padding,t),S=Jt(l),C=g==="y"?hi:Ei,L=g==="y"?Li:Fi,B=t.rects.reference[y]+t.rects.reference[g]-c[g]-t.rects.popper[y],W=c[g]-t.rects.reference[g],q=Wn(l),Z=q?g==="y"?q.clientHeight||0:q.clientWidth||0:0,j=B/2-W/2,F=x[C],se=Z-S[y]-x[L],pe=Z/2-S[y]/2+j,be=Ys(F,pe,se),Se=g;t.modifiersData[n]=((e={})[Se]=be,e.centerOffset=be-pe,e)}},effect:function(a){var e=a.state,t=a.options.element,n=t===void 0?"[data-popper-arrow]":t;n!=null&&(typeof n!="string"||(n=e.elements.popper.querySelector(n)))&&fo(e.elements.popper,n)&&(e.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function tx(a,e,t){return t===void 0&&(t={x:0,y:0}),{top:a.top-e.height-t.y,right:a.right-e.width+t.x,bottom:a.bottom-e.height+t.y,left:a.left-e.width-t.x}}function Pg(a){return[hi,Fi,Li,Ei].some(function(e){return a[e]>=0})}var nx={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(a){var e=a.state,t=a.name,n=e.rects.reference,s=e.rects.popper,l=e.modifiersData.preventOverflow,c=qs(e,{elementContext:"reference"}),f=qs(e,{altBoundary:!0}),g=tx(c,n),y=tx(f,s,l),x=Pg(g),S=Pg(y);e.modifiersData[t]={referenceClippingOffsets:g,popperEscapeOffsets:y,isReferenceHidden:x,hasPopperEscaped:S},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":x,"data-popper-escaped":S})}},ix=bp({defaultModifiers:[Mv,ci,gr,Qr,vs,Tr,Cv,ex,nx]}),KE="tippy-box",rx="tippy-content",$E="tippy-backdrop",sx="tippy-arrow",By="tippy-svg-arrow",wp={passive:!0,capture:!0},Ts=function(){return document.body};function Oy(a,e,t){if(Array.isArray(a)){var n=a[e];return n??(Array.isArray(t)?t[e]:t)}return a}function qc(a,e){var t={}.toString.call(a);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function Kh(a,e){return typeof a=="function"?a.apply(void 0,e):a}function Ny(a,e){return e===0?a:function(n){clearTimeout(t),t=setTimeout(function(){a(n)},e)};var t}function Yc(a){return[].concat(a)}function Rv(a,e){a.indexOf(e)===-1&&a.push(e)}function Xo(a){return[].slice.call(a)}function $h(a){return Object.keys(a).reduce(function(e,t){return a[t]!==void 0&&(e[t]=a[t]),e},{})}function Jh(){return document.createElement("div")}function Gl(a){return["Element","Fragment"].some(function(e){return qc(a,e)})}function Hl(a,e){a.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function ky(a,e){a.forEach(function(t){t&&t.setAttribute("data-state",e)})}function ya(a,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(s){a[n](s,t)})}function em(a,e){for(var t=e;t;){var n;if(a.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var Ru={isTouch:!1},Uy=0;function hI(){Ru.isTouch||(Ru.isTouch=!0,window.performance&&document.addEventListener("mousemove",ZS))}function ZS(){var a=performance.now();a-Uy<20&&(Ru.isTouch=!1,document.removeEventListener("mousemove",ZS)),Uy=a}function dI(){var a,e=document.activeElement;if((a=e)&&a._tippy&&a._tippy.reference===a){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var pI=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),sh=Object.assign({appendTo:Ts,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),fI=Object.keys(sh);function eT(a){var e=(a.plugins||[]).reduce(function(t,n){var s,l=n.name,c=n.defaultValue;return l&&(t[l]=a[l]!==void 0?a[l]:(s=sh[l])!=null?s:c),t},{});return Object.assign({},a,e)}function tT(a,e){var t=Object.assign({},e,{content:Kh(e.content,[a])},e.ignoreAttributes?{}:function(n,s){return(s?Object.keys(eT(Object.assign({},sh,{plugins:s}))):fI).reduce(function(l,c){var f=(n.getAttribute("data-tippy-"+c)||"").trim();if(!f)return l;if(c==="content")l[c]=f;else try{l[c]=JSON.parse(f)}catch{l[c]=f}return l},{})}(a,e.plugins));return t.aria=Object.assign({},sh.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var mI=function(){return"innerHTML"};function JE(a,e){a[mI()]=e}function nT(a){var e=Jh();return a===!0?e.className=sx:(e.className=By,Gl(a)?e.appendChild(a):JE(e,a)),e}function iT(a,e){Gl(e.content)?(JE(a,""),a.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?JE(a,e.content):a.textContent=e.content)}function ZE(a){var e=a.firstElementChild,t=Xo(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(rx)}),arrow:t.find(function(n){return n.classList.contains(sx)||n.classList.contains(By)}),backdrop:t.find(function(n){return n.classList.contains($E)})}}function rT(a){var e=Jh(),t=Jh();t.className=KE,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Jh();function s(l,c){var f=ZE(e),g=f.box,y=f.content,x=f.arrow;c.theme?g.setAttribute("data-theme",c.theme):g.removeAttribute("data-theme"),typeof c.animation=="string"?g.setAttribute("data-animation",c.animation):g.removeAttribute("data-animation"),c.inertia?g.setAttribute("data-inertia",""):g.removeAttribute("data-inertia"),g.style.maxWidth=typeof c.maxWidth=="number"?c.maxWidth+"px":c.maxWidth,c.role?g.setAttribute("role",c.role):g.removeAttribute("role"),l.content===c.content&&l.allowHTML===c.allowHTML||iT(y,a.props),c.arrow?x?l.arrow!==c.arrow&&(g.removeChild(x),g.appendChild(nT(c.arrow))):g.appendChild(nT(c.arrow)):x&&g.removeChild(x)}return n.className=rx,n.setAttribute("data-state","hidden"),iT(n,a.props),e.appendChild(t),t.appendChild(n),s(a.props,a.props),{popper:e,onUpdate:s}}rT.$$tippy=!0;var gI=1,ox=[],e1=[];function _I(a,e){var t,n,s,l,c,f,g,y,x=tT(a,Object.assign({},sh,eT($h(e)))),S=!1,C=!1,L=!1,B=!1,W=[],q=Ny(vn,x.interactiveDebounce),Z=gI++,j=(y=x.plugins).filter(function(sn,pi){return y.indexOf(sn)===pi}),F={id:Z,reference:a,popper:Jh(),popperInstance:null,props:x,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:j,clearDelayTimeouts:function(){clearTimeout(t),clearTimeout(n),cancelAnimationFrame(s)},setProps:function(sn){if(!F.state.isDestroyed){vt("onBeforeUpdate",[F,sn]),lr();var pi=F.props,Xi=tT(a,Object.assign({},pi,$h(sn),{ignoreAttributes:!0}));F.props=Xi,Br(),pi.interactiveDebounce!==Xi.interactiveDebounce&&(Cn(),q=Ny(vn,Xi.interactiveDebounce)),pi.triggerTarget&&!Xi.triggerTarget?Yc(pi.triggerTarget).forEach(function($n){$n.removeAttribute("aria-expanded")}):Xi.triggerTarget&&a.removeAttribute("aria-expanded"),Ht(),mt(),be&&be(pi,Xi),F.popperInstance&&(Wr(),xr().forEach(function($n){requestAnimationFrame($n._tippy.popperInstance.forceUpdate)})),vt("onAfterUpdate",[F,sn])}},setContent:function(sn){F.setProps({content:sn})},show:function(){var sn=F.state.isVisible,pi=F.state.isDestroyed,Xi=!F.state.isEnabled,$n=Ru.isTouch&&!F.props.touch,pr=Oy(F.props.duration,0,sh.duration);if(!(sn||pi||Xi||$n||at().hasAttribute("disabled")||(vt("onShow",[F],!1),F.props.onShow(F)===!1))){if(F.state.isVisible=!0,Qe()&&(pe.style.visibility="visible"),mt(),Fn(),F.state.isMounted||(pe.style.transition="none"),Qe()){var Gs=Je();Hl([Gs.box,Gs.content],0)}var oo,Lo,ja;f=function(){var ll;if(F.state.isVisible&&!B){if(B=!0,pe.offsetHeight,pe.style.transition=F.props.moveTransition,Qe()&&F.props.animation){var wa=Je(),Mr=wa.box,$l=wa.content;Hl([Mr,$l],pr),ky([Mr,$l],"visible")}Qt(),Ht(),Rv(e1,F),(ll=F.popperInstance)==null||ll.forceUpdate(),vt("onMount",[F]),F.props.animation&&Qe()&&function(Hp,bt){bi(Hp,function(){F.state.isShown=!0,vt("onShown",[F])})}(pr)}},Lo=F.props.appendTo,ja=at(),(oo=F.props.interactive&&Lo===Ts||Lo==="parent"?ja.parentNode:Kh(Lo,[ja])).contains(pe)||oo.appendChild(pe),F.state.isMounted=!0,Wr()}},hide:function(){var sn=!F.state.isVisible,pi=F.state.isDestroyed,Xi=!F.state.isEnabled,$n=Oy(F.props.duration,1,sh.duration);if(!(sn||pi||Xi)&&(vt("onHide",[F],!1),F.props.onHide(F)!==!1)){if(F.state.isVisible=!1,F.state.isShown=!1,B=!1,S=!1,Qe()&&(pe.style.visibility="hidden"),Cn(),di(),mt(!0),Qe()){var pr=Je(),Gs=pr.box,oo=pr.content;F.props.animation&&(Hl([Gs,oo],$n),ky([Gs,oo],"hidden"))}Qt(),Ht(),F.props.animation?Qe()&&function(Lo,ja){bi(Lo,function(){!F.state.isVisible&&pe.parentNode&&pe.parentNode.contains(pe)&&ja()})}($n,F.unmount):F.unmount()}},hideWithInteractivity:function(sn){Ke().addEventListener("mousemove",q),Rv(ox,q),q(sn)},enable:function(){F.state.isEnabled=!0},disable:function(){F.hide(),F.state.isEnabled=!1},unmount:function(){F.state.isVisible&&F.hide(),F.state.isMounted&&(Rr(),xr().forEach(function(sn){sn._tippy.unmount()}),pe.parentNode&&pe.parentNode.removeChild(pe),e1=e1.filter(function(sn){return sn!==F}),F.state.isMounted=!1,vt("onHidden",[F]))},destroy:function(){F.state.isDestroyed||(F.clearDelayTimeouts(),F.unmount(),lr(),delete a._tippy,F.state.isDestroyed=!0,vt("onDestroy",[F]))}};if(!x.render)return F;var se=x.render(F),pe=se.popper,be=se.onUpdate;pe.setAttribute("data-tippy-root",""),pe.id="tippy-"+F.id,F.popper=pe,a._tippy=F,pe._tippy=F;var Se=j.map(function(sn){return sn.fn(F)}),Be=a.hasAttribute("aria-expanded");return Br(),Ht(),mt(),vt("onCreate",[F]),x.showOnCreate&&vr(),pe.addEventListener("mouseenter",function(){F.props.interactive&&F.state.isVisible&&F.clearDelayTimeouts()}),pe.addEventListener("mouseleave",function(){F.props.interactive&&F.props.trigger.indexOf("mouseenter")>=0&&Ke().addEventListener("mousemove",q)}),F;function Ge(){var sn=F.props.touch;return Array.isArray(sn)?sn:[sn,0]}function Xe(){return Ge()[0]==="hold"}function Qe(){var sn;return!((sn=F.props.render)==null||!sn.$$tippy)}function at(){return g||a}function Ke(){var sn,pi,Xi=at().parentNode;return Xi&&(pi=Yc(Xi)[0])!=null&&(sn=pi.ownerDocument)!=null&&sn.body?pi.ownerDocument:document}function Je(){return ZE(pe)}function ft(sn){return F.state.isMounted&&!F.state.isVisible||Ru.isTouch||l&&l.type==="focus"?0:Oy(F.props.delay,sn?0:1,sh.delay)}function mt(sn){sn===void 0&&(sn=!1),pe.style.pointerEvents=F.props.interactive&&!sn?"":"none",pe.style.zIndex=""+F.props.zIndex}function vt(sn,pi,Xi){var $n;Xi===void 0&&(Xi=!0),Se.forEach(function(pr){pr[sn]&&pr[sn].apply(pr,pi)}),Xi&&($n=F.props)[sn].apply($n,pi)}function Qt(){var sn=F.props.aria;if(sn.content){var pi="aria-"+sn.content,Xi=pe.id;Yc(F.props.triggerTarget||a).forEach(function($n){var pr=$n.getAttribute(pi);if(F.state.isVisible)$n.setAttribute(pi,pr?pr+" "+Xi:Xi);else{var Gs=pr&&pr.replace(Xi,"").trim();Gs?$n.setAttribute(pi,Gs):$n.removeAttribute(pi)}})}}function Ht(){!Be&&F.props.aria.expanded&&Yc(F.props.triggerTarget||a).forEach(function(sn){F.props.interactive?sn.setAttribute("aria-expanded",F.state.isVisible&&sn===at()?"true":"false"):sn.removeAttribute("aria-expanded")})}function Cn(){Ke().removeEventListener("mousemove",q),ox=ox.filter(function(sn){return sn!==q})}function un(sn){if(!Ru.isTouch||!L&&sn.type!=="mousedown"){var pi=sn.composedPath&&sn.composedPath()[0]||sn.target;if(!F.props.interactive||!em(pe,pi)){if(Yc(F.props.triggerTarget||a).some(function(Xi){return em(Xi,pi)})){if(Ru.isTouch||F.state.isVisible&&F.props.trigger.indexOf("click")>=0)return}else vt("onClickOutside",[F,sn]);F.props.hideOnClick===!0&&(F.clearDelayTimeouts(),F.hide(),C=!0,setTimeout(function(){C=!1}),F.state.isMounted||di())}}}function rn(){L=!0}function Gn(){L=!1}function Fn(){var sn=Ke();sn.addEventListener("mousedown",un,!0),sn.addEventListener("touchend",un,wp),sn.addEventListener("touchstart",Gn,wp),sn.addEventListener("touchmove",rn,wp)}function di(){var sn=Ke();sn.removeEventListener("mousedown",un,!0),sn.removeEventListener("touchend",un,wp),sn.removeEventListener("touchstart",Gn,wp),sn.removeEventListener("touchmove",rn,wp)}function bi(sn,pi){var Xi=Je().box;function $n(pr){pr.target===Xi&&(ya(Xi,"remove",$n),pi())}if(sn===0)return pi();ya(Xi,"remove",c),ya(Xi,"add",$n),c=$n}function Bi(sn,pi,Xi){Xi===void 0&&(Xi=!1),Yc(F.props.triggerTarget||a).forEach(function($n){$n.addEventListener(sn,pi,Xi),W.push({node:$n,eventType:sn,handler:pi,options:Xi})})}function Br(){var sn;Xe()&&(Bi("touchstart",tr,{passive:!0}),Bi("touchend",zn,{passive:!0})),(sn=F.props.trigger,sn.split(/\s+/).filter(Boolean)).forEach(function(pi){if(pi!=="manual")switch(Bi(pi,tr),pi){case"mouseenter":Bi("mouseleave",zn);break;case"focus":Bi(pI?"focusout":"blur",fi);break;case"focusin":Bi("focusout",fi)}})}function lr(){W.forEach(function(sn){var pi=sn.node,Xi=sn.eventType,$n=sn.handler,pr=sn.options;pi.removeEventListener(Xi,$n,pr)}),W=[]}function tr(sn){var pi,Xi=!1;if(F.state.isEnabled&&!br(sn)&&!C){var $n=((pi=l)==null?void 0:pi.type)==="focus";l=sn,g=sn.currentTarget,Ht(),!F.state.isVisible&&qc(sn,"MouseEvent")&&ox.forEach(function(pr){return pr(sn)}),sn.type==="click"&&(F.props.trigger.indexOf("mouseenter")<0||S)&&F.props.hideOnClick!==!1&&F.state.isVisible?Xi=!0:vr(sn),sn.type==="click"&&(S=!Xi),Xi&&!$n&&ji(sn)}}function vn(sn){var pi=sn.target,Xi=at().contains(pi)||pe.contains(pi);if(sn.type!=="mousemove"||!Xi){var $n=xr().concat(pe).map(function(pr){var Gs,oo=(Gs=pr._tippy.popperInstance)==null?void 0:Gs.state;return oo?{popperRect:pr.getBoundingClientRect(),popperState:oo,props:x}:null}).filter(Boolean);(function(pr,Gs){var oo=Gs.clientX,Lo=Gs.clientY;return pr.every(function(ja){var ll=ja.popperRect,wa=ja.popperState,Mr=ja.props.interactiveBorder,$l=wa.placement.split("-")[0],Hp=wa.modifiersData.offset;if(!Hp)return!0;var bt=$l==="bottom"?Hp.top.y:0,$t=$l==="top"?Hp.bottom.y:0,gn=$l==="right"?Hp.left.x:0,ai=$l==="left"?Hp.right.x:0,mi=ll.top-Lo+bt>Mr,yn=Lo-ll.bottom-$t>Mr,li=ll.left-oo+gn>Mr,Ji=oo-ll.right-ai>Mr;return mi||yn||li||Ji})})($n,sn)&&(Cn(),ji(sn))}}function zn(sn){br(sn)||F.props.trigger.indexOf("click")>=0&&S||(F.props.interactive?F.hideWithInteractivity(sn):ji(sn))}function fi(sn){F.props.trigger.indexOf("focusin")<0&&sn.target!==at()||F.props.interactive&&sn.relatedTarget&&pe.contains(sn.relatedTarget)||ji(sn)}function br(sn){return!!Ru.isTouch&&Xe()!==sn.type.indexOf("touch")>=0}function Wr(){Rr();var sn=F.props,pi=sn.popperOptions,Xi=sn.placement,$n=sn.offset,pr=sn.getReferenceClientRect,Gs=sn.moveTransition,oo=Qe()?ZE(pe).arrow:null,Lo=pr?{getBoundingClientRect:pr,contextElement:pr.contextElement||at()}:a,ja=[{name:"offset",options:{offset:$n}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Gs}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ll){var wa=ll.state;if(Qe()){var Mr=Je().box;["placement","reference-hidden","escaped"].forEach(function($l){$l==="placement"?Mr.setAttribute("data-placement",wa.placement):wa.attributes.popper["data-popper-"+$l]?Mr.setAttribute("data-"+$l,""):Mr.removeAttribute("data-"+$l)}),wa.attributes.popper={}}}}];Qe()&&oo&&ja.push({name:"arrow",options:{element:oo,padding:3}}),ja.push.apply(ja,(pi==null?void 0:pi.modifiers)||[]),F.popperInstance=ix(Lo,pe,Object.assign({},pi,{placement:Xi,onFirstUpdate:f,modifiers:ja}))}function Rr(){F.popperInstance&&(F.popperInstance.destroy(),F.popperInstance=null)}function xr(){return Xo(pe.querySelectorAll("[data-tippy-root]"))}function vr(sn){F.clearDelayTimeouts(),sn&&vt("onTrigger",[F,sn]),Fn();var pi=ft(!0),Xi=Ge(),$n=Xi[0],pr=Xi[1];Ru.isTouch&&$n==="hold"&&pr&&(pi=pr),pi?t=setTimeout(function(){F.show()},pi):F.show()}function ji(sn){if(F.clearDelayTimeouts(),vt("onUntrigger",[F,sn]),F.state.isVisible){if(!(F.props.trigger.indexOf("mouseenter")>=0&&F.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(sn.type)>=0&&S)){var pi=ft(!1);pi?n=setTimeout(function(){F.state.isVisible&&F.hide()},pi):s=requestAnimationFrame(function(){F.hide()})}}else di()}}function Iv(a,e){e===void 0&&(e={});var t=sh.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",hI,wp),window.addEventListener("blur",dI);var n,s=Object.assign({},e,{plugins:t}),l=(n=a,Gl(n)?[n]:function(c){return qc(c,"NodeList")}(n)?Xo(n):Array.isArray(n)?n:Xo(document.querySelectorAll(n))).reduce(function(c,f){var g=f&&_I(f,s);return g&&c.push(g),c},[]);return Gl(a)?l[0]:l}Iv.defaultProps=sh,Iv.setDefaultProps=function(a){Object.keys(a).forEach(function(e){sh[e]=a[e]})},Iv.currentInput=Ru;var vI=Object.assign({},Qr,{effect:function(a){var e=a.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow)}}),yI=function(a,e){var t;e===void 0&&(e={});var n,s=a,l=[],c=[],f=e.overrides,g=[],y=!1;function x(){c=s.map(function(be){return Yc(be.props.triggerTarget||be.reference)}).reduce(function(be,Se){return be.concat(Se)},[])}function S(){l=s.map(function(be){return be.reference})}function C(be){s.forEach(function(Se){be?Se.enable():Se.disable()})}function L(be){return s.map(function(Se){var Be=Se.setProps;return Se.setProps=function(Ge){Be(Ge),Se.reference===n&&be.setProps(Ge)},function(){Se.setProps=Be}})}function B(be,Se){var Be=c.indexOf(Se);if(Se!==n){n=Se;var Ge=(f||[]).concat("content").reduce(function(Xe,Qe){return Xe[Qe]=s[Be].props[Qe],Xe},{});be.setProps(Object.assign({},Ge,{getReferenceClientRect:typeof Ge.getReferenceClientRect=="function"?Ge.getReferenceClientRect:function(){var Xe;return(Xe=l[Be])==null?void 0:Xe.getBoundingClientRect()}}))}}C(!1),S(),x();var W,q,Z,j={fn:function(){return{onDestroy:function(){C(!0)},onHidden:function(){n=null},onClickOutside:function(be){be.props.showOnCreate&&!y&&(y=!0,n=null)},onShow:function(be){be.props.showOnCreate&&!y&&(y=!0,B(be,l[0]))},onTrigger:function(be,Se){B(be,Se.currentTarget)}}}},F=Iv(Jh(),Object.assign({},(W=e,q=["overrides"],Z=Object.assign({},W),q.forEach(function(be){delete Z[be]}),Z),{plugins:[j].concat(e.plugins||[]),triggerTarget:c,popperOptions:Object.assign({},e.popperOptions,{modifiers:[].concat(((t=e.popperOptions)==null?void 0:t.modifiers)||[],[vI])})})),se=F.show;F.show=function(be){if(se(),!n&&be==null)return B(F,l[0]);if(!n||be!=null){if(typeof be=="number")return l[be]&&B(F,l[be]);if(s.indexOf(be)>=0){var Se=be.reference;return B(F,Se)}return l.indexOf(be)>=0?B(F,be):void 0}},F.showNext=function(){var be=l[0];if(!n)return F.show(0);var Se=l.indexOf(n);F.show(l[Se+1]||be)},F.showPrevious=function(){var be=l[l.length-1];if(!n)return F.show(be);var Se=l.indexOf(n),Be=l[Se-1]||be;F.show(Be)};var pe=F.setProps;return F.setProps=function(be){f=be.overrides||f,pe(be)},F.setInstances=function(be){C(!0),g.forEach(function(Se){return Se()}),s=be,C(!1),S(),x(),g=L(F),F.setProps({triggerTarget:c})},g=L(F),F};Iv.setDefaultProps({render:rT});var tm=Iv;class Ep extends Mn{async _refreshUi(){if(!await super._refreshUi())return!1;Sn.RemoveAll(Ep.PluginType);for(const e of this.variations)Sn.Create(Ep.PluginType,e.title,5,20,0,e.materials.map(t=>{let n;if(e.preview.startsWith("generate:"))n=this._previewGenerator.generate(t,e.preview.split(":")[1]);else{const s=t[e.preview]||"#ff00ff";n=s.image?(0,r.imageBitmapToBase64)(s.image,100):void 0,n||(n=(0,r.makeColorSvgCircle)(s!=null&&s.isColor?s.getHexString():s))}return{id:t.uuid,image:n,onClick:s=>this.applyVariation(e,s),tooltip:t.name||t.uuid}}),(t,n)=>tm(t,{placement:"bottom",content:n.tooltip}));return Sn.RebuildUi(),!0}}Ep.PluginType="MaterialConfiguratorPlugin";class t1 extends Ln{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this.dependencies=[ri],this.variations=[],this._selectedSwitchNode=()=>{var s;const e=(s=this._picking)==null?void 0:s.getSelectedObject();if(!e)return;const t=this.variations.map(l=>l.name);let n;return e.traverseAncestors(l=>{n||l.name&&t.includes(l.name)&&(n=l)}),n},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var t,n;await super.onAdded(e),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",()=>{var s,l;(l=(s=this.uiConfig).uiRefresh)==null||l.call(s)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer&&this.enabled){for(const s of this.variations){if(!s.name)continue;const l=this._viewer.scene.getObjectByName(s.name);if(!l||l.children.length<1)return;s.selected||(s.selected=l.children[0].name||l.children[0].uuid);for(const c of l.children)c.userData.__oldVisible=c.visible,c.visible=(c.name||c.uuid)===s.selected}this._isVisibleChanged=!0}}),e.addEventListener("postRender",()=>{if(this._viewer&&this._isVisibleChanged){for(const s of this.variations){if(!s.name)continue;const l=this._viewer.scene.getObjectByName(s.name);if(!l||l.children.length<1)return;for(const c of l.children){if(c.userData.__oldVisible===void 0)return;c.visible=c.userData.__oldVisible,delete c.userData.__oldVisible}}this._isVisibleChanged=!1}}),this.addEventListener("deserialize",async()=>{this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,t;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,(t=(e=this.uiConfig).uiRefresh)==null||t.call(e),!0)}}(function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)})([Pe()],t1.prototype,"variations",void 0);class Sp extends t1{_refreshUi(){if(!super._refreshUi())return!1;Sn.RemoveAll(Sp.PluginType);for(const e of this.variations){const t=this._viewer.scene.getObjectByName(e.name);t?(t.children.length<1&&console.warn("SwitchNode does not have enough children",e),Sn.Create(Sp.PluginType,e.title,Math.min(5,t.children.length),20,0,t.children.map(n=>{const s=e.camView,l=new i.Pa4((s.includes("right")?1:0)-(s.includes("left")?1:0),(s.includes("top")?1:0)-(s.includes("bottom")?1:0),(s.includes("front")?1:0)-(s.includes("back")?1:0));e.camDistance||(e.camDistance=1);const c=an(this._viewer,n,void 0,7,l.multiplyScalar(.5*e.camDistance));return{id:n.uuid,image:c,onClick:()=>{var f;e.selected=n.name||n.uuid,(f=this._viewer)==null||f.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:n.name||n.uuid}}),(n,s)=>tm(n,{placement:"bottom",content:s.tooltip}))):console.warn("no object found for variation, skipping",e)}return Sn.RebuildUi(),!0}}Sp.PluginType="SwitchNodePlugin";class ax extends Ln{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0))},this.dependencies=[ri],this._selectedObject=()=>{var e;return((e=this._picking)==null?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())==null?void 0:e.material)||void 0}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),this._previewGenerator=new Ot(this._viewer),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var t,n;return(t=this._previewGenerator)==null||t.dispose(),this._previewGenerator=void 0,(n=this._picking)==null||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}ax.PluginType="MaterialLibraryBasePlugin",function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)}([En("Enabled")],ax.prototype,"enabled",void 0);class Zh extends ax{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:mn(),children:[..._t(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(ri).materials.getAllMaterials().map(e=>({label:e.name||e.uuid,value:e.uuid}))||[]]],getValue:()=>{var e;return(e=this._selectedMaterial())==null?void 0:e.uuid},setValue:e=>{var n,s,l,c,f;const t=(l=(s=(n=this._viewer)==null?void 0:n.getPlugin(ri))==null?void 0:s.materials)==null?void 0:l.findMaterial(e);if(t)if(this.replaceMaterial)(f=(c=this._selectedObject())==null?void 0:c.setMaterial)==null||f.call(c,t);else{const g=this._selectedMaterial();if(g){const y=g.name,x=g.uuid;g.copyProps(t),g.name=y,g.uuid=x,g.userData.uuid&&(g.userData.uuid=x)}}this._refreshUi()}})]}}async _refreshUi(){var s,l;if(!await super._refreshUi())return!1;const e=[_o.TypeSlug,ls.TypeSlug],t=(l=(s=this._viewer)==null?void 0:s.getPlugin(ri))==null?void 0:l.materials,n=e.map(c=>[c,t==null?void 0:t.getMaterialsOfType(c)]);Sn.RemoveAll(Zh.PluginType);for(const[c,f]of n)Sn.Create(Zh.PluginType,c,5,20,0,f==null?void 0:f.filter(g=>!g.userData.__runtimeMaterial).map(g=>{let y;const x="generate:sphere";if(x.startsWith("generate:"))y=this._previewGenerator.generate(g,x.split(":")[1]);else{const S=g[x]||"#ff00ff";y=S.image?(0,r.imageBitmapToBase64)(S.image,100):void 0,y||(y=(0,r.makeColorSvg)(S))}return{id:g.uuid,image:y,onClick:S=>{const C=t==null?void 0:t.findMaterial(S);if(C){const L=C.userData.__appliedMeshes;if(L!=null&&L.size){const B=L.keys().next().value;B.dispatchEvent({type:"select",value:B})}}},tooltip:g.name||g.uuid}}),(g,y)=>tm(g,{placement:"bottom",content:y.tooltip}));return Sn.RebuildUi(),!0}}Zh.PluginType="MaterialLibraryPlugin",function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)}([En("Replace Material")],Zh.prototype,"replaceMaterial",void 0);class n1 extends i.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,t){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",r.glsl`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)})([Te({propKey:"tLastThis"})],n1.prototype,"lastFrameTexture",void 0);var Pv=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class Kc{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(e){this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this.materialExtension={parsFragmentSnippet:(n,s)=>r.glsl`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(n,s,l)=>{this.groundMapMode==="aoMap"?n.fragmentShader=Yn(n.fragmentShader,"#include <aomap_fragment>",Yn(i.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?n.fragmentShader=Yn(n.fragmentShader,"#include <map_fragment>",Yn(i.WdD.map_fragment,"diffuseColor *= texture2D( map, vMapUv );","float groundShadow = mix(1., unpackRGBAToDepth(texture2D( map, vMapUv )), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):this.groundMapMode==="alphaMap"&&(n.fragmentShader=Yn(n.fragmentShader,"#include <alphamap_fragment>",Yn(i.WdD.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),n.fragmentShader=Yn(n.fragmentShader,"#include <output_fragment>",r.glsl`#include <output_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&l.capabilities.isWebGL2&&(n.fragmentShader=Yn(n.fragmentShader,"#include <output_fragment>",r.glsl`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(n,s)=>{s.materialObject.userData.gMapMode!==this.groundMapMode&&(s.materialObject.userData.gMapMode=this.groundMapMode,s.materialObject.needsUpdate=!0)},isCompatible:n=>n.isMeshStandardMaterial2},this._viewer=e;const t=new wf(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new i.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new i.Pa4(10,10,10),normalDirection:new i.Pa4(0,1,0)});t.shadow.camera.updateProjectionMatrix(),t.layers.disableAll(),t.layers.set(this._lightLayer),this._light=t,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new n1({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:i.jFi}),this._shadowBlurMat=new Zi({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new i.FM8(.5,.5)},direction:{value:new i.FM8(.5,.5)}},vertexShader:cc,fragmentShader:`#include <packing>
uniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}`})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,t,n;(t=(e=this.materialExtension)==null?void 0:e.setDirty)==null||t.call(e),(n=this._viewer)==null||n.setDirty()}fromJSON(e,t){return ui(e,this,!0,t),this.reset(),this}reset(){this._frameNumber=0}autoUpdateShadow(){this.shadowAutoUpdate&&this.updateShadow()}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(++this._frameNumber>this.maxFrameNumber||!e)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:i.ywz,depthBuffer:!1,size:new i.FM8(t,t),sizeMultiplier:void 0,colorSpace:i.aCh,format:i.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const n=this._viewer.renderer.rendererObject,s=n.shadowMap,l=s.type,c=s.needsUpdate,f=s.autoUpdate;s.type=i._MY,s.needsUpdate=!0,s.autoUpdate=!1;const g=this._viewer.scene,y=new i.S9g;y.disableAll(),g.modelObject.traverse(B=>{B.isLight&&B!==this._light.lightObject&&(B.userData.__gp_layers=B.layers,B.layers=y)});const x=g.activeCamera.cameraObject;if(x.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";x.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),ot(n,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(g)),x.layers.disable(this._lightLayer);const S=x.layers.mask;x.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const C=this._viewer.renderer.getTempTarget({type:i.ywz,depthBuffer:!1,size:new i.FM8(t,t),colorSpace:i.aCh,format:i.wk1}),L=C.texture.colorSpace;C.texture.colorSpace=i.aCh,this._viewer.renderer.blit(this._target.texture,C,{clear:!0});{const B=e.material,W=e.frustumCulled,q=n.getRenderTarget(),Z=n.getActiveCubeFace(),j=n.getActiveMipmapLevel();e.material=this._shadowMat,e.frustumCulled=!1,n.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=C.texture,this._shadowMat.needsUpdate=!0,ot(n,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(g)),n.setRenderTarget(q,Z,j),e.frustumCulled=W,e.material=B,this.smoothShadow&&this._applySmoothFilter(this._target,C)}return C.texture.colorSpace=L,this._viewer.renderer.releaseTempTarget(C),e.layers.disable(this._lightLayer),x.layers.mask=S,g.modelObject.traverse(B=>{B.isLight&&B!==this._light.lightObject&&(B.layers=B.userData.__gp_layers,delete B.userData.__gp_layers)}),s.type=l,s.needsUpdate=c,s.autoUpdate=f,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var t,n,s;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((t=this._target)==null?void 0:t.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((n=this._target)==null?void 0:n.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((s=this._target)==null?void 0:s.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.001,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,t){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,t,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=t.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(t.width,t.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}Pv([Pe("randomizedLight")],Kc.prototype,"_light",void 0),Pv([(0,r.onChange)(Kc.prototype.reset),Pe()],Kc.prototype,"maxFrameNumber",void 0),Pv([(0,r.onChange)(Kc.prototype.reset),Pe()],Kc.prototype,"smoothShadow",void 0),Pv([(0,r.onChange)(Kc.prototype._groundMapModeChanged),Pe()],Kc.prototype,"groundMapMode",void 0),Pv([Pe(),(0,r.onChange)(Kc.prototype._alphaVignetteChanged)],Kc.prototype,"alphaVignette",void 0),Pv([Pe(),(0,r.onChange)(Kc.prototype._alphaVignetteChanged)],Kc.prototype,"alphaVignetteAxis",void 0);var sT=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class Dg extends i.Kj0{_updateExtension(){var e,t;this.transparentReflectionBackground=this.reflectorModePhysical,(t=(e=this.materialExtension)==null?void 0:e.setDirty)==null||t.call(e)}constructor(e,t,n=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new i.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(q,Z,j)=>{if(this.enabled){q.vertexShader=q.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const F="#glMarker beforeModulation";q.fragmentShader=q.fragmentShader.replace(F,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+F)}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?w0+`
`+Vc+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:q=>this.enabled+" "+q.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(q,{materialObject:Z})=>{Z.userData.__lastTransparent!==Z.transparent&&(Z.needsUpdate=!0,Z.userData.__lastTransparent=Z.transparent)},isCompatible:q=>q.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const s=new i.JOQ,l=new i.Pa4,c=new i.Pa4,f=new i.Pa4,g=new i.yGw,y=new i.Pa4(0,0,-1),x=new i.Ltg,S=new i.Pa4,C=new i.Pa4,L=new i.Ltg,B=new i.yGw,W=new i.cPb;i.M8C.isPowerOfTwo(t.texture.image.width)&&i.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(q,Z,j)=>{if(!this.enabled||!q.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const F=j.view?Object.assign({},j.view):null;if(F&&j.clearViewOffset&&j.clearViewOffset(),c.setFromMatrixPosition(this.matrixWorld),f.setFromMatrixPosition(j.matrixWorld),g.extractRotation(this.matrixWorld),l.set(0,0,1),l.applyMatrix4(g),S.subVectors(c,f),S.dot(l)>0)return;S.reflect(l).negate(),S.add(c),g.extractRotation(j.matrixWorld),y.set(0,0,-1),y.applyMatrix4(g),y.add(f),C.subVectors(c,y),C.reflect(l).negate(),C.add(c),W.position.copy(S),W.up.set(0,1,0),W.up.applyMatrix4(g),W.up.reflect(l),W.lookAt(C),W.far=2,W.near=0,W.updateMatrixWorld(),W.projectionMatrix.copy(j.projectionMatrix),B.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),B.multiply(W.projectionMatrix),B.multiply(W.matrixWorldInverse),B.multiply(this.matrixWorld),s.setFromNormalAndCoplanarPoint(l,c),s.applyMatrix4(W.matrixWorldInverse),x.set(s.normal.x,s.normal.y,s.normal.z,s.constant);const se=W.projectionMatrix;L.x=(Math.sign(x.x)+se.elements[8])/se.elements[0],L.y=(Math.sign(x.y)+se.elements[9])/se.elements[5],L.z=-1,L.w=(1+se.elements[10])/se.elements[14],x.multiplyScalar(2/x.dot(L)),se.elements[2]=x.x,se.elements[6]=x.y,se.elements[10]=x.z+1-n,se.elements[14]=x.w,this.visible=!1;const pe=q.getRenderTarget(),be=q.xr.enabled,Se=q.shadowMap.autoUpdate;q.xr.enabled=!1,q.shadowMap.autoUpdate=!1,q.setRenderTarget(this._renderTarget),q.state.buffers.depth.setMask(!0),q.autoClear===!1&&q.clear();const Be=Z.background;this.transparentReflectionBackground&&(Z.background=null);const Ge=!this.transparentReflectionBackground;Be&&Ge&&(Be.userData||(Be.userData={}),Be.userData.flipX=!Be.userData.flipX),ot(q,{shadowMapRender:!1,backgroundRender:Ge,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>q.render(Z,W)),Be&&Ge&&(Be.userData.flipX=!Be.userData.flipX||void 0),this.transparentReflectionBackground&&(Z.background=Be),q.xr.enabled=be,q.shadowMap.autoUpdate=Se,q.setRenderTarget(pe),F!=null&&F.enabled&&j.setViewOffset&&j.setViewOffset(F.fullWidth,F.fullHeight,F.offsetX,F.offsetY,F.width,F.height);const Xe=j.viewport;Xe!==void 0&&q.state.viewport(Xe),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=B,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new i.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=B}getRenderTarget(){return this._renderTarget}}sT([(0,r.onChange)(Dg.prototype._updateExtension)],Dg.prototype,"enabled",void 0),sT([(0,r.onChange)(Dg.prototype._updateExtension)],Dg.prototype,"reflectorModePhysical",void 0),Dg.prototype.isReflector=!0;var Lg=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class El extends Ln{get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[ri],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new i._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(e){this._options.autoAdjustTransform=e,this.refreshTransform()}_createMesh(){return new i.Kj0(this._geometry)}async onAdded(e){var n,s;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(ri);const t=this._createMesh();t.userData.physicsMass=0,this._iMesh=await((n=this._manager)==null?void 0:n.addImportedSingle(t,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(s=this._iMesh)==null?void 0:s.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var t,n,s;return this._removeMaterial(),this._geometry.dispose(),(t=this._material)==null||t.dispose(),(s=(n=this._iMesh)==null?void 0:n.dispose)==null||s.call(n),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){(e==null?void 0:e.geometryChanged)!==!1&&(e==null?void 0:e.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var t;const e=(t=this._viewer)==null?void 0:t.scene.activeCamera.controls;e&&(e.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=e.maxPolarAngle),e.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(e.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var t,n,s;if(!this._mesh||!this._viewer)return;let e=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,e=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const l=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const c=l.getCenter(new i.Pa4).sub(new i.Pa4(0,l.getSize(new i.Pa4).y/2+this.yOffset,0));e=e||c.clone().sub(this._mesh.position).length()>1e-4,e&&this._mesh.position.copy(c)}e=e||Math.abs(this._mesh.scale.x-this.size)>1e-4,e&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new i.USm(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,(n=(t=this._mesh).setDirty)==null||n.call(t)),this._transformNeedRefresh=!1}else e&&((s=this._viewer)==null||s.scene.setDirty())}_refreshMaterial(){var n,s,l,c;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const e=this._material??((s=(n=this._manager)==null?void 0:n.materials)==null?void 0:s.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215}));let t=!1;return e!==this._material&&(this._removeMaterial(),e&&(this._material=e),(l=this._material)!=null&&l.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,(((c=this._mesh)==null?void 0:c.setMaterial)??(g=>{this._mesh&&(this._mesh.material=g.materialObject)}))(this._material)),t=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),t}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)==null?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}Lg([Pe("material")],El.prototype,"_material",void 0),Lg([(0,r.onChange)(El.prototype.refreshTransform),Pe()],El.prototype,"visible",void 0),Lg([(0,r.onChange2)(El.prototype._onSceneUpdate),Pe()],El.prototype,"size",void 0),Lg([(0,r.onChange2)(El.prototype._onSceneUpdate),Pe()],El.prototype,"yOffset",void 0),Lg([(0,r.onChange)(El.prototype._refreshOptions2),Pe()],El.prototype,"renderToDepth",void 0),Lg([(0,r.onChange)(El.prototype._refreshOptions2),Pe()],El.prototype,"tonemapGround",void 0),Lg([(0,r.onChange)(El.prototype._refreshCameraLimits),Pe()],El.prototype,"limitCameraAboveGround",void 0);var lx=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class $c extends El{get shadowBaker(){return this._shadowBaker}bakeShadows(){var e;(e=this._shadowBaker)==null||e.reset()}constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoBakeShadows=!0,this._showDebug=t,t&&this.dependencies.push(ih),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const e=new Dg(this._geometry,this._viewer.renderer.createTarget({type:i.ywz,format:i.wk1,colorSpace:i.aCh,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:i.D1R,magFilter:i.wem})),t=e.onBeforeRender;return e.onBeforeRender=(...n)=>{var c,f,g,y,x;let s=(f=(c=this._viewer)==null?void 0:c.getPluginByType("SSReflection"))==null?void 0:f.passes.ssr.passObject;s&&!s.enabled&&(s=void 0),s&&(s.enabled=!1);let l=(x=(y=(g=this._viewer)==null?void 0:g.getPluginByType("SSBevelPlugin"))==null?void 0:y.pass)==null?void 0:x.passObject;l&&!l.enabled&&(l=void 0),l&&(l.enabled=!1),t(...n),s&&(s.enabled=!0),l&&(l.enabled=!0)},e}async onAdded(e){var t,n;await super.onAdded(e),this._showDebug&&((t=e.getPlugin(ih))==null||t.addTexture("bake_ground_1",()=>{var s,l;return(l=(s=this._shadowBaker)==null?void 0:s.light.shadow.map)==null?void 0:l.texture},[100,100,200,200]),(n=e.getPlugin(ih))==null||n.addTexture("bake_ground_2",()=>{var s,l;return(l=(s=this._shadowBaker)==null?void 0:s.target)==null?void 0:l.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){var e;super._postFrame(),this._viewer&&this.enabled&&this.bakedShadows&&((e=this._shadowBaker)==null||e.autoUpdateShadow())}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,t,n,s;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((t=(e=this._material).unregisterMaterialExtensions)==null||t.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const l=this._mesh.materialExtension;l||console.warn("unable to find the extension to unregister"),(s=(n=this._material).unregisterMaterialExtensions)==null||s.call(n,[l]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var t;super._onSceneUpdate(e),e.geometryChanged!==!1&&this.autoBakeShadows&&((t=this._shadowBaker)==null||t.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new Kc(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var t,n,s,l;if(!this._viewer)return!1;const e=super._refreshMaterial();if(!this._material)return e;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const c=this._mesh.materialExtension;c.updaters=[this._viewer.scene,this._viewer.renderer],(n=(t=this._material).registerMaterialExtensions)==null||n.call(t,[c]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((l=(s=this._material).registerMaterialExtensions)==null||l.call(s,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),e}_extraUiConfig(){var e,t,n,s,l,c,f,g,y,x,S,C,L,B,W,q,Z,j,F,se,pe,be,Se,Be,Ge,Xe,Qe,at,Ke,Je;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var ft,mt;return(mt=(ft=this._uiConfig)==null?void 0:ft.uiRefresh)==null?void 0:mt.call(ft,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var ft;return!((ft=this._shadowBaker)!=null&&ft.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(ft=>({label:ft,value:ft})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)==null?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(t=this._shadowBaker)==null?void 0:t.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(s=(n=this._shadowBaker)==null?void 0:n.light)==null?void 0:s.shadowParams,"enabled"],onChange:[(c=(l=this._shadowBaker)==null?void 0:l.light)==null?void 0:c.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(g=(f=this._shadowBaker)==null?void 0:f.light)==null?void 0:g.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(x=(y=this._shadowBaker)==null?void 0:y.light)==null?void 0:x.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(C=(S=this._shadowBaker)==null?void 0:S.light)==null?void 0:C.randomParams,"distanceScale"],onChange:[(B=(L=this._shadowBaker)==null?void 0:L.light)==null?void 0:B.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(q=(W=this._shadowBaker)==null?void 0:W.light)==null?void 0:q.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(j=(Z=this._shadowBaker)==null?void 0:Z.light)==null?void 0:j.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(se=(F=this._shadowBaker)==null?void 0:F.light)==null?void 0:se.shadowParams,"radius"],onChange:[(be=(pe=this._shadowBaker)==null?void 0:pe.light)==null?void 0:be.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(Be=(Se=this._shadowBaker)==null?void 0:Se.light)==null?void 0:Be.shadowParams,"frustumSize"],onChange:[(Xe=(Ge=this._shadowBaker)==null?void 0:Ge.light)==null?void 0:Xe.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(at=(Qe=this._shadowBaker)==null?void 0:Qe.light)==null?void 0:at.shadowParams,"bias"],onChange:[(Je=(Ke=this._shadowBaker)==null?void 0:Ke.light)==null?void 0:Je.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}$c.PluginType="Ground",lx([(0,r.onChange)($c.prototype.refreshOptions),Pe()],$c.prototype,"bakedShadows",void 0),lx([(0,r.onChange)($c.prototype.refreshOptions),Pe()],$c.prototype,"groundReflection",void 0),lx([(0,r.onChange)($c.prototype.refreshOptions),Pe()],$c.prototype,"physicalReflections",void 0),lx([Pe("shadowBaker")],$c.prototype,"_shadowBaker",void 0);class oT extends Bl{constructor(e){super(e)}async initialize({caching:e=!0,ground:t=!0,bloom:n=!0,depthTonemap:s=!0,enableDrop:l=!1,importPopup:c=!1,debug:f=!1}={}){return f&&await this.addPlugin(ih),this.getPlugin(ri)||this.addPluginSync(ri,void 0,void 0,{storage:e&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await this.addPlugin(vp,!0),await cx(this,{ground:t,bloom:n,depthTonemap:s,enableDrop:l,importPopup:c}),await this.addPlugin(Xc),await this.addPlugin(Kt),await this.addPlugin(Ep),await this.addPlugin(Sp),await this.addPlugin(Zh),this}}async function cx(a,{ground:e=!0,bloom:t=!0,depthTonemap:n=!0,enableDrop:s=!1,importPopup:l=!1}={}){await a.getOrAddPlugin(ri),l&&await a.getOrAddPlugin(Su),await a.getOrAddPlugin(ir),await a.getOrAddPlugin(po),s&&await a.getOrAddPlugin(kd),await a.addPlugin(new na(32)),await a.getOrAddPlugin(Za),await a.getOrAddPlugin(Im),await a.addPlugin(new Dh(n||!a.useRgbm)),await a.getOrAddPlugin(Ro),await a.getOrAddPlugin(ap),await a.getOrAddPlugin(km),await a.getOrAddPlugin(lv),await a.getOrAddPlugin(Gd),await a.getOrAddPlugin(_f),await a.getOrAddPlugin(Ls),await a.getOrAddPlugin(Qu),await a.getOrAddPlugin(Ss),await a.getOrAddPlugin(ia),await a.getOrAddPlugin(zl),await a.getOrAddPlugin(Ol),await a.getOrAddPlugin(Al),await a.getOrAddPlugin(Ul),await a.getOrAddPlugin(Oa),await a.getOrAddPlugin(Vl),await a.getOrAddPlugin(Qh),await a.getOrAddPlugin(Qf,!1),await a.getOrAddPlugin(Fl),await a.getOrAddPlugin(_s),await a.getOrAddPlugin(qu,!1),await a.getOrAddPlugin(dc,!1),await a.getOrAddPlugin(Bh,!1),await a.getOrAddPlugin(fa,!1),await a.getOrAddPlugin(Xm,!1),await a.getOrAddPlugin(Xu,!1),await a.getOrAddPlugin(Qc,!1),await a.getOrAddPlugin(hp),await a.getOrAddPlugin(Fd),await a.getOrAddPlugin(Ua),await a.getOrAddPlugin(ra),e&&await a.getOrAddPlugin($c),t&&await a.getOrAddPlugin(vf),a.renderer.refreshPipeline()}let AI=0;class aT extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=AI++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const e=window.freeViewers.pop(),t=document.createElement("style");t.textContent=r.css`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.shadowRoot.append(t,this.wrapper),this._initialized=!0,this._initialize(e).then(async()=>this.refreshAll())}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(e){e!=null&&e._lastState&&(this._state.src=e._lastState.src||this._state.src,this._state.environment=e._lastState.environment||this._state.environment,delete e._lastState),e!=null&&e.__models&&(this._models={...this._models,...e.__models},delete e.__models),this.canvas=(e==null?void 0:e.canvas)||(0,r.createCanvasElement)(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=e??new oT({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true",assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),e||await this.viewer.initialize({debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var e,t;this.viewer&&(this.getAttribute("disposeOnRemove")==="true"||this.getAttribute("disposeonremove")==="true"?((e=this.canvas)==null||e.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.getAttribute("autoManageViewers")==="true"||this.getAttribute("automanageviewers")==="true"?((t=this.canvas)==null||t.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(e,t,n){this.refreshAll()}clearViewer(){var e,t;(e=this.viewer)==null||e.scene.disposeSceneModels(),(t=this.viewer)==null||t.scene.setEnvironment(null),Object.values(this._models).forEach(async n=>n.then(s=>s.forEach(l=>l.dispose&&l.dispose()))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const t=[e],n=[],s=[],l=this.viewer.scene.getEnvironment();this.viewer.scene.setEnvironment(null),this._environmentFromSource=null;for(const f of t)!this._models[f]&&f&&(this._models[f]=this.viewer.getManager().importer.importPath(f,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!1,pathOverride:this._getAttr("filename","")||void 0}));const c=this.viewer.scene.getEnvironment();c?this._environmentFromSource=c:this.viewer.scene.setEnvironment(l);for(const[f,g]of Object.entries(this._models))t.includes(f)?n.push(g.then(y=>[f,y])):s.push(g);await Promise.all([Promise.all(n).then(async f=>Promise.all(f.map(async g=>(this._models[g[0]]=this.viewer.getManager().importer.processImported(g[1]),this._models[g[0]])))).then(f=>{for(const g of f)for(const y of g)y&&y.assetType==="model"&&this.viewer.scene.addSceneObject(y)}),Promise.all(s).then(f=>{for(const g of f)for(const y of g)y&&y.assetType==="model"&&y.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),n=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(n&&n.assetType!=="texture"||await this.viewer.scene.setEnvironment(n),t==null||t.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:e}})),this._state.environment=e,this._refreshingEnvironment=!1)}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}addEventListener(e,t,n){super.addEventListener(e,t,n),e==="initialized"&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",aT);class nm{get basePath(){return this._basePath}get assets(){return this._assets}constructor(e){var t;this._basePath=(e==null?void 0:e.basePath)??"",this._assets=((t=e==null?void 0:e.assets)==null?void 0:t.map(n=>this._resolveAsset(n)))??[]}find(e){return this._assets.find(e)??void 0}_resolveAsset(e){return{...e,path:(0,r.pathJoin)([this._basePath,e.path])}}}class bI extends r.SimpleEventDispatcher{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const n=t.find(s=>{var l;return s&&(e.test(s.path)||e.test(((l=s.file)==null?void 0:l.name)??""))});if(n)return n}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}const lT=new i.Pa4,cT=new i.Pa4,rl=new i.Ltg,sl=new i.Ltg,ed=new i.Ltg,i1=new i.Pa4,r1=new i.yGw,ol=new i.Zzh,uT=new i.Pa4,ux=new i.ZzF,hx=new i.aLr,td=new i.Ltg;let nd,Bg;function hT(a,e,t){return td.set(0,0,-e,1).applyMatrix4(a.projectionMatrix),td.multiplyScalar(1/td.w),td.x=Bg/t.width,td.y=Bg/t.height,td.applyMatrix4(a.projectionMatrixInverse),td.multiplyScalar(1/td.w),Math.abs(Math.max(td.x,td.y))}class dT extends i.Kj0{constructor(e=new Um,t=new Fm({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,s=new Float32Array(2*t.count);for(let c=0,f=0,g=t.count;c<g;c++,f+=2)lT.fromBufferAttribute(t,c),cT.fromBufferAttribute(n,c),s[f]=f===0?0:s[f-1],s[f+1]=s[f]+lT.distanceTo(cT);const l=new i.$TI(s,2,1);return e.setAttribute("instanceDistanceStart",new i.kB5(l,1,0)),e.setAttribute("instanceDistanceEnd",new i.kB5(l,1,1)),this}raycast(e,t){const n=this.material.worldUnits,s=e.camera;s!==null||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const l=e.params.Line2!==void 0&&e.params.Line2.threshold||0;nd=e.ray;const c=this.matrixWorld,f=this.geometry,g=this.material;let y,x;Bg=g.linewidth+l,f.boundingSphere===null&&f.computeBoundingSphere(),hx.copy(f.boundingSphere).applyMatrix4(c),y=n?.5*Bg:hT(s,Math.max(s.near,hx.distanceToPoint(nd.origin)),g.resolution),hx.radius+=y,nd.intersectsSphere(hx)!==!1&&(f.boundingBox===null&&f.computeBoundingBox(),ux.copy(f.boundingBox).applyMatrix4(c),x=n?.5*Bg:hT(s,Math.max(s.near,ux.distanceToPoint(nd.origin)),g.resolution),ux.expandByScalar(x),nd.intersectsBox(ux)!==!1&&(n?function(S,C){const L=S.matrixWorld,B=S.geometry,W=B.attributes.instanceStart,q=B.attributes.instanceEnd;for(let Z=0,j=Math.min(B.instanceCount,W.count);Z<j;Z++){ol.start.fromBufferAttribute(W,Z),ol.end.fromBufferAttribute(q,Z),ol.applyMatrix4(L);const F=new i.Pa4,se=new i.Pa4;nd.distanceSqToSegment(ol.start,ol.end,se,F),se.distanceTo(F)<.5*Bg&&C.push({point:se,pointOnLine:F,distance:nd.origin.distanceTo(se),object:S,face:null,faceIndex:Z,uv:null,uv1:null})}}(this,t):function(S,C,L){const B=C.projectionMatrix,W=S.material.resolution,q=S.matrixWorld,Z=S.geometry,j=Z.attributes.instanceStart,F=Z.attributes.instanceEnd,se=Math.min(Z.instanceCount,j.count),pe=-C.near;nd.at(1,ed),ed.w=1,ed.applyMatrix4(C.matrixWorldInverse),ed.applyMatrix4(B),ed.multiplyScalar(1/ed.w),ed.x*=W.x/2,ed.y*=W.y/2,ed.z=0,i1.copy(ed),r1.multiplyMatrices(C.matrixWorldInverse,q);for(let be=0,Se=se;be<Se;be++){if(rl.fromBufferAttribute(j,be),sl.fromBufferAttribute(F,be),rl.w=1,sl.w=1,rl.applyMatrix4(r1),sl.applyMatrix4(r1),rl.z>pe&&sl.z>pe)continue;if(rl.z>pe){const at=rl.z-sl.z,Ke=(rl.z-pe)/at;rl.lerp(sl,Ke)}else if(sl.z>pe){const at=sl.z-rl.z,Ke=(sl.z-pe)/at;sl.lerp(rl,Ke)}rl.applyMatrix4(B),sl.applyMatrix4(B),rl.multiplyScalar(1/rl.w),sl.multiplyScalar(1/sl.w),rl.x*=W.x/2,rl.y*=W.y/2,sl.x*=W.x/2,sl.y*=W.y/2,ol.start.copy(rl),ol.start.z=0,ol.end.copy(sl),ol.end.z=0;const Be=ol.closestPointToPointParameter(i1,!0);ol.at(Be,uT);const Ge=i.M8C.lerp(rl.z,sl.z,Be),Xe=Ge>=-1&&Ge<=1,Qe=i1.distanceTo(uT)<.5*Bg;if(Xe&&Qe){ol.start.fromBufferAttribute(j,be),ol.end.fromBufferAttribute(F,be),ol.start.applyMatrix4(q),ol.end.applyMatrix4(q);const at=new i.Pa4,Ke=new i.Pa4;nd.distanceSqToSegment(ol.start,ol.end,Ke,at),L.push({point:Ke,pointOnLine:at,distance:nd.origin.distanceTo(Ke),object:S,face:null,faceIndex:be,uv:null,uv1:null})}}}(this,s,t)))}}class pT extends Um{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let s=0;s<t;s+=3)n[2*s]=e[s],n[2*s+1]=e[s+1],n[2*s+2]=e[s+2],n[2*s+3]=e[s+3],n[2*s+4]=e[s+4],n[2*s+5]=e[s+5];return super.setPositions(n),this}setColors(e){const t=e.length-3,n=new Float32Array(2*t);for(let s=0;s<t;s+=3)n[2*s]=e[s],n[2*s+1]=e[s+1],n[2*s+2]=e[s+2],n[2*s+3]=e[s+3],n[2*s+4]=e[s+4],n[2*s+5]=e[s+5];return super.setColors(n),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class xI extends dT{constructor(e=new pT,t=new Fm({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class wI extends i.yxD{constructor(e){super(e),this.type=i.cLu}parse(e){const pe=Math.pow(2.7182818,2.2),be={l:0,c:0,lc:0};function Se(bt,$t,gn,ai,mi){for(;gn<bt;)$t=$t<<8|vr(ai,mi),gn+=8;gn-=bt,be.l=$t>>gn&(1<<bt)-1,be.c=$t,be.lc=gn}const Be=new Array(59);function Ge(bt){return 63&bt}function Xe(bt){return bt>>6}const Qe={c:0,lc:0};function at(bt,$t,gn,ai){bt=bt<<8|vr(gn,ai),$t+=8,Qe.c=bt,Qe.lc=$t}const Ke={c:0,lc:0};function Je(bt,$t,gn,ai,mi,yn,li,Ji,fr){if(bt==$t){ai<8&&(at(gn,ai,mi,yn),gn=Qe.c,ai=Qe.lc);let _r=gn>>(ai-=8);if(_r=new Uint8Array([_r])[0],Ji.value+_r>fr)return!1;const hr=li[Ji.value-1];for(;_r-- >0;)li[Ji.value++]=hr}else{if(!(Ji.value<fr))return!1;li[Ji.value++]=bt}Ke.c=gn,Ke.lc=ai}function ft(bt){return 65535&bt}function mt(bt){const $t=ft(bt);return $t>32767?$t-65536:$t}const vt={a:0,b:0};function Qt(bt,$t){const gn=mt(bt),ai=mt($t),mi=gn+(1&ai)+(ai>>1),yn=mi,li=mi-ai;vt.a=yn,vt.b=li}function Ht(bt,$t){const gn=ft(bt),ai=ft($t),mi=gn-(ai>>1)&65535,yn=ai+mi-32768&65535;vt.a=yn,vt.b=mi}function Cn(bt,$t,gn,ai,mi,yn,li){const Ji=li<16384,fr=gn>mi?mi:gn;let _r,hr,Or=1;for(;Or<=fr;)Or<<=1;for(Or>>=1,_r=Or,Or>>=1;Or>=1;){hr=0;const er=hr+yn*(mi-_r),qi=yn*Or,Ir=yn*_r,Ti=ai*Or,cr=ai*_r;let dr,Fr,ao,Us;for(;hr<=er;hr+=Ir){let ar=hr;const zr=hr+ai*(gn-_r);for(;ar<=zr;ar+=cr){const rs=ar+Ti,Ea=ar+qi,Ec=Ea+Ti;Ji?(Qt(bt[ar+$t],bt[Ea+$t]),dr=vt.a,ao=vt.b,Qt(bt[rs+$t],bt[Ec+$t]),Fr=vt.a,Us=vt.b,Qt(dr,Fr),bt[ar+$t]=vt.a,bt[rs+$t]=vt.b,Qt(ao,Us),bt[Ea+$t]=vt.a,bt[Ec+$t]=vt.b):(Ht(bt[ar+$t],bt[Ea+$t]),dr=vt.a,ao=vt.b,Ht(bt[rs+$t],bt[Ec+$t]),Fr=vt.a,Us=vt.b,Ht(dr,Fr),bt[ar+$t]=vt.a,bt[rs+$t]=vt.b,Ht(ao,Us),bt[Ea+$t]=vt.a,bt[Ec+$t]=vt.b)}if(gn&Or){const rs=ar+qi;Ji?Qt(bt[ar+$t],bt[rs+$t]):Ht(bt[ar+$t],bt[rs+$t]),dr=vt.a,bt[rs+$t]=vt.b,bt[ar+$t]=dr}}if(mi&Or){let ar=hr;const zr=hr+ai*(gn-_r);for(;ar<=zr;ar+=cr){const rs=ar+Ti;Ji?Qt(bt[ar+$t],bt[rs+$t]):Ht(bt[ar+$t],bt[rs+$t]),dr=vt.a,bt[rs+$t]=vt.b,bt[ar+$t]=dr}}_r=Or,Or>>=1}return hr}function un(bt,$t,gn,ai,mi,yn){const li=gn.value,Ji=xr($t,gn),fr=xr($t,gn);gn.value+=4;const _r=xr($t,gn);if(gn.value+=4,Ji<0||Ji>=65537||fr<0||fr>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const hr=new Array(65537),Or=new Array(16384);if(function(er){for(let qi=0;qi<16384;qi++)er[qi]={},er[qi].len=0,er[qi].lit=0,er[qi].p=null}(Or),function(er,qi,Ir,Ti,cr,dr){const Fr=qi;let ao=0,Us=0;for(;Ti<=cr;Ti++){if(Fr.value-qi.value>Ir)return!1;Se(6,ao,Us,er,Fr);const ar=be.l;if(ao=be.c,Us=be.lc,dr[Ti]=ar,ar==63){if(Fr.value-qi.value>Ir)throw new Error("Something wrong with hufUnpackEncTable");Se(8,ao,Us,er,Fr);let zr=be.l+6;if(ao=be.c,Us=be.lc,Ti+zr>cr+1)throw new Error("Something wrong with hufUnpackEncTable");for(;zr--;)dr[Ti++]=0;Ti--}else if(ar>=59){let zr=ar-59+2;if(Ti+zr>cr+1)throw new Error("Something wrong with hufUnpackEncTable");for(;zr--;)dr[Ti++]=0;Ti--}}(function(ar){for(let rs=0;rs<=58;++rs)Be[rs]=0;for(let rs=0;rs<65537;++rs)Be[ar[rs]]+=1;let zr=0;for(let rs=58;rs>0;--rs){const Ea=zr+Be[rs]>>1;Be[rs]=zr,zr=Ea}for(let rs=0;rs<65537;++rs){const Ea=ar[rs];Ea>0&&(ar[rs]=Ea|Be[Ea]++<<6)}})(dr)}(bt,gn,ai-(gn.value-li),Ji,fr,hr),_r>8*(ai-(gn.value-li)))throw new Error("Something wrong with hufUncompress");(function(er,qi,Ir,Ti){for(;qi<=Ir;qi++){const cr=Xe(er[qi]),dr=Ge(er[qi]);if(cr>>dr)throw new Error("Invalid table entry");if(dr>14){const Fr=Ti[cr>>dr-14];if(Fr.len)throw new Error("Invalid table entry");if(Fr.lit++,Fr.p){const ao=Fr.p;Fr.p=new Array(Fr.lit);for(let Us=0;Us<Fr.lit-1;++Us)Fr.p[Us]=ao[Us]}else Fr.p=new Array(1);Fr.p[Fr.lit-1]=qi}else if(dr){let Fr=0;for(let ao=1<<14-dr;ao>0;ao--){const Us=Ti[(cr<<14-dr)+Fr];if(Us.len||Us.p)throw new Error("Invalid table entry");Us.len=dr,Us.lit=qi,Fr++}}}})(hr,Ji,fr,Or),function(er,qi,Ir,Ti,cr,dr,Fr,ao,Us){let ar=0,zr=0;const rs=Fr,Ea=Math.trunc(Ti.value+(cr+7)/8);for(;Ti.value<Ea;)for(at(ar,zr,Ir,Ti),ar=Qe.c,zr=Qe.lc;zr>=14;){const Ga=qi[ar>>zr-14&16383];if(Ga.len)zr-=Ga.len,Je(Ga.lit,dr,ar,zr,Ir,Ti,ao,Us,rs),ar=Ke.c,zr=Ke.lc;else{if(!Ga.p)throw new Error("hufDecode issues");let Wp;for(Wp=0;Wp<Ga.lit;Wp++){const f_=Ge(er[Ga.p[Wp]]);for(;zr<f_&&Ti.value<Ea;)at(ar,zr,Ir,Ti),ar=Qe.c,zr=Qe.lc;if(zr>=f_&&Xe(er[Ga.p[Wp]])==(ar>>zr-f_&(1<<f_)-1)){zr-=f_,Je(Ga.p[Wp],dr,ar,zr,Ir,Ti,ao,Us,rs),ar=Ke.c,zr=Ke.lc;break}}if(Wp==Ga.lit)throw new Error("hufDecode issues")}}const Ec=8-cr&7;for(ar>>=Ec,zr-=Ec;zr>0;){const Ga=qi[ar<<14-zr&16383];if(!Ga.len)throw new Error("hufDecode issues");zr-=Ga.len,Je(Ga.lit,dr,ar,zr,Ir,Ti,ao,Us,rs),ar=Ke.c,zr=Ke.lc}}(hr,Or,bt,gn,_r,fr,yn,mi,{value:0})}function rn(bt){for(let $t=1;$t<bt.length;$t++){const gn=bt[$t-1]+bt[$t]-128;bt[$t]=gn}}function Gn(bt,$t){let gn=0,ai=Math.floor((bt.length+1)/2),mi=0;const yn=bt.length-1;for(;!(mi>yn||($t[mi++]=bt[gn++],mi>yn));)$t[mi++]=bt[ai++]}function Fn(bt){let $t=bt.byteLength;const gn=new Array;let ai=0;const mi=new DataView(bt);for(;$t>0;){const yn=mi.getInt8(ai++);if(yn<0){const li=-yn;$t-=li+1;for(let Ji=0;Ji<li;Ji++)gn.push(mi.getUint8(ai++))}else{const li=yn;$t-=2;const Ji=mi.getUint8(ai++);for(let fr=0;fr<li+1;fr++)gn.push(Ji)}}return gn}function di(bt,$t,gn){let ai,mi=1;for(;mi<64;)ai=$t[bt.value],ai==65280?mi=64:ai>>8==255?mi+=255&ai:(gn[mi]=ai,mi++),bt.value++}function bi(bt){const $t=.5*Math.cos(.7853975),gn=.5*Math.cos(3.14159/16),ai=.5*Math.cos(3.14159/8),mi=.5*Math.cos(3*3.14159/16),yn=.5*Math.cos(.981746875),li=.5*Math.cos(3*3.14159/8),Ji=.5*Math.cos(1.374445625),fr=new Array(4),_r=new Array(4),hr=new Array(4),Or=new Array(4);for(let er=0;er<8;++er){const qi=8*er;fr[0]=ai*bt[qi+2],fr[1]=li*bt[qi+2],fr[2]=ai*bt[qi+6],fr[3]=li*bt[qi+6],_r[0]=gn*bt[qi+1]+mi*bt[qi+3]+yn*bt[qi+5]+Ji*bt[qi+7],_r[1]=mi*bt[qi+1]-Ji*bt[qi+3]-gn*bt[qi+5]-yn*bt[qi+7],_r[2]=yn*bt[qi+1]-gn*bt[qi+3]+Ji*bt[qi+5]+mi*bt[qi+7],_r[3]=Ji*bt[qi+1]-yn*bt[qi+3]+mi*bt[qi+5]-gn*bt[qi+7],hr[0]=$t*(bt[qi+0]+bt[qi+4]),hr[3]=$t*(bt[qi+0]-bt[qi+4]),hr[1]=fr[0]+fr[3],hr[2]=fr[1]-fr[2],Or[0]=hr[0]+hr[1],Or[1]=hr[3]+hr[2],Or[2]=hr[3]-hr[2],Or[3]=hr[0]-hr[1],bt[qi+0]=Or[0]+_r[0],bt[qi+1]=Or[1]+_r[1],bt[qi+2]=Or[2]+_r[2],bt[qi+3]=Or[3]+_r[3],bt[qi+4]=Or[3]-_r[3],bt[qi+5]=Or[2]-_r[2],bt[qi+6]=Or[1]-_r[1],bt[qi+7]=Or[0]-_r[0]}for(let er=0;er<8;++er)fr[0]=ai*bt[16+er],fr[1]=li*bt[16+er],fr[2]=ai*bt[48+er],fr[3]=li*bt[48+er],_r[0]=gn*bt[8+er]+mi*bt[24+er]+yn*bt[40+er]+Ji*bt[56+er],_r[1]=mi*bt[8+er]-Ji*bt[24+er]-gn*bt[40+er]-yn*bt[56+er],_r[2]=yn*bt[8+er]-gn*bt[24+er]+Ji*bt[40+er]+mi*bt[56+er],_r[3]=Ji*bt[8+er]-yn*bt[24+er]+mi*bt[40+er]-gn*bt[56+er],hr[0]=$t*(bt[er]+bt[32+er]),hr[3]=$t*(bt[er]-bt[32+er]),hr[1]=fr[0]+fr[3],hr[2]=fr[1]-fr[2],Or[0]=hr[0]+hr[1],Or[1]=hr[3]+hr[2],Or[2]=hr[3]-hr[2],Or[3]=hr[0]-hr[1],bt[0+er]=Or[0]+_r[0],bt[8+er]=Or[1]+_r[1],bt[16+er]=Or[2]+_r[2],bt[24+er]=Or[3]+_r[3],bt[32+er]=Or[3]-_r[3],bt[40+er]=Or[2]-_r[2],bt[48+er]=Or[1]-_r[1],bt[56+er]=Or[0]-_r[0]}function Bi(bt){for(let $t=0;$t<64;++$t){const gn=bt[0][$t],ai=bt[1][$t],mi=bt[2][$t];bt[0][$t]=gn+1.5747*mi,bt[1][$t]=gn-.1873*ai-.4682*mi,bt[2][$t]=gn+1.8556*ai}}function Br(bt,$t,gn){for(let mi=0;mi<64;++mi)$t[gn+mi]=i.A5E.toHalfFloat((ai=bt[mi])<=1?Math.sign(ai)*Math.pow(Math.abs(ai),2.2):Math.sign(ai)*Math.pow(pe,Math.abs(ai)-1));var ai}function lr(bt){return new DataView(bt.array.buffer,bt.offset.value,bt.size)}function tr(bt){const $t=bt.viewer.buffer.slice(bt.offset.value,bt.offset.value+bt.size),gn=new Uint8Array(Fn($t)),ai=new Uint8Array(gn.length);return rn(gn),Gn(gn,ai),new DataView(ai.buffer)}function vn(bt){const $t=Cg(bt.array.slice(bt.offset.value,bt.offset.value+bt.size)),gn=new Uint8Array($t.length);return rn($t),Gn($t,gn),new DataView(gn.buffer)}function zn(bt){const $t=bt.viewer,gn={value:bt.offset.value},ai=new Uint16Array(bt.width*bt.scanlineBlockSize*(bt.channels*bt.type)),mi=new Uint8Array(8192);let yn=0;const li=new Array(bt.channels);for(let Ir=0;Ir<bt.channels;Ir++)li[Ir]={},li[Ir].start=yn,li[Ir].end=li[Ir].start,li[Ir].nx=bt.width,li[Ir].ny=bt.lines,li[Ir].size=bt.type,yn+=li[Ir].nx*li[Ir].ny*li[Ir].size;const Ji=pr($t,gn),fr=pr($t,gn);if(fr>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Ji<=fr)for(let Ir=0;Ir<fr-Ji+1;Ir++)mi[Ir+Ji]=ji($t,gn);const _r=new Uint16Array(65536),hr=function(Ir,Ti){let cr=0;for(let Fr=0;Fr<65536;++Fr)(Fr==0||Ir[Fr>>3]&1<<(7&Fr))&&(Ti[cr++]=Fr);const dr=cr-1;for(;cr<65536;)Ti[cr++]=0;return dr}(mi,_r),Or=xr($t,gn);un(bt.array,$t,gn,Or,ai,yn);for(let Ir=0;Ir<bt.channels;++Ir){const Ti=li[Ir];for(let cr=0;cr<li[Ir].size;++cr)Cn(ai,Ti.start+cr,Ti.nx,Ti.size,Ti.ny,Ti.nx*Ti.size,hr)}(function(Ir,Ti,cr){for(let dr=0;dr<cr;++dr)Ti[dr]=Ir[Ti[dr]]})(_r,ai,yn);let er=0;const qi=new Uint8Array(ai.buffer.byteLength);for(let Ir=0;Ir<bt.lines;Ir++)for(let Ti=0;Ti<bt.channels;Ti++){const cr=li[Ti],dr=cr.nx*cr.size,Fr=new Uint8Array(ai.buffer,cr.end*2,dr*2);qi.set(Fr,er),er+=dr*2,cr.end+=dr}return new DataView(qi.buffer)}function fi(bt){const $t=Cg(bt.array.slice(bt.offset.value,bt.offset.value+bt.size)),gn=bt.lines*bt.channels*bt.width,ai=bt.type==1?new Uint16Array(gn):new Uint32Array(gn);let mi=0,yn=0;const li=new Array(4);for(let Ji=0;Ji<bt.lines;Ji++)for(let fr=0;fr<bt.channels;fr++){let _r=0;switch(bt.type){case 1:li[0]=mi,li[1]=li[0]+bt.width,mi=li[1]+bt.width;for(let hr=0;hr<bt.width;++hr)_r+=$t[li[0]++]<<8|$t[li[1]++],ai[yn]=_r,yn++;break;case 2:li[0]=mi,li[1]=li[0]+bt.width,li[2]=li[1]+bt.width,mi=li[2]+bt.width;for(let hr=0;hr<bt.width;++hr)_r+=$t[li[0]++]<<24|$t[li[1]++]<<16|$t[li[2]++]<<8,ai[yn]=_r,yn++}}return new DataView(ai.buffer)}function br(bt){const $t=bt.viewer,gn={value:bt.offset.value},ai=new Uint8Array(bt.width*bt.lines*(bt.channels*bt.type*2)),mi={version:sn($t,gn),unknownUncompressedSize:sn($t,gn),unknownCompressedSize:sn($t,gn),acCompressedSize:sn($t,gn),dcCompressedSize:sn($t,gn),rleCompressedSize:sn($t,gn),rleUncompressedSize:sn($t,gn),rleRawSize:sn($t,gn),totalAcUncompressedCount:sn($t,gn),totalDcUncompressedCount:sn($t,gn),acCompression:sn($t,gn)};if(mi.version<2)throw new Error("EXRLoader.parse: "+wa.compression+" version "+mi.version+" is unsupported");const yn=new Array;let li=pr($t,gn)-2;for(;li>0;){const Ti=Wr($t.buffer,gn),cr=ji($t,gn),dr=cr>>2&3,Fr=new Int8Array([(cr>>4)-1])[0],ao=ji($t,gn);yn.push({name:Ti,index:Fr,type:ao,compression:dr}),li-=Ti.length+3}const Ji=wa.channels,fr=new Array(bt.channels);for(let Ti=0;Ti<bt.channels;++Ti){const cr=fr[Ti]={},dr=Ji[Ti];cr.name=dr.name,cr.compression=0,cr.decoded=!1,cr.type=dr.pixelType,cr.pLinear=dr.pLinear,cr.width=bt.width,cr.height=bt.lines}const _r={idx:new Array(3)};for(let Ti=0;Ti<bt.channels;++Ti){const cr=fr[Ti];for(let dr=0;dr<yn.length;++dr){const Fr=yn[dr];cr.name==Fr.name&&(cr.compression=Fr.compression,Fr.index>=0&&(_r.idx[Fr.index]=Ti),cr.offset=Ti)}}let hr,Or,er;if(mi.acCompressedSize>0)switch(mi.acCompression){case 0:hr=new Uint16Array(mi.totalAcUncompressedCount),un(bt.array,$t,gn,mi.acCompressedSize,hr,mi.totalAcUncompressedCount);break;case 1:const Ti=Cg(bt.array.slice(gn.value,gn.value+mi.totalAcUncompressedCount));hr=new Uint16Array(Ti.buffer),gn.value+=mi.totalAcUncompressedCount}if(mi.dcCompressedSize>0){const Ti={array:bt.array,offset:gn,size:mi.dcCompressedSize};Or=new Uint16Array(vn(Ti).buffer),gn.value+=mi.dcCompressedSize}mi.rleRawSize>0&&(er=Fn(Cg(bt.array.slice(gn.value,gn.value+mi.rleCompressedSize)).buffer),gn.value+=mi.rleCompressedSize);let qi=0;const Ir=new Array(fr.length);for(let Ti=0;Ti<Ir.length;++Ti)Ir[Ti]=new Array;for(let Ti=0;Ti<bt.lines;++Ti)for(let cr=0;cr<fr.length;++cr)Ir[cr].push(qi),qi+=fr[cr].width*bt.type*2;(function(Ti,cr,dr,Fr,ao,Us){let ar=new DataView(Us.buffer);const zr=dr[Ti.idx[0]].width,rs=dr[Ti.idx[0]].height,Ea=Math.floor(zr/8),Ec=Math.ceil(zr/8),Ga=Math.ceil(rs/8),Wp=zr-8*(Ec-1),f_=rs-8*(Ga-1),lN={value:0},JS=new Array(3),kA=new Array(3),UA=new Array(3),fh=new Array(3),lE=new Array(3);for(let lo=0;lo<3;++lo)lE[lo]=cr[Ti.idx[lo]],JS[lo]=lo<1?0:JS[lo-1]+Ec*Ga,kA[lo]=new Float32Array(64),UA[lo]=new Uint16Array(64),fh[lo]=new Uint16Array(64*Ec);for(let lo=0;lo<Ga;++lo){let p0=8;lo==Ga-1&&(p0=f_);let f0=8;for(let Bs=0;Bs<Ec;++Bs){Bs==Ec-1&&(f0=Wp);for(let Js=0;Js<3;++Js)UA[Js].fill(0),UA[Js][0]=ao[JS[Js]++],di(lN,Fr,UA[Js]),Hi=UA[Js],(Yi=kA[Js])[0]=$n(Hi[0]),Yi[1]=$n(Hi[1]),Yi[2]=$n(Hi[5]),Yi[3]=$n(Hi[6]),Yi[4]=$n(Hi[14]),Yi[5]=$n(Hi[15]),Yi[6]=$n(Hi[27]),Yi[7]=$n(Hi[28]),Yi[8]=$n(Hi[2]),Yi[9]=$n(Hi[4]),Yi[10]=$n(Hi[7]),Yi[11]=$n(Hi[13]),Yi[12]=$n(Hi[16]),Yi[13]=$n(Hi[26]),Yi[14]=$n(Hi[29]),Yi[15]=$n(Hi[42]),Yi[16]=$n(Hi[3]),Yi[17]=$n(Hi[8]),Yi[18]=$n(Hi[12]),Yi[19]=$n(Hi[17]),Yi[20]=$n(Hi[25]),Yi[21]=$n(Hi[30]),Yi[22]=$n(Hi[41]),Yi[23]=$n(Hi[43]),Yi[24]=$n(Hi[9]),Yi[25]=$n(Hi[11]),Yi[26]=$n(Hi[18]),Yi[27]=$n(Hi[24]),Yi[28]=$n(Hi[31]),Yi[29]=$n(Hi[40]),Yi[30]=$n(Hi[44]),Yi[31]=$n(Hi[53]),Yi[32]=$n(Hi[10]),Yi[33]=$n(Hi[19]),Yi[34]=$n(Hi[23]),Yi[35]=$n(Hi[32]),Yi[36]=$n(Hi[39]),Yi[37]=$n(Hi[45]),Yi[38]=$n(Hi[52]),Yi[39]=$n(Hi[54]),Yi[40]=$n(Hi[20]),Yi[41]=$n(Hi[22]),Yi[42]=$n(Hi[33]),Yi[43]=$n(Hi[38]),Yi[44]=$n(Hi[46]),Yi[45]=$n(Hi[51]),Yi[46]=$n(Hi[55]),Yi[47]=$n(Hi[60]),Yi[48]=$n(Hi[21]),Yi[49]=$n(Hi[34]),Yi[50]=$n(Hi[37]),Yi[51]=$n(Hi[47]),Yi[52]=$n(Hi[50]),Yi[53]=$n(Hi[56]),Yi[54]=$n(Hi[59]),Yi[55]=$n(Hi[61]),Yi[56]=$n(Hi[35]),Yi[57]=$n(Hi[36]),Yi[58]=$n(Hi[48]),Yi[59]=$n(Hi[49]),Yi[60]=$n(Hi[57]),Yi[61]=$n(Hi[58]),Yi[62]=$n(Hi[62]),Yi[63]=$n(Hi[63]),bi(kA[Js]);Bi(kA);for(let Js=0;Js<3;++Js)Br(kA[Js],fh[Js],64*Bs)}let ru=0;for(let Bs=0;Bs<3;++Bs){const Js=dr[Ti.idx[Bs]].type;for(let Qp=8*lo;Qp<8*lo+p0;++Qp){ru=lE[Bs][Qp];for(let FA=0;FA<Ea;++FA){const xd=64*FA+8*(7&Qp);ar.setUint16(ru+0*2*Js,fh[Bs][xd+0],!0),ar.setUint16(ru+1*2*Js,fh[Bs][xd+1],!0),ar.setUint16(ru+2*2*Js,fh[Bs][xd+2],!0),ar.setUint16(ru+3*2*Js,fh[Bs][xd+3],!0),ar.setUint16(ru+4*2*Js,fh[Bs][xd+4],!0),ar.setUint16(ru+5*2*Js,fh[Bs][xd+5],!0),ar.setUint16(ru+6*2*Js,fh[Bs][xd+6],!0),ar.setUint16(ru+7*2*Js,fh[Bs][xd+7],!0),ru+=8*2*Js}}if(Ea!=Ec)for(let Qp=8*lo;Qp<8*lo+p0;++Qp){const FA=lE[Bs][Qp]+8*Ea*2*Js,xd=64*Ea+8*(7&Qp);for(let cE=0;cE<f0;++cE)ar.setUint16(FA+cE*2*Js,fh[Bs][xd+cE],!0)}}}var Hi,Yi;const lI=new Uint16Array(zr);ar=new DataView(Us.buffer);for(let lo=0;lo<3;++lo){dr[Ti.idx[lo]].decoded=!0;const p0=dr[Ti.idx[lo]].type;if(dr[lo].type==2)for(let f0=0;f0<rs;++f0){const ru=lE[lo][f0];for(let Bs=0;Bs<zr;++Bs)lI[Bs]=ar.getUint16(ru+Bs*2*p0,!0);for(let Bs=0;Bs<zr;++Bs)ar.setFloat32(ru+Bs*2*p0,$n(lI[Bs]),!0)}}})(_r,Ir,fr,hr,Or,ai);for(let Ti=0;Ti<fr.length;++Ti){const cr=fr[Ti];if(!cr.decoded){if(cr.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let dr=0,Fr=0;for(let ao=0;ao<bt.lines;++ao){let Us=Ir[Ti][dr];for(let ar=0;ar<cr.width;++ar){for(let zr=0;zr<2*cr.type;++zr)ai[Us++]=er[Fr+zr*cr.width*cr.height];Fr++}dr++}}}}return new DataView(ai.buffer)}function Wr(bt,$t){const gn=new Uint8Array(bt);let ai=0;for(;gn[$t.value+ai]!=0;)ai+=1;const mi=new TextDecoder().decode(gn.slice($t.value,$t.value+ai));return $t.value=$t.value+ai+1,mi}function Rr(bt,$t){const gn=bt.getInt32($t.value,!0);return $t.value=$t.value+4,gn}function xr(bt,$t){const gn=bt.getUint32($t.value,!0);return $t.value=$t.value+4,gn}function vr(bt,$t){const gn=bt[$t.value];return $t.value=$t.value+1,gn}function ji(bt,$t){const gn=bt.getUint8($t.value);return $t.value=$t.value+1,gn}const sn=function(bt,$t){let gn;return gn="getBigInt64"in DataView.prototype?Number(bt.getBigInt64($t.value,!0)):bt.getUint32($t.value+4,!0)+Number(bt.getUint32($t.value,!0)<<32),$t.value+=8,gn};function pi(bt,$t){const gn=bt.getFloat32($t.value,!0);return $t.value+=4,gn}function Xi(bt,$t){return i.A5E.toHalfFloat(pi(bt,$t))}function $n(bt){const $t=(31744&bt)>>10,gn=1023&bt;return(bt>>15?-1:1)*($t?$t===31?gn?NaN:1/0:Math.pow(2,$t-15)*(1+gn/1024):gn/1024*6103515625e-14)}function pr(bt,$t){const gn=bt.getUint16($t.value,!0);return $t.value+=2,gn}function Gs(bt,$t){return $n(pr(bt,$t))}function oo(bt,$t,gn,ai,mi){return ai==="string"||ai==="stringvector"||ai==="iccProfile"?function(yn,li,Ji){const fr=new TextDecoder().decode(new Uint8Array(yn).slice(li.value,li.value+Ji));return li.value=li.value+Ji,fr}($t,gn,mi):ai==="chlist"?function(yn,li,Ji,fr){const _r=Ji.value,hr=[];for(;Ji.value<_r+fr-1;){const Or=Wr(li,Ji),er=Rr(yn,Ji),qi=ji(yn,Ji);Ji.value+=3;const Ir=Rr(yn,Ji),Ti=Rr(yn,Ji);hr.push({name:Or,pixelType:er,pLinear:qi,xSampling:Ir,ySampling:Ti})}return Ji.value+=1,hr}(bt,$t,gn,mi):ai==="chromaticities"?function(yn,li){return{redX:pi(yn,li),redY:pi(yn,li),greenX:pi(yn,li),greenY:pi(yn,li),blueX:pi(yn,li),blueY:pi(yn,li),whiteX:pi(yn,li),whiteY:pi(yn,li)}}(bt,gn):ai==="compression"?function(yn,li){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][ji(yn,li)]}(bt,gn):ai==="box2i"?function(yn,li){return{xMin:xr(yn,li),yMin:xr(yn,li),xMax:xr(yn,li),yMax:xr(yn,li)}}(bt,gn):ai==="lineOrder"?function(yn,li){return["INCREASING_Y"][ji(yn,li)]}(bt,gn):ai==="float"?pi(bt,gn):ai==="v2f"?function(yn,li){return[pi(yn,li),pi(yn,li)]}(bt,gn):ai==="v3f"?function(yn,li){return[pi(yn,li),pi(yn,li),pi(yn,li)]}(bt,gn):ai==="int"?Rr(bt,gn):ai==="rational"?function(yn,li){return[Rr(yn,li),xr(yn,li)]}(bt,gn):ai==="timecode"?function(yn,li){return[xr(yn,li),xr(yn,li)]}(bt,gn):ai==="preview"?(gn.value+=mi,"skipped"):void(gn.value+=mi)}const Lo=new DataView(e),ja=new Uint8Array(e),ll={value:0},wa=function(bt,$t,gn){const ai={};if(bt.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");ai.version=bt.getUint8(4);const mi=bt.getUint8(5);ai.spec={singleTile:!!(2&mi),longName:!!(4&mi),deepFormat:!!(8&mi),multiPart:!!(16&mi)},gn.value=8;let yn=!0;for(;yn;){const li=Wr($t,gn);if(li==0)yn=!1;else{const Ji=Wr($t,gn),fr=oo(bt,$t,gn,Ji,xr(bt,gn));fr===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Ji}'.`):ai[li]=fr}}if(-5&mi)throw console.error("EXRHeader:",ai),new Error("THREE.EXRLoader: provided file is currently unsupported.");return ai}(Lo,e,ll),Mr=function(bt,$t,gn,ai,mi){const yn={size:0,viewer:$t,array:gn,offset:ai,width:bt.dataWindow.xMax-bt.dataWindow.xMin+1,height:bt.dataWindow.yMax-bt.dataWindow.yMin+1,channels:bt.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:bt.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:i.GUF};switch(bt.compression){case"NO_COMPRESSION":yn.lines=1,yn.uncompress=lr;break;case"RLE_COMPRESSION":yn.lines=1,yn.uncompress=tr;break;case"ZIPS_COMPRESSION":yn.lines=1,yn.uncompress=vn;break;case"ZIP_COMPRESSION":yn.lines=16,yn.uncompress=vn;break;case"PIZ_COMPRESSION":yn.lines=32,yn.uncompress=zn;break;case"PXR24_COMPRESSION":yn.lines=16,yn.uncompress=fi;break;case"DWAA_COMPRESSION":yn.lines=32,yn.uncompress=br;break;case"DWAB_COMPRESSION":yn.lines=256,yn.uncompress=br;break;default:throw new Error("EXRLoader.parse: "+bt.compression+" is unsupported")}if(yn.scanlineBlockSize=yn.lines,yn.type==1)switch(mi){case i.VzW:yn.getter=Gs,yn.inputSize=2;break;case i.cLu:yn.getter=pr,yn.inputSize=2}else{if(yn.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+yn.type+" for "+bt.compression+".");switch(mi){case i.VzW:yn.getter=pi,yn.inputSize=4;break;case i.cLu:yn.getter=Xi,yn.inputSize=4}}yn.blockCount=(bt.dataWindow.yMax+1)/yn.scanlineBlockSize;for(let Ji=0;Ji<yn.blockCount;Ji++)sn($t,ai);yn.outputChannels=yn.channels==3?4:yn.channels;const li=yn.width*yn.height*yn.outputChannels;switch(mi){case i.VzW:yn.byteArray=new Float32Array(li),yn.channels<yn.outputChannels&&yn.byteArray.fill(1,0,li);break;case i.cLu:yn.byteArray=new Uint16Array(li),yn.channels<yn.outputChannels&&yn.byteArray.fill(15360,0,li);break;default:console.error("THREE.EXRLoader: unsupported type: ",mi)}return yn.bytesPerLine=yn.width*yn.inputSize*yn.channels,yn.outputChannels==4?(yn.format=i.wk1,yn.colorSpace=i.GUF):(yn.format=i.hEm,yn.colorSpace=i.aCh),yn}(wa,Lo,ja,ll,this.type),$l={value:0},Hp={R:0,G:1,B:2,A:3,Y:0};for(let bt=0;bt<Mr.height/Mr.scanlineBlockSize;bt++){const $t=xr(Lo,ll);Mr.size=xr(Lo,ll),Mr.lines=$t+Mr.scanlineBlockSize>Mr.height?Mr.height-$t:Mr.scanlineBlockSize;const gn=Mr.size<Mr.lines*Mr.bytesPerLine?Mr.uncompress(Mr):lr(Mr);ll.value+=Mr.size;for(let ai=0;ai<Mr.scanlineBlockSize;ai++){const mi=ai+bt*Mr.scanlineBlockSize;if(mi>=Mr.height)break;for(let yn=0;yn<Mr.channels;yn++){const li=Hp[wa.channels[yn].name];for(let Ji=0;Ji<Mr.width;Ji++){$l.value=(ai*(Mr.channels*Mr.width)+yn*Mr.width+Ji)*Mr.inputSize;const fr=(Mr.height-1-mi)*(Mr.width*Mr.outputChannels)+Ji*Mr.outputChannels+li;Mr.byteArray[fr]=Mr.getter(gn,$l)}}}}return{header:wa,width:Mr.width,height:Mr.height,data:Mr.byteArray,format:Mr.format,colorSpace:Mr.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,s){return super.load(e,function(l,c){l.colorSpace=c.colorSpace,l.minFilter=i.wem,l.magFilter=i.wem,l.generateMipmaps=!1,l.flipY=!1,t&&t(l,c)},n,s)}}class s1 extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[ri]}async onAdded(e){var t,n;this._importer||(this._importer=new Ms(class extends wI{constructor(s){super(s),this.setDataType(Hr(e.renderer.rendererObject))}},["exr"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}s1.PluginType="EXRLoadPlugin";const o1=new WeakMap;class EI extends i.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const l=new i.hH6(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),this.url=e,l.load(e,c=>{if(o1.has(c))return o1.get(c).promise.then(t).catch(s);this.decodeObjects(c,e).then(f=>{f.userData.warnings=this.warnings,this.warnings=[],t(f)}).catch(f=>s(f))},n,s)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let n,s;const l=e.byteLength,c=this._getWorker(l).then(f=>(n=f,s=this.workerNextTaskID++,new Promise((g,y)=>{n._callbacks[s]={resolve:g,reject:y},n.postMessage({type:"decode",id:s,buffer:e},[e])}))).then(f=>this._createGeometry(f.data)).catch(f=>{throw f});return c.catch(()=>!0).then(()=>{n&&s&&this._releaseTask(n,s)}),o1.set(e,{url:t,promise:c}),c}parse(e,t,n){this.decodeObjects(e,"").then(s=>{s.userData.warnings=this.warnings,t(s)}).catch(s=>n(s))}_compareMaterials(e){if(this.materials.includes(e))return e;const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;const n=JSON.stringify(t);for(let s=0;s<this.materials.length;s++){const l=this.materials[s],c={};if(c.name=l.name,c.color={},c.color.r=l.color.r,c.color.g=l.color.g,c.color.b=l.color.b,c.type=l.type,JSON.stringify(c)===n)return l}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new i.Wid({color:new i.Ilk(1,1,1),metalness:.8,name:"default",side:i.ehD});const t=e.diffuseColor,n=new i.Ilk(t.r/255,t.g/255,t.b/255);t.r===0&&t.g===0&&t.b===0&&(n.r=1,n.g=1,n.b=1);const s=new i.Wid({color:n,name:e.name,side:i.ehD,transparent:e.transparency>0,opacity:1-e.transparency}),l=new i.dpR;for(let c=0;c<e.textures.length;c++){const f=e.textures[c];if(f.image!==null){const g=l.load(f.image);switch(f.type){case"Diffuse":s.map=g;break;case"Bump":s.bumpMap=g;break;case"Transparency":s.alphaMap=g,s.transparent=!0;break;case"Emap":s.envMap=g}g.wrapS=f.wrapU===0?i.rpg:i.uWy,g.wrapT=f.wrapV===0?i.rpg:i.uWy,g.repeat.set(f.repeat[0],f.repeat[1])}}return s}_createGeometry(e){const t=new i.Tme,n=[],s=[],l=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.strings=e.strings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let c=e.objects;const f=e.materials;for(let g=0;g<c.length;g++){const y=c[g],x=y.attributes;switch(y.objectType){case"InstanceDefinition":s.push(y);break;case"InstanceReference":l.push(y);break;default:let S;if(x.materialIndex>=0){const L=f[x.materialIndex];let B=this._createMaterial(L);B=this._compareMaterials(B),S=this._createObject(y,B)}else{const L=this._createMaterial();S=this._createObject(y,L)}if(S===void 0)continue;const C=e.layers[x.layerIndex];S.visible=!C||C.visible,x.isInstanceDefinitionObject?n.push(S):t.add(S)}}for(let g=0;g<s.length;g++){const y=s[g];c=[];for(let x=0;x<y.attributes.objectIds.length;x++){const S=y.attributes.objectIds[x];for(let C=0;C<n.length;C++)S===n[C].userData.attributes.id&&c.push(n[C])}for(let x=0;x<l.length;x++){const S=l[x];if(S.geometry.parentIdefId===y.attributes.id){const C=S.geometry.xform.array,L=new i.yGw;if(L.set(...C),c.length===1){const B=c[0].clone(!0);if(B.name=S.attributes.name||B.name,B.applyMatrix4(L),S.attributes.materialIndex>=0&&S.attributes.materialIndex!==c[0].userData.attributes.materialIndex){const W=f[S.attributes.materialIndex],q=this._createMaterial(W);B.material=this._compareMaterials(q)}if(B.userData.defAttributes=B.userData.attributes,B.userData.defObjectType=B.userData.objectType,B.userData.attributes={...B.userData.attributes,...S.attributes},B.userData.objectType=S.objectType,S.attributes.layerIndex!==void 0){const W=e.layers[S.attributes.layerIndex];B.visible=W?W.visible:B.visible}t.add(B)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const B=new i.Tme;for(let W=0;W<c.length;W++)B.add(c[W].clone(!0));t.add(B)}}}}return t.userData.materials=this.materials,t}_createObject(e,t){const n=new i.s4_,s=e.attributes;let l,c,f,g;switch(e.objectType){case"Point":case"PointSet":l=n.parse(e.geometry),l.attributes.hasOwnProperty("color")?c=new i.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(f=s.drawColor,g=new i.Ilk(f.r/255,f.g/255,f.b/255),c=new i.UY4({color:g,sizeAttenuation:!1,size:2})),c=this._compareMaterials(c);const y=new i.woe(l,c);return y.userData.attributes=s,y.userData.objectType=e.objectType,s.name&&(y.name=s.name),y;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;l=n.parse(e.geometry),l.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),t===null&&(t=this._createMaterial(),t=this._compareMaterials(t));const x=new i.Kj0(l,t);return x.castShadow=s.castsShadows,x.receiveShadow=s.receivesShadows,x.userData.attributes=s,x.userData.objectType=e.objectType,s.name&&(x.name=s.name,l.name=s.name),x;case"Curve":l=n.parse(e.geometry),f=s.drawColor,g=new i.Ilk(f.r/255,f.g/255,f.b/255),c=new i.nls({color:g}),c=this._compareMaterials(c);const S=new i.x12(l,c);return S.userData.attributes=s,S.userData.objectType=e.objectType,s.name&&(S.name=s.name),S;case"TextDot":l=e.geometry;const C=document.createElement("canvas").getContext("2d"),L=`${l.fontHeight}px ${l.fontFace}`;C.font=L;const B=C.measureText(l.text).width+10,W=l.fontHeight+10,q=window.devicePixelRatio;C.canvas.width=B*q,C.canvas.height=W*q,C.canvas.style.width=B+"px",C.canvas.style.height=W+"px",C.setTransform(q,0,0,q,0,0),C.font=L,C.textBaseline="middle",C.textAlign="center",g=s.drawColor,C.fillStyle=`rgba(${g.r},${g.g},${g.b},${g.a})`,C.fillRect(0,0,B,W),C.fillStyle="white",C.fillText(l.text,B/2,W/2);const Z=new i.ROQ(C.canvas);Z.minFilter=i.wem,Z.wrapS=i.uWy,Z.wrapT=i.uWy,c=new i.xeV({map:Z,depthTest:!1});const j=new i.jyi(c);return j.position.set(l.point[0],l.point[1],l.point[2]),j.scale.set(B/10,W/10,1),j.userData.attributes=s,j.userData.objectType=e.objectType,s.name&&(j.name=s.name),j;case"Light":let F;switch(l=e.geometry,l.lightStyle.name){case"LightStyle_WorldPoint":F=new i.cek,F.castShadow=s.castsShadows,F.position.set(l.location[0],l.location[1],l.location[2]),F.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":F=new i.PMe,F.castShadow=s.castsShadows,F.position.set(l.location[0],l.location[1],l.location[2]),F.target.position.set(l.direction[0],l.direction[1],l.direction[2]),F.angle=l.spotAngleRadians,F.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":F=new i.T_f;const se=Math.abs(l.width[2]),pe=Math.abs(l.length[0]);F.position.set(l.location[0]-pe/2,l.location[1],l.location[2]-se/2),F.height=pe,F.width=se,F.lookAt(l.direction[0],l.direction[1],l.direction[2]);break;case"LightStyle_WorldDirectional":F=new i.Ox3,F.castShadow=s.castsShadows,F.position.set(l.location[0],l.location[1],l.location[2]),F.target.position.set(l.direction[0],l.direction[1],l.direction[2]),F.shadow.normalBias=.1}return F&&(F.intensity=l.intensity,f=l.diffuse,g=new i.Ilk(f.r/255,f.g/255,f.b/255),F.color=g,F.userData.attributes=s,F.userData.objectType=e.objectType),F}}_initLibrary(){if(!this.libraryPending){const e=new i.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise((l,c)=>{e.load("rhino3dm.js",l,void 0,c)}),n=new i.hH6(this.manager);n.setPath(this.libraryPath),n.setResponseType("arraybuffer");const s=new Promise((l,c)=>{n.load("rhino3dm.wasm",l,void 0,c)});this.libraryPending=Promise.all([t,s]).then(([l,c])=>{this.libraryConfig.wasmBinary=c;const f=SI,g=["/* rhino3dm.js */",l,"/* worker */",f.substring(f.indexOf("{")+1,f.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([g]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",libraryConfig:this.libraryConfig}),n.onmessage=s=>{const l=s.data;switch(l.type){case"warning":this.warnings.push(l.data),console.warn(l.data);break;case"decode":n._callbacks[l.id].resolve(l);break;case"error":n._callbacks[l.id].reject(l);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+l.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,s){return n._taskLoad>s._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const SI=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				// console.log(message)
				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count(); i ++ ) {

			const _material = doc.materials().get( i );
			const _pbrMaterial = _material.physicallyBased();

			let material = extractProperties( _material );

			const textures = [];

			for ( let j = 0; j < textureTypes.length; j ++ ) {

				const _texture = _material.getTexture( textureTypes[ j ] );
				if ( _texture ) {

					let textureType = textureTypes[ j ].constructor.name;
					textureType = textureType.substring( 12, textureType.length );
					const texture = { type: textureType };

					const image = doc.getEmbeddedFileAsBase64( _texture.fileName );

					texture.wrapU = _texture.wrapU;
					texture.wrapV = _texture.wrapV;
					texture.wrapW = _texture.wrapW;
					const uvw = _texture.uvwTransform.toFloatArray( true );
					texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

					if ( image ) {

						texture.image = 'data:image/png;base64,' + image;

					} else {

						self.postMessage( { type: 'warning', id: taskID, data: {
							message: \`THREE.3DMLoader: Image for \${textureType} texture not embedded in file.\`,
							type: 'missing resource'
						}

						} );

						texture.image = null;

					}

					textures.push( texture );

					_texture.delete();

				}

			}

			material.textures = textures;

			if ( _pbrMaterial.supported ) {

				for ( let j = 0; j < pbrTextureTypes.length; j ++ ) {

					const _texture = _material.getTexture( pbrTextureTypes[ j ] );
					if ( _texture ) {

						const image = doc.getEmbeddedFileAsBase64( _texture.fileName );
						let textureType = pbrTextureTypes[ j ].constructor.name;
						textureType = textureType.substring( 12, textureType.length );
						const texture = { type: textureType, image: 'data:image/png;base64,' + image };
						textures.push( texture );

						_texture.delete();

					}

				}

				const pbMaterialProperties = extractProperties( _material.physicallyBased() );

				material = Object.assign( pbMaterialProperties, material );

			}

			materials.push( material );

			_material.delete();
			_pbrMaterial.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count(); i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count(); i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count(); i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count(); i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		//console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count();

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings };

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`;class id extends EI{constructor(e){super(e),this.materials=[],this.setLibraryPath(id.LIBRARY_PATH)}_createMaterial(e){return id.ImportMaterials?super._createMaterial(e):this.materials[0]||new i.Wid({color:new i.Ilk(1,1,1),metalness:.8,name:"default",side:i.ehD})}async loadAsync(e,t){const n=await super.loadAsync(e,t);n.rotateX(-Math.PI/2),n.userData.materials&&delete n.userData.materials;const s=n.userData.layers;return n.traverse(l=>{var x,S,C,L;const c=(x=l.userData.attributes)==null?void 0:x.castsShadows,f=(S=l.userData.attributes)==null?void 0:S.receivesShadows;l.castShadow=c,l.receiveShadow=f;const g=((C=l.userData.attributes)==null?void 0:C.layerIndex)??((L=l.userData.defAttributes)==null?void 0:L.layerIndex),y=s[g];y&&(l.userData.rhinoLayer=y),l.userData.rhino3dmRoot=n.uuid,this._useInstancedMesh(l),this._useMaterialSource(l,y)}),this.materials=[],n}_useMaterialSource(e,t){var s,l,c,f,g;if(!id.ImportMaterials)return;const n=e;if(((s=n.material)==null?void 0:s.name)==="default"){const y=((l=n.userData.attributes)==null?void 0:l.materialSource)||((c=n.userData.defAttributes)==null?void 0:c.materialSource),x=((f=n.userData.attributes)==null?void 0:f.colorSource)||((g=n.userData.defAttributes)==null?void 0:g.colorSource);if(!y&&!x)return;(y==null?void 0:y.value)===0||(y==null?void 0:y.value)===1&&(x==null?void 0:x.value)===0?t&&(n.material=this._compareMaterials(this._createMaterial({diffuseColor:t.color,name:t.name,transparency:0,textures:[]}))):(y==null?void 0:y.value)===3||(y==null?void 0:y.value)===1&&(x==null?void 0:x.value)===3?n.traverseAncestors(S=>{S!=null&&S.material&&(n.material=S.material)}):y&&y.value!==1&&console.warn("Unknown material source",y,n,n.userData.attributes)}}_useInstancedMesh(e){if(!id.ReplaceWithInstancedMesh||e.children.length<=0)return;const t=e.children,n=t.map(l=>l.geometry);n.filter((l,c)=>n.indexOf(l)===c).forEach(l=>{var g;const c=t.filter(y=>y.geometry===l),f=c.length>0?c.filter(y=>y.material===c[0].material):[];if(f.length>1){const y=new i.SPe(l,f[0].material,f.length);y.userData={...f[0].userData},y.userData.instanceUserData=[],y.userData.attributes=y.userData.defAttributes||y.userData.attributes,y.userData.defAttributes&&delete y.userData.defAttributes,y.name=((g=y.userData.attributes)==null?void 0:g.name)||f[0].name,f.forEach((x,S)=>{y.setMatrixAt(S,x.matrix),e.remove(x),y.userData.instanceUserData.push(x.userData)}),e.add(y)}})}}id.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",id.ImportMaterials=!0,id.ReplaceWithInstancedMesh=!1;class a1 extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[ri],this._importer=new Ms(id,["3dm"],!0)}async onAdded(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1)}}a1.PluginType="Rhino3dmLoadPlugin";class l1 extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[ri]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}l1.PluginType="GLTFMeshOptPlugin";class TI extends i.aNw{constructor(e){super(e)}load(e,t,n,s){const l=this,c=new i.hH6(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(f){try{t(l.parse(f))}catch(g){s?s(g):console.error(g),l.manager.itemError(e)}},n,s)}parse(e){function t(l,c,f){for(let g=0,y=l.length;g<y;g++)if(l[g]!==c.getUint8(f+g))return!1;return!0}const n=function(l){if(typeof l=="string"){const c=new Uint8Array(l.length);for(let f=0;f<l.length;f++)c[f]=255&l.charCodeAt(f);return c.buffer||c}return l}(e);return function(l){const c=new DataView(l);if(84+50*c.getUint32(80,!0)===c.byteLength)return!0;const f=[115,111,108,105,100];for(let g=0;g<5;g++)if(t(f,c,g))return!1;return!0}(n)?function(l){const c=new DataView(l),f=c.getUint32(80,!0);let g,y,x,S,C,L,B,W,q=!1;for(let se=0;se<70;se++)c.getUint32(se,!1)==1129270351&&c.getUint8(se+4)==82&&c.getUint8(se+5)==61&&(q=!0,S=new Float32Array(3*f*3),C=c.getUint8(se+6)/255,L=c.getUint8(se+7)/255,B=c.getUint8(se+8)/255,W=c.getUint8(se+9)/255);const Z=new i.u9r,j=new Float32Array(3*f*3),F=new Float32Array(3*f*3);for(let se=0;se<f;se++){const pe=84+50*se,be=c.getFloat32(pe,!0),Se=c.getFloat32(pe+4,!0),Be=c.getFloat32(pe+8,!0);if(q){const Ge=c.getUint16(pe+48,!0);32768&Ge?(g=C,y=L,x=B):(g=(31&Ge)/31,y=(Ge>>5&31)/31,x=(Ge>>10&31)/31)}for(let Ge=1;Ge<=3;Ge++){const Xe=pe+12*Ge,Qe=3*se*3+3*(Ge-1);j[Qe]=c.getFloat32(Xe,!0),j[Qe+1]=c.getFloat32(Xe+4,!0),j[Qe+2]=c.getFloat32(Xe+8,!0),F[Qe]=be,F[Qe+1]=Se,F[Qe+2]=Be,q&&(S[Qe]=g,S[Qe+1]=y,S[Qe+2]=x)}}return Z.setAttribute("position",new i.TlE(j,3)),Z.setAttribute("normal",new i.TlE(F,3)),q&&(Z.setAttribute("color",new i.TlE(S,3)),Z.hasColors=!0,Z.alpha=W),Z}(n):function(l){const c=new i.u9r,f=/solid([\s\S]*?)endsolid/g,g=/facet([\s\S]*?)endfacet/g;let y=0;const x=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,S=new RegExp("vertex"+x+x+x,"g"),C=new RegExp("normal"+x+x+x,"g"),L=[],B=[],W=new i.Pa4;let q,Z=0,j=0,F=0;for(;(q=f.exec(l))!==null;){j=F;const se=q[0];for(;(q=g.exec(se))!==null;){let Se=0,Be=0;const Ge=q[0];for(;(q=C.exec(Ge))!==null;)W.x=parseFloat(q[1]),W.y=parseFloat(q[2]),W.z=parseFloat(q[3]),Be++;for(;(q=S.exec(Ge))!==null;)L.push(parseFloat(q[1]),parseFloat(q[2]),parseFloat(q[3])),B.push(W.x,W.y,W.z),Se++,F++;Be!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+y),Se!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+y),y++}const pe=j,be=F-j;c.addGroup(pe,be,Z),Z++}return c.setAttribute("position",new i.a$l(L,3)),c.setAttribute("normal",new i.a$l(B,3)),c}(typeof(s=e)!="string"?new TextDecoder().decode(s):s);var s}}class c1 extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[ri]}async onAdded(e){var t,n;this._importer||(this._importer=new Ms(TI,["stl"],!0)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}c1.PluginType="STLLoadPlugin";class MI extends i.DqL{constructor(e){super(e)}parse(e,t){const n=new CI(e,1);return{mipmaps:n.mipmaps(t),width:n.pixelWidth,height:n.pixelHeight,format:n.glInternalFormat,isCubemap:n.numberOfFaces===6,mipmapCount:n.numberOfMipmapLevels}}}class CI{constructor(e,t){this.arrayBuffer=e;const n=new Uint8Array(this.arrayBuffer,0,12);if(n[0]!==171||n[1]!==75||n[2]!==84||n[3]!==88||n[4]!==32||n[5]!==49||n[6]!==49||n[7]!==187||n[8]!==13||n[9]!==10||n[10]!==26||n[11]!==10)return void console.error("texture missing KTX identifier");const s=Uint32Array.BYTES_PER_ELEMENT,l=new DataView(this.arrayBuffer,12,13*s),c=l.getUint32(0,!0)===67305985;this.glType=l.getUint32(1*s,c),this.glTypeSize=l.getUint32(2*s,c),this.glFormat=l.getUint32(3*s,c),this.glInternalFormat=l.getUint32(4*s,c),this.glBaseInternalFormat=l.getUint32(5*s,c),this.pixelWidth=l.getUint32(6*s,c),this.pixelHeight=l.getUint32(7*s,c),this.pixelDepth=l.getUint32(8*s,c),this.numberOfArrayElements=l.getUint32(9*s,c),this.numberOfFaces=l.getUint32(10*s,c),this.numberOfMipmapLevels=l.getUint32(11*s,c),this.bytesOfKeyValueData=l.getUint32(12*s,c),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let n=64+this.bytesOfKeyValueData,s=this.pixelWidth,l=this.pixelHeight;const c=e?this.numberOfMipmapLevels:1;for(let f=0;f<c;f++){const g=new Int32Array(this.arrayBuffer,n,1)[0];n+=4;for(let y=0;y<this.numberOfFaces;y++){const x=new Uint8Array(this.arrayBuffer,n,g);t.push({data:x,width:s,height:l}),n+=g,n+=3-(g+3)%4}s=Math.max(1,.5*s),l=Math.max(1,.5*l)}return t}}class u1 extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[ri]}async onAdded(e){var t,n;this._importer||(this._importer=new Ms(MI,["ktx"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}u1.PluginType="KTXLoadPlugin";class RI extends i.hH6{constructor(e){super(e),this.responseType="blob"}}class fT extends i.hH6{constructor(e){super(e),this.responseType="blob"}load(e,t,n,s){return super.load(e,l=>{try{t==null||t((0,r.blobToDataURL)(l))}catch(c){s==null||s(c)}},n,s)}}class mT{async parseAsync(e,t){return new Blob([JSON.stringify(e,null,t.jsonSpaces??2)],{type:"application/json"})}}class gT{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}const _T={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class dx{constructor(){this.pluginCallbacks=[],this.register(function(e){return new PI(e)}),this.register(function(e){return new DI(e)}),this.register(function(e){return new OI(e)}),this.register(function(e){return new NI(e)}),this.register(function(e){return new kI(e)}),this.register(function(e){return new UI(e)}),this.register(function(e){return new LI(e)}),this.register(function(e){return new BI(e)}),this.register(function(e){return new FI(e)}),this.register(function(e){return new zI(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s,l){const c=l||new xT,f=[];for(let g=0,y=this.pluginCallbacks.length;g<y;g++)f.push(this.pluginCallbacks[g](c));c.setPlugins(f),c.write(e,t,s).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(s,l){n.parse(e,s,l,t)})}}const h1=5120,d1=5121,p1=5122,f1=5123,m1="KHR_mesh_quantization",Jc={};Jc[i.TyD]=9728,Jc[i.YLQ]=9984,Jc[i.aH4]=9986,Jc[i.wem]=9729,Jc[i.qyh]=9985,Jc[i.D1R]=9987,Jc[i.uWy]=33071,Jc[i.rpg]=10497,Jc[i.OoA]=33648;const vT={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},II=new i.Ilk;function Fy(a,e){return a.length===e.length&&a.every(function(t,n){return t===e[n]})}function yT(a){return 4*Math.ceil(a/4)}function px(a,e=0){const t=yT(a.byteLength);if(t!==a.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(a)),e!==0)for(let s=a.byteLength;s<t;s++)n[s]=e;return n.buffer}return a}function AT(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function bT(a,e){if(a.toBlob!==void 0)return new Promise(n=>a.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),a.convertToBlob({type:e,quality:t})}class xT{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,l=s.buffers,c=s.json;n=s.options;const f=s.extensionsUsed,g=s.extensionsRequired,y=new Blob(l,{type:"application/octet-stream"}),x=Object.keys(f),S=Object.keys(g);if(x.length>0&&(c.extensionsUsed=x),S.length>0&&(c.extensionsRequired=S),c.buffers&&c.buffers.length>0&&(c.buffers[0].byteLength=y.size),n.binary===!0){const C=new FileReader;C.readAsArrayBuffer(y),C.onloadend=function(){const L=px(C.result),B=new DataView(new ArrayBuffer(8));B.setUint32(0,L.byteLength,!0),B.setUint32(4,5130562,!0);const W=px((q=JSON.stringify(c),new TextEncoder().encode(q).buffer),32);var q;const Z=new DataView(new ArrayBuffer(8));Z.setUint32(0,W.byteLength,!0),Z.setUint32(4,1313821514,!0);const j=new ArrayBuffer(12),F=new DataView(j);F.setUint32(0,1179937895,!0),F.setUint32(4,2,!0);const se=12+Z.byteLength+W.byteLength+B.byteLength+L.byteLength;F.setUint32(8,se,!0);const pe=new Blob([j,Z,W,B,L],{type:"application/octet-stream"}),be=new FileReader;be.readAsArrayBuffer(pe),be.onloadend=function(){t(be.result)}}}else if(c.buffers&&c.buffers.length>0){const C=new FileReader;C.readAsDataURL(y),C.onloadend=function(){const L=C.result;c.buffers[0].uri=L,t(c)}}else t(c)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,s=this.extensionsUsed;try{const l=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&l.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const c in l.gltfExtensions)t.extensions[c]=l.gltfExtensions[c],s[c]=!0;delete l.gltfExtensions}Object.keys(l).length>0&&(t.extras=l)}catch(l){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+l.message),console.warn({...e.userData})}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new i.Pa4;for(let n=0,s=e.count;n<s;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),s=new i.Pa4;for(let l=0,c=n.count;l<c;l++)s.fromBufferAttribute(n,l),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),n.setXYZ(l,s.x,s.y,s.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const s={};t.offset.x===0&&t.offset.y===0||(s.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(s.rotation=t.rotation,n=!0),t.repeat.x===1&&t.repeat.y===1||(s.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(C){return C.colorSpace===i.KI_?function(L){return L<.04045?.0773993808*L:Math.pow(.9478672986*L+.0521327014,2.4)}:function(L){return L}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const s=e?e.image:null,l=t?t.image:null,c=Math.max(s?s.width:0,l?l.width:0),f=Math.max(s?s.height:0,l?l.height:0),g=AT();g.width=c,g.height=f;const y=g.getContext("2d");y.fillStyle="#00ffff",y.fillRect(0,0,c,f);const x=y.getImageData(0,0,c,f);if(s){y.drawImage(s,0,0,c,f);const C=n(e),L=y.getImageData(0,0,c,f).data;for(let B=2;B<L.length;B+=4)x.data[B]=256*C(L[B]/256)}if(l){y.drawImage(l,0,0,c,f);const C=n(t),L=y.getImageData(0,0,c,f).data;for(let B=1;B<L.length;B+=4)x.data[B]=256*C(L[B]/256)}y.putImageData(x,0,0);const S=(e||t).clone();return S.source=new i.Hw6(g),S.colorSpace=i.aCh,S.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),S}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,s,l){const c=this.json;let f;switch(c.bufferViews||(c.bufferViews=[]),t){case h1:case d1:f=1;break;case p1:case f1:f=2;break;default:f=4}const g=yT(s*e.itemSize*f),y=new DataView(new ArrayBuffer(g));let x=0;for(let C=n;C<n+s;C++)for(let L=0;L<e.itemSize;L++){let B;e.itemSize>4?B=e.array[C*e.itemSize+L]:(L===0?B=e.getX(C):L===1?B=e.getY(C):L===2?B=e.getZ(C):L===3&&(B=e.getW(C)),e.normalized===!0&&(B=i.M8C.normalize(B,e.array))),t===5126?y.setFloat32(x,B,!0):t===5124?y.setInt32(x,B,!0):t===5125?y.setUint32(x,B,!0):t===p1?y.setInt16(x,B,!0):t===f1?y.setUint16(x,B,!0):t===h1?y.setInt8(x,B):t===d1&&y.setUint8(x,B),x+=f}const S={buffer:this.processBuffer(y.buffer),byteOffset:this.byteOffset,byteLength:g};return l!==void 0&&(S.target=l),l===34962&&(S.byteStride=e.itemSize*f),this.byteOffset+=g,c.bufferViews.push(S),{id:c.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(s){const l=new FileReader;l.readAsArrayBuffer(e),l.onloadend=function(){const c=px(l.result),f={buffer:t.processBuffer(c),byteOffset:t.byteOffset,byteLength:c.byteLength};t.byteOffset+=c.byteLength,s(n.bufferViews.push(f)-1)}})}processBufferViewImageBuffer(e){const t=this,n=t.json;n.bufferViews||(n.bufferViews=[]),e=px(e);const s={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};return t.byteOffset+=e.byteLength,n.bufferViews.push(s)-1}processAccessor(e,t,n,s){const l=this.json;let c;if(e.array.constructor===Float32Array)c=5126;else if(e.array.constructor===Int32Array)c=5124;else if(e.array.constructor===Uint32Array)c=5125;else if(e.array.constructor===Int16Array)c=p1;else if(e.array.constructor===Uint16Array)c=f1;else if(e.array.constructor===Int8Array)c=h1;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");c=d1}if(n===void 0&&(n=0),s===void 0&&(s=e.count),s===0)return null;const f=function(S,C,L){const B={min:new Array(S.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(S.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let W=C;W<C+L;W++)for(let q=0;q<S.itemSize;q++){let Z;S.itemSize>4?Z=S.array[W*S.itemSize+q]:(q===0?Z=S.getX(W):q===1?Z=S.getY(W):q===2?Z=S.getZ(W):q===3&&(Z=S.getW(W)),S.normalized===!0&&(Z=i.M8C.normalize(Z,S.array))),B.min[q]=Math.min(B.min[q],Z),B.max[q]=Math.max(B.max[q],Z)}return B}(e,n,s);let g;t!==void 0&&(g=e===t.index?34963:34962);const y=this.processBufferView(e,c,n,s,g),x={bufferView:y.id,byteOffset:y.byteOffset,componentType:c,count:s,max:f.max,min:f.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return e.normalized===!0&&(x.normalized=!0),l.accessors||(l.accessors=[]),l.accessors.push(x)-1}processImage(e,t,n,s="image/png",l=void 0,c=void 0){if(e!==null){const f=this,g=f.cache,y=f.json,x=f.options,S=f.pending;g.images.has(e)||g.images.set(e,{});const C=g.images.get(e),L=s+":flipY/"+n.toString()+(l||c?";"+l+";"+c:"");if(C[L]!==void 0)return C[L];y.images||(y.images=[]);const B={mimeType:s},W=AT();W.width=Math.min(l||e.width,x.maxTextureSize),W.height=Math.min(c||e.height,x.maxTextureSize);const q=W.getContext("2d");if(n===!0&&(q.translate(0,W.height),q.scale(1,-1)),e.data!==void 0){t!==i.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>x.maxTextureSize||e.height>x.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const j=new Uint8ClampedArray(e.height*e.width*4);for(let F=0;F<j.length;F+=4)j[F+0]=e.data[F+0],j[F+1]=e.data[F+1],j[F+2]=e.data[F+2],j[F+3]=e.data[F+3];q.putImageData(new ImageData(j,e.width,e.height),0,0)}else q.drawImage(e,0,0,W.width,W.height);x.binary===!0?S.push(bT(W,s).then(j=>f.processBufferViewImage(j)).then(j=>{B.bufferView=j})):W.toDataURL!==void 0?B.uri=W.toDataURL(s):S.push(bT(W,s).then(j=>new FileReader().readAsDataURL(j)).then(j=>{B.uri=j}));const Z=y.images.push(B)-1;return C[L]=Z,Z}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Jc[e.magFilter],minFilter:Jc[e.minFilter],wrapS:Jc[e.wrapS],wrapT:Jc[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);let s=e.userData.mimeType;s==="image/webp"&&(s="image/png"),s==="image/jpg"&&(s="image/jpeg");const l={sampler:this.processSampler(e),source:!s||["image/jpeg","image/png"].includes(s)?this.processImage(e.image,e.format,e.flipY,s):null};e.name&&(l.name=e.name),this._invokeAll(function(f){f.writeTexture&&f.writeTexture(e,l)}),l.source===null&&console.error("GLTFExporter: Unsupported mime type: "+s+". Cannot export texture.",e);const c=n.textures.push(l)-1;return t.textures.set(e,c),c}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const s={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const l=e.color.toArray().concat([e.opacity]);if(Fy(l,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=l),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const f=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),g={index:this.processTexture(f),channel:f.channel};this.applyTextureTransform(g,f),s.pbrMetallicRoughness.metallicRoughnessTexture=g}if(e.map){const f={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(f,e.map),s.pbrMetallicRoughness.baseColorTexture=f}if(e.emissive){const f=e.emissive;if(Math.max(f.r,f.g,f.b)>0&&(s.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const g={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(g,e.emissiveMap),s.emissiveTexture=g}}if(e.normalMap){const f={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(f.scale=e.normalScale.x),this.applyTextureTransform(f,e.normalMap),s.normalTexture=f}if(e.aoMap){const f={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(f.strength=e.aoMapIntensity),this.applyTextureTransform(f,e.aoMap),s.occlusionTexture=f}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===i.ehD&&(s.doubleSided=!0),e.name!==""&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll(function(f){f.writeMaterial&&f.writeMaterial(e,s)});const c=n.materials.push(s)-1;return t.materials.set(e,c),c}processMesh(e){const t=this.cache,n=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let F=0,se=e.material.length;F<se;F++)s.push(e.material[F].uuid);else s.push(e.material.uuid);const l=s.join(":");if(t.meshes.has(l))return t.meshes.get(l);const c=e.geometry;let f;f=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const g={},y={},x=[],S=[],C={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},L=c.getAttribute("normal");L===void 0||this.isNormalizedNormalAttribute(L)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),c.setAttribute("normal",this.createNormalizedNormalAttribute(L)));let B=null;for(let F in c.attributes){if(F.slice(0,5)==="morph")continue;const se=c.attributes[F];if(F=C[F]||F.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(F)||(F="_"+F),t.attributes.has(this.getUID(se))){y[F]=t.attributes.get(this.getUID(se));continue}B=null;const pe=se.array;F!=="JOINTS_0"||pe instanceof Uint16Array||pe instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),B=new i.TlE(new Uint16Array(pe),se.itemSize,se.normalized));const be=this.processAccessor(B||se,c);be!==null&&(F.startsWith("_")||this.detectMeshQuantization(F,se),y[F]=be,t.attributes.set(this.getUID(se),be))}if(L!==void 0&&c.setAttribute("normal",L),Object.keys(y).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const F=[],se=[],pe={};if(e.morphTargetDictionary!==void 0)for(const be in e.morphTargetDictionary)pe[e.morphTargetDictionary[be]]=be;for(let be=0;be<e.morphTargetInfluences.length;++be){const Se={};let Be=!1;for(const Ge in c.morphAttributes){if(Ge!=="position"&&Ge!=="normal"){Be||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),Be=!0);continue}const Xe=c.morphAttributes[Ge][be],Qe=Ge.toUpperCase(),at=c.attributes[Ge];if(t.attributes.has(this.getUID(Xe,!0))){Se[Qe]=t.attributes.get(this.getUID(Xe,!0));continue}const Ke=Xe.clone();if(!c.morphTargetsRelative)for(let Je=0,ft=Xe.count;Je<ft;Je++)for(let mt=0;mt<Xe.itemSize;mt++)mt===0&&Ke.setX(Je,Xe.getX(Je)-at.getX(Je)),mt===1&&Ke.setY(Je,Xe.getY(Je)-at.getY(Je)),mt===2&&Ke.setZ(Je,Xe.getZ(Je)-at.getZ(Je)),mt===3&&Ke.setW(Je,Xe.getW(Je)-at.getW(Je));Se[Qe]=this.processAccessor(Ke,c),t.attributes.set(this.getUID(at,!0),Se[Qe])}S.push(Se),F.push(e.morphTargetInfluences[be]),e.morphTargetDictionary!==void 0&&se.push(pe[be])}g.weights=F,se.length>0&&(g.extras={},g.extras.targetNames=se)}const W=Array.isArray(e.material);if(W&&c.groups.length===0)return null;const q=W?e.material:[e.material],Z=W?c.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let F=0,se=Z.length;F<se;F++){const pe={mode:f,attributes:y};if(this.serializeUserData(c,pe),S.length>0&&(pe.targets=S),c.index!==null){let Se=this.getUID(c.index);Z[F].start===void 0&&Z[F].count===void 0||(Se+=":"+Z[F].start+":"+Z[F].count),t.attributes.has(Se)?pe.indices=t.attributes.get(Se):(pe.indices=this.processAccessor(c.index,c,Z[F].start,Z[F].count),t.attributes.set(Se,pe.indices)),pe.indices===null&&delete pe.indices}const be=this.processMaterial(q[Z[F].materialIndex]);be!==null&&(pe.material=be),x.push(pe)}g.primitives=x,n.meshes||(n.meshes=[]),this._invokeAll(function(F){F.writeMesh&&F.writeMesh(e,g)});const j=n.meshes.push(g)-1;return t.meshes.set(l,j),j}detectMeshQuantization(e,t){if(this.extensionsUsed[m1])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const s=e.split("_",1)[0];_T[s]&&_T[s].includes(n)&&(this.extensionsUsed[m1]=!0,this.extensionsRequired[m1]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,s={type:n?"orthographic":"perspective"};return n?s.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:i.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const n=this.json,s=this.nodeMap;n.animations||(n.animations=[]);const l=(e=dx.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,c=[],f=[];for(let g=0;g<l.length;++g){const y=l[g],x=i.iUV.parseTrackName(y.name);let S=i.iUV.findNode(t,x.nodeName);const C=vT[x.propertyName];if(x.objectName==="bones"&&(S=S.isSkinnedMesh===!0?S.skeleton.getBoneByName(x.objectIndex):void 0),!S||!C)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',y.name),null;const L=1;let B,W=y.values.length/y.times.length;C===vT.morphTargetInfluences&&(W/=S.morphTargetInfluences.length),y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(B="CUBICSPLINE",W/=3):B=y.getInterpolation()===i.Syv?"STEP":"LINEAR",f.push({input:this.processAccessor(new i.TlE(y.times,L)),output:this.processAccessor(new i.TlE(y.values,W)),interpolation:B}),c.push({sampler:f.length-1,target:{node:s.get(S),path:C}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:f,channels:c}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,s=t.nodes[n.get(e)],l=e.skeleton;if(l===void 0)return null;const c=e.skeleton.bones[0];if(c===void 0)return null;const f=[],g=new Float32Array(16*l.bones.length),y=new i.yGw;for(let x=0;x<l.bones.length;++x)f.push(n.get(l.bones[x])),y.copy(l.boneInverses[x]),y.multiply(e.bindMatrix).toArray(g,16*x);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new i.TlE(g,16)),joints:f,skeleton:n.get(c)}),s.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const l={};if(n.trs){const f=e.quaternion.toArray(),g=e.position.toArray(),y=e.scale.toArray();Fy(f,[0,0,0,1])||(l.rotation=f),Fy(g,[0,0,0])||(l.translation=g),Fy(y,[1,1,1])||(l.scale=y)}else e.matrixAutoUpdate&&e.updateMatrix(),Fy(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(l.matrix=e.matrix.elements);if(e.name!==""&&(l.name=String(e.name)),this.serializeUserData(e,l),e.isMesh||e.isLine||e.isPoints){const f=this.processMesh(e);f!==null&&(l.mesh=f)}else e.isCamera&&(l.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const f=[];for(let g=0,y=e.children.length;g<y;g++){const x=e.children[g];if(x.visible||n.onlyVisible===!1){const S=this.processNode(x);S!==null&&f.push(S)}}f.length>0&&(l.children=f)}this._invokeAll(function(f){f.writeNode&&f.writeNode(e,l)});const c=t.nodes.push(l)-1;return s.set(e,c),c}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};e.name!==""&&(s.name=e.name),t.scenes.push(s);const l=[];for(let c=0,f=e.children.length;c<f;c++){const g=e.children[c];if(g.visible||n.onlyVisible===!1){const y=this.processNode(g);y!==null&&l.push(y)}}l.length>0&&(s.nodes=l),this.serializeUserData(e,s)}processObjects(e){const t=new i.xsS;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const n=[];for(let s=0;s<e.length;s++)e[s]instanceof i.xsS?this.processScene(e[s]):n.push(e[s]);n.length>0&&this.processObjects(n);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class PI{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,s=n.json,l=n.extensionsUsed,c={};e.name&&(c.name=e.name),c.color=e.color.toArray(),c.intensity=e.intensity,e.isDirectionalLight?c.type="directional":e.isPointLight?(c.type="point",e.distance>0&&(c.range=e.distance)):e.isSpotLight&&(c.type="spot",e.distance>0&&(c.range=e.distance),c.spot={},c.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,c.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),l[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},l[this.name]=!0);const f=s.extensions[this.name].lights;f.push(c),t.extensions=t.extensions||{},t.extensions[this.name]={light:f.length-1}}}class DI{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class LI{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.clearcoatFactor=e.clearcoat,e.clearcoatMap){const c={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(c,e.clearcoatMap),l.clearcoatTexture=c}if(l.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const c={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(c,e.clearcoatRoughnessMap),l.clearcoatRoughnessTexture=c}if(e.clearcoatNormalMap){const c={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(c,e.clearcoatNormalMap),l.clearcoatNormalTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class BI{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.iridescenceFactor=e.iridescence,e.iridescenceMap){const c={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(c,e.iridescenceMap),l.iridescenceTexture=c}if(l.iridescenceIor=e.iridescenceIOR,l.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],l.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const c={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(c,e.iridescenceThicknessMap),l.iridescenceThicknessTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class OI{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.transmissionFactor=e.transmission,e.transmissionMap){const c={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(c,e.transmissionMap),l.transmissionTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class NI{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.thicknessFactor=e.thickness,e.thicknessMap){const c={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(c,e.thicknessMap),l.thicknessTexture=c}l.attenuationDistance=e.attenuationDistance,l.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class kI{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}class UI{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(II)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,s=n.extensionsUsed,l={};if(e.specularIntensityMap){const c={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(c,e.specularIntensityMap),l.specularTexture=c}if(e.specularColorMap){const c={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(c,e.specularColorMap),l.specularColorTexture=c}l.specularFactor=e.specularIntensity,l.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class FI{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const n=this.writer,s=n.extensionsUsed,l={};if(e.sheenRoughnessMap){const c={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(c,e.sheenRoughnessMap),l.sheenRoughnessTexture=c}if(e.sheenColorMap){const c={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(c,e.sheenColorMap),l.sheenColorTexture=c}l.sheenRoughnessFactor=e.sheenRoughness,l.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=l,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,s[this.name]=!0}}class zI{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,n[this.name]=!0}}dx.Utils={GLTFWriter:xT,insertKeyframe:function(a,e){const n=a.getValueSize(),s=new a.TimeBufferType(a.times.length+1),l=new a.ValueBufferType(a.values.length+n),c=a.createInterpolant(new a.ValueBufferType(n));let f;if(a.times.length===0){s[0]=e;for(let g=0;g<n;g++)l[g]=0;f=0}else if(e<a.times[0]){if(Math.abs(a.times[0]-e)<.001)return 0;s[0]=e,s.set(a.times,1),l.set(c.evaluate(e),0),l.set(a.values,n),f=0}else if(e>a.times[a.times.length-1]){if(Math.abs(a.times[a.times.length-1]-e)<.001)return a.times.length-1;s[s.length-1]=e,s.set(a.times,0),l.set(a.values,0),l.set(c.evaluate(e),a.values.length),f=s.length-1}else for(let g=0;g<a.times.length;g++){if(Math.abs(a.times[g]-e)<.001)return g;if(a.times[g]<e&&a.times[g+1]>e){s.set(a.times.slice(0,g+1),0),s[g+1]=e,s.set(a.times.slice(g+1),g+2),l.set(a.values.slice(0,(g+1)*n),0),l.set(c.evaluate(e),(g+1)*n),l.set(a.values.slice((g+1)*n),(g+2)*n),f=g+1;break}}return a.times=s,a.values=l,f},mergeMorphTargetTracks:function(a,e){const t=[],n={},s=a.tracks;for(let l=0;l<s.length;++l){let c=s[l];const f=i.iUV.parseTrackName(c.name),g=i.iUV.findNode(e,f.nodeName);if(f.propertyName!=="morphTargetInfluences"||f.propertyIndex===void 0){t.push(c);continue}if(c.createInterpolant!==c.InterpolantFactoryMethodDiscrete&&c.createInterpolant!==c.InterpolantFactoryMethodLinear){if(c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),c=c.clone(),c.setInterpolation(i.NMF)}const y=g.morphTargetInfluences.length,x=g.morphTargetDictionary[f.propertyIndex];if(x===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+f.propertyIndex);let S;if(n[g.uuid]===void 0){S=c.clone();const L=new S.ValueBufferType(y*S.times.length);for(let B=0;B<S.times.length;B++)L[B*y+x]=S.values[B];S.name=(f.nodeName||"")+".morphTargetInfluences",S.values=L,n[g.uuid]=S,t.push(S);continue}const C=c.createInterpolant(new c.ValueBufferType(1));S=n[g.uuid];for(let L=0;L<S.times.length;L++)S.values[L*y+x]=C.evaluate(S.times[L]);for(let L=0;L<c.times.length;L++){const B=this.insertKeyframe(S,c.times[L]);S.values[B*y+x]=c.values[L]}}return a.tracks=t,a}};class wT extends dx.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new i.Wid}serializeUserData(e,t){const n=e.userData,s={};n.__disposed&&console.error("Serializing a disposed object",e),Object.entries(n).forEach(([l,c])=>{(!c||typeof c=="function"||c.isObject3D||c.isTexture||c.isMaterial||c.assetType!=null||l.startsWith("_")||l!=="uuid"&&(Zs.includes(l)||Bo.includes(l)||Bt.includes(l)))&&(s[l]=c,delete n[l])}),super.serializeUserData(e,t),Object.entries(s).forEach(([l,c])=>{n[l]=c,delete s[l]})}processObjects(e){var t;e.length===1&&((t=e[0])!=null&&t.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const n=super.processMaterial(t);if(n===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||t===e)return n;const s=JSON.stringify(this.json.materials[n]),l=JSON.parse(s);this.serializeUserData(e,l),this._invokeAll(f=>{f.writeMaterial&&f.writeMaterial(e,l)});const c=this.json.materials.push(l)-1;return this.cache.materials.set(e,c),c}processImageBlob(e,t){if(!e)return-1;const n=this.cache,s=this.options,l=this.pending,c=this.json,f=t.image;n.images.has(f)||n.images.set(f,{});const g=n.images.get(f),y=e.type+":flipY/"+t.flipY.toString();if(g[y]!==void 0)return g[y];c.images||(c.images=[]);const x={mimeType:e.type};s.binary===!0?l.push(new Promise(C=>{this.processBufferViewImage(e).then(L=>{x.bufferView=L,C()})})):l.push((0,r.blobToDataURL)(e).then(C=>{x.uri=C}));const S=c.images.push(x)-1;return g[y]=S,S}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);const s=e.source.data,l=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const c=super.processTexture(e),f=n.textures[c];if(!f)return console.error("No texture def",c,e),c;const g=n.images?n.images[f.source]:null;if(g&&(g.extras||(g.extras={}),e.source&&(g.extras.uuid=e.source.uuid),g.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=s,e.userData.mimeType=l,!f)return console.error("textureDef is null",c,e),c;if(f.source>=0){const y=this.json.images[f.source];y.uri?console.warn("uri already set",y.uri):(y.uri=e.userData.rootPath,y.mimeType=l,y.extras||(y.extras={}),y.extras.flipY=e.flipY,y.extras.uri=e.userData.rootPath)}else f.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,l)}return f.source<0&&console.error("textureDef.source cannot be saved",f,e),c}processImage(e,t,n,s="image/png"){return e?super.processImage(e,t,n,s,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,t,n,s="image/png"){const l=this.cache,c=this.json;l.images.has(e)||l.images.set(e,{});const f=l.images.get(e),g=s+":flipY/"+n.toString();if(f[g]!==void 0)return f[g];c.images||(c.images=[]);const y={mimeType:s,uri:t,extras:{flipY:n}},x=c.images.push(y)-1;return f[g]=x,x}}function VI(a,e){(e=e??document.createElement("script")).type=a.type||"text/javascript",e.text=a.text;for(let t=0;t<a.attributes.length;t++){const n=a.attributes[t];e.setAttribute(n.name,n.value)}return e}function ET(a,e=0){const t=(n=a.byteLength,4*Math.ceil(n/4));var n;if(t!==a.byteLength){const s=new Uint8Array(t);if(s.set(new Uint8Array(a)),e!==0)for(let l=a.byteLength;l<t;l++)s[l]=e;return s.buffer}return a}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,e){const t=new Uint8Array(this);e==null&&(e=t.length);const n=new ArrayBuffer(e-a),s=new Uint8Array(n);for(let l=0;l<s.length;l++)s[l]=t[l+a];return n});class g1 extends dx{register(e){return super.register(e)}async parseAsync(e,t){if(!e)throw new Error("No object to export");const n=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((s,l)=>this.parse(e,s,l,t));if(n&&typeof n=="object"&&!n.byteLength)return new Blob([JSON.stringify(n,(s,l)=>s.startsWith("__")?void 0:l,t.jsonSpaces??2)],{type:"model/gltf+json"});if(n){let s=null;return t.encrypt&&(!t.encryptKey&&window.prompt&&(t.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),t.encryptKey?s=function(l,c){const f=ET(l),g=new DataView(new ArrayBuffer(8));g.setUint32(0,f.byteLength,!0),g.setUint32(4,5130562,!0);const y=ET(new TextEncoder().encode(JSON.stringify({asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}})).buffer,32),x=new DataView(new ArrayBuffer(8));x.setUint32(0,y.byteLength,!0),x.setUint32(4,1313821514,!0);const S=new ArrayBuffer(12),C=new DataView(S);C.setUint32(0,1179937895,!0),C.setUint32(4,2,!0);const L=12+x.byteLength+y.byteLength+g.byteLength+f.byteLength;C.setUint32(8,L,!0);const B=new Blob([S,x,y,g,f],{type:"application/octet-stream"});return B.ext="glb",B}(await(0,r.aesGcmEncrypt)(new Uint8Array(n),t.encryptKey)):console.warn("GLTF Export: encryption key not provided, skipping encryption")),s||(s=new Blob([n],{type:"model/gltf+binary"})),s}throw new Error("GLTFExporter2.parse() failed")}parse(e,t,n,s={}){const l={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!s.embedUrlImages&&s.externalImagesInExtras||!1,embedUrlImages:s.embedUrlImages??!1,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:s};return s.exportExt==="glb"&&(l.binary=!0),s.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(c=>c.traverse(f=>{f.uuid&&(f.userData.gltfUUID=f.uuid)})),(Array.isArray(e)?e:[e]).forEach(c=>c.traverse(f=>{if(f.animations)for(const g of f.animations)g.__gltfExport===!1||l.animations.includes(g)||l.animations.push(...f.animations)})),super.parse(e,c=>{s.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(f=>f.traverse(g=>{delete g.userData.gltfUUID})),t(Object.assign(c,{__isGLTFOutput:!0}))},n,l,new wT)}}function ST(a,e){const t=a.getPlugin(ri).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&t.resources.textures&&[...Object.entries(t.resources.textures)].forEach(([s,l])=>{e.json.textures.find(f=>{var g,y,x,S,C;return((g=f.extras)==null?void 0:g.uuid)===s||((x=(y=e.json.samplers[f.sampler])==null?void 0:y.extras)==null?void 0:x.uuid)===s||((C=(S=e.json.images[f.source])==null?void 0:S.extras)==null?void 0:C.t_uuid)===s})&&(l.image&&t.resources.images&&t.resources.images[l.image]&&delete t.resources.images[l.image],t.resources.textures[s]={})}),e.json.materials&&t.resources.materials&&[...Object.entries(t.resources.materials)].forEach(([s,l])=>{e.json.materials.find(c=>{var f;return((f=c.extras)==null?void 0:f.uuid)===s})&&(t.resources.materials[s]={})});const n=[];Object.values(t.resources).forEach(s=>{s&&Object.values(s).forEach(l=>{l.url&&(l.url.type==="Uint16Array"&&l.url.data?(l.url.data instanceof Uint16Array||(l.url.data=new Uint16Array(l.url.data)),n.push(l.url)):l.url.type==="Uint8Array"&&l.url.data&&(l.url.data instanceof Uint8Array||(l.url.data=new Uint8Array(l.url.data)),n.push(l.url)))})});for(const s of n){let l="application/octet-stream";if(s.mimeType&&(l=s.mimeType),e.options.exporterOptions.encodeUint16Rgbe&&s.type==="Uint16Array"&&s.width>0&&s.height>0){const y=jI(s.data,4),x=new ImageData(y,s.width,s.height),S=i.PpQ.getDataURL(x,!0).split(",")[1],C=2;l="image/png",C===1||(s.data=Uint8Array.from(atob(S),L=>L.charCodeAt(0))),s.encoding="rgbe",s.encodingVersion=C}e.json.images||(e.json.images=[]);const c={mimeType:l},f=e.json.images.push(c)-1,g=s.data;c.bufferView=e.processBufferViewImageBuffer(g),s.data={image:f}}return t}function jI(a,e=3,t){let n,s,l,c,f;const g=a.byteLength/(2*e)|0;t=t||new Uint8ClampedArray(4*g);for(let y=0;y<g;y++){n=a[y*e],s=a[y*e+1],l=a[y*e+2],c=Math.max(Math.max(n,s),l);const x=Math.ceil(Math.log2(c));f=Math.pow(2,x-8),t[4*y]=n/f|0,t[4*y+1]=s/f|0,t[4*y+2]=l/f|0,t[4*y+3]=x+128}return t}function _1(a,e,t=g1,n){if(!e)return;const s=a.Exporters.findIndex(c=>c.ext.includes("gltf")||c.ext.includes("glb")),l=[];s>=0?(l.push(...a.Exporters[s].extensions??[]),a.Exporters.splice(s,1)):(l.push(WI),l.push(HI),l.push(GI),l.push(c=>new QI(c)),l.push(c=>new XI(c)),l.push(c=>new qI(c)),l.push(c=>new YI(c))),a.Exporters.push({ctor:()=>{const c=new t;return l.forEach(f=>c.register(f)),c.register(f=>({afterParse:g=>{var x,S;if(g=Array.isArray(g)?g[0]:g,!((x=g==null?void 0:g.userData)!=null&&x.rootSceneModelRoot)||((S=g==null?void 0:g.userData)==null?void 0:S.__exportViewerConfig)===!1)return;const y=f.json.scenes[f.json.scene||0];y.extensions||(y.extensions={}),y.extensions[Ra]=ST(e,f),f.extensionsUsed[Ra]=!0}})),n==null||n(c),c},ext:["gltf","glb"],extensions:l})}const GI=a=>({writeNode:(e,t)=>{if(!(e!=null&&e.isLight))return;t.extensions||(t.extensions={});const n={};e.shadow&&(n.shadow=e.shadow.toJSON()),Object.keys(n).length>0&&(t.extensions[Yr]=n,a.extensionsUsed[Yr]=!0)}}),HI=a=>({writeNode:(e,t)=>{if(!(e!=null&&e.isObject3D))return;t.extensions||(t.extensions={});const n={};e.castShadow!==void 0&&(n.castShadow=e.castShadow),e.receiveShadow!==void 0&&(n.receiveShadow=e.receiveShadow),e.visible===!1&&(n.visible=!1),e.frustumCulled===!1&&(n.frustumCulled=!1),e.renderOrder!==0&&(n.renderOrder=e.renderOrder),e.layers.mask!==1&&(n.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),Object.keys(n).length>0&&(t.extensions[vo]=n,a.extensionsUsed[vo]=!0)}}),WI=a=>({writeMaterial(e,t){if(!(e!=null&&e.isMaterial))return;t.extensions||(t.extensions={});const n={};e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.side!==void 0&&e.side!==i.ehD&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(n.depthFunc=e.depthFunc),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.vertexColors!==void 0&&(n.vertexColors=e.vertexColors),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.normalScale!==void 0&&(n.normalScale=[e.normalScale.x,e.normalScale.y]);const s=this.materialExternalResources[e.uuid];s&&Object.entries(s).forEach(([l,c])=>{var f;l.startsWith("_")||(c!=null&&c.userData&&(c.userData.__embedUrlImagePreviews=(f=a.options.exporterOptions)==null?void 0:f.embedUrlImagePreviews),n[l]=kn(c,!1,this.serializedMeta),c!=null&&c.userData&&delete c.userData.__embedUrlImagePreviews)}),Object.keys(n).length>0&&(t.extensions[ca]=n,a.extensionsUsed[ca]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!a.options.externalImagesInExtras)return;const t=[];(Array.isArray(e)?e:[e]).forEach(n=>{n==null||n.traverse(s=>{var l;s&&((l=s.material)!=null&&l.isMaterial)&&t.push(s.material)})}),t.forEach(n=>{n&&(this.materialExternalResources[n.uuid]||(this.materialExternalResources[n.uuid]={}),this.materialExternalResources[n.uuid].__materialRef=n,Object.entries(n).forEach(([s,l])=>{s.startsWith("_")||l&&l.isTexture&&l.userData.rootPath&&(l.userData.rootPath.startsWith("http")||l.userData.rootPath.startsWith("data:"))&&(n[s]=null,this.materialExternalResources[n.uuid][s]=l)}))})},afterParse(e){const t=Object.values(this.materialExternalResources);if(t.length<1)return;t.forEach(s=>{const l=s.__materialRef;l&&(Object.entries(s).forEach(([c,f])=>{c.startsWith("_")||f&&(l[c]=f)}),delete this.materialExternalResources[l.uuid])});const n=a.json.scenes[a.json.scene||0];n.extensions||(n.extensions={}),n.extensions[ca]={resources:this.serializedMeta},a.extensionsUsed[ca]=!0}});class QI{constructor(e){this.writer=e,this.name=No}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.bumpScale=e.bumpScale,e.bumpMap){const c={index:n.processTexture(e.bumpMap)};n.applyTextureTransform(c,e.bumpMap),l.bumpTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class XI{constructor(e){this.writer=e,this.name=At}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.displacementScale=e.displacementScale,l.displacementBias=e.displacementBias,e.displacementMap){const c={index:n.processTexture(e.displacementMap)};n.applyTextureTransform(c,e.displacementMap),l.displacementTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class qI{constructor(e){this.writer=e,this.name=Eh}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const n=this.writer,s=n.extensionsUsed,l={};if(l.lightMapIntensity=e.lightMapIntensity,e.lightMap){const c={index:n.processTexture(e.lightMap)};n.applyTextureTransform(c,e.lightMap),l.lightMapTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}class YI{constructor(e){this.writer=e,this.name=wh}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const n=this.writer,s=n.extensionsUsed,l={};if(e.alphaMap){const c={index:n.processTexture(e.alphaMap)};n.applyTextureTransform(c,e.alphaMap),l.alphaTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=l,s[this.name]=!0}}const KI=new TextEncoder;class $I{parse(e,t,n){if(!function(g,y){if(y.isWebGLRenderTarget&&(!g||!g.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!y||!y.isWebGLRenderTarget&&!y.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const x=y.isWebGLRenderTarget?y.texture:y;return x.type!==i.VzW&&x.type!==i.cLu?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):x.format===i.wk1||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1)}(e,t))return;const s=function(g,y={}){const x=g.isTexture?g:g.texture,S=g.isWebGLRenderTarget?g.width:g.image.width,C=g.isWebGLRenderTarget?g.height:g.image.height,L=x.type,B=x.format,W=x.colorSpace,q=y.compression!==void 0?y.compression:3,Z=(y.type!==void 0?y.type:i.cLu)===i.VzW?2:1,j={0:1,2:1,3:16}[q];return{width:S,height:C,type:L,format:B,colorSpace:W,compression:q,blockLines:j,dataType:Z,dataSize:2*Z,numBlocks:Math.ceil(C/j),numInputChannels:4,numOutputChannels:4,flipY:g.isDataTexture&&g.flipY}}(t,n),l=function(g,y,x){if(y.isDataTexture)return y.image.data;let S;return S=x.type===i.VzW?new Float32Array(x.width*x.height*x.numInputChannels):new Uint16Array(x.width*x.height*x.numInputChannels),g.readRenderTargetPixels(y,0,0,x.width,x.height,S),S}(e,t,s),c=function(g,y){const x=y.width,S=y.height,C={r:0,g:0,b:0,a:0},L={value:0},B=y.numOutputChannels==4?1:0,W=y.type==i.VzW?rP:iP,q=y.dataType==1?tP:v1,Z=new Uint8Array(y.width*y.height*y.numOutputChannels*y.dataSize),j=new DataView(Z.buffer);for(let F=0;F<S;++F)for(let se=0;se<x;++se){const pe=F*x*4+4*se,be=W(g,pe),Se=W(g,pe+1),Be=W(g,pe+2),Ge=W(g,pe+3),Xe=(y.flipY?F:S-F-1)*x*(3+B)*y.dataSize;eP(C,be,Se,Be,Ge),L.value=Xe+se*y.dataSize,q(j,C.a,L),L.value=Xe+B*x*y.dataSize+se*y.dataSize,q(j,C.b,L),L.value=Xe+(1+B)*x*y.dataSize+se*y.dataSize,q(j,C.g,L),L.value=Xe+(2+B)*x*y.dataSize+se*y.dataSize,q(j,C.r,L)}return Z}(l,s),f=function(g,y){let x,S,C=0;const L={data:new Array,totalSize:0},B=y.width*y.numOutputChannels*y.blockLines*y.dataSize;switch(y.compression){case 0:x=JI;break;case 2:case 3:x=ZI}y.compression!==0&&(S=new Uint8Array(B));for(let W=0;W<y.numBlocks;++W){const q=x(g.subarray(B*W,B*(W+1)),S);C+=q.length,L.data.push({dataChunk:q,size:q.length})}return L.totalSize=C,L}(c,s);return function(g,y){const x=8*y.numBlocks,S=259+18*y.numOutputChannels,C={value:S+x},L=new Uint8Array(S+x+g.totalSize+8*y.numBlocks),B=new DataView(L.buffer);(function(W,q,Z){const j={value:0},F=new DataView(W.buffer);ms(F,20000630,j),ms(F,2,j),sa(F,"compression",j),sa(F,"compression",j),ms(F,1,j),zy(F,Z.compression,j),sa(F,"screenWindowCenter",j),sa(F,"v2f",j),ms(F,8,j),ms(F,0,j),ms(F,0,j),sa(F,"screenWindowWidth",j),sa(F,"float",j),ms(F,4,j),v1(F,1,j),sa(F,"pixelAspectRatio",j),sa(F,"float",j),ms(F,4,j),v1(F,1,j),sa(F,"lineOrder",j),sa(F,"lineOrder",j),ms(F,1,j),zy(F,0,j),sa(F,"dataWindow",j),sa(F,"box2i",j),ms(F,16,j),ms(F,0,j),ms(F,0,j),ms(F,Z.width-1,j),ms(F,Z.height-1,j),sa(F,"displayWindow",j),sa(F,"box2i",j),ms(F,16,j),ms(F,0,j),ms(F,0,j),ms(F,Z.width-1,j),ms(F,Z.height-1,j),sa(F,"channels",j),sa(F,"chlist",j),ms(F,18*Z.numOutputChannels+1,j),sa(F,"A",j),ms(F,Z.dataType,j),j.value+=4,ms(F,1,j),ms(F,1,j),sa(F,"B",j),ms(F,Z.dataType,j),j.value+=4,ms(F,1,j),ms(F,1,j),sa(F,"G",j),ms(F,Z.dataType,j),j.value+=4,ms(F,1,j),ms(F,1,j),sa(F,"R",j),ms(F,Z.dataType,j),j.value+=4,ms(F,1,j),ms(F,1,j),zy(F,0,j),zy(F,0,j);let se=j.value+8*Z.numBlocks;for(let pe=0;pe<q.data.length;++pe)nP(F,se,j),se+=q.data[pe].size+8})(L,g,y);for(let W=0;W<g.data.length;++W){const q=g.data[W].dataChunk,Z=g.data[W].size;ms(B,W*y.blockLines,C),ms(B,Z,C),L.set(q,C.value),C.value+=Z}return L}(f,s)}}function JI(a){return a}function ZI(a,e){let t=0,n=Math.floor((a.length+1)/2),s=0;const l=a.length-1;for(;!(s>l||(e[t++]=a[s++],s>l));)e[n++]=a[s++];let c=e[0];for(let f=1;f<e.length;f++){const g=e[f]-c+384;c=e[f],e[f]=g}return function(f,g){g||(g={});var y=HE();y.p(f);var x=WE(f,g,2,4);return XE(x,g),QE(x,x.length-4,y.d()),x}(e)}function eP(a,e,t,n,s){a.r=e,a.g=t,a.b=n,a.a=s}function zy(a,e,t){a.setUint8(t.value,e),t.value+=1}function ms(a,e,t){a.setUint32(t.value,e,!0),t.value+=4}function tP(a,e,t){a.setUint16(t.value,i.A5E.toHalfFloat(e),!0),t.value+=2}function v1(a,e,t){a.setFloat32(t.value,e,!0),t.value+=4}function nP(a,e,t){a.setBigUint64(t.value,BigInt(e),!0),t.value+=8}function sa(a,e,t){const n=KI.encode(e+"\0");for(let s=0;s<n.length;++s)zy(a,n[s],t)}function iP(a,e){return function(t){const n=(31744&t)>>10,s=1023&t;return(t>>15?-1:1)*(n?n===31?s?NaN:1/0:Math.pow(2,n-15)*(1+s/1024):s/1024*6103515625e-14)}(a[e])}function rP(a,e){return a[e]}class fx extends $I{async parseAsync(e,t){const n=this.parse(e.renderer.rendererObject,e,t);return new Blob([n],{type:"image/x-exr"})}}class TT extends r.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find(t=>t.ext.some(n=>e.includes(n)))}constructor(e,t={}){super(),this._processors=new gm,this.Exporters=[{ctor:()=>new mT,ext:["json"]},{ctor:()=>new gT,ext:["txt","text"]},{ctor:()=>new fx,ext:["exr"]}],this._cachedParsers=[],_1(this,e)}async exportObject(e,t={}){var l,c;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");(l=e==null?void 0:e.userData)!=null&&l.rootSceneModelRoot&&t.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const n=[];e.assetType==="model"&&e.modelObject.traverse(f=>{f.userData.excludeFromExport&&f.visible&&(f.visible=!1,n.push(f))});const s=await this._exportFile(e,t);return e.assetType==="model"&&n.forEach(f=>f.visible=!0),(c=e==null?void 0:e.userData)!=null&&c.rootSceneModelRoot&&t.viewerConfig===!1&&delete e.userData.__exportViewerConfig,s}async _exportFile(e,t={}){let n;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const s=await this.processBeforeExport(e,t),l=t.exportExt??(s==null?void 0:s.typeExt)??(s==null?void 0:s.ext);if(!s||!l)throw new Error(`Unable to preprocess before export ${l}`);const c=this._getParser(l);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const f=await c.parseAsync(s.obj,{exportExt:s.ext??l,...t});f.ext=s.ext,n=f}catch(s){return console.error("AssetExporter: Unable to Export file",e),console.error(s),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:s})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),n}_createParser(e){const t=this.Exporters.find(s=>s.ext.includes(e));if(!t)throw new Error(`No exporter found for extension ${e}`);const n=t==null?void 0:t.ctor(this);if(!n)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:n}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:n}),n}_getParser(e){var t;return((t=this._cachedParsers.find(n=>n.ext.includes(e)))==null?void 0:t.parser)??this._createParser(e)}async processBeforeExport(e,t={}){if(e.assetType!=null&&e.assetType!=="renderTarget"&&(e=await this._processors.process(e.assetType,e,t)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)==null||e.dispose()}}var Vy;(function(a){a[a.EDGEBREAKER=1]="EDGEBREAKER",a[a.SEQUENTIAL=0]="SEQUENTIAL"})(Vy||(Vy={}));class im extends Ln{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:Vy.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new TT(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(t,n)=>{var s;return n.convertMeshToIndexed&&((s=t.modelObject)==null||s.traverse(l=>{var c;l.geometry&&(l.geometry.attributes.index||((c=l.setGeometry)==null||c.call(l,tt(l.geometry))))})),t}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var t,n;return(n=this.exporter)==null?void 0:n.exportObject((t=this._viewer)==null?void 0:t.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,t){var s,l;const n=(s=this._viewer)==null?void 0:s.getPluginByType("FileTransferPlugin");n?await n.exportFile(e,t):(l=this._viewer)==null||l.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",n=>{var s;typeof((s=n.plugin)==null?void 0:s.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const t=Object.entries(e.plugins).filter(([n,s])=>typeof(s==null?void 0:s.toJSON)=="function"&&(s==null?void 0:s.serializeWithViewer)!==!1).map(([n,s])=>({label:n,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var n,s;return(s=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:s.call(n,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(Vy).map(([n,s])=>({label:n,value:s}))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map(n=>({label:n}))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map(n=>({type:"slider",label:n,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,n]}))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var n,s;return(s=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:s.call(n,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var n,s;return(s=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:s.call(n,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:t},{type:"button",label:"Select none",value:()=>{t.forEach(n=>{var s;n.value=!1,(s=n.uiRefresh)==null||s.call(n)})}},{type:"button",label:"Select all",value:()=>{t.forEach(n=>{var s;n.value=!0,(s=n.uiRefresh)==null||s.call(n)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(ri).exportPluginPresets(t.filter(s=>!!s.value).map(s=>(0,r.getOrCall)(s.label)||"")),null,2)],{type:"application/json"});n&&await this._downloadBlob(n,this.exportOptions.name+"."+ri.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(ri).exportViewerConfig(!1),null,2)],{type:"application/json"});n&&await this._downloadBlob(n,this.exportOptions.name+"."+ri.ViewerTypeSlug)}}]}]}}}im.PluginType="AssetExporterPlugin",function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);l>3&&c&&Object.defineProperty(e,t,c)}([Pe()],im.prototype,"exportOptions",void 0);class y1{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners[e];if(n!==void 0){const s=n.indexOf(t);s!==-1&&n.splice(s,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){const n=t.slice(0);for(let s=0,l=n.length;s<l;s++)n[s].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class Dv extends y1{constructor(e,t,n,s={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=s,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class sP extends y1{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let n=this.listParentEdges(e);return t&&(n=n.filter(s=>t(s.getParent()))),n.forEach(s=>s.dispose()),this}createEdge(e,t,n,s){return this._registerEdge(new Dv(e,t,n,s))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function jy(){return jy=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},jy.apply(this,arguments)}function A1(a){return a instanceof Dv}function Gy(a){return Array.isArray(a)&&a[0]instanceof Dv}function Hy(a){return!!(function(e){return!!e&&Object.getPrototypeOf(e)===Object.prototype}(a)&&function(e){for(const t in e)return e[t]}(a)instanceof Dv)}const Ns=Symbol("attributes"),Lv=Symbol("immutableKeys");class b1 extends y1{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Ns]=void 0,this[Lv]=void 0,this.graph=e,this[Lv]=new Set,this[Ns]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const s=e[n];if(s instanceof b1){const l=this.graph.createEdge(n,this,s);l.addEventListener("dispose",()=>s.dispose()),this[Lv].add(n),t[n]=l}else t[n]=s}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[Ns]){const s=this[Ns][n];if(A1(s)){const l=s;l.getChild()===e&&this.setRef(n,t,l.getAttributes())}else if(Gy(s)){const l=s.find(c=>c.getChild()===e);if(l){const c=l.getAttributes();this.removeRef(n,e).addRef(n,t,c)}}else if(Hy(s)){const l=s;for(const c in l){const f=l[c];f.getChild()===e&&this.setRefMap(n,c,t,f.getAttributes())}}}return this}get(e){return this[Ns][e]}set(e,t){return this[Ns][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[Ns][e];return t?t.getChild():null}setRef(e,t,n){if(this[Lv].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[Ns][e];if(s&&s.dispose(),!t)return this;const l=this.graph.createEdge(e,this,t,n);return l.addEventListener("dispose",()=>{delete this[Ns][e],this.dispatchEvent({type:"change",attribute:e})}),this[Ns][e]=l,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Ns][e].map(t=>t.getChild())}addRef(e,t,n){const s=this.graph.createEdge(e,this,t,n),l=this[Ns][e];return l.push(s),s.addEventListener("dispose",()=>{const c=l.filter(f=>f!==s);l.length=0;for(const f of c)l.push(f);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[Ns][e].filter(n=>n.getChild()===t).forEach(n=>n.dispose()),this}listRefMapKeys(e){return Object.keys(this[Ns][e])}listRefMapValues(e){return Object.values(this[Ns][e]).map(t=>t.getChild())}getRefMap(e,t){const n=this[Ns][e];return n[t]?n[t].getChild():null}setRefMap(e,t,n,s){const l=this[Ns][e],c=l[t];if(c&&c.dispose(),!n)return this;s=Object.assign(s||{},{key:t});const f=this.graph.createEdge(e,this,n,jy({},s,{key:t}));return f.addEventListener("dispose",()=>{delete l[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),l[t]=f,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(jy({},e,{target:this})),this.graph.dispatchEvent(jy({},e,{target:this,type:`node:${e.type}`})),this}}const MT="@glb.bin";var yi,mx,Zc,bo,Og;(function(a){a.ACCESSOR="Accessor",a.ANIMATION="Animation",a.ANIMATION_CHANNEL="AnimationChannel",a.ANIMATION_SAMPLER="AnimationSampler",a.BUFFER="Buffer",a.CAMERA="Camera",a.MATERIAL="Material",a.MESH="Mesh",a.PRIMITIVE="Primitive",a.PRIMITIVE_TARGET="PrimitiveTarget",a.NODE="Node",a.ROOT="Root",a.SCENE="Scene",a.SKIN="Skin",a.TEXTURE="Texture",a.TEXTURE_INFO="TextureInfo"})(yi||(yi={})),function(a){a.INTERLEAVED="interleaved",a.SEPARATE="separate"}(mx||(mx={})),function(a){a.ARRAY_BUFFER="ARRAY_BUFFER",a.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",a.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",a.OTHER="OTHER",a.SPARSE="SPARSE"}(Zc||(Zc={})),function(a){a[a.R=4096]="R",a[a.G=256]="G",a[a.B=16]="B",a[a.A=1]="A"}(bo||(bo={})),function(a){a.GLTF="GLTF",a.GLB="GLB"}(Og||(Og={}));const gx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var vx,x1,w1=typeof Float32Array<"u"?Float32Array:Array;function E1(a){return Math.hypot(a[0],a[1],a[2])}function oP(a,e,t){var n=e[0],s=e[1],l=e[2],c=t[3]*n+t[7]*s+t[11]*l+t[15];return a[0]=(t[0]*n+t[4]*s+t[8]*l+t[12])/(c=c||1),a[1]=(t[1]*n+t[5]*s+t[9]*l+t[13])/c,a[2]=(t[2]*n+t[6]*s+t[10]*l+t[14])/c,a}function aP(a,e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of a.listPrimitives()){const s=n.getAttribute("POSITION");if(!s)continue;let l=[0,0,0],c=[0,0,0];for(let f=0;f<s.getCount();f++)l=s.getElement(f,l),c=oP(c,l,e),S1(c,t)}return t}function S1(a,e){for(let t=0;t<3;t++)e.min[t]=Math.min(a[t],e.min[t]),e.max[t]=Math.max(a[t],e.max[t])}Math.hypot||(Math.hypot=function(){for(var a=0,e=arguments.length;e--;)a+=arguments[e]*arguments[e];return Math.sqrt(a)}),vx=new w1(3),w1!=Float32Array&&(vx[0]=0,vx[1]=0,vx[2]=0);class Xr{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const l of e)t+=l.byteLength;const n=new Uint8Array(t);let s=0;for(const l of e)n.set(l,s),s+=l.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),t!==0)for(let l=e.byteLength;l<n;l++)s[l]=t;return s}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class gc{static hexToFactor(e,t){e=Math.floor(e);const n=t;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[n,s,l]=this.convertLinearToSRGB(e,t);return 255*n<<16^255*s<<8^255*l<<0}static convertSRGBToLinear(e,t){const n=e,s=t;for(let l=0;l<3;l++)s[l]=n[l]<.04045?.0773993808*n[l]:Math.pow(.9478672986*n[l]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const n=e,s=t;for(let l=0;l<3;l++)s[l]=n[l]<.0031308?12.92*n[l]:1.055*Math.pow(n[l],.41666)-.055;return t}}class yx{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Xr.decodeText(e.slice(12,16))===yx.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}yx.PNG_FRIED_CHUNK_NAME="CgBI";class rd{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let n=0;const s=this.getSize(e,t);if(!s)return null;for(;s[0]>1||s[1]>1;)n+=s[0]*s[1]*4,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}function lP(a,e){if(e>a.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(a.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return a}rd.impls={"image/jpeg":new class{match(a){return a.length>=3&&a[0]===255&&a[1]===216&&a[2]===255}getSize(a){let e,t,n=new DataView(a.buffer,a.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),lP(n,e),t=n.getUint8(e+1),t===192||t===193||t===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(a.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(a){return 3}},"image/png":new yx};class Bv{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return rd.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function CT(a){return Object.prototype.toString.call(a)==="[object Object]"}function Ng(a){if(CT(a)===!1)return!1;const e=a.constructor;if(e===void 0)return!0;const t=e.prototype;return CT(t)!==!1&&Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")!==!1}(function(a){a[a.SILENT=4]="SILENT",a[a.ERROR=3]="ERROR",a[a.WARN=2]="WARN",a[a.INFO=1]="INFO",a[a.DEBUG=0]="DEBUG"})(x1||(x1={}));class eu{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=eu.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=eu.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=eu.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=eu.Verbosity.ERROR&&console.error(e)}}function cP(a,e,t){var n=e[0],s=e[1],l=e[2],c=e[3],f=e[4],g=e[5],y=e[6],x=e[7],S=e[8],C=e[9],L=e[10],B=e[11],W=e[12],q=e[13],Z=e[14],j=e[15],F=t[0],se=t[1],pe=t[2],be=t[3];return a[0]=F*n+se*f+pe*S+be*W,a[1]=F*s+se*g+pe*C+be*q,a[2]=F*l+se*y+pe*L+be*Z,a[3]=F*c+se*x+pe*B+be*j,a[4]=(F=t[4])*n+(se=t[5])*f+(pe=t[6])*S+(be=t[7])*W,a[5]=F*s+se*g+pe*C+be*q,a[6]=F*l+se*y+pe*L+be*Z,a[7]=F*c+se*x+pe*B+be*j,a[8]=(F=t[8])*n+(se=t[9])*f+(pe=t[10])*S+(be=t[11])*W,a[9]=F*s+se*g+pe*C+be*q,a[10]=F*l+se*y+pe*L+be*Z,a[11]=F*c+se*x+pe*B+be*j,a[12]=(F=t[12])*n+(se=t[13])*f+(pe=t[14])*S+(be=t[15])*W,a[13]=F*s+se*g+pe*C+be*q,a[14]=F*l+se*y+pe*L+be*Z,a[15]=F*c+se*x+pe*B+be*j,a}eu.Verbosity=x1,eu.DEFAULT_INSTANCE=new eu(eu.Verbosity.INFO);class Ks{static identity(e){return e}static eq(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-t[s])>n)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return Ks.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return Ks.encodeNormalizedInt(e,t)}static decompose(e,t,n,s){let l=E1([e[0],e[1],e[2]]);const c=E1([e[4],e[5],e[6]]),f=E1([e[8],e[9],e[10]]);var g,y,x,S,C,L,B,W,q,Z,j,F,se,pe,be,Se,Be;((y=(g=e)[0])*(B=g[5])-(x=g[1])*(L=g[4]))*((F=g[10])*(Be=g[15])-(se=g[11])*(Se=g[14]))-(y*(W=g[6])-(S=g[2])*L)*((j=g[9])*Be-se*(be=g[13]))+(y*(q=g[7])-(C=g[3])*L)*(j*Se-F*be)+(x*W-S*B)*((Z=g[8])*Be-se*(pe=g[12]))-(x*q-C*B)*(Z*Se-F*pe)+(S*q-C*W)*(Z*be-j*pe)<0&&(l=-l),t[0]=e[12],t[1]=e[13],t[2]=e[14];const Ge=e.slice(),Xe=1/l,Qe=1/c,at=1/f;Ge[0]*=Xe,Ge[1]*=Xe,Ge[2]*=Xe,Ge[4]*=Qe,Ge[5]*=Qe,Ge[6]*=Qe,Ge[8]*=at,Ge[9]*=at,Ge[10]*=at,function(Ke,Je){var ft=new w1(3);(function(tr,vn){var zn=vn[4],fi=vn[5],br=vn[6],Wr=vn[8],Rr=vn[9],xr=vn[10];tr[0]=Math.hypot(vn[0],vn[1],vn[2]),tr[1]=Math.hypot(zn,fi,br),tr[2]=Math.hypot(Wr,Rr,xr)})(ft,Je);var mt=1/ft[0],vt=1/ft[1],Qt=1/ft[2],Ht=Je[0]*mt,Cn=Je[1]*vt,un=Je[2]*Qt,rn=Je[4]*mt,Gn=Je[5]*vt,Fn=Je[6]*Qt,di=Je[8]*mt,bi=Je[9]*vt,Bi=Je[10]*Qt,Br=Ht+Gn+Bi,lr=0;Br>0?(lr=2*Math.sqrt(Br+1),Ke[3]=.25*lr,Ke[0]=(Fn-bi)/lr,Ke[1]=(di-un)/lr,Ke[2]=(Cn-rn)/lr):Ht>Gn&&Ht>Bi?(lr=2*Math.sqrt(1+Ht-Gn-Bi),Ke[3]=(Fn-bi)/lr,Ke[0]=.25*lr,Ke[1]=(Cn+rn)/lr,Ke[2]=(di+un)/lr):Gn>Bi?(lr=2*Math.sqrt(1+Gn-Ht-Bi),Ke[3]=(di-un)/lr,Ke[0]=(Cn+rn)/lr,Ke[1]=.25*lr,Ke[2]=(Fn+bi)/lr):(lr=2*Math.sqrt(1+Bi-Ht-Gn),Ke[3]=(Cn-rn)/lr,Ke[0]=(di+un)/lr,Ke[1]=(Fn+bi)/lr,Ke[2]=.25*lr)}(n,Ge),s[0]=l,s[1]=c,s[2]=f}static compose(e,t,n,s){const l=s,c=t[0],f=t[1],g=t[2],y=t[3],x=c+c,S=f+f,C=g+g,L=c*x,B=c*S,W=c*C,q=f*S,Z=f*C,j=g*C,F=y*x,se=y*S,pe=y*C,be=n[0],Se=n[1],Be=n[2];return l[0]=(1-(q+j))*be,l[1]=(B+pe)*be,l[2]=(W-se)*be,l[3]=0,l[4]=(B-pe)*Se,l[5]=(1-(L+j))*Se,l[6]=(Z+F)*Se,l[7]=0,l[8]=(W+se)*Be,l[9]=(Z-F)*Be,l[10]=(1-(L+q))*Be,l[11]=0,l[12]=e[0],l[13]=e[1],l[14]=e[2],l[15]=1,l}}function uP(a,e){if(!!a!=!!e)return!1;const t=a.getChild(),n=e.getChild();return t===n||t.equals(n)}function hP(a,e){if(!!a!=!!e||a.length!==e.length)return!1;for(let t=0;t<a.length;t++){const n=a[t],s=e[t];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function dP(a,e){if(!!a!=!!e)return!1;const t=Object.keys(a),n=Object.keys(e);if(t.length!==n.length)return!1;for(const s in a){const l=a[s],c=e[s];if(!!l!=!!c)return!1;const f=l.getChild(),g=c.getChild();if(f!==g&&!f.equals(g))return!1}return!0}function RT(a,e){if(a===e)return!0;if(!!a!=!!e||!a||!e||a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(a[t]!==e[t])return!1;return!0}function IT(a,e){if(a===e)return!0;if(!!a!=!!e)return!1;if(!Ng(a)||!Ng(e))return a===e;const t=a,n=e;let s,l=0,c=0;for(s in t)l++;for(s in n)c++;if(l!==c)return!1;for(s in t){const f=t[s],g=n[s];if(Ax(f)&&Ax(g)){if(!RT(f,g))return!1}else if(Ng(f)&&Ng(g)){if(!IT(f,g))return!1}else if(f!==g)return!1}return!0}function Ax(a){return Array.isArray(a)||ArrayBuffer.isView(a)}const PT="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",DT=new Set,pP=function(){let a="";for(let e=0;e<6;e++)a+=PT.charAt(Math.floor(Math.random()*PT.length));return a};class Wy{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return Bv.basename(new URL(e,"https://null.example").pathname)}static extension(e){return Bv.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),s=t.split("/");n.pop();for(let l=0;l<s.length;l++)s[l]!=="."&&(s[l]===".."?n.pop():n.push(s[l]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Wy.DEFAULT_INIT={},Wy.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Tp=a=>a,fP=new Set;class T1 extends b1{constructor(e,t=""){super(e),this[Ns].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,Tp)}copy(e,t=Tp){for(const n in this[Ns]){const s=this[Ns][n];if(s instanceof Dv)this[Lv].has(n)||s.dispose();else if(Gy(s))for(const l of s)l.dispose();else if(Hy(s))for(const l in s)s[l].dispose()}for(const n in e[Ns]){const s=this[Ns][n],l=e[Ns][n];if(l instanceof Dv)this[Lv].has(n)?s.getChild().copy(t(l.getChild()),t):this.setRef(n,t(l.getChild()),l.getAttributes());else if(Gy(l))for(const c of l)this.addRef(n,t(c.getChild()),c.getAttributes());else if(Hy(l))for(const c in l){const f=l[c];this.setRefMap(n,c,t(f.getChild()),f.getAttributes())}else this[Ns][n]=Ng(l)?JSON.parse(JSON.stringify(l)):Array.isArray(l)||l instanceof ArrayBuffer||ArrayBuffer.isView(l)?l.slice():l}return this}equals(e,t=fP){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[Ns]){if(t.has(n))continue;const s=this[Ns][n],l=e[Ns][n];if(A1(s)||A1(l)){if(!uP(s,l))return!1}else if(Gy(s)||Gy(l)){if(!hP(s,l))return!1}else if(Hy(s)||Hy(l)){if(!dP(s,l))return!1}else if(Ng(s)||Ng(l)){if(!IT(s,l))return!1}else if(Ax(s)||Ax(l)){if(!RT(s,l))return!1}else if(s!==l)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Wl extends T1{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class zi extends Wl{constructor(...e){super(...e),this.i=Ks.identity,this.o=Ks.identity}init(){this.propertyType=yi.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:zi.Type.SCALAR,componentType:zi.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=Tp){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case zi.Type.SCALAR:return 1;case zi.Type.VEC2:return 2;case zi.Type.VEC3:return 3;case zi.Type.VEC4:case zi.Type.MAT2:return 4;case zi.Type.MAT3:return 9;case zi.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case zi.ComponentType.BYTE:case zi.ComponentType.UNSIGNED_BYTE:return 1;case zi.ComponentType.SHORT:case zi.ComponentType.UNSIGNED_SHORT:return 2;case zi.ComponentType.UNSIGNED_INT:case zi.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMin(e){const t=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let l=0;l<s;l++)e[l]=1/0;for(let l=0;l<n*s;l+=s)for(let c=0;c<s;c++){const f=t[l+c];Number.isFinite(f)&&(e[c]=Math.min(e[c],f))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMax(e){const t=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let l=0;l<s;l++)e[l]=-1/0;for(let l=0;l<n*s;l+=s)for(let c=0;c<s;c++){const f=t[l+c];Number.isFinite(f)&&(e[c]=Math.max(e[c],f))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return zi.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=t=>Ks.decodeNormalizedInt(t,this.get("componentType")),this.i=t=>Ks.encodeNormalizedInt(t,this.get("componentType"))):(this.o=Ks.identity,this.i=Ks.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const n=this.getElementSize(),s=this.get("array");for(let l=0;l<n;l++)t[l]=this.o(s[e*n+l]);return t}setElement(e,t){const n=this.getElementSize(),s=this.get("array");for(let l=0;l<n;l++)s[e*n+l]=this.i(t[l]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(t){switch(t.constructor){case Float32Array:return zi.ComponentType.FLOAT;case Uint32Array:return zi.ComponentType.UNSIGNED_INT;case Uint16Array:return zi.ComponentType.UNSIGNED_SHORT;case Uint8Array:return zi.ComponentType.UNSIGNED_BYTE;case Int16Array:return zi.ComponentType.SHORT;case Int8Array:return zi.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):zi.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}zi.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},zi.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class LT extends Wl{init(){this.propertyType=yi.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class M1 extends Wl{init(){this.propertyType=yi.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}M1.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Ov extends Wl{init(){this.propertyType=yi.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Ov.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Zc.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Zc.OTHER})}}Ov.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class BT extends Wl{init(){this.propertyType=yi.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class kg extends Wl{init(){this.propertyType=yi.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:kg.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}kg.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Io extends T1{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Io.EXTENSION_NAME=void 0;class $s extends Wl{init(){this.propertyType=yi.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:$s.WrapMode.REPEAT,wrapT:$s.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}$s.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},$s.MagFilter={NEAREST:9728,LINEAR:9729},$s.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:bx,G:xx,B:wx,A:mP}=bo;class Ug extends Wl{init(){this.propertyType=yi.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Ug.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new $s(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new $s(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new $s(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new $s(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new $s(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return gc.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",gc.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:bx|xx|wx|mP})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return gc.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",gc.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:bx|xx|wx})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:bx|xx|wx})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:bx})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:xx|wx})}}Ug.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class OT extends Wl{init(){this.propertyType=yi.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class NT extends Wl{constructor(...e){super(...e),this.u=null}init(){this.propertyType=yi.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=Tp){if(t===Tp)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Ks.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return Ks.decompose(e,t,n,s),this.set("translation",t).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return Ks.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Ks.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Ks.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.u)e.push(s);let t;const n=e.pop().getMatrix();for(;t=e.pop();)cP(n,n,t.getMatrix());return n}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[Ns].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===yi.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class Fg extends Wl{init(){this.propertyType=yi.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Fg.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Zc.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Zc.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Fg.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class gP extends T1{init(){this.propertyType=yi.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Zc.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function _c(){return(_c=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a}).apply(this,arguments)}class kT extends Wl{init(){this.propertyType=yi.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=Tp){if(t===Tp)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class UT extends Wl{init(){this.propertyType=yi.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Zc.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class FT extends Wl{init(){this.propertyType=yi.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||rd.extensionToMimeType(Bv.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=rd.extensionToMimeType(Bv.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Xr.assertView(e))}getSize(){const e=this.get("image");return e?rd.getSize(e,this.getMimeType()):null}}class zT extends Wl{init(){this.propertyType=yi.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v3.2.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",t=>{this.l(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Tp){if(t===Tp)throw new Error("Root cannot be copied.");this.set("asset",_c({},e.get("asset"))),this.setName(e.getName()),this.setExtras(_c({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,t(s))}return this}l(e){return e instanceof kT?this.addRef("scenes",e):e instanceof NT?this.addRef("nodes",e):e instanceof kg?this.addRef("cameras",e):e instanceof UT?this.addRef("skins",e):e instanceof OT?this.addRef("meshes",e):e instanceof Ug?this.addRef("materials",e):e instanceof FT?this.addRef("textures",e):e instanceof LT?this.addRef("animations",e):e instanceof zi?this.addRef("accessors",e):e instanceof BT&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Nv{static fromGraph(e){return Nv.m.get(e)||null}constructor(){this.v=new sP,this.T=new zT(this.v),this.M=eu.DEFAULT_INSTANCE,Nv.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new Nv().setLogger(this.M).merge(this)}merge(e){for(const l of e.getRoot().listExtensionsUsed()){const c=this.createExtension(l.constructor);l.isRequired()&&c.setRequired(!0)}const t=new Set,n=new Map;t.add(e.T),n.set(e.T,this.T);for(const l of e.v.listEdges())for(const c of[l.getParent(),l.getChild()]){if(t.has(c))continue;let f;f=c.propertyType===yi.TEXTURE_INFO?c:new c.constructor(this.v),n.set(c,f),t.add(c)}const s=l=>{const c=n.get(l);if(!c)throw new Error("Could resolve property.");return c};for(const l of t){const c=n.get(l);if(!c)throw new Error("Could resolve property.");c.propertyType!==yi.TEXTURE_INFO&&c.copy(l,s)}return this}async transform(...e){const t=e.map(n=>n.name);for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===t)||new e(this)}createScene(e=""){return new kT(this.v,e)}createNode(e=""){return new NT(this.v,e)}createCamera(e=""){return new kg(this.v,e)}createSkin(e=""){return new UT(this.v,e)}createMesh(e=""){return new OT(this.v,e)}createPrimitive(){return new Fg(this.v)}createPrimitiveTarget(e=""){return new gP(this.v,e)}createMaterial(e=""){return new Ug(this.v,e)}createTexture(e=""){return new FT(this.v,e)}createAnimation(e=""){return new LT(this.v,e)}createAnimationChannel(e=""){return new M1(this.v,e)}createAnimationSampler(e=""){return new Ov(this.v,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new zi(this.v,e).setBuffer(t)}createBuffer(e=""){return new BT(this.v,e)}}Nv.m=new WeakMap;class so{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=n=>{const s=n,l=s.target;l instanceof Io&&l.extensionName===this.extensionName&&(s.type==="node:create"&&this.I(l),s.type==="node:dispose"&&this.N(l))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}so.EXTENSION_NAME=void 0;class _P{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const n=this.jsonDoc.json.textures[t.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}}const VT={logger:eu.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function Ex(a,e){const t=e.bufferViews[a.bufferView],n=e.jsonDoc.json.bufferViews[a.bufferView],s=gx[a.componentType],l=zi.getElementSize(a.type),c=s.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==l*c)return function(g,y){const x=y.bufferViews[g.bufferView],S=y.jsonDoc.json.bufferViews[g.bufferView],C=gx[g.componentType],L=zi.getElementSize(g.type),B=C.BYTES_PER_ELEMENT,W=g.byteOffset||0,q=new C(g.count*L),Z=new DataView(x.buffer,x.byteOffset,x.byteLength),j=S.byteStride;for(let F=0;F<g.count;F++)for(let se=0;se<L;se++){const pe=W+F*j+se*B;let be;switch(g.componentType){case zi.ComponentType.FLOAT:be=Z.getFloat32(pe,!0);break;case zi.ComponentType.UNSIGNED_INT:be=Z.getUint32(pe,!0);break;case zi.ComponentType.UNSIGNED_SHORT:be=Z.getUint16(pe,!0);break;case zi.ComponentType.UNSIGNED_BYTE:be=Z.getUint8(pe);break;case zi.ComponentType.SHORT:be=Z.getInt16(pe,!0);break;case zi.ComponentType.BYTE:be=Z.getInt8(pe);break;default:throw new Error(`Unexpected componentType "${g.componentType}".`)}q[F*L+se]=be}return q}(a,e);const f=t.byteOffset+(a.byteOffset||0);return new s(t.buffer.slice(f,f+a.count*l*c))}var Qy;(function(a){a[a.ARRAY_BUFFER=34962]="ARRAY_BUFFER",a[a.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Qy||(Qy={}));class sd{constructor(e,t,n){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=t,this.options=n;const s=e.getRoot(),l=s.listBuffers().length,c=s.listTextures().length;this.bufferURIGenerator=new jT(l>1,()=>n.basename||"buffer"),this.imageURIGenerator=new jT(c>1,f=>function(g,y){const x=g.getGraph().listParentEdges(y).find(S=>S.getParent()!==g.getRoot());return x?x.getName().replace(/texture$/i,""):""}(e,f)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const l={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},c=JSON.stringify(l);this.textureDefIndexMap.has(c)||(this.textureDefIndexMap.set(c,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(l));const f={index:this.textureDefIndexMap.get(c)};return t.getTexCoord()!==0&&(f.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(f.extras=t.getExtras()),this.textureInfoDefMap.set(t,f),f}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.O.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===Og.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const s=rd.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.C.get(e);if(t)return t;if(e.getSparse())return Zc.SPARSE;for(const n of this.O.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==yi.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Zc.OTHER}addAccessorToUsageGroup(e,t){const n=this.C.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this.C.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,n]of Array.from(this.C.entries()))e[n]=e[n]||[],e[n].push(t);return e}}sd.BufferViewTarget=Qy,sd.BufferViewUsage=Zc,sd.USAGE_TO_TARGET={[Zc.ARRAY_BUFFER]:Qy.ARRAY_BUFFER,[Zc.ELEMENT_ARRAY_BUFFER]:Qy.ELEMENT_ARRAY_BUFFER};class jT{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:Sx}=sd,{UNSIGNED_INT:vP,UNSIGNED_SHORT:yP,UNSIGNED_BYTE:AP}=zi.ComponentType;var Tx;(function(a){a[a.JSON=1313821514]="JSON",a[a.BIN=5130562]="BIN"})(Tx||(Tx={}));class bP{constructor(){this.M=eu.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=mx.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=GT(t)?this.P(t):{json:JSON.parse(Xr.decodeText(t)),resources:{}};return await this.L(n,this.dirname(e)),this.j(n),n}async readJSON(e){return e=this.D(e),this.j(e),(class{static read(t,n=VT){const s=_c({},VT,n),{json:l}=t,c=new Nv().setLogger(s.logger);this.validate(t,s);const f=new _P(t),g=l.asset,y=c.getRoot().getAsset();g.copyright&&(y.copyright=g.copyright),g.extras&&(y.extras=g.extras),l.extras!==void 0&&c.getRoot().setExtras(_c({},l.extras));const x=l.extensionsUsed||[],S=l.extensionsRequired||[];for(const F of s.extensions)if(x.includes(F.EXTENSION_NAME)){const se=c.createExtension(F).setRequired(S.includes(F.EXTENSION_NAME));for(const pe of se.readDependencies)se.install(pe,s.dependencies[pe])}const C=l.buffers||[];c.getRoot().listExtensionsUsed().filter(F=>F.prereadTypes.includes(yi.BUFFER)).forEach(F=>F.preread(f,yi.BUFFER)),f.buffers=C.map(F=>{const se=c.createBuffer(F.name);return F.extras&&se.setExtras(F.extras),F.uri&&F.uri.indexOf("__")!==0&&se.setURI(F.uri),se}),f.bufferViewBuffers=(l.bufferViews||[]).map((F,se)=>{if(!f.bufferViews[se]){const pe=t.json.buffers[F.buffer];f.bufferViews[se]=Xr.toView(pe.uri?t.resources[pe.uri]:t.resources["@glb.bin"],F.byteOffset||0,F.byteLength)}return f.buffers[F.buffer]});const L=l.accessors||[];f.accessors=L.map(F=>{const se=c.createAccessor(F.name,f.bufferViewBuffers[F.bufferView]).setType(F.type);return F.extras&&se.setExtras(F.extras),F.normalized!==void 0&&se.setNormalized(F.normalized),F.bufferView===void 0||se.setArray(Ex(F,f)),se});const B=l.images||[],W=l.textures||[];c.getRoot().listExtensionsUsed().filter(F=>F.prereadTypes.includes(yi.TEXTURE)).forEach(F=>F.preread(f,yi.TEXTURE)),f.textures=B.map(F=>{const se=c.createTexture(F.name);if(F.extras&&se.setExtras(F.extras),F.bufferView!==void 0){const pe=l.bufferViews[F.bufferView],be=t.json.buffers[pe.buffer],Se=pe.byteOffset||0,Be=(be.uri?t.resources[be.uri]:t.resources["@glb.bin"]).slice(Se,Se+pe.byteLength);se.setImage(Be)}else F.uri!==void 0&&(se.setImage(t.resources[F.uri]),F.uri.indexOf("__")!==0&&se.setURI(F.uri));if(F.mimeType!==void 0)se.setMimeType(F.mimeType);else if(F.uri){const pe=Bv.extension(F.uri);se.setMimeType(rd.extensionToMimeType(pe))}return se}),f.materials=(l.materials||[]).map(F=>{const se=c.createMaterial(F.name);F.extras&&se.setExtras(F.extras),F.alphaMode!==void 0&&se.setAlphaMode(F.alphaMode),F.alphaCutoff!==void 0&&se.setAlphaCutoff(F.alphaCutoff),F.doubleSided!==void 0&&se.setDoubleSided(F.doubleSided);const pe=F.pbrMetallicRoughness||{};if(pe.baseColorFactor!==void 0&&se.setBaseColorFactor(pe.baseColorFactor),F.emissiveFactor!==void 0&&se.setEmissiveFactor(F.emissiveFactor),pe.metallicFactor!==void 0&&se.setMetallicFactor(pe.metallicFactor),pe.roughnessFactor!==void 0&&se.setRoughnessFactor(pe.roughnessFactor),pe.baseColorTexture!==void 0){const be=pe.baseColorTexture;se.setBaseColorTexture(f.textures[W[be.index].source]),f.setTextureInfo(se.getBaseColorTextureInfo(),be)}if(F.emissiveTexture!==void 0){const be=F.emissiveTexture;se.setEmissiveTexture(f.textures[W[be.index].source]),f.setTextureInfo(se.getEmissiveTextureInfo(),be)}if(F.normalTexture!==void 0){const be=F.normalTexture;se.setNormalTexture(f.textures[W[be.index].source]),f.setTextureInfo(se.getNormalTextureInfo(),be),F.normalTexture.scale!==void 0&&se.setNormalScale(F.normalTexture.scale)}if(F.occlusionTexture!==void 0){const be=F.occlusionTexture;se.setOcclusionTexture(f.textures[W[be.index].source]),f.setTextureInfo(se.getOcclusionTextureInfo(),be),F.occlusionTexture.strength!==void 0&&se.setOcclusionStrength(F.occlusionTexture.strength)}if(pe.metallicRoughnessTexture!==void 0){const be=pe.metallicRoughnessTexture;se.setMetallicRoughnessTexture(f.textures[W[be.index].source]),f.setTextureInfo(se.getMetallicRoughnessTextureInfo(),be)}return se});const q=l.meshes||[];c.getRoot().listExtensionsUsed().filter(F=>F.prereadTypes.includes(yi.PRIMITIVE)).forEach(F=>F.preread(f,yi.PRIMITIVE)),f.meshes=q.map(F=>{const se=c.createMesh(F.name);return F.extras&&se.setExtras(F.extras),F.weights!==void 0&&se.setWeights(F.weights),(F.primitives||[]).forEach(pe=>{const be=c.createPrimitive();pe.extras&&be.setExtras(pe.extras),pe.material!==void 0&&be.setMaterial(f.materials[pe.material]),pe.mode!==void 0&&be.setMode(pe.mode);for(const[Be,Ge]of Object.entries(pe.attributes||{}))be.setAttribute(Be,f.accessors[Ge]);pe.indices!==void 0&&be.setIndices(f.accessors[pe.indices]);const Se=F.extras&&F.extras.targetNames||[];(pe.targets||[]).forEach((Be,Ge)=>{const Xe=Se[Ge]||Ge.toString(),Qe=c.createPrimitiveTarget(Xe);for(const[at,Ke]of Object.entries(Be))Qe.setAttribute(at,f.accessors[Ke]);be.addTarget(Qe)}),se.addPrimitive(be)}),se}),f.cameras=(l.cameras||[]).map(F=>{const se=c.createCamera(F.name).setType(F.type);if(F.extras&&se.setExtras(F.extras),F.type===kg.Type.PERSPECTIVE){const pe=F.perspective;se.setYFov(pe.yfov),se.setZNear(pe.znear),pe.zfar!==void 0&&se.setZFar(pe.zfar),pe.aspectRatio!==void 0&&se.setAspectRatio(pe.aspectRatio)}else{const pe=F.orthographic;se.setZNear(pe.znear).setZFar(pe.zfar).setXMag(pe.xmag).setYMag(pe.ymag)}return se});const Z=l.nodes||[];c.getRoot().listExtensionsUsed().filter(F=>F.prereadTypes.includes(yi.NODE)).forEach(F=>F.preread(f,yi.NODE)),f.nodes=Z.map(F=>{const se=c.createNode(F.name);if(F.extras&&se.setExtras(F.extras),F.translation!==void 0&&se.setTranslation(F.translation),F.rotation!==void 0&&se.setRotation(F.rotation),F.scale!==void 0&&se.setScale(F.scale),F.matrix!==void 0){const pe=[0,0,0],be=[0,0,0,1],Se=[1,1,1];Ks.decompose(F.matrix,pe,be,Se),se.setTranslation(pe),se.setRotation(be),se.setScale(Se)}return F.weights!==void 0&&se.setWeights(F.weights),se}),f.skins=(l.skins||[]).map(F=>{const se=c.createSkin(F.name);F.extras&&se.setExtras(F.extras),F.inverseBindMatrices!==void 0&&se.setInverseBindMatrices(f.accessors[F.inverseBindMatrices]),F.skeleton!==void 0&&se.setSkeleton(f.nodes[F.skeleton]);for(const pe of F.joints)se.addJoint(f.nodes[pe]);return se}),Z.map((F,se)=>{const pe=f.nodes[se];(F.children||[]).forEach(be=>pe.addChild(f.nodes[be])),F.mesh!==void 0&&pe.setMesh(f.meshes[F.mesh]),F.camera!==void 0&&pe.setCamera(f.cameras[F.camera]),F.skin!==void 0&&pe.setSkin(f.skins[F.skin])}),f.animations=(l.animations||[]).map(F=>{const se=c.createAnimation(F.name);F.extras&&se.setExtras(F.extras);const pe=(F.samplers||[]).map(be=>{const Se=c.createAnimationSampler().setInput(f.accessors[be.input]).setOutput(f.accessors[be.output]).setInterpolation(be.interpolation||Ov.Interpolation.LINEAR);return be.extras&&Se.setExtras(be.extras),se.addSampler(Se),Se});return(F.channels||[]).forEach(be=>{const Se=c.createAnimationChannel().setSampler(pe[be.sampler]).setTargetPath(be.target.path);be.target.node!==void 0&&Se.setTargetNode(f.nodes[be.target.node]),be.extras&&Se.setExtras(be.extras),se.addChannel(Se)}),se});const j=l.scenes||[];return c.getRoot().listExtensionsUsed().filter(F=>F.prereadTypes.includes(yi.SCENE)).forEach(F=>F.preread(f,yi.SCENE)),f.scenes=j.map(F=>{const se=c.createScene(F.name);return F.extras&&se.setExtras(F.extras),(F.nodes||[]).map(pe=>f.nodes[pe]).forEach(pe=>se.addChild(pe)),se}),l.scene!==void 0&&c.getRoot().setDefaultScene(f.scenes[l.scene]),c.getRoot().listExtensionsUsed().forEach(F=>F.read(f)),L.forEach((F,se)=>{const pe=f.accessors[se],be=!!F.sparse,Se=!F.bufferView&&!pe.getArray();(be||Se)&&pe.setSparse(!0).setArray(function(Be,Ge){const Xe=gx[Be.componentType],Qe=zi.getElementSize(Be.type);let at;at=Be.bufferView!==void 0?Ex(Be,Ge):new Xe(Be.count*Qe);const Ke=Be.sparse;if(!Ke)return at;const Je=Ke.count,ft=_c({},Be,Ke.indices,{count:Je,type:"SCALAR"}),mt=_c({},Be,Ke.values,{count:Je}),vt=Ex(ft,Ge),Qt=Ex(mt,Ge);for(let Ht=0;Ht<ft.count;Ht++)for(let Cn=0;Cn<Qe;Cn++)at[vt[Ht]*Qe+Cn]=Qt[Ht*Qe+Cn];return at}(F,f))}),c}static validate(t,n){const s=t.json;if(s.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired){for(const l of s.extensionsRequired)if(!n.extensions.find(c=>c.EXTENSION_NAME===l))throw new Error(`Missing required extension, "${l}".`)}if(s.extensionsUsed)for(const l of s.extensionsUsed)n.extensions.find(c=>c.EXTENSION_NAME===l)||n.logger.warn(`Missing optional extension, "${l}".`)}}).read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const t=this.P(Xr.assertView(e));this.j(t);const n=t.json;if(n.buffers&&n.buffers.some(s=>function(l,c){return c.uri!==void 0&&!(c.uri in l.resources)}(t,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>function(l,c){return c.uri!==void 0&&!(c.uri in l.resources)&&c.bufferView===void 0}(t,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Xr.assertView(e)))}async writeJSON(e,t={}){if(t.format===Og.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return(class{static write(n,s){const l=n.getRoot(),c={asset:_c({generator:"glTF-Transform v3.2.1"},l.getAsset()),extras:_c({},l.getExtras())},f={json:c,resources:{}},g=new sd(n,f,s),y=s.logger||eu.DEFAULT_INSTANCE,x=new Set(s.extensions.map(j=>j.EXTENSION_NAME)),S=n.getRoot().listExtensionsUsed().filter(j=>x.has(j.extensionName)),C=n.getRoot().listExtensionsRequired().filter(j=>x.has(j.extensionName));S.length<n.getRoot().listExtensionsUsed().length&&y.warn("Some extensions were not registered for I/O, and will not be written.");for(const j of S)for(const F of j.writeDependencies)j.install(F,s.dependencies[F]);function L(j,F,se,pe){const be=[];let Se=0;for(const Ge of j){const Xe=g.createAccessorDef(Ge);Xe.bufferView=c.bufferViews.length;const Qe=Ge.getArray(),at=Xr.pad(Xr.toView(Qe));Xe.byteOffset=Se,Se+=at.byteLength,be.push(at),g.accessorIndexMap.set(Ge,c.accessors.length),c.accessors.push(Xe)}const Be={buffer:F,byteOffset:se,byteLength:Xr.concat(be).byteLength};return pe&&(Be.target=pe),c.bufferViews.push(Be),{buffers:be,byteLength:Se}}function B(j,F,se){const pe=j[0].getCount();let be=0;for(const Xe of j){const Qe=g.createAccessorDef(Xe);Qe.bufferView=c.bufferViews.length,Qe.byteOffset=be;const at=Xe.getElementSize(),Ke=Xe.getComponentSize();be+=Xr.padNumber(at*Ke),g.accessorIndexMap.set(Xe,c.accessors.length),c.accessors.push(Qe)}const Se=pe*be,Be=new ArrayBuffer(Se),Ge=new DataView(Be);for(let Xe=0;Xe<pe;Xe++){let Qe=0;for(const at of j){const Ke=at.getElementSize(),Je=at.getComponentSize(),ft=at.getComponentType(),mt=at.getArray();for(let vt=0;vt<Ke;vt++){const Qt=Xe*be+Qe+vt*Je,Ht=mt[Xe*Ke+vt];switch(ft){case zi.ComponentType.FLOAT:Ge.setFloat32(Qt,Ht,!0);break;case zi.ComponentType.BYTE:Ge.setInt8(Qt,Ht);break;case zi.ComponentType.SHORT:Ge.setInt16(Qt,Ht,!0);break;case zi.ComponentType.UNSIGNED_BYTE:Ge.setUint8(Qt,Ht);break;case zi.ComponentType.UNSIGNED_SHORT:Ge.setUint16(Qt,Ht,!0);break;case zi.ComponentType.UNSIGNED_INT:Ge.setUint32(Qt,Ht,!0);break;default:throw new Error("Unexpected component type: "+ft)}}Qe+=Xr.padNumber(Ke*Je)}}return c.bufferViews.push({buffer:F,byteOffset:se,byteLength:Se,byteStride:be,target:sd.BufferViewTarget.ARRAY_BUFFER}),{byteLength:Se,buffers:[new Uint8Array(Be)]}}function W(j,F,se){const pe=[];let be=0;const Se=new Map;let Be=-1/0;for(const ft of j){const mt=g.createAccessorDef(ft);c.accessors.push(mt),g.accessorIndexMap.set(ft,c.accessors.length-1);const vt=[],Qt=[],Ht=[],Cn=new Array(ft.getElementSize()).fill(0);for(let Fn=0,di=ft.getCount();Fn<di;Fn++)if(ft.getElement(Fn,Ht),!Ks.eq(Ht,Cn,0)){Be=Math.max(Fn,Be),vt.push(Fn);for(let bi=0;bi<Ht.length;bi++)Qt.push(Ht[bi])}const un=vt.length,rn={accessorDef:mt,count:un};if(Se.set(ft,rn),un===0)continue;if(un>ft.getCount()/3){const Fn=(100*vt.length/ft.getCount()).toFixed(1);y.warn(`Sparse accessor with many non-zero elements (${Fn}%) may increase file size.`)}const Gn=gx[ft.getComponentType()];rn.indices=vt,rn.values=new Gn(Qt)}if(!Number.isFinite(Be))return{buffers:pe,byteLength:be};const Ge=Be<255?Uint8Array:Be<65535?Uint16Array:Uint32Array,Xe=Be<255?AP:Be<65535?yP:vP,Qe={buffer:F,byteOffset:se+be,byteLength:0};for(const ft of j){const mt=Se.get(ft);if(mt.count===0)continue;mt.indicesByteOffset=Qe.byteLength;const vt=Xr.pad(Xr.toView(new Ge(mt.indices)));pe.push(vt),be+=vt.byteLength,Qe.byteLength+=vt.byteLength}c.bufferViews.push(Qe);const at=c.bufferViews.length-1,Ke={buffer:F,byteOffset:se+be,byteLength:0};for(const ft of j){const mt=Se.get(ft);if(mt.count===0)continue;mt.valuesByteOffset=Ke.byteLength;const vt=Xr.pad(Xr.toView(mt.values));pe.push(vt),be+=vt.byteLength,Ke.byteLength+=vt.byteLength}c.bufferViews.push(Ke);const Je=c.bufferViews.length-1;for(const ft of j){const mt=Se.get(ft);mt.count!==0&&(mt.accessorDef.sparse={count:mt.count,indices:{bufferView:at,byteOffset:mt.indicesByteOffset,componentType:Xe},values:{bufferView:Je,byteOffset:mt.valuesByteOffset}})}return{buffers:pe,byteLength:be}}const q=new Map;for(const j of n.getGraph().listEdges()){if(j.getParent()===l)continue;const F=j.getChild();if(F instanceof zi){const se=q.get(F)||[];se.push(j),q.set(F,se)}}if(c.accessors=[],c.bufferViews=[],c.samplers=[],c.textures=[],c.images=l.listTextures().map((j,F)=>{const se=g.createPropertyDef(j);j.getMimeType()&&(se.mimeType=j.getMimeType());const pe=j.getImage();return pe&&g.createImageData(se,pe,j),g.imageIndexMap.set(j,F),se}),S.filter(j=>j.prewriteTypes.includes(yi.ACCESSOR)).forEach(j=>j.prewrite(g,yi.ACCESSOR)),l.listAccessors().forEach(j=>{const F=g.accessorUsageGroupedByParent,se=g.accessorParents;if(g.accessorIndexMap.has(j))return;const pe=q.get(j)||[],be=g.getAccessorUsage(j);if(g.addAccessorToUsageGroup(j,be),F.has(be)){const Se=pe[0].getParent(),Be=se.get(Se)||new Set;Be.add(j),se.set(Se,Be)}}),S.filter(j=>j.prewriteTypes.includes(yi.BUFFER)).forEach(j=>j.prewrite(g,yi.BUFFER)),(l.listAccessors().length>0||l.listTextures().length>0||g.otherBufferViews.size>0)&&l.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");c.buffers=[],l.listBuffers().forEach((j,F)=>{const se=g.createPropertyDef(j),pe=g.accessorUsageGroupedByParent,be=g.accessorParents,Se=j.listParents().filter(Ke=>Ke instanceof zi),Be=new Set(Se),Ge=[],Xe=c.buffers.length;let Qe=0;const at=g.listAccessorUsageGroups();for(const Ke in at)if(pe.has(Ke))for(const Je of Array.from(be.values())){const ft=Array.from(Je).filter(mt=>Be.has(mt)).filter(mt=>g.getAccessorUsage(mt)===Ke);if(ft.length)if(Ke!==Sx.ARRAY_BUFFER||s.vertexLayout===mx.INTERLEAVED){const mt=Ke===Sx.ARRAY_BUFFER?B(ft,Xe,Qe):L(ft,Xe,Qe);Qe+=mt.byteLength,Ge.push(...mt.buffers)}else for(const mt of ft){const vt=B([mt],Xe,Qe);Qe+=vt.byteLength,Ge.push(...vt.buffers)}}else{const Je=at[Ke].filter(vt=>Be.has(vt));if(!Je.length)continue;const ft=Ke===Sx.ELEMENT_ARRAY_BUFFER?sd.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,mt=Ke===Sx.SPARSE?W(Je,Xe,Qe):L(Je,Xe,Qe,ft);Qe+=mt.byteLength,Ge.push(...mt.buffers)}if(g.imageBufferViews.length&&F===0){for(let Ke=0;Ke<g.imageBufferViews.length;Ke++)if(c.bufferViews[c.images[Ke].bufferView].byteOffset=Qe,Qe+=g.imageBufferViews[Ke].byteLength,Ge.push(g.imageBufferViews[Ke]),Qe%8){const Je=8-Qe%8;Qe+=Je,Ge.push(new Uint8Array(Je))}}if(g.otherBufferViews.has(j))for(const Ke of g.otherBufferViews.get(j))c.bufferViews.push({buffer:Xe,byteOffset:Qe,byteLength:Ke.byteLength}),g.otherBufferViewsIndexMap.set(Ke,c.bufferViews.length-1),Qe+=Ke.byteLength,Ge.push(Ke);if(Qe){let Ke;s.format===Og.GLB?Ke="@glb.bin":(Ke=g.bufferURIGenerator.createURI(j,"bin"),se.uri=Ke),se.byteLength=Qe,f.resources[Ke]=Xr.concat(Ge)}c.buffers.push(se),g.bufferIndexMap.set(j,F)}),l.listAccessors().find(j=>!j.getBuffer())&&y.warn("Skipped writing one or more Accessors: no Buffer assigned."),c.materials=l.listMaterials().map((j,F)=>{const se=g.createPropertyDef(j);if(j.getAlphaMode()!==Ug.AlphaMode.OPAQUE&&(se.alphaMode=j.getAlphaMode()),j.getAlphaMode()===Ug.AlphaMode.MASK&&(se.alphaCutoff=j.getAlphaCutoff()),j.getDoubleSided()&&(se.doubleSided=!0),se.pbrMetallicRoughness={},Ks.eq(j.getBaseColorFactor(),[1,1,1,1])||(se.pbrMetallicRoughness.baseColorFactor=j.getBaseColorFactor()),Ks.eq(j.getEmissiveFactor(),[0,0,0])||(se.emissiveFactor=j.getEmissiveFactor()),j.getRoughnessFactor()!==1&&(se.pbrMetallicRoughness.roughnessFactor=j.getRoughnessFactor()),j.getMetallicFactor()!==1&&(se.pbrMetallicRoughness.metallicFactor=j.getMetallicFactor()),j.getBaseColorTexture()){const pe=j.getBaseColorTexture(),be=j.getBaseColorTextureInfo();se.pbrMetallicRoughness.baseColorTexture=g.createTextureInfoDef(pe,be)}if(j.getEmissiveTexture()){const pe=j.getEmissiveTexture(),be=j.getEmissiveTextureInfo();se.emissiveTexture=g.createTextureInfoDef(pe,be)}if(j.getNormalTexture()){const pe=j.getNormalTexture(),be=j.getNormalTextureInfo(),Se=g.createTextureInfoDef(pe,be);j.getNormalScale()!==1&&(Se.scale=j.getNormalScale()),se.normalTexture=Se}if(j.getOcclusionTexture()){const pe=j.getOcclusionTexture(),be=j.getOcclusionTextureInfo(),Se=g.createTextureInfoDef(pe,be);j.getOcclusionStrength()!==1&&(Se.strength=j.getOcclusionStrength()),se.occlusionTexture=Se}if(j.getMetallicRoughnessTexture()){const pe=j.getMetallicRoughnessTexture(),be=j.getMetallicRoughnessTextureInfo();se.pbrMetallicRoughness.metallicRoughnessTexture=g.createTextureInfoDef(pe,be)}return g.materialIndexMap.set(j,F),se}),c.meshes=l.listMeshes().map((j,F)=>{const se=g.createPropertyDef(j);let pe=null;return se.primitives=j.listPrimitives().map(be=>{const Se={attributes:{}};Se.mode=be.getMode();const Be=be.getMaterial();Be&&(Se.material=g.materialIndexMap.get(Be)),Object.keys(be.getExtras()).length&&(Se.extras=be.getExtras());const Ge=be.getIndices();Ge&&(Se.indices=g.accessorIndexMap.get(Ge));for(const Xe of be.listSemantics())Se.attributes[Xe]=g.accessorIndexMap.get(be.getAttribute(Xe));for(const Xe of be.listTargets()){const Qe={};for(const at of Xe.listSemantics())Qe[at]=g.accessorIndexMap.get(Xe.getAttribute(at));Se.targets=Se.targets||[],Se.targets.push(Qe)}return be.listTargets().length&&!pe&&(pe=be.listTargets().map(Xe=>Xe.getName())),Se}),j.getWeights().length&&(se.weights=j.getWeights()),pe&&(se.extras=se.extras||{},se.extras.targetNames=pe),g.meshIndexMap.set(j,F),se}),c.cameras=l.listCameras().map((j,F)=>{const se=g.createPropertyDef(j);if(se.type=j.getType(),se.type===kg.Type.PERSPECTIVE){se.perspective={znear:j.getZNear(),zfar:j.getZFar(),yfov:j.getYFov()};const pe=j.getAspectRatio();pe!==null&&(se.perspective.aspectRatio=pe)}else se.orthographic={znear:j.getZNear(),zfar:j.getZFar(),xmag:j.getXMag(),ymag:j.getYMag()};return g.cameraIndexMap.set(j,F),se}),c.nodes=l.listNodes().map((j,F)=>{const se=g.createPropertyDef(j);return Ks.eq(j.getTranslation(),[0,0,0])||(se.translation=j.getTranslation()),Ks.eq(j.getRotation(),[0,0,0,1])||(se.rotation=j.getRotation()),Ks.eq(j.getScale(),[1,1,1])||(se.scale=j.getScale()),j.getWeights().length&&(se.weights=j.getWeights()),g.nodeIndexMap.set(j,F),se}),c.skins=l.listSkins().map((j,F)=>{const se=g.createPropertyDef(j),pe=j.getInverseBindMatrices();pe&&(se.inverseBindMatrices=g.accessorIndexMap.get(pe));const be=j.getSkeleton();return be&&(se.skeleton=g.nodeIndexMap.get(be)),se.joints=j.listJoints().map(Se=>g.nodeIndexMap.get(Se)),g.skinIndexMap.set(j,F),se}),l.listNodes().forEach((j,F)=>{const se=c.nodes[F],pe=j.getMesh();pe&&(se.mesh=g.meshIndexMap.get(pe));const be=j.getCamera();be&&(se.camera=g.cameraIndexMap.get(be));const Se=j.getSkin();Se&&(se.skin=g.skinIndexMap.get(Se)),j.listChildren().length>0&&(se.children=j.listChildren().map(Be=>g.nodeIndexMap.get(Be)))}),c.animations=l.listAnimations().map((j,F)=>{const se=g.createPropertyDef(j),pe=new Map;return se.samplers=j.listSamplers().map((be,Se)=>{const Be=g.createPropertyDef(be);return Be.input=g.accessorIndexMap.get(be.getInput()),Be.output=g.accessorIndexMap.get(be.getOutput()),Be.interpolation=be.getInterpolation(),pe.set(be,Se),Be}),se.channels=j.listChannels().map(be=>{const Se=g.createPropertyDef(be);return Se.sampler=pe.get(be.getSampler()),Se.target={node:g.nodeIndexMap.get(be.getTargetNode()),path:be.getTargetPath()},Se}),g.animationIndexMap.set(j,F),se}),c.scenes=l.listScenes().map((j,F)=>{const se=g.createPropertyDef(j);return se.nodes=j.listChildren().map(pe=>g.nodeIndexMap.get(pe)),g.sceneIndexMap.set(j,F),se});const Z=l.getDefaultScene();return Z&&(c.scene=l.listScenes().indexOf(Z)),c.extensionsUsed=S.map(j=>j.extensionName),c.extensionsRequired=C.map(j=>j.extensionName),S.forEach(j=>j.write(g)),function(j){const F=[];for(const se in j){const pe=j[se];(Array.isArray(pe)&&pe.length===0||pe===null||pe===""||pe&&typeof pe=="object"&&Object.keys(pe).length===0)&&F.push(se)}for(const se of F)delete j[se]}(c),f}}).write(e,{format:t.format||Og.GLTF,basename:t.basename||"",logger:this.M,vertexLayout:this.U,dependencies:_c({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:Og.GLB}),s=new Uint32Array([1179937895,2,12]),l=JSON.stringify(t),c=Xr.pad(Xr.encodeText(l),32),f=Xr.toView(new Uint32Array([c.byteLength,1313821514])),g=Xr.concat([f,c]);s[s.length-1]+=g.byteLength;const y=Object.values(n)[0];if(!y||!y.byteLength)return Xr.concat([Xr.toView(s),g]);const x=Xr.pad(y,0),S=Xr.toView(new Uint32Array([x.byteLength,5130562])),C=Xr.concat([S,x]);return s[s.length-1]+=C.byteLength,Xr.concat([Xr.toView(s),g,C])}async L(e,t){var n=this;const s=[...e.json.images||[],...e.json.buffers||[]].map(async function(l){const c=l.uri;if(!c||c.match(/data:/))return Promise.resolve();e.resources[c]=await n.readURI(n.resolve(t,c),"view"),n.lastReadBytes+=e.resources[c].byteLength});await Promise.all(s)}j(e){function t(n){if(n.uri){if(n.uri in e.resources)Xr.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const s=`__${function(){for(let l=0;l<999;l++){const c=pP();if(!DT.has(c))return DT.add(c),c}return""}()}.${Bv.extension(n.uri)}`;e.resources[s]=Xr.createBufferFromDataURI(n.uri),n.uri=s}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(n)}),(e.json.buffers||[]).forEach(t)}D(e){const{images:t,buffers:n}=e.json;return e={json:_c({},e.json),resources:_c({},e.resources)},t&&(e.json.images=t.map(s=>_c({},s))),n&&(e.json.buffers=n.map(s=>_c({},s))),e}P(e){if(!GT(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==Tx.JSON)throw new Error("Missing required GLB JSON chunk.");const n=t[0],s=Xr.decodeText(Xr.toView(e,20,n)),l=JSON.parse(s),c=20+n;if(e.byteLength<=c)return{json:l,resources:{}};const f=new Uint32Array(e.buffer,e.byteOffset+c,2);if(f[1]!==Tx.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:l,resources:{"@glb.bin":Xr.toView(e,c+8,f[0])}}}}function GT(a){if(a.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(a.buffer,a.byteOffset,3);return e[0]===1179937895&&e[1]===2}class xP extends bP{constructor(e=Wy.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,t){const n=await fetch(e,this.k);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return Wy.resolve(e,t)}dirname(e){return Wy.dirname(e)}}const wP=64;class EP{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Xy{constructor(e,t,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const Ql=[171,75,84,88,32,50,48,187,13,10,26,10];function HT(a){return typeof TextDecoder<"u"?new TextDecoder().decode(a):Buffer.from(a).toString("utf8")}function C1(a){const e=new Uint8Array(a.buffer,a.byteOffset,Ql.length);if(e[0]!==Ql[0]||e[1]!==Ql[1]||e[2]!==Ql[2]||e[3]!==Ql[3]||e[4]!==Ql[4]||e[5]!==Ql[5]||e[6]!==Ql[6]||e[7]!==Ql[7]||e[8]!==Ql[8]||e[9]!==Ql[9]||e[10]!==Ql[10]||e[11]!==Ql[11])throw new Error("Missing KTX 2.0 identifier.");const t=new EP,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Xy(a,Ql.length,n,!0);t.vkFormat=s._nextUint32(),t.typeSize=s._nextUint32(),t.pixelWidth=s._nextUint32(),t.pixelHeight=s._nextUint32(),t.pixelDepth=s._nextUint32(),t.layerCount=s._nextUint32(),t.faceCount=s._nextUint32();const l=s._nextUint32();t.supercompressionScheme=s._nextUint32();const c=s._nextUint32(),f=s._nextUint32(),g=s._nextUint32(),y=s._nextUint32(),x=s._nextUint64(),S=s._nextUint64(),C=3*l*8,L=new Xy(a,Ql.length+n,C,!0);for(let Qt=0;Qt<l;Qt++)t.levels.push({levelData:new Uint8Array(a.buffer,a.byteOffset+L._nextUint64(),L._nextUint64()),uncompressedByteLength:L._nextUint64()});const B=new Xy(a,c,f,!0),W={vendorId:B._skip(4)._nextUint16(),descriptorType:B._nextUint16(),versionNumber:B._nextUint16(),descriptorBlockSize:B._nextUint16(),colorModel:B._nextUint8(),colorPrimaries:B._nextUint8(),transferFunction:B._nextUint8(),flags:B._nextUint8(),texelBlockDimension:[B._nextUint8(),B._nextUint8(),B._nextUint8(),B._nextUint8()],bytesPlane:[B._nextUint8(),B._nextUint8(),B._nextUint8(),B._nextUint8(),B._nextUint8(),B._nextUint8(),B._nextUint8(),B._nextUint8()],samples:[]},q=(W.descriptorBlockSize/4-6)/4;for(let Qt=0;Qt<q;Qt++){const Ht={bitOffset:B._nextUint16(),bitLength:B._nextUint8(),channelType:B._nextUint8(),samplePosition:[B._nextUint8(),B._nextUint8(),B._nextUint8(),B._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};Ht.channelType&wP?(Ht.sampleLower=B._nextInt32(),Ht.sampleUpper=B._nextInt32()):(Ht.sampleLower=B._nextUint32(),Ht.sampleUpper=B._nextUint32()),W.samples[Qt]=Ht}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(W);const Z=new Xy(a,g,y,!0);for(;Z._offset<y;){const Qt=Z._nextUint32(),Ht=Z._scan(Qt),Cn=HT(Ht),un=Z._scan(Qt-Ht.byteLength);t.keyValue[Cn]=Cn.match(/^ktx/i)?HT(un):un,Z._offset%4&&Z._skip(4-Z._offset%4)}if(S<=0)return t;const j=new Xy(a,x,S,!0),F=j._nextUint16(),se=j._nextUint16(),pe=j._nextUint32(),be=j._nextUint32(),Se=j._nextUint32(),Be=j._nextUint32(),Ge=[];for(let Qt=0;Qt<l;Qt++)Ge.push({imageFlags:j._nextUint32(),rgbSliceByteOffset:j._nextUint32(),rgbSliceByteLength:j._nextUint32(),alphaSliceByteOffset:j._nextUint32(),alphaSliceByteLength:j._nextUint32()});const Xe=x+j._offset,Qe=Xe+pe,at=Qe+be,Ke=at+Se,Je=new Uint8Array(a.buffer,a.byteOffset+Xe,pe),ft=new Uint8Array(a.buffer,a.byteOffset+Qe,be),mt=new Uint8Array(a.buffer,a.byteOffset+at,Se),vt=new Uint8Array(a.buffer,a.byteOffset+Ke,Be);return t.globalData={endpointCount:F,selectorCount:se,imageDescs:Ge,endpointsData:Je,selectorsData:ft,tablesData:mt,extendedData:vt},t}class WT extends Io{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[yi.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}WT.EXTENSION_NAME="EXT_mesh_gpu_instancing";const zg="EXT_mesh_gpu_instancing";class QT extends so{constructor(...e){super(...e),this.extensionName=zg,this.provideTypes=[yi.NODE],this.prewriteTypes=[yi.ACCESSOR]}createInstancedMesh(){return new WT(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((t,n)=>{if(!t.extensions||!t.extensions[zg])return;const s=t.extensions[zg],l=this.createInstancedMesh();for(const c in s.attributes)l.setAttribute(c,e.accessors[s.attributes[c]]);e.nodes[n].setExtension(zg,l)}),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(zg);if(s){const l=e.nodeIndexMap.get(n),c=t.json.nodes[l],f={attributes:{}};s.listSemantics().forEach(g=>{const y=s.getAttribute(g);f.attributes[g]=e.accessorIndexMap.get(y)}),c.extensions=c.extensions||{},c.extensions[zg]=f}}),this}}function rm(){return(rm=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a}).apply(this,arguments)}var qy,kv,qo;QT.EXTENSION_NAME=zg,function(a){a.QUANTIZE="quantize",a.FILTER="filter"}(qy||(qy={})),function(a){a.ATTRIBUTES="ATTRIBUTES",a.TRIANGLES="TRIANGLES",a.INDICES="INDICES"}(kv||(kv={})),function(a){a.NONE="NONE",a.OCTAHEDRAL="OCTAHEDRAL",a.QUATERNION="QUATERNION",a.EXPONENTIAL="EXPONENTIAL"}(qo||(qo={}));const{BYTE:SP,SHORT:XT,FLOAT:TP}=zi.ComponentType,{encodeNormalizedInt:qT,decodeNormalizedInt:R1}=Ks;function MP(a,e,t,n){const{filter:s,bits:l}=n,c={array:a.getArray(),byteStride:a.getElementSize()*a.getComponentSize(),componentType:a.getComponentType(),normalized:a.getNormalized()};if(t!==kv.ATTRIBUTES)return c;if(s!==qo.NONE){let f=a.getNormalized()?function(g){const y=g.getComponentType(),x=g.getArray(),S=new Float32Array(x.length);for(let C=0;C<x.length;C++)S[C]=R1(x[C],y);return S}(a):new Float32Array(c.array);switch(s){case qo.EXPONENTIAL:c.byteStride=4*a.getElementSize(),c.componentType=TP,c.normalized=!1,c.array=e.encodeFilterExp(f,a.getCount(),c.byteStride,l);break;case qo.OCTAHEDRAL:c.byteStride=l>8?8:4,c.componentType=l>8?XT:SP,c.normalized=!0,f=a.getElementSize()===3?function(g){const y=new Float32Array(4*g.length/3);for(let x=0,S=g.length/3;x<S;x++)y[4*x]=g[3*x],y[4*x+1]=g[3*x+1],y[4*x+2]=g[3*x+2];return y}(f):f,c.array=e.encodeFilterOct(f,a.getCount(),c.byteStride,l);break;case qo.QUATERNION:c.byteStride=8,c.componentType=XT,c.normalized=!0,c.array=e.encodeFilterQuat(f,a.getCount(),c.byteStride,l);break;default:throw new Error("Invalid filter.")}c.min=a.getMin([]),c.max=a.getMax([]),a.getNormalized()&&(c.min=c.min.map(g=>R1(g,a.getComponentType())),c.max=c.max.map(g=>R1(g,a.getComponentType()))),c.normalized&&(c.min=c.min.map(g=>qT(g,c.componentType)),c.max=c.max.map(g=>qT(g,c.componentType)))}else c.byteStride%4&&(c.array=function(f,g){const y=Xr.padNumber(f.BYTES_PER_ELEMENT*g)/f.BYTES_PER_ELEMENT,x=new f.constructor(f.length/g*y);for(let S=0;S*g<f.length;S++)for(let C=0;C<g;C++)x[S*y+C]=f[S*g+C];return x}(c.array,a.getElementSize()),c.byteStride=c.array.byteLength/a.getCount());return c}function CP(a,e){return e===sd.BufferViewUsage.ELEMENT_ARRAY_BUFFER?a.listParents().some(t=>t instanceof Fg&&t.getMode()===Fg.Mode.TRIANGLES)?kv.TRIANGLES:kv.INDICES:kv.ATTRIBUTES}function RP(a,e){const t=e.getGraph().listParentEdges(a).filter(n=>!(n.getParent()instanceof zT));for(const n of t){const s=n.getName(),l=n.getAttributes().key||"";if(s==="indices")return{filter:qo.NONE};if(s==="attributes"){if(l==="POSITION")return{filter:qo.NONE};if(l==="TEXCOORD_0")return{filter:qo.NONE};if(l==="NORMAL")return{filter:qo.OCTAHEDRAL,bits:8};if(l==="TANGENT")return{filter:qo.OCTAHEDRAL,bits:8};if(l.startsWith("JOINTS_"))return{filter:qo.NONE};if(l.startsWith("WEIGHTS_"))return{filter:qo.NONE}}if(s==="output"){const c=YT(a);return c==="rotation"?{filter:qo.QUATERNION,bits:16}:c==="translation"||c==="scale"?{filter:qo.EXPONENTIAL,bits:12}:{filter:qo.NONE}}if(s==="input")return{filter:qo.NONE};if(s==="inverseBindMatrices")return{filter:qo.NONE}}return{filter:qo.NONE}}function YT(a){for(const e of a.listParents())if(e instanceof Ov){for(const t of e.listParents())if(t instanceof M1)return t.getTargetPath()}return null}const Xl="EXT_meshopt_compression",KT={method:qy.QUANTIZE};class I1 extends so{constructor(...e){super(...e),this.extensionName=Xl,this.prereadTypes=[yi.BUFFER,yi.PRIMITIVE],this.prewriteTypes=[yi.BUFFER,yi.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=KT,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=rm({},KT,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Xl}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Xl}]: Missing WASM support.`)}return t===yi.BUFFER?this._prereadBuffers(e):t===yi.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n,s)=>{if(!n.extensions||!n.extensions[Xl])return;const l=n.extensions[Xl],c=l.byteOffset||0,f=l.byteLength||0,g=l.count,y=l.byteStride,x=new Uint8Array(g*y),S=t.json.buffers[l.buffer],C=Xr.toView(S.uri?t.resources[S.uri]:t.resources[MT],c,f);this._decoder.decodeGltfBuffer(x,g,y,C,l.mode,l.filter),e.bufferViews[s]=x})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(n=>{var s;n.extensions&&n.extensions[Xl]&&(s=t.json.buffers[n.buffer]).extensions&&s.extensions.EXT_meshopt_compression&&s.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[Xl].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const s of t.listParents())s instanceof zi&&s.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===yi.ACCESSOR?this._prewriteAccessors(e):t===yi.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,l=this.document.createBuffer(),c=this.document.getRoot().listBuffers().indexOf(l);this._encoderFallbackBuffer=l,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const f of this.document.getRoot().listAccessors()){if(YT(f)==="weights"||f.getSparse())continue;const g=e.getAccessorUsage(f),y=CP(f,g),x=s.method===qy.FILTER?RP(f,this.document):{filter:qo.NONE},S=MP(f,n,y,x),{array:C,byteStride:L}=S,B=f.getBuffer();if(!B)throw new Error(`${Xl}: Missing buffer for accessor.`);const W=this.document.getRoot().listBuffers().indexOf(B),q=[g,y,x.filter,L,W].join(":");let Z=this._encoderBufferViews[q],j=this._encoderBufferViewData[q],F=this._encoderBufferViewAccessors[q];Z&&j||(F=this._encoderBufferViewAccessors[q]=[],j=this._encoderBufferViewData[q]=[],Z=this._encoderBufferViews[q]={buffer:c,target:sd.USAGE_TO_TARGET[g],byteOffset:0,byteLength:0,byteStride:g===sd.BufferViewUsage.ARRAY_BUFFER?L:void 0,extensions:{[Xl]:{buffer:W,byteOffset:0,byteLength:0,mode:y,filter:x.filter!==qo.NONE?x.filter:void 0,byteStride:L,count:0}}});const se=e.createAccessorDef(f);se.componentType=S.componentType,se.normalized=S.normalized,se.byteOffset=Z.byteLength,se.min&&S.min&&(se.min=S.min),se.max&&S.max&&(se.max=S.max),e.accessorIndexMap.set(f,t.accessors.length),t.accessors.push(se),F.push(se),j.push(new Uint8Array(C.buffer,C.byteOffset,C.byteLength)),Z.byteLength+=C.byteLength,Z.extensions.EXT_meshopt_compression.count+=f.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],l=this._encoderBufferViewData[n],c=this.document.getRoot().listBuffers()[s.extensions[Xl].buffer],f=e.otherBufferViews.get(c)||[],{count:g,byteStride:y,mode:x}=s.extensions[Xl],S=Xr.concat(l),C=t.encodeGltfBuffer(S,g,y,x),L=Xr.pad(C);s.extensions[Xl].byteLength=C.byteLength,l.length=0,l.push(L),f.push(L),e.otherBufferViews.set(c,f)}}write(e){let t=0;for(const c in this._encoderBufferViews){const f=this._encoderBufferViews[c],g=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[c][0]),y=this._encoderBufferViewAccessors[c];for(const C of y)C.bufferView=g;const x=e.jsonDoc.json.bufferViews[g],S=x.byteOffset||0;Object.assign(x,f),x.byteOffset=t,x.extensions[Xl].byteOffset=S,t+=Xr.padNumber(f.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),l=e.jsonDoc.json.buffers[s];return l.byteLength=t,l.extensions={[Xl]:{fallback:!0}},n.dispose(),this}}I1.EXTENSION_NAME=Xl,I1.EncoderMethod=qy;const Yy="EXT_texture_avif";class IP{match(e){return e.length>=12&&Xr.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=JT(t,0);if(!n)return null;let s=n.end;for(;n=JT(t,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class $T extends so{constructor(...e){super(...e),this.extensionName=Yy,this.prereadTypes=[yi.TEXTURE]}static register(){rd.registerFormat("image/avif",new IP)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[Yy]&&(t.source=t.extensions[Yy].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(l=>{l.source===s&&(l.extensions=l.extensions||{},l.extensions[Yy]={source:l.source},delete l.source)})}}),this}}function JT(a,e){if(a.byteLength<4+e)return null;const t=a.getUint32(e);return a.byteLength<t+e||t<8?null:{type:Xr.decodeText(new Uint8Array(a.buffer,a.byteOffset+e+4,4)),start:e+8,end:e+t}}$T.EXTENSION_NAME=Yy;const Ky="EXT_texture_webp";class PP{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Xr.decodeText(e.slice(0,4)),n=Xr.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let l=12;for(;l<s.byteLength;){const c=Xr.decodeText(new Uint8Array([s.getUint8(l),s.getUint8(l+1),s.getUint8(l+2),s.getUint8(l+3)])),f=s.getUint32(l+4,!0);if(c==="VP8 ")return[16383&s.getInt16(l+14,!0),16383&s.getInt16(l+16,!0)];if(c==="VP8L"){const g=s.getUint8(l+9),y=s.getUint8(l+10),x=s.getUint8(l+11);return[1+((63&y)<<8|g),1+((15&s.getUint8(l+12))<<10|x<<2|(192&y)>>6)]}l+=8+f+f%2}return null}getChannels(e){return 4}}class ZT extends so{constructor(...e){super(...e),this.extensionName=Ky,this.prereadTypes=[yi.TEXTURE]}static register(){rd.registerFormat("image/webp",new PP)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[Ky]&&(t.source=t.extensions[Ky].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(l=>{l.source===s&&(l.extensions=l.extensions||{},l.extensions[Ky]={source:l.source},delete l.source)})}}),this}}ZT.EXTENSION_NAME=Ky;const eM="KHR_draco_mesh_compression";let Aa,tM,nM,vc;function DP(a,e){const t=new Aa.DecoderBuffer;try{if(t.Init(e,e.length),a.GetEncodedGeometryType(t)!==Aa.TRIANGULAR_MESH)throw new Error(`[${eM}] Unknown geometry type.`);const n=new Aa.Mesh;if(!a.DecodeBufferToMesh(t,n).ok()||n.ptr===0)throw new Error(`[${eM}] Decoding failure.`);return n}finally{Aa.destroy(t)}}function LP(a,e){const t=3*e.num_faces();let n,s;if(e.num_points()<=65534){const l=t*Uint16Array.BYTES_PER_ELEMENT;n=Aa._malloc(l),a.GetTrianglesUInt16Array(e,l,n),s=new Uint16Array(Aa.HEAPU16.buffer,n,t).slice()}else{const l=t*Uint32Array.BYTES_PER_ELEMENT;n=Aa._malloc(l),a.GetTrianglesUInt32Array(e,l,n),s=new Uint32Array(Aa.HEAPU32.buffer,n,t).slice()}return Aa._free(n),s}function BP(a,e,t,n){const s=nM[n.componentType],l=tM[n.componentType],c=t.num_components(),f=e.num_points()*c,g=f*l.BYTES_PER_ELEMENT,y=Aa._malloc(g);a.GetAttributeDataArrayForAllPoints(e,t,s,g,y);const x=new l(Aa.HEAPF32.buffer,y,f).slice();return Aa._free(y),x}var $y,Iu;(function(a){a[a.EDGEBREAKER=1]="EDGEBREAKER",a[a.SEQUENTIAL=0]="SEQUENTIAL"})($y||($y={})),function(a){a.POSITION="POSITION",a.NORMAL="NORMAL",a.COLOR="COLOR",a.TEX_COORD="TEX_COORD",a.GENERIC="GENERIC"}(Iu||(Iu={}));const iM={[Iu.POSITION]:14,[Iu.NORMAL]:10,[Iu.COLOR]:8,[Iu.TEX_COORD]:12,[Iu.GENERIC]:12},rM={decodeSpeed:5,encodeSpeed:5,method:$y.EDGEBREAKER,quantizationBits:iM,quantizationVolume:"mesh"};function OP(a,e=rM){const t=rm({},rM,e);t.quantizationBits=rm({},iM,e.quantizationBits);const n=new vc.Encoder,s=new vc.MeshBuilder,l=new vc.Mesh,c={},f=new vc.DracoInt8Array,g=a.listTargets().length>0;let y=!1;for(const q of a.listSemantics()){const Z=a.getAttribute(q);if(Z.getSparse()){y=!0;continue}const j=NP(q),F=kP(s,Z.getComponentType(),l,vc[j],Z.getCount(),Z.getElementSize(),Z.getArray());if(F===-1)throw new Error(`Error compressing "${q}" attribute.`);if(c[q]=F,t.quantizationVolume==="mesh"||q!=="POSITION")n.SetAttributeQuantization(vc[j],t.quantizationBits[j]);else{if(typeof t.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:se}=t,pe=Math.max(se.max[0]-se.min[0],se.max[1]-se.min[1],se.max[2]-se.min[2]);n.SetAttributeExplicitQuantization(vc[j],t.quantizationBits[j],Z.getElementSize(),se.min,pe)}}}const x=a.getIndices();if(!x)throw new Mx("Primitive must have indices.");s.AddFacesToMesh(l,x.getCount()/3,x.getArray()),n.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),n.SetTrackEncodedProperties(!0),n.SetEncodingMethod(t.method===$y.SEQUENTIAL||g||y?vc.MESH_SEQUENTIAL_ENCODING:vc.MESH_EDGEBREAKER_ENCODING);const S=n.EncodeMeshToDracoBuffer(l,f);if(S<=0)throw new Mx("Error applying Draco compression.");const C=new Uint8Array(S);for(let q=0;q<S;++q)C[q]=f.GetValue(q);const L=a.getAttribute("POSITION").getCount(),B=n.GetNumberOfEncodedPoints(),W=3*n.GetNumberOfEncodedFaces();if((g||y)&&B!==L)throw new Mx('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return vc.destroy(f),vc.destroy(l),vc.destroy(s),vc.destroy(n),{numVertices:B,numIndices:W,data:C,attributeIDs:c}}function NP(a){return a==="POSITION"?Iu.POSITION:a==="NORMAL"?Iu.NORMAL:a.startsWith("COLOR_")?Iu.COLOR:a.startsWith("TEXCOORD_")?Iu.TEX_COORD:Iu.GENERIC}function kP(a,e,t,n,s,l,c){switch(e){case zi.ComponentType.UNSIGNED_BYTE:return a.AddUInt8Attribute(t,n,s,l,c);case zi.ComponentType.BYTE:return a.AddInt8Attribute(t,n,s,l,c);case zi.ComponentType.UNSIGNED_SHORT:return a.AddUInt16Attribute(t,n,s,l,c);case zi.ComponentType.SHORT:return a.AddInt16Attribute(t,n,s,l,c);case zi.ComponentType.UNSIGNED_INT:return a.AddUInt32Attribute(t,n,s,l,c);case zi.ComponentType.FLOAT:return a.AddFloatAttribute(t,n,s,l,c);default:throw new Error(`Unexpected component type, "${e}".`)}}class Mx extends Error{}const Yo="KHR_draco_mesh_compression";class Jy extends so{constructor(...e){super(...e),this.extensionName=Yo,this.prereadTypes=[yi.PRIMITIVE],this.prewriteTypes=[yi.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,Aa=this._decoderModule,tM={[zi.ComponentType.FLOAT]:Float32Array,[zi.ComponentType.UNSIGNED_INT]:Uint32Array,[zi.ComponentType.UNSIGNED_SHORT]:Uint16Array,[zi.ComponentType.UNSIGNED_BYTE]:Uint8Array,[zi.ComponentType.SHORT]:Int16Array,[zi.ComponentType.BYTE]:Int8Array},nM={[zi.ComponentType.FLOAT]:Aa.DT_FLOAT32,[zi.ComponentType.UNSIGNED_INT]:Aa.DT_UINT32,[zi.ComponentType.UNSIGNED_SHORT]:Aa.DT_UINT16,[zi.ComponentType.UNSIGNED_BYTE]:Aa.DT_UINT8,[zi.ComponentType.SHORT]:Aa.DT_INT16,[zi.ComponentType.BYTE]:Aa.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=t,vc=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Yo}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const l=n.json.meshes||[];for(const c of l)for(const f of c.primitives){if(!f.extensions||!f.extensions[Yo])continue;const g=f.extensions[Yo];let[y,x]=s.get(g.bufferView)||[];if(!x||!y){const S=n.json.bufferViews[g.bufferView],C=n.json.buffers[S.buffer],L=Xr.toView(C.uri?n.resources[C.uri]:n.resources[MT],S.byteOffset||0,S.byteLength);y=new this._decoderModule.Decoder,x=DP(y,L),s.set(g.bufferView,[y,x]),t.debug(`[${Yo}] Decompressed ${L.byteLength} bytes.`)}for(const S in f.attributes){const C=e.jsonDoc.json.accessors[f.attributes[S]],L=y.GetAttributeByUniqueId(x,g.attributes[S]),B=BP(y,x,L,C);e.accessors[f.attributes[S]].setArray(B)}f.indices!==void 0&&e.accessors[f.indices].setArray(LP(y,x))}}finally{for(const[l,c]of Array.from(s.values()))this._decoderModule.destroy(l),this._decoderModule.destroy(c)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Yo}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Yo}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=function(f){const g=f.getLogger(),y=new Set,x=new Set;for(const q of f.getRoot().listMeshes())for(const Z of q.listPrimitives())Z.getIndices()?Z.getMode()!==Fg.Mode.TRIANGLES?(x.add(Z),g.warn(`[${Yo}] Skipping Draco compression on non-TRIANGLES primitive.`)):y.add(Z):(x.add(Z),g.warn(`[${Yo}] Skipping Draco compression on non-indexed primitive.`));const S=f.getRoot().listAccessors(),C=new Map;for(let q=0;q<S.length;q++)C.set(S[q],q);const L=new Map,B=new Set,W=new Map;for(const q of Array.from(y)){let Z=sM(q,C);if(B.has(Z))W.set(q,Z);else{if(L.has(q.getIndices())){const j=q.getIndices(),F=j.clone();C.set(F,f.getRoot().listAccessors().length-1),q.swap(j,F)}for(const j of q.listAttributes())if(L.has(j)){const F=j.clone();C.set(F,f.getRoot().listAccessors().length-1),q.swap(j,F)}Z=sM(q,C),B.add(Z),W.set(q,Z),L.set(q.getIndices(),Z);for(const j of q.listAttributes())L.set(j,Z)}}for(const q of Array.from(L.keys())){const Z=new Set(q.listParents().map(j=>j.propertyType));if(Z.size!==2||!Z.has(yi.PRIMITIVE)||!Z.has(yi.ROOT))throw new Error(`[${Yo}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const q of Array.from(y)){const Z=W.get(q),j=q.getIndices();if(L.get(j)!==Z||q.listAttributes().some(F=>L.get(F)!==Z))throw new Error(`[${Yo}] Draco primitives must share all, or no, accessors.`)}for(const q of Array.from(x)){const Z=q.getIndices();if(L.has(Z)||q.listAttributes().some(j=>L.has(j)))throw new Error(`[${Yo}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return W}(this.document),l=new Map;let c="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Yo}]: quantizationVolume=scene requires exactly 1 scene.`):c=function(f){const g={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},y=f.propertyType===yi.NODE?[f]:f.listChildren();for(const x of y)x.traverse(S=>{const C=S.getMesh();if(!C)return;const L=aP(C,S.getWorldMatrix());S1(L.min,g),S1(L.max,g)});return g}(this.document.getRoot().listScenes().pop()));for(const f of Array.from(s.keys())){const g=s.get(f);if(!g)throw new Error("Unexpected primitive.");if(l.has(g)){l.set(g,l.get(g));continue}const y=f.getIndices(),x=e.jsonDoc.json.accessors;let S;try{S=OP(f,rm({},this._encoderOptions,{quantizationVolume:c}))}catch(B){if(B instanceof Mx){n.warn(`[${Yo}]: ${B.message} Skipping primitive compression.`);continue}throw B}l.set(g,S);const C=e.createAccessorDef(y);C.count=S.numIndices,e.accessorIndexMap.set(y,x.length),x.push(C);for(const B of f.listSemantics()){const W=f.getAttribute(B);if(S.attributeIDs[B]===void 0)continue;const q=e.createAccessorDef(W);q.count=S.numVertices,e.accessorIndexMap.set(W,x.length),x.push(q)}const L=f.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(L)||e.otherBufferViews.set(L,[]),e.otherBufferViews.get(L).push(S.data)}return n.debug(`[${Yo}] Compressed ${s.size} primitives.`),e.extensionData[Yo]={primitiveHashMap:s,primitiveEncodingMap:l},this}write(e){const t=e.extensionData[Yo];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let l=0;l<n.listPrimitives().length;l++){const c=n.listPrimitives()[l],f=s.primitives[l],g=t.primitiveHashMap.get(c);if(!g)continue;const y=t.primitiveEncodingMap.get(g);y&&(f.extensions=f.extensions||{},f.extensions[Yo]={bufferView:e.otherBufferViewsIndexMap.get(y.data),attributes:y.attributeIDs})}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==Yo),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==Yo)}return this}}function sM(a,e){const t=[],n=a.getIndices();t.push(e.get(n));for(const s of a.listAttributes())t.push(e.get(s));return t.sort().join("|")}Jy.EXTENSION_NAME=Yo,Jy.EncoderMethod=$y;class Uv extends Io{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[yi.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:Uv.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return gc.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return gc.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}Uv.EXTENSION_NAME="KHR_lights_punctual",Uv.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const od="KHR_lights_punctual";class oM extends so{constructor(...e){super(...e),this.extensionName=od}createLight(e=""){return new Uv(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[od])return this;const n=(t.json.extensions[od].lights||[]).map(s=>{var l,c;const f=this.createLight().setName(s.name||"").setType(s.type);return s.color!==void 0&&f.setColor(s.color),s.intensity!==void 0&&f.setIntensity(s.intensity),s.range!==void 0&&f.setRange(s.range),((l=s.spot)==null?void 0:l.innerConeAngle)!==void 0&&f.setInnerConeAngle(s.spot.innerConeAngle),((c=s.spot)==null?void 0:c.outerConeAngle)!==void 0&&f.setOuterConeAngle(s.spot.outerConeAngle),f});return t.json.nodes.forEach((s,l)=>{s.extensions&&s.extensions[od]&&e.nodes[l].setExtension(od,n[s.extensions[od].light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const l of this.properties){const c=l,f={type:c.getType()};Ks.eq(c.getColor(),[1,1,1])||(f.color=c.getColor()),c.getIntensity()!==1&&(f.intensity=c.getIntensity()),c.getRange()!=null&&(f.range=c.getRange()),c.getName()&&(f.name=c.getName()),c.getType()===Uv.Type.SPOT&&(f.spot={innerConeAngle:c.getInnerConeAngle(),outerConeAngle:c.getOuterConeAngle()}),n.push(f),s.set(c,n.length-1)}return this.document.getRoot().listNodes().forEach(l=>{const c=l.getExtension(od);if(c){const f=e.nodeIndexMap.get(l),g=t.json.nodes[f];g.extensions=g.extensions||{},g.extensions[od]={light:s.get(c)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[od]={lights:n},this}}oM.EXTENSION_NAME=od;const{R:UP,G:FP}=bo;class aM extends Io{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new $s(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:UP|FP})}}aM.EXTENSION_NAME="KHR_materials_anisotropy";const Vg="KHR_materials_anisotropy";class lM extends so{constructor(...e){super(...e),this.extensionName=Vg}createAnisotropy(){return new aM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((s,l)=>{if(s.extensions&&s.extensions[Vg]){const c=this.createAnisotropy();e.materials[l].setExtension(Vg,c);const f=s.extensions[Vg];if(f.anisotropyStrength!==void 0&&c.setAnisotropyStrength(f.anisotropyStrength),f.anisotropyRotation!==void 0&&c.setAnisotropyRotation(f.anisotropyRotation),f.anisotropyTexture!==void 0){const g=f.anisotropyTexture;c.setAnisotropyTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getAnisotropyTextureInfo(),g)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Vg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{};const f=c.extensions[Vg]={};if(s.getAnisotropyStrength()>0&&(f.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(f.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const g=s.getAnisotropyTexture(),y=s.getAnisotropyTextureInfo();f.anisotropyTexture=e.createTextureInfoDef(g,y)}}}),this}}lM.EXTENSION_NAME=Vg;const{R:cM,G:uM,B:zP}=bo;class hM extends Io{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new $s(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new $s(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new $s(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:cM})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:uM})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:cM|uM|zP})}}hM.EXTENSION_NAME="KHR_materials_clearcoat";const jg="KHR_materials_clearcoat";class dM extends so{constructor(...e){super(...e),this.extensionName=jg}createClearcoat(){return new hM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((s,l)=>{if(s.extensions&&s.extensions[jg]){const c=this.createClearcoat();e.materials[l].setExtension(jg,c);const f=s.extensions[jg];if(f.clearcoatFactor!==void 0&&c.setClearcoatFactor(f.clearcoatFactor),f.clearcoatRoughnessFactor!==void 0&&c.setClearcoatRoughnessFactor(f.clearcoatRoughnessFactor),f.clearcoatTexture!==void 0){const g=f.clearcoatTexture;c.setClearcoatTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getClearcoatTextureInfo(),g)}if(f.clearcoatRoughnessTexture!==void 0){const g=f.clearcoatRoughnessTexture;c.setClearcoatRoughnessTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getClearcoatRoughnessTextureInfo(),g)}if(f.clearcoatNormalTexture!==void 0){const g=f.clearcoatNormalTexture;c.setClearcoatNormalTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getClearcoatNormalTextureInfo(),g),g.scale!==void 0&&c.setClearcoatNormalScale(g.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(jg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{};const f=c.extensions[jg]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const g=s.getClearcoatTexture(),y=s.getClearcoatTextureInfo();f.clearcoatTexture=e.createTextureInfoDef(g,y)}if(s.getClearcoatRoughnessTexture()){const g=s.getClearcoatRoughnessTexture(),y=s.getClearcoatRoughnessTextureInfo();f.clearcoatRoughnessTexture=e.createTextureInfoDef(g,y)}if(s.getClearcoatNormalTexture()){const g=s.getClearcoatNormalTexture(),y=s.getClearcoatNormalTextureInfo();f.clearcoatNormalTexture=e.createTextureInfoDef(g,y),s.getClearcoatNormalScale()!==1&&(f.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}dM.EXTENSION_NAME=jg;class pM extends Io{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}pM.EXTENSION_NAME="KHR_materials_emissive_strength";const Gg="KHR_materials_emissive_strength";class fM extends so{constructor(...e){super(...e),this.extensionName=Gg}createEmissiveStrength(){return new pM(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[Gg]){const s=this.createEmissiveStrength();e.materials[n].setExtension(Gg,s);const l=t.extensions[Gg];l.emissiveStrength!==void 0&&s.setEmissiveStrength(l.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Gg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{},c.extensions[Gg]={emissiveStrength:s.getEmissiveStrength()}}}),this}}fM.EXTENSION_NAME=Gg;class mM extends Io{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}mM.EXTENSION_NAME="KHR_materials_ior";const Hg="KHR_materials_ior";class gM extends so{constructor(...e){super(...e),this.extensionName=Hg}createIOR(){return new mM(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[Hg]){const s=this.createIOR();e.materials[n].setExtension(Hg,s);const l=t.extensions[Hg];l.ior!==void 0&&s.setIOR(l.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Hg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{},c.extensions[Hg]={ior:s.getIOR()}}}),this}}gM.EXTENSION_NAME=Hg;const{R:VP,G:jP}=bo;class _M extends Io{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new $s(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new $s(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:VP})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:jP})}}_M.EXTENSION_NAME="KHR_materials_iridescence";const Wg="KHR_materials_iridescence";class vM extends so{constructor(...e){super(...e),this.extensionName=Wg}createIridescence(){return new _M(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((s,l)=>{if(s.extensions&&s.extensions[Wg]){const c=this.createIridescence();e.materials[l].setExtension(Wg,c);const f=s.extensions[Wg];if(f.iridescenceFactor!==void 0&&c.setIridescenceFactor(f.iridescenceFactor),f.iridescenceIor!==void 0&&c.setIridescenceIOR(f.iridescenceIor),f.iridescenceThicknessMinimum!==void 0&&c.setIridescenceThicknessMinimum(f.iridescenceThicknessMinimum),f.iridescenceThicknessMaximum!==void 0&&c.setIridescenceThicknessMaximum(f.iridescenceThicknessMaximum),f.iridescenceTexture!==void 0){const g=f.iridescenceTexture;c.setIridescenceTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getIridescenceTextureInfo(),g)}if(f.iridescenceThicknessTexture!==void 0){const g=f.iridescenceThicknessTexture;c.setIridescenceThicknessTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getIridescenceThicknessTextureInfo(),g)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Wg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{};const f=c.extensions[Wg]={};if(s.getIridescenceFactor()>0&&(f.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(f.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(f.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(f.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const g=s.getIridescenceTexture(),y=s.getIridescenceTextureInfo();f.iridescenceTexture=e.createTextureInfoDef(g,y)}if(s.getIridescenceThicknessTexture()){const g=s.getIridescenceThicknessTexture(),y=s.getIridescenceThicknessTextureInfo();f.iridescenceThicknessTexture=e.createTextureInfoDef(g,y)}}}),this}}vM.EXTENSION_NAME=Wg;const{R:yM,G:AM,B:bM,A:xM}=bo;class wM extends Io{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new $s(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new $s(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return gc.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(gc.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:yM|AM|bM|xM})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:yM|AM|bM|xM})}}wM.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const Qg="KHR_materials_pbrSpecularGlossiness";class EM extends so{constructor(...e){super(...e),this.extensionName=Qg}createPBRSpecularGlossiness(){return new wM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((s,l)=>{if(s.extensions&&s.extensions[Qg]){const c=this.createPBRSpecularGlossiness();e.materials[l].setExtension(Qg,c);const f=s.extensions[Qg];if(f.diffuseFactor!==void 0&&c.setDiffuseFactor(f.diffuseFactor),f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.glossinessFactor!==void 0&&c.setGlossinessFactor(f.glossinessFactor),f.diffuseTexture!==void 0){const g=f.diffuseTexture;c.setDiffuseTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getDiffuseTextureInfo(),g)}if(f.specularGlossinessTexture!==void 0){const g=f.specularGlossinessTexture;c.setSpecularGlossinessTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getSpecularGlossinessTextureInfo(),g)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Qg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{};const f=c.extensions[Qg]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const g=s.getDiffuseTexture(),y=s.getDiffuseTextureInfo();f.diffuseTexture=e.createTextureInfoDef(g,y)}if(s.getSpecularGlossinessTexture()){const g=s.getSpecularGlossinessTexture(),y=s.getSpecularGlossinessTextureInfo();f.specularGlossinessTexture=e.createTextureInfoDef(g,y)}}}),this}}EM.EXTENSION_NAME=Qg;const{R:GP,G:HP,B:WP,A:QP}=bo;class SM extends Io{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new $s(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new $s(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return gc.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",gc.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:GP|HP|WP})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:QP})}}SM.EXTENSION_NAME="KHR_materials_sheen";const Xg="KHR_materials_sheen";class TM extends so{constructor(...e){super(...e),this.extensionName=Xg}createSheen(){return new SM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((s,l)=>{if(s.extensions&&s.extensions[Xg]){const c=this.createSheen();e.materials[l].setExtension(Xg,c);const f=s.extensions[Xg];if(f.sheenColorFactor!==void 0&&c.setSheenColorFactor(f.sheenColorFactor),f.sheenRoughnessFactor!==void 0&&c.setSheenRoughnessFactor(f.sheenRoughnessFactor),f.sheenColorTexture!==void 0){const g=f.sheenColorTexture;c.setSheenColorTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getSheenColorTextureInfo(),g)}if(f.sheenRoughnessTexture!==void 0){const g=f.sheenRoughnessTexture;c.setSheenRoughnessTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getSheenRoughnessTextureInfo(),g)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Xg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{};const f=c.extensions[Xg]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const g=s.getSheenColorTexture(),y=s.getSheenColorTextureInfo();f.sheenColorTexture=e.createTextureInfoDef(g,y)}if(s.getSheenRoughnessTexture()){const g=s.getSheenRoughnessTexture(),y=s.getSheenRoughnessTextureInfo();f.sheenRoughnessTexture=e.createTextureInfoDef(g,y)}}}),this}}TM.EXTENSION_NAME=Xg;const{R:XP,G:qP,B:YP,A:KP}=bo;class MM extends Io{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new $s(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new $s(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return gc.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",gc.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:KP})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:XP|qP|YP})}}MM.EXTENSION_NAME="KHR_materials_specular";const qg="KHR_materials_specular";class CM extends so{constructor(...e){super(...e),this.extensionName=qg}createSpecular(){return new MM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((s,l)=>{if(s.extensions&&s.extensions[qg]){const c=this.createSpecular();e.materials[l].setExtension(qg,c);const f=s.extensions[qg];if(f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.specularColorFactor!==void 0&&c.setSpecularColorFactor(f.specularColorFactor),f.specularTexture!==void 0){const g=f.specularTexture;c.setSpecularTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getSpecularTextureInfo(),g)}if(f.specularColorTexture!==void 0){const g=f.specularColorTexture;c.setSpecularColorTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getSpecularColorTextureInfo(),g)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(qg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{};const f=c.extensions[qg]={};if(s.getSpecularFactor()!==1&&(f.specularFactor=s.getSpecularFactor()),Ks.eq(s.getSpecularColorFactor(),[1,1,1])||(f.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const g=s.getSpecularTexture(),y=s.getSpecularTextureInfo();f.specularTexture=e.createTextureInfoDef(g,y)}if(s.getSpecularColorTexture()){const g=s.getSpecularColorTexture(),y=s.getSpecularColorTextureInfo();f.specularColorTexture=e.createTextureInfoDef(g,y)}}}),this}}CM.EXTENSION_NAME=qg;const{R:$P}=bo;class RM extends Io{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new $s(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:$P})}}RM.EXTENSION_NAME="KHR_materials_transmission";const Yg="KHR_materials_transmission";class IM extends so{constructor(...e){super(...e),this.extensionName=Yg}createTransmission(){return new RM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((s,l)=>{if(s.extensions&&s.extensions[Yg]){const c=this.createTransmission();e.materials[l].setExtension(Yg,c);const f=s.extensions[Yg];if(f.transmissionFactor!==void 0&&c.setTransmissionFactor(f.transmissionFactor),f.transmissionTexture!==void 0){const g=f.transmissionTexture;c.setTransmissionTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getTransmissionTextureInfo(),g)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Yg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{};const f=c.extensions[Yg]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const g=s.getTransmissionTexture(),y=s.getTransmissionTextureInfo();f.transmissionTexture=e.createTextureInfoDef(g,y)}}}),this}}IM.EXTENSION_NAME=Yg;class PM extends Io{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[yi.MATERIAL]}}PM.EXTENSION_NAME="KHR_materials_unlit";const Fv="KHR_materials_unlit";class DM extends so{constructor(...e){super(...e),this.extensionName=Fv}createUnlit(){return new PM(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{t.extensions&&t.extensions[Fv]&&e.materials[n].setExtension(Fv,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(Fv)){const s=e.materialIndexMap.get(n),l=t.json.materials[s];l.extensions=l.extensions||{},l.extensions[Fv]={}}}),this}}DM.EXTENSION_NAME=Fv;class LM extends Io{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}LM.EXTENSION_NAME="KHR_materials_variants";class BM extends Io{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[yi.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}BM.EXTENSION_NAME="KHR_materials_variants";class P1 extends Io{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}P1.EXTENSION_NAME="KHR_materials_variants";const ad="KHR_materials_variants";class OM extends so{constructor(...e){super(...e),this.extensionName=ad}createMappingList(){return new BM(this.document.getGraph())}createVariant(e=""){return new P1(this.document.getGraph(),e)}createMapping(){return new LM(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof P1)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[ad])return this;const n=(t.json.extensions[ad].variants||[]).map(s=>this.createVariant().setName(s.name||""));return(t.json.meshes||[]).forEach((s,l)=>{const c=e.meshes[l];(s.primitives||[]).forEach((f,g)=>{if(!f.extensions||!f.extensions[ad])return;const y=this.createMappingList(),x=f.extensions[ad];for(const S of x.mappings){const C=this.createMapping();S.material!==void 0&&C.setMaterial(e.materials[S.material]);for(const L of S.variants||[])C.addVariant(n[L]);y.addMapping(C)}c.listPrimitives()[g].setExtension(ad,y)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],l=new Map;for(const c of n)l.set(c,s.length),s.push(e.createPropertyDef(c));for(const c of this.document.getRoot().listMeshes()){const f=e.meshIndexMap.get(c);c.listPrimitives().forEach((g,y)=>{const x=g.getExtension(ad);if(!x)return;const S=e.jsonDoc.json.meshes[f].primitives[y],C=x.listMappings().map(L=>{const B=e.createPropertyDef(L),W=L.getMaterial();return W&&(B.material=e.materialIndexMap.get(W)),B.variants=L.listVariants().map(q=>l.get(q)),B});S.extensions=S.extensions||{},S.extensions[ad]={mappings:C}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[ad]={variants:s},this}}OM.EXTENSION_NAME=ad;const{G:JP}=bo;class NM extends Io{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[yi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new $s(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:JP})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return gc.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",gc.hexToFactor(e,t))}}NM.EXTENSION_NAME="KHR_materials_volume";const Kg="KHR_materials_volume";class kM extends so{constructor(...e){super(...e),this.extensionName=Kg}createVolume(){return new NM(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((s,l)=>{if(s.extensions&&s.extensions[Kg]){const c=this.createVolume();e.materials[l].setExtension(Kg,c);const f=s.extensions[Kg];if(f.thicknessFactor!==void 0&&c.setThicknessFactor(f.thicknessFactor),f.attenuationDistance!==void 0&&c.setAttenuationDistance(f.attenuationDistance),f.attenuationColor!==void 0&&c.setAttenuationColor(f.attenuationColor),f.thicknessTexture!==void 0){const g=f.thicknessTexture;c.setThicknessTexture(e.textures[n[g.index].source]),e.setTextureInfo(c.getThicknessTextureInfo(),g)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Kg);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{};const f=c.extensions[Kg]={};if(s.getThicknessFactor()>0&&(f.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(f.attenuationDistance=s.getAttenuationDistance()),Ks.eq(s.getAttenuationColor(),[1,1,1])||(f.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const g=s.getThicknessTexture(),y=s.getThicknessTextureInfo();f.thicknessTexture=e.createTextureInfoDef(g,y)}}}),this}}kM.EXTENSION_NAME=Kg;const UM="KHR_mesh_quantization";class FM extends so{constructor(...e){super(...e),this.extensionName=UM}read(e){return this}write(e){return this}}FM.EXTENSION_NAME=UM;const Zy="KHR_texture_basisu";class ZP{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=C1(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=C1(e).dataFormatDescriptor[0];if(t.colorModel===163)return t.samples.length===2&&(15&t.samples[1].channelType)==15?4:3;if(t.colorModel===166)return(15&t.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=C1(e),n=this.getChannels(e)>3;let s=0;for(let l=0;l<t.levels.length;l++){const c=t.levels[l];s+=c.uncompressedByteLength?c.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,l)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,l)))/4)*(n?16:8)}return s}}class zM extends so{constructor(...e){super(...e),this.extensionName=Zy,this.prereadTypes=[yi.TEXTURE]}static register(){rd.registerFormat("image/ktx2",new ZP)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{t.extensions&&t.extensions[Zy]&&(t.source=t.extensions[Zy].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);t.json.textures.forEach(l=>{l.source===s&&(l.extensions=l.extensions||{},l.extensions[Zy]={source:l.source},delete l.source)})}}),this}}zM.EXTENSION_NAME=Zy;class VM extends Io{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[yi.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}VM.EXTENSION_NAME="KHR_texture_transform";const $g="KHR_texture_transform";class jM extends so{constructor(...e){super(...e),this.extensionName=$g}createTransform(){return new VM(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[$g])continue;const s=this.createTransform(),l=n.extensions[$g];l.offset!==void 0&&s.setOffset(l.offset),l.rotation!==void 0&&s.setRotation(l.rotation),l.scale!==void 0&&s.setScale(l.scale),l.texCoord!==void 0&&s.setTexCoord(l.texCoord),t.setExtension($g,s)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of t){const l=n.getExtension($g);if(!l)continue;s.extensions=s.extensions||{};const c={},f=Ks.eq;f(l.getOffset(),[0,0])||(c.offset=l.getOffset()),l.getRotation()!==0&&(c.rotation=l.getRotation()),f(l.getScale(),[1,1])||(c.scale=l.getScale()),l.getTexCoord()!=null&&(c.texCoord=l.getTexCoord()),s.extensions[$g]=c}return this}}jM.EXTENSION_NAME=$g;const eD=[yi.ROOT,yi.SCENE,yi.NODE,yi.MESH,yi.MATERIAL,yi.TEXTURE,yi.ANIMATION];class GM extends Io{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=eD}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",rm({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=rm({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return rm({"@context":D1(this.get("context"))},D1(this.get("properties")))}fromJSONLD(e){const t=(e=D1(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function D1(a){return JSON.parse(JSON.stringify(a))}GM.EXTENSION_NAME="KHR_xmp_json_ld";const Mp="KHR_xmp_json_ld";class HM extends so{constructor(...e){super(...e),this.extensionName=Mp}createPacket(){return new GM(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t[Mp];if(!n||!n.packets)return this;const s=e.jsonDoc.json,l=this.document.getRoot(),c=n.packets.map(y=>this.createPacket().fromJSONLD(y)),f=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],g=[[l],l.listScenes(),l.listNodes(),l.listMeshes(),l.listMaterials(),l.listTextures(),l.listAnimations()];for(let y=0;y<f.length;y++){const x=f[y]||[];for(let S=0;S<x.length;S++){const C=x[S];C.extensions&&C.extensions[Mp]&&g[y][S].setExtension(Mp,c[C.extensions[Mp].packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const l of s.listParents()){let c;switch(l.propertyType){case yi.ROOT:c=t.asset;break;case yi.SCENE:c=t.scenes[e.sceneIndexMap.get(l)];break;case yi.NODE:c=t.nodes[e.nodeIndexMap.get(l)];break;case yi.MESH:c=t.meshes[e.meshIndexMap.get(l)];break;case yi.MATERIAL:c=t.materials[e.materialIndexMap.get(l)];break;case yi.TEXTURE:c=t.images[e.imageIndexMap.get(l)];break;case yi.ANIMATION:c=t.animations[e.animationIndexMap.get(l)];break;default:c=null,this.document.getLogger().warn(`[${Mp}]: Unsupported parent property, "${l.propertyType}"`)}c&&(c.extensions=c.extensions||{},c.extensions[Mp]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[Mp]={packets:n}),this}}HM.EXTENSION_NAME=Mp;const tD=[QT,I1,$T,ZT,Jy,oM,lM,dM,fM,gM,vM,EM,CM,TM,IM,DM,OM,kM,FM,zM,jM,HM];class WM extends g1{constructor(e){super(),this._loadedLibs=!1,e=e||{method:Jy.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new xP().registerExtensions(tD).registerExtensions([QM,Lx,Rx,Ix,Px,Bx,Ox,Nx,kx,Ux,Fx,zx,Vx,Gx,jx,Hx,Dx]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,dracoOptions:n,...s}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,s);await this._loadLibs();const l={...s};t&&(l.externalImagesInExtras=!0);const c=await new Promise((C,L)=>this.parse(e,C,L,l)),f=await super.parseAsync(c,l);if(!t)return f;if(!c)throw new Error("GLTFDracoExporter: gltf is null");let g=c;const y=g.byteLength||1/0,x=await(typeof g!="object"||g.byteLength?this._io.readBinary(new Uint8Array(g)):this._io.readJSON({json:g,resources:{}}));if(x.createExtension(Jy).setRequired(!0).setEncoderOptions({...this._encoderOptions,...n??{}}),l.exportExt==="glb")g=await this._io.writeBinary(x),isFinite(y)&&console.log("DRACO Compression ratio: "+(g.byteLength/y).toFixed(5));else{const C=await this._io.writeJSON(x);g=C.json,Object.values(C.resources).filter(L=>L).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),g.resources=C.resources)}g.__isGLTFOutput=!0;const S=await super.parseAsync(g,l);if(!S)throw new Error("GLTFDracoExporter: blob is null");return S.ext="glb",S.__uncompressed=f,S}}class L1 extends Ln{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[ri,im]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer,n=e.getManager().exporter;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(s,l,c){_1(s,l,WM,f=>{const g=mn()+".drc",y=f;y.loader=c.registerFile(g),y.loader.setDecoderConfig({type:"js"}),y.loader.preload(!0,!0)})})(n,e,t)}}L1.PluginType="GLTFDracoExportPlugin";class nD extends Io{constructor(){super(...arguments),this.extensionName=Ra,this.parentTypes=[yi.SCENE],this.propertyType="ViewerJSON"}init(){}}class QM extends so{constructor(){super(...arguments),this.extensionName=Ra,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var t;return this._viewerConfig={},(t=e.jsonDoc.json.scenes)==null||t.forEach((n,s)=>{if(n.extensions&&n.extensions[Ra]){const l=new nD(this.document.getGraph());e.scenes[s].setExtension(Ra,l),this._viewerConfig=n.extensions[Ra]}}),this}write(e){return this.document.getRoot().listScenes().forEach(t=>{var n;if(t.getExtension(Ra)){const s=(n=e.jsonDoc.json.scenes)==null?void 0:n[e.jsonDoc.json.scene||0];s&&Object.keys(this._viewerConfig).length>0&&(s.extensions=s.extensions||{},s.extensions[Ra]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}QM.EXTENSION_NAME=Ra;class Cx extends Io{addTexture(e,t,n,s=4369){this.setRef(e,n,{channels:s}),this.textures[e]=[t,n]}constructor(e,t,n){super(e,t),this.parentTypes=[yi.MATERIAL,yi.MESH,yi.NODE,yi.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=n}init(){}}class Sl extends so{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,n=t.json.materials||[],s=t.json.textures||[];return n.forEach((l,c)=>{var f;if(l.extensions&&l.extensions[this.extensionName]){const g=new Cx(this.document.getGraph(),"",this.extensionName);e.materials[c].setExtension(this.extensionName,g);const y={...l.extensions[this.extensionName]};for(const[x,S]of Object.entries(y))if(typeof(S==null?void 0:S.index)=="number"){const C=S,L=(f=s[C.index])==null?void 0:f.source;if(typeof L!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",C);continue}const B=e.textures[L],W=new $s(this.document.getGraph()),q=this.textureChannels[x]??4369;g.addTexture(x,W,B,q),e.setTextureInfo(W,C),delete y[x]}g.setExtras(y)}}),(t.json.meshes||[]).forEach((l,c)=>{if(l.extensions&&l.extensions[this.extensionName]){const f=new Cx(this.document.getGraph(),"",this.extensionName);e.meshes[c].setExtension(this.extensionName,f);const g=l.extensions[this.extensionName];f.setExtras(g)}}),(t.json.nodes||[]).forEach((l,c)=>{if(l.extensions&&l.extensions[this.extensionName]){const f=new Cx(this.document.getGraph(),"",this.extensionName);e.nodes[c].setExtension(this.extensionName,f);const g=l.extensions[this.extensionName];f.setExtras(g)}}),(t.json.scenes||[]).forEach((l,c)=>{if(l.extensions&&l.extensions[this.extensionName]){const f=new Cx(this.document.getGraph(),"",this.extensionName);e.scenes[c].setExtension(this.extensionName,f);const g=l.extensions[this.extensionName];f.setExtras(g)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(this.extensionName);if(s){const l=e.materialIndexMap.get(n),c=t.json.materials[l];c.extensions=c.extensions||{};const f={...s.getExtras()};for(const[g,y]of Object.entries(s.textures)){const x=y[0],S=y[1];S&&(f[g]=e.createTextureInfoDef(S,x))}c.extensions[this.extensionName]=f}}),this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(this.extensionName);if(s){const l=e.meshIndexMap.get(n),c=t.json.meshes[l];c.extensions=c.extensions||{},c.extensions[this.extensionName]=s.getExtras()}}),this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(this.extensionName);if(s){const l=e.nodeIndexMap.get(n),c=t.json.nodes[l];c.extensions=c.extensions||{},c.extensions[this.extensionName]=s.getExtras()}}),this.document.getRoot().listScenes().forEach(n=>{const s=n.getExtension(this.extensionName);if(s){const l=e.jsonDoc.json.scene||0,c=t.json.scenes[l];if(!c)return;c.extensions=c.extensions||{},c.extensions[this.extensionName]=s.getExtras()}}),this}}class Rx extends Sl{constructor(){super(...arguments),this.extensionName=Rx.EXTENSION_NAME,this.textureChannels={bumpTexture:bo.R}}}Rx.EXTENSION_NAME=No;class Ix extends Sl{constructor(){super(...arguments),this.extensionName=Ix.EXTENSION_NAME,this.textureChannels={lightMapTexture:bo.R|bo.G|bo.B}}}Ix.EXTENSION_NAME=Eh;class Px extends Sl{constructor(){super(...arguments),this.extensionName=Px.EXTENSION_NAME,this.textureChannels={alphaTexture:bo.G}}}Px.EXTENSION_NAME=wh;class Dx extends Sl{constructor(){super(...arguments),this.extensionName=Dx.EXTENSION_NAME,this.textureChannels={displacementTexture:bo.R}}}Dx.EXTENSION_NAME=At;class Lx extends Sl{constructor(){super(...arguments),this.extensionName=Lx.EXTENSION_NAME}}Lx.EXTENSION_NAME=Ls.DIAMOND_GLTF_EXTENSION;class Bx extends Sl{constructor(){super(...arguments),this.extensionName=Bx.EXTENSION_NAME}}Bx.EXTENSION_NAME=Ss.AnimationMarkersExtension;class Ox extends Sl{constructor(){super(...arguments),this.extensionName=Ox.EXTENSION_NAME,this.textureChannels={anisotropyDirection:bo.R|bo.G|bo.B}}}Ox.EXTENSION_NAME=ia.ANISOTROPY_GLTF_EXTENSION;class Nx extends Sl{constructor(){super(...arguments),this.extensionName=Nx.EXTENSION_NAME,this.textureChannels={customBumpMap:bo.R|bo.G|bo.B}}}Nx.EXTENSION_NAME=Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class kx extends Sl{constructor(){super(...arguments),this.extensionName=kx.EXTENSION_NAME}}kx.EXTENSION_NAME=Yr;class Ux extends Sl{constructor(){super(...arguments),this.extensionName=Ux.EXTENSION_NAME}}Ux.EXTENSION_NAME=vo;class Fx extends Sl{constructor(){super(...arguments),this.extensionName=Fx.EXTENSION_NAME}}Fx.EXTENSION_NAME=ca;class zx extends Sl{constructor(){super(...arguments),this.extensionName=zx.EXTENSION_NAME}}zx.EXTENSION_NAME=Vl.CLEARCOAT_TINT_GLTF_EXTENSION;class Vx extends Sl{constructor(){super(...arguments),this.extensionName=Vx.EXTENSION_NAME}}Vx.EXTENSION_NAME=Ol.THIN_FILM_LAYER_GLTF_EXTENSION;class jx extends Sl{constructor(){super(...arguments),this.extensionName=jx.EXTENSION_NAME}}jx.EXTENSION_NAME=zl.TRIPLANAR_GLTF_EXTENSION;class Gx extends Sl{constructor(){super(...arguments),this.extensionName=Gx.EXTENSION_NAME}}Gx.EXTENSION_NAME=Qc.SSBEVEL_GLTF_EXTENSION;class Hx extends Sl{constructor(){super(...arguments),this.extensionName=Hx.EXTENSION_NAME}}Hx.EXTENSION_NAME=Ul.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class XM extends r.SimpleEventDispatcher{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}XM.PluginType="PMREMGenerator";const qM=new i.Pa4,iD=new i._fP,YM=new i.Pa4;class rD extends i.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const ld=new i.yGw,sD=new i.yGw;class oD{constructor(e={}){const t=this;let n,s,l,c;const f={camera:{fov:0,style:""},objects:new WeakMap},g=e.element!==void 0?e.element:document.createElement("div");g.style.overflow="hidden",this.domElement=g;const y=document.createElement("div");y.style.transformOrigin="0 0",y.style.pointerEvents="none",g.appendChild(y);const x=document.createElement("div");function S(W){return Math.abs(W)<1e-10?0:W}function C(W){const q=W.elements;return"matrix3d("+S(q[0])+","+S(-q[1])+","+S(q[2])+","+S(q[3])+","+S(q[4])+","+S(-q[5])+","+S(q[6])+","+S(q[7])+","+S(q[8])+","+S(-q[9])+","+S(q[10])+","+S(q[11])+","+S(q[12])+","+S(-q[13])+","+S(q[14])+","+S(q[15])+")"}function L(W){const q=W.elements;return"translate(-50%,-50%)matrix3d("+S(q[0])+","+S(q[1])+","+S(q[2])+","+S(q[3])+","+S(-q[4])+","+S(-q[5])+","+S(-q[6])+","+S(-q[7])+","+S(q[8])+","+S(q[9])+","+S(q[10])+","+S(q[11])+","+S(q[12])+","+S(q[13])+","+S(q[14])+","+S(q[15])+")"}function B(W,q,Z,j){if(W.isCSS3DObject){const F=W.visible===!0&&W.layers.test(Z.layers)===!0;if(W.element.style.display=F===!0?"":"none",F===!0){let se;W.onBeforeRender(t,q,Z),W.isCSS3DSprite?(ld.copy(Z.matrixWorldInverse),ld.transpose(),W.rotation2D!==0&&ld.multiply(sD.makeRotationZ(W.rotation2D)),W.matrixWorld.decompose(qM,iD,YM),ld.setPosition(qM),ld.scale(YM),ld.elements[3]=0,ld.elements[7]=0,ld.elements[11]=0,ld.elements[15]=1,se=L(ld)):se=L(W.matrixWorld);const pe=W.element,be=f.objects.get(W);if(be===void 0||be.style!==se){pe.style.transform=se;const Se={style:se};f.objects.set(W,Se)}pe.parentNode!==x&&x.appendChild(pe),W.onAfterRender(t,q,Z)}}for(let F=0,se=W.children.length;F<se;F++)B(W.children[F],q,Z)}x.style.transformStyle="preserve-3d",y.appendChild(x),this.getSize=function(){return{width:n,height:s}},this.render=function(W,q){const Z=q.projectionMatrix.elements[5]*c;let j,F;f.camera.fov!==Z&&(y.style.perspective=q.isPerspectiveCamera?Z+"px":"",f.camera.fov=Z),q.view&&q.view.enabled?(y.style.transform=`translate( ${-q.view.offsetX*(n/q.view.width)}px, ${-q.view.offsetY*(s/q.view.height)}px )`,y.style.transform+=`scale( ${q.view.fullWidth/q.view.width}, ${q.view.fullHeight/q.view.height} )`):y.style.transform="",W.matrixWorldAutoUpdate===!0&&W.updateMatrixWorld(),q.parent===null&&q.matrixWorldAutoUpdate===!0&&q.updateMatrixWorld(),q.isOrthographicCamera&&(j=-(q.right+q.left)/2,F=(q.top+q.bottom)/2);const se=q.view&&q.view.enabled?q.view.height/q.view.fullHeight:1,pe=q.isOrthographicCamera?`scale( ${se} )scale(`+Z+")translate("+S(j)+"px,"+S(F)+"px)"+C(q.matrixWorldInverse):`scale( ${se} )translateZ(`+Z+"px)"+C(q.matrixWorldInverse),be=pe+"translate("+l+"px,"+c+"px)";f.camera.style!==be&&(x.style.transform=be,f.camera.style=be),B(W,W,q)},this.setSize=function(W,q){n=W,s=q,l=n/2,c=s/2,g.style.width=W+"px",g.style.height=q+"px",y.style.width=W+"px",y.style.height=q+"px",x.style.width=W+"px",x.style.height=q+"px"}}}var Wx,Qx=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let cd=Wx=class extends Ln{constructor(a=!0){super(),this._scene=new i.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var s,l,c,f,g;const e=(l=(s=this._viewer)==null?void 0:s.getPlugin(Kr))==null?void 0:l.getSelectedObject();if(!(e!=null&&e.geometry))return void await((c=this._viewer)==null?void 0:c.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const t=await((f=this._viewer)==null?void 0:f.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!t)return;const n=await((g=this._viewer)==null?void 0:g.prompt("Width: Enter the width for the object.","512",!1))||"512";n&&this.attachIFrame(e,t,parseInt(n))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)==null||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=a,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const a=this._viewer;a&&this._renderer&&(a.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",a.canvas):this._renderer.domElement.appendChild(a.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new oD;const a=this._viewer.renderer.rendererObject.getSize(new i.FM8);this._renderer.setSize(a.width,a.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const t=this._viewer.renderer.rendererObject.getSize(new i.FM8);this._renderer.setSize(t.width,t.height)})}async onAdded(a){await super.onAdded(a);let e=!0,t=!0;a.addEventListener("postFrame",l=>{var c,f;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(t&&this._trackers.forEach(g=>{var S,C;let y=!0;const x=g.modelObj.material.side;if(x!==i.ehD){const L=new i.Pa4(0,0,1).applyQuaternion(g.cssObj.quaternion),B=(C=(S=this._viewer)==null?void 0:S.scene.activeCamera)==null?void 0:C.cameraObject,W=L.dot(B.getWorldDirection(new i.Pa4));y=x===i._Li?W>0:W<0}g.cssObj.element.style.visibility=y?"visible":"hidden"}),this._trackers.filter(g=>g.dirty).forEach(g=>this._syncProperties(g)),(f=this._renderer)==null||f.render(this._scene,(c=a.scene.activeCamera)==null?void 0:c.cameraObject),e=!1))}),a.addEventListener("update",l=>{this.enabled&&(e=this._trackers.length>0)}),a.scene.addEventListener("sceneUpdate",l=>{this.enabled&&(this._trackers.forEach(c=>c.dirty=!0),e=this._trackers.length>0)}),a.scene.addEventListener("activeCameraUpdate",l=>{this.enabled&&(e=this._trackers.length>0,t=!0)});let n=!1;const s=new i.iMs;a.container.addEventListener("mousemove",l=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const c=this._viewer.canvas.getBoundingClientRect(),f=(l.clientX-c.x)/c.width*2-1,g=-(l.clientY-c.y)/c.height*2+1;s.setFromCamera({x:f,y:g},this._viewer.scene.activeCamera.cameraObject);const y=this._trackers.map(S=>S.modelObj),x=s.intersectObjects(y,!1);if(console.log(x),x.length)return this._viewer.canvas.style.pointerEvents="none",n=!0,void console.log(this._viewer.canvas.style.pointerEvents);n&&(this._viewer.canvas.style.pointerEvents="auto",n=!1)})}attachIFrame(a,e,t){const n=qx(a.modelObject),s=KM(e,t,t*n.y/n.x,()=>{var l;return(l=a.setDirty)==null?void 0:l.call(a)});return this.attachCSS3DObject(s,a),s}attachCSS3DObject(a,e){var n,s,l,c,f;if(this._trackers.push({cssObj:a,modelObj:e.modelObject,dirty:!0}),a.element&&(this._resizeObserver.observe(a.element),a.element.__isCSS3DObjectElement=!0,console.log(a.element,a.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const t=(n=this._viewer)==null?void 0:n.createMaterial("basic",{opacity:0,color:new i.Ilk("black"),blending:i.jFi,side:i.Wl3});if(!t)throw"cannot create mat";t.userData.forcedLinearDepth=0,(s=e.setMaterial)==null||s.call(e,t),Xx(e.modelObject),B1(e.modelObject),qx(e.modelObject),this._scene.add(a),(c=(l=this.uiConfig)==null?void 0:l.uiRefresh)==null||c.call(l),(f=e.setDirty)==null||f.call(e)}_syncProperties(a){const e=a.modelObj,t=a.cssObj;e.updateMatrixWorld();const n=a.cssObj.element.clientWidth<1.5?0:(a.cssObj.element.clientWidth-1.5)/qx(e).x,s=Xx(e);t.quaternion.setFromUnitVectors(new i.Pa4(0,0,1),s),t.position.copy(B1(e)),t.scale.set(1,1,1).multiplyScalar(1/n),t.updateMatrixWorld(),t.applyMatrix4(e.matrixWorld),a.dirty=!1}async onDispose(a){return this._resizeObserver.disconnect(),super.onDispose(a)}};function KM(a,e,t,n){const s=document.createElement("div");s.style.width=e.toString()+"px",s.style.height=t.toString()+"px",s.style.backgroundColor="transparent";const l=document.createElement("iframe",{is:"x-frame-bypass"});l.style.width="100%",l.style.height="100%",l.style.border="0px";const c=()=>{var f;try{l.contentWindow.name}catch(g){(typeof g=="string"?g:((f=g==null?void 0:g.toString)==null?void 0:f.call(g))??"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(g)}n(),l.removeEventListener("load",c)};return l.addEventListener("load",c),l.src=a,s.appendChild(l),new rD(s)}function Xx(a){if(a.geometry.userData.geometryNormal)return a.geometry.userData.geometryNormal;const e=a.geometry.attributes.normal,t=new i.Pa4,n=new i.Pa4;for(let s=0,l=e.count;s<l;s++)t.fromBufferAttribute(e,s),n.add(t);return n.normalize(),a.geometry.userData.geometryNormal=n,n}function B1(a){if(a.geometry.userData.geometryCenter)return a.geometry.userData.geometryCenter;const e=a.geometry;if(!e)return new i.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const t=e.boundingBox.getCenter(new i.Pa4);return a.geometry.userData.geometryCenter=t,t}function qx(a,e=new i.Pa4(0,0,1)){if(a.geometry.userData.geometrySize)return a.geometry.userData.geometrySize;const t=a.geometry;if(!t)return new i.Pa4(0,0,0);const n=t.clone();n.applyMatrix4(new i.yGw().makeRotationFromQuaternion(new i._fP().setFromUnitVectors(e,Xx(a)).invert())),n.computeBoundingBox();const s=n.boundingBox.getSize(new i.Pa4);return a.geometry.userData.geometrySize=s,n.dispose(),s}cd.PluginType="CSS3DRenderer",Qx([En("Enabled"),(0,r.onChange)(Wx.prototype._refreshEnabled),Pe()],cd.prototype,"enabled",void 0),Qx([En("Over canvas"),(0,r.onChange)(Wx.prototype._refreshCanvasInDOM),Pe()],cd.prototype,"overCanvas",void 0),Qx([Ee("Attach iframe")],cd.prototype,"attachIFrameToSelected",void 0),cd=Wx=Qx([lt("CSS3D Renderer")],cd);class aD extends eo{constructor(e,t,n,s=new i.Ilk(1,1,1),l=1){super(void 0,void 0,n,s,l),this.target=t,this._getSelectedObject=e}render(e,t,n,s,l){const c=e.getRenderTarget(),f=e.getActiveCubeFace(),g=e.getActiveMipmapLevel(),y=this._getSelectedObject();if(y)this._renderSelectedObject(e,y,t,s,l);else{e.setRenderTarget(this.target);const x=new i.Ilk;e.getClearColor(x),e.setClearColor(new i.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(x)}e.setRenderTarget(c,f,g)}_renderSelectedObject(e,t,n,s,l){if(!this.camera)return;t.traverse(g=>{g.layers.enable(6)});const c=this.camera.layers.mask;this.camera.layers.set(6);const f=e.userData;f||console.error("threejs is not patched?"),f.transmissionRenderTarget=n,ot(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},()=>super.render(e,n,this.target,s,l)),f.transmissionRenderTarget=void 0,t.traverse(g=>{g.layers.disable(6)}),this.camera.layers.mask=c}}var Cp,sm=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let oh=Cp=class{constructor(a,e){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new i.Ilk(13715217),this.debugOutline=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new i.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new i.Ilk(13715217)},enableHighlight:{value:!0},outlineBuffer:{value:null}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(t,n)=>this.enabled?r.glsl`
            ${gs}
            ${`uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;
#if DEBUG_OUTLINE > 0
color=vec4(0.,0.,0.,1.);
#endif
vec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.001;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}`}
        `:"",this._combinedPostPlugin=a.getPlugin(Za),this._pickingPlugin=a.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),e&&(this.extraUniforms.outlineBuffer.value=e.texture),this._enable()}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Yn(a.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}_enable(){var a;(a=this._pickingPlugin)==null||a.enableWidget(!this.enabled),this._setDirty()}};oh.PluginType="Outline",sm([(0,r.onChange)(Cp.prototype._enable),En("Enable"),Pe()],oh.prototype,"enabled",void 0),sm([(0,r.onChange)(Cp.prototype._setDirty),En("Highlight"),Pe()],oh.prototype,"enableHighlight",void 0),sm([(0,r.onChange)(Cp.prototype._setDirty),En("DynamicSelection"),Pe()],oh.prototype,"enableDynamicSelection",void 0),sm([(0,r.onChange)(Cp.prototype._setDirty),Hn("Intensity",[0,2],.001,{limitedUi:!0}),Pe()],oh.prototype,"outlineIntensity",void 0),sm([(0,r.onChange)(Cp.prototype._setDirty),Hn("Transparency",[0,1],.01,{limitedUi:!0}),Pe()],oh.prototype,"highlightTransparency",void 0),sm([(0,r.onChange)(Cp.prototype._setDirty),it("Color"),Pe()],oh.prototype,"outlineColor",void 0),sm([(0,r.onChange)(Cp.prototype._setDirty),En("Debug")],oh.prototype,"debugOutline",void 0),oh=Cp=sm([lt("Outline")],oh);class eA extends gu{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new oh(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const t=e==null?void 0:e.getPluginByType("Picking"),n=new i.jyz({uniforms:{cameraNearFar:{value:new i.FM8(.1,100)}},vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:i.ehD}),s=as(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new aD(()=>t==null?void 0:t.getSelectedObject(),this._outlineTarget,n),update(){e.scene.activeCamera.updateShaderProperties(this.passObject.overrideMaterial)}});e.renderer.registerPass(s),s.passObject.scene=e.scene.modelObject,s.passObject.camera=e.scene.activeCamera.cameraObject,e.scene.addEventListener("activeCameraChange",()=>{s.passObject.camera=e.scene.activeCamera.cameraObject}),t==null||t.addEventListener("selectedObjectChanged",()=>{!this._animationCallBack&&this._extension&&(t!=null&&t.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)}),document.addEventListener("mousemove",l=>{if(!this._extension||!this.mouseInOutAnimationEnabled)return;const c=t==null?void 0:t.getSelectedObject();c&&this._extension.enableDynamicSelection?l.target!==e.canvas?this._animationCallBack||this._state!=="in"||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||this._state!=="out"||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=c?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,t,n){return iv(this._extension,"transparency",{from:e,to:t,duration:n,onComplete:()=>{this._animationCallBack=null}})}}eA.PluginType="Outline";const Yx=.2,lD=Math.PI/24,$M=new i.FM8,Kx=(a,e,t)=>{let n=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let s=0;s<=12;++s)a.push(e+.17*Math.cos(n),t+.17*Math.sin(n),0,e+Yx*Math.cos(n),t+Yx*Math.sin(n),0),n+=lD};class JM extends i.Kj0{constructor(e,t,n=!1){super(((g,y)=>{const x=new i.u9r,S=[],C=[],L=g.getSize(new i.Pa4),B=L.x/2,W=(y?L.y:L.z)/2;Kx(C,B,W),Kx(C,-B,W),Kx(C,-B,-W),Kx(C,B,-W);const q=C.length/3;for(let j=0;j<q-2;j+=2)S.push(j,j+1,j+3,j,j+3,j+2);const Z=q-2;return S.push(Z,Z+1,1,Z,1,0),x.setAttribute("position",new i.a$l(C,3)),x.setIndex(S),x})(e,n)),this.boundingSize=new i.Pa4,this._raycaster=new i.iMs,this._camera=t,this._placeOnWall=n;const s=this.material;s.side=i.Wl3,s.color=new $e(16711935),s.opacity=0,this.userData.bboxVisible=!1;const l=e.getSize(this.boundingSize),c=l.x/2,f=(n?l.y:l.z)/2;this.hitPlane=new i.Kj0(new i._12(2*(c+Yx),2*(f+Yx))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),n?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,n){$M.set(t,-n),this.hitPlane.visible=!0;const s=this._positionAndNormalFromPoint($M,this.hitPlane);return this.hitPlane.visible=!1,s==null?null:s.position}getExpandedHit(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);const s=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),s}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){var n;const{geometry:e,material:t}=this.hitPlane;e.dispose(),t.dispose(),this.geometry.dispose(),this.material.dispose(),(n=this.parent)==null||n.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const n=this._raycaster.intersectObject(t,!0);if(n.length===0)return null;const s=n[0];return s.face==null?null:s.uv==null?{position:s.point,normal:s.face.normal,uv:null}:(s.face.normal.applyNormalMatrix(new i.Vkp().getNormalMatrix(s.object.matrixWorld)),{position:s.point,normal:s.face.normal,uv:s.uv})}}const O1=new i.Pa4;class ZM{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new i.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new i.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new i.Pa4,this._hitMatrix=new i.yGw,this.xDamper=new r.Damper,this.yDamper=new r.Damper,this.zDamper=new r.Damper,this.yawDamper=new r.Damper,this.scaleDamper=new r.Damper,this.onSelectStart=e=>{const t=this.transientHitTestSource;if(t==null)return;const n=this.frame.getHitTestResultsForTransientInput(t),s=this.presentedScene,l=this.placementBox;if(n.length===1){this.inputSource=e.inputSource;const{axes:c}=this.inputSource.gamepad||{axes:[0,0]},f=l.getHit(s,c[0],c[1]);l.show=!0,f!=null?(this.isTranslating=!0,this.lastDragPosition.copy(f),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*c[0])}else if(n.length===2){l.show=!0,this.isTwoFingering=!0;const{separation:c}=this.fingerPolar(n);this.firstRatio=c/s.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,t,n){var s;this.transientHitTestSource=await((s=e.requestHitTestSourceForTransientInput)==null?void 0:s.call(e,{profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=n,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var s;const t=(s=this.xr)==null?void 0:s.getReferenceSpace(),n=t?e.getPose(t):null;return n?(this._hitMatrix.fromArray(n.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,n=t.position,s=t.rotation.y,l=this.placementBox,c=Math.max(l.boundingSize.x,l.boundingSize.y,l.boundingSize.z)/2,f=this.goalPosition,g=t.scale.x;if(!f.equals(n)||this.goalScale!==g){let{x:y,y:x,z:S}=n;y=this.xDamper.update(y,f.x,e,c),x=this.yDamper.update(x,f.y,e,c),S=this.zDamper.update(S,f.z,e,c),n.set(y,x,S);const C=this.scaleDamper.update(g,this.goalScale,e,1);if(t.scale.set(C,C,C),!this.isTranslating){const L=f.y-x;this.placementComplete&&!this.placeOnWall?l.offsetHeight=L/C:L===0&&(this.placementComplete=!0,l.show=!1)}}l.updateOpacity(e),t.rotation.y=this.yawDamper.update(s,this.goalYaw,e,Math.PI)}processInput(e){var c;this.frame=e;const t=this.transientHitTestSource;if(!t||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const n=e.getHitTestResultsForTransientInput(t),s=this.presentedScene,l=s.scale.x;if(this.isTwoFingering)if(n.length<2)this.isTwoFingering=!1;else{const{separation:f,deltaYaw:g}=this.fingerPolar(n);if(this.placeOnWall||(this.goalYaw+=g),!s.userData.__scaleDisabled){const y=f/this.firstRatio;this.goalScale=y<1.3&&y>.7692307692307692?1:y}}else if(n.length!==2)if(this.isRotating&&((c=this.inputSource)!=null&&c.gamepad)){const f=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=f-this.lastAngle,this.lastAngle=f}else this.isTranslating&&(console.log("translating"),n.forEach(f=>{if(f.inputSource!==this.inputSource)return;let g=null;if(f.results.length>0&&(g=this.getHitPoint(f.results[0])),g==null&&(g=this.getTouchLocation()),g!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const y=g.y-this.lastDragPosition.y;if(y<0){this.placementBox.offsetHeight=y/l;const x=O1.copy(this.xr.getCamera().position),S=-y/(x.y-g.y);x.multiplyScalar(S),g.multiplyScalar(1-S).add(x)}}this.goalPosition.add(g),this.lastDragPosition.copy(g)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:f}=this.fingerPolar(n);this.firstRatio=f/l}}getTouchLocation(){var n;const{axes:e}=this.inputSource.gamepad??{axes:[0,0]},t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return t!=null&&(O1.copy(t).sub((n=this.xr)==null?void 0:n.getCamera().position),O1.length()>10)?null:t}fingerPolar(e){var g,y,x,S;const t=((y=(g=e[0].inputSource)==null?void 0:g.gamepad)==null?void 0:y.axes)??[0,0],n=((S=(x=e[1].inputSource)==null?void 0:x.gamepad)==null?void 0:S.axes)??[0,0],s=n[0]-t[0],l=n[1]-t[1],c=Math.atan2(l,s);let f=this.lastAngle-c;return f>Math.PI?f-=2*Math.PI:f<-Math.PI&&(f+=2*Math.PI),this.lastAngle=c,{separation:Math.sqrt(s*s+l*l),deltaYaw:f}}}class cD{constructor(e,t,n,s,l){this.xrLight=e,this.renderer=t,this.lightProbe=n,this.xrWebGLBinding=null,this.estimationStartCallback=l,this.frameCallback=this.onXRFrame.bind(this);const c=t.xr.getSession();if(s&&"XRWebGLBinding"in window){const f=new i.oAp(16);e.environment=f.texture;const g=t.getContext();switch(c.preferredReflectionFormat){case"srgba8":g.getExtension("EXT_sRGB");break;case"rgba16f":g.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(c,g),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}c.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const n=t.getLightEstimate(this.lightProbe);if(n){this.xrLight.lightProbe.sh.fromArray(n.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const s=Math.max(1,Math.max(n.primaryLightIntensity.x,Math.max(n.primaryLightIntensity.y,n.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(n.primaryLightIntensity.x/s,n.primaryLightIntensity.y/s,n.primaryLightIntensity.z/s),this.xrLight.directionalLight.intensity=s,this.xrLight.directionalLight.position.copy(n.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class uD extends i.ZAu{constructor(e,t=!0){super(),this.lightProbe=new i.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new i.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let n=null,s=!1;e.xr.addEventListener("sessionstart",()=>{const l=e.xr.getSession();"requestLightProbe"in l&&l.requestLightProbe({reflectionFormat:l.preferredReflectionFormat}).then(c=>{n=new cD(this,e,c,t,()=>{s=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{n&&(n.dispose(),n=null),s&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{n&&(n.dispose(),n=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var zv=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Rp=class extends Ln{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new ZM,this.dependencies=[ir],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var a;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):((a=this._xrManager)==null||a.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const a=this._xrManager.getCamera(),e=a.cameras[0]||a,t=this._viewer.scene.activeCamera;t.cameraObject.projectionMatrix.copy(e.projectionMatrix),t.cameraObject.projectionMatrixInverse.copy(t.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var t,n;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const a=this._viewer.renderer,e=(n=(t=this._xrManager)==null?void 0:t.getCamera())==null?void 0:n.cameras[0].viewport;e?a.rendererObject.setViewport(e):console.warn("no viewport for ar camera"),this._viewer.getPlugin(ir).updateShaderProperties(Vv.material),Vv.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,ot(a.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{Vv.render(a.rendererObject,null,a.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._preFrame=({xrFrame:a,deltaTime:e})=>{var l,c;if(this.dirty=!!a&&((l=this._xrManager)==null?void 0:l.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!a)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const t=this._xrManager.getReferenceSpace(),n=a.getViewerPose(t);if(n==null&&this._frameCount,n==null||((c=this._viewer)==null?void 0:c.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const s=this._viewer.scene.activeCamera;this._xrManager.updateCamera(s.cameraObject),s.setDirty(),this.moveToFloor(a),this._touchInputHelper.processInput(a),this._touchInputHelper.moveScene(e),this._updateShadow()},this._preXRState={viewerBg:null,modelScale:new i.Pa4(1,1,1),modelPosition:new i.Pa4,modelRotation:new i._fP,cameraPosition:new i.Pa4(0,0,5),cameraTarget:new i.Pa4,cameraUp:new i.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new i.yGw,cameraAutoNearFar:void 0,groundOffset:new i.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new i.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.getBackground(!0);const a=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera;a.updateMatrix(),a.updateMatrixWorld(!0),this._preXRState.modelScale.copy(a.scale),this._preXRState.modelPosition.copy(a.position),this._preXRState.modelRotation.copy(a.quaternion),this._preXRState.cameraPosition.copy(e.position),this._preXRState.cameraTarget.copy(e.target),this._preXRState.cameraUp.copy(e.cameraObject.up),e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=e.cameraObject.fov,this._preXRState.cameraAspect=e.cameraObject.aspect),this._preXRState.cameraZoom=e.cameraObject.zoom,this._preXRState.cameraNear=e.cameraObject.near,this._preXRState.cameraFar=e.cameraObject.far,this._preXRState.cameraAutoNearFar=e.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(e.cameraObject.projectionMatrix);const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(this._preXRState.groundOffset.subVectors(a.position,t.mesh.modelObject.position),this._preXRState.groundScale=t.mesh.modelObject.scale.x,this._preXRState.groundRotation=t.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=t.renderToDepth,this._preXRState.groundShadowBaker=t.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const a=20*Math.PI/180,e=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(a),z:-Math.cos(a)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var t,n;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const s=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((n=(t=this._xrSession).requestHitTestSource)==null?void 0:n.call(t,{space:s,offsetRay:e}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.useTotalFrameCount=!1,this._restorePreXRState())},this._onSessionStarted=async a=>{a.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new uD(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))})),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(a),this._xrSession=a},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(a){await super.onAdded(a);const e=a.renderer.rendererObject.xr;if(e.enabled=!0,e.cameraAutoUpdate=!1,this._xrManager=e,this._touchInputHelper.xr=e,!this.domOverlay){const t=document.getElementById("tweakpaneUiContainer");this.domOverlay=t?{root:t}:void 0}if(a.addEventListener("preRender",this._preRender),a.addEventListener("postRender",this._postRender),a.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return a.console.error("XR not supported in insecure context, try https://"),this.enabled=!1,void(e.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(t=>{if(!t)throw new Error("AR not supported")}).catch(t=>{a.console.error("AR not supported:",t),e.enabled=!1,this.enabled=!1}):(e.enabled=!1,this.enabled=!1)}_updateShadow(){var t,n;if(!this._viewer)return;const a=this._viewer.scene.modelRoot,e=(n=(t=this._viewer.getPluginByType("Ground"))==null?void 0:t.mesh)==null?void 0:n.modelObject;e&&(e.rotation.z=this._viewer.scene.modelRoot.rotation.y,e.position.copy(this._preXRState.groundOffset).multiplyScalar(a.modelObject.scale.x).sub(a.modelObject.position).negate(),e.scale.setScalar(a.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(a){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const e=a.getHitTestResults(this._hitTestSource);if(!e.length)return;const t=e[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const n=this._touchInputHelper.getHitPoint(t);if(!n)return;this._placementBox.show=!0;const s=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(n),s.position.copy(n),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var g,y;const a=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera,t=(g=this._xrManager)==null?void 0:g.getCamera(),n=t.cameras[0]||t;this._removePlacementBox();const s=this._viewer.scene.getBounds(!0,!0);s.getSize(new i.Pa4).length()>.01&&(this._placementBox=new JM(s,t,this.placeOnWall),a.add(this._placementBox),this._placementBox.show=!1);const l=t.getWorldDirection(new i.Pa4);a.rotation.y=Math.atan2(-l.x,-l.z)-0,e.cameraObject.zoom=n.zoom,e.cameraObject.near=n.near,e.cameraObject.far=n.far,e.cameraObject.userData.autoNearFar=!1,e.cameraObject.isPerspectiveCamera?(e.cameraObject.fov=n.fov,e.cameraObject.aspect=n.viewport.width/n.viewport.height):console.warn("Perspective camera required."),e.cameraObject.updateProjectionMatrix();const c=a.userData.arScale||1;a.scale.set(c,c,c),a.position.copy(t.position).add(l.multiplyScalar(5)),a.visible=!0;const f=(y=this._viewer)==null?void 0:y.getPluginByType("Ground");f!=null&&f.mesh&&(f.shadowBaker.enabled=!1,f.renderToDepth=!1)}_restorePreXRState(){if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const a=this._viewer.scene.modelRoot;a.scale.copy(this._preXRState.modelScale),a.position.copy(this._preXRState.modelPosition),a.quaternion.copy(this._preXRState.modelRotation),a.updateMatrix(),a.updateMatrixWorld(!0),a.visible=!0;const e=this._viewer.scene.activeCamera;e.position.copy(this._preXRState.cameraPosition),e.target.copy(this._preXRState.cameraTarget),e.cameraObject.up.copy(this._preXRState.cameraUp),e.cameraObject.near=this._preXRState.cameraNear,e.cameraObject.far=this._preXRState.cameraFar,e.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(e.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(e.cameraObject.aspect=this._preXRState.cameraAspect)),e.positionUpdated(!1),e.targetUpdated(!0),e.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),e.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),e.cameraObject.updateMatrixWorld(!0),e.cameraObject.updateProjectionMatrix();const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(t.mesh.modelObject.position.subVectors(a.position,this._preXRState.groundOffset),t.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),t.mesh.modelObject.rotation.z=this._preXRState.groundRotation,t.renderToDepth=this._preXRState.groundRenderToDepth,t.shadowBaker.enabled=this._preXRState.groundShadowBaker,t.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};Rp.PluginType="WEBXR_ARPlugin",zv([En("Light Estimate")],Rp.prototype,"estimateLighting",void 0),zv([En("Place on Wall")],Rp.prototype,"placeOnWall",void 0),zv([Hn("Resilution scale",[.1,1],.1)],Rp.prototype,"xrResolutionScale",void 0),zv([Ee("Enter AR")],Rp.prototype,"enterAR",void 0),zv([Ee("Exit AR")],Rp.prototype,"exitAR",void 0),Rp=zv([lt("WebXR AR")],Rp);const Vv=new ur({vertexShader:m.vertexShader,fragmentShader:`
        ${gs}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...m.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});Vv.renderToScreen=!1,Vv.useExistingRenderTarget=!0,Vv.clear=!1;class $x extends r.SimpleEventDispatcher{get state(){return this._state}setState(e,t){this._state=e,this.dispatchEvent({type:e,...t})}_setOptions(e){Object.assign(this.options,e)}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=n=>{n.data&&n.data.size>0&&this._currentRecording.push(n.data)},this._canvas=e,t==null||t.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(t||this.options)}isRecording(){return this._state==="recording"}requestFrame(){return this._state==="recording"&&(this._frameCount++,!0)}dispose(){(this.isRecording()||this._state==="paused")&&this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()})}}class eC extends $x{constructor(){super(...arguments),this._currentImages=[],this._onstop=e=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e)}}start(){if(this.state!=="recording"){if(this.state==="error"&&this._console.warn("Resetting from error state."),this.state==="paused")return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async e=>{const t=await(e==null?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._frameCount=0,this.setState("recording")}).catch(e=>{this._onerror({detail:e})})}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const e=this.options.mimeType;return this._canvas.toBlob(t=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t])},e,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(e){if(!this._imgDirectory)return;const t=[];for(const n of e){const s=await this._imgDirectory.getFileHandle(n[0],{create:!0});t.push((0,r.writeFile)(s,n[1]))}await Promise.all(t)}}class tA extends $x{_setOptions(e){var t;super._setOptions(e),this.options.mimeType&&this.options.mimeType!=="auto"||(this.options.mimeType=tA.GetSupportedMimeTypes([],["h264"],!0)??tA.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!((t=this.options.mimeType)!=null&&t.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(e,t),this._resumeSyncTime=0,this._onstop=n=>{var s;if(this._recorder&&this._currentRecording.length>0){const l=new Blob(this._currentRecording,{type:this.options.mimeType});(s=this._recordingCallback)==null||s.call(this,l)}this._recorder=void 0,this.setState("stopped")},this._onstart=n=>{var s;this._frameCount=0,this.options.stepMode&&((s=this._recorder)==null||s.pause()),this.setState("recording")},this._onresume=n=>{if(this.state!=="paused"&&this.state!=="starting"&&this.state!=="stopped"||this.setState("recording"),!this.options.stepMode)return;const s=()=>{var c;this.state==="recording"&&((c=this._recorder)==null||c.pause())},l=Math.min(this._resumeSyncTime-(0,r.now)(),0)+1e3/this.options.frameRate;l>0?(0,r.timeout)(l).then(s):s()},this._onerror=n=>{this.setState("error",{error:n}),this._console.error(n),this._recorder=void 0}}start(){var t,n,s;if(this.state==="recording")return void this._console.log("Already recording canvas");if(this.state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this.state==="paused"?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const e={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,(t=e.mimeType)==null?void 0:t.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const l=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),c=(n=l.getVideoTracks())==null?void 0:n[0];this._track=c,this._recorder=new window.MediaRecorder(l,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&((s=this._recorder)==null||s.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=(0,r.now)(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){this.state!=="paused"&&this.state!=="stopped"&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const s=["webm","ogg","mp4","x-matroska"].filter(f=>!e||e.length<1||e.includes(f)),l=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(f=>!t||t.length<1||t.includes(f)),c=[];return s.forEach(f=>{const g=`video/${f}`;l.forEach(y=>{[`${g};codecs=${y}`,`${g};codecs:${y}`,`${g};codecs=${y.toUpperCase()}`,`${g};codecs:${y.toUpperCase()}`,`${g}`].forEach(x=>{MediaRecorder.isTypeSupported(x)&&c.push(x)})})}),n?c.length>0?c[0]:void 0:c}}class jv extends $x{constructor(e,t){super(e,t),this._workerRunning=!1,this.worker=new Worker((0,r.remoteWorkerURL)(jv.LIBRARY_PATH+"ffmpeg-worker-mp4.js",jv.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm")),this.worker.onmessage=n=>{var l;const s=n.data;switch(s.type){case"stdout":case"stderr":if(s.data.indexOf("frame=")===0){const c=parseInt(s.data.split("frame=")[1].split("fps")[0].trim()),f=this._frameCount,g=Math.round(c/f*100);this.dispatchEvent({type:"encode-progress",progress:g,frame:c,totalFrames:f})}console.log(s.data+`
`);break;case"exit":console.log("Process exited with code "+s.data),parseInt(s.data);break;case"done":if(s.data.MEMFS[0].data===void 0)return void console.log("video processing failed");this._workerRunning=!1,(l=this._recordingCallback)==null||l.call(this,new Blob([s.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){this.state!=="recording"?(this.state==="error"&&console.warn("Resetting from error state."),this.state!=="paused"&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onStop()):console.error("Recorder in error state, cannot stop, call start again."))}_onStop(){const e=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const t=this.options.frameRate.toString(),n=this.options.frameRate.toString();this.worker.postMessage({type:"run",arguments:["-r",t,"-an","-i","img%03d.jpeg","-c:v","libx264","-crf","17","-filter:v",`scale=${e}:-2`,"-pix_fmt","yuv420p","-b:v","10M","-preset","ultrafast","-r",n,"out.mp4"]})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}sendBlobToWorker(e){this._canvas.toBlob(t=>{this.worker.postMessage({type:"image",file:{name:`img${this.pad(e,3)}.jpeg`,data:t}})},"image/jpeg",90)}pad(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}}jv.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var N1=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class ah extends Ln{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!1,this.mimeType="image/jpeg",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var e,t,n;if(this.convergeMode&&((e=this._recorder)!=null&&e.isRecording())){const s=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((n=(t=this._viewer)==null?void 0:t.getPluginByType("Progressive"))==null?void 0:n.isConverged())||!1,s&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,t,n;if((e=this._recorder)!=null&&e.isRecording()&&(!this.convergeMode||(n=(t=this._viewer)==null?void 0:t.getPluginByType("Progressive"))!=null&&n.isConverged(!0))){const s=()=>{var l;return(l=this._recorder)==null?void 0:l.requestFrame()};this.convergeMode?(0,r.timeout)(1).then(s):s()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e;(e=this.uiConfig.children)==null||e.map(t=>(0,r.getOrCall)(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t)})},this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["MP4 Video (ffmpeg)","video/mp4"]].map(e=>({label:e[0],value:e[1]}))},{type:"input",disabled:!0,label:"State",getValue:()=>{var e;return((e=this.recorder)==null?void 0:e.state)??"not initialized"}},{type:"button",label:()=>{var e;return(e=this.recorder)!=null&&e.isRecording()?"Stop Recording":"Start Recording"},value:()=>{var e;(e=this.recorder)!=null&&e.isRecording()?this.stopRecording().then(async t=>{if(t){const n=t.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(t,n)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var e,t;return!!((e=this.recorder)!=null&&e.isRecording())||!((t=this._viewer)!=null&&t.getPluginByType("CameraViews"))},value:()=>{var e,t;(t=(e=this._viewer)==null?void 0:e.getPluginByType("CameraViews"))==null||t.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var e,t,n,s;return!!((e=this.recorder)!=null&&e.isRecording())||!((t=this._viewer)!=null&&t.getPluginByType("CameraViews"))||!((s=(n=this._viewer)==null?void 0:n.getPluginByType("GLTFAnimation"))!=null&&s.animations.length)},value:()=>{var t,n,s,l;const e=((n=(t=this._viewer)==null?void 0:t.getPluginByType("GLTFAnimation"))==null?void 0:n.animationState)==="playing";(l=(s=this._viewer)==null?void 0:s.getPluginByType("CameraViews"))==null||l.recordAllViews(()=>{var c,f;(f=(c=this._viewer)==null?void 0:c.getPluginByType("GLTFAnimation"))==null||f.playAnimation()}).then(()=>{var c,f;e||((f=(c=this._viewer)==null?void 0:c.getPluginByType("GLTFAnimation"))==null||f.stopAnimation())})}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>{var e,t,n;return!!((e=this.recorder)!=null&&e.isRecording())||!((n=(t=this._viewer)==null?void 0:t.getPluginByType("GLTFAnimation"))!=null&&n.animations.length)},value:async()=>{var s,l;if((s=this.recorder)!=null&&s.isRecording())return;const e=(l=this._viewer)==null?void 0:l.getPluginByType("GLTFAnimation");if(!e)return;let t=!1;e.loopAnimations&&(t=!0),t&&(e.loopAnimations=!1);const n=await this.record(async()=>e.playAnimation());if(t&&(e.loopAnimations=!0),n){const c=n.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(n,c)}}},{type:"button",limitedUi:!0,label:"Record 360 animation",hidden:()=>{var e;return!!((e=this.recorder)!=null&&e.isRecording())},value:async()=>{var y;if((y=this.recorder)!=null&&y.isRecording()||!this._viewer)return;const e=await this._viewer.prompt("Enter duration in seconds","5",!0);if(e===null)return;const t=parseFloat(e||"5");if(!isFinite(t)||t<=0)return;const n=this._viewer.scene.activeCamera,s=n.interactionsEnabled;s&&(n.interactionsEnabled=!1);const l=n.position.clone(),c=await this._viewer.getPluginByType("PopmotionPlugin");if(!c)return void console.error("Popmotion plugin not found");const f=new i.$V().setFromVector3(l);n.position.setFromSpherical(f),n.positionUpdated(!0);const g=await this.record(async()=>c.animate({from:f.theta,to:f.theta+2*Math.PI,duration:1e3*t,ease:bu.linear,onUpdate:x=>{f.theta=x,n.position.setFromSpherical(f),n.positionUpdated(!0)}}).promise);if(n.position.copy(l),n.positionUpdated(!0),s&&(n.interactionsEnabled=!0),g){const x=g.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(g,x)}}}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var e;return((e=this._recorder)==null?void 0:e.isRecording())??!1}refreshRecorderOptions(){if(!this._viewer)return;let e="image";this.mimeType==="video/mp4"?e="ffmpeg.js":this.mimeType==="auto"?e="canvas-media":this.mimeType.startsWith("image")&&(e="image"),this._recorder=this._getRecorder(e),this._recorder&&this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode})}async onAdded(e){var t;await super.onAdded(e),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",(t=e.canvas.parentElement)==null||t.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(e){var t,n;this.dirty=e,(t=this._viewer)==null||t.setDirty(),(n=this.uiConfig.children)==null||n.map(s=>(0,r.getOrCall)(s)).flat(2).forEach(s=>{var l;return(l=s==null?void 0:s.uiRefresh)==null?void 0:l.call(s)})}async onRemove(e){var t;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),(t=this._recorder)==null||t.dispose(),Object.values(this._recorders).forEach(n=>{n==null||n.dispose()}),super.onRemove(e)}async record(e,t){var n;if(this.enabled&&!((n=this._recorder)!=null&&n.isRecording()))return await new Promise((s,l)=>{const c=()=>{this.removeEventListener("start",f),this.removeEventListener("stop",c),this.removeEventListener("error",g)},f=async()=>{c(),t==null||t(),await e(),s()},g=async()=>{c(),l()};this.addEventListener("start",f),this.addEventListener("stop",c),this.addEventListener("error",g),this.startRecording()}),await this.stopRecording()}startRecording(){var e;return!!this.enabled&&((e=this.recorder)==null?void 0:e.isRecording())===!1&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if((e=this.recorder)!=null&&e.isRecording())return new Promise((t,n)=>{var s;return(s=this.recorder)==null?void 0:s.stop(t)})}async _downloadBlob(e,t){var l,c,f;const n=await((l=this._viewer)==null?void 0:l.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),s=(c=this._viewer)==null?void 0:c.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,n||"recording.mp4"):(f=this._viewer)==null||f.console.error("FileTransferPlugin required to export/download file")}_getRecorder(e){if(!this._viewer)throw new Error("No viewer");if(this._recorders[e])return this._recorders[e];let t;return t=e==="canvas-media"?new tA(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):e==="ffmpeg.js"?new jv(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new eC(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),t.addEventListener("starting",()=>this._stateChange(!1)),t.addEventListener("recording",()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),t.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),t.addEventListener("paused",()=>this._stateChange(!1)),t.addEventListener("stopped",()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)}),t.addEventListener("encode-progress",n=>{this.dispatchEvent({...n})}),this._recorders[e]=t,t}}ah.PluginType="CanvasRecorder",N1([(0,r.onChange)(ah.prototype.refreshRecorderOptions),Pe()],ah.prototype,"convergeMode",void 0),N1([(0,r.onChange)(ah.prototype.refreshRecorderOptions),Pe()],ah.prototype,"mimeType",void 0),N1([(0,r.onChange)(ah.prototype.refreshRecorderOptions),Pe()],ah.prototype,"videoFrameRate",void 0);var Jx=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};const k1=new i.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});k1.depthTest=!1;const U1=new i.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});U1.depthTest=!1;class Pu extends El{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new i.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(ih)}async onAdded(e){const t=e.renderer.createTarget({type:i.ywz,format:i.wk1,colorSpace:i.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:i.wem,magFilter:i.wem});t.texture.name="groundContactDepthTexture";const n=new i.lRF({depthPacking:i.z81});n.onBeforeCompile=function(l){l.uniforms.opacity.value=1,l.fragmentShader=`
						${l.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const s=new $i(t,n,new i.Ilk(0,0,0),0);this._depthPass=s,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:i.ywz,format:i.wk1,colorSpace:i.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:i.wem,magFilter:i.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(k1.uniforms.h.value=t*this.blurAmount/256,U1.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:k1,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:U1,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new i.Pa4)),this.shadowCamera.setRotationFromEuler(new i.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var t;if(!this._viewer)return!1;const e=super._refreshMaterial();return this._material&&(this._material.alphaMap=((t=this._depthPass)==null?void 0:t.target.texture)||null,e&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),e}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function tC(a,e,t,n){a.traverse(s=>{s&&(s.userData.cloneRotI=e,s.userData.rotationCount=t,s.userData.rotationAxis=n,s.addEventListener("beforeRender",l=>function(c,f){var g;f&&((g=f.map)!=null&&g.isTexture)&&(f.extraUniformsToUpload||(f.extraUniformsToUpload={}),f.extraUniformsToUpload.uvTransform||(f.extraUniformsToUpload.uvTransform={value:new i.Vkp}),f.extraUniformsToUpload.uvTransform.value.setUvTransform(f.map.offset.x*f.map.repeat.x*c.userData.cloneRotI/(c.userData.rotationCount||1),f.map.offset.y*f.map.repeat.y*c.userData.cloneRotI/(c.userData.rotationCount||1),f.map.repeat.x,f.map.repeat.y,f.map.rotation,f.map.center.x,f.map.center.y))}(s,l.material)))})}function nC(a,e,t,n="x"){if(a.userData.rotationCount>1&&!a.userData.rotationRoot)return a;const s=a.parent;if(!s)throw new Error("No parent");if(a.userData.cloneParent){const c=a.userData.cloneParent;if(!(a=s.children.find(f=>c===f.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",c,s),a}let l=s.children.filter(c=>{var f;return((f=c.userData)==null?void 0:f.cloneParent)===a.uuid}).sort((c,f)=>c.userData.cloneRotI-f.userData.cloneRotI);if(a.userData.rotationCount===e&&e===l.length&&t===void 0&&a.userData.rotationAxis===n)return a;if(t==null&&(t=a.userData.rotationSkips??[]),t!==a.userData.rotationSkips&&(a.userData.rotationSkips=[...t]),tC(a,0,e,n),a.userData.rotationRoot=!0,a.visible=!0,e<=l.length){for(let c=e-1;c<l.length;c++)s.remove(l[c]),l[c].traverse(f=>f.userData={__disposed:!0});l=l.slice(0,e)}for(let c=1;c<e;c++){const f=c<=l.length?l[c-1]:a.clone();f.rotation.copy(a.rotation),f.rotation[n]+=c/e*Math.PI*2,tC(f,c,e,n),c>l.length&&s.add(f),f.visible=!t.includes(c)}return a.visible=!t.includes(0),a}Pu.PluginType="ContactShadowGroundPlugin",Jx([(0,r.onChange)(Pu.prototype.refreshOptions),Pe()],Pu.prototype,"contactShadows",void 0),Jx([Pe(),(0,r.onChange)(Pu.prototype._setDirty)],Pu.prototype,"blurAmount",void 0),Jx([Pe(),(0,r.onChange)(Pu.prototype._refreshShadowCameraFrustum)],Pu.prototype,"shadowScale",void 0),Jx([Pe(),(0,r.onChange)(Pu.prototype._refreshShadowCameraFrustum)],Pu.prototype,"shadowHeight",void 0);var Gv,nA=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let lh=Gv=class extends Ln{async onAdded(a){var e;await super.onAdded(a),(e=a.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}_selectedObjectChanged(){var t,n,s,l,c,f,g;if(!this.enabled)return;const a=(n=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"))==null?void 0:n.getSelectedObject();if(!a)return void((l=(s=this.uiConfig).uiRefresh)==null?void 0:l.call(s,"postFrame",!0));const e=a.userData.rotationRoot?a.userData.rotationCount??1:1;this.rotations=e,this.skips=((c=a.userData.rotationSkips)==null?void 0:c.join(","))??"",this.axis=a.userData.rotationAxis||"x",(g=(f=this.uiConfig).uiRefresh)==null||g.call(f,"postFrame",!0)}_paramsChanged(){var e,t,n,s,l,c;if(!this.enabled)return;const a=(t=(e=this._viewer)==null?void 0:e.getPluginByType("Picking"))==null?void 0:t.getSelectedObject();if(a){if(this.rotations>1||a.userData.rotationCount){const f=a.userData.rotationCount,g=nC(a,this.rotations,this.skips.split(",").map(x=>parseInt(x)).filter(x=>isFinite(x)),this.axis),y=g==null?void 0:g.userData.rotationCount;if(y&&y!==f){const x=[];g==null||g.traverseAncestors(S=>{x.push(S)});for(const S of x)if(S.userData.autoScaled){Ze(S),(n=this._viewer)==null||n.resetCamera({rootObject:S,centerOffset:new i.Pa4(4,4,4)});break}}a.parent&&!a.userData.__disposed||((l=(s=this._viewer)==null?void 0:s.getPluginByType("Picking"))==null||l.setSelectedObject(g,!0))}(c=this._viewer)==null||c.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};lh.PluginType="ObjectRotationPlugin",nA([Pe(),En("Enabled"),(0,r.onChange)(Gv.prototype._paramsChanged)],lh.prototype,"enabled",void 0),nA([Hn("Rotation Count",[1,100],1,a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!a.rotations}})),(0,r.onChange)(Gv.prototype._paramsChanged)],lh.prototype,"rotations",void 0),nA([Me("Axis",["x","y","z"].map(a=>({label:a})),a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!a.rotations}})),(0,r.onChange)(Gv.prototype._paramsChanged)],lh.prototype,"axis",void 0),nA([We("Rotation Skips",a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!a.rotations}})),(0,r.onChange)(Gv.prototype._paramsChanged)],lh.prototype,"skips",void 0),lh=Gv=nA([lt("Object Rotations")],lh);var Jg,Hv=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Du=Jg=class extends Ln{constructor(a=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,n)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const s of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=Yn(e.fragmentShader,`#include <${s}>`,i.WdD[s].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=Yn(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=Yn(e.fragmentShader,"#include <normal_fragment_maps>",Yn(Yn(i.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var t;return this.enabled+" "+((t=e.materialObject.bumpMap)==null?void 0:t.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:t},n)=>{if(this.enabled)for(const[s,l]of Object.entries(this._defines)){const c=typeof l=="number"?l:l?1:0;t.defines[s]!==c&&(t.defines[s]=c,t.needsUpdate=!0)}}},this.dependencies=[ri],this.enabled=a,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var a,e,t;(e=(a=this._bumpMapExtension)==null?void 0:a.setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()}async onAdded(a){var e,t;return(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.registerMaterialExtension(this._bumpMapExtension),super.onAdded(a)}async onRemove(a){var e,t;return(t=(e=a.getPlugin(ri))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(a)}};Du.PluginType="ReliefParallaxMapping",Hv([(0,r.onChange)(Jg.prototype._updateExtension),En("Enabled")],Du.prototype,"enabled",void 0),Hv([(0,r.onChange)(Jg.prototype._updateExtension),En("Debug Normals")],Du.prototype,"debugNormals",void 0),Hv([(0,r.onChange)(Jg.prototype._updateExtension),En("Debug Hit Height")],Du.prototype,"debugHitHeight",void 0),Hv([ke("PARALLAX_MAP_STEPS",void 0,!0,Jg.prototype._updateExtension),Hn("Step count",[1,32],1),Pe()],Du.prototype,"stepCount",void 0),Hv([ke("PARALLAX_MAP_B_STEPS",void 0,!0,Jg.prototype._updateExtension),Hn("Binary search steps",[1,8],1),Pe()],Du.prototype,"binaryStepCount",void 0),Du=Jg=Hv([lt("Parallax Mapping")],Du);class F1 extends i.u9r{constructor(e,t,n=32,s=64,l=!1,c=new i.FM8(1,1),f="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:n,tubularSegments:s,closed:l,primary:f,shapeScale:c.clone()};const g=t.computeFrenetFrames(s,l);this.frames=g;const y=new i.Pa4,x=new i.Pa4,S=new i.Pa4,C=new i.FM8;let L=new i.Pa4;const B=[],W=[],q=[],Z=e.getSpacedPoints(n);for(const se of Z)se.multiply(c);(function(){for(let se=0;se<s;se++)F(se);F(l===!1?s:0),function(){for(let se=0;se<=s;se++)for(let pe=0;pe<=n;pe++)C.x=se/s,C.y=pe/n,W.push(C.x,C.y)}(),function(){const se=f==="shape",pe=se?n:s,be=se?s:n;for(let Se=1;Se<=pe;Se++)for(let Be=1;Be<=be;Be++){const[Ge,Xe]=se?[Be,Se]:[Se,Be],Qe=(n+1)*(Ge-1)+(Xe-1),at=(n+1)*Ge+(Xe-1),Ke=(n+1)*Ge+Xe,Je=(n+1)*(Ge-1)+Xe;q.push(Qe,at,Je),q.push(at,Ke,Je)}}()})(),this.setIndex(q),this.setAttribute("position",new i.a$l(B,3)),this.setAttribute("uv",new i.a$l(W,2)),this.computeVertexNormals();const j=this.attributes.normal;function F(se){L=t.getPointAt(se/s,L);const pe=g.normals[se],be=g.binormals[se];for(let Se=0;Se<=n;Se++){const Be=Z[Se%n];x.set(0,0,0).addScaledVector(pe,Be.x).addScaledVector(be,Be.y),y.copy(L).add(x),B.push(y.x,y.y,y.z)}}(function(){for(let pe=1;pe<n;pe++){const be=pe+s*(n+1);x.fromBufferAttribute(j,pe),S.fromBufferAttribute(j,be),x.add(S).normalize(),j.setXYZ(pe,x.x,x.y,x.z),j.setXYZ(be,x.x,x.y,x.z)}for(let pe=1;pe<s;pe++){const be=pe*(n+1),Se=be+n;x.fromBufferAttribute(j,be),S.fromBufferAttribute(j,Se),x.add(S).normalize(),j.setXYZ(be,x.x,x.y,x.z),j.setXYZ(Se,x.x,x.y,x.z)}x.fromBufferAttribute(j,0),S.fromBufferAttribute(j,n),x.add(S);const se=s*(n+1);S.fromBufferAttribute(j,se),x.add(S),S.fromBufferAttribute(j,se+n),x.add(S),x.normalize(),j.setXYZ(0,x.x,x.y,x.z),j.setXYZ(n,x.x,x.y,x.z),j.setXYZ(se,x.x,x.y,x.z),j.setXYZ(se+n,x.x,x.y,x.z),j.needsUpdate=!0})()}createSplits(e){this.clearGroups();const t=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,n=this.index.count,s=[...e,1].sort();let l=0,c=0;for(const f of s){const g=Math.round(t*f)*n/t;this.addGroup(l,g-l,c++),l=g}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var z1,om=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let yc=z1=class extends Ln{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new i.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var n,s;const a=(s=(n=this._viewer)==null?void 0:n.getPlugin(Kr))==null?void 0:s.getSelectedObject();if(!a)return;let e=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!e)return;e=parseFloat(e);const t=new V1(0,0,e,e,0,2*Math.PI,!0,0);await this.extrudeObject(a,t)}}async onAdded(a){await super.onAdded(a)}static CreateCurve(a,e){if(a==="circle")return new V1(0,0,e.radius??1,e.radius??1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(a,e,t=this.shapeSegments,n=this.tubularSegments,s=this.shapeScale,l=this.materialSplits.split(",").map(f=>parseFloat(f.trim())),c=this.horizontalSplits){var C,L,B,W,q,Z,j,F;if(a.userData.isExtrudedTube,a.userData._extrudeSource){const se=a.userData._extrudeSource;if(a=(C=a.parent)==null?void 0:C.children.find(pe=>se===pe.uuid),!a)return void console.warn("Could not find extrude source with uuid",se)}if(a.userData.extrudedObject){const se=a.userData.extrudedObject,pe=(L=a.parent)==null?void 0:L.children.find(be=>se===be.uuid);pe&&(pe.removeFromParent(),pe.geometry.dispose(),pe.geometry=null,pe.material=null),delete a.userData.extrudedObject}const f=a.geometry;if(!f)return void((B=this._viewer)==null?void 0:B.alert("Extrude: No geometry to extrude"));const g=[a.material];let y;try{const se=z1.ConvertGeometryToFlatShape(f);y=new F1(se,e,t,n,!0,s,c?"shape":"path"),y.computeBoundingBox(),y.createSplits(l)}catch(se){return void((W=this._viewer)==null?void 0:W.alert(typeof se=="string"?se:se==null?void 0:se.message))}g[0].color.set(16777215);for(let se=g.length;se<y.groups.length;se++){const pe=g[0].clone();g.push(pe),pe.color.set(16777215*Math.random())}const x=new i.Kj0(y,g);x.userData._extrudeSource=a.uuid,x.userData.isExtrudedTube=!0,a.visible=!1,a.userData.bboxVisible=!1,x.name=a.name+"_extruded";const S=await((j=(Z=(q=this._viewer)==null?void 0:q.getManager())==null?void 0:Z.importer)==null?void 0:j.processImportedSingle(x,{autoCenter:!1,autoScale:!1}));S&&((F=a.parent)==null||F.add(S.modelObject),a.userData.extrudedObject=S.modelObject.uuid,S.dispatchEvent({type:"select",ui:!0,value:S}))}static ExtrudeShape(a,e,t,n,s,l,c,f){const g=new F1(a,n,e,t,!0,new i.FM8(s,l),f?"shape":"path");g.computeBoundingBox(),g.createSplits(c);const y=new i.Kj0(g,[]);return y.userData.isExtrudedTube=!0,y}static ConvertGeometryToFlatShape(a,e=!0){if(a.userData.__planarShape)return a.userData.__planarShape;let t=a.attributes.position;if(!t)throw"no position attribute";if(t.count>500)throw"too large to extrude";const n=a;t=n.attributes.position,n.boundingBox||n.computeBoundingBox();const s=n.boundingBox.getSize(new i.Pa4),l=s.x<.001?"x":s.y<.001?"y":s.z<.001?"z":null;if(!l)throw"geometry is not axis aligned not planar";let c=[];for(let g=0;g<t.count;g++){const y=new i.FM8;l==="x"?y.set(t.getY(g),t.getZ(g)):l==="y"?y.set(t.getX(g),t.getZ(g)):y.set(t.getX(g),t.getY(g)),c.push(y)}if(e){let g=0;for(let y=0;y<c.length;y++)(c[y].x<c[g].x||c[y].x===c[g].x&&c[y].y<c[g].y)&&(g=y);g!==0&&(c=c.slice(g).concat(c.slice(0,g)))}const f=new i.bnF(c);return a.userData.__planarShape=f,f}};yc.PluginType="ShapeTubeExtrudePlugin",om([En("Enabled")],yc.prototype,"enabled",void 0),om([Hn("Shape Segments (X)",[1,100],1,a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Kr))!=null&&t.getSelectedObject())}}))],yc.prototype,"shapeSegments",void 0),om([Hn("Tube Segments (Y)",[1,100],1,a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Kr))!=null&&t.getSelectedObject())}}))],yc.prototype,"tubularSegments",void 0),om([Ni("Shape scale",[.01,10],.01,a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Kr))!=null&&t.getSelectedObject())}}))],yc.prototype,"shapeScale",void 0),om([We("Material Splits",a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Kr))!=null&&t.getSelectedObject())}}))],yc.prototype,"materialSplits",void 0),om([En("Horizontal Splits",a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Kr))!=null&&t.getSelectedObject())}}))],yc.prototype,"horizontalSplits",void 0),om([Ee("Extrude Circle Tube",a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Kr))!=null&&t.getSelectedObject())}}))],yc.prototype,"extrudeCirceTube",void 0),yc=z1=om([lt("Extrude Tube Shapes")],yc);class V1 extends i.Ny0{getPoint(e,t){return super.getPoint(e,t||new i.Pa4)}}class Wv extends Ln{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var l,c;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((l=this._viewer.getPluginByType("FrameFade"))==null||l.enable(Wv.PluginType),this._fadeDisabled=!1));const t=(0,r.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=t-1/60);let n=t-this._lastFrameTime;this._lastFrameTime=t;const s=(c=this._viewer.getPluginByType("Progressive"))==null?void 0:c.postFrameConvergedRecordingDelta();if(s&&s>0&&(n=s),s!==0&&(n*=1e3,!(n<=.001)&&(this._updaters.forEach(f=>{let g=n;f.time+g<0&&(g=-f.time),f.time+=g,Math.abs(g)>.001&&f.u(g)}),!this._fadeDisabled&&this.disableFrameFade))){const f=this._viewer.getPluginByType("FrameFade");f&&(f.disable(Wv.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=t=>({start:()=>this._updaters.push({u:t,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(n=>n.u===t),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=mn(),n={id:t,options:e,stop:()=>{var s,l,c;(s=this.animations[t])!=null&&s._stop?(c=(l=this.animations[t])==null?void 0:l._stop)==null||c.call(l):console.warn("Animation not started")}};return this.animations[t]=n,n.promise=new Promise((s,l)=>{const c={driver:this.defaultDriver,...e,onComplete:()=>{var g;(g=e.onComplete)==null||g.call(e),s()},onStop:()=>{var g;(g=e.onStop)==null||g.call(e),s()}},f=Ju(c);this.animations[t]._stop=f.stop,this.animations[t].options=c}).then(()=>(delete this.animations[t],t)),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}Wv.PluginType="PopmotionPlugin";var j1,ch,mo=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};const Tl=a=>({onChange:e=>{e.last&&a.onChange()}});let oa=j1=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(a){Object.assign(this,a)}reset(){const a=this.onChange;Object.assign(this,new j1),this.onChange=a}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};mo([We("Text",Tl)],oa.prototype,"text",void 0),mo([Hn("Font Size",[2,400],1,Tl)],oa.prototype,"fontSize",void 0),mo([Hn("Width",[2,4096],1,Tl)],oa.prototype,"width",void 0),mo([Hn("Height",[2,4096],1,Tl)],oa.prototype,"height",void 0),mo([Hn("X Offset",[-1024,1024],1,Tl)],oa.prototype,"xOffset",void 0),mo([Hn("Y Offset",[-1024,1024],1,Tl)],oa.prototype,"yOffset",void 0),mo([Hn("V-Width",[2,4096],1,Tl)],oa.prototype,"boxWidth",void 0),mo([Hn("V-Height",[2,4096],1,Tl)],oa.prototype,"boxHeight",void 0),mo([Me("Text Anchor",["start","middle","end"].map(a=>({label:a})),Tl)],oa.prototype,"textAnchor",void 0),mo([We("Font",Tl)],oa.prototype,"fontFamily",void 0),mo([We("Font Url",Tl)],oa.prototype,"fontPath",void 0),mo([En("Mask Text",Tl)],oa.prototype,"maskText",void 0),mo([En("Inner Shadow",Tl)],oa.prototype,"innerShadow",void 0),mo([it("Text Color",Tl)],oa.prototype,"textColor",void 0),mo([it("BG Fill",Tl)],oa.prototype,"bgFillColor",void 0),mo([it("SVG BG",Tl)],oa.prototype,"svgBackground",void 0),oa=j1=mo([lt("Text SVG Options")],oa);const iC={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},iA=a=>({hidden:()=>{const e=a.getSelected();return!e||!e.userData[Ac.PluginType]}});let Ac=ch=class extends Ln{async onAdded(a){var e;await super.onAdded(a),(e=a.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var a,e;return(e=(a=this._viewer)==null?void 0:a.getPluginByType("Picking"))==null?void 0:e.getSelectedObject()},this.options=new oa,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var t,n,s,l,c,f;if(!this.enabled)return;const a=this.getSelected();if(!a)return void((n=(t=this.uiConfig).uiRefresh)==null?void 0:n.call(t,"postFrame",!0));const e=a.userData[ch.PluginType];if(!e)return this.options.reset(),this._lastMeta=void 0,void((l=(s=this.uiConfig).uiRefresh)==null?void 0:l.call(s,"postFrame",!0));this._lastMeta!==e&&(this.options.set(e),this._lastMeta=e),(f=(c=this.uiConfig).uiRefresh)==null||f.call(c,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const a=this.getSelected();a&&a.isMesh&&a.userData[ch.PluginType]&&this.updateText(a,this.options.toJSON())}async addTextToSelected(){var e;const a=this.getSelected();a&&a.isMesh?a.material?(a.userData[ch.PluginType]||!a.material.map||await((e=this._viewer)==null?void 0:e.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(a):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(a,e){return this.updateText(a,Object.assign(this.options.toJSON(),e))}async updateText(a,e){var l,c;if(!a.isMesh)return;if(!a.material)return void console.error("updateText: no material on mesh");let t=a.userData[ch.PluginType];t||(a.userData[ch.PluginType]=t={}),Object.assign(t,e);const n=a.material;n.map&&(n.map._isSimpleTextTexture&&n.map.dispose(),n.map=void 0),n.alphaMap&&(n.alphaMap._isSimpleTextTexture&&n.alphaMap.dispose(),n.alphaMap=void 0),n.bumpMap&&(n.bumpMap._isSimpleTextTexture&&n.bumpMap.dispose(),n.bumpMap=void 0);const s=await this.makeTextSvg(t);this.applyToMap&&(n.map=s),this.applyToAlphaMap&&(n.alphaMap=s,n.transparent=!0),this.applyToBumpMap&&(n.bumpMap=s),n.userData.inverseAlphaMap=this.inverseAlphaMap,n.setDirty(),n.needsUpdate=!0,(c=(l=this.uiConfig).uiRefresh)==null||c.call(l,"postFrame",!0)}async makeTextSvg(a){const e=a.fontFamily||"Arial",t=a.fontPath||this.fonts[e]||"";let n=a.style;if(t.length>0){const c=t.split("?")[0].split(".").pop()||"woff";n+=`
`+(t.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${t}) format(${iC[c]||c});
            }`:"")}let s=function({text:c="Custom Text",svgBackground:f="#ffffff",xOffset:g=0,yOffset:y=0,width:x=1024,height:S=1024,boxWidth:C=1024,boxHeight:L=1024,fontFamily:B="",fontSize:W=32,maskText:q=!0,innerShadow:Z=!0,bgFillColor:j="#000000",textColor:F="#ffffff",textAnchor:se="middle",style:pe=""}){return`
<svg style="background-color:${f}" width="${x}" height="${S}" viewBox="0 0 ${C} ${L}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${pe}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: ${se}; font-size: ${W}px; font-family: ${B||"Arial"}">
        <defs>

`+(q?`
<mask id="textMask">
<text style="fill:white; font-size: ${W}px;" x="${g+C/2}" y="${L/2+y+W/4}" > ${c} </text>
</mask>
`:"")+`

`+(Z?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(q?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${C}" height="${L}" style="fill:${j}"/>
        <text style="${Z?"filter: url(#innerShadow);":""} fill:${F};" x="${g+C/2}" y="${L/2+y+W/4}"> ${c} </text>

`+(q?`
        </g>
`:"")+`

    </g>
</svg>
`}({...a,fontFamily:e,style:n});s=await(0,r.embedUrlRefs)(s,async c=>this._getAssetData(c)),s=(0,r.svgUrl)(s);const l=await this._viewer.getManager().importer.importSinglePath(s,{generateMipmaps:!1,minFilter:i.wem});return l._isSimpleTextTexture=!0,l.flipY=!1,l.needsUpdate=!0,l}async _getAssetData(a){var t,n;if(a.startsWith("http://www.w3.org"))return a;const e=(n=(t=this._viewer)==null?void 0:t.getManager())==null?void 0:n.importer;if(!e)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new fT(e.loadingManager),processImported:!1};try{return await e.importPath(a,this._assetLoadOptions)}catch(s){return console.error(s),""}}};Ac.PluginType="SimpleTextPlugin",mo([Di(void 0,{params:iA})],Ac.prototype,"options",void 0),mo([En("Apply Map",iA),(0,r.onChange)(ch.prototype._paramsChanged)],Ac.prototype,"applyToMap",void 0),mo([En("Apply Bump Map",iA),(0,r.onChange)(ch.prototype._paramsChanged)],Ac.prototype,"applyToBumpMap",void 0),mo([En("Apply Alpha Map",iA),(0,r.onChange)(ch.prototype._paramsChanged)],Ac.prototype,"applyToAlphaMap",void 0),mo([En("Invert Alpha Map",iA),(0,r.onChange)(ch.prototype._paramsChanged)],Ac.prototype,"inverseAlphaMap",void 0),mo([Ee("Add Text",a=>({hidden:()=>!a.getSelected()}))],Ac.prototype,"addTextToSelected",null),Ac=ch=mo([lt("Simple Text")],Ac);class G1{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class hD{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class ud{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new ud;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,n=new Array;for(let s=0;s<e.length;s++)this.plane.splitPolygon(e[s],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],n=[];for(let s=0;s<e.length;s++)this.plane.splitPolygon(e[s],this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new ud),this.front.build(t)),n.length&&(this.back||(this.back=new ud),this.back.build(n))}}class bc{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new bc(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(new bc().copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),n=t.x,s=t.y,l=t.z,c=e.x,f=e.y,g=e.z;return this.x=s*g-l*f,this.y=l*c-n*g,this.z=n*f-s*c,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new i.Pa4(this.x,this.y,this.z)}}class Zg{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new Zg(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,n,s,l){let c=0;const f=[];for(let g=0;g<e.vertices.length;g++){const y=this.normal.dot(e.vertices[g].pos)-this.w,x=y<-Zg.EPSILON?2:y>Zg.EPSILON?1:0;c|=x,f.push(x)}switch(c){case 0:(this.normal.dot(e.plane.normal)>0?t:n).push(e);break;case 1:s.push(e);break;case 2:l.push(e);break;case 3:{const g=[],y=[];for(let x=0;x<e.vertices.length;x++){const S=(x+1)%e.vertices.length,C=f[x],L=f[S],B=e.vertices[x],W=e.vertices[S];if(C!=2&&g.push(B),C!=1&&y.push(C!=2?B.clone():B),(C|L)==3){const q=(this.w-this.normal.dot(B.pos))/this.normal.dot(new bc().copy(W.pos).sub(B.pos)),Z=B.interpolate(W,q);g.push(Z),y.push(Z.clone())}}g.length>=3&&s.push(new Qv(g,e.shared)),y.length>=3&&l.push(new Qv(y,e.shared));break}}}static fromPoints(e,t,n){const s=new bc().copy(t).sub(e).cross(new bc().copy(n).sub(e)).normalize();return new Zg(s.clone(),s.dot(e))}}Zg.EPSILON=1e-5;class Qv{constructor(e,t){this.vertices=e,this.shared=t,this.plane=Zg.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new Qv(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class Zx{constructor(e,t,n,s){this.pos=new bc().copy(e),this.normal=new bc().copy(t),this.uv=new bc().copy(n),this.uv.z=0,s&&(this.color=new bc().copy(s))}clone(){return new Zx(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new Zx(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class Po{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new Po;return t.polygons=e,t}static fromGeometry(e,t){let n=[];const s=e.attributes.position,l=e.attributes.normal,c=e.attributes.uv,f=e.attributes.color,g=e.groups;let y;if(e.index)y=e.index.array;else{y=new Array(s.array.length/s.itemSize|0);for(let S=0;S<y.length;S++)y[S]=S}const x=y.length/3|0;n=new Array(x);for(let S=0,C=0,L=y.length;S<L;S+=3,C++){const B=new Array(3);for(let W=0;W<3;W++){const q=y[S+W],Z=3*q,j=2*q,F=s.array[Z],se=s.array[Z+1],pe=s.array[Z+2],be=l.array[Z],Se=l.array[Z+1],Be=l.array[Z+2],Ge=c==null?void 0:c.array[j],Xe=c==null?void 0:c.array[j+1];B[W]=new Zx(new bc(F,se,pe),new bc(be,Se,Be),new bc(Ge,Xe,0),f&&new bc(f.array[j],f.array[j+1],f.array[j+2]))}if(t===void 0&&g&&g.length>0)for(const W of g)S>=W.start&&S<W.start+W.count&&(n[C]=new Qv(B,W.materialIndex));else n[C]=new Qv(B,t)}return Po.fromPolygons(n.filter(S=>!isNaN(S.plane.normal.x)))}static toGeometry(e,t){let n=0;const s=e.polygons;for(const L of s)n+=L.vertices.length-2;const l=new i.u9r,c=new G1(3*n*3),f=new G1(3*n*3),g=new hD(2*n*3);let y;const x=[],S=[];for(const L of s){const B=L.vertices,W=B.length;L.shared!==void 0&&(x[L.shared]||(x[L.shared]=[])),W&&B[0].color!==void 0&&(y||(y=new G1(3*n*3)));for(let q=3;q<=W;q++)(L.shared===void 0?S:x[L.shared]).push(c.top/3,c.top/3+1,c.top/3+2),c.write(B[0].pos),c.write(B[q-2].pos),c.write(B[q-1].pos),f.write(B[0].normal),f.write(B[q-2].normal),f.write(B[q-1].normal),g&&(g.write(B[0].uv),g.write(B[q-2].uv),g.write(B[q-1].uv)),y&&(y.write(B[0].color),y.write(B[q-2].color),y.write(B[q-1].color))}l.setAttribute("position",new i.TlE(c.array,3)),l.setAttribute("normal",new i.TlE(f.array,3)),g&&l.setAttribute("uv",new i.TlE(g.array,2)),y&&l.setAttribute("color",new i.TlE(y.array,3));for(let L=0;L<x.length;L++)x[L]===void 0&&(x[L]=[]);if(x.length){let L=[],B=0;for(let W=0;W<x.length;W++)l.addGroup(B,x[W].length,W),B+=x[W].length,L=L.concat(x[W]);l.addGroup(B,S.length,x.length),L=L.concat(S),l.setIndex(L)}const C=new i.yGw().copy(t).invert();return l.applyMatrix4(C),l.computeBoundingSphere(),l.computeBoundingBox(),l}static fromMesh(e,t){const n=Po.fromGeometry(e.geometry,t),s=new i.Pa4,l=new i.Vkp;l.getNormalMatrix(e.matrix);for(let c=0;c<n.polygons.length;c++){const f=n.polygons[c];for(let g=0;g<f.vertices.length;g++){const y=f.vertices[g];y.pos.copy(s.copy(y.pos.toVector3()).applyMatrix4(e.matrix)),y.normal.copy(s.copy(y.normal.toVector3()).applyMatrix3(l))}}return n}static toMesh(e,t,n){const s=Po.toGeometry(e,t),l=new i.Kj0(s,n);return l.matrix.copy(t),l.matrix.decompose(l.position,l.quaternion,l.scale),l.rotation.setFromQuaternion(l.quaternion),l.updateMatrixWorld(),l.castShadow=l.receiveShadow=!0,l}static union(e,t){const n=Po.fromMesh(e),s=Po.fromMesh(t);return Po.toMesh(n.union(s),e.matrix,e.material)}static subtract(e,t){const n=Po.fromMesh(e),s=Po.fromMesh(t);return Po.toMesh(n.subtract(s),e.matrix,e.material)}static intersect(e,t){const n=Po.fromMesh(e),s=Po.fromMesh(t);return Po.toMesh(n.intersect(s),e.matrix,e.material)}clone(){const e=new Po;return e.polygons=this.polygons.map(t=>t.clone()).filter(t=>Number.isFinite(t.plane.w)),e}toPolygons(){return this.polygons}union(e){const t=new ud(this.clone().polygons),n=new ud(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),Po.fromPolygons(t.allPolygons())}subtract(e){const t=new ud(this.clone().polygons),n=new ud(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),Po.fromPolygons(t.allPolygons())}intersect(e){const t=new ud(this.clone().polygons),n=new ud(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),Po.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return Po.toMesh(this,e,t)}toGeometry(e){return Po.toGeometry(this,e)}}var Xv=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};const H1=["union","subtract","intersect"];class Ip extends Ln{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Kr],this.rootMesh=new i.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var t;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(t=e.getPlugin(Kr))==null||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var t,n;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(Kr))==null?void 0:n.getSelectedObject();e&&e.geometry&&(e.userData._isCSGMesh||(e.userData.csgBrush||(e.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,r.downloadBlob)(e,"csg."+e.ext)}async exportObject(){var s,l;const e=(l=(s=this._viewer)==null?void 0:s.getPluginByType("AssetExporterPlugin"))==null?void 0:l.exporter;if(!e||!this.rootObject)return;const t=this.rootMesh.visible;this.rootMesh.visible=!0;const n=await e.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=t,n}_updateSelectedProperties(){var t,n;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(Kr))==null?void 0:n.getSelectedObject();e&&e.userData.csgBrush&&(e.userData.csgBrush.enabled=this.csgSelectedEnabled,e.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var t,n,s,l,c,f;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(Kr))==null?void 0:n.getSelectedObject();e&&(this.csgSelectedEnabled=((s=e.userData.csgBrush)==null?void 0:s.enabled)??!1,this.csgSelectedOperation=((l=e.userData.csgBrush)==null?void 0:l.operation)??"union"),(f=(c=this.uiConfig)==null?void 0:c.uiRefresh)==null||f.call(c,"postFrame",!0)}_preFrame(){var t,n;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const e=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(t=this.rootObject)==null||t.modelObject.updateMatrixWorld(!0),(this.rootMesh.userData.dispose??this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(e)),this.rootMesh&&!this.rootMesh.parent&&((n=this.rootObject)==null||n.modelObject.add(this.rootMesh)),this.showResult?(e.forEach(s=>{s[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(e.forEach(s=>{s[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var t;const e=[];return(t=this._viewer)==null||t.scene.traverse(n=>{var s;n.isMesh&&n.geometry&&((s=n.userData.csgBrush)!=null&&s.enabled)&&e.push([n,n.userData.csgBrush.operation])}),e}_sceneUpdate(e){var t,n;(n=(t=e==null?void 0:e.object)==null?void 0:t.userData)!=null&&n._isCSGMesh||(this._csgNeedsUpdate=!0)}}Xv([En("Show Result",a=>({onChange:()=>{var e;return(e=a._viewer)==null?void 0:e.setDirty()}}))],Ip.prototype,"showResult",void 0),Xv([Ee("Make CSG Brush",a=>({hidden:()=>{var t,n;const e=(n=(t=a._viewer)==null?void 0:t.getPlugin(Kr))==null?void 0:n.getSelectedObject();return!(e!=null&&e.userData)||!!e.userData.csgBrush||e.userData._isCSGMesh}}))],Ip.prototype,"makeSelectedCSGBrush",null),Xv([En("Enabled",a=>({hidden:()=>{var t,n;const e=(n=(t=a._viewer)==null?void 0:t.getPlugin(Kr))==null?void 0:n.getSelectedObject();return!e||!e.userData.csgBrush},onChange:a._updateSelectedProperties}))],Ip.prototype,"csgSelectedEnabled",void 0),Xv([Me("Operation",H1.map(a=>({label:a})),a=>({hidden:()=>{var t,n;const e=(n=(t=a._viewer)==null?void 0:t.getPlugin(Kr))==null?void 0:n.getSelectedObject();return!e||!e.userData.csgBrush},onChange:a._updateSelectedProperties}))],Ip.prototype,"csgSelectedOperation",void 0),Xv([Ee("Refresh CSG")],Ip.prototype,"refreshCSG",null),Xv([Ee("Export Result",a=>({hidden:()=>{var e;return!((e=a._viewer)!=null&&e.getPluginByType("AssetExporterPlugin"))}}))],Ip.prototype,"downloadObject",null);function rC(a,e){let t=new Po;const n=a.map(l=>l[0].material).flatMap(l=>l);a.forEach(([l,c])=>{if(!H1.includes(c))return void console.error(`Unknown operation ${c}`);l.updateMatrix(),l.updateMatrixWorld();const f=l.matrix;l.matrix=l.matrixWorld;let g=0;g=Array.isArray(l.material)?void 0:n.indexOf(l.material),t=t[c](Po.fromMesh(l,g)),l.matrix=f});const s=t.toMesh(e??new i.yGw().identity(),n);return s.userData._isCSGMesh=!0,s.geometry.groups=s.geometry.groups.filter(l=>l.count>0),s}let rA=class extends Ip{_buildCSGMesh(a){return rC(a)}};rA.PluginType="CSGPluginBSP",rA=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c}([lt("CSG Plugin (BSP)")],rA);const sC=0,oC=1,aC=3,lC=4;class Pp{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,s=-1/0;for(let l=0,c=e.length;l<c;l++){const f=e[l][t];n=f<n?f:n,s=f>s?f:s}this.min=n,this.max=s}setFromPoints(e,t){let n=1/0,s=-1/0;for(let l=0,c=t.length;l<c;l++){const f=t[l],g=e.dot(f);n=g<n?g:n,s=g>s?g:s}this.min=n,this.max=s}isSeparated(e){return this.min>e.max||e.min>this.max}}Pp.prototype.setFromBox=function(){const a=new i.Pa4;return function(e,t){const n=t.min,s=t.max;let l=1/0,c=-1/0;for(let f=0;f<=1;f++)for(let g=0;g<=1;g++)for(let y=0;y<=1;y++){a.x=n.x*f+s.x*(1-f),a.y=n.y*g+s.y*(1-g),a.z=n.z*y+s.z*(1-y);const x=e.dot(a);l=Math.min(x,l),c=Math.max(x,c)}this.min=l,this.max=c}}();const dD=function(){const a=new i.Pa4,e=new i.Pa4,t=new i.Pa4;return function(n,s,l){const c=n.start,f=a,g=s.start,y=e;t.subVectors(c,g),a.subVectors(n.end,n.start),e.subVectors(s.end,s.start);const x=t.dot(y),S=y.dot(f),C=y.dot(y),L=t.dot(f),B=f.dot(f)*C-S*S;let W,q;W=B!==0?(x*S-L*C)/B:0,q=(x+W*S)/C,l.x=W,l.y=q}}(),W1=function(){const a=new i.FM8,e=new i.Pa4,t=new i.Pa4;return function(n,s,l,c){dD(n,s,a);let f=a.x,g=a.y;if(f>=0&&f<=1&&g>=0&&g<=1)return n.at(f,l),void s.at(g,c);if(f>=0&&f<=1)return g<0?s.at(0,c):s.at(1,c),void n.closestPointToPoint(c,!0,l);if(g>=0&&g<=1)return f<0?n.at(0,l):n.at(1,l),void s.closestPointToPoint(l,!0,c);{let y,x;y=f<0?n.start:n.end,x=g<0?s.start:s.end;const S=e,C=t;return n.closestPointToPoint(x,!0,e),s.closestPointToPoint(y,!0,t),S.distanceToSquared(x)<=C.distanceToSquared(y)?(l.copy(S),void c.copy(x)):(l.copy(y),void c.copy(C))}}}(),pD=function(){const a=new i.Pa4,e=new i.Pa4,t=new i.JOQ,n=new i.Zzh;return function(s,l){const{radius:c,center:f}=s,{a:g,b:y,c:x}=l;if(n.start=g,n.end=y,n.closestPointToPoint(f,!0,a).distanceTo(f)<=c||(n.start=g,n.end=x,n.closestPointToPoint(f,!0,a).distanceTo(f)<=c)||(n.start=y,n.end=x,n.closestPointToPoint(f,!0,a).distanceTo(f)<=c))return!0;const S=l.getPlane(t);if(Math.abs(S.distanceToPoint(f))<=c){const C=S.projectPoint(f,e);if(l.containsPoint(C))return!0}return!1}}(),fD=1e-15;function qv(a){return Math.abs(a)<fD}class hd extends i.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new i.Pa4),this.satBounds=new Array(4).fill().map(()=>new Pp),this.points=[this.a,this.b,this.c],this.sphere=new i.aLr,this.plane=new i.JOQ,this.needsUpdate=!0}intersectsSphere(e){return pD(e,this)}update(){const e=this.a,t=this.b,n=this.c,s=this.points,l=this.satAxes,c=this.satBounds,f=l[0],g=c[0];this.getNormal(f),g.setFromPoints(f,s);const y=l[1],x=c[1];y.subVectors(e,t),x.setFromPoints(y,s);const S=l[2],C=c[2];S.subVectors(t,n),C.setFromPoints(S,s);const L=l[3],B=c[3];L.subVectors(n,e),B.setFromPoints(L,s),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(f,e),this.needsUpdate=!1}}hd.prototype.closestPointToSegment=function(){const a=new i.Pa4,e=new i.Pa4,t=new i.Zzh;return function(n,s=null,l=null){const{start:c,end:f}=n,g=this.points;let y,x=1/0;for(let S=0;S<3;S++){const C=(S+1)%3;t.start.copy(g[S]),t.end.copy(g[C]),W1(t,n,a,e),y=a.distanceToSquared(e),y<x&&(x=y,s&&s.copy(a),l&&l.copy(e))}return this.closestPointToPoint(c,a),y=c.distanceToSquared(a),y<x&&(x=y,s&&s.copy(a),l&&l.copy(c)),this.closestPointToPoint(f,a),y=f.distanceToSquared(a),y<x&&(x=y,s&&s.copy(a),l&&l.copy(f)),Math.sqrt(x)}}(),hd.prototype.intersectsTriangle=function(){const a=new hd,e=new Array(3),t=new Array(3),n=new Pp,s=new Pp,l=new i.Pa4,c=new i.Pa4,f=new i.Pa4,g=new i.Pa4,y=new i.Zzh,x=new i.Zzh,S=new i.Zzh;return function(C,L=null,B=!1){this.needsUpdate&&this.update(),C.isExtendedTriangle?C.needsUpdate&&C.update():(a.copy(C),a.update(),C=a);const W=this.plane,q=C.plane;if(Math.abs(W.normal.dot(q.normal))>1-1e-10){const Z=this.satBounds,j=this.satAxes;t[0]=C.a,t[1]=C.b,t[2]=C.c;for(let pe=0;pe<4;pe++){const be=Z[pe],Se=j[pe];if(n.setFromPoints(Se,t),be.isSeparated(n))return!1}const F=C.satBounds,se=C.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let pe=0;pe<4;pe++){const be=F[pe],Se=se[pe];if(n.setFromPoints(Se,e),be.isSeparated(n))return!1}for(let pe=0;pe<4;pe++){const be=j[pe];for(let Se=0;Se<4;Se++){const Be=se[Se];if(l.crossVectors(be,Be),n.setFromPoints(l,e),s.setFromPoints(l,t),n.isSeparated(s))return!1}}return L&&(B||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),L.start.set(0,0,0),L.end.set(0,0,0)),!0}{const Z=this.points;let j=!1,F=0;for(let Qe=0;Qe<3;Qe++){const at=Z[Qe],Ke=Z[(Qe+1)%3];y.start.copy(at),y.end.copy(Ke),y.delta(c);const Je=j?x.start:x.end,ft=qv(q.distanceToPoint(at));if(qv(q.normal.dot(c))&&ft){x.copy(y),F=2;break}if((q.intersectLine(y,Je)||ft)&&!qv(Je.distanceTo(Ke))){if(F++,j)break;j=!0}}if(F===1&&C.containsPoint(x.end))return L&&(L.start.copy(x.end),L.end.copy(x.end)),!0;if(F!==2)return!1;const se=C.points;let pe=!1,be=0;for(let Qe=0;Qe<3;Qe++){const at=se[Qe],Ke=se[(Qe+1)%3];y.start.copy(at),y.end.copy(Ke),y.delta(f);const Je=pe?S.start:S.end,ft=qv(W.distanceToPoint(at));if(qv(W.normal.dot(f))&&ft){S.copy(y),be=2;break}if((W.intersectLine(y,Je)||ft)&&!qv(Je.distanceTo(Ke))){if(be++,pe)break;pe=!0}}if(be===1&&this.containsPoint(S.end))return L&&(L.start.copy(S.end),L.end.copy(S.end)),!0;if(be!==2)return!1;if(x.delta(c),S.delta(f),c.dot(f)<0){let Qe=S.start;S.start=S.end,S.end=Qe}const Se=x.start.dot(c),Be=x.end.dot(c),Ge=S.start.dot(c),Xe=S.end.dot(c);return(Se===Xe||Ge===Be||Be<Ge!=Se<Xe)&&(L&&(g.subVectors(x.start,S.start),g.dot(c)>0?L.start.copy(x.start):L.start.copy(S.start),g.subVectors(x.end,S.end),g.dot(c)<0?L.end.copy(x.end):L.end.copy(S.end)),!0)}}}(),hd.prototype.distanceToPoint=function(){const a=new i.Pa4;return function(e){return this.closestPointToPoint(e,a),e.distanceTo(a)}}(),hd.prototype.distanceToTriangle=function(){const a=new i.Pa4,e=new i.Pa4,t=["a","b","c"],n=new i.Zzh,s=new i.Zzh;return function(l,c=null,f=null){const g=c||f?n:null;if(this.intersectsTriangle(l,g))return(c||f)&&(c&&g.getCenter(c),f&&g.getCenter(f)),0;let y=1/0;for(let x=0;x<3;x++){let S;const C=t[x],L=l[C];this.closestPointToPoint(L,a),S=L.distanceToSquared(a),S<y&&(y=S,c&&c.copy(a),f&&f.copy(L));const B=this[C];l.closestPointToPoint(B,a),S=B.distanceToSquared(a),S<y&&(y=S,c&&c.copy(B),f&&f.copy(a))}for(let x=0;x<3;x++){const S=t[x],C=t[(x+1)%3];n.set(this[S],this[C]);for(let L=0;L<3;L++){const B=t[L],W=t[(L+1)%3];s.set(l[B],l[W]),W1(n,s,a,e);const q=a.distanceToSquared(e);q<y&&(y=q,c&&c.copy(a),f&&f.copy(e))}}return Math.sqrt(y)}}();const Yv=1e-14,Kv=1e-10,Dp=new i.Zzh,Ko=new i.Zzh,Lp=new i.Pa4,cC=new i.Pa4,sA=new i.JOQ,mD=new hd;function oA(a){return a.a.distanceToSquared(a.b)<Yv||a.a.distanceToSquared(a.c)<Yv||a.b.distanceToSquared(a.c)<Yv}class gD{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new i.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class _D{constructor(){this.trianglePool=new gD,this.triangles=[],this.normal=new i.Pa4}initialize(e){const{triangles:t,trianglePool:n,normal:s}=this;if(t.length=0,n.clear(),Array.isArray(e))for(let l=0,c=e.length;l<c;l++){const f=e[l];if(l===0)f.getNormal(s);else if(Math.abs(1-f.getNormal(Lp).dot(s))>Yv)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const g=n.getTriangle();g.copy(f),t.push(g)}else{e.getNormal(s);const l=n.getTriangle();l.copy(e),t.push(l)}}splitByTriangle(e){const{normal:t,triangles:n}=this;if(e.getPlane(sA),Math.abs(1-Math.abs(sA.normal.dot(t)))<Kv){const s=[e.a,e.b,e.c];for(let l=0;l<3;l++){const c=(l+1)%3,f=s[l],g=s[c];Lp.subVectors(g,f).normalize(),cC.crossVectors(t,Lp),sA.setFromNormalAndCoplanarPoint(cC,f),this.splitByPlane(sA,e,l)}for(let l=0,c=n.length;l<c;l++)n[l].coplanarCount=0}else this.splitByPlane(sA,e)}splitByPlane(e,t=null,n=-1){const{triangles:s,trianglePool:l}=this;let c=null;t!==null&&(c=mD,c.copy(t),c.needsUpdate=!0);for(let f=0,g=s.length;f<g;f++){const y=s[f],{a:x,b:S,c:C}=y;if(c&&!c.intersectsTriangle(y,Dp,!0))continue;let L=0,B=-1,W=0,q=!1;const Z=[x,S,C];for(let j=0;j<3;j++){const F=(j+1)%3;Dp.start.copy(Z[j]),Dp.end.copy(Z[F]);const se=e.distanceToPoint(Dp.start),pe=e.distanceToPoint(Dp.end);if(Math.abs(se)<Kv&&Math.abs(pe)<Kv){q=!0;break}if(Math.abs(se)<Kv)continue;se>0&&W++;let be=!!e.intersectLine(Dp,Lp);!be&&Math.abs(pe)<Kv&&(Lp.copy(Dp.end),be=!0),!be||Lp.distanceTo(Dp.start)<Yv||(Lp.distanceTo(Dp.end)<Yv&&(B=j),L===0?Ko.start.copy(Lp):Ko.end.copy(Lp),L++)}if(!q)if(L===2&&Ko.distance()>Kv)if(B!==-1){B=(B+1)%3;let j=0;j===B&&(j=(j+1)%3);let F=j+1;F===B&&(F=(F+1)%3);const se=l.getTriangle();se.a.copy(Z[F]),se.b.copy(Ko.end),se.c.copy(Ko.start),oA(se)||s.push(se),y.a.copy(Z[j]),y.b.copy(Ko.start),y.c.copy(Ko.end),oA(y)&&(s.splice(f,1),f--,g--)}else{const j=Z.findIndex(Se=>W>=2?e.distanceToPoint(Se)<0:e.distanceToPoint(Se)>0);if(j===0){let Se=Ko.start;Ko.start=Ko.end,Ko.end=Se}else if(j===-1)continue;const F=(j+1)%3,se=(j+2)%3,pe=l.getTriangle(),be=l.getTriangle();Z[F].distanceToSquared(Ko.start)<Z[se].distanceToSquared(Ko.end)?(pe.a.copy(Z[F]),pe.b.copy(Ko.start),pe.c.copy(Ko.end),be.a.copy(Z[F]),be.b.copy(Z[se]),be.c.copy(Ko.start)):(pe.a.copy(Z[se]),pe.b.copy(Ko.start),pe.c.copy(Ko.end),be.a.copy(Z[F]),be.b.copy(Z[se]),be.c.copy(Ko.end)),y.a.copy(Z[j]),y.b.copy(Ko.end),y.c.copy(Ko.start),oA(pe)||s.push(pe),oA(be)||s.push(be),oA(y)&&(s.splice(f,1),f--,g--)}else L===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function uC(){return typeof SharedArrayBuffer<"u"}function vD(a){if(a.buffer instanceof SharedArrayBuffer)return a;const e=a.constructor,t=a.buffer,n=new SharedArrayBuffer(t.byteLength),s=new Uint8Array(t);return new Uint8Array(n).set(s,0),new e(n)}class hC{constructor(e,t=500){const n=uC()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new n(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:n,expansionFactor:s}=this;e===null&&(e=~~(n.length*s));const l=new t(e);l.set(n,0),this.array=l}push(...e){let{array:t,length:n}=this;n+e.length>t.length&&(this.expand(),t=this.array);for(let s=0,l=e.length;s<l;s++)t[n+s]=e[s];this.length+=e.length}clear(){this.length=0}}class yD{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:n}=this;let s=0;for(let l=0;l<t;l++)s+=n[l][e].length;return s}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const n=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const s={};t.push(s);for(const l in n)s[l]=new hC(n[l].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:n}=this;if(!n[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:n}=this,s=n[0][e];if(s){if(s.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let l=0,c=n.length;l<c;l++)n[l][e]=new hC(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(t=>{for(const n in t)t[n].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[]}}class AD{constructor(e){this.triangle=new i.CJI().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new i.CJI().copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const n in t)e.push(t[n]);return e}}class dC{constructor(){this.data={}}addTriangleIntersection(e,t,n,s){const{data:l}=this;l[e]||(l[e]=new AD(t)),l[e].addTriangle(n,s)}getTrianglesAsArray(e=null){const{data:t}=this,n=[];if(e!==null)e in t&&n.push(t[e].triangle);else for(const s in t)n.push(t[s].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(n=>parseInt(n)):[]}getIntersectionsAsArray(e=null,t=null){const{data:n}=this,s=new Set,l=[],c=f=>{if(n[f])if(t!==null)n[f].intersects[t]&&l.push(n[f].intersects[t]);else{const g=n[f].intersects;for(const y in g)s.has(y)||(s.add(y),l.push(g[y]))}};if(e!==null)c(e);else for(const f in n)c(f);return l}reset(){this.data={}}}class bD{constructor(){this.enabled=!1,this.triangleIntersectsA=new dC,this.triangleIntersectsB=new dC,this.intersectionEdges=[]}addIntersectingTriangles(e,t,n,s){const{triangleIntersectsA:l,triangleIntersectsB:c}=this;l.addTriangleIntersection(e,t,n,s),c.addTriangleIntersection(n,s,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class pC{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:n,ids:s}=this;n[e]||(n[e]=[],s.push(e)),n[e].push(t)}}const am=new i.zHn,fC=new i.yGw,ql=new i.CJI,Bp=new i.Pa4,mC=new i.Ltg,gC=new i.Ltg,_C=new i.Ltg,Q1=new i.Ltg,ew=new i.Ltg,tw=new i.Ltg,X1=new i.Zzh,q1=new i.Pa4,Y1=1e-8,xD=1e-15,nw=-1,iw=1,vC=-2,K1=2,rw=0,sw=1,$1=2;let ow=null;function yC(a){ow=a}function AC(a,e){function t(){return Math.random()-.5}a.getNormal(q1),am.direction.copy(q1),a.getMidpoint(am.origin);let n=0,s=1/0;for(let l=0;l<3;l++){am.direction.x+=t()*Y1,am.direction.y+=t()*Y1,am.direction.z+=t()*Y1,am.direction.multiplyScalar(-1);const c=e.raycastFirst(am,i.ehD);if(c&&am.direction.dot(c.face.normal)>0&&n++,c!==null&&(s=Math.min(s,c.distance)),s<=xD)return c.face.normal.dot(q1)>0?K1:vC;if(n/3>.5||(l-n+1)/3>.5)break}return n/3>.5?nw:iw}function wD(a,e,t,n,s,l,c=!1){const f=t.attributes,g=t.index,y=3*a,x=g.getX(y+0),S=g.getX(y+1),C=g.getX(y+2);for(const L in l){const B=f[L],W=l[L];if(!(L in f))throw new Error(`CSG Operations: Attribute ${L} not available on geometry.`);const q=B.itemSize;L==="position"?(ql.a.fromBufferAttribute(B,x).applyMatrix4(n),ql.b.fromBufferAttribute(B,S).applyMatrix4(n),ql.c.fromBufferAttribute(B,C).applyMatrix4(n),J1(ql.a,ql.b,ql.c,e,3,W,c)):L==="normal"?(ql.a.fromBufferAttribute(B,x).applyNormalMatrix(s),ql.b.fromBufferAttribute(B,S).applyNormalMatrix(s),ql.c.fromBufferAttribute(B,C).applyNormalMatrix(s),c&&(ql.a.multiplyScalar(-1),ql.b.multiplyScalar(-1),ql.c.multiplyScalar(-1)),J1(ql.a,ql.b,ql.c,e,3,W,c,!0)):(mC.fromBufferAttribute(B,x),gC.fromBufferAttribute(B,S),_C.fromBufferAttribute(B,C),J1(mC,gC,_C,e,q,W,c))}}function ED(a,e,t,n,s,l,c,f=!1){Z1(a,n,s,l,c,f),Z1(f?t:e,n,s,l,c,f),Z1(f?e:t,n,s,l,c,f)}function bC(a,e,t=!1){switch(a){case sC:if(e===iw||e===K1&&!t)return sw;break;case oC:if(t){if(e===nw)return rw}else if(e===iw||e===vC)return sw;break;case aC:if(e===nw)return rw;if(e===iw)return sw;break;case lC:if(e===nw||e===K1&&!t)return sw;break;default:throw new Error(`Unrecognized CSG operation enum "${a}".`)}return $1}function J1(a,e,t,n,s,l,c=!1,f=!1){const g=y=>{l.push(y.x),s>1&&l.push(y.y),s>2&&l.push(y.z),s>3&&l.push(y.w)};Q1.set(0,0,0,0).addScaledVector(a,n.a.x).addScaledVector(e,n.a.y).addScaledVector(t,n.a.z),ew.set(0,0,0,0).addScaledVector(a,n.b.x).addScaledVector(e,n.b.y).addScaledVector(t,n.b.z),tw.set(0,0,0,0).addScaledVector(a,n.c.x).addScaledVector(e,n.c.y).addScaledVector(t,n.c.z),f&&(Q1.normalize(),ew.normalize(),tw.normalize()),g(Q1),c?(g(tw),g(ew)):(g(ew),g(tw))}function Z1(a,e,t,n,s,l=!1){for(const c in s){const f=e[c],g=s[c];if(!(c in e))throw new Error(`CSG Operations: Attribute ${c} no available on geometry.`);const y=f.itemSize;c==="position"?(Bp.fromBufferAttribute(f,a).applyMatrix4(t),g.push(Bp.x,Bp.y,Bp.z)):c==="normal"?(Bp.fromBufferAttribute(f,a).applyNormalMatrix(n),l&&Bp.multiplyScalar(-1),g.push(Bp.x,Bp.y,Bp.z)):(g.push(f.getX(a)),y>1&&g.push(f.getY(a)),y>2&&g.push(f.getZ(a)),y>3&&g.push(f.getW(a)))}}const lm=new i.yGw,aw=new i.Vkp,e_=new i.CJI,lw=new i.CJI,cw=new i.CJI,uw=new i.CJI;function SD(a){for(const e of a)return e}function xC(a,e,t,n,s,l,c,f=0){const g=a.matrixWorld.determinant()<0;lm.copy(e.matrixWorld).invert().multiply(a.matrixWorld),aw.getNormalMatrix(a.matrixWorld).multiplyScalar(g?-1:1);const y=a.geometry.groupIndices,x=a.geometry.index,S=a.geometry.attributes.position,C=e.geometry.boundsTree,L=e.geometry.index,B=e.geometry.attributes.position,W=t.ids,q=t.intersectionSet;for(let Z=0,j=W.length;Z<j;Z++){const F=W[Z],se=f===-1?0:y[F]+f,pe=c.getGroupSet(se),be=3*F,Se=x.getX(be+0),Be=x.getX(be+1),Ge=x.getX(be+2);e_.a.fromBufferAttribute(S,Se).applyMatrix4(lm),e_.b.fromBufferAttribute(S,Be).applyMatrix4(lm),e_.c.fromBufferAttribute(S,Ge).applyMatrix4(lm),l.initialize(e_);const Xe=q[F];for(let at=0,Ke=Xe.length;at<Ke;at++){const Je=3*Xe[at],ft=L.getX(Je+0),mt=L.getX(Je+1),vt=L.getX(Je+2);lw.a.fromBufferAttribute(B,ft),lw.b.fromBufferAttribute(B,mt),lw.c.fromBufferAttribute(B,vt),l.splitByTriangle(lw)}const Qe=l.triangles;for(let at=0,Ke=Qe.length;at<Ke;at++){const Je=Qe[at],ft=bC(n,AC(Je,C),s);if(ft!==$1){e_.getBarycoord(Je.a,uw.a),e_.getBarycoord(Je.b,uw.b),e_.getBarycoord(Je.c,uw.c);const mt=ft===rw;wD(F,uw,a.geometry,a.matrixWorld,aw,pe,g!==mt)}}}return W.length}function wC(a,e,t,n,s,l,c=0){const f=a.matrixWorld.determinant()<0;lm.copy(e.matrixWorld).invert().multiply(a.matrixWorld),aw.getNormalMatrix(a.matrixWorld).multiplyScalar(f?-1:1);const g=e.geometry.boundsTree,y=a.geometry.groupIndices,x=a.geometry.index,S=a.geometry.attributes,C=S.position,L=[],B=a.geometry.halfEdges,W=new Set;for(let q=0,Z=x.count/3;q<Z;q++)q in t.intersectionSet||W.add(q);for(;W.size>0;){const q=SD(W);W.delete(q),L.push(q);const Z=3*q,j=x.getX(Z+0),F=x.getX(Z+1),se=x.getX(Z+2);cw.a.fromBufferAttribute(C,j).applyMatrix4(lm),cw.b.fromBufferAttribute(C,F).applyMatrix4(lm),cw.c.fromBufferAttribute(C,se).applyMatrix4(lm);const pe=bC(n,AC(cw,g),s);for(;L.length>0;){const be=L.pop(),Se=c===-1?0:y[be]+c,Be=l.getGroupSet(Se);for(let Je=0;Je<3;Je++){const ft=B.getSiblingTriangleIndex(be,Je);ft!==-1&&W.has(ft)&&(L.push(ft),W.delete(ft))}if(pe===$1)continue;const Ge=3*be,Xe=x.getX(Ge+0),Qe=x.getX(Ge+1),at=x.getX(Ge+2),Ke=pe===rw;ED(Xe,Qe,at,S,a.matrixWorld,aw,Be,Ke!==f)}}}const EC=0,TD=1,MD=2,eS=1.25,SC=1,tS=65535,CD=Math.pow(2,-24);class hw{constructor(){}}function dd(a,e,t){return t.min.x=e[a],t.min.y=e[a+1],t.min.z=e[a+2],t.max.x=e[a+3],t.max.y=e[a+4],t.max.z=e[a+5],t}function TC(a){let e=-1,t=-1/0;for(let n=0;n<3;n++){const s=a[n+3]-a[n];s>t&&(t=s,e=n)}return e}function MC(a,e){e.set(a)}function CC(a,e,t){let n,s;for(let l=0;l<3;l++){const c=l+3;n=a[l],s=e[l],t[l]=n<s?n:s,n=a[c],s=e[c],t[c]=n>s?n:s}}function dw(a,e,t){for(let n=0;n<3;n++){const s=e[a+2*n],l=e[a+2*n+1],c=s-l,f=s+l;c<t[n]&&(t[n]=c),f>t[n+3]&&(t[n+3]=f)}}function aA(a){const e=a[3]-a[0],t=a[4]-a[1],n=a[5]-a[2];return 2*(e*t+t*n+n*e)}function nS(a,e,t,n,s=null){let l=1/0,c=1/0,f=1/0,g=-1/0,y=-1/0,x=-1/0,S=1/0,C=1/0,L=1/0,B=-1/0,W=-1/0,q=-1/0;const Z=s!==null;for(let j=6*e,F=6*(e+t);j<F;j+=6){const se=a[j+0],pe=a[j+1],be=se-pe,Se=se+pe;be<l&&(l=be),Se>g&&(g=Se),Z&&se<S&&(S=se),Z&&se>B&&(B=se);const Be=a[j+2],Ge=a[j+3],Xe=Be-Ge,Qe=Be+Ge;Xe<c&&(c=Xe),Qe>y&&(y=Qe),Z&&Be<C&&(C=Be),Z&&Be>W&&(W=Be);const at=a[j+4],Ke=a[j+5],Je=at-Ke,ft=at+Ke;Je<f&&(f=Je),ft>x&&(x=ft),Z&&at<L&&(L=at),Z&&at>q&&(q=at)}n[0]=l,n[1]=c,n[2]=f,n[3]=g,n[4]=y,n[5]=x,Z&&(s[0]=S,s[1]=C,s[2]=L,s[3]=B,s[4]=W,s[5]=q)}const Op=32,RD=(a,e)=>a.candidate-e.candidate,cm=new Array(Op).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),pw=new Float32Array(6);class pd{constructor(e,t,n){this.isOrientedBox=!0,this.min=new i.Pa4,this.max=new i.Pa4,this.matrix=new i.yGw,this.invMatrix=new i.yGw,this.points=new Array(8).fill().map(()=>new i.Pa4),this.satAxes=new Array(3).fill().map(()=>new i.Pa4),this.satBounds=new Array(3).fill().map(()=>new Pp),this.alignedSatBounds=new Array(3).fill().map(()=>new Pp),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}pd.prototype.update=function(){const a=this.matrix,e=this.min,t=this.max,n=this.points;for(let g=0;g<=1;g++)for(let y=0;y<=1;y++)for(let x=0;x<=1;x++){const S=n[1*g|2*y|4*x];S.x=g?t.x:e.x,S.y=y?t.y:e.y,S.z=x?t.z:e.z,S.applyMatrix4(a)}const s=this.satBounds,l=this.satAxes,c=n[0];for(let g=0;g<3;g++){const y=l[g],x=s[g],S=n[1<<g];y.subVectors(c,S),x.setFromPoints(y,n)}const f=this.alignedSatBounds;f[0].setFromPointsField(n,"x"),f[1].setFromPointsField(n,"y"),f[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},pd.prototype.intersectsBox=function(){const a=new Pp;return function(e){this.needsUpdate&&this.update();const t=e.min,n=e.max,s=this.satBounds,l=this.satAxes,c=this.alignedSatBounds;if(a.min=t.x,a.max=n.x,c[0].isSeparated(a)||(a.min=t.y,a.max=n.y,c[1].isSeparated(a))||(a.min=t.z,a.max=n.z,c[2].isSeparated(a)))return!1;for(let f=0;f<3;f++){const g=l[f],y=s[f];if(a.setFromBox(g,e),y.isSeparated(a))return!1}return!0}}(),pd.prototype.intersectsTriangle=function(){const a=new hd,e=new Array(3),t=new Pp,n=new Pp,s=new i.Pa4;return function(l){this.needsUpdate&&this.update(),l.isExtendedTriangle?l.needsUpdate&&l.update():(a.copy(l),a.update(),l=a);const c=this.satBounds,f=this.satAxes;e[0]=l.a,e[1]=l.b,e[2]=l.c;for(let S=0;S<3;S++){const C=c[S],L=f[S];if(t.setFromPoints(L,e),C.isSeparated(t))return!1}const g=l.satBounds,y=l.satAxes,x=this.points;for(let S=0;S<3;S++){const C=g[S],L=y[S];if(t.setFromPoints(L,x),C.isSeparated(t))return!1}for(let S=0;S<3;S++){const C=f[S];for(let L=0;L<4;L++){const B=y[L];if(s.crossVectors(C,B),t.setFromPoints(s,e),n.setFromPoints(s,x),t.isSeparated(n))return!1}}return!0}}(),pd.prototype.closestPointToPoint=function(a,e){return this.needsUpdate&&this.update(),e.copy(a).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},pd.prototype.distanceToPoint=function(){const a=new i.Pa4;return function(e){return this.closestPointToPoint(e,a),e.distanceTo(a)}}(),pd.prototype.distanceToBox=function(){const a=["x","y","z"],e=new Array(12).fill().map(()=>new i.Zzh),t=new Array(12).fill().map(()=>new i.Zzh),n=new i.Pa4,s=new i.Pa4;return function(l,c=0,f=null,g=null){if(this.needsUpdate&&this.update(),this.intersectsBox(l))return(f||g)&&(l.getCenter(s),this.closestPointToPoint(s,n),l.closestPointToPoint(n,s),f&&f.copy(n),g&&g.copy(s)),0;const y=c*c,x=l.min,S=l.max,C=this.points;let L=1/0;for(let W=0;W<8;W++){const q=C[W];s.copy(q).clamp(x,S);const Z=q.distanceToSquared(s);if(Z<L&&(L=Z,f&&f.copy(q),g&&g.copy(s),Z<y))return Math.sqrt(Z)}let B=0;for(let W=0;W<3;W++)for(let q=0;q<=1;q++)for(let Z=0;Z<=1;Z++){const j=(W+1)%3,F=(W+2)%3,se=1<<W|q<<j|Z<<F,pe=C[q<<j|Z<<F],be=C[se];e[B].set(pe,be);const Se=a[W],Be=a[j],Ge=a[F],Xe=t[B],Qe=Xe.start,at=Xe.end;Qe[Se]=x[Se],Qe[Be]=q?x[Be]:S[Be],Qe[Ge]=Z?x[Ge]:S[Be],at[Se]=S[Se],at[Be]=q?x[Be]:S[Be],at[Ge]=Z?x[Ge]:S[Be],B++}for(let W=0;W<=1;W++)for(let q=0;q<=1;q++)for(let Z=0;Z<=1;Z++){s.x=W?S.x:x.x,s.y=q?S.y:x.y,s.z=Z?S.z:x.z,this.closestPointToPoint(s,n);const j=s.distanceToSquared(n);if(j<L&&(L=j,f&&f.copy(n),g&&g.copy(s),j<y))return Math.sqrt(j)}for(let W=0;W<12;W++){const q=e[W];for(let Z=0;Z<12;Z++){const j=t[Z];W1(q,j,n,s);const F=n.distanceToSquared(s);if(F<L&&(L=F,f&&f.copy(n),g&&g.copy(s),F<y))return Math.sqrt(F)}}return Math.sqrt(L)}}();const fw=new i.Pa4,mw=new i.Pa4,gw=new i.Pa4,RC=new i.FM8,IC=new i.FM8,PC=new i.FM8,DC=new i.Pa4;function LC(a,e,t,n,s){const l=3*n,c=a.index.getX(l),f=a.index.getX(l+1),g=a.index.getX(l+2),y=function(x,S,C,L,B,W,q){fw.fromBufferAttribute(S,L),mw.fromBufferAttribute(S,B),gw.fromBufferAttribute(S,W);const Z=function(j,F,se,pe,be,Se){let Be;return Be=Se===i._Li?j.intersectTriangle(pe,se,F,!0,be):j.intersectTriangle(F,se,pe,Se!==i.ehD,be),Be===null?null:{distance:j.origin.distanceTo(be),point:be.clone()}}(x,fw,mw,gw,DC,q);if(Z){C&&(RC.fromBufferAttribute(C,L),IC.fromBufferAttribute(C,B),PC.fromBufferAttribute(C,W),Z.uv=i.CJI.getUV(DC,fw,mw,gw,RC,IC,PC,new i.FM8));const j={a:L,b:B,c:W,normal:new i.Pa4,materialIndex:0};i.CJI.getNormal(fw,mw,gw,j.normal),Z.face=j,Z.faceIndex=L}return Z}(t,a.attributes.position,a.attributes.uv,c,f,g,e);return y?(y.faceIndex=n,s&&s.push(y),y):null}function fd(a,e,t,n){const s=a.a,l=a.b,c=a.c;let f=e,g=e+1,y=e+2;t&&(f=t.getX(e),g=t.getX(e+1),y=t.getX(e+2)),s.x=n.getX(f),s.y=n.getY(f),s.z=n.getZ(f),l.x=n.getX(g),l.y=n.getY(g),l.z=n.getZ(g),c.x=n.getX(y),c.y=n.getY(y),c.z=n.getZ(y)}function BC(a,e,t,n,s,l,c){const f=t.index,g=t.attributes.position;for(let y=a,x=e+a;y<x;y++)if(fd(c,3*y,f,g),c.needsUpdate=!0,n(c,y,s,l))return!0;return!1}class OC{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function um(a,e){return e[a+15]===65535}function $v(a,e){return e[a+6]}function lA(a,e){return e[a+14]}function cA(a){return a+8}function uA(a,e){return e[a+6]}const Jv=new i.ZzF,_w=new i.Pa4,ID=["x","y","z"];function iS(a,e,t,n,s){let l=2*a,c=Zv,f=hm,g=dm;if(um(l,f))(function(y,x,S,C,L,B){for(let W=C,q=C+L;W<q;W++)LC(y,x,S,W,B)})(e,t,n,$v(a,g),lA(l,f),s);else{const y=cA(a);vw(y,c,n,_w)&&iS(y,e,t,n,s);const x=uA(a,g);vw(x,c,n,_w)&&iS(x,e,t,n,s)}}function rS(a,e,t,n){let s=2*a,l=Zv,c=hm,f=dm;if(um(s,c))return function(g,y,x,S,C){let L=1/0,B=null;for(let W=S,q=S+C;W<q;W++){const Z=LC(g,y,x,W);Z&&Z.distance<L&&(B=Z,L=Z.distance)}return B}(e,t,n,$v(a,f),lA(s,c));{const g=function(W,q){return q[W+7]}(a,f),y=ID[g],x=n.direction[y]>=0;let S,C;x?(S=cA(a),C=uA(a,f)):(S=uA(a,f),C=cA(a));const L=vw(S,l,n,_w)?rS(S,e,t,n):null;if(L){const W=L.point[y];if(x?W<=l[C+g]:W>=l[C+g+3])return L}const B=vw(C,l,n,_w)?rS(C,e,t,n):null;return L&&B?L.distance<=B.distance?L:B:L||B||null}}const PD=function(){let a,e;const t=[],n=new OC(()=>new i.ZzF);return function(...l){a=n.getPrimitive(),e=n.getPrimitive(),t.push(a,e);const c=s(...l);n.releasePrimitive(a),n.releasePrimitive(e),t.pop(),t.pop();const f=t.length;return f>0&&(e=t[f-1],a=t[f-2]),c};function s(l,c,f,g,y=null,x=0,S=0){function C(j){let F=2*j,se=hm,pe=dm;for(;!um(F,se);)F=2*(j=cA(j));return $v(j,pe)}function L(j){let F=2*j,se=hm,pe=dm;for(;!um(F,se);)F=2*(j=uA(j,pe));return $v(j,pe)+lA(F,se)}let B=2*l,W=Zv,q=hm,Z=dm;if(um(B,q)){const j=$v(l,Z),F=lA(B,q);return dd(l,W,a),g(j,F,!1,S,x+l,a)}{const j=cA(l),F=uA(l,Z);let se,pe,be,Se,Be=j,Ge=F;if(y&&(be=a,Se=e,dd(Be,W,be),dd(Ge,W,Se),se=y(be),pe=y(Se),pe<se)){Be=F,Ge=j;const Je=se;se=pe,pe=Je,be=Se}be||(be=a,dd(Be,W,be));const Xe=f(be,um(2*Be,q),se,S+1,x+Be);let Qe;if(Xe===2){const Je=C(Be);Qe=g(Je,L(Be)-Je,!0,S+1,x+Be,be)}else Qe=Xe&&s(Be,c,f,g,y,x,S+1);if(Qe)return!0;Se=e,dd(Ge,W,Se);const at=f(Se,um(2*Ge,q),pe,S+1,x+Ge);let Ke;if(at===2){const Je=C(Ge);Ke=g(Je,L(Ge)-Je,!0,S+1,x+Ge,Se)}else Ke=at&&s(Ge,c,f,g,y,x,S+1);return!!Ke}}}(),DD=function(){const a=new hd,e=new hd,t=new i.yGw,n=new pd,s=new pd;return function l(c,f,g,y,x=null){let S=2*c,C=Zv,L=hm,B=dm;if(x===null&&(g.boundingBox||g.computeBoundingBox(),n.set(g.boundingBox.min,g.boundingBox.max,y),x=n),!um(S,L)){const W=c+8,q=B[c+6];return dd(W,C,Jv),x.intersectsBox(Jv)&&l(W,f,g,y,x)?!0:(dd(q,C,Jv),!(!x.intersectsBox(Jv)||!l(q,f,g,y,x)))}{const W=f,q=W.index,Z=W.attributes.position,j=g.index,F=g.attributes.position,se=$v(c,B),pe=lA(S,L);if(t.copy(y).invert(),g.boundsTree)return dd(c,C,s),s.matrix.copy(t),s.needsUpdate=!0,g.boundsTree.shapecast({intersectsBounds:Se=>s.intersectsBox(Se),intersectsTriangle:Se=>{Se.a.applyMatrix4(y),Se.b.applyMatrix4(y),Se.c.applyMatrix4(y),Se.needsUpdate=!0;for(let Be=3*se,Ge=3*(pe+se);Be<Ge;Be+=3)if(fd(e,Be,q,Z),e.needsUpdate=!0,Se.intersectsTriangle(e))return!0;return!1}});for(let be=3*se,Se=pe+3*se;be<Se;be+=3){fd(a,be,q,Z),a.a.applyMatrix4(t),a.b.applyMatrix4(t),a.c.applyMatrix4(t),a.needsUpdate=!0;for(let Be=0,Ge=j.count;Be<Ge;Be+=3)if(fd(e,Be,j,F),e.needsUpdate=!0,a.intersectsTriangle(e))return!0}}}}();function vw(a,e,t,n){return dd(a,e,Jv),t.intersectBox(Jv,n)}const sS=[];let yw,Zv,hm,dm;function hA(a){yw&&sS.push(yw),yw=a,Zv=new Float32Array(a),hm=new Uint16Array(a),dm=new Uint32Array(a)}function Aw(){yw=null,Zv=null,hm=null,dm=null,sS.length&&hA(sS.pop())}const oS=Symbol("skip tree generation"),aS=new i.ZzF,lS=new i.ZzF,e0=new i.yGw,t_=new pd,dA=new pd,pA=new i.Pa4,bw=new i.Pa4,LD=new i.Pa4,BD=new i.Pa4,OD=new i.Pa4,NC=new i.ZzF,md=new OC(()=>new hd);class fA{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),fA.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,s=e._roots,l=n.getIndex();let c;return c=t.cloneBuffers?{roots:s.map(f=>f.slice()),index:l.array.slice()}:{roots:s,index:l.array},c}static deserialize(e,t,n={}){if(typeof n=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),fA.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});n={setIndex:!0,...n};const{index:s,roots:l}=e,c=new fA(t,{...n,[oS]:!0});if(c._roots=l,n.setIndex){const f=t.getIndex();if(f===null){const g=new i.TlE(e.index,1,!1);t.setIndex(g)}else f.array!==s&&(f.array.set(s),f.needsUpdate=!0)}return c}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:EC,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[oS]:!1},t)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[oS]||(this._roots=function(n,s){const l=function(L,B){function W(Je){Ge&&Ge(Je/Xe)}function q(Je,ft,mt,vt=null,Qt=0){if(!Qe&&Qt>=pe&&(Qe=!0,be&&(console.warn(`MeshBVH: Max depth of ${pe} reached when generating BVH. Consider increasing maxDepth.`),console.warn(L))),mt<=Se||Qt>=pe)return W(ft+mt),Je.offset=ft,Je.count=mt,Je;const Ht=function(un,rn,Gn,Fn,di,bi){let Bi=-1,Br=0;if(bi===EC)Bi=TC(rn),Bi!==-1&&(Br=(rn[Bi]+rn[Bi+3])/2);else if(bi===TD)Bi=TC(un),Bi!==-1&&(Br=function(lr,tr,vn,zn){let fi=0;for(let br=tr,Wr=tr+vn;br<Wr;br++)fi+=lr[6*br+2*zn];return fi/vn}(Gn,Fn,di,Bi));else if(bi===MD){const lr=aA(un);let tr=eS*di;const vn=6*Fn,zn=6*(Fn+di);for(let fi=0;fi<3;fi++){const br=rn[fi],Wr=(rn[fi+3]-br)/Op;if(di<Op/4){const Rr=[...cm];Rr.length=di;let xr=0;for(let ji=vn;ji<zn;ji+=6,xr++){const sn=Rr[xr];sn.candidate=Gn[ji+2*fi],sn.count=0;const{bounds:pi,leftCacheBounds:Xi,rightCacheBounds:$n}=sn;for(let pr=0;pr<3;pr++)$n[pr]=1/0,$n[pr+3]=-1/0,Xi[pr]=1/0,Xi[pr+3]=-1/0,pi[pr]=1/0,pi[pr+3]=-1/0;dw(ji,Gn,pi)}Rr.sort(RD);let vr=di;for(let ji=0;ji<vr;ji++){const sn=Rr[ji];for(;ji+1<vr&&Rr[ji+1].candidate===sn.candidate;)Rr.splice(ji+1,1),vr--}for(let ji=vn;ji<zn;ji+=6){const sn=Gn[ji+2*fi];for(let pi=0;pi<vr;pi++){const Xi=Rr[pi];sn>=Xi.candidate?dw(ji,Gn,Xi.rightCacheBounds):(dw(ji,Gn,Xi.leftCacheBounds),Xi.count++)}}for(let ji=0;ji<vr;ji++){const sn=Rr[ji],pi=sn.count,Xi=di-sn.count,$n=sn.leftCacheBounds,pr=sn.rightCacheBounds;let Gs=0;pi!==0&&(Gs=aA($n)/lr);let oo=0;Xi!==0&&(oo=aA(pr)/lr);const Lo=SC+eS*(Gs*pi+oo*Xi);Lo<tr&&(Bi=fi,tr=Lo,Br=sn.candidate)}}else{for(let vr=0;vr<Op;vr++){const ji=cm[vr];ji.count=0,ji.candidate=br+Wr+vr*Wr;const sn=ji.bounds;for(let pi=0;pi<3;pi++)sn[pi]=1/0,sn[pi+3]=-1/0}for(let vr=vn;vr<zn;vr+=6){let ji=~~((Gn[vr+2*fi]-br)/Wr);ji>=Op&&(ji=Op-1);const sn=cm[ji];sn.count++,dw(vr,Gn,sn.bounds)}const Rr=cm[Op-1];MC(Rr.bounds,Rr.rightCacheBounds);for(let vr=Op-2;vr>=0;vr--){const ji=cm[vr],sn=cm[vr+1];CC(ji.bounds,sn.rightCacheBounds,ji.rightCacheBounds)}let xr=0;for(let vr=0;vr<Op-1;vr++){const ji=cm[vr],sn=ji.count,pi=ji.bounds,Xi=cm[vr+1].rightCacheBounds;sn!==0&&(xr===0?MC(pi,pw):CC(pi,pw,pw)),xr+=sn;let $n=0,pr=0;xr!==0&&($n=aA(pw)/lr);const Gs=di-xr;Gs!==0&&(pr=aA(Xi)/lr);const oo=SC+eS*($n*xr+pr*Gs);oo<tr&&(Bi=fi,tr=oo,Br=ji.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${bi} used.`);return{axis:Bi,pos:Br}}(Je.boundingData,vt,F,ft,mt,Be);if(Ht.axis===-1)return W(ft+mt),Je.offset=ft,Je.count=mt,Je;const Cn=function(un,rn,Gn,Fn,di){let bi=Gn,Bi=Gn+Fn-1;const Br=di.pos,lr=2*di.axis;for(;;){for(;bi<=Bi&&rn[6*bi+lr]<Br;)bi++;for(;bi<=Bi&&rn[6*Bi+lr]>=Br;)Bi--;if(!(bi<Bi))return bi;for(let tr=0;tr<3;tr++){let vn=un[3*bi+tr];un[3*bi+tr]=un[3*Bi+tr],un[3*Bi+tr]=vn;let zn=rn[6*bi+2*tr+0];rn[6*bi+2*tr+0]=rn[6*Bi+2*tr+0],rn[6*Bi+2*tr+0]=zn;let fi=rn[6*bi+2*tr+1];rn[6*bi+2*tr+1]=rn[6*Bi+2*tr+1],rn[6*Bi+2*tr+1]=fi}bi++,Bi--}}(se,F,ft,mt,Ht);if(Cn===ft||Cn===ft+mt)W(ft+mt),Je.offset=ft,Je.count=mt;else{Je.splitAxis=Ht.axis;const un=new hw,rn=ft,Gn=Cn-ft;Je.left=un,un.boundingData=new Float32Array(6),nS(F,rn,Gn,un.boundingData,j),q(un,rn,Gn,j,Qt+1);const Fn=new hw,di=Cn,bi=mt-Gn;Je.right=Fn,Fn.boundingData=new Float32Array(6),nS(F,di,bi,Fn.boundingData,j),q(Fn,di,bi,j,Qt+1)}return Je}(function(Je,ft){if(!Je.index){const mt=Je.attributes.position.count,vt=ft.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let Qt;Qt=mt>65535?new Uint32Array(new vt(4*mt)):new Uint16Array(new vt(2*mt)),Je.setIndex(new i.TlE(Qt,1));for(let Ht=0;Ht<mt;Ht++)Qt[Ht]=Ht}})(L,B);const Z=new Float32Array(6),j=new Float32Array(6),F=function(Je,ft){const mt=Je.attributes.position,vt=Je.index.array,Qt=vt.length/3,Ht=new Float32Array(6*Qt),Cn=mt.normalized,un=mt.array,rn=mt.offset||0;let Gn=3;mt.isInterleavedBufferAttribute&&(Gn=mt.data.stride);const Fn=["getX","getY","getZ"];for(let di=0;di<Qt;di++){const bi=3*di,Bi=6*di;let Br,lr,tr;Cn?(Br=vt[bi+0],lr=vt[bi+1],tr=vt[bi+2]):(Br=vt[bi+0]*Gn+rn,lr=vt[bi+1]*Gn+rn,tr=vt[bi+2]*Gn+rn);for(let vn=0;vn<3;vn++){let zn,fi,br;Cn?(zn=mt[Fn[vn]](Br),fi=mt[Fn[vn]](lr),br=mt[Fn[vn]](tr)):(zn=un[Br+vn],fi=un[lr+vn],br=un[tr+vn]);let Wr=zn;fi<Wr&&(Wr=fi),br<Wr&&(Wr=br);let Rr=zn;fi>Rr&&(Rr=fi),br>Rr&&(Rr=br);const xr=(Rr-Wr)/2,vr=2*vn;Ht[Bi+vr+0]=Wr+xr,Ht[Bi+vr+1]=xr+(Math.abs(Wr)+xr)*CD,Wr<ft[vn]&&(ft[vn]=Wr),Rr>ft[vn+3]&&(ft[vn+3]=Rr)}}return Ht}(L,Z),se=L.index.array,pe=B.maxDepth,be=B.verbose,Se=B.maxLeafTris,Be=B.strategy,Ge=B.onProgress,Xe=L.index.count/3;let Qe=!1;const at=[],Ke=function(Je){if(!Je.groups||!Je.groups.length)return[{offset:0,count:Je.index.count/3}];const ft=[],mt=new Set;for(const Qt of Je.groups)mt.add(Qt.start),mt.add(Qt.start+Qt.count);const vt=Array.from(mt.values()).sort((Qt,Ht)=>Qt-Ht);for(let Qt=0;Qt<vt.length-1;Qt++){const Ht=vt[Qt],Cn=vt[Qt+1];ft.push({offset:Ht/3,count:(Cn-Ht)/3})}return ft}(L);if(Ke.length===1){const Je=Ke[0],ft=new hw;ft.boundingData=Z,function(mt,vt,Qt,Ht){let Cn=1/0,un=1/0,rn=1/0,Gn=-1/0,Fn=-1/0,di=-1/0;for(let bi=6*vt,Bi=6*(vt+Qt);bi<Bi;bi+=6){const Br=mt[bi+0];Br<Cn&&(Cn=Br),Br>Gn&&(Gn=Br);const lr=mt[bi+2];lr<un&&(un=lr),lr>Fn&&(Fn=lr);const tr=mt[bi+4];tr<rn&&(rn=tr),tr>di&&(di=tr)}Ht[0]=Cn,Ht[1]=un,Ht[2]=rn,Ht[3]=Gn,Ht[4]=Fn,Ht[5]=di}(F,Je.offset,Je.count,j),q(ft,Je.offset,Je.count,j),at.push(ft)}else for(let Je of Ke){const ft=new hw;ft.boundingData=new Float32Array(6),nS(F,Je.offset,Je.count,ft.boundingData,j),q(ft,Je.offset,Je.count,j),at.push(ft)}return at}(n,s);let c,f,g;const y=[],x=s.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let L=0;L<l.length;L++){const B=l[L],W=new x(32*S(B));c=new Float32Array(W),f=new Uint32Array(W),g=new Uint16Array(W),C(0,B),y.push(W)}return y;function S(L){return L.count?1:1+S(L.left)+S(L.right)}function C(L,B){const W=L/4,q=L/2,Z=!!B.count,j=B.boundingData;for(let F=0;F<6;F++)c[W+F]=j[F];if(Z){const F=B.offset,se=B.count;return f[W+6]=F,g[q+14]=se,g[q+15]=tS,L+32}{const F=B.left,se=B.right,pe=B.splitAxis;let be;if(be=C(L+32,F),be/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return f[W+6]=be/4,be=C(be,se),f[W+7]=pe,be}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new i.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,s=t.attributes.position;let l,c,f,g,y=0;const x=this._roots;for(let C=0,L=x.length;C<L;C++)l=x[C],c=new Uint32Array(l),f=new Uint16Array(l),g=new Float32Array(l),S(0,y),y+=l.byteLength;function S(C,L,B=!1){const W=2*C;if(f[W+15]===tS){const q=c[C+6];let Z=1/0,j=1/0,F=1/0,se=-1/0,pe=-1/0,be=-1/0;for(let Se=3*q,Be=3*(q+f[W+14]);Se<Be;Se++){const Ge=n[Se],Xe=s.getX(Ge),Qe=s.getY(Ge),at=s.getZ(Ge);Xe<Z&&(Z=Xe),Xe>se&&(se=Xe),Qe<j&&(j=Qe),Qe>pe&&(pe=Qe),at<F&&(F=at),at>be&&(be=at)}return(g[C+0]!==Z||g[C+1]!==j||g[C+2]!==F||g[C+3]!==se||g[C+4]!==pe||g[C+5]!==be)&&(g[C+0]=Z,g[C+1]=j,g[C+2]=F,g[C+3]=se,g[C+4]=pe,g[C+5]=be,!0)}{const q=C+8,Z=c[C+6],j=q+L,F=Z+L;let se=B,pe=!1,be=!1;e?se||(pe=e.has(j),be=e.has(F),se=!pe&&!be):(pe=!0,be=!0);const Se=se||be;let Be=!1;(se||pe)&&(Be=S(q,L,se));let Ge=!1;Se&&(Ge=S(Z,L,se));const Xe=Be||Ge;if(Xe)for(let Qe=0;Qe<3;Qe++){const at=q+Qe,Ke=Z+Qe,Je=g[at],ft=g[at+3],mt=g[Ke],vt=g[Ke+3];g[C+Qe]=Je<mt?Je:mt,g[C+Qe+3]=ft>vt?ft:vt}return Xe}}}traverse(e,t=0){const n=this._roots[t],s=new Uint32Array(n),l=new Uint16Array(n);(function c(f,g=0){const y=2*f,x=l[y+15]===tS;if(x){const S=s[f+6],C=l[y+14];e(g,x,new Float32Array(n,4*f,6),S,C)}else{const S=f+8,C=s[f+6],L=s[f+7];e(g,x,new Float32Array(n,4*f,6),L)||(c(S,g+1),c(C,g+1))}})(0)}raycast(e,t=i.Wl3){const n=this._roots,s=this.geometry,l=[],c=t.isMaterial,f=Array.isArray(t),g=s.groups,y=c?t.side:t;for(let x=0,S=n.length;x<S;x++){const C=f?t[g[x].materialIndex].side:y,L=l.length;if(hA(n[x]),iS(0,s,C,e,l),Aw(),f){const B=g[x].materialIndex;for(let W=L,q=l.length;W<q;W++)l[W].face.materialIndex=B}}return l}raycastFirst(e,t=i.Wl3){const n=this._roots,s=this.geometry,l=t.isMaterial,c=Array.isArray(t);let f=null;const g=s.groups,y=l?t.side:t;for(let x=0,S=n.length;x<S;x++){const C=c?t[g[x].materialIndex].side:y;hA(n[x]);const L=rS(0,s,C,e);Aw(),L!=null&&(f==null||L.distance<f.distance)&&(f=L,c&&(L.face.materialIndex=g[x].materialIndex))}return f}intersectsGeometry(e,t){const n=this.geometry;let s=!1;for(const l of this._roots)if(hA(l),s=DD(0,n,e,t),Aw(),s)break;return s}shapecast(e,t,n){const s=this.geometry;if(e instanceof Function){if(t){const C=t;t=(L,B,W,q)=>{const Z=3*B;return C(L,Z,Z+1,Z+2,W,q)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const l=md.getPrimitive();let{boundsTraverseOrder:c,intersectsBounds:f,intersectsRange:g,intersectsTriangle:y}=e;if(g&&y){const C=g;g=(L,B,W,q,Z)=>!!C(L,B,W,q,Z)||BC(L,B,s,y,W,q,l)}else g||(g=y?(C,L,B,W)=>BC(C,L,s,y,B,W,l):(C,L,B)=>B);let x=!1,S=0;for(const C of this._roots){if(hA(C),x=PD(0,s,f,g,c,S),Aw(),x)break;S+=C.byteLength}return md.releasePrimitive(l),x}bvhcast(e,t,n){let{intersectsRanges:s,intersectsTriangles:l}=n;const c=this.geometry.index,f=this.geometry.attributes.position,g=e.geometry.index,y=e.geometry.attributes.position;e0.copy(t).invert();const x=md.getPrimitive(),S=md.getPrimitive();if(l){let L=function(B,W,q,Z,j,F,se,pe){for(let be=q,Se=q+Z;be<Se;be++){fd(S,3*be,g,y),S.a.applyMatrix4(t),S.b.applyMatrix4(t),S.c.applyMatrix4(t),S.needsUpdate=!0;for(let Be=B,Ge=B+W;Be<Ge;Be++)if(fd(x,3*Be,c,f),x.needsUpdate=!0,l(x,S,Be,be,j,F,se,pe))return!0}return!1};if(s){const B=s;s=function(W,q,Z,j,F,se,pe,be){return!!B(W,q,Z,j,F,se,pe,be)||L(W,q,Z,j,F,se,pe,be)}}else s=L}e.getBoundingBox(lS),lS.applyMatrix4(t);const C=this.shapecast({intersectsBounds:L=>lS.intersectsBox(L),intersectsRange:(L,B,W,q,Z,j)=>(aS.copy(j),aS.applyMatrix4(e0),e.shapecast({intersectsBounds:F=>aS.intersectsBox(F),intersectsRange:(F,se,pe,be,Se)=>s(L,B,F,se,q,Z,be,Se)}))});return md.releasePrimitive(x),md.releasePrimitive(S),C}intersectsBox(e,t){return t_.set(e.min,e.max,t),t_.needsUpdate=!0,this.shapecast({intersectsBounds:n=>t_.intersectsBox(n),intersectsTriangle:n=>t_.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},s={},l=0,c=1/0){e.boundingBox||e.computeBoundingBox(),t_.set(e.boundingBox.min,e.boundingBox.max,t),t_.needsUpdate=!0;const f=this.geometry,g=f.attributes.position,y=f.index,x=e.attributes.position,S=e.index,C=md.getPrimitive(),L=md.getPrimitive();let B=bw,W=LD,q=null,Z=null;s&&(q=BD,Z=OD);let j=1/0,F=null,se=null;return e0.copy(t).invert(),dA.matrix.copy(e0),this.shapecast({boundsTraverseOrder:pe=>t_.distanceToBox(pe),intersectsBounds:(pe,be,Se)=>Se<j&&Se<c&&(be&&(dA.min.copy(pe.min),dA.max.copy(pe.max),dA.needsUpdate=!0),!0),intersectsRange:(pe,be)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Se=>dA.distanceToBox(Se),intersectsBounds:(Se,Be,Ge)=>Ge<j&&Ge<c,intersectsRange:(Se,Be)=>{for(let Ge=3*Se,Xe=3*(Se+Be);Ge<Xe;Ge+=3){fd(L,Ge,S,x),L.a.applyMatrix4(t),L.b.applyMatrix4(t),L.c.applyMatrix4(t),L.needsUpdate=!0;for(let Qe=3*pe,at=3*(pe+be);Qe<at;Qe+=3){fd(C,Qe,y,g),C.needsUpdate=!0;const Ke=C.distanceToTriangle(L,B,q);if(Ke<j&&(W.copy(B),Z&&Z.copy(q),j=Ke,F=Qe/3,se=Ge/3),Ke<l)return!0}}}});for(let Se=0,Be=S?S.count:x.count;Se<Be;Se+=3){fd(L,Se,S,x),L.a.applyMatrix4(t),L.b.applyMatrix4(t),L.c.applyMatrix4(t),L.needsUpdate=!0;for(let Ge=3*pe,Xe=3*(pe+be);Ge<Xe;Ge+=3){fd(C,Ge,y,g),C.needsUpdate=!0;const Qe=C.distanceToTriangle(L,B,q);if(Qe<j&&(W.copy(B),Z&&Z.copy(q),j=Qe,F=Ge/3,se=Se/3),Qe<l)return!0}}}}),md.releasePrimitive(C),md.releasePrimitive(L),j===1/0?null:(n.point?n.point.copy(W):n.point=W.clone(),n.distance=j,n.faceIndex=F,s&&(s.point?s.point.copy(Z):s.point=Z.clone(),s.point.applyMatrix4(e0),W.applyMatrix4(e0),s.distance=W.sub(s.point).length(),s.faceIndex=se),n)}closestPointToPoint(e,t={},n=0,s=1/0){const l=n*n,c=s*s;let f=1/0,g=null;if(this.shapecast({boundsTraverseOrder:x=>(pA.copy(e).clamp(x.min,x.max),pA.distanceToSquared(e)),intersectsBounds:(x,S,C)=>C<f&&C<c,intersectsTriangle:(x,S)=>{x.closestPointToPoint(e,pA);const C=e.distanceToSquared(pA);return C<f&&(bw.copy(pA),f=C,g=S),C<l}}),f===1/0)return null;const y=Math.sqrt(f);return t.point?t.point.copy(bw):t.point=bw.clone(),t.distance=y,t.faceIndex=g,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{dd(0,new Float32Array(t),NC),e.union(NC)}),e}}const ND=1e6*(1+1e-7);function cS(a){return~~(a*ND)}function kC(a){return`${cS(a.x)},${cS(a.y)},${cS(a.z)}`}const uS=[new i.Pa4,new i.Pa4,new i.Pa4];class kD{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:~~(n/3)}getSiblingEdgeIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:n%3}updateFrom(e){const t=new Map,{attributes:n}=e,s=e.index,l=n.position;let c=s?s.count/3:l.count/3;const f=c;let g=0;this.useDrawRange&&(g=e.drawRange.start,e.drawRange.count!==1/0&&(c=~~(e.drawRange.count/3)));let y=this.data;(!y||y.length<3*f)&&(y=new Int32Array(3*f)),y.fill(-1);let x=0,S=0;for(let C=0;C<c;C++){const L=3*C+g;for(let B=0;B<3;B++){let W=L+B;s&&(W=s.getX(W)),uS[B].fromBufferAttribute(l,W)}for(let B=0;B<3;B++){const W=(B+1)%3,q=uS[B],Z=uS[W],j=kC(q),F=kC(Z),se=`${F}_${j}`;if(t.has(se)){const pe=t.get(se);y[L+B]=pe,y[pe]=L+B,t.delete(se),x--,S++}else{const pe=`${j}_${F}`;t.set(pe,L+B),x++}}}this.matchedEdges=S,this.unmatchedEdges=x,this.data=y}}class xw extends i.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new i.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,n=e.elements,s=t.elements;for(let l=0;l<16;l++)if(n[l]!==s[l])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(uC())for(const n in t){const s=t[n];if(s.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");s.array=vD(s.array)}if(e.boundsTree||(e.boundsTree=new fA(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new kD(e)),!e.groupIndices){const n=e.index.count/3,s=new Uint16Array(n),l=e.groups;for(let c=0,f=l.length;c<f;c++){const{start:g,count:y}=l[c];for(let x=g/3,S=(g+y)/3;x<S;x++)s[x]=c}e.groupIndices=s}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function UC(a,e){let t=e;return Array.isArray(e)||(t=[],a.forEach(n=>{t[n.materialIndex]=e})),t}class UD{constructor(){this.triangleSplitter=new _D,this.attributeData=new yD,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new bD}evaluate(e,t,n,s=new xw){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:l,attributeData:c,attributes:f,useGroups:g,debug:y}=this,x=s.geometry,S=e.geometry.attributes;for(let Z=0,j=f.length;Z<j;Z++){const F=f[Z],se=S[F];c.initializeArray(F,se.array.constructor)}for(const Z in c.attributes)f.includes(Z)||c.delete(Z);for(const Z in x.attributes)f.includes(Z)||(x.deleteAttribute(Z),x.dispose());c.clear(),y.enabled&&(y.reset(),yC(y)),function(Z,j,F,se,pe,be){const{useGroups:Se=!0}=be,{aIntersections:Be,bIntersections:Ge}=function(Qe,at){const Ke=new pC,Je=new pC;return fC.copy(Qe.matrixWorld).invert().multiply(at.matrixWorld),Qe.geometry.boundsTree.bvhcast(at.geometry.boundsTree,fC,{intersectsTriangles(ft,mt,vt,Qt){if(ft.intersectsTriangle(mt,X1,!0)){if(X1.distanceSq()===0&&ft.plane.normal.dot(mt.plane.normal)<1-1e-10)return!1;Ke.add(vt,Qt),Je.add(Qt,vt),ow&&(ow.addEdge(X1),ow.addIntersectingTriangles(vt,ft,Qt,mt))}return!1}}),{aIntersections:Ke,bIntersections:Je}}(Z,j);let Xe;Xe=Se?0:-1,wC(Z,j,Be,F,!1,pe,Xe),xC(Z,j,Be,F,!1,se,pe,Xe),Xe=Se?Z.geometry.groups.length||1:-1,wC(j,Z,Ge,F,!0,pe,Xe),xC(j,Z,Ge,F,!0,se,pe,Xe)}(e,t,n,l,c,{useGroups:g}),y.enabled&&yC(null);const C=g&&e.geometry.groups.length!==0?e.geometry.groups.map(Z=>({...Z})):[{start:0,count:1/0,materialIndex:0}],L=g&&t.geometry.groups.length!==0?t.geometry.groups.map(Z=>({...Z})):[{start:0,count:1/0,materialIndex:0}],B=UC(C,e.material),W=UC(L,t.material);L.forEach(Z=>{Z.materialIndex+=B.length}),function(Z,j,F,se){let pe=!1,be=-1;const Se=se.groupCount,Be=Z.attributes,Ge=se.groupAttributes[0];for(const Qe in Ge){const at=se.getTotalLength(Qe,Se),Ke=Ge[Qe].type;let Je=Be[Qe];if(!Je||Je.array.length<at){const mt=j.attributes[Qe];Je=new i.TlE(new Ke(at),mt.itemSize,mt.normalized),Z.setAttribute(Qe,Je),pe=!0}let ft=0;for(let mt=0;mt<Se;mt++){const{array:vt,type:Qt,length:Ht}=se.groupAttributes[mt][Qe],Cn=new Qt(vt.buffer,0,Ht);Je.array.set(Cn,ft),ft+=Cn.length}Je.needsUpdate=!0,be=at/Je.itemSize}Z.setDrawRange(0,be),Z.clearGroups();let Xe=0;for(let Qe=0;Qe<Se;Qe++){const at=se.getGroupArray("position",Qe).length/3;if(at!==0){const Ke=F[Qe];Z.addGroup(Xe,at,Ke.materialIndex),Xe+=at}}if(Z.index){const Qe=Z.index.array;if(Qe.length<be)Z.index=null,pe=!0;else for(let at=0,Ke=Qe.length;at<Ke;at++)Qe[at]=at}Z.boundsTree=null,pe&&Z.dispose()}(x,e.geometry,[...C,...L],c);const q=x.groups;if(g){const Z=new Map,j=[...B,...W];let F=0;for(let se=0,pe=j.length;se<pe;se++)q.find(be=>be.materialIndex===se)?(Z.set(se,F),F++):j[se]=null;for(let se=0,pe=q.length;se<pe;se++){const be=q[se];be.materialIndex=Z.get(be.materialIndex)}s.material=j.filter(se=>se)}return s}evaluateHierarchy(e,t=new xw){e.updateMatrixWorld(!0);const n=(l,c)=>{const f=l.children;for(let g=0,y=f.length;g<y;g++){const x=f[g];x.isOperationGroup?n(x,c):c(x)}},s=l=>{const c=l.children;let f=!1;for(let y=0,x=c.length;y<x;y++){const S=c[y];f=s(S)||f}const g=l.isDirty();if(g&&l.markUpdated(),f&&!l.isOperationGroup){let y;return n(l,x=>{y=y?this.evaluate(y,x,x.operation):this.evaluate(l,x,x.operation)}),l._cachedGeometry=y.geometry,l._cachedMaterials=y.material,!0}return f||g};return s(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const FC={union:sC,subtract:oC,intersect:lC,difference:aC};function zC(a,e){const t=new UD;t.useGroups=!0,t.attributes=["position","normal","uv"],a.forEach(l=>{for(const c of[...t.attributes])l[0].geometry.getAttribute(c)||t.attributes.splice(t.attributes.indexOf(c),1)});let n=new xw(new i._12(.01,.01,2,2));a.forEach(([l,c])=>{if(!Object.keys(FC).includes(c))return void console.error(`Unknown operation ${c}`);l.updateMatrix(),l.updateMatrixWorld();const f=new xw;f.geometry=l.geometry,f.material=l.material,l.matrixWorld.decompose(f.position,f.quaternion,f.scale),f.updateMatrix(),f.updateMatrixWorld(),n=t.evaluate(n,f,FC[c])});const s=n;return s.userData._isCSGMesh=!0,s}let mA=class extends Ip{_buildCSGMesh(a){return zC(a)}};mA.PluginType="CSGPluginBVH",mA=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c}([lt("CSG Plugin (BVH)")],mA);class ww extends Ln{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var t,n,s,l;(n=(t=e.lastCamera)==null?void 0:t.removeControlsCtor)==null||n.call(t,this.controlsKey),(l=(s=e.camera)==null?void 0:s.setControlsCtor)==null||l.call(s,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var VC=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};const FD=new i.Pa4(0,0,1),jC=new i.USm,zD=new i._fP,VD=new i._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),t0=new i._fP,jD={type:"change"};let gA=class extends r.SimpleEventDispatcher{constructor(a){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new i._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new i._fP,this._initQuaternionInvert=new i._fP,this._initQuaternionDest=new i._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=a,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(a=>{a=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(a=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",a)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new i._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const a=this.deviceOrientation;if(a){const e=a.alpha!==null?i.M8C.degToRad(a.alpha):0,t=a.beta!==null?i.M8C.degToRad(a.beta):0,n=a.gamma!==null?i.M8C.degToRad(a.gamma):0,s=this.screenOrientation?i.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,t,n,s),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(jD))}}dispose(){this.disconnect()}setObjectQuaternion(a,e,t,n){const s=(0,r.now)()/1e3;jC.set(e,a,-t,"YXZ"),t0.setFromEuler(jC),t0.multiply(VD),t0.multiply(zD.setFromAxisAngle(FD,-n)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(t0).invert(),this._initQuaternionDest.__init=!0),t0.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(t0,this.dampingFactor/(Math.min(1,s-this._lastTime)/(1/60))),this._lastTime=s}};VC([Pe(),Hn("Damping",[0,1],.01)],gA.prototype,"dampingFactor",void 0),gA=VC([Nt("Device Orientation Controls")],gA);class hS extends ww{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new gA(e)}}hS.PluginType="DeviceOrientationControlsPlugin";var Ml=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};const GC=new i.Pa4,dS=new i.$V,pS=new i.Pa4,GD={type:"change"};let ba=class extends r.SimpleEventDispatcher{constructor(a,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new i.Pa4,this._lastTime=-1,this.object=a,this.domElement=e,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const a=this.object.quaternion;GC.set(0,0,-1).applyQuaternion(a),dS.setFromVector3(GC),this.lat=90-i.M8C.radToDeg(dS.phi),this.lon=i.M8C.radToDeg(dS.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(a){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(a.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(a){if(this.activeLook)switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(a){this.domElement===document?(this.pointerX=a.pageX-this.viewHalfX,this.pointerY=a.pageY-this.viewHalfY):(this.pointerX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=a.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(a){if(this.enableKeys)switch(a.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(a){if(this.enableKeys)switch(a.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(a,e,t){return a.isVector3?pS.copy(a):e===void 0||t===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):pS.set(a,e,t),this.object.lookAt(pS),this.setOrientation(),this}update(){const a=(0,r.now)(),e=(this._lastTime<0?16:Math.min(a-this._lastTime,1e3))/1e3;if(this._lastTime=a,!this.enabled)return;if(this.heightSpeed){const g=i.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(g*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let n=e*this.lookSpeed;this.activeLook||(n=0);let s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*n,this.lookVertical&&(this.lat-=this.pointerY*n*s),this.lat=Math.max(-85,Math.min(85,this.lat));let l=i.M8C.degToRad(90-this.lat);const c=i.M8C.degToRad(this.lon);this.constrainVertical&&(l=i.M8C.mapLinear(l,0,Math.PI,this.verticalMin,this.verticalMax));const f=this.object.position;this.targetPosition.setFromSphericalCoords(1,l,c).add(f),this.object.lookAt(this.targetPosition),this.dispatchEvent(GD)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(a){this.enableKeys&&a.preventDefault()}};Ml([Pe(),En()],ba.prototype,"enabled",void 0),Ml([Pe(),En()],ba.prototype,"enableKeys",void 0),Ml([Pe(),We()],ba.prototype,"movementSpeed",void 0),Ml([Pe(),We()],ba.prototype,"lookSpeed",void 0),Ml([Pe(),En()],ba.prototype,"lookVertical",void 0),Ml([Pe(),En()],ba.prototype,"autoForward",void 0),Ml([Pe(),En()],ba.prototype,"activeLook",void 0),Ml([Pe(),En()],ba.prototype,"heightSpeed",void 0),Ml([Pe(),We()],ba.prototype,"heightCoef",void 0),Ml([Pe(),We()],ba.prototype,"heightMin",void 0),Ml([Pe(),We()],ba.prototype,"heightMax",void 0),Ml([Pe(),En()],ba.prototype,"constrainVertical",void 0),Ml([Pe(),We()],ba.prototype,"verticalMin",void 0),Ml([Pe(),We()],ba.prototype,"verticalMax",void 0),Ml([Pe(),En()],ba.prototype,"mouseDragOn",void 0),ba=Ml([lt("First Person Controls")],ba);class fS extends ww{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new ba(e,t)}}fS.PluginType="FirstPersonControlsPlugin";var n0=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};const i0=new i.USm(0,0,0,"YXZ"),r0=new i.Pa4,HD={type:"change"},WD={type:"lock"},QD={type:"unlock"},HC=Math.PI/2;let Np=class extends r.SimpleEventDispatcher{constructor(a,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new i.Pa4(0,0,-1),this.domElement=e,this.object=a,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(a){this.isLocked||this.autoLockOnClick&&(a.preventDefault(),this.lock())}onMouseMove(a){this.isLocked&&(this._movementX+=a.movementX||a.mozMovementX||a.webkitMovementX||0,this._movementY+=a.movementY||a.mozMovementY||a.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(WD),this.isLocked=!0):(this.dispatchEvent(QD),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(a){return a.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(a){r0.setFromMatrixColumn(this.object.matrix,0),r0.crossVectors(this.object.up,r0),this.object.position.addScaledVector(r0,a)}moveRight(a){r0.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(r0,a)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(i0.setFromQuaternion(this.object.quaternion),i0.y-=.002*this._movementX*this.pointerSpeed,i0.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,i0.x=Math.max(HC-this.maxPolarAngle,Math.min(HC-this.minPolarAngle,i0.x)),this.object.quaternion.setFromEuler(i0),this.dispatchEvent(HD))}};n0([En(),Pe()],Np.prototype,"enabled",void 0),n0([We(),Pe()],Np.prototype,"minPolarAngle",void 0),n0([We(),Pe()],Np.prototype,"maxPolarAngle",void 0),n0([We(),Pe()],Np.prototype,"pointerSpeed",void 0),n0([En(),Pe()],Np.prototype,"autoLockOnClick",void 0),Np=n0([Nt("Pointer Lock Controls")],Np);class mS extends ww{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new Np(e,t.ownerDocument?t:t.documentElement)}}mS.PluginType="PointerLockControlsPlugin";class WC{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new i.SUY}loadModel(e){this._model=e,this.mixer=new i.Xcj(e),e&&(this._animations=[...e.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(e){var n;const t=[];(n=this._animations)==null||n.forEach(s=>{t.push(this.playClip(s,e))}),await Promise.all(t)}async reverseAllAnimation(e){var n;const t=[];(n=this._animations)==null||n.forEach(s=>{t.push(this.playClip(s,e,1,!0))}),await Promise.all(t)}async playClip(e,t,n=1,s=!1,l=!1){if(!this.mixer)return;const c=this.mixer.clipAction(e);return this._playingAnimations.has(c)&&this.mixer.dispatchEvent({type:"canceled",action:c}),l&&(this.mixer.setTime(0),this.mixer.stopAllAction()),s?(c.paused=!1,c.timeScale=-n):(c.reset(),c.timeScale=n),c.loop=t?i.YKA:i.jAl,c.clampWhenFinished=!0,new Promise(f=>{const g=async y=>{y.action===c&&(this.mixer.removeEventListener("finished",g),this.mixer.removeEventListener("canceled",g),this._playingAnimations.delete(c),f())};this.mixer.addEventListener("finished",g),this.mixer.addEventListener("canceled",g),this._playingAnimations.add(c),c.play()})}playClipByName(e,t,n=1,s=!1){let l;this._animations.forEach(c=>{c.name===e&&(l=c)}),l&&this.playClip(l,t,n,s)}update(){const e=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(e),!0)}}class QC extends Ln{constructor(){super(),this.helperIdentities=new Map}async onAdded(e){var t;await super.onAdded(e),(t=this._viewer)==null||t.addEventListener("postFrame",()=>{this.helperIdentities.forEach(n=>{var s;n.update()&&((s=this._viewer)==null||s.setDirty())})})}createHelper(e,t){var n;if(this.helperIdentities.has(e))(n=this._viewer)==null||n.console.warn("Helper with this id already exists");else{const s=new WC;s.loadModel(t),this.helperIdentities.set(e,s)}}getAnimationClips(e){if(this.helperIdentities.has(e))return this.helperIdentities.get(e).getAnimationClips}async playClip(e,t,n,s=1,l=!1,c=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClip(t,n,s,l,c)}async playAllAnimations(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playAllAnimations(t)}async playAllAnimationsInReverse(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).reverseAllAnimation(t)}async playAnimationByName(e,t,n,s=1,l=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClipByName(t,n,s,l)}}QC.PluginType="AnimationHelperPlugin";class _A extends Ln{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,t,n)=>{(0,r.downloadBlob)(e,t)}},this.actions={...this.defaultActions}}async exportFile(e,t){t=t||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:t,state:"exporting"}),await this.actions.exportFile(e,t,({state:n,progress:s})=>{this.dispatchEvent({type:"transferFile",path:t,state:n??"exporting",progress:s})}),this.dispatchEvent({type:"transferFile",path:t,state:"done"})}}_A.PluginType="FileTransferPlugin";var s0=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};class gd extends Ln{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:i.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[_s],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=t=>{this._preFrame(t)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var e,t;return((t=(e=this._viewer)==null?void 0:e.getPlugin(_s))==null?void 0:t.camViews)??[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){var y;if(!this.enabled)return;const t=this._cameraViews;if(t.length<=1||!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=i.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=i.M8C.clamp(this._oldState,0,t.length-1.001);const n=Math.floor(this._oldState),s=this._overrideStartView||t[n],l=this._overrideEndView||t[n+1];let c,f=this._overrideStartView?this._overrideTime:this._oldState-n;f=bu[this.animEase](f),c=this.interpolateMode==="spherical"?this._lerpViewsSpherical(s,l,f):this._lerpViewsLinear(s,l,f);const g=(y=this._viewer)==null?void 0:y.scene.activeCamera;g&&(g.position.copy(c[0]),g.target.copy(c[1]),g.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,t,n){const s=new i.Pa4,l=new i.Pa4;return l.lerpVectors(e.position,t.position,n),s.lerpVectors(e.target,t.target,n),[l,s]}_lerpViewsSpherical(e,t,n){const s=e.target.clone(),l=new i.Pa4,c=new i.Pa4,f=Gf(e,e.target),g=Gf(t,t.target),y=new i.$V;return y.phi=Hf(f.phi,g.phi,n),y.theta=Hf(f.theta,g.theta,n),y.radius=i.M8C.lerp(f.radius,g.radius,n),l.copy(s).lerp(t.target,n),c.setFromSpherical(y),c.add(l),[c,l]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new ga(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const t=Math.floor(this._oldState),n=this._oldState-t;let s;s=this.interpolateMode==="spherical"?this._lerpViewsSpherical(e[t],e[t+1],n):this._lerpViewsLinear(e[t],e[t+1],n),this._overrideEndView=new ga(s[0],s[1]),this._overrideTime=0}}gd.PluginType="CameraViewControlPlugin",s0([En("Enabled"),(0,r.onChange)(gd.prototype._onEnabledChanged1),Pe()],gd.prototype,"enabled",void 0),s0([Pe(),Me("Ease",Object.keys(bu).map(a=>({label:a})))],gd.prototype,"animEase",void 0),s0([Pe(),Me("Interpolation",["spherical","linear"].map(a=>({label:a})))],gd.prototype,"interpolateMode",void 0),s0([En("Enable Damping"),Pe()],gd.prototype,"enableDamping",void 0),s0([Hn("Damping",[.01,1],.001),Pe()],gd.prototype,"damping",void 0),s0([Hn("Init Anim Time",[.01,5],.001),Pe()],gd.prototype,"initAnimationTime",void 0);class gS extends gd{constructor(e=document.body,t=!0){super(t),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[..._t(this)]},typeof e=="string"?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){if(!this.enabled||this._cameraViews.length<=1)return;const t=this._findActiveView(),n=this._getScroll(t);this.setState(n+t),super._preFrame(e)}_getScroll(e){if(e>=this._cameraViews.length-1)return 0;const t=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],n=this.parent.querySelector(this._cameraViews[e+1].name)??this.parent.getElementsByTagName("section")[e+1],s=this.parent.getBoundingClientRect();if(!t||!n)return 0;const l=t.getBoundingClientRect(),c=n.getBoundingClientRect(),f=this.parent===document.body?0:s.top;return i.M8C.clamp((f-l.top)/Math.max(c.top-l.top,1e-4),0,1)}_findActiveView(){var e;for(let t=this._cameraViews.length-1;t>=0;t--){const n=this.parent.querySelector(this._cameraViews[t].name)??this.parent.getElementsByTagName("section")[t],s=this.parent.getBoundingClientRect();if(n){if(n.getBoundingClientRect().top<(this.parent===document.body?0:s.top))return t}else(e=this._cameraViews[t].name)!=null&&e.startsWith("#")&&console.error("section with id "+this._cameraViews[t].name+" doesn't exist!")}return 0}}gS.PluginType="ScrollableCameraViewPlugin";var _S,vS=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let pm=_S=class extends gS{generateCode(){var s;const a=document.createElement("div");a.style.position="absolute",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.display="flex",a.style.flexDirection="column",a.style.justifyContent="center",a.style.alignItems="center",a.style.zIndex="200";const e=document.createElement("textarea");e.rows=20,e.style.border="3px solid #27223a",e.style.borderRadius="5px",e.style.width="30%",e.style.padding="5px",e.style.zIndex="1000";const t=document.createElement("div");t.textContent="X",t.style.color="red",t.style.width="20px",t.style.height="20px",t.style.padding="2",t.style.textAlign="center",t.style.backgroundColor="white",t.style.borderRadius="100%",t.style.border="2px solid #27223a",t.style.cursor="pointer",t.addEventListener("click",()=>{var l;(l=this._viewer)==null||l.container.removeChild(a)});const n=document.createElement("div");n.textContent="Update",n.style.marginTop="10px",n.style.color="white",n.style.padding="4px 10px 4px 10px",n.style.justifyContent="center",n.style.alignItems="center",n.style.backgroundColor="green",n.style.borderRadius="10px",n.style.border="2px solid #fff",n.style.cursor="pointer",n.addEventListener("click",()=>{var f;const l=this.parent.innerHTML;this.parent.innerHTML=e.value;let c=0;for(;c<this._cameraViews.length;c++){const g=this.parent.querySelector(this._cameraViews[c].name)??this.parent.getElementsByTagName("section")[c];if(!g&&c<2){alert("you need to add 2 sections at least");break}if(!g){const y=((f=this._cameraViews[c].name)==null||f.startsWith("#"),this._cameraViews[c].name.replace(/^#/,""));e.value+=y,e.value=this._format(e.value)}}c<2?this.parent.innerHTML=l:async function(g,y){var S;g.innerHTML=y;const x=g.getElementsByTagName("script");for(let C=0;C<x.length;C++){const L=x[C],B=VI(L);let W=!1;await new Promise(q=>{B.onload=q,B.onerror=()=>{W=!0,q(void 0)}}),W||((S=L.parentNode)==null||S.replaceChild(B,L))}}(this.parent,e.value)}),a.appendChild(t),a.appendChild(e),a.appendChild(n),e.value=this._format(this.parent.innerHTML),(s=this._viewer)==null||s.container.appendChild(a)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(a=document.body,e=!1){super(a,e),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(a){var e,t,n,s,l,c;this.parent=this.wrapper,await super.onAdded(a),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),(t=(e=this._viewer)==null?void 0:e.getPlugin(_s))==null||t.addEventListener("viewDelete",this.deleteView),(s=(n=this._viewer)==null?void 0:n.getPlugin(_s))==null||s.addEventListener("deserialize",this.deserialize),(c=(l=this._viewer)==null?void 0:l.getPlugin(_s))==null||c.addEventListener("viewAdd",this.addView)}deserialize(a){this._cameraViews.forEach(e=>{this._createSection(e.name)})}_addWrapper(){var a;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",(a=this._viewer)==null||a.container.appendChild(this.wrapper)}_createSection(a){const e=document.createElement("section");e.style.width="100%",e.style.height="100%",e.style.opacity="50%",e.style.backgroundColor="black",e.style.zIndex="100",e.style.top="0",e.textContent=a,e.style.color="white",e.style.fontSize="100px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.id=a,this.parent.appendChild(e)}addView(a){this._cameraViews.forEach((e,t)=>{var n;if(!(this.parent.querySelector(e.name)??this.parent.getElementsByTagName("section")[t])){const s=`<section id="${(n=e.name)!=null&&n.startsWith("#")?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">
                    ${e.name}
                    </section>`;this.parent.innerHTML+=s}})}deleteView(a){const e=this.parent.querySelector(a.view.name)??this.parent.getElementsByTagName("section").namedItem(a.view.name);e==null||e.remove()}_format(a){let e="",t="";return a.split(/>\s*</).forEach(function(n){n.match(/^\/\w/)&&(t=t.substring(1)),e+=t+"<"+n+`>\r
`,n.match(/^<?\w[^>]*[^/]$/)&&!n.startsWith("input")&&(t+="	")}),e.substring(1,e.length-3)}};vS([Ee("Show/Edit Code")],pm.prototype,"generateCode",null),vS([En("Canvas on top"),(0,r.onChange)(_S.prototype._togglePreview)],pm.prototype,"canvasUp",void 0),pm=_S=vS([lt("Scrollable Camera View Preview (Dev)")],pm);var yS={d:(a,e)=>{for(var t in e)yS.o(e,t)&&!yS.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:e[t]})},o:(a,e)=>Object.prototype.hasOwnProperty.call(a,e)},XC={};yS.d(XC,{Q:()=>KD});var AS=function(a,e,t,n){return new(t||(t=Promise))(function(s,l){function c(y){try{g(n.next(y))}catch(x){l(x)}}function f(y){try{g(n.throw(y))}catch(x){l(x)}}function g(y){var x;y.done?s(y.value):(x=y.value,x instanceof t?x:new t(function(S){S(x)})).then(c,f)}g((n=n.apply(a,e||[])).next())})};const qC=Symbol("Comlink.proxy"),XD=Symbol("Comlink.endpoint"),qD=Symbol("Comlink.releaseProxy"),bS=Symbol("Comlink.thrown"),YC=a=>typeof a=="object"&&a!==null||typeof a=="function",KC=new Map([["proxy",{canHandle:a=>YC(a)&&a[qC],serialize(a){const{port1:e,port2:t}=new MessageChannel;return $C(a,e),[t,[t]]},deserialize:a=>(a.start(),ZC(a))}],["throw",{canHandle:a=>YC(a)&&bS in a,serialize({value:a}){let e;return e=a instanceof Error?{isError:!0,value:{message:a.message,name:a.name,stack:a.stack}}:{isError:!1,value:a},[e,[]]},deserialize(a){throw a.isError?Object.assign(new Error(a.value.message),a.value):a.value}}]]);function $C(a,e=self){e.addEventListener("message",function t(n){if(!n||!n.data)return;const{id:s,type:l,path:c}=Object.assign({path:[]},n.data),f=(n.data.argumentList||[]).map(n_);let g;try{const y=c.slice(0,-1).reduce((S,C)=>S[C],a),x=c.reduce((S,C)=>S[C],a);switch(l){case"GET":g=x;break;case"SET":y[c.slice(-1)[0]]=n_(n.data.value),g=!0;break;case"APPLY":g=x.apply(y,f);break;case"CONSTRUCT":g=Sw(new x(...f));break;case"ENDPOINT":{const{port1:S,port2:C}=new MessageChannel;$C(a,C),g=function(L,B){return tR.set(L,B),L}(S,[S])}break;case"RELEASE":g=void 0;break;default:return}}catch(y){g={value:y,[bS]:0}}Promise.resolve(g).catch(y=>({value:y,[bS]:0})).then(y=>{const[x,S]=wS(y);e.postMessage(Object.assign(Object.assign({},x),{id:s}),S),l==="RELEASE"&&(e.removeEventListener("message",t),JC(e))})}),e.start&&e.start()}function JC(a){(function(e){return e.constructor.name==="MessagePort"})(a)&&a.close()}function ZC(a,e){return xS(a,[],e)}function Ew(a){if(a)throw new Error("Proxy has been released and is not useable")}function xS(a,e=[],t=function(){}){let n=!1;const s=new Proxy(t,{get(l,c){if(Ew(n),c===qD)return()=>o0(a,{type:"RELEASE",path:e.map(f=>f.toString())}).then(()=>{JC(a),n=!0});if(c==="then"){if(e.length===0)return{then:()=>s};const f=o0(a,{type:"GET",path:e.map(g=>g.toString())}).then(n_);return f.then.bind(f)}return xS(a,[...e,c])},set(l,c,f){Ew(n);const[g,y]=wS(f);return o0(a,{type:"SET",path:[...e,c].map(x=>x.toString()),value:g},y).then(n_)},apply(l,c,f){Ew(n);const g=e[e.length-1];if(g===XD)return o0(a,{type:"ENDPOINT"}).then(n_);if(g==="bind")return xS(a,e.slice(0,-1));const[y,x]=eR(f);return o0(a,{type:"APPLY",path:e.map(S=>S.toString()),argumentList:y},x).then(n_)},construct(l,c){Ew(n);const[f,g]=eR(c);return o0(a,{type:"CONSTRUCT",path:e.map(y=>y.toString()),argumentList:f},g).then(n_)}});return s}function eR(a){const e=a.map(wS);return[e.map(n=>n[0]),(t=e.map(n=>n[1]),Array.prototype.concat.apply([],t))];var t}const tR=new WeakMap;function Sw(a){return Object.assign(a,{[qC]:!0})}function wS(a){for(const[e,t]of KC)if(t.canHandle(a)){const[n,s]=t.serialize(a);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:a},tR.get(a)||[]]}function n_(a){switch(a.type){case"HANDLER":return KC.get(a.name).deserialize(a.value);case"RAW":return a.value}}function o0(a,e,t){return new Promise(n=>{const s=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");a.addEventListener("message",function l(c){c.data&&c.data.id&&c.data.id===s&&(a.removeEventListener("message",l),n(c.data))}),a.start&&a.start(),a.postMessage(Object.assign({id:s},e),t)})}class YD extends class{}{init(e,t,n,s){if(!this.api){if(!s)throw new Error("workerFilePath is required");(()=>{var l,c,f;l=this,f=function*(){const g=yield fetch(s).then(S=>S.blob()),y=URL.createObjectURL(g),x=new Worker(y,{type:"module"});this.api=yield new(ZC(x))(Sw(()=>{e(),URL.revokeObjectURL(y)}),Sw((S,C)=>S==="xatlas_web.wasm"?n:S+C),Sw(t))},new((c=void 0)||(c=Promise))(function(g,y){function x(L){try{C(f.next(L))}catch(B){y(B)}}function S(L){try{C(f.throw(L))}catch(B){y(B)}}function C(L){var B;L.done?g(L.value):(B=L.value,B instanceof c?B:new c(function(W){W(B)})).then(x,S)}C((f=f.apply(l,[])).next())})})()}}}class KD extends class{constructor(e,t={resolution:2048},n={},s=!1,l=!1,c=!1){this.THREE=e,this.packOptions=t,this.chartOptions=n,this.useNormals=s,this.timeUnwrap=l,this.logProgress=c,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(e,t,n){return AS(this,void 0,void 0,function*(){if(!this._libraryLoaded){for(yield new Promise((s,l)=>{try{this.xAtlas.init(()=>{s()},e,t,n)}catch(c){l(c)}});!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise(s=>setTimeout(s,100));this._libraryLoaded=!0}})}packAtlas(e,t="uv2",n="uv"){return AS(this,void 0,void 0,function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const s=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise(y=>setTimeout(y,100));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let l=[],c="";for(let y of e){let{uuid:x,index:S,attributes:C}=y;const L=y.userData.worldScale||1;l.push(x),S&&C.position&&C.position.itemSize===3?(c="Mesh"+l.length+" added to atlas: "+x,this.timeUnwrap&&console.time(c),yield this.xAtlas.api.addMesh(S.array,C.position.array,C.normal?C.normal.array:void 0,C.uv?C.uv.array:void 0,x,this.useNormals,s,L),this.timeUnwrap&&console.timeEnd(c)):console.warn("xatlas-three: Geometry not supported: ",y)}c="Generated atlas with "+l.length+" meshes",this.timeUnwrap&&console.time(c);let f=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(c);let g=[];for(let y of f){let x=e.find(S=>S.uuid===y.mesh);x?(y.vertex.vertices&&x.setAttribute("position",new this.THREE.BufferAttribute(y.vertex.vertices,3,!1)),y.vertex.normals&&x.setAttribute("normal",new this.THREE.BufferAttribute(y.vertex.normals,3,!0)),y.vertex.coords1&&x.setAttribute(t,new this.THREE.BufferAttribute(y.vertex.coords1,2,!1)),y.vertex.coords&&t!==n&&x.setAttribute(n,new this.THREE.BufferAttribute(y.vertex.coords,2,!1)),y.index&&x.setIndex(new this.THREE.BufferAttribute(y.index,1,!1)),g.push(x)):console.error("xatlas-three: Mesh not found: ",y.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,g})}unwrapGeometry(e,t="uv",n="uv2"){return AS(this,void 0,void 0,function*(){return this.packAtlas([e],t,n)})}}{_createXAtlas(){return new YD}}var vA,$D=XC.Q,ks=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let Yl=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};ks([Pe()],Yl.prototype,"fixWinding",void 0),ks([Pe()],Yl.prototype,"maxBoundaryLength",void 0),ks([Pe()],Yl.prototype,"maxChartArea",void 0),ks([Pe()],Yl.prototype,"maxCost",void 0),ks([Pe()],Yl.prototype,"maxIterations",void 0),ks([Pe()],Yl.prototype,"normalDeviationWeight",void 0),ks([Pe()],Yl.prototype,"normalSeamWeight",void 0),ks([Pe()],Yl.prototype,"roundnessWeight",void 0),ks([Pe()],Yl.prototype,"straightnessWeight",void 0),ks([Pe()],Yl.prototype,"textureSeamWeight",void 0),ks([Pe()],Yl.prototype,"useInputMeshUvs",void 0),Yl=ks([lt("Chart Options"),Pr("UChartOptions")],Yl);let xc=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};ks([Pe()],xc.prototype,"bilinear",void 0),ks([Pe()],xc.prototype,"blockAlign",void 0),ks([Pe()],xc.prototype,"bruteForce",void 0),ks([Pe()],xc.prototype,"createImage",void 0),ks([Pe()],xc.prototype,"maxChartSize",void 0),ks([Pe()],xc.prototype,"padding",void 0),ks([Pe()],xc.prototype,"resolution",void 0),ks([Pe()],xc.prototype,"rotateCharts",void 0),ks([Pe()],xc.prototype,"rotateChartsToAxis",void 0),ks([Pe()],xc.prototype,"texelsPerUnit",void 0),xc=ks([lt("Pack Options"),Pr("UPackOptions")],xc);let Lu=vA=class extends Ln{constructor(a=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new Yl,this.packOptions=new xc,this._loaded=!1,this._unwrapProgress=(e,t)=>{console.log("Unwrapping",e,t)},this.unwrapSelected=async()=>{var t,n,s,l,c;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(Kr))==null?void 0:n.getSelectedObject();if(e)if(e.geometry){if(e.geometry.attributes.uv&&!await((s=this._viewer)==null?void 0:s.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(e.geometry)}else(l=this._viewer)==null||l.alert("Unwrap: Selected object has no geometry");else(c=this._viewer)==null||c.alert("Unwrap: No object selected")},a&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,r.timeout)(100);else this._unwrapper=new $D({BufferAttribute:i.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,vA.LIBRARY_PATH+"xatlas.wasm",vA.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(a,e="uv",t="uv"){var n;await this.loadLibrary(),await((n=this._unwrapper)==null?void 0:n.unwrapGeometry(a,e,t))}async packAtlas(a,e=!0,t="uv2",n="uv"){var l;await this.loadLibrary(),Array.isArray(a)||(a=[a]);const s=[];e?a.forEach(c=>c.traverse(f=>{f.geometry&&s.push(f.geometry)})):a.forEach(c=>{c.geometry&&s.push(c.geometry)}),await((l=this._unwrapper)==null?void 0:l.packAtlas(s,t,n))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};Lu.PluginType="XAtlasPlugin",Lu.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",ks([(0,r.onChange)(vA.prototype._useNormalsChanged),Pe()],Lu.prototype,"useNormals",void 0),ks([Pe()],Lu.prototype,"chartOptions",void 0),ks([Pe()],Lu.prototype,"packOptions",void 0),ks([Ee("Unwrap Selected Geometry")],Lu.prototype,"unwrapSelected",void 0),Lu=vA=ks([lt("UV Unwrapping (xAtlas)")],Lu);class yA extends Ln{constructor(){super(...arguments),this.dependencies=[ri],this.enabled=!0,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,t)=>{let n=e.icon;return(n&&/^(\w+)\(([^)]*)\)/.exec(n)||/^#([A-Fa-f\d]+)$/.exec(n))&&(n=(0,r.makeColorSvg)(n)),n&&n.startsWith("http")&&n.startsWith("data:")||(n=this.utils.pathToIcon(this.baseUrl+t+"/"+e.prefix+(n||""))),n},getItemIcon:(e,t,n)=>{const s=e.iconFiles[t];if(s)return URL.createObjectURL(s);let l=e.icons[t];return(l&&/^(\w+)\(([^)]*)\)/.exec(l)||/^#([A-Fa-f\d]+)$/.exec(l))&&(l=(0,r.makeColorSvg)(l)),l||(l=this.utils.pathToIcon(e.items[t])),!l||l.startsWith("http")||l.startsWith("data:")||(l=this.baseUrl+n+"/"+e.prefix+l),l},getItemTitle:(e,t)=>e.titles[t]||this.utils.pathToTitle(e.items[t]),getItemPath:(e,t,n)=>e.items[t].startsWith("http")?e.items[t]:`${this.baseUrl}${n}/${e.prefix}${e.items[t]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,t,n,s=!1){var S,C;if(!this._viewer)return;const l=this._getVariationId(e);typeof t=="number"&&(t=e.items[t]);const c=e.items.indexOf(t);if(c===-1)return void this._viewer.console.warn(`Item ${t} not found`);const f=e.itemFiles[c],g=e.selected;if(!s&&g===c)return;e.selected=c;const y=this._viewer.getManager(),x=this.utils.getItemPath(e,c,n);if(n==="objects"){let L=this._viewer.scene.findObjectsByName(l).map(j=>j.modelObject);L.length===0&&(L=[(await this._viewer.createObject3D()).modelObject],L[0].name=l),this._viewer.renderEnabled=!1;for(const j of L)[...j.children].forEach(F=>F.dispose&&this.autoDispose?F.dispose():F.removeFromParent());const B=await this._loadObject(x,f);if(!B.length)return void(x.endsWith("json")||this._viewer.console.warn(`Object ${x} not found`));let W=!1;for(const j of L){[...j.children].forEach(F=>F.dispose&&this.autoDispose?F.dispose():F.removeFromParent());for(const F of B)W?j.add(F.modelObject.clone()):j.add(F.modelObject);W=!0}const q=[],Z=this.variations.materials.filter(j=>j&&typeof j.selected=="number");for(const j of Z)q.push(this.applyVariation(j,j.selected,"materials",!0));await Promise.all(q),this._viewer.renderEnabled=!0}if(n==="materials"){const L=await this._loadMaterial(x,f);if(!L)return void this._viewer.console.warn(`Material ${x} not found`);L.userData.__isVariation=!0;const B=this._viewer.scene.findObjectsByName(l);for(const W of B)(S=W.setMaterial)==null||S.call(W,L);(C=y.materials)==null||C.applyMaterial(L,l)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const t of e){const n=this._getVariationId(t),s=this._viewer.scene.findObjectsByName(n);for(const l of s)[...l.children].forEach(c=>(c.dispose??c.removeFromParent)())}}async _loadMaterial(e,t){var n,s,l;return(l=(s=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:s.importer)==null?void 0:l.importSinglePath(e,{importedFile:t})}async _loadObject(e,t){var n,s,l;return(l=(s=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:s.importer)==null?void 0:l.importPath(e,{importedFile:t,reimportDisposed:!0})}importConfig(e,t){typeof e=="string"&&(e=JSON.parse(e)),e.baseUrl!==void 0&&(this.baseUrl=e.baseUrl),!t&&e.folder&&(t=typeof e.folder=="object"?e.folder:typeof e.folder=="string"?ff(Ll(e.folder)):ff(e.folder));for(const n of this._ty)if(e[n])for(const s of e[n]){const l={items:s.items,prefix:s.prefix,name:s.name,title:s.title||"",icon:s.icon||"",icons:s.icons??s.items.map(()=>""),titles:s.titles??s.items.map(()=>""),itemFiles:[],iconFiles:[]};if(t)for(let c=0;c<s.items.length;c++){const f=s.items[c],g=t[n+"/"+s.prefix+f];l.itemFiles[c]=g?new File([g],f):void 0;const y=s.icons[c];if(!y)continue;const x=t[n+"/"+s.prefix+y];l.iconFiles[c]=x?new File([x],y):void 0}this.variations[n].push(l)}}async importPath(e){var t,n;if(e.endsWith(".json")){const s=await((n=(t=this._viewer)==null?void 0:t.getManager().importer)==null?void 0:n.importSinglePath(e,{processImported:!1})),l=e.split("?")[0];return this.baseUrl||(this.baseUrl=l.substring(0,l.lastIndexOf("/")+1)),this.importConfig(s)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){var t;return((t=this.variations.materials.find(n=>this.utils.getName(n)===e))==null?void 0:t.items)||[]}getObjects(e){var t;return((t=this.variations.objects.find(n=>this.utils.getName(n)===e))==null?void 0:t.items)||[]}getMaterialVariations(){return this.variations.materials.map(e=>this.utils.getName(e))}getObjectVariations(){return this.variations.objects.map(e=>this.utils.getName(e))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){var s;let e={objects:{},materials:{}};const t={objects:[],materials:[],type:yA.PluginType};this.baseUrl&&(t.baseUrl=this.baseUrl);let n=!1;for(const l of this._ty)for(const c of this.variations[l]){const f={...c};delete f.itemFiles,delete f.iconFiles,t[l].push(f);const g=c.prefix.replace(/^\//,""),y=g.trimEnd().endsWith("/")?"":g.split("/").pop()||"",x=g.replace(y,"").trimEnd().replace(/\/$/,""),S={};let C=!1;for(let W=0;W<c.items.length;W++){const q=c.items[W],Z=c.itemFiles[W],j=c.iconFiles[W],F=c.icons[W];Z?(S[y+q]=new Uint8Array(await Z.arrayBuffer()),j&&!F&&((s=this._viewer)==null||s.console.error("Icon file without icon name")),j&&F&&(S[y+F]=new Uint8Array(await j.arrayBuffer())),C=!0):j&&alert("Icon file without model/material file not supported")}if(!C)continue;n=!0;const L=x.split("/");let B=e[l];for(const W of L){B[W]||(B[W]={});const q=B[W];if(typeof q!="object")throw new Error("Invalid prefix: "+c.prefix);B=q}Object.assign(B,S)}return n||(e=void 0),{folder:e,config:t}}}yA.PluginType="VariationConfiguratorPlugin";class a0 extends yA{constructor(){super(),this._uiNeedRefresh=!1,this._container=document.createElement("div"),this._refreshUi=this._refreshUi.bind(this),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="100%",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi),e.container.appendChild(this._container)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),e.container.removeChild(this._container),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled||!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,Sn.RemoveAll(a0.PluginType);for(const e of["objects","materials"])for(const t of this.variations[e])Sn.Create(a0.PluginType,this.utils.getTitle(t),5,20,0,t.items.map((n,s)=>({id:n,image:this.utils.getItemIcon(t,s,e),onClick:async l=>this.applyVariation(t,l,e,!1),tooltip:this.utils.getItemTitle(t,s)})),(n,s)=>tm(n,{placement:"bottom",content:s.tooltip}));return Sn.RebuildUi(this._container),!0}}a0.PluginType="VariationConfiguratorPlugin";class AA extends a0{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map(e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map(t=>({type:"folder",expanded:this._uiExpandedState[t.name],onExpand:()=>this._uiExpandedState[t.name]=!0,onCollapse:()=>this._uiExpandedState[t.name]=!1,label:()=>this.utils.getName(t),children:[{type:"input",placeholder:()=>this.utils.getName(t),property:[t,"name"]},{type:"input",property:[t,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(t)),property:[t,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+t.prefix),property:[t,"icon"]},{type:"folder",label:"items",children:t.items.map((n,s)=>({type:"folder",label:()=>t.items[s],children:[{type:"input",label:"File/URL",isMonitor:!t.itemFiles[s],getValue:()=>t.items[s],setValue:l=>{t.items[s]=l}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(t.items[s]),getValue:()=>t.icons[s],setValue:l=>{t.icons[s]=l}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(t.items[s]),getValue:()=>t.titles[s],setValue:l=>{t.titles[s]=l}},{type:"button",label:"Apply",value:async()=>this.applyVariation(t,s,e)},t.itemFiles[s]?[{type:"button",label:"Remove",value:()=>{t.items.splice(s,1),t.itemFiles.splice(s,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const l=await(0,r.uploadFile)(!1,!1);l.length!==0&&(t.itemFiles[s]=l[0],t.items[s]=l[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const l=t.itemFiles[s];(0,r.downloadBlob)(l,l.name)}}]:{}]}))},{type:"button",label:"Add item (local)",value:async()=>{var s,l;const n=await(0,r.uploadFile)(!0,!1);if(n.length!==0){for(const c of n){if(!this._extForType[e].includes(c.name.split(".").pop()??"")){await((s=this._viewer)==null?void 0:s.alert(`Invalid file: ${c.name} is not a valid ${e} file`));continue}if(t.items.includes(c.name)){await((l=this._viewer)==null?void 0:l.alert(`Already exists: Item with name ${c.name} already exists`));continue}const f=t.items.push(c.name)-1;t.icons[f]="",t.titles[f]="",t.itemFiles[f]=c}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var l,c,f,g;const n=await((l=this._viewer)==null?void 0:l.prompt("URL: Enter the url of the object/material"));if(!n)return;if(!n.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await((c=this._viewer)==null?void 0:c.alert(`Invalid url: ${n} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes(n.split(".").pop()??""))return void await((f=this._viewer)==null?void 0:f.alert(`Invalid url: ${n} should be of a material ending with mat`));t.items.includes(n)&&await((g=this._viewer)==null?void 0:g.alert(`Already exists: Item with url ${n} already exists`)),t.items.push(n);const s=t.items.length-1;t.icons[s]="",t.titles[s]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(t),value:async()=>{var n;await((n=this._viewer)==null?void 0:n.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(t)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(t),1),this.refreshUi())}}]})),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{var n;const t=await((n=this._viewer)==null?void 0:n.prompt("Name: Enter the name of the object/material"));t&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:t+"/",name:t,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{var S,C,L;const t=await(0,r.uploadFile)(!1,!0);if(t.length===0)return;const n=[],s=[],l=[],c=[];for(const B of t){if(B.name.startsWith("."))continue;const W=B.name.split(".").pop()??"";W?this._extForType[e].includes(W)?(n.push(B.webkitRelativePath.replace(/^\//,"")),s.push(B)):this._extForType.images.includes(W)?(l.push(B.webkitRelativePath.replace(/^\//,"")),c.push(B)):await((S=this._viewer)==null?void 0:S.alert(`Invalid file: ${B.name} is not a valid ${e} file`)):await((C=this._viewer)==null?void 0:C.alert(`Invalid file: ${B.name} has no extension`))}const f=(0,r.longestCommonPrefix)(n),g=this.utils.getName({prefix:f});let y=await((L=this._viewer)==null?void 0:L.prompt("Name: Enter the name of the object/material",g,!0));if(y===null)return;y=y||g;const x=n.map(B=>{const W=B.replace(f,""),q=W.split(".").pop()??"",Z=W.replace("."+q,"")+".",j=l.findIndex(F=>F.replace(f,"").startsWith(Z));return j<0?["",void 0]:[l[j].replace(f,""),c[j]||void 0]});this.variations[e].push({items:n.map(B=>B.replace(f,"")),icons:x.map(B=>B[0]),iconFiles:x.map(B=>B[1]),titles:n.map(()=>""),itemFiles:s,prefix:f,name:y,icon:"",title:""}),this.refreshUi()}}]})),{type:"button",label:"Download JSON/Zip",value:async()=>{var e,t;try{const{folder:n,config:s}=await this._exportConfiguratorState(),l=JSON.stringify(s,null,4);if(n){n["config.json"]=Ll(l);const c=await A0(n),f=new Blob([c],{type:"application/zip"});(0,r.downloadBlob)(f,"configurator.zip")}else{const c=new Blob([l],{type:"application/json"});(0,r.downloadBlob)(c,"config.json")}}catch(n){return(e=this._viewer)==null||e.console.error(n),void await((t=this._viewer)==null?void 0:t.alert("Error: "+((n==null?void 0:n.message)||n)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var n,s,l;const e=await(0,r.uploadFile)(!1,!1,"application/zip,application/json");if(e.length===0)return;const t=e[0];if(t.name.endsWith(".zip")){const c=ff(new Uint8Array(await t.arrayBuffer()));if(!c["config.json"])return void await((n=this._viewer)==null?void 0:n.alert("Invalid zip: config.json not found"));const f=JSON.parse(ac(c["config.json"]));this.importConfig(f,c)}else{if(!t.name.endsWith(".json"))return void await((s=this._viewer)==null?void 0:s.alert("Invalid file: "+t.name));{const c=JSON.parse(await t.text());this.importConfig(c)}}await((l=this._viewer)==null?void 0:l.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var t,n;const e=await((t=this._viewer)==null?void 0:t.prompt("URL: Enter the url of the json file."));e&&(await this.importPath(e),await((n=this._viewer)==null?void 0:n.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var e,t;(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,t){const n=await super._loadObject(e,t);for(const s of n)(s.modelObject||s).userData.excludeFromExport=!0;return n}}AA.PluginType="VariationConfiguratorPlugin";class uh{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new He);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new He);const n=this.elements,s=e.x,l=e.y,c=e.z;return t.x=n[0]*s+n[1]*l+n[2]*c,t.y=n[3]*s+n[4]*l+n[5]*c,t.z=n[6]*s+n[7]*l+n[8]*c,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new uh);const n=this.elements,s=e.elements,l=t.elements,c=n[0],f=n[1],g=n[2],y=n[3],x=n[4],S=n[5],C=n[6],L=n[7],B=n[8],W=s[0],q=s[1],Z=s[2],j=s[3],F=s[4],se=s[5],pe=s[6],be=s[7],Se=s[8];return l[0]=c*W+f*j+g*pe,l[1]=c*q+f*F+g*be,l[2]=c*Z+f*se+g*Se,l[3]=y*W+x*j+S*pe,l[4]=y*q+x*F+S*be,l[5]=y*Z+x*se+S*Se,l[6]=C*W+L*j+B*pe,l[7]=C*q+L*F+B*be,l[8]=C*Z+L*se+B*Se,t}scale(e,t){t===void 0&&(t=new uh);const n=this.elements,s=t.elements;for(let l=0;l!==3;l++)s[3*l+0]=e.x*n[3*l+0],s[3*l+1]=e.y*n[3*l+1],s[3*l+2]=e.z*n[3*l+2];return t}solve(e,t){t===void 0&&(t=new He);const n=[];let s,l;for(s=0;s<12;s++)n.push(0);for(s=0;s<3;s++)for(l=0;l<3;l++)n[s+4*l]=this.elements[s+3*l];n[3]=e.x,n[7]=e.y,n[11]=e.z;let c=3;const f=c;let g,y;do{if(s=f-c,n[s+4*s]===0){for(l=s+1;l<f;l++)if(n[s+4*l]!==0){g=4;do y=4-g,n[y+4*s]+=n[y+4*l];while(--g);break}}if(n[s+4*s]!==0)for(l=s+1;l<f;l++){const x=n[s+4*l]/n[s+4*s];g=4;do y=4-g,n[y+4*l]=y<=s?0:n[y+4*l]-n[y+4*s]*x;while(--g)}}while(--c);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){e===void 0&&(e=new uh);const t=JD;let n,s;for(n=0;n<3;n++)for(s=0;s<3;s++)t[n+6*s]=this.elements[n+3*s];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let l=3;const c=l;let f,g;do{if(n=c-l,t[n+6*n]===0){for(s=n+1;s<c;s++)if(t[n+6*s]!==0){f=6;do g=6-f,t[g+6*n]+=t[g+6*s];while(--f);break}}if(t[n+6*n]!==0)for(s=n+1;s<c;s++){const y=t[n+6*s]/t[n+6*n];f=6;do g=6-f,t[g+6*s]=g<=n?0:t[g+6*s]-t[g+6*n]*y;while(--f)}}while(--l);n=2;do{s=n-1;do{const y=t[n+6*s]/t[n+6*n];f=6;do g=6-f,t[g+6*s]=t[g+6*s]-t[g+6*n]*y;while(--f)}while(s--)}while(--n);n=2;do{const y=1/t[n+6*n];f=6;do g=6-f,t[g+6*n]=t[g+6*n]*y;while(--f)}while(n--);n=2;do{s=2;do{if(g=t[3+s+6*n],isNaN(g)||g===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(n,s,g)}while(s--)}while(n--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,s=e.z,l=e.w,c=t+t,f=n+n,g=s+s,y=t*c,x=t*f,S=t*g,C=n*f,L=n*g,B=s*g,W=l*c,q=l*f,Z=l*g,j=this.elements;return j[0]=1-(C+B),j[1]=x-Z,j[2]=S+q,j[3]=x+Z,j[4]=1-(y+B),j[5]=L-W,j[6]=S-q,j[7]=L+W,j[8]=1-(y+C),this}transpose(e){e===void 0&&(e=new uh);const t=this.elements,n=e.elements;let s;return n[0]=t[0],n[4]=t[4],n[8]=t[8],s=t[1],n[1]=t[3],n[3]=s,s=t[2],n[2]=t[6],n[6]=s,s=t[5],n[5]=t[7],n[7]=s,e}}const JD=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class He{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new He);const n=e.x,s=e.y,l=e.z,c=this.x,f=this.y,g=this.z;return t.x=f*l-g*s,t.y=g*n-c*l,t.z=c*s-f*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new He(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new He(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new uh([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,s=Math.sqrt(e*e+t*t+n*n);if(s>0){const l=1/s;this.x*=l,this.y*=l,this.z*=l}else this.x=0,this.y=0,this.z=0;return s}unit(e){e===void 0&&(e=new He);const t=this.x,n=this.y,s=this.z;let l=Math.sqrt(t*t+n*n+s*s);return l>0?(l=1/l,e.x=t*l,e.y=n*l,e.z=s*l):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,s=this.z,l=e.x,c=e.y,f=e.z;return Math.sqrt((l-t)*(l-t)+(c-n)*(c-n)+(f-s)*(f-s))}distanceSquared(e){const t=this.x,n=this.y,s=this.z,l=e.x,c=e.y,f=e.z;return(l-t)*(l-t)+(c-n)*(c-n)+(f-s)*(f-s)}scale(e,t){t===void 0&&(t=new He);const n=this.x,s=this.y,l=this.z;return t.x=e*n,t.y=e*s,t.z=e*l,t}vmul(e,t){return t===void 0&&(t=new He),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new He),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new He),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const s=ZD,l=1/n;s.set(this.x*l,this.y*l,this.z*l);const c=e2;Math.abs(s.x)<.9?(c.set(1,0,0),s.cross(c,e)):(c.set(0,1,0),s.cross(c,e)),s.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const s=this.x,l=this.y,c=this.z;n.x=s+(e.x-s)*t,n.y=l+(e.y-l)*t,n.z=c+(e.z-c)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(nR),nR.almostEquals(e,t)}clone(){return new He(this.x,this.y,this.z)}}He.ZERO=new He(0,0,0),He.UNIT_X=new He(1,0,0),He.UNIT_Y=new He(0,1,0),He.UNIT_Z=new He(0,0,1);const ZD=new He,e2=new He,nR=new He;class go{constructor(e){e===void 0&&(e={}),this.lowerBound=new He,this.upperBound=new He,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,s){const l=this.lowerBound,c=this.upperBound,f=n;l.copy(e[0]),f&&f.vmult(l,l),c.copy(l);for(let g=1;g<e.length;g++){let y=e[g];f&&(f.vmult(y,iR),y=iR),y.x>c.x&&(c.x=y.x),y.x<l.x&&(l.x=y.x),y.y>c.y&&(c.y=y.y),y.y<l.y&&(l.y=y.y),y.z>c.z&&(c.z=y.z),y.z<l.z&&(l.z=y.z)}return t&&(t.vadd(l,l),t.vadd(c,c)),s&&(l.x-=s,l.y-=s,l.z-=s,c.x+=s,c.y+=s,c.z+=s),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new go().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,l=e.upperBound,c=s.x<=n.x&&n.x<=l.x||t.x<=l.x&&l.x<=n.x,f=s.y<=n.y&&n.y<=l.y||t.y<=l.y&&l.y<=n.y,g=s.z<=n.z&&n.z<=l.z||t.z<=l.z&&l.z<=n.z;return c&&f&&g}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,l=e.upperBound;return t.x<=s.x&&n.x>=l.x&&t.y<=s.y&&n.y>=l.y&&t.z<=s.z&&n.z>=l.z}getCorners(e,t,n,s,l,c,f,g){const y=this.lowerBound,x=this.upperBound;e.copy(y),t.set(x.x,y.y,y.z),n.set(x.x,x.y,y.z),s.set(y.x,x.y,x.z),l.set(x.x,y.y,x.z),c.set(y.x,x.y,y.z),f.set(y.x,y.y,x.z),g.copy(x)}toLocalFrame(e,t){const n=rR,s=n[0],l=n[1],c=n[2],f=n[3],g=n[4],y=n[5],x=n[6],S=n[7];this.getCorners(s,l,c,f,g,y,x,S);for(let C=0;C!==8;C++){const L=n[C];e.pointToLocal(L,L)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=rR,s=n[0],l=n[1],c=n[2],f=n[3],g=n[4],y=n[5],x=n[6],S=n[7];this.getCorners(s,l,c,f,g,y,x,S);for(let C=0;C!==8;C++){const L=n[C];e.pointToWorld(L,L)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,s=1/t.x,l=1/t.y,c=1/t.z,f=(this.lowerBound.x-n.x)*s,g=(this.upperBound.x-n.x)*s,y=(this.lowerBound.y-n.y)*l,x=(this.upperBound.y-n.y)*l,S=(this.lowerBound.z-n.z)*c,C=(this.upperBound.z-n.z)*c,L=Math.max(Math.max(Math.min(f,g),Math.min(y,x)),Math.min(S,C)),B=Math.min(Math.min(Math.max(f,g),Math.max(y,x)),Math.max(S,C));return!(B<0||L>B)}}const iR=new He,rR=[new He,new He,new He,new He,new He,new He,new He,new He];class sR{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:s}=t;if(s>n){const l=s;s=n,n=l}return this.matrix[(n*(n+1)>>1)+s-1]}set(e,t,n){let{index:s}=e,{index:l}=t;if(l>s){const c=l;l=s,s=c}this.matrix[(s*(s+1)>>1)+l-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class oR{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return!(n[e]===void 0||!n[e].includes(t))}hasAnyEventListener(e){return this._listeners!==void 0&&this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners;if(n[e]===void 0)return this;const s=n[e].indexOf(t);return s!==-1&&n[e].splice(s,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){e.target=this;for(let n=0,s=t.length;n<s;n++)t[n].call(this,e)}return this}}class xo{constructor(e,t,n,s){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),s===void 0&&(s=1),this.x=e,this.y=t,this.z=n,this.w=s}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e){e===void 0&&(e=new He),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=t2,s=n2;e.tangents(n,s),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new xo);const n=this.x,s=this.y,l=this.z,c=this.w,f=e.x,g=e.y,y=e.z,x=e.w;return t.x=n*x+c*f+s*y-l*g,t.y=s*x+c*g+l*f-n*y,t.z=l*x+c*y+n*g-s*f,t.w=c*x-n*f-s*g-l*y,t}inverse(e){e===void 0&&(e=new xo);const t=this.x,n=this.y,s=this.z,l=this.w;this.conjugate(e);const c=1/(t*t+n*n+s*s+l*l);return e.x*=c,e.y*=c,e.z*=c,e.w*=c,e}conjugate(e){return e===void 0&&(e=new xo),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new He);const n=e.x,s=e.y,l=e.z,c=this.x,f=this.y,g=this.z,y=this.w,x=y*n+f*l-g*s,S=y*s+g*n-c*l,C=y*l+c*s-f*n,L=-c*n-f*s-g*l;return t.x=x*y+L*-c+S*-g-C*-f,t.y=S*y+L*-f+C*-c-x*-g,t.z=C*y+L*-g+x*-f-S*-c,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let n,s,l;t===void 0&&(t="YZX");const c=this.x,f=this.y,g=this.z,y=this.w;if(t!=="YZX")throw new Error(`Euler order ${t} not supported yet.`);{const x=c*f+g*y;if(x>.499&&(n=2*Math.atan2(c,y),s=Math.PI/2,l=0),x<-.499&&(n=-2*Math.atan2(c,y),s=-Math.PI/2,l=0),n===void 0){const S=c*c,C=f*f,L=g*g;n=Math.atan2(2*f*y-2*c*g,1-2*C-2*L),s=Math.asin(2*x),l=Math.atan2(2*c*y-2*f*g,1-2*S-2*L)}}e.y=n,e.z=s,e.x=l}setFromEuler(e,t,n,s){s===void 0&&(s="XYZ");const l=Math.cos(e/2),c=Math.cos(t/2),f=Math.cos(n/2),g=Math.sin(e/2),y=Math.sin(t/2),x=Math.sin(n/2);return s==="XYZ"?(this.x=g*c*f+l*y*x,this.y=l*y*f-g*c*x,this.z=l*c*x+g*y*f,this.w=l*c*f-g*y*x):s==="YXZ"?(this.x=g*c*f+l*y*x,this.y=l*y*f-g*c*x,this.z=l*c*x-g*y*f,this.w=l*c*f+g*y*x):s==="ZXY"?(this.x=g*c*f-l*y*x,this.y=l*y*f+g*c*x,this.z=l*c*x+g*y*f,this.w=l*c*f-g*y*x):s==="ZYX"?(this.x=g*c*f-l*y*x,this.y=l*y*f+g*c*x,this.z=l*c*x-g*y*f,this.w=l*c*f+g*y*x):s==="YZX"?(this.x=g*c*f+l*y*x,this.y=l*y*f+g*c*x,this.z=l*c*x-g*y*f,this.w=l*c*f-g*y*x):s==="XZY"&&(this.x=g*c*f-l*y*x,this.y=l*y*f-g*c*x,this.z=l*c*x+g*y*f,this.w=l*c*f+g*y*x),this}clone(){return new xo(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new xo);const s=this.x,l=this.y,c=this.z,f=this.w;let g,y,x,S,C,L=e.x,B=e.y,W=e.z,q=e.w;return y=s*L+l*B+c*W+f*q,y<0&&(y=-y,L=-L,B=-B,W=-W,q=-q),1-y>1e-6?(g=Math.acos(y),x=Math.sin(g),S=Math.sin((1-t)*g)/x,C=Math.sin(t*g)/x):(S=1-t,C=t),n.x=S*s+C*L,n.y=S*l+C*B,n.z=S*c+C*W,n.w=S*f+C*q,n}integrate(e,t,n,s){s===void 0&&(s=new xo);const l=e.x*n.x,c=e.y*n.y,f=e.z*n.z,g=this.x,y=this.y,x=this.z,S=this.w,C=.5*t;return s.x+=C*(l*S+c*x-f*y),s.y+=C*(c*S+f*g-l*x),s.z+=C*(f*S+l*y-c*g),s.w+=C*(-l*g-c*y-f*x),s}}const t2=new He,n2=new He;class Ui{constructor(e){e===void 0&&(e={}),this.id=Ui.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,s){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Ui.idCounter=0,Ui.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class bs{constructor(e){e===void 0&&(e={}),this.position=new He,this.quaternion=new xo,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return bs.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return bs.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new He),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,s){return s===void 0&&(s=new He),n.vsub(e,s),t.conjugate(aR),aR.vmult(s,s),s}static pointToWorldFrame(e,t,n,s){return s===void 0&&(s=new He),t.vmult(n,s),s.vadd(e,s),s}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new He),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,s){return s===void 0&&(s=new He),t.w*=-1,t.vmult(n,s),t.w*=-1,s}}const aR=new xo;class i_ extends Ui{constructor(e){e===void 0&&(e={});const{vertices:t=[],faces:n=[],normals:s=[],axes:l,boundingSphereRadius:c}=e;super({type:Ui.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=s,this.faceNormals.length===0&&this.computeNormals(),c?this.boundingSphereRadius=c:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=l?l.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const s=new He;for(let l=0;l!==e.length;l++){const c=e[l],f=c.length;for(let g=0;g!==f;g++){const y=(g+1)%f;t[c[g]].vsub(t[c[y]],s),s.normalize();let x=!1;for(let S=0;S!==n.length;S++)if(n[S].almostEquals(s)||n[S].almostEquals(s)){x=!0;break}x||n.push(s.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let s=0;s<this.faces[e].length;s++)if(!this.vertices[this.faces[e][s]])throw new Error(`Vertex ${this.faces[e][s]} not found!`);const t=this.faceNormals[e]||new He;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let s=0;s<this.faces[e].length;s++)console.warn(`.vertices[${this.faces[e][s]}] = Vec3(${this.vertices[this.faces[e][s]].toString()})`)}}}getFaceNormal(e,t){const n=this.faces[e],s=this.vertices[n[0]],l=this.vertices[n[1]],c=this.vertices[n[2]];i_.computeNormal(s,l,c,t)}static computeNormal(e,t,n,s){const l=new He,c=new He;t.vsub(e,c),n.vsub(t,l),l.cross(c,s),s.isZero()||s.normalize()}clipAgainstHull(e,t,n,s,l,c,f,g,y){const x=new He;let S=-1,C=-Number.MAX_VALUE;for(let B=0;B<n.faces.length;B++){x.copy(n.faceNormals[B]),l.vmult(x,x);const W=x.dot(c);W>C&&(C=W,S=B)}const L=[];for(let B=0;B<n.faces[S].length;B++){const W=n.vertices[n.faces[S][B]],q=new He;q.copy(W),l.vmult(q,q),s.vadd(q,q),L.push(q)}S>=0&&this.clipFaceAgainstHull(c,e,t,L,f,g,y)}findSeparatingAxis(e,t,n,s,l,c,f,g){const y=new He,x=new He,S=new He,C=new He,L=new He,B=new He;let W=Number.MAX_VALUE;const q=this;if(q.uniqueAxes)for(let Z=0;Z!==q.uniqueAxes.length;Z++){n.vmult(q.uniqueAxes[Z],y);const j=q.testSepAxis(y,e,t,n,s,l);if(j===!1)return!1;j<W&&(W=j,c.copy(y))}else{const Z=f?f.length:q.faces.length;for(let j=0;j<Z;j++){const F=f?f[j]:j;y.copy(q.faceNormals[F]),n.vmult(y,y);const se=q.testSepAxis(y,e,t,n,s,l);if(se===!1)return!1;se<W&&(W=se,c.copy(y))}}if(e.uniqueAxes)for(let Z=0;Z!==e.uniqueAxes.length;Z++){l.vmult(e.uniqueAxes[Z],x);const j=q.testSepAxis(x,e,t,n,s,l);if(j===!1)return!1;j<W&&(W=j,c.copy(x))}else{const Z=g?g.length:e.faces.length;for(let j=0;j<Z;j++){const F=g?g[j]:j;x.copy(e.faceNormals[F]),l.vmult(x,x);const se=q.testSepAxis(x,e,t,n,s,l);if(se===!1)return!1;se<W&&(W=se,c.copy(x))}}for(let Z=0;Z!==q.uniqueEdges.length;Z++){n.vmult(q.uniqueEdges[Z],C);for(let j=0;j!==e.uniqueEdges.length;j++)if(l.vmult(e.uniqueEdges[j],L),C.cross(L,B),!B.almostZero()){B.normalize();const F=q.testSepAxis(B,e,t,n,s,l);if(F===!1)return!1;F<W&&(W=F,c.copy(B))}}return s.vsub(t,S),S.dot(c)>0&&c.negate(c),!0}testSepAxis(e,t,n,s,l,c){i_.project(this,e,n,s,ES),i_.project(t,e,l,c,SS);const f=ES[0],g=ES[1],y=SS[0],x=SS[1];if(f<x||y<g)return!1;const S=f-x,C=y-g;return S<C?S:C}calculateLocalInertia(e,t){const n=new He,s=new He;this.computeLocalAABB(s,n);const l=n.x-s.x,c=n.y-s.y,f=n.z-s.z;t.x=1/12*e*(2*c*2*c+2*f*2*f),t.y=1/12*e*(2*l*2*l+2*f*2*f),t.z=1/12*e*(2*c*2*c+2*l*2*l)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],s=this.vertices[t[0]];return-n.dot(s)}clipFaceAgainstHull(e,t,n,s,l,c,f){const g=new He,y=new He,x=new He,S=new He,C=new He,L=new He,B=new He,W=new He,q=this,Z=s,j=[];let F=-1,se=Number.MAX_VALUE;for(let Ge=0;Ge<q.faces.length;Ge++){g.copy(q.faceNormals[Ge]),n.vmult(g,g);const Xe=g.dot(e);Xe<se&&(se=Xe,F=Ge)}if(F<0)return;const pe=q.faces[F];pe.connectedFaces=[];for(let Ge=0;Ge<q.faces.length;Ge++)for(let Xe=0;Xe<q.faces[Ge].length;Xe++)pe.indexOf(q.faces[Ge][Xe])!==-1&&Ge!==F&&pe.connectedFaces.indexOf(Ge)===-1&&pe.connectedFaces.push(Ge);const be=pe.length;for(let Ge=0;Ge<be;Ge++){const Xe=q.vertices[pe[Ge]],Qe=q.vertices[pe[(Ge+1)%be]];Xe.vsub(Qe,y),x.copy(y),n.vmult(x,x),t.vadd(x,x),S.copy(this.faceNormals[F]),n.vmult(S,S),t.vadd(S,S),x.cross(S,C),C.negate(C),L.copy(Xe),n.vmult(L,L),t.vadd(L,L);const at=pe.connectedFaces[Ge];B.copy(this.faceNormals[at]);const Ke=this.getPlaneConstantOfFace(at);W.copy(B),n.vmult(W,W);const Je=Ke-W.dot(t);for(this.clipFaceAgainstPlane(Z,j,W,Je);Z.length;)Z.shift();for(;j.length;)Z.push(j.shift())}B.copy(this.faceNormals[F]);const Se=this.getPlaneConstantOfFace(F);W.copy(B),n.vmult(W,W);const Be=Se-W.dot(t);for(let Ge=0;Ge<Z.length;Ge++){let Xe=W.dot(Z[Ge])+Be;if(Xe<=l&&(console.log(`clamped: depth=${Xe} to minDist=${l}`),Xe=l),Xe<=c){const Qe=Z[Ge];if(Xe<=1e-6){const at={point:Qe,normal:W,depth:Xe};f.push(at)}}}}clipFaceAgainstPlane(e,t,n,s){let l,c;const f=e.length;if(f<2)return t;let g=e[e.length-1],y=e[0];l=n.dot(g)+s;for(let x=0;x<f;x++){if(y=e[x],c=n.dot(y)+s,l<0)if(c<0){const S=new He;S.copy(y),t.push(S)}else{const S=new He;g.lerp(y,l/(l-c),S),t.push(S)}else if(c<0){const S=new He;g.lerp(y,l/(l-c),S),t.push(S),t.push(y)}g=y,l=c}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new He);const n=this.vertices,s=this.worldVertices;for(let l=0;l!==this.vertices.length;l++)t.vmult(n[l],s[l]),e.vadd(s[l],s[l]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let s=0;s<this.vertices.length;s++){const l=n[s];l.x<e.x?e.x=l.x:l.x>t.x&&(t.x=l.x),l.y<e.y?e.y=l.y:l.y>t.y&&(t.y=l.y),l.z<e.z?e.z=l.z:l.z>t.z&&(t.z=l.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new He);const n=this.faceNormals,s=this.worldFaceNormals;for(let l=0;l!==t;l++)e.vmult(n[l],s[l]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const s=t[n].lengthSquared();s>e&&(e=s)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,s){const l=this.vertices;let c,f,g,y,x,S,C=new He;for(let L=0;L<l.length;L++){C.copy(l[L]),t.vmult(C,C),e.vadd(C,C);const B=C;(c===void 0||B.x<c)&&(c=B.x),(y===void 0||B.x>y)&&(y=B.x),(f===void 0||B.y<f)&&(f=B.y),(x===void 0||B.y>x)&&(x=B.y),(g===void 0||B.z<g)&&(g=B.z),(S===void 0||B.z>S)&&(S=B.z)}n.set(c,f,g),s.set(y,x,S)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new He);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,s=this.vertices;if(t){for(let l=0;l<n;l++){const c=s[l];t.vmult(c,c)}for(let l=0;l<this.faceNormals.length;l++){const c=this.faceNormals[l];t.vmult(c,c)}}if(e)for(let l=0;l<n;l++){const c=s[l];c.vadd(e,c)}}pointIsInside(e){const t=this.vertices,n=this.faces,s=this.faceNormals,l=new He;this.getAveragePointLocal(l);for(let c=0;c<this.faces.length;c++){let f=s[c];const g=t[n[c][0]],y=new He;e.vsub(g,y);const x=f.dot(y),S=new He;l.vsub(g,S);const C=f.dot(S);if(x<0&&C>0||x>0&&C<0)return!1}return-1}static project(e,t,n,s,l){const c=e.vertices.length,f=i2;let g=0,y=0;const x=r2,S=e.vertices;x.setZero(),bs.vectorToLocalFrame(n,s,t,f),bs.pointToLocalFrame(n,s,x,x);const C=x.dot(f);y=g=S[0].dot(f);for(let L=1;L<c;L++){const B=S[L].dot(f);B>g&&(g=B),B<y&&(y=B)}if(y-=C,g-=C,y>g){const L=y;y=g,g=L}l[0]=g,l[1]=y}}const ES=[],SS=[],i2=(new He,new He),r2=new He;class Tw extends Ui{constructor(e){super({type:Ui.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,s=He,l=[new s(-e,-t,-n),new s(e,-t,-n),new s(e,t,-n),new s(-e,t,-n),new s(-e,-t,n),new s(e,-t,n),new s(e,t,n),new s(-e,t,n)],c=[new s(0,0,1),new s(0,1,0),new s(1,0,0)],f=new i_({vertices:l,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:c});this.convexPolyhedronRepresentation=f,f.material=this.material}calculateLocalInertia(e,t){return t===void 0&&(t=new He),Tw.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const s=e;n.x=1/12*t*(2*s.y*2*s.y+2*s.z*2*s.z),n.y=1/12*t*(2*s.x*2*s.x+2*s.z*2*s.z),n.z=1/12*t*(2*s.y*2*s.y+2*s.x*2*s.x)}getSideNormals(e,t){const n=e,s=this.halfExtents;if(n[0].set(s.x,0,0),n[1].set(0,s.y,0),n[2].set(0,0,s.z),n[3].set(-s.x,0,0),n[4].set(0,-s.y,0),n[5].set(0,0,-s.z),t!==void 0)for(let l=0;l!==n.length;l++)t.vmult(n[l],n[l]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const s=this.halfExtents,l=[[s.x,s.y,s.z],[-s.x,s.y,s.z],[-s.x,-s.y,s.z],[-s.x,-s.y,-s.z],[s.x,-s.y,-s.z],[s.x,s.y,-s.z],[-s.x,s.y,-s.z],[s.x,-s.y,s.z]];for(let c=0;c<l.length;c++)fm.set(l[c][0],l[c][1],l[c][2]),t.vmult(fm,fm),e.vadd(fm,fm),n(fm.x,fm.y,fm.z)}calculateWorldAABB(e,t,n,s){const l=this.halfExtents;_d[0].set(l.x,l.y,l.z),_d[1].set(-l.x,l.y,l.z),_d[2].set(-l.x,-l.y,l.z),_d[3].set(-l.x,-l.y,-l.z),_d[4].set(l.x,-l.y,-l.z),_d[5].set(l.x,l.y,-l.z),_d[6].set(-l.x,l.y,-l.z),_d[7].set(l.x,-l.y,l.z);const c=_d[0];t.vmult(c,c),e.vadd(c,c),s.copy(c),n.copy(c);for(let f=1;f<8;f++){const g=_d[f];t.vmult(g,g),e.vadd(g,g);const y=g.x,x=g.y,S=g.z;y>s.x&&(s.x=y),x>s.y&&(s.y=x),S>s.z&&(s.z=S),y<n.x&&(n.x=y),x<n.y&&(n.y=x),S<n.z&&(n.z=S)}}}const fm=new He,_d=[new He,new He,new He,new He,new He,new He,new He,new He];class Vi extends oR{constructor(e){e===void 0&&(e={}),super(),this.id=Vi.idCounter++,this.index=-1,this.world=null,this.vlambda=new He,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse!="boolean"||e.collisionResponse,this.position=new He,this.previousPosition=new He,this.interpolatedPosition=new He,this.initPosition=new He,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new He,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new He,this.force=new He;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?Vi.STATIC:Vi.DYNAMIC,typeof e.type==typeof Vi.STATIC&&(this.type=e.type),this.allowSleep=e.allowSleep===void 0||e.allowSleep,this.sleepState=Vi.AWAKE,this.sleepSpeedLimit=e.sleepSpeedLimit!==void 0?e.sleepSpeedLimit:.1,this.sleepTimeLimit=e.sleepTimeLimit!==void 0?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new He,this.quaternion=new xo,this.initQuaternion=new xo,this.previousQuaternion=new xo,this.interpolatedQuaternion=new xo,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new He,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new He,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new He,this.invInertia=new He,this.invInertiaWorld=new uh,this.invMassSolve=0,this.invInertiaSolve=new He,this.invInertiaWorldSolve=new uh,this.fixedRotation=e.fixedRotation!==void 0&&e.fixedRotation,this.angularDamping=e.angularDamping!==void 0?e.angularDamping:.01,this.linearFactor=new He(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new He(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new go,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new He,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=Vi.AWAKE,this.wakeUpAfterNarrowphase=!1,e===Vi.SLEEPING&&this.dispatchEvent(Vi.wakeupEvent)}sleep(){this.sleepState=Vi.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),s=this.sleepSpeedLimit**2;t===Vi.AWAKE&&n<s?(this.sleepState=Vi.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(Vi.sleepyEvent)):t===Vi.SLEEPY&&n>s?this.wakeUp():t===Vi.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Vi.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Vi.SLEEPING||this.type===Vi.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return t===void 0&&(t=new He),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return t===void 0&&(t=new He),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return t===void 0&&(t=new He),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return t===void 0&&(t=new He),this.quaternion.vmult(e,t),t}addShape(e,t,n){const s=new He,l=new xo;return t&&s.copy(t),n&&l.copy(n),this.shapes.push(e),this.shapeOffsets.push(s),this.shapeOrientations.push(l),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let s=0;for(let l=0;l!==n;l++){const c=e[l];c.updateBoundingSphereRadius();const f=t[l].length(),g=c.boundingSphereRadius;f+g>s&&(s=f+g)}this.boundingRadius=s}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,s=e.length,l=s2,c=o2,f=this.quaternion,g=this.aabb,y=a2;for(let x=0;x!==s;x++){const S=e[x];f.vmult(t[x],l),l.vadd(this.position,l),f.mult(n[x],c),S.calculateWorldAABB(l,c,y.lowerBound,y.upperBound),x===0?g.copy(y):g.extend(y)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const n=l2,s=c2;n.setRotationFromQuaternion(this.quaternion),n.transpose(s),n.scale(t,n),n.mmult(s,this.invInertiaWorld)}}applyForce(e,t){if(t===void 0&&(t=new He),this.type!==Vi.DYNAMIC)return;this.sleepState===Vi.SLEEPING&&this.wakeUp();const n=u2;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(t===void 0&&(t=new He),this.type!==Vi.DYNAMIC)return;const n=h2,s=d2;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,s),this.applyForce(n,s)}applyTorque(e){this.type===Vi.DYNAMIC&&(this.sleepState===Vi.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(t===void 0&&(t=new He),this.type!==Vi.DYNAMIC)return;this.sleepState===Vi.SLEEPING&&this.wakeUp();const n=t,s=p2;s.copy(e),s.scale(this.invMass,s),this.velocity.vadd(s,this.velocity);const l=f2;n.cross(e,l),this.invInertiaWorld.vmult(l,l),this.angularVelocity.vadd(l,this.angularVelocity)}applyLocalImpulse(e,t){if(t===void 0&&(t=new He),this.type!==Vi.DYNAMIC)return;const n=m2,s=g2;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,s),this.applyImpulse(n,s)}updateMassProperties(){const e=_2;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Tw.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new He;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==Vi.DYNAMIC&&this.type!==Vi.KINEMATIC||this.sleepState===Vi.SLEEPING)return;const s=this.velocity,l=this.angularVelocity,c=this.position,f=this.force,g=this.torque,y=this.quaternion,x=this.invMass,S=this.invInertiaWorld,C=this.linearFactor,L=x*e;s.x+=f.x*L*C.x,s.y+=f.y*L*C.y,s.z+=f.z*L*C.z;const B=S.elements,W=this.angularFactor,q=g.x*W.x,Z=g.y*W.y,j=g.z*W.z;l.x+=e*(B[0]*q+B[1]*Z+B[2]*j),l.y+=e*(B[3]*q+B[4]*Z+B[5]*j),l.z+=e*(B[6]*q+B[7]*Z+B[8]*j),c.x+=s.x*e,c.y+=s.y*e,c.z+=s.z*e,y.integrate(this.angularVelocity,e,this.angularFactor,y),t&&(n?y.normalizeFast():y.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}Vi.idCounter=0,Vi.COLLIDE_EVENT_NAME="collide",Vi.DYNAMIC=1,Vi.STATIC=2,Vi.KINEMATIC=4,Vi.AWAKE=0,Vi.SLEEPY=1,Vi.SLEEPING=2,Vi.wakeupEvent={type:"wakeup"},Vi.sleepyEvent={type:"sleepy"},Vi.sleepEvent={type:"sleep"};const s2=new He,o2=new xo,a2=new go,l2=new uh,c2=new uh,u2=(new uh,new He),h2=new He,d2=new He,p2=new He,f2=new He,m2=new He,g2=new He,_2=new He;class v2{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return(e.collisionFilterGroup&t.collisionFilterMask)!=0&&(t.collisionFilterGroup&e.collisionFilterMask)!=0&&((e.type&Vi.STATIC)==0&&e.sleepState!==Vi.SLEEPING||(t.type&Vi.STATIC)==0&&t.sleepState!==Vi.SLEEPING)}intersectionTest(e,t,n,s){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,s):this.doBoundingSphereBroadphase(e,t,n,s)}doBoundingSphereBroadphase(e,t,n,s){const l=y2;t.position.vsub(e.position,l);const c=(e.boundingRadius+t.boundingRadius)**2;l.lengthSquared()<c&&(n.push(e),s.push(t))}doBoundingBoxBroadphase(e,t,n,s){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),s.push(t))}makePairsUnique(e,t){const n=A2,s=b2,l=x2,c=e.length;for(let f=0;f!==c;f++)s[f]=e[f],l[f]=t[f];e.length=0,t.length=0;for(let f=0;f!==c;f++){const g=s[f].id,y=l[f].id,x=g<y?`${g},${y}`:`${y},${g}`;n[x]=f,n.keys.push(x)}for(let f=0;f!==n.keys.length;f++){const g=n.keys.pop(),y=n[g];e.push(s[y]),t.push(l[y]),delete n[g]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new He;e.position.vsub(t.position,n);const s=e.shapes[0],l=t.shapes[0];return Math.pow(s.boundingSphereRadius+l.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const y2=new He;new He,new xo,new He;const A2={keys:[]},b2=[],x2=[];new He,new He,new He;class w2 extends v2{constructor(){super()}collisionPairs(e,t,n){const s=e.bodies,l=s.length;let c,f;for(let g=0;g!==l;g++)for(let y=0;y!==g;y++)c=s[g],f=s[y],this.needBroadphaseCollision(c,f)&&this.intersectionTest(c,f,t,n)}aabbQuery(e,t,n){n===void 0&&(n=[]);for(let s=0;s<e.bodies.length;s++){const l=e.bodies[s];l.aabbNeedsUpdate&&l.updateAABB(),l.aabb.overlaps(t)&&n.push(l)}return n}}class Mw{constructor(){this.rayFromWorld=new He,this.rayToWorld=new He,this.hitNormalWorld=new He,this.hitPointWorld=new He,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,s,l,c,f){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(s),this.shape=l,this.body=c,this.distance=f}}let lR,cR,uR,hR,dR,pR,fR;lR=Ui.types.SPHERE,cR=Ui.types.PLANE,uR=Ui.types.BOX,hR=Ui.types.CYLINDER,dR=Ui.types.CONVEXPOLYHEDRON,pR=Ui.types.HEIGHTFIELD,fR=Ui.types.TRIMESH;class aa{get[lR](){return this._intersectSphere}get[cR](){return this._intersectPlane}get[uR](){return this._intersectBox}get[hR](){return this._intersectConvex}get[dR](){return this._intersectConvex}get[pR](){return this._intersectHeightfield}get[fR](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new He),t===void 0&&(t=new He),this.from=e.clone(),this.to=t.clone(),this.direction=new He,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=aa.ANY,this.result=new Mw,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||aa.ANY,this.result=t.result||new Mw,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:-1,this.checkCollisionResponse=t.checkCollisionResponse===void 0||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(mR),TS.length=0,e.broadphase.aabbQuery(e,mR,TS),this.intersectBodies(TS),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const s=E2,l=S2;for(let c=0,f=e.shapes.length;c<f;c++){const g=e.shapes[c];if((!n||g.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[c],l),e.quaternion.vmult(e.shapeOffsets[c],s),s.vadd(e.position,s),this.intersectShape(g,l,s,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,s=e.length;!this.result.shouldStop&&n<s;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,s){if(function(f,g,y){y.vsub(f,r_);const x=r_.dot(g);return g.scale(x,Rw),Rw.vadd(f,Rw),y.distanceTo(Rw)}(this.from,this.direction,n)>e.boundingSphereRadius)return;const c=this[e.type];c&&c.call(this,e,t,n,s,e)}_intersectBox(e,t,n,s,l){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,s,l)}_intersectPlane(e,t,n,s,l){const c=this.from,f=this.to,g=this.direction,y=new He(0,0,1);t.vmult(y,y);const x=new He;c.vsub(n,x);const S=x.dot(y);if(f.vsub(n,x),S*x.dot(y)>0||c.distanceTo(f)<S)return;const C=y.dot(g);if(Math.abs(C)<this.precision)return;const L=new He,B=new He,W=new He;c.vsub(n,L);const q=-y.dot(L)/C;g.scale(q,B),c.vadd(B,W),this.reportIntersection(y,W,l,s,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,s=this.to,l=this.from;t.x=Math.min(s.x,l.x),t.y=Math.min(s.y,l.y),t.z=Math.min(s.z,l.z),n.x=Math.max(s.x,l.x),n.y=Math.max(s.y,l.y),n.z=Math.max(s.z,l.z)}_intersectHeightfield(e,t,n,s,l){e.data,e.elementSize;const c=T2;c.from.copy(this.from),c.to.copy(this.to),bs.pointToLocalFrame(n,t,c.from,c.from),bs.pointToLocalFrame(n,t,c.to,c.to),c.updateDirection();const f=M2;let g,y,x,S;g=y=0,x=S=e.data.length-1;const C=new go;c.getAABB(C),e.getIndexOfPosition(C.lowerBound.x,C.lowerBound.y,f,!0),g=Math.max(g,f[0]),y=Math.max(y,f[1]),e.getIndexOfPosition(C.upperBound.x,C.upperBound.y,f,!0),x=Math.min(x,f[0]+1),S=Math.min(S,f[1]+1);for(let L=g;L<x;L++)for(let B=y;B<S;B++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(L,B,C),C.overlapsRay(c)){if(e.getConvexTrianglePillar(L,B,!1),bs.pointToWorldFrame(n,t,e.pillarOffset,Cw),this._intersectConvex(e.pillarConvex,t,Cw,s,l,gR),this.result.shouldStop)return;e.getConvexTrianglePillar(L,B,!0),bs.pointToWorldFrame(n,t,e.pillarOffset,Cw),this._intersectConvex(e.pillarConvex,t,Cw,s,l,gR)}}}_intersectSphere(e,t,n,s,l){const c=this.from,f=this.to,g=e.radius,y=(f.x-c.x)**2+(f.y-c.y)**2+(f.z-c.z)**2,x=2*((f.x-c.x)*(c.x-n.x)+(f.y-c.y)*(c.y-n.y)+(f.z-c.z)*(c.z-n.z)),S=x**2-4*y*((c.x-n.x)**2+(c.y-n.y)**2+(c.z-n.z)**2-g**2),C=C2,L=R2;if(!(S<0))if(S===0)c.lerp(f,S,C),C.vsub(n,L),L.normalize(),this.reportIntersection(L,C,l,s,-1);else{const B=(-x-Math.sqrt(S))/(2*y),W=(-x+Math.sqrt(S))/(2*y);if(B>=0&&B<=1&&(c.lerp(f,B,C),C.vsub(n,L),L.normalize(),this.reportIntersection(L,C,l,s,-1)),this.result.shouldStop)return;W>=0&&W<=1&&(c.lerp(f,W,C),C.vsub(n,L),L.normalize(),this.reportIntersection(L,C,l,s,-1))}}_intersectConvex(e,t,n,s,l,c){const f=I2,g=_R,y=c&&c.faceList||null,x=e.faces,S=e.vertices,C=e.faceNormals,L=this.direction,B=this.from,W=this.to,q=B.distanceTo(W),Z=y?y.length:x.length,j=this.result;for(let F=0;!j.shouldStop&&F<Z;F++){const se=y?y[F]:F,pe=x[se],be=C[se],Se=t,Be=n;g.copy(S[pe[0]]),Se.vmult(g,g),g.vadd(Be,g),g.vsub(B,g),Se.vmult(be,f);const Ge=L.dot(f);if(Math.abs(Ge)<this.precision)continue;const Xe=f.dot(g)/Ge;if(!(Xe<0)){L.scale(Xe,wc),wc.vadd(B,wc),hh.copy(S[pe[0]]),Se.vmult(hh,hh),Be.vadd(hh,hh);for(let Qe=1;!j.shouldStop&&Qe<pe.length-1;Qe++){vd.copy(S[pe[Qe]]),yd.copy(S[pe[Qe+1]]),Se.vmult(vd,vd),Se.vmult(yd,yd),Be.vadd(vd,vd),Be.vadd(yd,yd);const at=wc.distanceTo(B);!aa.pointInTriangle(wc,hh,vd,yd)&&!aa.pointInTriangle(wc,vd,hh,yd)||at>q||this.reportIntersection(f,wc,l,s,se)}}}}_intersectTrimesh(e,t,n,s,l,c){const f=P2,g=k2,y=U2,x=_R,S=D2,C=L2,L=B2,B=N2,W=O2,q=e.indices;e.vertices;const Z=this.from,j=this.to,F=this.direction;y.position.copy(n),y.quaternion.copy(t),bs.vectorToLocalFrame(n,t,F,S),bs.pointToLocalFrame(n,t,Z,C),bs.pointToLocalFrame(n,t,j,L),L.x*=e.scale.x,L.y*=e.scale.y,L.z*=e.scale.z,C.x*=e.scale.x,C.y*=e.scale.y,C.z*=e.scale.z,L.vsub(C,S),S.normalize();const se=C.distanceSquared(L);e.tree.rayQuery(this,y,g);for(let pe=0,be=g.length;!this.result.shouldStop&&pe!==be;pe++){const Se=g[pe];e.getNormal(Se,f),e.getVertex(q[3*Se],hh),hh.vsub(C,x);const Be=S.dot(f),Ge=f.dot(x)/Be;if(Ge<0)continue;S.scale(Ge,wc),wc.vadd(C,wc),e.getVertex(q[3*Se+1],vd),e.getVertex(q[3*Se+2],yd);const Xe=wc.distanceSquared(C);!aa.pointInTriangle(wc,vd,hh,yd)&&!aa.pointInTriangle(wc,hh,vd,yd)||Xe>se||(bs.vectorToWorldFrame(t,f,W),bs.pointToWorldFrame(n,t,wc,B),this.reportIntersection(W,B,l,s,Se))}g.length=0}reportIntersection(e,t,n,s,l){const c=this.from,f=this.to,g=c.distanceTo(t),y=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(y.hitFaceIndex=l!==void 0?l:-1,this.mode){case aa.ALL:this.hasHit=!0,y.set(c,f,e,t,n,s,g),y.hasHit=!0,this.callback(y);break;case aa.CLOSEST:(g<y.distance||!y.hasHit)&&(this.hasHit=!0,y.hasHit=!0,y.set(c,f,e,t,n,s,g));break;case aa.ANY:this.hasHit=!0,y.hasHit=!0,y.set(c,f,e,t,n,s,g),y.shouldStop=!0}}static pointInTriangle(e,t,n,s){s.vsub(t,r_),n.vsub(t,bA),e.vsub(t,MS);const l=r_.dot(r_),c=r_.dot(bA),f=r_.dot(MS),g=bA.dot(bA),y=bA.dot(MS);let x,S;return(x=g*f-c*y)>=0&&(S=l*y-c*f)>=0&&x+S<l*g-c*c}}aa.CLOSEST=1,aa.ANY=2,aa.ALL=4;const mR=new go,TS=[],bA=new He,MS=new He,E2=new He,S2=new xo,wc=new He,hh=new He,vd=new He,yd=new He;new He,new Mw;const gR={faceList:[0]},Cw=new He,T2=new aa,M2=[],C2=new He,R2=new He,I2=new He,_R=(new He,new He,new He),P2=new He,D2=new He,L2=new He,B2=new He,O2=new He,N2=new He;new go;const k2=[],U2=new bs,r_=new He,Rw=new He;class vR{static defaults(e,t){e===void 0&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}}class Iw{constructor(e,t,n){n===void 0&&(n={}),n=vR.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=Iw.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}}Iw.idCounter=0;class yR{constructor(){this.spatial=new He,this.rotational=new He}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class xA{constructor(e,t,n,s){n===void 0&&(n=-1e6),s===void 0&&(s=1e6),this.id=xA.idCounter++,this.minForce=n,this.maxForce=s,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new yR,this.jacobianElementB=new yR,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const s=t,l=e,c=n;this.a=4/(c*(1+4*s)),this.b=4*s/(1+4*s),this.eps=4/(c*c*l*(1+4*s))}computeB(e,t,n){const s=this.computeGW();return-this.computeGq()*e-s*t-this.computeGiMf()*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,l=n.position,c=s.position;return e.spatial.dot(l)+t.spatial.dot(c)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,l=n.velocity,c=s.velocity,f=n.angularVelocity,g=s.angularVelocity;return e.multiplyVectors(l,f)+t.multiplyVectors(c,g)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,l=n.vlambda,c=s.vlambda,f=n.wlambda,g=s.wlambda;return e.multiplyVectors(l,f)+t.multiplyVectors(c,g)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,l=n.force,c=n.torque,f=s.force,g=s.torque,y=n.invMassSolve,x=s.invMassSolve;return l.scale(y,AR),f.scale(x,bR),n.invInertiaWorldSolve.vmult(c,xR),s.invInertiaWorldSolve.vmult(g,wR),e.multiplyVectors(AR,xR)+t.multiplyVectors(bR,wR)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,l=n.invMassSolve,c=s.invMassSolve,f=n.invInertiaWorldSolve,g=s.invInertiaWorldSolve;let y=l+c;return f.vmult(e.rotational,Pw),y+=Pw.dot(e.rotational),g.vmult(t.rotational,Pw),y+=Pw.dot(t.rotational),y}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,s=this.bi,l=this.bj,c=F2;s.vlambda.addScaledVector(s.invMassSolve*e,t.spatial,s.vlambda),l.vlambda.addScaledVector(l.invMassSolve*e,n.spatial,l.vlambda),s.invInertiaWorldSolve.vmult(t.rotational,c),s.wlambda.addScaledVector(e,c,s.wlambda),l.invInertiaWorldSolve.vmult(n.rotational,c),l.wlambda.addScaledVector(e,c,l.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}xA.idCounter=0;const AR=new He,bR=new He,xR=new He,wR=new He,Pw=new He,F2=new He;class Dw extends xA{constructor(e,t,n){n===void 0&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new He,this.rj=new He,this.ni=new He}computeB(e){const t=this.a,n=this.b,s=this.bi,l=this.bj,c=this.ri,f=this.rj,g=z2,y=V2,x=s.velocity,S=s.angularVelocity;s.force,s.torque;const C=l.velocity,L=l.angularVelocity;l.force,l.torque;const B=j2,W=this.jacobianElementA,q=this.jacobianElementB,Z=this.ni;c.cross(Z,g),f.cross(Z,y),Z.negate(W.spatial),g.negate(W.rotational),q.spatial.copy(Z),q.rotational.copy(y),B.copy(l.position),B.vadd(f,B),B.vsub(s.position,B),B.vsub(c,B);const j=Z.dot(B),F=this.restitution+1;return-j*t-(F*C.dot(Z)-F*x.dot(Z)+L.dot(y)-S.dot(g))*n-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=G2,t=H2,n=W2,s=Q2,l=X2;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,s),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(s,t),e.vsub(t,l),this.ni.dot(l)}}const z2=new He,V2=new He,j2=new He,G2=new He,H2=new He,W2=new He,Q2=new He,X2=new He;class q2 extends Iw{constructor(e,t,n,s,l){t===void 0&&(t=new He),s===void 0&&(s=new He),l===void 0&&(l=1e6),super(e,n),this.pivotA=t.clone(),this.pivotB=s.clone();const c=this.equationX=new Dw(e,n),f=this.equationY=new Dw(e,n),g=this.equationZ=new Dw(e,n);this.equations.push(c,f,g),c.minForce=f.minForce=g.minForce=-l,c.maxForce=f.maxForce=g.maxForce=l,c.ni.set(1,0,0),f.ni.set(0,1,0),g.ni.set(0,0,1)}update(){const e=this.bodyA,t=this.bodyB,n=this.equationX,s=this.equationY,l=this.equationZ;e.quaternion.vmult(this.pivotA,n.ri),t.quaternion.vmult(this.pivotB,n.rj),s.ri.copy(n.ri),s.rj.copy(n.rj),l.ri.copy(n.ri),l.rj.copy(n.rj)}}new He,new He,new He,new He,new He,new He,new He,new He,new He,new He;class ER extends xA{constructor(e,t,n){super(e,t,-n,n),this.ri=new He,this.rj=new He,this.t=new He}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,s=this.rj,l=Y2,c=K2,f=this.t;n.cross(f,l),s.cross(f,c);const g=this.jacobianElementA,y=this.jacobianElementB;return f.negate(g.spatial),l.negate(g.rotational),y.spatial.copy(f),y.rotational.copy(c),-this.computeGW()*t-e*this.computeGiMf()}}const Y2=new He,K2=new He;class Lw{constructor(e,t,n){n=vR.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=Lw.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}Lw.idCounter=0;class Bw{constructor(e){e===void 0&&(e={});let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=Bw.idCounter++,this.friction=e.friction!==void 0?e.friction:-1,this.restitution=e.restitution!==void 0?e.restitution:-1}}Bw.idCounter=0,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new aa,new He,new He,new He,new He(1,0,0),new He(0,1,0),new He(0,0,1),new He,new He,new He,new He,new He,new He,new He,new He,new He,new He,new He;class SR extends Ui{constructor(e){if(super({type:Ui.types.SPHERE}),this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){t===void 0&&(t=new He);const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,s){const l=this.radius,c=["x","y","z"];for(let f=0;f<c.length;f++){const g=c[f];n[g]=e[g]-l,s[g]=e[g]+l}}}new He,new He,new He,new He,new He,new He,new He,new He,new He;class $2 extends i_{constructor(e,t,n,s){if(e===void 0&&(e=1),t===void 0&&(t=1),n===void 0&&(n=1),s===void 0&&(s=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const l=s,c=[],f=[],g=[],y=[],x=[],S=Math.cos,C=Math.sin;c.push(new He(-t*C(0),.5*-n,t*S(0))),y.push(0),c.push(new He(-e*C(0),.5*n,e*S(0))),x.push(1);for(let B=0;B<l;B++){const W=2*Math.PI/l*(B+1),q=2*Math.PI/l*(B+.5);B<l-1?(c.push(new He(-t*C(W),.5*-n,t*S(W))),y.push(2*B+2),c.push(new He(-e*C(W),.5*n,e*S(W))),x.push(2*B+3),g.push([2*B,2*B+1,2*B+3,2*B+2])):g.push([2*B,2*B+1,1,0]),(l%2==1||B<l/2)&&f.push(new He(-C(q),0,S(q)))}g.push(y),f.push(new He(0,1,0));const L=[];for(let B=0;B<x.length;B++)L.push(x[x.length-B-1]);g.push(L),super({vertices:c,faces:g,axes:f}),this.type=Ui.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=n,this.numSegments=s}}class J2 extends Ui{constructor(){super({type:Ui.types.PLANE}),this.worldNormal=new He,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return t===void 0&&(t=new He),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,s){kp.set(0,0,1),t.vmult(kp,kp);const l=Number.MAX_VALUE;n.set(-l,-l,-l),s.set(l,l,l),kp.x===1?s.x=e.x:kp.x===-1&&(n.x=e.x),kp.y===1?s.y=e.y:kp.y===-1&&(n.y=e.y),kp.z===1?s.z=e.z:kp.z===-1&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const kp=new He;new He,new He,new He,new He,new He,new He,new He,new He,new He;class Ad{constructor(e){e===void 0&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new go,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,n){n===void 0&&(n=0);const s=this.data;if(!this.aabb.contains(e))return!1;const l=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let c=!1;l.length||(this.subdivide(),c=!0);for(let f=0;f!==8;f++)if(l[f].insert(e,t,n+1))return!0;c&&(l.length=0)}return s.push(t),!0}subdivide(){const e=this.aabb,t=e.lowerBound,n=e.upperBound,s=this.children;s.push(new Ad({aabb:new go({lowerBound:new He(0,0,0)})}),new Ad({aabb:new go({lowerBound:new He(1,0,0)})}),new Ad({aabb:new go({lowerBound:new He(1,1,0)})}),new Ad({aabb:new go({lowerBound:new He(1,1,1)})}),new Ad({aabb:new go({lowerBound:new He(0,1,1)})}),new Ad({aabb:new go({lowerBound:new He(0,0,1)})}),new Ad({aabb:new go({lowerBound:new He(1,0,1)})}),new Ad({aabb:new go({lowerBound:new He(0,1,0)})})),n.vsub(t,s_),s_.scale(.5,s_);const l=this.root||this;for(let c=0;c!==8;c++){const f=s[c];f.root=l;const g=f.aabb.lowerBound;g.x*=s_.x,g.y*=s_.y,g.z*=s_.z,g.vadd(t,g),g.vadd(s_,f.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;const n=[this];for(;n.length;){const s=n.pop();s.aabb.overlaps(e)&&Array.prototype.push.apply(t,s.data),Array.prototype.push.apply(n,s.children)}return t}rayQuery(e,t,n){return e.getAABB(Ow),Ow.toLocalFrame(t,Ow),this.aabbQuery(Ow,n),n}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class Z2 extends Ad{constructor(e,t){t===void 0&&(t={}),super({root:null,aabb:e}),this.maxDepth=t.maxDepth!==void 0?t.maxDepth:8}}const s_=new He,Ow=new go;class Nw extends Ui{constructor(e,t){super({type:Ui.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new go,this.edges=null,this.scale=new He(1,1,1),this.tree=new Z2,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;const n=new go,s=new He,l=new He,c=new He,f=[s,l,c];for(let g=0;g<this.indices.length/3;g++){const y=3*g;this._getUnscaledVertex(this.indices[y],s),this._getUnscaledVertex(this.indices[y+1],l),this._getUnscaledVertex(this.indices[y+2],c),n.setFromPoints(f),e.insert(n,g)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){kw.copy(e);const n=this.scale,s=n.x,l=n.y,c=n.z,f=kw.lowerBound,g=kw.upperBound;return f.x/=s,f.y/=l,f.z/=c,g.x/=s,g.y/=l,g.z/=c,this.tree.aabbQuery(kw,t)}setScale(e){const t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=e.x===e.y&&e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=eL,t=this.normals;for(let n=0;n<this.indices.length/3;n++){const s=3*n,l=this.indices[s],c=this.indices[s+1],f=this.indices[s+2];this.getVertex(l,CR),this.getVertex(c,RR),this.getVertex(f,IR),Nw.computeNormal(RR,CR,IR,e),t[s]=e.x,t[s+1]=e.y,t[s+2]=e.z}}updateEdges(){const e={},t=(s,l)=>{e[s<l?`${s}_${l}`:`${l}_${s}`]=!0};for(let s=0;s<this.indices.length/3;s++){const l=3*s,c=this.indices[l],f=this.indices[l+1],g=this.indices[l+2];t(c,f),t(f,g),t(g,c)}const n=Object.keys(e);this.edges=new Int16Array(2*n.length);for(let s=0;s<n.length;s++){const l=n[s].split("_");this.edges[2*s]=parseInt(l[0],10),this.edges[2*s+1]=parseInt(l[1],10)}}getEdgeVertex(e,t,n){const s=this.edges[2*e+(t?1:0)];this.getVertex(s,n)}getEdgeVector(e,t){const n=tL,s=nL;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,s),s.vsub(n,t)}static computeNormal(e,t,n,s){t.vsub(e,MR),n.vsub(t,TR),TR.cross(MR,s),s.isZero()||s.normalize()}getVertex(e,t){const n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t}_getUnscaledVertex(e,t){const n=3*e,s=this.vertices;return t.set(s[n],s[n+1],s[n+2])}getWorldVertex(e,t,n,s){return this.getVertex(e,s),bs.pointToWorldFrame(t,n,s,s),s}getTriangleVertices(e,t,n,s){const l=3*e;this.getVertex(this.indices[l],t),this.getVertex(this.indices[l+1],n),this.getVertex(this.indices[l+2],s)}getNormal(e,t){const n=3*e;return t.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(e,t){this.computeLocalAABB(o_);const n=o_.upperBound.x-o_.lowerBound.x,s=o_.upperBound.y-o_.lowerBound.y,l=o_.upperBound.z-o_.lowerBound.z;return t.set(1/12*e*(2*s*2*s+2*l*2*l),1/12*e*(2*n*2*n+2*l*2*l),1/12*e*(2*s*2*s+2*n*2*n))}computeLocalAABB(e){const t=e.lowerBound,n=e.upperBound,s=this.vertices.length;this.vertices;const l=iL;this.getVertex(0,l),t.copy(l),n.copy(l);for(let c=0;c!==s;c++)this.getVertex(c,l),l.x<t.x?t.x=l.x:l.x>n.x&&(n.x=l.x),l.y<t.y?t.y=l.y:l.y>n.y&&(n.y=l.y),l.z<t.z?t.z=l.z:l.z>n.z&&(n.z=l.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const t=this.vertices,n=new He;for(let s=0,l=t.length/3;s!==l;s++){this.getVertex(s,n);const c=n.lengthSquared();c>e&&(e=c)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,s){const l=rL,c=sL;l.position=e,l.quaternion=t,this.aabb.toWorldFrame(l,c),n.copy(c.lowerBound),s.copy(c.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,t,n,s,l){e===void 0&&(e=1),t===void 0&&(t=.5),n===void 0&&(n=8),s===void 0&&(s=6),l===void 0&&(l=2*Math.PI);const c=[],f=[];for(let g=0;g<=n;g++)for(let y=0;y<=s;y++){const x=y/s*l,S=g/n*Math.PI*2,C=(e+t*Math.cos(S))*Math.cos(x),L=(e+t*Math.cos(S))*Math.sin(x),B=t*Math.sin(S);c.push(C,L,B)}for(let g=1;g<=n;g++)for(let y=1;y<=s;y++){const x=(s+1)*g+y-1,S=(s+1)*(g-1)+y-1,C=(s+1)*(g-1)+y,L=(s+1)*g+y;f.push(x,S,L),f.push(S,C,L)}return new Nw(c,f)}}const eL=new He,kw=new go,tL=new He,nL=new He,TR=new He,MR=new He,CR=new He,RR=new He,IR=new He,o_=new go,iL=new He,rL=new bs,sL=new go;class oL{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);n!==-1&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class aL extends oL{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const s=this.iterations,l=this.tolerance*this.tolerance,c=this.equations,f=c.length,g=t.bodies,y=g.length,x=e;let S,C,L,B,W,q;if(f!==0)for(let se=0;se!==y;se++)g[se].updateSolveMassProperties();const Z=cL,j=uL,F=lL;Z.length=f,j.length=f,F.length=f;for(let se=0;se!==f;se++){const pe=c[se];F[se]=0,j[se]=pe.computeB(x),Z[se]=1/pe.computeC()}if(f!==0){for(let be=0;be!==y;be++){const Se=g[be],Be=Se.vlambda,Ge=Se.wlambda;Be.set(0,0,0),Ge.set(0,0,0)}for(n=0;n!==s;n++){B=0;for(let be=0;be!==f;be++){const Se=c[be];S=j[be],C=Z[be],q=F[be],W=Se.computeGWlambda(),L=C*(S-W-Se.eps*q),q+L<Se.minForce?L=Se.minForce-q:q+L>Se.maxForce&&(L=Se.maxForce-q),F[be]+=L,B+=L>0?L:-L,Se.addToWlambda(L)}if(B*B<l)break}for(let be=0;be!==y;be++){const Se=g[be],Be=Se.velocity,Ge=Se.angularVelocity;Se.vlambda.vmul(Se.linearFactor,Se.vlambda),Be.vadd(Se.vlambda,Be),Se.wlambda.vmul(Se.angularFactor,Se.wlambda),Ge.vadd(Se.wlambda,Ge)}let se=c.length;const pe=1/x;for(;se--;)c[se].multiplier=F[se]*pe}return n}}const lL=[],cL=[],uL=[];Vi.STATIC;class hL{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class dL extends hL{constructor(){super(...arguments),this.type=He}constructObject(){return new He}}const pL=Ui.types.SPHERE,fL=Ui.types.SPHERE|Ui.types.PLANE,mL=Ui.types.BOX|Ui.types.BOX,gL=Ui.types.SPHERE|Ui.types.BOX,_L=Ui.types.PLANE|Ui.types.BOX,vL=Ui.types.CONVEXPOLYHEDRON,yL=Ui.types.SPHERE|Ui.types.CONVEXPOLYHEDRON,AL=Ui.types.PLANE|Ui.types.CONVEXPOLYHEDRON,bL=Ui.types.BOX|Ui.types.CONVEXPOLYHEDRON,xL=Ui.types.SPHERE|Ui.types.HEIGHTFIELD,wL=Ui.types.BOX|Ui.types.HEIGHTFIELD,EL=Ui.types.CONVEXPOLYHEDRON|Ui.types.HEIGHTFIELD,SL=Ui.types.PARTICLE|Ui.types.SPHERE,TL=Ui.types.PLANE|Ui.types.PARTICLE,ML=Ui.types.BOX|Ui.types.PARTICLE,CL=Ui.types.PARTICLE|Ui.types.CONVEXPOLYHEDRON,RL=Ui.types.CYLINDER,IL=Ui.types.SPHERE|Ui.types.CYLINDER,PL=Ui.types.PLANE|Ui.types.CYLINDER,DL=Ui.types.BOX|Ui.types.CYLINDER,LL=Ui.types.CONVEXPOLYHEDRON|Ui.types.CYLINDER,BL=Ui.types.HEIGHTFIELD|Ui.types.CYLINDER,OL=Ui.types.PARTICLE|Ui.types.CYLINDER,NL=Ui.types.SPHERE|Ui.types.TRIMESH,kL=Ui.types.PLANE|Ui.types.TRIMESH;class UL{get[pL](){return this.sphereSphere}get[fL](){return this.spherePlane}get[mL](){return this.boxBox}get[gL](){return this.sphereBox}get[_L](){return this.planeBox}get[vL](){return this.convexConvex}get[yL](){return this.sphereConvex}get[AL](){return this.planeConvex}get[bL](){return this.boxConvex}get[xL](){return this.sphereHeightfield}get[wL](){return this.boxHeightfield}get[EL](){return this.convexHeightfield}get[SL](){return this.sphereParticle}get[TL](){return this.planeParticle}get[ML](){return this.boxParticle}get[CL](){return this.convexParticle}get[RL](){return this.convexConvex}get[IL](){return this.sphereConvex}get[PL](){return this.planeConvex}get[DL](){return this.boxConvex}get[LL](){return this.convexConvex}get[BL](){return this.heightfieldCylinder}get[OL](){return this.particleCylinder}get[NL](){return this.sphereTrimesh}get[kL](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new dL,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,s,l,c){let f;this.contactPointPool.length?(f=this.contactPointPool.pop(),f.bi=e,f.bj=t):f=new Dw(e,t),f.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&s.collisionResponse;const g=this.currentContactMaterial;f.restitution=g.restitution,f.setSpookParams(g.contactEquationStiffness,g.contactEquationRelaxation,this.world.dt);const y=n.material||e.material,x=s.material||t.material;return y&&x&&y.restitution>=0&&x.restitution>=0&&(f.restitution=y.restitution*x.restitution),f.si=l||n,f.sj=c||s,f}createFrictionEquationsFromContact(e,t){const n=e.bi,s=e.bj,l=e.si,c=e.sj,f=this.world,g=this.currentContactMaterial;let y=g.friction;const x=l.material||n.material,S=c.material||s.material;if(x&&S&&x.friction>=0&&S.friction>=0&&(y=x.friction*S.friction),y>0){const C=y*f.gravity.length();let L=n.invMass+s.invMass;L>0&&(L=1/L);const B=this.frictionEquationPool,W=B.length?B.pop():new ER(n,s,C*L),q=B.length?B.pop():new ER(n,s,C*L);return W.bi=q.bi=n,W.bj=q.bj=s,W.minForce=q.minForce=-C*L,W.maxForce=q.maxForce=C*L,W.ri.copy(e.ri),W.rj.copy(e.rj),q.ri.copy(e.ri),q.rj.copy(e.rj),e.ni.tangents(W.t,q.t),W.setSpookParams(g.frictionEquationStiffness,g.frictionEquationRelaxation,f.dt),q.setSpookParams(g.frictionEquationStiffness,g.frictionEquationRelaxation,f.dt),W.enabled=q.enabled=e.enabled,t.push(W,q),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const n=this.frictionResult[this.frictionResult.length-2],s=this.frictionResult[this.frictionResult.length-1];a_.setZero(),l0.setZero(),c0.setZero();const l=t.bi;t.bj;for(let f=0;f!==e;f++)t=this.result[this.result.length-1-f],t.bi!==l?(a_.vadd(t.ni,a_),l0.vadd(t.ri,l0),c0.vadd(t.rj,c0)):(a_.vsub(t.ni,a_),l0.vadd(t.rj,l0),c0.vadd(t.ri,c0));const c=1/e;l0.scale(c,n.ri),c0.scale(c,n.rj),s.ri.copy(n.ri),s.rj.copy(n.rj),a_.normalize(),a_.tangents(n.t,s.t)}getContacts(e,t,n,s,l,c,f){this.contactPointPool=l,this.frictionEquationPool=f,this.result=s,this.frictionResult=c;const g=VL,y=jL,x=FL,S=zL;for(let C=0,L=e.length;C!==L;C++){const B=e[C],W=t[C];let q=null;B.material&&W.material&&(q=n.getContactMaterial(B.material,W.material)||null);const Z=B.type&Vi.KINEMATIC&&W.type&Vi.STATIC||B.type&Vi.STATIC&&W.type&Vi.KINEMATIC||B.type&Vi.KINEMATIC&&W.type&Vi.KINEMATIC;for(let j=0;j<B.shapes.length;j++){B.quaternion.mult(B.shapeOrientations[j],g),B.quaternion.vmult(B.shapeOffsets[j],x),x.vadd(B.position,x);const F=B.shapes[j];for(let se=0;se<W.shapes.length;se++){W.quaternion.mult(W.shapeOrientations[se],y),W.quaternion.vmult(W.shapeOffsets[se],S),S.vadd(W.position,S);const pe=W.shapes[se];if(!(F.collisionFilterMask&pe.collisionFilterGroup&&pe.collisionFilterMask&F.collisionFilterGroup)||x.distanceTo(S)>F.boundingSphereRadius+pe.boundingSphereRadius)continue;let be=null;F.material&&pe.material&&(be=n.getContactMaterial(F.material,pe.material)||null),this.currentContactMaterial=be||q||n.defaultContactMaterial;const Se=this[F.type|pe.type];if(Se){let Be=!1;Be=F.type<pe.type?Se.call(this,F,pe,x,S,g,y,B,W,F,pe,Z):Se.call(this,pe,F,S,x,y,g,W,B,F,pe,Z),Be&&Z&&(n.shapeOverlapKeeper.set(F.id,pe.id),n.bodyOverlapKeeper.set(B.id,W.id))}}}}}sphereSphere(e,t,n,s,l,c,f,g,y,x,S){if(S)return n.distanceSquared(s)<(e.radius+t.radius)**2;const C=this.createContactEquation(f,g,e,t,y,x);s.vsub(n,C.ni),C.ni.normalize(),C.ri.copy(C.ni),C.rj.copy(C.ni),C.ri.scale(e.radius,C.ri),C.rj.scale(-t.radius,C.rj),C.ri.vadd(n,C.ri),C.ri.vsub(f.position,C.ri),C.rj.vadd(s,C.rj),C.rj.vsub(g.position,C.rj),this.result.push(C),this.createFrictionEquationsFromContact(C,this.frictionResult)}spherePlane(e,t,n,s,l,c,f,g,y,x,S){const C=this.createContactEquation(f,g,e,t,y,x);if(C.ni.set(0,0,1),c.vmult(C.ni,C.ni),C.ni.negate(C.ni),C.ni.normalize(),C.ni.scale(e.radius,C.ri),n.vsub(s,Uw),C.ni.scale(C.ni.dot(Uw),PR),Uw.vsub(PR,C.rj),-Uw.dot(C.ni)<=e.radius){if(S)return!0;const L=C.ri,B=C.rj;L.vadd(n,L),L.vsub(f.position,L),B.vadd(s,B),B.vsub(g.position,B),this.result.push(C),this.createFrictionEquationsFromContact(C,this.frictionResult)}}boxBox(e,t,n,s,l,c,f,g,y,x,S){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,s,l,c,f,g,e,t,S)}sphereBox(e,t,n,s,l,c,f,g,y,x,S){const C=this.v3pool,L=fB;n.vsub(s,Fw),t.getSideNormals(L,c);const B=e.radius;let W=!1;const q=gB,Z=_B,j=vB;let F=null,se=0,pe=0,be=0,Se=null;for(let mt=0,vt=L.length;mt!==vt&&W===!1;mt++){const Qt=hB;Qt.copy(L[mt]);const Ht=Qt.length();Qt.normalize();const Cn=Fw.dot(Qt);if(Cn<Ht+B&&Cn>0){const un=dB,rn=pB;un.copy(L[(mt+1)%3]),rn.copy(L[(mt+2)%3]);const Gn=un.length(),Fn=rn.length();un.normalize(),rn.normalize();const di=Fw.dot(un),bi=Fw.dot(rn);if(di<Gn&&di>-Gn&&bi<Fn&&bi>-Fn){const Bi=Math.abs(Cn-Ht-B);if((Se===null||Bi<Se)&&(Se=Bi,pe=di,be=bi,F=Ht,q.copy(Qt),Z.copy(un),j.copy(rn),se++,S))return!0}}}if(se){W=!0;const mt=this.createContactEquation(f,g,e,t,y,x);q.scale(-B,mt.ri),mt.ni.copy(q),mt.ni.negate(mt.ni),q.scale(F,q),Z.scale(pe,Z),q.vadd(Z,q),j.scale(be,j),q.vadd(j,mt.rj),mt.ri.vadd(n,mt.ri),mt.ri.vsub(f.position,mt.ri),mt.rj.vadd(s,mt.rj),mt.rj.vsub(g.position,mt.rj),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult)}let Be=C.get();const Ge=mB;for(let mt=0;mt!==2&&!W;mt++)for(let vt=0;vt!==2&&!W;vt++)for(let Qt=0;Qt!==2&&!W;Qt++)if(Be.set(0,0,0),mt?Be.vadd(L[0],Be):Be.vsub(L[0],Be),vt?Be.vadd(L[1],Be):Be.vsub(L[1],Be),Qt?Be.vadd(L[2],Be):Be.vsub(L[2],Be),s.vadd(Be,Ge),Ge.vsub(n,Ge),Ge.lengthSquared()<B*B){if(S)return!0;W=!0;const Ht=this.createContactEquation(f,g,e,t,y,x);Ht.ri.copy(Ge),Ht.ri.normalize(),Ht.ni.copy(Ht.ri),Ht.ri.scale(B,Ht.ri),Ht.rj.copy(Be),Ht.ri.vadd(n,Ht.ri),Ht.ri.vsub(f.position,Ht.ri),Ht.rj.vadd(s,Ht.rj),Ht.rj.vsub(g.position,Ht.rj),this.result.push(Ht),this.createFrictionEquationsFromContact(Ht,this.frictionResult)}C.release(Be),Be=null;const Xe=C.get(),Qe=C.get(),at=C.get(),Ke=C.get(),Je=C.get(),ft=L.length;for(let mt=0;mt!==ft&&!W;mt++)for(let vt=0;vt!==ft&&!W;vt++)if(mt%3!=vt%3){L[vt].cross(L[mt],Xe),Xe.normalize(),L[mt].vadd(L[vt],Qe),at.copy(n),at.vsub(Qe,at),at.vsub(s,at);const Qt=at.dot(Xe);Xe.scale(Qt,Ke);let Ht=0;for(;Ht===mt%3||Ht===vt%3;)Ht++;Je.copy(n),Je.vsub(Ke,Je),Je.vsub(Qe,Je),Je.vsub(s,Je);const Cn=Math.abs(Qt),un=Je.length();if(Cn<L[Ht].length()&&un<B){if(S)return!0;W=!0;const rn=this.createContactEquation(f,g,e,t,y,x);Qe.vadd(Ke,rn.rj),rn.rj.copy(rn.rj),Je.negate(rn.ni),rn.ni.normalize(),rn.ri.copy(rn.rj),rn.ri.vadd(s,rn.ri),rn.ri.vsub(n,rn.ri),rn.ri.normalize(),rn.ri.scale(B,rn.ri),rn.ri.vadd(n,rn.ri),rn.ri.vsub(f.position,rn.ri),rn.rj.vadd(s,rn.rj),rn.rj.vsub(g.position,rn.rj),this.result.push(rn),this.createFrictionEquationsFromContact(rn,this.frictionResult)}}C.release(Xe,Qe,at,Ke,Je)}planeBox(e,t,n,s,l,c,f,g,y,x,S){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,s,l,c,f,g,e,t,S)}convexConvex(e,t,n,s,l,c,f,g,y,x,S,C,L){const B=LB;if(!(n.distanceTo(s)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,l,s,c,B,C,L)){const W=[],q=BB;e.clipAgainstHull(n,l,t,s,c,B,-100,100,W);let Z=0;for(let j=0;j!==W.length;j++){if(S)return!0;const F=this.createContactEquation(f,g,e,t,y,x),se=F.ri,pe=F.rj;B.negate(F.ni),W[j].normal.negate(q),q.scale(W[j].depth,q),W[j].point.vadd(q,se),pe.copy(W[j].point),se.vsub(n,se),pe.vsub(s,pe),se.vadd(n,se),se.vsub(f.position,se),pe.vadd(s,pe),pe.vsub(g.position,pe),this.result.push(F),Z++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(F,this.frictionResult)}this.enableFrictionReduction&&Z&&this.createFrictionFromAverage(Z)}}sphereConvex(e,t,n,s,l,c,f,g,y,x,S){const C=this.v3pool;n.vsub(s,yB);const L=t.faceNormals,B=t.faces,W=t.vertices,q=e.radius;let Z=!1;for(let j=0;j!==W.length;j++){const F=W[j],se=wB;c.vmult(F,se),s.vadd(se,se);const pe=xB;if(se.vsub(n,pe),pe.lengthSquared()<q*q){if(S)return!0;Z=!0;const be=this.createContactEquation(f,g,e,t,y,x);return be.ri.copy(pe),be.ri.normalize(),be.ni.copy(be.ri),be.ri.scale(q,be.ri),se.vsub(s,be.rj),be.ri.vadd(n,be.ri),be.ri.vsub(f.position,be.ri),be.rj.vadd(s,be.rj),be.rj.vsub(g.position,be.rj),this.result.push(be),void this.createFrictionEquationsFromContact(be,this.frictionResult)}}for(let j=0,F=B.length;j!==F&&Z===!1;j++){const se=L[j],pe=B[j],be=EB;c.vmult(se,be);const Se=SB;c.vmult(W[pe[0]],Se),Se.vadd(s,Se);const Be=TB;be.scale(-q,Be),n.vadd(Be,Be);const Ge=MB;Be.vsub(Se,Ge);const Xe=Ge.dot(be),Qe=CB;if(n.vsub(Se,Qe),Xe<0&&Qe.dot(be)>0){const at=[];for(let Ke=0,Je=pe.length;Ke!==Je;Ke++){const ft=C.get();c.vmult(W[pe[Ke]],ft),s.vadd(ft,ft),at.push(ft)}if(uB(at,be,n)){if(S)return!0;Z=!0;const Ke=this.createContactEquation(f,g,e,t,y,x);be.scale(-q,Ke.ri),be.negate(Ke.ni);const Je=C.get();be.scale(-Xe,Je);const ft=C.get();be.scale(-q,ft),n.vsub(s,Ke.rj),Ke.rj.vadd(ft,Ke.rj),Ke.rj.vadd(Je,Ke.rj),Ke.rj.vadd(s,Ke.rj),Ke.rj.vsub(g.position,Ke.rj),Ke.ri.vadd(n,Ke.ri),Ke.ri.vsub(f.position,Ke.ri),C.release(Je),C.release(ft),this.result.push(Ke),this.createFrictionEquationsFromContact(Ke,this.frictionResult);for(let mt=0,vt=at.length;mt!==vt;mt++)C.release(at[mt]);return}for(let Ke=0;Ke!==pe.length;Ke++){const Je=C.get(),ft=C.get();c.vmult(W[pe[(Ke+1)%pe.length]],Je),c.vmult(W[pe[(Ke+2)%pe.length]],ft),s.vadd(Je,Je),s.vadd(ft,ft);const mt=AB;ft.vsub(Je,mt);const vt=bB;mt.unit(vt);const Qt=C.get(),Ht=C.get();n.vsub(Je,Ht);const Cn=Ht.dot(vt);vt.scale(Cn,Qt),Qt.vadd(Je,Qt);const un=C.get();if(Qt.vsub(n,un),Cn>0&&Cn*Cn<mt.lengthSquared()&&un.lengthSquared()<q*q){if(S)return!0;const rn=this.createContactEquation(f,g,e,t,y,x);Qt.vsub(s,rn.rj),Qt.vsub(n,rn.ni),rn.ni.normalize(),rn.ni.scale(q,rn.ri),rn.rj.vadd(s,rn.rj),rn.rj.vsub(g.position,rn.rj),rn.ri.vadd(n,rn.ri),rn.ri.vsub(f.position,rn.ri),this.result.push(rn),this.createFrictionEquationsFromContact(rn,this.frictionResult);for(let Gn=0,Fn=at.length;Gn!==Fn;Gn++)C.release(at[Gn]);return C.release(Je),C.release(ft),C.release(Qt),C.release(un),void C.release(Ht)}C.release(Je),C.release(ft),C.release(Qt),C.release(un),C.release(Ht)}for(let Ke=0,Je=at.length;Ke!==Je;Ke++)C.release(at[Ke])}}}planeConvex(e,t,n,s,l,c,f,g,y,x,S){const C=RB,L=IB;L.set(0,0,1),l.vmult(L,L);let B=0;const W=PB;for(let q=0;q!==t.vertices.length;q++)if(C.copy(t.vertices[q]),c.vmult(C,C),s.vadd(C,C),C.vsub(n,W),L.dot(W)<=0){if(S)return!0;const Z=this.createContactEquation(f,g,e,t,y,x),j=DB;L.scale(L.dot(W),j),C.vsub(j,j),j.vsub(n,Z.ri),Z.ni.copy(L),C.vsub(s,Z.rj),Z.ri.vadd(n,Z.ri),Z.ri.vsub(f.position,Z.ri),Z.rj.vadd(s,Z.rj),Z.rj.vsub(g.position,Z.rj),this.result.push(Z),B++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Z,this.frictionResult)}this.enableFrictionReduction&&B&&this.createFrictionFromAverage(B)}boxConvex(e,t,n,s,l,c,f,g,y,x,S){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,s,l,c,f,g,e,t,S)}sphereHeightfield(e,t,n,s,l,c,f,g,y,x,S){const C=t.data,L=e.radius,B=t.elementSize,W=QB,q=WB;bs.pointToLocalFrame(s,c,n,q);let Z=Math.floor((q.x-L)/B)-1,j=Math.ceil((q.x+L)/B)+1,F=Math.floor((q.y-L)/B)-1,se=Math.ceil((q.y+L)/B)+1;if(j<0||se<0||Z>C.length||F>C[0].length)return;Z<0&&(Z=0),j<0&&(j=0),F<0&&(F=0),se<0&&(se=0),Z>=C.length&&(Z=C.length-1),j>=C.length&&(j=C.length-1),se>=C[0].length&&(se=C[0].length-1),F>=C[0].length&&(F=C[0].length-1);const pe=[];t.getRectMinMax(Z,F,j,se,pe);const be=pe[0],Se=pe[1];if(q.z-L>Se||q.z+L<be)return;const Be=this.result;for(let Ge=Z;Ge<j;Ge++)for(let Xe=F;Xe<se;Xe++){const Qe=Be.length;let at=!1;if(t.getConvexTrianglePillar(Ge,Xe,!1),bs.pointToWorldFrame(s,c,t.pillarOffset,W),n.distanceTo(W)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(at=this.sphereConvex(e,t.pillarConvex,n,W,l,c,f,g,e,t,S)),S&&at||(t.getConvexTrianglePillar(Ge,Xe,!0),bs.pointToWorldFrame(s,c,t.pillarOffset,W),n.distanceTo(W)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(at=this.sphereConvex(e,t.pillarConvex,n,W,l,c,f,g,e,t,S)),S&&at))return!0;if(Be.length-Qe>2)return}}boxHeightfield(e,t,n,s,l,c,f,g,y,x,S){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,s,l,c,f,g,e,t,S)}convexHeightfield(e,t,n,s,l,c,f,g,y,x,S){const C=t.data,L=t.elementSize,B=e.boundingSphereRadius,W=GB,q=HB,Z=jB;bs.pointToLocalFrame(s,c,n,Z);let j=Math.floor((Z.x-B)/L)-1,F=Math.ceil((Z.x+B)/L)+1,se=Math.floor((Z.y-B)/L)-1,pe=Math.ceil((Z.y+B)/L)+1;if(F<0||pe<0||j>C.length||se>C[0].length)return;j<0&&(j=0),F<0&&(F=0),se<0&&(se=0),pe<0&&(pe=0),j>=C.length&&(j=C.length-1),F>=C.length&&(F=C.length-1),pe>=C[0].length&&(pe=C[0].length-1),se>=C[0].length&&(se=C[0].length-1);const be=[];t.getRectMinMax(j,se,F,pe,be);const Se=be[0],Be=be[1];if(!(Z.z-B>Be||Z.z+B<Se))for(let Ge=j;Ge<F;Ge++)for(let Xe=se;Xe<pe;Xe++){let Qe=!1;if(t.getConvexTrianglePillar(Ge,Xe,!1),bs.pointToWorldFrame(s,c,t.pillarOffset,W),n.distanceTo(W)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(Qe=this.convexConvex(e,t.pillarConvex,n,W,l,c,f,g,null,null,S,q,null)),S&&Qe||(t.getConvexTrianglePillar(Ge,Xe,!0),bs.pointToWorldFrame(s,c,t.pillarOffset,W),n.distanceTo(W)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(Qe=this.convexConvex(e,t.pillarConvex,n,W,l,c,f,g,null,null,S,q,null)),S&&Qe))return!0}}sphereParticle(e,t,n,s,l,c,f,g,y,x,S){const C=UB;if(C.set(0,0,1),s.vsub(n,C),C.lengthSquared()<=e.radius*e.radius){if(S)return!0;const L=this.createContactEquation(g,f,t,e,y,x);C.normalize(),L.rj.copy(C),L.rj.scale(e.radius,L.rj),L.ni.copy(C),L.ni.negate(L.ni),L.ri.set(0,0,0),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}}planeParticle(e,t,n,s,l,c,f,g,y,x,S){const C=OB;C.set(0,0,1),f.quaternion.vmult(C,C);const L=NB;if(s.vsub(f.position,L),C.dot(L)<=0){if(S)return!0;const B=this.createContactEquation(g,f,t,e,y,x);B.ni.copy(C),B.ni.negate(B.ni),B.ri.set(0,0,0);const W=kB;C.scale(C.dot(s),W),s.vsub(W,W),B.rj.copy(W),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult)}}boxParticle(e,t,n,s,l,c,f,g,y,x,S){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,s,l,c,f,g,e,t,S)}convexParticle(e,t,n,s,l,c,f,g,y,x,S){let C=-1;const L=zB,B=VB;let W=null;const q=FB;if(q.copy(s),q.vsub(n,q),l.conjugate(DR),DR.vmult(q,q),e.pointIsInside(q)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,l),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(l);for(let Z=0,j=e.faces.length;Z!==j;Z++){const F=[e.worldVertices[e.faces[Z][0]]],se=e.worldFaceNormals[Z];s.vsub(F[0],LR);const pe=-se.dot(LR);if(W===null||Math.abs(pe)<Math.abs(W)){if(S)return!0;W=pe,C=Z,L.copy(se)}}if(C!==-1){const Z=this.createContactEquation(g,f,t,e,y,x);L.scale(W,B),B.vadd(s,B),B.vsub(n,B),Z.rj.copy(B),L.negate(Z.ni),Z.ri.set(0,0,0);const j=Z.ri,F=Z.rj;j.vadd(s,j),j.vsub(g.position,j),F.vadd(n,F),F.vsub(f.position,F),this.result.push(Z),this.createFrictionEquationsFromContact(Z,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,s,l,c,f,g,y,x,S){return this.convexHeightfield(t,e,s,n,c,l,g,f,y,x,S)}particleCylinder(e,t,n,s,l,c,f,g,y,x,S){return this.convexParticle(t,e,s,n,c,l,g,f,y,x,S)}sphereTrimesh(e,t,n,s,l,c,f,g,y,x,S){const C=KL,L=$L,B=JL,W=ZL,q=eB,Z=tB,j=sB,F=YL,se=XL,pe=oB;bs.pointToLocalFrame(s,c,n,q);const be=e.radius;j.lowerBound.set(q.x-be,q.y-be,q.z-be),j.upperBound.set(q.x+be,q.y+be,q.z+be),t.getTrianglesInAABB(j,pe);const Se=qL,Be=e.radius*e.radius;for(let Ke=0;Ke<pe.length;Ke++)for(let Je=0;Je<3;Je++)if(t.getVertex(t.indices[3*pe[Ke]+Je],Se),Se.vsub(q,se),se.lengthSquared()<=Be){if(F.copy(Se),bs.pointToWorldFrame(s,c,F,Se),Se.vsub(n,se),S)return!0;let ft=this.createContactEquation(f,g,e,t,y,x);ft.ni.copy(se),ft.ni.normalize(),ft.ri.copy(ft.ni),ft.ri.scale(e.radius,ft.ri),ft.ri.vadd(n,ft.ri),ft.ri.vsub(f.position,ft.ri),ft.rj.copy(Se),ft.rj.vsub(g.position,ft.rj),this.result.push(ft),this.createFrictionEquationsFromContact(ft,this.frictionResult)}for(let Ke=0;Ke<pe.length;Ke++)for(let Je=0;Je<3;Je++){t.getVertex(t.indices[3*pe[Ke]+Je],C),t.getVertex(t.indices[3*pe[Ke]+(Je+1)%3],L),L.vsub(C,B),q.vsub(L,Z);const ft=Z.dot(B);q.vsub(C,Z);let mt=Z.dot(B);if(mt>0&&ft<0&&(q.vsub(C,Z),W.copy(B),W.normalize(),mt=Z.dot(W),W.scale(mt,Z),Z.vadd(C,Z),Z.distanceTo(q)<e.radius)){if(S)return!0;const vt=this.createContactEquation(f,g,e,t,y,x);Z.vsub(q,vt.ni),vt.ni.normalize(),vt.ni.scale(e.radius,vt.ri),vt.ri.vadd(n,vt.ri),vt.ri.vsub(f.position,vt.ri),bs.pointToWorldFrame(s,c,Z,Z),Z.vsub(g.position,vt.rj),bs.vectorToWorldFrame(c,vt.ni,vt.ni),bs.vectorToWorldFrame(c,vt.ri,vt.ri),this.result.push(vt),this.createFrictionEquationsFromContact(vt,this.frictionResult)}}const Ge=nB,Xe=iB,Qe=rB,at=QL;for(let Ke=0,Je=pe.length;Ke!==Je;Ke++){t.getTriangleVertices(pe[Ke],Ge,Xe,Qe),t.getNormal(pe[Ke],at),q.vsub(Ge,Z);let ft=Z.dot(at);if(at.scale(ft,Z),q.vsub(Z,Z),ft=Z.distanceTo(q),aa.pointInTriangle(Z,Ge,Xe,Qe)&&ft<e.radius){if(S)return!0;let mt=this.createContactEquation(f,g,e,t,y,x);Z.vsub(q,mt.ni),mt.ni.normalize(),mt.ni.scale(e.radius,mt.ri),mt.ri.vadd(n,mt.ri),mt.ri.vsub(f.position,mt.ri),bs.pointToWorldFrame(s,c,Z,Z),Z.vsub(g.position,mt.rj),bs.vectorToWorldFrame(c,mt.ni,mt.ni),bs.vectorToWorldFrame(c,mt.ri,mt.ri),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult)}}pe.length=0}planeTrimesh(e,t,n,s,l,c,f,g,y,x,S){const C=new He,L=GL;L.set(0,0,1),l.vmult(L,L);for(let B=0;B<t.vertices.length/3;B++){t.getVertex(B,C);const W=new He;W.copy(C),bs.pointToWorldFrame(s,c,W,C);const q=HL;if(C.vsub(n,q),L.dot(q)<=0){if(S)return!0;const Z=this.createContactEquation(f,g,e,t,y,x);Z.ni.copy(L);const j=WL;L.scale(q.dot(L),j),C.vsub(j,j),Z.ri.copy(j),Z.ri.vsub(f.position,Z.ri),Z.rj.copy(C),Z.rj.vsub(g.position,Z.rj),this.result.push(Z),this.createFrictionEquationsFromContact(Z,this.frictionResult)}}}}const a_=new He,l0=new He,c0=new He,FL=new He,zL=new He,VL=new xo,jL=new xo,GL=new He,HL=new He,WL=new He,QL=new He,XL=new He;new He;const qL=new He,YL=new He,KL=new He,$L=new He,JL=new He,ZL=new He,eB=new He,tB=new He,nB=new He,iB=new He,rB=new He,sB=new go,oB=[],Uw=new He,PR=new He,aB=new He,lB=new He,cB=new He;function uB(a,e,t){let n=null;const s=a.length;for(let l=0;l!==s;l++){const c=a[l],f=aB;a[(l+1)%s].vsub(c,f);const g=lB;f.cross(e,g);const y=cB;t.vsub(c,y);const x=g.dot(y);if(!(n===null||x>0&&n===!0||x<=0&&n===!1))return!1;n===null&&(n=x>0)}return!0}const Fw=new He,hB=new He,dB=new He,pB=new He,fB=[new He,new He,new He,new He,new He,new He],mB=new He,gB=new He,_B=new He,vB=new He,yB=new He,AB=new He,bB=new He,xB=new He,wB=new He,EB=new He,SB=new He,TB=new He,MB=new He,CB=new He;new He,new He;const RB=new He,IB=new He,PB=new He,DB=new He,LB=new He,BB=new He,OB=new He,NB=new He,kB=new He,UB=new He,DR=new xo,FB=new He;new He;const zB=new He,LR=new He,VB=new He,jB=new He,GB=new He,HB=[0],WB=new He,QB=new He;class BR{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),s=this.current;let l=0;for(;n>s[l];)l++;if(n!==s[l]){for(let c=s.length-1;c>=l;c--)s[c+1]=s[c];s[l]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,s=this.previous,l=n.length,c=s.length;let f=0;for(let g=0;g<l;g++){let y=!1;const x=n[g];for(;x>s[f];)f++;y=x===s[f],y||OR(e,x)}f=0;for(let g=0;g<c;g++){let y=!1;const x=s[g];for(;x>n[f];)f++;y=n[f]===x,y||OR(t,x)}}}function OR(a,e){a.push((4294901760&e)>>16,65535&e)}const CS=(a,e)=>a<e?`${a}-${e}`:`${e}-${a}`;class XB{constructor(){this.data={keys:[]}}get(e,t){const n=CS(e,t);return this.data[n]}set(e,t,n){const s=CS(e,t);this.get(e,t)||this.data.keys.push(s),this.data[s]=n}delete(e,t){const n=CS(e,t),s=this.data.keys.indexOf(n);s!==-1&&this.data.keys.splice(s,1),delete this.data[n]}reset(){const e=this.data,t=e.keys;for(;t.length>0;)delete e[t.pop()]}}class qB extends oR{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new He,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new w2,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new aL,this.constraints=[],this.narrowphase=new UL(this),this.collisionMatrix=new sR,this.collisionMatrixPrevious=new sR,this.bodyOverlapKeeper=new BR,this.shapeOverlapKeeper=new BR,this.contactmaterials=[],this.contactMaterialTable=new XB,this.defaultMaterial=new Bw("default"),this.defaultContactMaterial=new Lw(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof Mw?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,s){return n===void 0&&(n={}),n.mode=aa.ALL,n.from=e,n.to=t,n.callback=s,RS.intersectWorld(this,n)}raycastAny(e,t,n,s){return n===void 0&&(n={}),n.mode=aa.ANY,n.from=e,n.to=t,n.result=s,RS.intersectWorld(this,n)}raycastClosest(e,t,n,s){return n===void 0&&(n={}),n.mode=aa.CLOSEST,n.from=e,n.to=t,n.result=s,RS.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof Vi&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,s=n.indexOf(e);if(s!==-1){n.splice(s,1);for(let l=0;l!==n.length;l++)n[l].index=l;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const s=t[n].shapes;for(let l=0;l<s.length;l++){const c=s[l];if(c.id===e)return c}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);t!==-1&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){e===void 0&&(e=1/60),t===void 0&&(t=10);const n=xa.now()/1e3;if(this.lastCallTime){const s=n-this.lastCallTime;this.step(e,s,t)}else this.step(e,void 0,t);this.lastCallTime=n}step(e,t,n){if(n===void 0&&(n=10),t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const s=xa.now();let l=0;for(;this.accumulator>=e&&l<n&&(this.internalStep(e),this.accumulator-=e,l++,!(xa.now()-s>1e3*e)););this.accumulator=this.accumulator%e;const c=this.accumulator/e;for(let f=0;f!==this.bodies.length;f++){const g=this.bodies[f];g.previousPosition.lerp(g.position,c,g.interpolatedPosition),g.previousQuaternion.slerp(g.quaternion,c,g.interpolatedQuaternion),g.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=ZB,s=eO,l=this.bodies.length,c=this.bodies,f=this.solver,g=this.gravity,y=this.doProfiling,x=this.profile,S=Vi.DYNAMIC;let C=-1/0;const L=this.constraints,B=JB;g.length();const W=g.x,q=g.y,Z=g.z;let j=0;for(y&&(C=xa.now()),j=0;j!==l;j++){const at=c[j];if(at.type===S){const Ke=at.force,Je=at.mass;Ke.x+=Je*W,Ke.y+=Je*q,Ke.z+=Je*Z}}for(let at=0,Ke=this.subsystems.length;at!==Ke;at++)this.subsystems[at].update();y&&(C=xa.now()),n.length=0,s.length=0,this.broadphase.collisionPairs(this,n,s),y&&(x.broadphase=xa.now()-C);let F=L.length;for(j=0;j!==F;j++){const at=L[j];if(!at.collideConnected)for(let Ke=n.length-1;Ke>=0;Ke-=1)(at.bodyA===n[Ke]&&at.bodyB===s[Ke]||at.bodyB===n[Ke]&&at.bodyA===s[Ke])&&(n.splice(Ke,1),s.splice(Ke,1))}this.collisionMatrixTick(),y&&(C=xa.now());const se=$B,pe=t.length;for(j=0;j!==pe;j++)se.push(t[j]);t.length=0;const be=this.frictionEquations.length;for(j=0;j!==be;j++)B.push(this.frictionEquations[j]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,s,this,t,se,this.frictionEquations,B),y&&(x.narrowphase=xa.now()-C),y&&(C=xa.now()),j=0;j<this.frictionEquations.length;j++)f.addEquation(this.frictionEquations[j]);const Se=t.length;for(let at=0;at!==Se;at++){const Ke=t[at],Je=Ke.bi,ft=Ke.bj,mt=Ke.si,vt=Ke.sj;let Qt;Qt=Je.material&&ft.material&&this.getContactMaterial(Je.material,ft.material)||this.defaultContactMaterial,Qt.friction,Je.material&&ft.material&&(Je.material.friction>=0&&ft.material.friction>=0&&(Je.material.friction,ft.material.friction),Je.material.restitution>=0&&ft.material.restitution>=0&&(Ke.restitution=Je.material.restitution*ft.material.restitution)),f.addEquation(Ke),Je.allowSleep&&Je.type===Vi.DYNAMIC&&Je.sleepState===Vi.SLEEPING&&ft.sleepState===Vi.AWAKE&&ft.type!==Vi.STATIC&&ft.velocity.lengthSquared()+ft.angularVelocity.lengthSquared()>=2*ft.sleepSpeedLimit**2&&(Je.wakeUpAfterNarrowphase=!0),ft.allowSleep&&ft.type===Vi.DYNAMIC&&ft.sleepState===Vi.SLEEPING&&Je.sleepState===Vi.AWAKE&&Je.type!==Vi.STATIC&&Je.velocity.lengthSquared()+Je.angularVelocity.lengthSquared()>=2*Je.sleepSpeedLimit**2&&(ft.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(Je,ft,!0),this.collisionMatrixPrevious.get(Je,ft)||(wA.body=ft,wA.contact=Ke,Je.dispatchEvent(wA),wA.body=Je,ft.dispatchEvent(wA)),this.bodyOverlapKeeper.set(Je.id,ft.id),this.shapeOverlapKeeper.set(mt.id,vt.id)}for(this.emitContactEvents(),y&&(x.makeContactConstraints=xa.now()-C,C=xa.now()),j=0;j!==l;j++){const at=c[j];at.wakeUpAfterNarrowphase&&(at.wakeUp(),at.wakeUpAfterNarrowphase=!1)}for(F=L.length,j=0;j!==F;j++){const at=L[j];at.update();for(let Ke=0,Je=at.equations.length;Ke!==Je;Ke++){const ft=at.equations[Ke];f.addEquation(ft)}}f.solve(e,this),y&&(x.solve=xa.now()-C),f.removeAllEquations();const Be=Math.pow;for(j=0;j!==l;j++){const at=c[j];if(at.type&S){const Ke=Be(1-at.linearDamping,e),Je=at.velocity;Je.scale(Ke,Je);const ft=at.angularVelocity;if(ft){const mt=Be(1-at.angularDamping,e);ft.scale(mt,ft)}}}this.dispatchEvent(KB),y&&(C=xa.now());const Ge=this.stepnumber%(this.quatNormalizeSkip+1)==0,Xe=this.quatNormalizeFast;for(j=0;j!==l;j++)c[j].integrate(e,Ge,Xe);this.clearForces(),this.broadphase.dirty=!0,y&&(x.integrate=xa.now()-C),this.stepnumber+=1,this.dispatchEvent(YB);let Qe=!0;if(this.allowSleep)for(Qe=!1,j=0;j!==l;j++){const at=c[j];at.sleepTick(this.time),at.sleepState!==Vi.SLEEPING&&(Qe=!0)}this.hasActiveBodies=Qe}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(Up,Fp),e){for(let l=0,c=Up.length;l<c;l+=2)EA.bodyA=this.getBodyById(Up[l]),EA.bodyB=this.getBodyById(Up[l+1]),this.dispatchEvent(EA);EA.bodyA=EA.bodyB=null}if(t){for(let l=0,c=Fp.length;l<c;l+=2)SA.bodyA=this.getBodyById(Fp[l]),SA.bodyB=this.getBodyById(Fp[l+1]),this.dispatchEvent(SA);SA.bodyA=SA.bodyB=null}Up.length=Fp.length=0;const n=this.hasAnyEventListener("beginShapeContact"),s=this.hasAnyEventListener("endShapeContact");if((n||s)&&this.shapeOverlapKeeper.getDiff(Up,Fp),n){for(let l=0,c=Up.length;l<c;l+=2){const f=this.getShapeById(Up[l]),g=this.getShapeById(Up[l+1]);zp.shapeA=f,zp.shapeB=g,f&&(zp.bodyA=f.body),g&&(zp.bodyB=g.body),this.dispatchEvent(zp)}zp.bodyA=zp.bodyB=zp.shapeA=zp.shapeB=null}if(s){for(let l=0,c=Fp.length;l<c;l+=2){const f=this.getShapeById(Fp[l]),g=this.getShapeById(Fp[l+1]);Vp.shapeA=f,Vp.shapeB=g,f&&(Vp.bodyA=f.body),g&&(Vp.bodyB=g.body),this.dispatchEvent(Vp)}Vp.bodyA=Vp.bodyB=Vp.shapeA=Vp.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const s=e[n];s.force,s.torque,s.force.set(0,0,0),s.torque.set(0,0,0)}}}new go;const RS=new aa,xa=globalThis.performance||{};if(!xa.now){let a=Date.now();xa.timing&&xa.timing.navigationStart&&(a=xa.timing.navigationStart),xa.now=()=>Date.now()-a}new He;const YB={type:"postStep"},KB={type:"preStep"},wA={type:Vi.COLLIDE_EVENT_NAME,body:null,contact:null},$B=[],JB=[],ZB=[],eO=[],Up=[],Fp=[],EA={type:"beginContact",bodyA:null,bodyB:null},SA={type:"endContact",bodyA:null,bodyB:null},zp={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Vp={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var tO=function(){var a,e,t,n,s=0,l=new i.Pa4;function c(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new x,this.unassigned=new x,this.vertices=[]}function f(){this.normal=new i.Pa4,this.midpoint=new i.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=s,this.edge=null}function g(S,C){this.vertex=S,this.prev=null,this.next=null,this.twin=null,this.face=C}function y(S,C){this.point=S,this.index=C,this.prev=null,this.next=null,this.face=null}function x(){this.head=null,this.tail=null}return Object.assign(c.prototype,{toJSON:function(){const S=this.faces.map(q=>q.toArray()),C=Array.from(new Set(S.flat())).sort(),L=[];for(let q=0;q<C.length;q++)L.push(this.vertices[C[q]].point.x,this.vertices[C[q]].point.y,this.vertices[C[q]].point.z);const B=new Map;for(let q=0;q<C.length;q++)B.set(C[q],q);const W=[];for(let q=0;q<S.length;q++)W.push([B.get(S[q][0]),B.get(S[q][1]),B.get(S[q][2])]);return[L,W]},setFromPoints:function(S){Array.isArray(S)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),S.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var C=0,L=S.length;C<L;C++)this.vertices.push(new y(S[C],C));return this.compute(),this},setFromObject:function(S){var C=[];return S.updateMatrixWorld(!0),S.traverse(function(L){var B,W,q,Z=L.geometry;if(Z!==void 0&&(Z.isGeometry&&(Z=Z.toBufferGeometry?Z.toBufferGeometry():new BufferGeometry().fromGeometry(Z)),Z.isBufferGeometry)){var j=Z.attributes.position;if(j!==void 0)for(B=0,W=j.count;B<W;B++)(q=new i.Pa4).fromBufferAttribute(j,B).applyMatrix4(L.matrixWorld),C.push(q)}}),this.setFromPoints(C)},containsPoint:function(S){for(var C=this.faces,L=0,B=C.length;L<B;L++)if(C[L].distanceToPoint(S)>this.tolerance)return!1;return!0},intersectRay:function(S,C){for(var L=this.faces,B=-1/0,W=1/0,q=0,Z=L.length;q<Z;q++){var j=L[q],F=j.distanceToPoint(S.origin),se=j.normal.dot(S.direction);if(F>0&&se>=0)return null;var pe=se!==0?-F/se:0;if(!(pe<=0)&&(se>0?W=Math.min(pe,W):B=Math.max(pe,B),B>W))return null}return B!==-1/0?S.at(B,C):S.at(W,C),C},intersectsRay:function(S){return this.intersectRay(S,l)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(S,C){return S.face=C,C.outside===null?this.assigned.append(S):this.assigned.insertBefore(C.outside,S),C.outside=S,this},removeVertexFromFace:function(S,C){return S===C.outside&&(S.next!==null&&S.next.face===C?C.outside=S.next:C.outside=null),this.assigned.remove(S),this},removeAllVerticesFromFace:function(S){if(S.outside!==null){for(var C=S.outside,L=S.outside;L.next!==null&&L.next.face===S;)L=L.next;return this.assigned.removeSubList(C,L),C.prev=L.next=null,S.outside=null,C}},deleteFaceVertices:function(S,C){var L=this.removeAllVerticesFromFace(S);if(L!==void 0)if(C===void 0)this.unassigned.appendChain(L);else{var B=L;do{var W=B.next;C.distanceToPoint(B.point)>this.tolerance?this.addVertexToFace(B,C):this.unassigned.append(B),B=W}while(B!==null)}return this},resolveUnassignedPoints:function(S){if(this.unassigned.isEmpty()===!1){var C=this.unassigned.first();do{for(var L=C.next,B=this.tolerance,W=null,q=0;q<S.length;q++){var Z=S[q];if(Z.mark===s){var j=Z.distanceToPoint(C.point);if(j>B&&(B=j,W=Z),B>1e3*this.tolerance)break}}W!==null&&this.addVertexToFace(C,W),C=L}while(C!==null)}return this},computeExtremes:function(){var S,C,L,B=new i.Pa4,W=new i.Pa4,q=[],Z=[];for(S=0;S<3;S++)q[S]=Z[S]=this.vertices[0];for(B.copy(this.vertices[0].point),W.copy(this.vertices[0].point),S=0,C=this.vertices.length;S<C;S++){var j=this.vertices[S],F=j.point;for(L=0;L<3;L++)F.getComponent(L)<B.getComponent(L)&&(B.setComponent(L,F.getComponent(L)),q[L]=j);for(L=0;L<3;L++)F.getComponent(L)>W.getComponent(L)&&(W.setComponent(L,F.getComponent(L)),Z[L]=j)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(B.x),Math.abs(W.x))+Math.max(Math.abs(B.y),Math.abs(W.y))+Math.max(Math.abs(B.z),Math.abs(W.z))),{min:q,max:Z}},computeInitialHull:function(){a===void 0&&(a=new i.Zzh,e=new i.JOQ,t=new i.Pa4);var S,C,L,B,W,q,Z,j,F,se=this.vertices,pe=this.computeExtremes(),be=pe.min,Se=pe.max,Be=0,Ge=0;for(q=0;q<3;q++)(F=Se[q].point.getComponent(q)-be[q].point.getComponent(q))>Be&&(Be=F,Ge=q);for(C=be[Ge],L=Se[Ge],Be=0,a.set(C.point,L.point),q=0,Z=this.vertices.length;q<Z;q++)(S=se[q])!==C&&S!==L&&(a.closestPointToPoint(S.point,!0,t),(F=t.distanceToSquared(S.point))>Be&&(Be=F,B=S));for(Be=-1,e.setFromCoplanarPoints(C.point,L.point,B.point),q=0,Z=this.vertices.length;q<Z;q++)(S=se[q])!==C&&S!==L&&S!==B&&(F=Math.abs(e.distanceToPoint(S.point)))>Be&&(Be=F,W=S);var Xe=[];if(e.distanceToPoint(W.point)<0)for(Xe.push(f.create(C,L,B),f.create(W,L,C),f.create(W,B,L),f.create(W,C,B)),q=0;q<3;q++)j=(q+1)%3,Xe[q+1].getEdge(2).setTwin(Xe[0].getEdge(j)),Xe[q+1].getEdge(1).setTwin(Xe[j+1].getEdge(0));else for(Xe.push(f.create(C,B,L),f.create(W,C,L),f.create(W,L,B),f.create(W,B,C)),q=0;q<3;q++)j=(q+1)%3,Xe[q+1].getEdge(2).setTwin(Xe[0].getEdge((3-q)%3)),Xe[q+1].getEdge(0).setTwin(Xe[j+1].getEdge(1));for(q=0;q<4;q++)this.faces.push(Xe[q]);for(q=0,Z=se.length;q<Z;q++)if((S=se[q])!==C&&S!==L&&S!==B&&S!==W){Be=this.tolerance;var Qe=null;for(j=0;j<4;j++)(F=this.faces[j].distanceToPoint(S.point))>Be&&(Be=F,Qe=this.faces[j]);Qe!==null&&this.addVertexToFace(S,Qe)}return this},reindexFaces:function(){for(var S=[],C=0;C<this.faces.length;C++){var L=this.faces[C];L.mark===s&&S.push(L)}return this.faces=S,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var S,C=0,L=this.assigned.first().face,B=L.outside;do{var W=L.distanceToPoint(B.point);W>C&&(C=W,S=B),B=B.next}while(B!==null&&B.face===L);return S}},computeHorizon:function(S,C,L,B){var W;this.deleteFaceVertices(L),L.mark=1,W=C===null?C=L.getEdge(0):C.next;do{var q=W.twin,Z=q.face;Z.mark===s&&(Z.distanceToPoint(S)>this.tolerance?this.computeHorizon(S,q,Z,B):B.push(W)),W=W.next}while(W!==C);return this},addAdjoiningFace:function(S,C){var L=f.create(S,C.tail(),C.head());return this.faces.push(L),L.getEdge(-1).setTwin(C.twin),L.getEdge(0)},addNewFaces:function(S,C){this.newFaces=[];for(var L=null,B=null,W=0;W<C.length;W++){var q=C[W],Z=this.addAdjoiningFace(S,q);L===null?L=Z:Z.next.setTwin(B),this.newFaces.push(Z.face),B=Z}return L.next.setTwin(B),this},addVertexToHull:function(S){var C=[];return this.unassigned.clear(),this.removeVertexFromFace(S,S.face),this.computeHorizon(S.point,null,S.face,C),this.addNewFaces(S,C),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var S;for(this.computeInitialHull();(S=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(S);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(f,{create:function(S,C,L){var B=new f,W=new g(S,B),q=new g(C,B),Z=new g(L,B);return W.next=Z.prev=q,q.next=W.prev=Z,Z.next=q.prev=W,B.edge=W,B.compute()}}),Object.assign(f.prototype,{toArray:function(){const S=[];let C=this.edge;do S.push(C.head().index),C=C.next;while(C!==this.edge);return S},getEdge:function(S){for(var C=this.edge;S>0;)C=C.next,S--;for(;S<0;)C=C.prev,S++;return C},compute:function(){n===void 0&&(n=new i.CJI);var S=this.edge.tail(),C=this.edge.head(),L=this.edge.next.head();return n.set(S.point,C.point,L.point),n.getNormal(this.normal),n.getMidpoint(this.midpoint),this.area=n.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(S){return this.normal.dot(S)-this.constant}}),Object.assign(g.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var S=this.head(),C=this.tail();return C!==null?C.point.distanceTo(S.point):-1},lengthSquared:function(){var S=this.head(),C=this.tail();return C!==null?C.point.distanceToSquared(S.point):-1},setTwin:function(S){return this.twin=S,S.twin=this,this}}),Object.assign(x.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(S,C){return C.prev=S.prev,C.next=S,C.prev===null?this.head=C:C.prev.next=C,S.prev=C,this},insertAfter:function(S,C){return C.prev=S,C.next=S.next,C.next===null?this.tail=C:C.next.prev=C,S.next=C,this},append:function(S){return this.head===null?this.head=S:this.tail.next=S,S.prev=this.tail,S.next=null,this.tail=S,this},appendChain:function(S){for(this.head===null?this.head=S:this.tail.next=S,S.prev=this.tail;S.next!==null;)S=S.next;return this.tail=S,this},remove:function(S){return S.prev===null?this.head=S.next:S.prev.next=S.next,S.next===null?this.tail=S.prev:S.next.prev=S.prev,this},removeSubList:function(S,C){return S.prev===null?this.head=C.next:S.prev.next=C.next,C.next===null?this.tail=S.prev:C.next.prev=S.prev,this},isEmpty:function(){return this.head===null}}),c}();const nO=new i.Pa4,zw=new i.Pa4,iO=new i._fP;function Vw(a){const e=function(s){const l=[];return s.traverse(function(c){c.isMesh&&l.push(c)}),l}(a);if(e.length===0)return null;if(e.length===1)return NR(e[0]);let t;const n=[];for(;t=e.pop();)n.push(rO(NR(t)));return function(s){let l=0;for(let g=0;g<s.length;g++){const y=s[g].attributes.position;y&&y.itemSize===3&&(l+=y.count)}const c=new Float32Array(3*l);let f=0;for(let g=0;g<s.length;g++){const y=s[g].attributes.position;if(y&&y.itemSize===3)for(let x=0;x<y.count;x++)c[f++]=y.getX(x),c[f++]=y.getY(x),c[f++]=y.getZ(x)}return new i.u9r().setAttribute("position",new i.TlE(c,3))}(n)}function NR(a){let e=a.geometry;return e=e.toBufferGeometry?e.toBufferGeometry():e.clone(),a.updateMatrixWorld(),a.matrixWorld.decompose(nO,iO,zw),e.scale(zw.x,zw.y,zw.z),e}function kR(a){const e=a.attributes.position,t=new Float32Array(3*e.count);for(let n=0;n<e.count;n++)t[3*n]=e.getX(n),t[3*n+1]=e.getY(n),t[3*n+2]=e.getZ(n);return t}function jw(a,e){switch(e){case"x":return a.x;case"y":return a.y;case"z":return a.z}throw new Error(`Unexpected component ${e}`)}function rO(a,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=a.getIndex(),s=a.getAttribute("position"),l=n?n.count:s.count;let c=0;const f=[],g=[],y=Math.log10(1/e),x=Math.pow(10,y);for(let L=0;L<l;L++){const B=n?n.getX(L):L;let W="";W+=~~(s.getX(B)*x)+",",W+=~~(s.getY(B)*x)+",",W+=~~(s.getZ(B)*x)+",",W in t?f.push(t[W]):(g.push(s.getX(B)),g.push(s.getY(B)),g.push(s.getZ(B)),t[W]=c,f.push(c),c++)}const S=new i.TlE(new Float32Array(g),s.itemSize,s.normalized),C=new i.u9r;return C.setAttribute("position",S),C.setIndex(f),C}const UR=Math.PI/2;var Do;(function(a){a.BOX="Box",a.CYLINDER="Cylinder",a.SPHERE="Sphere",a.HULL="ConvexPolyhedron",a.MESH="Trimesh"})(Do||(Do={}));const sO=function(a,e={}){const t=function(g,y={}){let x;if(y.type===Do.BOX)return zR(g);if(y.type===Do.CYLINDER)return function(S,C){const L=["x","y","z"],B=C.cylinderAxis||"y",W=L.splice(L.indexOf(B),1)&&L,q=new i.ZzF().setFromObject(S);if(!isFinite(q.min.lengthSq()))return null;const Z=q.max[B]-q.min[B],j=.5*Math.max(jw(q.max,W[0])-jw(q.min,W[0]),jw(q.max,W[1])-jw(q.min,W[1])),F=B==="y"?UR:0,se=B==="z"?UR:0;return{type:Do.CYLINDER,params:{radiusTop:j,radiusBottom:j,height:Z,segments:12},orientation:new xo().setFromEuler(F,se,0,"XYZ").normalize()}}(g,y);if(y.type===Do.SPHERE)return function(S,C){if(C.sphereRadius)return{type:Do.SPHERE,params:{radius:C.sphereRadius}};const L=Vw(S);return L?(L.computeBoundingSphere(),{type:Do.SPHERE,params:{radius:L.boundingSphere.radius}}):null}(g,y);if(y.type===Do.HULL)return function(S){const C=Vw(S);if(!C)return null;const L=1e-4;for(let q=0;q<C.attributes.position.count;q++)C.attributes.position.setXYZ(q,C.attributes.position.getX(q)+(Math.random()-.5)*L,C.attributes.position.getY(q)+(Math.random()-.5)*L,C.attributes.position.getZ(q)+(Math.random()-.5)*L);const[B,W]=new tO().setFromObject(new i.Kj0(C)).toJSON();return{type:Do.HULL,params:{vertices:new Float32Array(B),faces:W}}}(g);if(y.type===Do.MESH)return x=Vw(g),x?function(S){const C=kR(S);if(!C.length)return null;const L=new Uint32Array(C.length);for(let B=0;B<C.length;B++)L[B]=B;return{type:Do.MESH,params:{vertices:C,indices:L}}}(x):null;if(y.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${y.type}".`);if(x=Vw(g),!x)return null;switch(x.type){case"BoxGeometry":case"BoxBufferGeometry":return FR(x);case"CylinderGeometry":case"CylinderBufferGeometry":return function(S){const C=S.parameters;return{type:Do.CYLINDER,params:{radiusTop:C.radiusTop,radiusBottom:C.radiusBottom,height:C.height,segments:C.radialSegments},orientation:new xo().setFromEuler(i.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(x);case"PlaneGeometry":case"PlaneBufferGeometry":return function(S){S.computeBoundingBox();const C=S.boundingBox;return{type:Do.BOX,params:{x:(C.max.x-C.min.x)/2||.1,y:(C.max.y-C.min.y)/2||.1,z:(C.max.z-C.min.z)/2||.1}}}(x);case"SphereGeometry":case"SphereBufferGeometry":return function(S){return{type:Do.SPHERE,params:{radius:S.parameters.radius}}}(x);case"TubeGeometry":case"BufferGeometry":return zR(g);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',x.type),FR(x)}}(a,e);if(!t)return null;const{type:n,params:s,offset:l,orientation:c}=t;let f;return f=n===Do.BOX?function(g){const{x:y,y:x,z:S}=g;return new Tw(new He(y,x,S))}(s):n===Do.CYLINDER?function(g){const{radiusTop:y,radiusBottom:x,height:S,segments:C}=g,L=new $2(y,x,S,C);return L.radiusTop=x,L.radiusBottom=x,L.height=S,L.numSegments=C,L}(s):n===Do.SPHERE?function(g){return new SR(g.radius)}(s):n===Do.HULL?function(g){const{faces:y,vertices:x}=g,S=[];for(let C=0;C<x.length;C+=3)S.push(new He(x[C],x[C+1],x[C+2]));return new i_({faces:y,vertices:S})}(s):function(g){const{vertices:y,indices:x}=g;return new Nw(y,x)}(s),{shape:f,offset:l,orientation:c}};function FR(a){if(!kR(a).length)return null;a.computeBoundingBox();const e=a.boundingBox;return{type:Do.BOX,params:{x:(e.max.x-e.min.x)/2,y:(e.max.y-e.min.y)/2,z:(e.max.z-e.min.z)/2}}}function zR(a){const e=a.clone();e.quaternion.set(0,0,0,1),e.updateMatrixWorld();const t=new i.ZzF().setFromObject(e);if(!isFinite(t.min.lengthSq()))return null;const n=t.translate(e.position.negate()).getCenter(new i.Pa4);return{type:Do.BOX,params:{x:(t.max.x-t.min.x)/2,y:(t.max.y-t.min.y)/2,z:(t.max.z-t.min.z)/2},offset:n.lengthSq()?new He(n.x,n.y,n.z):void 0}}var Gw,Hw=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let bd=Gw=class extends Ln{constructor(a=!1){super(),this._world=new qB,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var s;(s=this._viewer)==null||s.scene.modelRoot.children.forEach(l=>{this.makeBody(l)})},this._bodyMeshMap=new Map,this._movementPlane=new i.Kj0(new i._12(100,100),new i.vBJ({color:65280,side:i.ehD})),this.enabled=a,this._world.gravity.set(0,-9.81,0);const e=new J2,t=new Vi({mass:0,position:new He(0,-2,0)});t.addShape(e),t.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=t,this._world.addBody(t);const n=new SR(.1);this._jointBody=new Vi({mass:0}),this._jointBody.addShape(n),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(a){await super.onAdded(a);const e=new i.Pa4,t=new i.Pa4,n=new i.Pa4,s=new i._fP,l=new i._fP,c=new i.yGw,f=new i.yGw;let g=!1,y=!1;function x(S){const C=a.canvas.getBoundingClientRect(),L=new i.FM8;return L.x=(S.clientX-C.x)/C.width*2-1,L.y=-(S.clientY-C.y)/C.height*2+1,L}a.addEventListener("preFrame",()=>{const S=a.getPlugin($c),C=a.getPlugin(Qu);if(!this.enabled){if(!(this.nextSteps>0))return S&&g&&(S.enableRefreshTransform=!0,g=!1),C&&y&&(C.enable(Gw.PluginType),y=!1),void(this._dirty=!1);this.enabled=!0}if(S&&S.enableRefreshTransform&&!g&&(S.enableRefreshTransform=!1,g=!0),C&&!y&&C.disable(Gw.PluginType),this.nextSteps>0)for(let B=0;B<this.stepPhysics.stepCount;B++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let L=!1;for(const B of this._world.bodies){if(B.mass===0)continue;const W=this._bodyMeshMap.get(B);if(W&&(W.updateMatrixWorld(),W.getWorldPosition(t),W.getWorldQuaternion(l),W.getWorldScale(n),t.manhattanDistanceTo(e.copy(B.position))>0&&(L=!0),l.angleTo(s.copy(B.quaternion))>0&&(L=!0),L)){if(c.compose(e,s,n),!W.parent)throw new Error("no parent");f.copy(W.parent.matrixWorld).invert(),f.multiply(c),f.decompose(e,s,n),W.position.copy(e),W.quaternion.copy(s)}}this._dirty=L,a.setDirty(),a.renderer.resetShadows(),S==null||S.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)}),a.scene.addEventListener("update",S=>{this._bodyMeshMap.forEach((C,L)=>{L.velocity.set(0,0,0),L.angularVelocity.set(0,0,0)})}),a.scene.addEventListener("addSceneObject",S=>{var L;const C=(L=S.object)==null?void 0:L.modelObject;C&&C.traverse(B=>{const W=B.uiConfig;W&&Array.isArray(W.children)&&(W.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(B)},{type:"number",label:"Mass",hidden:()=>!B._physicsBody,getValue:()=>{var q;return((q=B._physicsBody)==null?void 0:q.mass)??0},setValue:q=>{B._physicsBody&&(B._physicsBody.mass=q)}}]}),B.userData.physicsMass!==void 0&&this.makeBody(B))})}),a.canvas.addEventListener("pointerdown",S=>{if(!this.enabled||!S.isPrimary)return;a.getPlugin(Kr).enabled=!1;const C=x(S),L=new i.iMs;L.setFromCamera(C,a.scene.activeCamera.cameraObject);const B=L.intersectObjects([...this._bodyMeshMap.values()],!0);if(!B.length)return;let W,q=null,Z=B[0];for(const se of B){for(q=se.object,Z=se;!(q==null||q.visible&&q.material);)q=q.parent;if(q)break}if(!q)return;for(;q.parent&&!W;){for(const[se,pe]of this._bodyMeshMap.entries())if(pe===q){se.mass>0&&(W=se);break}q=q.parent}if(!W)return;a.scene.activeCamera.interactionsEnabled=!1,this._movementPlane.position.copy(Z.point),this._movementPlane.lookAt(a.scene.activeCamera.cameraObject.getWorldPosition(new i.Pa4));const j=new He().copy(Z.point).vsub(W.position),F=W.quaternion.inverse().vmult(j);this._jointBody.position.copy(Z.point),this._jointConstraint=new q2(W,F,this._jointBody,new He(0,0,0)),this._world.addConstraint(this._jointConstraint)}),a.canvas.addEventListener("pointermove",S=>{if(!this.enabled||!S.isPrimary||!this._jointConstraint)return;const C=x(S),L=new i.iMs;L.setFromCamera(C,a.scene.activeCamera.cameraObject);const B=L.intersectObject(this._movementPlane);if(!B.length)return;const W=B[0];this._jointBody.position.copy(W.point),this._jointConstraint.update()}),a.canvas.addEventListener("pointerup",S=>{this.enabled&&S.isPrimary&&(a.getPlugin(Kr).enabled=!0,a.scene.activeCamera.interactionsEnabled=!0,this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))})}makeBody(a){if(a.isLight||a._physicsBody)return;const e=[];let t=0;if(a.updateMatrixWorld(),a.traverse(g=>{const y=g;if(!y.isMesh)return;if(y._physicsShape)return void e.push(y._physicsShape);if(t+=y.userData.physicsMass??1,y.addEventListener("objectUpdate",()=>{y.userData.physicsMass===0&&(this._ground.position.y=y.position.y,this._bodyMeshMap.forEach((S,C)=>{C.velocity.set(0,0,0),C.angularVelocity.set(0,0,0),C.force.set(0,0,0),C.torque.set(0,0,0)}))}),y.userData.physicsMass===0)return;const x=sO(y,{type:Do.HULL});x?(e.push([x.shape,y]),y._physicsShape=x.shape):console.warn("Failed to convert mesh to cannon shape",y)}),!e.length)return;const n=new Vi({mass:t,angularVelocity:new He(0,0,0),velocity:new He(0,0,0)}),s=new i.Pa4,l=new i._fP,c=new i.Pa4,f=new i.yGw;for(const[g,y]of e)y!==a?(y.updateMatrixWorld(),f.copy(a.matrixWorld).invert(),f.multiply(y.matrixWorld),f.decompose(s,l,c),n.addShape(g,new He(...s.toArray()),new xo(...l.toArray()))):n.addShape(g);n.position.set(...a.getWorldPosition(s).toArray()),n.quaternion.set(...a.getWorldQuaternion(l).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0),a.addEventListener("objectUpdate",()=>{n.position.set(...a.getWorldPosition(s).toArray()),n.quaternion.set(...a.getWorldQuaternion(l).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0)}),this._world.addBody(n),this._bodyMeshMap.set(n,a),a._physicsBody=n,a.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};bd.PluginType="CannonPhysics",Hw([En("Enabled",a=>({onChange:()=>{}})),Pe()],bd.prototype,"enabled",void 0),Hw([Di()],bd.prototype,"stepPhysics",void 0),Hw([Ee("Make Root Bodies")],bd.prototype,"makeRootBodies",void 0),bd=Gw=Hw([lt("Physics (dev)")],bd);var oO=__webpackgi_require__(819);class tu{static _initialize(){this._inited=!0,(0,r.createStyles)(r.css`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,t,n){this._inited||this._initialize(),this.Element&&this.Remove();const s=(0,r.createDiv)({id:"customContextMenu",addToBody:!1});s.style.top=n+"px",s.style.left=t+"px";for(const[l,c]of Object.entries(e)){const f=(0,r.createDiv)({classList:["customContextMenuItems"],addToBody:!1,innerHTML:l});s.appendChild(f),f.onclick=c}return this.Element=s,s}static Remove(){var e;(e=this.Element)==null||e.remove(),this.Element=void 0}}tu.Element=void 0,tu._inited=!1;var aO=__webpackgi_require__(665);const lO=(a,e,t)=>{var c,f;const n=a.controller_,s=(f=(c=n.parent)==null?void 0:c.children)==null?void 0:f.indexOf(n);return!(((g,y)=>y.controller_.rackController.rack===g.controller_.parent)(a,e)&&s===t||(e.add(a,t),0))},VR=(a,e,t,n)=>{var S;let s=e.uiRef;s!=null&&s.controller_.viewProps.get("disposed")&&(s=void 0);const l=s==null?void 0:s.expanded;if(!s){const C=a.addFolder({title:""});s=C,s.on("fold",L=>{var W,q,Z;let B=C.expanded;(0,r.safeSetProperty)(e,"expanded",B,!0),B=(0,r.getOrCall)(e.expanded)??B,B!==C.expanded&&(C.expanded=B),(W=e.uiRefresh)==null||W.call(e,"postFrame",!0,10),B?(q=e.onExpand)==null||q.call(e,e):(Z=e.onCollapse)==null||Z.call(e,e)})}if(!s)return s;s.expanded=(0,r.getOrCall)(e.expanded)??l??!1;const c=(e.children??[]).map(C=>C&&(0,r.getOrCall)(C)).flat(2).filter(C=>C);let f=0;for(const C of c){if(Array.isArray(C)||typeof C!="object"){console.error("child is not an object",C);continue}let L=C.uiRef;L&&L.controller_.viewProps.get("disposed")&&(C.uiRef=void 0,C.uiRefresh=void 0),L=C.uiRef,L||(t.appendUiObject({uiConfig:C},s),L=C.uiRef),L&&lO(L,s,f++)&&t.appendUiObject({uiConfig:C},s)}let g=s.children;for(;g.length>f;){const C=g[g.length-1];s.remove(C),C.dispose(),g=s.children}s.controller_.props.set("title",(0,r.getOrCall)(e.label)??"");const y=s.controller_.view.containerElement,x=(0,r.getOrCall)(e.domChildren,[]);if((x==null?void 0:x.length)!==void 0){const C=[];for(let L=0;L<y.children.length;L++){const B=y.children[L];(S=B.dataset)!=null&&S.tpCustomDOM&&C.push(B)}for(const L of C)y.removeChild(L);for(const L of x)L.parentElement!==y&&(y.appendChild(L),L.dataset.tpCustomDOM="true");s.controller_.foldable.cleanUpTransition()}return s},cO=(a,e,t,n)=>{const[s,l]=e.property??[void 0,void 0],c=(0,r.getOrCall)(e.label)??l;let f=e.uiRef;return f!=null&&f.controller_.viewProps.get("disposed")&&(f=void 0),f||(f=a.addButton({title:""}),f.on("click",async()=>{const g=[];e.prompt&&g.push(await t.prompt(...e.prompt));const y=(s&&l?s[l]:void 0)??e.value;if(typeof y=="function"){const x=()=>{t.removeEventListener("postFrame",x),y.call(e,...g)};t.addEventListener("postFrame",x)}else console.warn("Invalid action type for button")})),f&&(f.title=(c??"click me")+""),f},uO=(a,e,t,n)=>{const s=Object.fromEntries(((0,r.getOrCall)(e.children)??[]).map(l=>(0,r.getOrCall)(l)).flat(2).filter(l=>l).map(l=>{const c=(0,r.getOrCall)(l.label);return[c,l.value??c]}));return dh(a,e,t,{options:s,...n??{}})},hO=(a,e,t,n)=>{const s=(0,r.getOrCall)(e.bounds),l=((s==null?void 0:s.length)??0)>=2?s[1]:1,c=((s==null?void 0:s.length)??0)>=1?s[0]:0,f=e.stepSize||void 0;return dh(a,e,t,{min:c,max:l,step:f,...n??{}})},Ww=(a,e,t,n)=>{const s=(0,r.getOrCall)(e.bounds);if(!s||s.length<1)return dh(a,e,t,{...n??{}});const l=(s.length??0)>=2?s[1]:1,c=(s.length??0)>=1?s[0]:0,f={min:c,max:l,step:e.stepSize??(l-c)/100},g={x:f,y:f};e.type!=="vec3"&&e.type!=="vec4"||(g.z=f),e.type==="vec4"&&(g.w=f);const y=e.property;if(e.value===void 0&&y&&y[0]&&typeof y[0]=="object"&&y[0][y[1]]&&Array.isArray(y[0][y[1]])){const[x,S]=y,C=x[S],L=C.length,B=new(L===2?i.FM8:L===3?i.Pa4:i.Ltg)().fromArray(C);e.value=B,e.property=void 0,e.onChange=[()=>{x[S]=B.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(W=>W),e.label===void 0&&(e.label=S)}return dh(a,e,t,{...g,...n??{}})},dO=(a,e,t,n)=>{var l;const s=e.property;if(e.value===void 0&&s&&typeof s[0]=="object"&&((l=s[0][s[1]])!=null&&l.isColor)){const[c,f]=s,g=i.KI_;Object.defineProperty(e,"value",{get:()=>{const y=c[f];return y?new $e(y).getHex(g):0},set:y=>{const x=c[f],S=new $e().setHex(y,g);x.isColor?x.copy(S):typeof x=="number"?c[f]=S.getHex():typeof x=="string"&&(c[f]="#"+S.getHexString()),typeof(c==null?void 0:c.setDirty)=="function"&&c.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(y=>y),e.label===void 0&&(e.label=f+"")}return(n=n??{}).view="color",(0,r.getOrCall)(e.inlinePicker)&&(n.picker="inline"),dh(a,e,t,n)},dh=(a,e,t,n)=>{var f;let s=(0,r.getOrCall)(e.property);if((e.getValue||e.setValue)&&s&&console.error("specify either property or value, or getValue and setValue",e),s)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if((Object.hasOwn?Object.hasOwn(e,"value"):e.hasOwnProperty("value"))||e.value!==void 0||!e.getValue&&!e.setValue||(Object.defineProperty(e,"value",{get:()=>{var g;return(g=e.getValue)==null?void 0:g.call(e)},set:g=>{var y;return(y=e.setValue)==null?void 0:y.call(e,g)}}),s=[e,"value"]),s||e.value===void 0||(s=[e,"value"]),!s)return void console.error("cannot determine property",e);n=n??{};const l={label:(0,r.getOrCall)(e.label)??s[1],...n};let c=e.uiRef;if(c!=null&&c.controller_.viewProps.get("disposed")&&(c=void 0),!c&&typeof s[0]=="object"&&s[0]){const[g,y]=s;try{c=e.isMonitor?a.addMonitor(g,y,l):a.addInput(g,y,l).on("change",x=>{[e.onChange].flat().forEach(S=>typeof S=="function"&&(S==null?void 0:S(x))),typeof(g==null?void 0:g.setDirty)=="function"&&g.setDirty(x)})}catch(x){if(!x.message.startsWith("No matching controller for"))throw x;c=void 0}}if(c){for(const[g,y]of Object.entries(l)){const x=c.controller_.props.value(g);x!==void 0&&x.rawValue!==y&&c.controller_.props.set(g,y)}e.type==="slider"&&(l.min!==void 0&&c.controller_.valueController.sliderController.props.set("minValue",l.min),l.max!==void 0&&c.controller_.valueController.sliderController.props.set("maxValue",l.max)),(f=c==null?void 0:c.controller_.valueController.view.inputElement)==null||f.setAttribute("placeholder",(0,r.getOrCall)(e.placeholder)??""),c.refresh()}return c};class jR extends r.SimpleEventDispatcher{constructor(e=!1,t=!1,n=!1,s=!0,l=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:VR,folder:VR,input:dh,number:dh,slider:hO,dropdown:uO,checkbox:dh,color:dO,vec:Ww,vec2:Ww,vec3:Ww,vec4:Ww,button:cO,monitor:(f,g,y,x)=>(g.isMonitor=!0,dh(f,g,y,x)),dummy:(f,g,y,x)=>dh(f,g,y,x)},this.alert=async f=>alert(f),this.confirm=async f=>confirm(f),this.prompt=async(f,g,y=!0)=>prompt(f,g),this._expand=e,this._limitedOptions=n;const c=this._createUiContainer();l.appendChild(c),this._pane=new aO.Pane({title:"Configuration",container:c}),this._pane.expanded=this._expand,s&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const t=this._refreshQueue[e],n=[],s=(0,r.now)(),l=s-this._lastModeTime[e];t.forEach(c=>{c[2]>.001?(c[2]-=l,n.push(c)):this._refreshUiObject(c[0],c[1],c[2])}),this._refreshQueue[e]=n,this._lastModeTime[e]=s}addToRefreshQueue(e,t){var f;const n=(f=t[0])==null?void 0:f.uiConfig,s=n==null?void 0:n.uuid,l=this._refreshQueue[e],c=l.find(g=>g[3]===s);c?c[2]=Math.max(c[2],t[2]):l.push([...t,s]),this._refreshQueue[e]=l}dispose(){var e;(e=this._pane)==null||e.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,t){var s,l;const{uiConfig:n}=e??{};if(n&&(!this._limitedOptions||n.limitedUi)&&(t=t??this._pane,n.type)){n.uuid||(n.uuid=mn()),n.uiRef&&n.uiRefType!==n.type&&this.removeUiConfig(n);const c=(l=(s=this._typeGenerators)[n.type])==null?void 0:l.call(s,t,n,this);c&&(c.hidden=(0,r.getOrCall)(n.hidden)??!1,c.disabled=(0,r.getOrCall)(n.disabled)??!1),n.uiRef=c,n.uiRefType=c?n.type:void 0,n.uiRefresh=(f="postFrame",g=!1,y=0)=>this._uiObjectRefresh(f,(e==null?void 0:e.uiConfig)??n,t,g,y),c==null||c.controller_.viewProps.handleDispose(()=>{n.uiRef=void 0,n.uiRefType=void 0,n.uiRefresh=void 0})}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var t,n;e&&e.uiRef&&((n=(t=e.uiRef).dispose)==null||n.call(t),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,n,s,l){(s?Qw(t,n):[{uiConfig:t,parentFolder:n}]).forEach(c=>{const f=[{uiConfig:c.uiConfig},c.parentFolder,l];e==="immediate"?this._refreshUiObject(...f):this.addToRefreshQueue(e,f)})}_refreshUiObject(e,t,n=0){this._appendUiObject(e,t),n>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=(0,r.createDiv)({id:"tweakpaneUiContainer",addToBody:!1});return(0,r.createStyles)(r.css`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function Qw(a,e,t){return t=t??[],a&&a.uiRef&&(t.push({uiConfig:a,parentFolder:e}),[...a.children||[]].forEach(n=>{typeof n!="function"&&n&&(Array.isArray(n)?n.forEach(s=>t=Qw(s,a.uiRef,t)):t=Qw(n,a.uiRef,t))})),t}class pO{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const s=n.indexOf(t);s!==-1&&n.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const n=t.slice(0);for(let s=0,l=n.length;s<l;s++)n[s].call(this,e);e.target=null}}}function GR(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}const HR={};function IS(a){a in HR||(HR[a]=!0,console.warn(a))}let u0;class fO{static getDataURL(e,t=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{u0===void 0&&(u0=GR("canvas")),u0.width=e.width,u0.height=e.height;const s=u0.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),n=u0}return!t&&(n.width>2048||n.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=GR("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),l=s.data;for(let c=0;c<l.length;c++)l[c]=255*Gt(l[c]/255);return n.putImageData(s,0,0),t}if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(255*Gt(t[n]/255)):t[n]=Gt(t[n]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class mO{constructor(e=null){this.isSource=!0,this.uuid=$(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let l;if(Array.isArray(s)){l=[];for(let c=0,f=s.length;c<f;c++)s[c].isDataTexture?l.push(PS(s[c].image)):l.push(PS(s[c]))}else l=PS(s);n.url=l}return t||(e.images[this.uuid]=n),n}}function PS(a){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap)return fO.getDataURL(a);if(a.data){let e=[];try{e=Array.from(a.data)}catch(t){t.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(t),e=a.data}return{data:e,width:a.width,height:a.height,type:a.data.constructor.name}}return a.url!==void 0?a.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let gO=0;class mm extends pO{constructor(e=mm.DEFAULT_IMAGE,t=mm.DEFAULT_MAPPING,n=1001,s=1001,l=nn,c=1008,f=1023,g=1009,y=mm.DEFAULT_ANISOTROPY,x=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gO++}),this.uuid=$(),this.name="",this.source=new mO(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=l,this.minFilter=c,this.anisotropy=y,this.format=f,this.internalFormat=null,this.type=g,this.offset=new H(0,0),this.repeat=new H(1,1),this.center=new H(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Lt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof x=="string"?this.colorSpace=x:(IS("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=x===Vn?Jn:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===Jn?Vn:3e3,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return IS("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Jn?Vn:3e3}set encoding(e){IS("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Vn?Jn:""}}mm.DEFAULT_IMAGE=null,mm.DEFAULT_MAPPING=300,mm.DEFAULT_ANISOTROPY=1;var Xw=__webpackgi_require__(898),TA={};Xw.Z&&Xw.Z.locals&&(TA.locals=Xw.Z.locals);var DS,LS=0,l_={};l_.styleTagTransform=mc(),l_.setAttributes=fp(),l_.insert=function(a,e){(e.target||document.head).appendChild(a)},l_.domAPI=fc(),l_.insertStyleElement=gp(),TA.use=function(a){return l_.options=a||{},LS++||(DS=pp()(Xw.Z,l_)),TA},TA.unuse=function(){LS>0&&!--LS&&(DS(),DS=null)};var _O=TA;class qw extends jR{constructor(e=!1,t=!1,n=!1,s=document.body){super(e,t,n,!1),this.dependencies=[ri],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=l=>{this.dispatchEvent(l),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async l=>this._viewer?this._viewer.alert(l):super.alert(l),this.confirm=async l=>this._viewer?this._viewer.confirm(l):super.confirm(l),this.prompt=async(l,c,f=!0)=>this._viewer?this._viewer.prompt(l,c,f):super.prompt(l,c,f),this._pane.registerPlugin(oO),_O.use({target:s})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(t=>(n,s,l,c)=>{let f=s.property||s.__property;const g="placeholder";if(s.value===void 0&&(s.getValue||s.setValue)&&(Object.defineProperty(s,"_value",{get:()=>{var y;return(y=s.getValue)==null?void 0:y.call(s)},set:y=>{var x;return(x=s.setValue)==null?void 0:x.call(s,y)}}),f=[s,"_value"]),(!(Object.hasOwn?Object.hasOwn(s,"value"):s.hasOwnProperty("value"))||s.value===void 0)&&f&&typeof f[0]=="object"){const[y,x]=f,S=(0,r.makeTextSvg)("Render Target"),C=(0,r.makeTextSvg)("Data Texture"),L=(0,r.makeTextSvg)("CUBE Texture"),B=(0,r.makeTextSvg)("Compressed Texture"),W={},q={};Object.defineProperty(s,"value",{get:()=>{let Z,j=y[x];if(j!=null&&j.get&&(j=j.get()),!j)return g;if(j.isCompressedTexture&&!j.image.tp_src&&(j.image.tp_src=B),j.isTexture?(j.image&&!j.image.tp_src&&(j.image instanceof ImageBitmap||j.image instanceof HTMLImageElement||j.image instanceof HTMLVideoElement)?j.image.tp_src=(0,r.imageBitmapToBase64)(j.image,160):j.image&&j.isRenderTargetTexture&&!j.image.tp_src?j.__target&&(j.image.tp_src=t.renderer.renderTargetToDataUrl(j.__target)):j.image&&!j.image.tp_src&&(j.image.tp_src=en(j,160,!1).toDataURL("image/png",90)),j.isRenderTargetTexture&&!j.image.tp_src&&(j.image.tp_src=S),j.isDataTexture&&!j.image.tp_src&&(j.image.tp_src=C),j.image&&(Z=j.image.tp_src_uuid,Z=Z?W[Z]:void 0,Z||(Z=j.image.tp_src||j.image.src))):typeof j=="string"?Z=j:j.domainMin?(Z=j.texture,j.texture.image&&!j.texture.image.tp_src&&(j.texture.image.tp_src=L),j.texture.image&&(Z=j.texture.image.tp_src_uuid,Z=Z?W[Z]:void 0,Z||(Z=j.texture.image.tp_src||j.texture.image.src))):j&&console.error("unknown value",j),Z||(Z=g),j.image&&!j.image.tp_src_uuid){const F=mn();j.image.tp_src_uuid=F,q[Z]=F}return typeof Z=="string"&&(Z=W[Z]??Z),Z},set:Z=>{var pe,be,Se,Be,Ge,Xe,Qe,at,Ke;const j=y[x],F=Je=>{y[x]=Je,Je!=null&&Je.isTexture&&(Je.flipY=Je.isDataTexture?Je.flipY:(j==null?void 0:j.flipY)??!0)};if(typeof Z=="string")return void(typeof j=="string"&&F(Z));if(!Z)return void(s.value=g);if(Z.isPlaceholder)return void(j&&(F(typeof j=="string"?"":null),typeof(y==null?void 0:y.setDirty)=="function"&&y.setDirty()));let se=Z.tp_src_uuid;if(se||(se=Z.src??Z.tp_src,se=q[se]??se,delete q[se],Z.tp_src_uuid=se),se&&(W[se]=Z),typeof j!="string"){if(!((j==null?void 0:j.image)===Z||((pe=j==null?void 0:j.image)==null?void 0:pe.src)===Z.src||((be=j==null?void 0:j.image)==null?void 0:be.tp_src)===Z.tp_src&&Z.tp_src!=null||((Se=j==null?void 0:j.image)==null?void 0:Se.tp_src)===Z.src&&Z.src!=null||((Be=j==null?void 0:j.image)==null?void 0:Be.src)===Z.tp_src&&Z.tp_src!=null))if(Z instanceof File){const Je=t==null?void 0:t.getPlugin(ri);if(!Je)throw"Viewer or AssetManagerPlugin not found";(Ge=Je.importer)==null||Ge.importSingle({file:Z,path:Z.src}).then(ft=>{var mt,vt,Qt,Ht;if(ft){ft.isDataTexture&&(ft.needsUpdate=!0);const Cn=(Qt=(vt=(mt=Z.src)==null?void 0:mt.split("?"))==null?void 0:vt[0])==null?void 0:Qt.split(".").pop();ft.userData&&(ft.userData.mimeType||(ft.userData.mimeType="image/"+(["jpg","jpeg"].includes(Cn)?"jpeg":"png"))),F(ft),[s.onChange].flat().forEach(un=>typeof un=="function"&&(un==null?void 0:un())),typeof(y==null?void 0:y.setDirty)=="function"&&y.setDirty(),(Ht=s.uiRefresh)==null||Ht.call(s,"postFrame",!1)}})}else{const Je=new mm(Z);Je.assetType="texture",Je.needsUpdate=!0;const ft=(at=(Qe=(Xe=Z.src)==null?void 0:Xe.split("?"))==null?void 0:Qe[0])==null?void 0:at.split(".").pop();Je.userData.mimeType||(Je.userData.mimeType="image/"+(["jpg","jpeg"].includes(ft)?"jpeg":"png")),F(Je);const mt=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(x);Je.colorSpace=mt?i.GUF:i.KI_,Je.wrapS=i.rpg,Je.wrapT=i.rpg,[s.onChange].flat().forEach(vt=>typeof vt=="function"&&(vt==null?void 0:vt())),typeof(y==null?void 0:y.setDirty)=="function"&&y.setDirty(),(Ke=s.uiRefresh)==null||Ke.call(s,"postFrame",!1)}}else F(se)}}),s.__property=s.property,s.property=void 0,s.label===void 0&&(s.label=x)}return(c=c??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],c.imageFit===void 0&&(c.imageFit="contain"),c.clickCallback===void 0&&(c.clickCallback=(y,x)=>{var q;const S=y==null?void 0:y.target,C=S==null?void 0:S.getBoundingClientRect();if(!C)return void x.click();const L=s.uiRef.controller_.valueController.value.rawValue,B=L===g||L!=null&&L.isPlaceholder?{}:{"remove image":()=>{var se;s.uiRef.controller_.valueController.value.setRawValue("");const[Z,j]=s.property||s.__property||[s,"value"],F=typeof Z[j]=="string";Z[j]=F?"":null,[s.onChange].flat().forEach(pe=>typeof pe=="function"&&(pe==null?void 0:pe())),typeof(Z==null?void 0:Z.setDirty)=="function"&&Z.setDirty(),(se=s.uiRefresh)==null||se.call(s,"postFrame",!1),tu.Remove()},"download image":async()=>{tu.Remove();const[Z,j]=s.property||s.__property||[s,"value"],F=Z[j];if(!F)return;const se=(F==null?void 0:F.image)??s.uiRef.controller_.valueController.value.rawValue;let pe=F.__rootBlob?F.__rootBlob.objectUrl||URL.createObjectURL(F.__rootBlob):F.userData.rootPath||(se==null?void 0:se.src);se&&(se instanceof ImageBitmap||se instanceof HTMLImageElement||se instanceof HTMLVideoElement)&&!pe&&(pe=(0,r.imageBitmapToBase64)(se));let be=F.__rootBlob?F.__rootBlob.name||"image."+(F.__rootBlob.ext||"png"):null;if(!pe&&F.isRenderTargetTexture){const Be=F.__target;if(F.type===i.ywz)pe=t.renderer.renderTargetToDataUrl(Be,"image/png",90),be="renderTarget.png";else{const Ge=new fx().parse(t.renderer.rendererObject,Be),Xe=new Blob([Ge],{type:"image/x-exr"});if(!Xe)return void console.error("cannot export render target",se,Z[j],Z,j,s);be="renderTarget.exr",pe=URL.createObjectURL(Xe)}}if(!pe&&F.isDataTexture){const Be=new fx().parse(void 0,F),Ge=new Blob([Be],{type:"image/x-exr"});if(!Ge)return void console.error("cannot export data texture",se,Z[j],Z,j,s);be="dataTexture.exr",pe=URL.createObjectURL(Ge)}if(!pe)return void console.error("cannot export image",se,Z[j],Z,j,s);const Se=document.createElement("a");document.body.appendChild(Se),Se.style.display="none",Se.href=pe,Se.download=be||(pe.startsWith("data:")?"image.png":pe.split("/").pop()??"image.png"),Se.target="_blank",Se.click(),document.body.removeChild(Se)}},W=tu.Create({...B,"set/replace image":()=>{x.click(),tu.Remove()},"from url":async()=>{var pe,be;let Z="";if(Z=await l.prompt("Load texture: Enter Image/Texture URL",Z,!0),!Z||!Z.startsWith("http")&&!Z.startsWith("data:image"))return Z!==null&&await l.alert("Loading Image: Invalid URL"),void tu.Remove();Z=Z.trim();const[j,F]=s.property||s.__property||[s,"value"],se=j[F];if(typeof se=="string")j[F]=Z,[s.onChange].flat().forEach(Se=>typeof Se=="function"&&(Se==null?void 0:Se())),typeof(j==null?void 0:j.setDirty)=="function"&&j.setDirty(),(pe=s.uiRefresh)==null||pe.call(s,"postFrame",!1);else{const Se=t==null?void 0:t.getPlugin(ri);if(!Se)throw"Viewer or AssetManagerPlugin not found";(be=Se.importer)==null||be.importSinglePath(Z).then(Be=>{var Ge;if(Be){Be.isDataTexture?Be.needsUpdate=!0:Be&&(se==null?void 0:se.flipY)!==void 0&&(Be.flipY=se.flipY),j[F]=Be;const Xe=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(F);Be.colorSpace=Xe?i.GUF:i.KI_,[s.onChange].flat().forEach(Qe=>typeof Qe=="function"&&(Qe==null?void 0:Qe())),typeof(j==null?void 0:j.setDirty)=="function"&&j.setDirty(),(Ge=s.uiRefresh)==null||Ge.call(s,"postFrame",!1)}else console.warn("Failed to load texture",Z)})}tu.Remove()},cancel:()=>{tu.Remove()}},2,C.height+8);(q=S.parentElement)==null||q.appendChild(W),C.y>.7*document.body.clientHeight&&(W.style.top="auto",W.style.bottom=C.height+8+"px")}),c.view="input-image",dh(n,s,l,c)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var s;const t=(s=this._viewer)==null?void 0:s.getPlugin(e);if(!t)return void console.warn("plugin not found:",e);this._plugins.push(t),t.uiConfig&&(t.uiConfig.limitedUi=!0),t.uiConfig&&t.uiConfig.hidden===void 0&&(t.uiConfig.hidden=!1),this._appendUiObject(t);const n=t.uiConfig;if(n!=null&&n.uiRef&&t.toJSON){const l=typeof t.toJSON=="function"?t.toJSON():null;t.resetDefaults=async()=>{var g,y;await((g=t.fromJSON)==null?void 0:g.call(t,l)),(y=n.uiRefresh)==null||y.call(n,"postFrame",!0)};const c=n.uiRef.controller_.view.element,f=(0,r.createDiv)({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});f.onclick=g=>{const y={};typeof t.toJSON=="function"&&(y["download preset"]=async()=>{var C,L;const S=(L=(C=this._viewer)==null?void 0:C.getPlugin(ri))==null?void 0:L.exportPluginPreset(t);await(0,r.downloadBlob)(new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),"preset."+t.constructor.PluginType+".json"),tu.Remove()}),typeof t.fromJSON=="function"&&(y["upload preset"]=async()=>{var W,q,Z;tu.Remove();const S=await(0,r.uploadFile)(!1,!1);if(S.length===0)return;const C=S[0],L=await C.text(),B=JSON.parse(L);await((q=(W=this._viewer)==null?void 0:W.getPlugin(ri))==null?void 0:q.importPluginPreset(B,t)),(Z=n.uiRefresh)==null||Z.call(n,"postFrame",!0)},l&&(y["reset defaults"]=async()=>{var S;tu.Remove(),await((S=t.resetDefaults)==null?void 0:S.call(t))}));const x=tu.Create(y,c.clientWidth-120,12);c.append(x),g.preventDefault()},c.appendChild(f)}return n}setupPlugins(...e){e.forEach(t=>this.setupPluginUi(t))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var n;const t=e.uiConfig;t&&((0,r.getOrCall)(t.hidden)!==!0?(n=t.uiRefresh)==null||n.call(t,"postFrame",!0):t.uiRef&&(t.uiRef.hidden=!0))})}}qw.PluginType="TweakpaneUi";class MA extends Ln{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.scene.backgroundIntensity)??1},setValue:e=>{this._viewer&&(this._viewer.scene.backgroundIntensity=e)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0},{type:"checkbox",label:"Fixed Env Direction",property:[this,"sceneEnvironmentFixedDirection"]},{type:"checkbox",label:"Artistic Lighting",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.renderer.useLegacyLights)??!0},setValue:e=>{this._viewer&&(this._viewer.renderer.useLegacyLights=e)}}]}}get sceneBackgroundColor(){var t,n;const e=(n=(t=this._viewer)==null?void 0:t.scene.backgroundColor)==null?void 0:n.getHex(i.KI_);return e!==void 0&&(this._savedBg=!0),e||0}set sceneBackgroundColor(e){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new $e),this._viewer.scene.backgroundColor.setHex(e),this._viewer.scene.setDirty())}get sceneBackground(){var t;const e=(t=this._viewer)==null?void 0:t.scene.background;return e&&(e.isTexture||e.assetType==="texture")?e:null}set sceneBackground(e){this._viewer&&(this._viewer.scene.background=e)}get sceneEnvironment(){var e;return((e=this._viewer)==null?void 0:e.scene.environment)||null}set sceneEnvironment(e){this._viewer&&(this._viewer.scene.environment=e)}get sceneEnvironmentRotation(){var e,t;return((t=(e=this._viewer)==null?void 0:e.scene.environment)==null?void 0:t.rotation)??0}set sceneEnvironmentRotation(e){var n,s;const t=(n=this._viewer)==null?void 0:n.scene.environment;t&&(t.rotation=e,(s=this._viewer)==null||s.scene.setDirty())}get sceneEnvironmentIntensity(){var e;return((e=this._viewer)==null?void 0:e.scene.envMapIntensity)??1}set sceneEnvironmentIntensity(e){var t;(t=this._viewer)!=null&&t.scene&&(this._viewer.scene.envMapIntensity=e)}get sceneEnvironmentFixedDirection(){var e;return((e=this._viewer)==null?void 0:e.scene.fixedEnvMapDirection)??!1}set sceneEnvironmentFixedDirection(e){var t;(t=this._viewer)!=null&&t.scene&&(this._viewer.scene.fixedEnvMapDirection=e)}get envmapBg(){var e,t,n;return((e=this._viewer)==null?void 0:e.scene.background)==="environment"||((t=this._viewer)==null?void 0:t.scene.background)===((n=this._viewer)==null?void 0:n.scene.environment)}set envmapBg(e){if(this._viewer)if(e){const t=this._viewer.scene.background;t&&t!==this._viewer.scene.environment&&t!=="environment"&&(this.lastBgVal=t),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&this._viewer.scene.background!=="environment"||(this._viewer.scene.background=this.lastBgVal)}async onAdded(e){await super.onAdded(e),this.lastBgVal=e.scene.background,e.scene.addEventListener("backgroundChanged",()=>{var t,n;(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}),e.scene.addEventListener("environmentChanged",()=>{var t,n;(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)})}}MA.PluginType="SimpleBackgroundEnvUiPlugin1";class CA extends Ln{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,t;(t=(e=this._uiConfig).uiRefresh)==null||t.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)==null||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var e,t;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...((t=(e=this._viewer)==null?void 0:e.scene.modelRoot.modelObject.children)==null?void 0:t.map(n=>n.assetType==="light"?null:n.uiConfig).filter(n=>n!=null))??[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,t;(t=(e=this._uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}}CA.PluginType="SimpleUi";var vO=__webpackgi_require__(1),yO=__webpackgi_require__.n(vO)();class RA extends Ln{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,r.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(t,n)=>(t.push({text:n.name||"unnamed",id:n.uuid,children:n.children.reduce(this._buildData,[])}),t),this._findVisible=(t,n)=>(n.visible&&(n.children.length<1?t.push(n.uuid):t.push(...n.children.reduce(this._findVisible,[]))),t),this._setVisible=t=>{var n;(n=this._viewer)==null||n.doOnce("postFrame",()=>{var c,f,g;const s=(c=this._viewer)==null?void 0:c.scene.modelRoot;if(!s||t==null)return;const l=new Set;s.traverse(y=>{y!==s&&(y.visible=t.includes(y.uuid),y.visible&&y.traverseAncestors(x=>l.add(x)))}),l.forEach(y=>y.visible=!0),(g=(f=this._viewer)==null?void 0:f.scene)==null||g.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})})},this.enabled=e,this.reset=this.reset.bind(this),(0,r.createStyles)(r.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var c;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const t=(c=this._viewer)==null?void 0:c.scene.modelRoot;if(!t)return;const n=t.children.reduce(this._buildData,[]),s=t.children.reduce(this._findVisible,[]);let l=!1;return new Promise((f,g)=>{this.treeView=new yO(this.hierarchyDiv,{closeDepth:1,data:n,loaded:function(){this.values=s,f()},onChange:()=>{l?(0,r.timeout)(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):l=!0},onItemLabelClick:y=>{var S;const x=(S=this._viewer)==null?void 0:S.scene.modelRoot.modelObject.getObjectByProperty("uuid",y);x&&t.visible&&x.dispatchEvent({type:"select",value:x,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}RA.PluginType="HierarchyUiPlugin";class IA extends Ln{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new Ia;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[ri],this._sceneUpdate=e=>{var n,s,l;if(!e.hierarchyChanged)return;const t=[];(n=this._viewer)==null||n.traverseSceneObjects(c=>{if(!c.lightObject)return;const f=c.uiConfig;f&&!t.includes(f)&&t.push(f)}),[...this.uiConfig.children].forEach(c=>{(c==null?void 0:c.type)==="button"||t.includes(c)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(c),1)}),t.forEach(c=>{this.uiConfig.children.includes(c)||this.uiConfig.children.push(c)}),(l=(s=this.uiConfig).uiRefresh)==null||l.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}IA.PluginType="SimpleLightsUi";class PA extends Ln{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[ri],this._sceneUpdate=e=>{var n,s,l;if(!e.hierarchyChanged)return;const t=[];(n=this._viewer)==null||n.traverseSceneObjects(c=>{if(!c.cameraObject)return;const f=c.uiConfig;f&&!t.includes(f)&&t.push(f)}),[...this.uiConfig.children].forEach(c=>{(c==null?void 0:c.type)==="button"||t.includes(c)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(c),1)}),t.forEach(c=>{this.uiConfig.children.includes(c)||this.uiConfig.children.push(c)}),(l=(s=this.uiConfig).uiRefresh)==null||l.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}PA.PluginType="SimpleSceneCamerasUi";var jp,h0=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let nu=jp=class extends Ln{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(a=!0){if(!this._viewer)return;if(this.mode==="full")return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const e={width:Math.floor(this.width),height:Math.floor(this.height)},t=this._viewer.container.getBoundingClientRect(),n={width:Math.floor(t.width),height:Math.floor(t.height)};let s=1;if(e.width>n.width){const l=e.width;e.width=n.width;const c=e.width/l;if(e.height=Math.floor(e.height*c),s/=c,s>jp.MaxCanvasScale)return this.width=n.width*jp.MaxCanvasScale,console.log("loop",this.width,n.width,s),void this._sizeChanged()}if(e.height>n.height){const l=e.height;e.height=n.height;const c=e.height/l;if(e.width=Math.floor(e.width*c),s/=c,s>jp.MaxCanvasScale)return this.height=n.height*jp.MaxCanvasScale,console.log("loop",this.width,n.width,this.height,n.height,s),void this._sizeChanged()}(e.width>=n.width||e.width<1)&&delete e.width,(e.height>=n.height||e.height<1)&&delete e.height,this._viewer.setSize(e),this._setScale(s),a&&(this.scale=s),this._refresh()}_setScale(a){this._viewer&&(this._viewer.renderer.displayCanvasScaling=a)}_scaleChanged(){if(!this._viewer)return;const a=this.scale;if(Math.abs(a-this._viewer.renderer.displayCanvasScaling)<.01)return;if(this.mode==="full")return void this._sizeChanged();const e=this.width/this.height,t=this._viewer.container.getBoundingClientRect(),n=Math.floor(t.width*a),s=Math.floor(n/e);this.width=n,this.height=s,this._sizeChanged(!1)}async onAdded(a){await super.onAdded(a);const e=a.canvas.clientWidth,t=a.canvas.clientHeight,n=a.renderer.displayCanvasScaling;this.width=e,this.height=t,this.scale=n,a.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",()=>this._sizeChanged(!0)),this._refresh()}async onRemove(a){return a.renderer.removeEventListener("resize",this._refresh),super.onRemove(a)}_refresh(){var a,e;(e=(a=this.uiConfig)==null?void 0:a.uiRefresh)==null||e.call(a,"postFrame",!0)}fromJSON(a,e){if(!a.mode)if(a.width||a.height){const t=this._viewer.container.getBoundingClientRect();a.width||(a.width=t.width),a.height||(a.height=t.height),a.scale&&(a.width*=a.scale,a.height*=a.scale,delete a.scale),a.width=Math.round(a.width),a.height=Math.round(a.height),a.mode="custom"}else a.mode="full";return super.fromJSON(a,e)}toJSON(a){const e=super.toJSON(a);return e.mode==="full"&&(delete e.width,delete e.height),e.mode==="custom"&&delete e.scale,e}};nu.PluginType="RendererParamsUiPlugin",nu.MaxCanvasScale=4,h0([Pe("version")],nu.prototype,"_serializeVersion",void 0),h0([Pe(),Me("Mode",["full","custom"].map(a=>({label:a}))),(0,r.onChange2)(jp.prototype._sizeChanged)],nu.prototype,"mode",void 0),h0([Pe(),Hn("Width",void 0,1,a=>({onChange:()=>a._sizeChanged(),hidden:()=>a.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=a._viewer)==null?void 0:e.container.getBoundingClientRect().width)||1024)+2))]}}))],nu.prototype,"width",void 0),h0([Pe(),Hn("Height",void 0,1,a=>({onChange:()=>a._sizeChanged(),hidden:()=>a.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=a._viewer)==null?void 0:e.container.getBoundingClientRect().height)||1024)+2))]}}))],nu.prototype,"height",void 0),h0([Pe(),(0,r.onChange)(jp.prototype._scaleChanged),Hn("Scale",[.25,jp.MaxCanvasScale],.001,a=>({disabled:()=>a.mode==="custom"}))],nu.prototype,"scale",void 0),nu=jp=h0([lt("Renderer")],nu);class DA extends Ln{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){var n;const t=super.toJSON(e);return t.activeCamera=(n=this._viewer)==null?void 0:n.scene.activeCamera.toJSON(),t}fromJSON(e,t){var n;return e.activeCamera&&((n=this._viewer)==null||n.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){var e,t;this._viewer&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)==null?void 0:e.scene.activeCamera.uiConfig)||{}}}DA.PluginType="CameraUiPlugin";var AO={create:a=>{let e="button"+(a.type?" "+a.type:""),t=Cr.createDiv(e,a.text);return t.addEventListener("click",a.onClick),t}};let Kl={createElement:(a,e,t,n)=>{let s=document.createElement(a);if(e&&(s.className=e),t&&(s.innerHTML=t),n)for(let l in n)s.setAttribute(l,n[l]);return s},createDiv:(a,e,t)=>Kl.createElement("div",a,e,t),createDomTree:a=>{if(!a||!a.hasOwnProperty("dom"))return a;let e=a.dom;if(a.children)for(let t in a.children)a.children[t]&&e.appendChild(Kl.createDomTree(a.children[t]));return e},removeElement:a=>{a!=null&&a.parentNode.removeChild(a)},appendToBody:a=>{document.body.appendChild(a)},makeIconHTML:a=>{let e="";return a=="ok"&&(e="#tick"),a=="error"&&(e="#cancel"),a=="info"&&(e="#info-button"),a=="caution"&&(e="#danger"),a=="min"&&(e="#line"),a=="close"&&(e="#close"),`<svg class="icon ${a}"><use xlink:href="${e}" /></svg>`},makeNftContent:a=>{let e=null;if(a.type){let t=null;t=typeof a.content=="string"?Kl.createDiv("inner-content",a.content):Kl.createDomTree({dom:Kl.createDiv("inner-content"),children:[a.content]}),e=a.type=="text"?Kl.createDomTree({dom:Kl.createDiv("content text"),children:[t]}):Kl.createDomTree({dom:Kl.createDiv("content"),children:[Kl.createDiv("state",Kl.makeIconHTML(a.type)),t]})}else typeof a.content=="string"&&(e=Kl.createDiv("content",a.content));return e},standardizeButtons:(a,e)=>{let t=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||t.push({key:27,text:"Cancel",onClick:a.close.bind(a,"cancel")}),t.push({key:13,text:"OK",type:"main",onClick:a.close.bind(a,"ok")}),t;t=e.buttons,t.constructor!==Array&&(t=[t]);for(let n in t)!t[n].onClick&&(t[n].onClick=a.close.bind(a,t[n].id));return t},makeButtons:a=>{let e=[];if(a)for(let t in a)e.push(AO.create({text:a[t].text?a[t].text:"OK",type:a[t].normal?null:"main",onClick:a[t].onClick}));return Kl.createDomTree({dom:Kl.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:a=>{let e=t=>{for(let n in a)if(a[n].key===t.keyCode)return void a[n].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:a=>{window.removeEventListener("keydown",a)}};var Cr=Kl,$o=__webpackgi_require__(336),al={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let ph={};ph.overlay_in=[new $o.Frame(al["wwise-overlay-in-1"],0),new $o.Frame(al["wwise-overlay-in-2"],400)],ph.overlay_out=[new $o.Frame(al["wwise-overlay-out-1"],300)],ph.pop_in=[new $o.Frame(al["wwise-pop-in-1"],0),new $o.Frame(al["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new $o.Frame(al["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new $o.Frame(al["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],ph.pop_out=[new $o.Frame(al["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],ph.flip_in=[new $o.Frame(al["wwise-flip-in-1"],0),new $o.Frame(al["wwise-flip-in-2"],500)],ph.flip_out=[new $o.Frame(al["wwise-flip-out-1"],400)],ph.min_in=[new $o.Frame(al["wwise-min-in-1"],0),new $o.Frame(al["wwise-min-in-2"],350)],ph.min_out=[new $o.Frame(al["wwise-min-out-1"],400)];let WR=["top","bottom","left","right"];for(let a in WR){let e=WR[a];ph[e+"_in"]=[new $o.Frame(al["wwise-"+e+"-in-1"],0),new $o.Frame(al["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],ph[e+"_out"]=[new $o.Frame(al["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var Yw=ph;let bO={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class BS{static create(e,t){let n=e.getElementsByClassName("title")[0];n&&(n=n.innerHTML);let s=e.getElementsByClassName("content")[0];return s&&(s=s.innerHTML),Cr.removeElement(e),t.title=n,t.content=s,new BS(t)}constructor(e){this.options=JSON.parse(JSON.stringify(bO));for(let g in e)e[g]!=null&&(this.options[g]=e[g]);let t=this.options.position;if(t.indexOf(" ")==-1&&(t=="left"||t=="right"?t+=" center":t=t=="top"||t=="bottom"?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let g=document.getElementsByClassName("wwise-overlay");g.length?(this.overlay=g[0],this.hasOverlay=!0):(this.overlay=Cr.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let n="content";if(this.options.topbar){let g=[];this.options.topbar.showMin&&(g.push(Cr.createDiv(null,Cr.makeIconHTML("min"))),g[g.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(g.push(Cr.createDiv(null,Cr.makeIconHTML("close"))),g[g.length-1].addEventListener("click",this.close.bind(this,void 0)));let y=null;y=typeof this.options.title=="string"?Cr.createDiv("title",this.options.title):Cr.createDomTree({dom:Cr.createDiv("title"),children:[this.options.title]}),this.topbar=Cr.createDomTree({dom:Cr.createDiv("topbar"),children:[{dom:Cr.createDiv("control"),children:g.map(x=>({dom:x}))},{dom:y},{dom:Cr.createDiv("clear")}]})}else n+=" no-topbar";typeof this.options.content=="string"?this.content=Cr.createDomTree({dom:Cr.createDiv(n,this.options.content)}):this.content=Cr.createDomTree({dom:Cr.createDiv(n),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=Cr.createDomTree({dom:Cr.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let s=Cr.createDiv("wwise-wrapper");this.options.zIndex&&(s.style.zIndex=this.options.zIndex),this.wrapper=Cr.createDomTree({dom:s,children:[this.window]}),this.dom=Cr.createDomTree({dom:Cr.createDiv(),children:[this.wrapper]});let l=this.options.position.split(" "),c=-50,f=-50;if(l[0]=="left"?(c=0,this.wrapper.classList.add("left")):l[0]=="right"?(c=-100,this.wrapper.classList.add("right")):l[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=l[0],l[1]=="top"?(f=0,this.wrapper.classList.add("top")):l[1]=="bottom"?(f=-100,this.wrapper.classList.add("bottom")):l[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${c}%, ${f}%)`,this.options.style)for(let g in this.options.style)this.window.style[g]=this.options.style[g];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(n=>{this.promiseResolve=n}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new $o.Queue(this.wrapper,Yw[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&n.push(new $o.Queue(this.overlay,Yw.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new $o.Queue(this.wrapper,Yw[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&n.push(new $o.Queue(this.overlay,Yw.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(Cr.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),Cr.appendToBody(this.dom)}removeDoms(){Cr.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(Cr.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},n=window.getComputedStyle(this.wrapper),s=this.options.draggable,l=parseFloat(n.left),c=parseFloat(n.top);if(n.left.indexOf("%")!=-1){l=n.left,l=l.substr(0,l.length-1),l=parseInt(l);let f=window,g=document,y=g.documentElement,x=g.getElementsByTagName("body")[0];l=l*(f.innerWidth||y.clientWidth||x.clientWidth)/100}if(n.top.indexOf("%")!=-1){c=n.top,c=c.substr(0,c.length-1),c=parseInt(c);let f=window,g=document,y=g.documentElement,x=g.getElementsByTagName("body")[0];c=c*(f.innerHeight||y.clientHeight||x.clientHeight)/100}s!=1&&s!="horizontal"||(this.wrapper.style.left=l+t.x+"px"),s!=1&&s!="vertical"||(this.wrapper.style.top=c+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&t.nodeName!="HTML"||(this.inDragging=!1)}}var xO=BS,OS=class{constructor(a){let e=this.options=a;!e.type&&(e.type="ok");let t={topbar:!1};t.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),t.overlay=!0,t.keepOverlay=e.keepOverlay,t.clickOverlayToClose=!1,t.animation=e.animation,t.zIndex=e.zIndex,this.wwise=new xO(t)}constructContent(a){let e=Cr.createDiv("modal"),t=Cr.createDomTree({dom:Cr.createDiv("main "+a.type),children:[Cr.createDiv(null,Cr.makeIconHTML(a.type)),Cr.createDiv("title",a.title),Cr.createDiv("text",a.text)]});this.buttonArr=Cr.standardizeButtons(this,a);let n=Cr.makeButtons(this.buttonArr),s=null;a.content&&(s=typeof a.content=="string"?Cr.createDiv(null,a.content):a.content);let l=null;return n.innerHTML&&(l=Cr.createDomTree({dom:Cr.createDiv("operation "+a.type),children:[n]})),s||l||t.classList.add("no-op"),Cr.createDomTree({dom:e,children:[t,s,l]})}open(){if(this.wwise.opened)return;let a=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=Cr.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),a}close(a){if(this.wwise.opened)return this.value=a,Cr.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let wO={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},EO={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var Kw=__webpackgi_require__(513),LA={};Kw.Z&&Kw.Z.locals&&(LA.locals=Kw.Z.locals);var NS,kS=0,c_={};c_.styleTagTransform=mc(),c_.setAttributes=fp(),c_.insert=function(a,e){(e.target||document.head).appendChild(a)},c_.domAPI=fc(),c_.insertStyleElement=gp(),LA.use=function(a){return c_.options=a||{},kS++||(NS=pp()(Kw.Z,c_)),LA},LA.unuse=function(){kS>0&&!--kS&&(NS(),NS=null)};var SO=LA;class US extends Ln{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},Cr.appendToBody=t=>{e.container.appendChild(t)},Cr.makeIconHTML=t=>"",SO.use({target:e.container}),e.alert=async t=>{const n=t==null?void 0:t.split(":")[0],s=new OS({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return s.open(),s.getPromise()},e.confirm=async t=>{const n=t==null?void 0:t.split(":")[0],s=new OS({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return s.open(),await s.getPromise()==="yes"},e.prompt=async(t,n,s=!0)=>{const l=t==null?void 0:t.split(":")[0],c=new class{constructor(f){this.options=JSON.parse(JSON.stringify(wO));for(let S in f)f[S]!=null&&(this.options[S]=f[S]);let g=this.options,y=JSON.parse(JSON.stringify(EO));for(let S in y)g.hasOwnProperty(S)&&(y[S]=g[S]);let x=[];g.showCancel&&x.push({key:27,text:g.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),x.push({key:13,text:g.okText,onClick:this.handleOk.bind(this)}),y.buttons=x,this.input=Cr.createElement("input","input",null,{placeholder:g.placeholder}),this.error=Cr.createDiv("error"),y.content=Cr.createDomTree({dom:Cr.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new OS(y)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},f=>{this.error.innerText=f}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let f=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((g,y)=>{this.promiseResolve=g,this.promiseReject=y}),f}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:l??"&ndsp;",placeholder:n??"",showCancel:s,animation:"overlay",text:(t==null?void 0:t.replace(l||"","").replace(":",""))||""});return c.open(),await c.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}US.PluginType="WindowiseDialogPlugin";class FS extends Ln{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Shadow type",type:"dropdown",children:[["Basic",i._MY],["PCF",i._iA],["PCFSoft",Pt],["VSM",Et]].map(e=>({label:e[0],value:e[1]})),getValue:()=>{var e;return(e=this._viewer)==null?void 0:e.renderer.rendererObject.shadowMap.type},setValue:e=>{var t;(t=this._viewer)==null||t.doOnce("postFrame",()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())})}}),()=>{var e;return{label:((e=this._viewer)!=null&&e.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,r.setUrlQueryParam)("rgbm",(n=this._viewer)!=null&&n.useRgbm?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,r.setUrlQueryParam)("msaa",(n=this._viewer)!=null&&n.isAntialiased?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,r.setUrlQueryParam)("depthPrepass",(n=this._viewer)!=null&&n.useGBufferDepth?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,r.setUrlQueryParam)("debug",(n=this._viewer)!=null&&n.getPluginByType("debug")?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var t,n;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(ri))==null?void 0:n.storage;if(e instanceof Storage)e.clear();else if(e instanceof Cache){const s=await e.keys();await Promise.all(s.map(async l=>e.delete(l)))}localStorage.clear()}}]}}}FS.PluginType="ExtrasUiPlugin1";var $w=__webpackgi_require__(729),BA={};$w.Z&&$w.Z.locals&&(BA.locals=$w.Z.locals);var zS,VS=0,u_={};u_.styleTagTransform=mc(),u_.setAttributes=fp(),u_.insert=function(a,e){(e.target||document.head).appendChild(a)},u_.domAPI=fc(),u_.insertStyleElement=gp(),BA.use=function(a){return u_.options=a||{},VS++||(zS=pp()($w.Z,u_)),BA},BA.unuse=function(){VS>0&&!--VS&&(zS(),zS=null)};var TO=BA,Jw=__webpackgi_require__(109),OA={};Jw.Z&&Jw.Z.locals&&(OA.locals=Jw.Z.locals);var jS,GS=0,h_={};h_.styleTagTransform=mc(),h_.setAttributes=fp(),h_.insert=function(a,e){(e.target||document.head).appendChild(a)},h_.domAPI=fc(),h_.insertStyleElement=gp(),OA.use=function(a){return h_.options=a||{},GS++||(jS=pp()(Jw.Z,h_)),OA},OA.unuse=function(){GS>0&&!--GS&&(jS(),jS=null)};var MO=OA;const HS=new TextEncoder,CO={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},RO=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class IO{constructor({accessKeyId:e,secretAccessKey:t,sessionToken:n,service:s,region:l,cache:c,retries:f,initRetryMs:g}){if(e==null)throw new TypeError("accessKeyId is a required option");if(t==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=t,this.sessionToken=n,this.service=s,this.region=l,this.cache=c||new Map,this.retries=f??10,this.initRetryMs=g||50}async sign(e,t){if(e instanceof Request){const{method:l,url:c,headers:f,body:g}=e;(t=Object.assign({method:l,url:c,headers:f},t)).body==null&&f.has("Content-Type")&&(t.body=g!=null&&f.has("X-Amz-Content-Sha256")?g:await e.clone().arrayBuffer()),e=c}const n=new PO(Object.assign({url:e},t,this,t&&t.aws)),s=Object.assign({},t,await n.sign());delete s.aws;try{return new Request(s.url.toString(),s)}catch(l){if(l instanceof TypeError)return new Request(s.url.toString(),Object.assign({duplex:"half"},s));throw l}}async fetch(e,t){for(let n=0;n<=this.retries;n++){const s=fetch(await this.sign(e,t));if(n===this.retries)return s;const l=await s;if(l.status<500&&l.status!==429)return l;await new Promise(c=>setTimeout(c,Math.random()*this.initRetryMs*Math.pow(2,n)))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class PO{constructor({method:e,url:t,headers:n,body:s,accessKeyId:l,secretAccessKey:c,sessionToken:f,service:g,region:y,cache:x,datetime:S,signQuery:C,appendSessionToken:L,allHeaders:B,singleEncode:W}){if(t==null)throw new TypeError("url is a required option");if(l==null)throw new TypeError("accessKeyId is a required option");if(c==null)throw new TypeError("secretAccessKey is a required option");let q,Z;this.method=e||(s?"POST":"GET"),this.url=new URL(t),this.headers=new Headers(n||{}),this.body=s,this.accessKeyId=l,this.secretAccessKey=c,this.sessionToken=f,g&&y||([q,Z]=function(se,pe){const{hostname:be,pathname:Se}=se;if(be.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(be.endsWith(".backblazeb2.com")){const Qe=be.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return Qe!=null?["s3",Qe[1]]:["",""]}const Be=be.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[Ge,Xe]=(Be||["",""]).slice(1,3);if(Xe==="us-gov")Xe="us-gov-west-1";else if(Xe==="s3"||Xe==="s3-accelerate")Xe="us-east-1",Ge="s3";else if(Ge==="iot")Ge=be.startsWith("iot.")?"execute-api":be.startsWith("data.jobs.iot.")?"iot-jobs-data":Se==="/mqtt"?"iotdevicegateway":"iotdata";else if(Ge==="autoscaling"){const Qe=(pe.get("X-Amz-Target")||"").split(".")[0];Qe==="AnyScaleFrontendService"?Ge="application-autoscaling":Qe==="AnyScaleScalingPlannerFrontendService"&&(Ge="autoscaling-plans")}else Xe==null&&Ge.startsWith("s3-")?(Xe=Ge.slice(3).replace(/^fips-|^external-1/,""),Ge="s3"):Ge.endsWith("-fips")?Ge=Ge.slice(0,-5):Xe&&/-\d$/.test(Ge)&&!/-\d$/.test(Xe)&&([Ge,Xe]=[Xe,Ge]);return[CO[Ge]||Ge,Xe]}(this.url,this.headers)),this.service=g||q||"",this.region=y||Z||"us-east-1",this.cache=x||new Map,this.datetime=S||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=C,this.appendSessionToken=L||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service!=="s3"||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const j=this.signQuery?this.url.searchParams:this.headers;if(j.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&j.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(se=>B||!RO.has(se)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(se=>se+":"+(se==="host"?this.url.host:(this.headers.get(se)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service!=="s3"||j.has("X-Amz-Expires")||j.set("X-Amz-Expires","86400"),j.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),j.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),j.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");W||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=XR(this.encodedPath);const F=new Set;this.encodedSearch=[...this.url.searchParams].filter(([se])=>{if(!se)return!1;if(this.service==="s3"){if(F.has(se))return!1;F.add(se)}return!0}).map(se=>se.map(pe=>XR(encodeURIComponent(pe)))).sort(([se,pe],[be,Se])=>se<be?-1:se>be?1:pe<Se?-1:pe>Se?1:0).map(se=>se.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),t=[this.secretAccessKey,e,this.region,this.service].join();let n=this.cache.get(t);if(!n){const s=await NA("AWS4"+this.secretAccessKey,e),l=await NA(s,this.region),c=await NA(l,this.service);n=await NA(c,"aws4_request"),this.cache.set(t,n)}return WS(await NA(n,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,WS(await QR(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(e==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=WS(await QR(this.body||""))}return e}}async function NA(a,e){const t=await crypto.subtle.importKey("raw",typeof a=="string"?HS.encode(a):a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",t,HS.encode(e))}async function QR(a){return crypto.subtle.digest("SHA-256",typeof a=="string"?HS.encode(a):a)}function WS(a){return Array.prototype.map.call(new Uint8Array(a),e=>("0"+e.toString(16)).slice(-2)).join("")}function XR(a){return a.replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}var d_=function(a,e,t,n){var s,l=arguments.length,c=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,e,t,n);else for(var f=a.length-1;f>=0;f--)(s=a[f])&&(c=(l<3?s(c):l>3?s(e,t,c):s(e,t))||c);return l>3&&c&&Object.defineProperty(e,t,c),c};let iu=class extends Ln{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[_A],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1}connect(){this._connected&&this.disconnect(),this._client=new IO({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var a,e;(e=(a=this.uiConfig)==null?void 0:a.uiRefresh)==null||e.call(a,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(a){return this.serializeSettings?super.toJSON(a):{type:this.constructor.PluginType}}async onAdded(a){await super.onAdded(a);const e=a.getPlugin(_A);e.actions.exportFile=async(t,n,s)=>{if(!this._connected)return void await e.defaultActions.exportFile(t,n);const l=(0,r.pathJoin)([this.endpointURL,this.pathPrefix,n]),c=await this._fetch(l,{method:"PUT",body:t},s);if(!c.ok)return a.console.error("Error uploading file",c),void await e.defaultActions.exportFile(t,n);this.dispatchEvent({type:"fileUpload",name:n,blob:t,response:c,path:l}),a.console.log("File uploaded",c)}}async _fetch(a,e,t){if(!this._client)throw new Error("Not connected");for(let n=0;n<=this._client.retries;n++){const s=fetch(await this._client.sign(a,e));if(n===this._client.retries)return s;const l=await s;if(l.status<500&&l.status!==429)return l;await(0,r.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,n))}throw new Error("An unknown error occurred, ensure retries is not negative")}};function qR(){TO.use(),MO.use()}async function YR(a,e={}){var B,W;tm.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>a.container});const t=(0,r.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),n=(0,r.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,r.getUrlQueryParam)("logo-img")&&(n.style.backgroundImage=`url(${(0,r.getUrlQueryParam)("logo-img")})`),n.onclick=()=>{window.open((0,r.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const s=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
</svg>`;a.container.appendChild(n),tm(n,{placement:"right",content:"Powered by WebGi SDK"});const l=(0,r.createDiv)({innerHTML:s,id:"fsToggle",classList:["round-button"],addToBody:!1});l.dataset.tippyContent="Full-Screen",(B=a.getPlugin(po))==null||B.addEventListener("enter",()=>{l.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,l.dataset.tippyContent="Exit Full-Screen"}),(W=a.getPlugin(po))==null||W.addEventListener("exit",()=>{l.innerHTML=s,l.dataset.tippyContent="Full-Screen"}),l.onclick=()=>{var q;(q=a.getPlugin(po))==null||q.toggle(a.container)},a.container.appendChild(l),tm(l,{placement:"left"});const c=(0,r.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});a.container.appendChild(c);const f=[{id:"reset-settings",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Reset All Settings",onclick:async()=>{var Z;if(!await a.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const q=C.map(j=>a.getPlugin(j));for(const j of q)await((Z=j==null?void 0:j.resetDefaults)==null?void 0:Z.call(j))}},{id:"clear-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
 <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
</svg>`,tooltip:"Clear Scene",onclick:async()=>{await a.confirm("Clear scene: Are you sure you want to clear the scene?")&&a.scene.disposeSceneModels()}},{id:"fit-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />
</svg>`,tooltip:"Fit Object/Scene",onclick:async()=>{var q;await a.fitToView((q=a.getPlugin(Kr))==null?void 0:q.getSelectedObject())}},{id:"loop-cam-views",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{a.getPlugin(_s)&&(a.getPlugin(_s).viewLooping=!a.getPlugin(_s).viewLooping)}},{id:"play-gltf",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>`,tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var q;(q=a.getPlugin(Ss))==null||q.playPauseAnimation()}},{id:"auto-rotate-cc",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />
</svg>`,tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const q=a.scene.activeCamera.controls;q&&q.autoRotate!==void 0&&(q.autoRotate=!q.autoRotate)}},{id:"snapshot",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
</svg>`,tooltip:"Capture Snapshot",onclick:async()=>{const q=a.getPlugin(Na);q?await q.downloadSnapshot():a.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
</svg>`,tooltip:"Export GLB",onclick:async()=>{const q=a.getPlugin(im);q?await(q==null?void 0:q.downloadSceneGlb()):a.console.error("AssetExporterPlugin not added")}}];for(const q of f){const Z=(0,r.createDiv)({innerHTML:q.icon,id:q.id,classList:["button-bar-button","util-button"],addToBody:!1});Z.dataset.tippyContent=q.tooltip,Z.onclick=()=>{q.toggle&&Z.classList.toggle("button-bar-selected-box"),q.onclick()},c.appendChild(Z)}yI(tm(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const g=a.getPlugin(Kr),y=[{title:"Viewer",plugins:[nu,DA,Fd,kd]},{title:"Picking",plugins:[RA,Kr,Ls,Zh,Lu]},{title:"Scene",plugins:[MA,$c,CA,IA,PA,qu,dc,Pu]},{title:"Anti-aliasing",plugins:[na,Fl,Qf]},{title:"Post Processing",plugins:[Dh,eA,Ro,Im,km,ap,Gd,_f,vf,Bh,Xm,fa]},{title:"Export",plugins:[im,Na,ah,iu]},{title:"Animations",plugins:[Ss,_s,Ua,pm,bd]},{title:"Modifiers",plugins:[lh,yc,Ac,Du,rA,mA,ra]},{title:"Configurators",plugins:[Sp,Ep,Qh,AA]},{title:"Plugins",plugins:[ia,po,Oa,Qu,Vl,Ol,Al,Qc,Xu,Ul,Su,cd]},{title:"Extras",plugins:[FS]}];for(const[q,Z]of Object.entries(e)){const j=y.find(F=>F.title===q);j?j.plugins.push(...Z):y.push({title:q,plugins:[...Z]})}let x=y[2],S=[];const C=y.reduce((q,Z)=>q.concat(Z.plugins),[]);function L(q){var Z;x=q,g&&(g.enabled=!0),S=[];for(const j of C){const F=a.getPlugin(j);if(!(F!=null&&F.uiConfig))continue;const se=q.plugins.includes(j);(0,r.safeSetProperty)(F.uiConfig,"hidden",!se,!0),se&&S.push(F)}for(const j of y)(Z=j.div)==null||Z.classList[x!==j?"remove":"add"]("mode-button-selected","button-bar-selected");a.getPlugin(qw).refreshPluginsEnabled()}for(const q of y){const Z=(0,r.createDiv)({innerHTML:q.title,classList:["mode-button","button-bar-button"]});Z.onclick=()=>{L(q)},q.div=Z,t.appendChild(Z)}L(y[0]),g==null||g.addEventListener("selectedObjectChanged",()=>{g!=null&&g.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(x.title)&&L(y.find(q=>q.plugins.includes(Kr)))})}iu.PluginType="AWSClientPlugin1",d_([Pe(),We("Access Key ID",a=>({disabled:()=>!a.enabled||a._connected}))],iu.prototype,"accessKeyId",void 0),d_([Pe(),We("Access Key Secret",a=>({disabled:()=>!a.enabled||a._connected}))],iu.prototype,"accessKeySecret",void 0),d_([Pe(),We("Endpoint URL",a=>({disabled:()=>!a.enabled||a._connected}))],iu.prototype,"endpointURL",void 0),d_([Pe(),We("Path Prefix",a=>({disabled:()=>!a.enabled}))],iu.prototype,"pathPrefix",void 0),d_([Pe(),En("Remember",a=>({disabled:()=>!a.enabled||a._connected}))],iu.prototype,"serializeSettings",void 0),d_([Ee(void 0,a=>({label:()=>a._connected?"Disconnect":"Connect"}))],iu.prototype,"toggleConnection",void 0),iu=d_([lt("S3 Connection")],iu);var DO=bp({defaultModifiers:[Mv,ci,gr,Qr]}),LO=__webpackgi_require__(388),BO=__webpackgi_require__.n(LO);function OO(a){const e=[];a.traverse(s=>{s.geometry&&e.push(s)});const t={},n={};e.forEach(s=>{if(!t[s.geometry.uuid]){const f=s.geometry.toJSON().data,g=f?BO()({a:f.attributes||{},b:f.index||[]}):"";t[s.geometry.uuid]=g}const l=t[s.geometry.uuid],c=n[l]??(n[l]=[]);c.includes(s)||c.push(s)}),Object.values(n).forEach(s=>{if(s.length<2)return;const l=s[0].geometry;s.forEach((c,f)=>{f<1||(c.geometry.dispose(),c.geometry=l)})})}const Gp=new i.Pa4,p_=new i.Pa4,Zw=new i.Pa4,QS=new i.Pa4,eE=new i.Pa4,d0=new i.Pa4;let XS=1;const kO=new i.Pa4(0,1,0);class UO extends Zn{constructor(e,t){super(e,t),this.throttleUpdate=60,this.targetOffset=new i.Pa4(0,0,0);const n=this.update;this.update=()=>this._update(n)}_update(e){this.target.add(this.targetOffset),Gp.copy(this.object.position).sub(this.target),XS=Gp.length(),d0.copy(this.target);const t=e();return d0.sub(this.target),Gp.copy(this.object.position).sub(this.target),XS/=Gp.length(),this.target.add(d0),this.object.position.copy(this.target).add(Gp),Gp.normalize(),p_.crossVectors(kO,Gp).normalize(),Zw.crossVectors(Gp,p_).normalize(),QS.crossVectors(p_,Zw).normalize().negate(),p_.length()>.1&&this.object.up.crossVectors(Gp.clone().normalize(),p_),this.enablePan&&(eE.set(0,0,0).addScaledVector(p_,d0.x).addScaledVector(Zw,d0.y).addScaledVector(QS,d0.z),this.targetOffset.add(eE),this.targetOffset.multiplyScalar(1/XS)),eE.set(0,0,0).addScaledVector(p_,-this.targetOffset.x).addScaledVector(Zw,-this.targetOffset.y).addScaledVector(QS,-this.targetOffset.z),this.object.lookAt(eE.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class tE extends r.SimpleEventDispatcher{_setOptions(e){var t;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=tE.GetSupportedMimeTypes([],["h264"],!0)??tE.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!((t=this._options.mimeType)!=null&&t.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=s=>{var l;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const c=new Blob(this._currentRecording,{type:this._options.mimeType});(l=this._recordingCallback)==null||l.call(this,c)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=s=>{var l;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((l=this._recorder)==null||l.pause())},this._onresume=s=>{if(!this.stepMode)return;const l=()=>{var f;this._state==="recording"&&((f=this._recorder)==null||f.pause())},c=Math.min(this._resumeSyncTime-(0,r.now)(),0)+1e3/this._options.frameRate;c>0?(0,r.timeout)(c).then(l):l()},this._onpause=s=>{},this._ondataavailable=s=>{s.data&&s.data.size>0&&this._currentRecording.push(s.data)},this._onerror=s=>{this._state="error",this._console.error(s),this.dispatchEvent({type:"error",error:s}),this._recorder=void 0},this._canvas=e;const n=t==null?void 0:t.mimeType;this._options={mimeType:n||"auto",frameRate:30,stepMode:!1},this._setOptions(t||this._options)}isRecording(){return this._state==="recording"}start(){var t,n,s;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const e={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(t=e.mimeType)==null?void 0:t.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const l=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),c=(n=l.getVideoTracks())==null?void 0:n[0];this._track=c,this._recorder=new window.MediaRecorder(l,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(s=this._recorder)==null||s.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async l=>{const c=await(l==null?void 0:l.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=c,this._state="recording",this._onstart({})}).catch(l=>{this._onerror({detail:l})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=(0,r.now)(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const t=await Promise.all(e.map(async([s,l])=>await(await fetch(l)).blob())),n=[];for(let s=0;s<e.length;s++){const l=await this._imgDirectory.getFileHandle(e[s][0],{create:!0});n.push((0,r.writeFile)(l,t[s]))}await Promise.all(n)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const s=["webm","ogg","mp4","x-matroska"].filter(f=>!e||e.length<1||e.includes(f)),l=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(f=>!t||t.length<1||t.includes(f)),c=[];return s.forEach(f=>{const g=`video/${f}`;l.forEach(y=>{[`${g};codecs=${y}`,`${g};codecs:${y}`,`${g};codecs=${y.toUpperCase()}`,`${g};codecs:${y.toUpperCase()}`,`${g}`].forEach(x=>{MediaRecorder.isTypeSupported(x)&&c.push(x)})})}),n?c.length>0?c[0]:void 0:c}}class FO extends C0{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new i.cJO(1,0))}}function qS(a,e){const t=Array.from((a.access??"").split(".")),n=t.pop();let s=a.targetObject??e;if(!n||n.length===0)return{key:void 0,tar:s};if(s=(0,r.deepAccessObject)(t,s),s&&!(n in s))throw console.error("invalid key",n,s,e,a),"";return{key:n,tar:s}}function YS(a,e,t,n){const{key:s,tar:l}=qS(a,e);return s&&l?op(l,s,()=>{var c;t&&((c=a.updater)!=null&&c.length)&&a.updater.forEach(f=>t[f]()),n==null||n()}):c=>console.warn("Unable to set ",c,s,l,a,e)}async function nE(a,e,t){const{key:n,tar:s}=qS(e,a),l=e.animSet?[KR(s,e.animSet,t,e.animSetParallel??!1)]:[];if(n&&s){const c=e.updater??[],f=async()=>iv(s,n,{...e,onUpdate:g=>{var y;(y=e.onUpdate)==null||y.call(e,g),c.forEach(x=>{var S;return(S=t[x])==null?void 0:S.call(t)})}});e.delay?l.push((0,r.timeout)(e.delay).then(f)):l.push(f())}else(e.duration||e.delay)&&l.push((0,r.timeout)((e.delay??0)+(e.duration??0)));return l.length===1?l[0]:Promise.all(l)}async function KR(a,e,t,n=!1){if(n)return Promise.all(e.map(async s=>nE(a,s,t)));for(const s of e)await nE(a,s,t)}function $R(a,e,t,n){var c,f;if(!a)return;e||(e=[]);const s=n??{},l=a;for(let g=0,y=e.length;g<y;g++){const x=e[g];if(x.uiRef){const C=(l==null?void 0:l.indexOf(x.uiRef))??-1;C!==g&&(C>=0&&(l==null||l.splice(C,1)),l==null||l.splice(g,0,x.uiRef))}else{x.uiRef={type:"folder",label:x.name??"Animation "+g,children:[]};const C=[{type:"button",label:"animate",value:()=>{nE(t,x,s).then(()=>{var L;return console.log(((L=x.uiRef)==null?void 0:L.label)+" finished")})}}];x.access!==void 0&&C.push({type:"input",property:[x,"access"]}),x.from!==void 0&&C.push({type:x.uiObjectType??"input",property:[x,"from"],onChange:()=>{var L;YS(x,t)(x.from),(L=x.updater)==null||L.forEach(B=>B in s&&s[B]())}}),x.to!==void 0&&C.push({type:x.uiObjectType??"input",property:[x,"to"],onChange:()=>{var L;YS(x,t)(x.to),(L=x.updater)==null||L.forEach(B=>B in s&&s[B]())}}),x.duration!==void 0&&C.push({type:"input",property:[x,"duration"]}),x.animSet&&(x.animSetParallel||(x.animSetParallel=!1),C.push({type:"input",label:"run parallel",property:[x,"animSetParallel"]})),x.animSet&&C.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(c=x.uiRef.children)==null||c.push(...C),l==null||l.splice(g,0,x.uiRef)}const S=(f=x.uiRef.children)==null?void 0:f.map(C=>(0,r.getOrCall)(C)).flat(2).find(C=>C==null?void 0:C.animSetContainer);x.animSet&&S&&$R(S.children,x.animSet,x.targetObject??t,n)}}const zO={Background:new nm({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map(a=>({path:a}))}).assets,Environment:new nm({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map(a=>({path:a}))}).assets,GemEnvironment:new nm({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(a=>({path:a}))}).assets,Ground:new nm({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map(a=>({path:a}))}).assets,CameraViews:new nm({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map(a=>({path:a}))}).assets,MaterialConfiguration:new nm({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map(a=>({path:a}))}).assets,MaterialLibraries:new nm({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map(a=>({path:a}))}).assets};function JR(a,e){return e?a*(1e3/e):0}function VO(a){var e,t=a.from,n=t===void 0?0:t,s=a.velocity,l=s===void 0?0:s,c=a.min,f=a.max,g=a.power,y=g===void 0?.8:g,x=a.timeConstant,S=x===void 0?750:x,C=a.bounceStiffness,L=C===void 0?500:C,B=a.bounceDamping,W=B===void 0?10:B,q=a.restDelta,Z=q===void 0?1:q,j=a.modifyTarget,F=a.driver,se=a.onUpdate,pe=a.onComplete,be=a.onStop;function Se(mt){return c!==void 0&&mt<c||f!==void 0&&mt>f}function Be(mt){return c===void 0?f:f===void 0||Math.abs(c-mt)<Math.abs(f-mt)?c:f}function Ge(mt){e==null||e.stop(),e=Ju(io(io({},mt),{driver:F,onUpdate:function(vt){var Qt;se==null||se(vt),(Qt=mt.onUpdate)===null||Qt===void 0||Qt.call(mt,vt)},onComplete:pe,onStop:be}))}function Xe(mt){Ge(io({type:"spring",stiffness:L,damping:W,restDelta:Z},mt))}if(Se(n))Xe({from:n,velocity:l,to:Be(n)});else{var Qe=y*l+n;j!==void 0&&(Qe=j(Qe));var at,Ke,Je=Be(Qe),ft=Je===c?-1:1;Ge({type:"decay",from:n,velocity:l,timeConstant:S,power:y,restDelta:Z,modifyTarget:j,onUpdate:Se(Qe)?function(mt){at=Ke,Ke=mt,l=JR(mt-at,sp().delta),(ft===1&&mt>Je||ft===-1&&mt<Je)&&Xe({from:mt,to:Je,velocity:l})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var ZR=function(a){return 180*a/Math.PI},jO=function(a,e){return e===void 0&&(e=np),ZR(Math.atan2(e.y-a.y,e.x-a.x))},GO=function(a,e){var t=!0;return e===void 0&&(e=a,t=!1),function(n){return t?n-a+e:(a=n,t=!0,e)}},HO=function(a){return a},KS=function(a){return a===void 0&&(a=HO),function(e,t,n){var s=t-n,l=-(0-e+1)*(0-a(Math.abs(s)));return s<=0?t+l:t-l}},WO=KS(),QO=KS(Math.sqrt),eI=function(a){return a*Math.PI/180},iE=function(a){return a.hasOwnProperty("x")&&a.hasOwnProperty("y")},$S=function(a){return iE(a)&&a.hasOwnProperty("z")},rE=function(a,e){return Math.abs(a-e)};function XO(a,e){if(ip(a)&&ip(e))return rE(a,e);if(iE(a)&&iE(e)){var t=rE(a.x,e.x),n=rE(a.y,e.y),s=$S(a)&&$S(e)?rE(a.z,e.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(n,2)+Math.pow(s,2))}}var qO=function(a,e,t){return e=eI(e),{x:t*Math.cos(e)+a.x,y:t*Math.sin(e)+a.y}},tI=function(a,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(a*e)/e},nI=function(a,e,t,n){return n===void 0&&(n=0),tI(a+t*(e-a)/Math.max(n,t))},YO=function(a){a===void 0&&(a=50);var e=0,t=0;return function(n){var s=sp().timestamp,l=s!==t?s-t:0,c=l?nI(e,n,l,a):e;return t=s,e=c,c}},KO=function(a){if(typeof a=="number")return function(n){return Math.round(n/a)*a};var e=0,t=a.length;return function(n){var s=Math.abs(a[0]-n);for(e=1;e<t;e++){var l=a[e],c=Math.abs(l-n);if(c===0)return l;if(c>s)return a[e-1];if(e===t-1)return l;s=c}}};function $O(a,e){return a/(1e3/e)}var JO=function(a,e,t){var n=e-a;return((t-a)%n+n)%n+a},iI=function(a,e){return 1-3*e+3*a},rI=function(a,e){return 3*e-6*a},sI=function(a){return 3*a},sE=function(a,e,t){return((iI(e,t)*a+rI(e,t))*a+sI(e))*a},oI=function(a,e,t){return 3*iI(e,t)*a*a+2*rI(e,t)*a+sI(e)},ZO=1e-7,eN=10,tN=8,nN=.001,oE=11,aE=1/(oE-1);function iN(a,e,t,n){if(a===e&&t===n)return Yd;for(var s=new Float32Array(oE),l=0;l<oE;++l)s[l]=sE(l*aE,a,t);return function(c){return c===0||c===1?c:sE(function(f){for(var g=0,y=1,x=oE-1;y!==x&&s[y]<=f;++y)g+=aE;--y;var S=g+(f-s[y])/(s[y+1]-s[y])*aE,C=oI(S,a,t);return C>=nN?function(L,B,W,q){for(var Z=0;Z<tN;++Z){var j=oI(B,W,q);if(j===0)return B;B-=(sE(B,W,q)-L)/j}return B}(f,S,a,t):C===0?S:function(L,B,W,q,Z){var j,F,se=0;do(j=sE(F=B+(W-B)/2,q,Z)-L)>0?W=F:B=F;while(Math.abs(j)>ZO&&++se<eN);return F}(f,g,g+aE,a,t)}(c),e,n)}}var rN=function(a,e){return e===void 0&&(e="end"),function(t){var n=(t=e==="end"?Math.min(t,.999):Math.max(t,.001))*a,s=e==="end"?Math.floor(n):Math.ceil(n);return jh(0,1,s/a)}};class sN extends Bl{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,qR()}async setupUi(e){await YR(this,e),this._editorInitialized=!0}}async function aI(a,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:s=!1,importPopup:l=!0,caching:c=!0}){a.enabled=!1,e&&await a.addPlugin(ih),a.getPlugin(ri)||await a.addPlugin(ri,void 0,void 0,{storage:c&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await a.addPlugin(im),await a.addPlugin(L1),await a.addPlugin(_A),l&&await a.addPlugin(Su),await a.addPlugin(vp,!1),await a.addPlugin(US),await a.addPlugin(Xc),await a.addPlugin(Kt),await a.addPlugin(a1),await a.addPlugin(c1),await a.addPlugin(s1),await a.addPlugin(u1),await a.addPlugin(l1),await a.addPlugin(Wv),await a.addPlugin(kd),await a.addPlugin(bd),await a.addPlugin(Kr,R0,!1,!0),await cx(a,{ground:t,bloom:n,depthTonemap:s}),await a.addPlugin(eA),await a.addPlugin(Du,!1),await a.addPlugin(hS),await a.addPlugin(fS),await a.addPlugin(mS),await a.addPlugin(cd,!1),await a.addPlugin(lh),await a.addPlugin(yc),await a.addPlugin(Ac),await a.addPlugin(Ep),await a.addPlugin(Sp),await a.addPlugin(AA),await a.addPlugin(Zh),await a.addPlugin(ah),await a.addPlugin(Na),await a.addPlugin(RA),await a.addPlugin(CA),await a.addPlugin(IA),await a.addPlugin(PA),await a.addPlugin(nu),await a.addPlugin(DA),await a.addPlugin(MA),await a.addPlugin(Lu),await a.addPlugin(pm,a.container,!1),await a.addPlugin(iu);const f=await a.addPlugin(new qw(!(0,r.mobileAndTabletCheck)()));return a.renderer.refreshPipeline(),a.scene.addEventListener("textureAdded",g=>{g.texture&&a.scene.setEnvironment(g.texture)}),f.setupPluginUi(po),f.setupPluginUi(nu),f.setupPluginUi(DA),f.setupPluginUi(kd),f.setupPluginUi(MA),f.setupPluginUi(im),f.setupPluginUi(Ss),f.setupPluginUi(qu),f.setupPluginUi(Sp),f.setupPluginUi(Ep),f.setupPluginUi(bd),f.setupPluginUi(RA),f.setupPluginUi(Zh),f.setupPluginUi(Ls),f.setupPluginUi(Kr),t&&f.setupPluginUi($c),t&&f.setupPluginUi(Pu),f.setupPluginUi(Gd),f.setupPluginUi(_s),f.setupPluginUi(ah),f.setupPluginUi(Dh),f.setupPluginUi(eA),f.setupPluginUi(Im),f.setupPluginUi(km),f.setupPluginUi(Ro),f.setupPluginUi(ap),f.setupPluginUi(Bh),f.setupPluginUi(_f),f.setupPluginUi(Xu),f.setupPluginUi(Qc),f.setupPluginUi(CA),f.setupPluginUi(lh),f.setupPluginUi(yc),f.setupPluginUi(na),f.setupPluginUi(IA),f.setupPluginUi(PA),f.setupPluginUi(Ol),f.setupPluginUi(Al),f.setupPluginUi(Ul),n&&f.setupPluginUi(vf),f.setupPluginUi(Na),f.setupPluginUi(ia),f.setupPluginUi(Fl),f.setupPluginUi(dc),f.setupPluginUi(Xm),f.setupPluginUi(fa),f.setupPluginUi(Ac),f.setupPluginUi(Qu),f.setupPluginUi(Qf),f.setupPluginUi(Fd),f.setupPluginUi(Qh),f.setupPluginUi(Oa),f.setupPluginUi(Du),f.setupPluginUi(Su),f.setupPluginUi(Ua),f.setupPluginUi(cd),f.setupPluginUi(iu),f.setupPluginUi(pm),f.setupPluginUi(Lu),f.setupPluginUi(AA),f.setupPluginUi(ra),a.enabled=!0,a}async function oN(a,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:s=!1,importPopup:l=!0,caching:c=!0}){const f=new Bl(a);return await aI(f,{debug:e,ground:t,bloom:n,depthTonemap:s,importPopup:l,caching:c}),f}async function aN(a,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:s=!0,importPopup:l=!1,enableDrop:c=!1,caching:f=!0}={}){const g=new Bl(a);return e&&await g.addPlugin(ih),g.getPlugin(ri)||g.addPluginSync(ri,void 0,void 0,{storage:f&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await g.addPlugin(vp,!0),await cx(g,{ground:t,bloom:n,depthTonemap:s,enableDrop:c,importPopup:l}),g}})();__webpackgi_exports__.MWW;__webpackgi_exports__.LY2;__webpackgi_exports__.GYo;__webpackgi_exports__.GPz;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.Mp4;__webpackgi_exports__.QvI;__webpackgi_exports__.PrA;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.bBp;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;__webpackgi_exports__.SwW;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.w7U;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.MMq;__webpackgi_exports__.qKx;__webpackgi_exports__.Hmi;__webpackgi_exports__.X4S;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.Z_g;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__.N_j;__webpackgi_exports__.hNv;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.c0Q;__webpackgi_exports__.re0;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.ntt;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.n94;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.N1Y;__webpackgi_exports__.itK;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.eBg;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.hFL;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.izP;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.Dzq;__webpackgi_exports__.zCA;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.NKC;__webpackgi_exports__.jrv;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.SJj;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;__webpackgi_exports__.s5b;__webpackgi_exports__.BHZ;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__.lth;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.OPJ;__webpackgi_exports__.PpQ;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.w_R;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.L1_;__webpackgi_exports__.blk;__webpackgi_exports__.YRm;__webpackgi_exports__.ejS;__webpackgi_exports__.wUb;__webpackgi_exports__.zOz;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;var __webpackgi_exports__MaterialConfiguratorBasePlugin=__webpackgi_exports__.EDU,__webpackgi_exports__MaterialConfiguratorPlugin=__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.ZqF;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.CRe;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.RPs;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__.rCq;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.oxT;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.mjX;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.eqi;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__.B2H;__webpackgi_exports__._Pm;__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.ZTh;__webpackgi_exports__.HdW;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.G_r;__webpackgi_exports__.N3F;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.lGU;__webpackgi_exports__.vuL;__webpackgi_exports__.KI_;__webpackgi_exports__.iLN;__webpackgi_exports__.X6w;__webpackgi_exports__.rz_;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.Rnn;__webpackgi_exports__.TyN;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.Jxm;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.Y4W;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.zG7;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.ub3;__webpackgi_exports__.OV;__webpackgi_exports__.G_n;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.t0w;__webpackgi_exports__.M7$;__webpackgi_exports__.ML4;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.v27;__webpackgi_exports__.Uk6;__webpackgi_exports__.H7Z;__webpackgi_exports__._sL;__webpackgi_exports__.czO;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.zC5;var __webpackgi_exports__addBasePlugins=__webpackgi_exports__.Bve;__webpackgi_exports__.UeO;__webpackgi_exports__.qCx;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.EER;__webpackgi_exports__.y4l;__webpackgi_exports__.P39;__webpackgi_exports__.HI1;__webpackgi_exports__.ZYi;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.iwT;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.sMc;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.RGi;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.Wz1;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.CN8;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.Zj8;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.f1L;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.a95;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.JFD;__webpackgi_exports__.gw2;__webpackgi_exports__.rfc;__webpackgi_exports__.wo6;__webpackgi_exports__.V4T;__webpackgi_exports__.H4P;__webpackgi_exports__.NLp;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;var __webpackgi_exports__imageBitmapToBase64=__webpackgi_exports__.V7q;__webpackgi_exports__.hiB;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.NN$;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.GGm;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;var __webpackgi_exports__makeColorSvgCircle=__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.i8W;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__.N4A;__webpackgi_exports__.hjq;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.Kd3;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.pJq;__webpackgi_exports__.YPW;__webpackgi_exports__._tY;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.Rgz;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.Sy1;__webpackgi_exports__.Vs_;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.doP;__webpackgi_exports__.$jA;__webpackgi_exports__.T99;__webpackgi_exports__.LJS;__webpackgi_exports__.VsW;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.BFq;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.NSm;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;function toTrianglesDrawMode(u,r){if(r===TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),u;if(r===TriangleFanDrawMode||r===TriangleStripDrawMode){let i=u.getIndex();if(i===null){const w=[],T=u.getAttribute("position");if(T!==void 0){for(let R=0;R<T.count;R++)w.push(R);u.setIndex(w),i=u.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),u}const m=i.count-2,_=[];if(r===TriangleFanDrawMode)for(let w=1;w<=m;w++)_.push(i.getX(0)),_.push(i.getX(w)),_.push(i.getX(w+1));else for(let w=0;w<m;w++)w%2===0?(_.push(i.getX(w)),_.push(i.getX(w+1)),_.push(i.getX(w+2))):(_.push(i.getX(w+2)),_.push(i.getX(w+1)),_.push(i.getX(w)));_.length/3!==m&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const A=u.clone();return A.setIndex(_),A.clearGroups(),A}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",r),u}class GLTFLoader extends Loader{constructor(r){super(r),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new GLTFMaterialsClearcoatExtension(i)}),this.register(function(i){return new GLTFTextureBasisUExtension(i)}),this.register(function(i){return new GLTFTextureWebPExtension(i)}),this.register(function(i){return new GLTFTextureAVIFExtension(i)}),this.register(function(i){return new GLTFMaterialsSheenExtension(i)}),this.register(function(i){return new GLTFMaterialsTransmissionExtension(i)}),this.register(function(i){return new GLTFMaterialsVolumeExtension(i)}),this.register(function(i){return new GLTFMaterialsIorExtension(i)}),this.register(function(i){return new GLTFMaterialsEmissiveStrengthExtension(i)}),this.register(function(i){return new GLTFMaterialsSpecularExtension(i)}),this.register(function(i){return new GLTFMaterialsIridescenceExtension(i)}),this.register(function(i){return new GLTFMaterialsAnisotropyExtension(i)}),this.register(function(i){return new GLTFLightsExtension(i)}),this.register(function(i){return new GLTFMeshoptCompression(i)}),this.register(function(i){return new GLTFMeshGpuInstancing(i)})}load(r,i,m,_){const A=this;let w;this.resourcePath!==""?w=this.resourcePath:this.path!==""?w=this.path:w=LoaderUtils.extractUrlBase(r),this.manager.itemStart(r);const T=function(D){_?_(D):console.error(D),A.manager.itemError(r),A.manager.itemEnd(r)},R=new FileLoader(this.manager);R.setPath(this.path),R.setResponseType("arraybuffer"),R.setRequestHeader(this.requestHeader),R.setWithCredentials(this.withCredentials),R.load(r,function(D){try{A.parse(D,w,function(U){i(U),A.manager.itemEnd(r)},T)}catch(U){T(U)}},m,T)}setDRACOLoader(r){return this.dracoLoader=r,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(r){return this.ktx2Loader=r,this}setMeshoptDecoder(r){return this.meshoptDecoder=r,this}register(r){return this.pluginCallbacks.indexOf(r)===-1&&this.pluginCallbacks.push(r),this}unregister(r){return this.pluginCallbacks.indexOf(r)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(r),1),this}parse(r,i,m,_){let A;const w={},T={},R=new TextDecoder;if(typeof r=="string")A=JSON.parse(r);else if(r instanceof ArrayBuffer)if(R.decode(new Uint8Array(r,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{w[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(r)}catch(k){_&&_(k);return}A=JSON.parse(w[EXTENSIONS.KHR_BINARY_GLTF].content)}else A=JSON.parse(R.decode(r));else A=r;if(A.asset===void 0||A.asset.version[0]<2){_&&_(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const D=new GLTFParser(A,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});D.fileLoader.setRequestHeader(this.requestHeader);for(let U=0;U<this.pluginCallbacks.length;U++){const k=this.pluginCallbacks[U](D);T[k.name]=k,w[k.name]=!0}if(A.extensionsUsed)for(let U=0;U<A.extensionsUsed.length;++U){const k=A.extensionsUsed[U],X=A.extensionsRequired||[];switch(k){case EXTENSIONS.KHR_MATERIALS_UNLIT:w[k]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:w[k]=new GLTFDracoMeshCompressionExtension(A,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:w[k]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:w[k]=new GLTFMeshQuantizationExtension;break;default:X.indexOf(k)>=0&&T[k]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+k+'".')}}D.setExtensions(w),D.setPlugins(T),D.parse(m,_)}parseAsync(r,i){const m=this;return new Promise(function(_,A){m.parse(r,i,_,A)})}}function GLTFRegistry(){let u={};return{get:function(r){return u[r]},add:function(r,i){u[r]=i},remove:function(r){delete u[r]},removeAll:function(){u={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const r=this.parser,i=this.parser.json.nodes||[];for(let m=0,_=i.length;m<_;m++){const A=i[m];A.extensions&&A.extensions[this.name]&&A.extensions[this.name].light!==void 0&&r._addNodeRef(this.cache,A.extensions[this.name].light)}}_loadLight(r){const i=this.parser,m="light:"+r;let _=i.cache.get(m);if(_)return _;const A=i.json,R=((A.extensions&&A.extensions[this.name]||{}).lights||[])[r];let D;const U=new Color(16777215);R.color!==void 0&&U.setRGB(R.color[0],R.color[1],R.color[2],LinearSRGBColorSpace);const k=R.range!==void 0?R.range:0;switch(R.type){case"directional":D=new DirectionalLight(U),D.target.position.set(0,0,-1),D.add(D.target);break;case"point":D=new PointLight(U),D.distance=k;break;case"spot":D=new SpotLight(U),D.distance=k,R.spot=R.spot||{},R.spot.innerConeAngle=R.spot.innerConeAngle!==void 0?R.spot.innerConeAngle:0,R.spot.outerConeAngle=R.spot.outerConeAngle!==void 0?R.spot.outerConeAngle:Math.PI/4,D.angle=R.spot.outerConeAngle,D.penumbra=1-R.spot.innerConeAngle/R.spot.outerConeAngle,D.target.position.set(0,0,-1),D.add(D.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+R.type)}return D.position.set(0,0,0),D.decay=2,assignExtrasToUserData(D,R),R.intensity!==void 0&&(D.intensity=R.intensity),D.name=i.createUniqueName(R.name||"light_"+r),_=Promise.resolve(D),i.cache.add(m,_),_}getDependency(r,i){if(r==="light")return this._loadLight(i)}createNodeAttachment(r){const i=this,m=this.parser,A=m.json.nodes[r],T=(A.extensions&&A.extensions[this.name]||{}).light;return T===void 0?null:this._loadLight(T).then(function(R){return m._getNodeRef(i.cache,T,R)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(r,i,m){const _=[];r.color=new Color(1,1,1),r.opacity=1;const A=i.pbrMetallicRoughness;if(A){if(Array.isArray(A.baseColorFactor)){const w=A.baseColorFactor;r.color.setRGB(w[0],w[1],w[2],LinearSRGBColorSpace),r.opacity=w[3]}A.baseColorTexture!==void 0&&_.push(m.assignTexture(r,"map",A.baseColorTexture,SRGBColorSpace))}return Promise.all(_)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(r,i){const _=this.parser.json.materials[r];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const A=_.extensions[this.name].emissiveStrength;return A!==void 0&&(i.emissiveIntensity=A),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(r){const m=this.parser.json.materials[r];return!m.extensions||!m.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(r,i){const m=this.parser,_=m.json.materials[r];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const A=[],w=_.extensions[this.name];if(w.clearcoatFactor!==void 0&&(i.clearcoat=w.clearcoatFactor),w.clearcoatTexture!==void 0&&A.push(m.assignTexture(i,"clearcoatMap",w.clearcoatTexture)),w.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=w.clearcoatRoughnessFactor),w.clearcoatRoughnessTexture!==void 0&&A.push(m.assignTexture(i,"clearcoatRoughnessMap",w.clearcoatRoughnessTexture)),w.clearcoatNormalTexture!==void 0&&(A.push(m.assignTexture(i,"clearcoatNormalMap",w.clearcoatNormalTexture)),w.clearcoatNormalTexture.scale!==void 0)){const T=w.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new Vector2(T,T)}return Promise.all(A)}}class GLTFMaterialsIridescenceExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(r){const m=this.parser.json.materials[r];return!m.extensions||!m.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(r,i){const m=this.parser,_=m.json.materials[r];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const A=[],w=_.extensions[this.name];return w.iridescenceFactor!==void 0&&(i.iridescence=w.iridescenceFactor),w.iridescenceTexture!==void 0&&A.push(m.assignTexture(i,"iridescenceMap",w.iridescenceTexture)),w.iridescenceIor!==void 0&&(i.iridescenceIOR=w.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),w.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=w.iridescenceThicknessMinimum),w.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=w.iridescenceThicknessMaximum),w.iridescenceThicknessTexture!==void 0&&A.push(m.assignTexture(i,"iridescenceThicknessMap",w.iridescenceThicknessTexture)),Promise.all(A)}}class GLTFMaterialsSheenExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(r){const m=this.parser.json.materials[r];return!m.extensions||!m.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(r,i){const m=this.parser,_=m.json.materials[r];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const A=[];i.sheenColor=new Color(0,0,0),i.sheenRoughness=0,i.sheen=1;const w=_.extensions[this.name];if(w.sheenColorFactor!==void 0){const T=w.sheenColorFactor;i.sheenColor.setRGB(T[0],T[1],T[2],LinearSRGBColorSpace)}return w.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=w.sheenRoughnessFactor),w.sheenColorTexture!==void 0&&A.push(m.assignTexture(i,"sheenColorMap",w.sheenColorTexture,SRGBColorSpace)),w.sheenRoughnessTexture!==void 0&&A.push(m.assignTexture(i,"sheenRoughnessMap",w.sheenRoughnessTexture)),Promise.all(A)}}class GLTFMaterialsTransmissionExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(r){const m=this.parser.json.materials[r];return!m.extensions||!m.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(r,i){const m=this.parser,_=m.json.materials[r];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const A=[],w=_.extensions[this.name];return w.transmissionFactor!==void 0&&(i.transmission=w.transmissionFactor),w.transmissionTexture!==void 0&&A.push(m.assignTexture(i,"transmissionMap",w.transmissionTexture)),Promise.all(A)}}class GLTFMaterialsVolumeExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(r){const m=this.parser.json.materials[r];return!m.extensions||!m.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(r,i){const m=this.parser,_=m.json.materials[r];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const A=[],w=_.extensions[this.name];i.thickness=w.thicknessFactor!==void 0?w.thicknessFactor:0,w.thicknessTexture!==void 0&&A.push(m.assignTexture(i,"thicknessMap",w.thicknessTexture)),i.attenuationDistance=w.attenuationDistance||1/0;const T=w.attenuationColor||[1,1,1];return i.attenuationColor=new Color().setRGB(T[0],T[1],T[2],LinearSRGBColorSpace),Promise.all(A)}}class GLTFMaterialsIorExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(r){const m=this.parser.json.materials[r];return!m.extensions||!m.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(r,i){const _=this.parser.json.materials[r];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const A=_.extensions[this.name];return i.ior=A.ior!==void 0?A.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(r){const m=this.parser.json.materials[r];return!m.extensions||!m.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(r,i){const m=this.parser,_=m.json.materials[r];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const A=[],w=_.extensions[this.name];i.specularIntensity=w.specularFactor!==void 0?w.specularFactor:1,w.specularTexture!==void 0&&A.push(m.assignTexture(i,"specularIntensityMap",w.specularTexture));const T=w.specularColorFactor||[1,1,1];return i.specularColor=new Color().setRGB(T[0],T[1],T[2],LinearSRGBColorSpace),w.specularColorTexture!==void 0&&A.push(m.assignTexture(i,"specularColorMap",w.specularColorTexture,SRGBColorSpace)),Promise.all(A)}}class GLTFMaterialsAnisotropyExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(r){const m=this.parser.json.materials[r];return!m.extensions||!m.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(r,i){const m=this.parser,_=m.json.materials[r];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const A=[],w=_.extensions[this.name];return w.anisotropyStrength!==void 0&&(i.anisotropy=w.anisotropyStrength),w.anisotropyRotation!==void 0&&(i.anisotropyRotation=w.anisotropyRotation),w.anisotropyTexture!==void 0&&A.push(m.assignTexture(i,"anisotropyMap",w.anisotropyTexture)),Promise.all(A)}}class GLTFTextureBasisUExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(r){const i=this.parser,m=i.json,_=m.textures[r];if(!_.extensions||!_.extensions[this.name])return null;const A=_.extensions[this.name],w=i.options.ktx2Loader;if(!w){if(m.extensionsRequired&&m.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(r,A.source,w)}}class GLTFTextureWebPExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(r){const i=this.name,m=this.parser,_=m.json,A=_.textures[r];if(!A.extensions||!A.extensions[i])return null;const w=A.extensions[i],T=_.images[w.source];let R=m.textureLoader;if(T.uri){const D=m.options.manager.getHandler(T.uri);D!==null&&(R=D)}return this.detectSupport().then(function(D){if(D)return m.loadTextureImage(r,w.source,R);if(_.extensionsRequired&&_.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return m.loadTexture(r)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(r){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){r(i.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(r){this.parser=r,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(r){const i=this.name,m=this.parser,_=m.json,A=_.textures[r];if(!A.extensions||!A.extensions[i])return null;const w=A.extensions[i],T=_.images[w.source];let R=m.textureLoader;if(T.uri){const D=m.options.manager.getHandler(T.uri);D!==null&&(R=D)}return this.detectSupport().then(function(D){if(D)return m.loadTextureImage(r,w.source,R);if(_.extensionsRequired&&_.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return m.loadTexture(r)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(r){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){r(i.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(r){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=r}loadBufferView(r){const i=this.parser.json,m=i.bufferViews[r];if(m.extensions&&m.extensions[this.name]){const _=m.extensions[this.name],A=this.parser.getDependency("buffer",_.buffer),w=this.parser.options.meshoptDecoder;if(!w||!w.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return A.then(function(T){const R=_.byteOffset||0,D=_.byteLength||0,U=_.count,k=_.byteStride,X=new Uint8Array(T,R,D);return w.decodeGltfBufferAsync?w.decodeGltfBufferAsync(U,k,X,_.mode,_.filter).then(function(J){return J.buffer}):w.ready.then(function(){const J=new ArrayBuffer(U*k);return w.decodeGltfBuffer(new Uint8Array(J),U,k,X,_.mode,_.filter),J})})}else return null}}class GLTFMeshGpuInstancing{constructor(r){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=r}createNodeMesh(r){const i=this.parser.json,m=i.nodes[r];if(!m.extensions||!m.extensions[this.name]||m.mesh===void 0)return null;const _=i.meshes[m.mesh];for(const D of _.primitives)if(D.mode!==WEBGL_CONSTANTS.TRIANGLES&&D.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&D.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&D.mode!==void 0)return null;const w=m.extensions[this.name].attributes,T=[],R={};for(const D in w)T.push(this.parser.getDependency("accessor",w[D]).then(U=>(R[D]=U,R[D])));return T.length<1?null:(T.push(this.parser.createNodeMesh(r)),Promise.all(T).then(D=>{const U=D.pop(),k=U.isGroup?U.children:[U],X=D[0].count,J=[];for(const $ of k){const oe=new Matrix4,ne=new Vector3,H=new Quaternion,V=new Vector3(1,1,1),z=new InstancedMesh($.geometry,$.material,X);for(let ce=0;ce<X;ce++)R.TRANSLATION&&ne.fromBufferAttribute(R.TRANSLATION,ce),R.ROTATION&&H.fromBufferAttribute(R.ROTATION,ce),R.SCALE&&V.fromBufferAttribute(R.SCALE,ce),z.setMatrixAt(ce,oe.compose(ne,H,V));for(const ce in R)ce!=="TRANSLATION"&&ce!=="ROTATION"&&ce!=="SCALE"&&$.geometry.setAttribute(ce,R[ce]);Object3D.prototype.copy.call(z,$),this.parser.assignFinalMaterial(z),J.push(z)}return U.isGroup?(U.clear(),U.add(...J),U):J[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(r){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(r,0,BINARY_EXTENSION_HEADER_LENGTH),m=new TextDecoder;if(this.header={magic:m.decode(new Uint8Array(r.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const _=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,A=new DataView(r,BINARY_EXTENSION_HEADER_LENGTH);let w=0;for(;w<_;){const T=A.getUint32(w,!0);w+=4;const R=A.getUint32(w,!0);if(w+=4,R===BINARY_EXTENSION_CHUNK_TYPES.JSON){const D=new Uint8Array(r,BINARY_EXTENSION_HEADER_LENGTH+w,T);this.content=m.decode(D)}else if(R===BINARY_EXTENSION_CHUNK_TYPES.BIN){const D=BINARY_EXTENSION_HEADER_LENGTH+w;this.body=r.slice(D,D+T)}w+=T}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(r,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=r,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(r,i){const m=this.json,_=this.dracoLoader,A=r.extensions[this.name].bufferView,w=r.extensions[this.name].attributes,T={},R={},D={};for(const U in w){const k=ATTRIBUTES[U]||U.toLowerCase();T[k]=w[U]}for(const U in r.attributes){const k=ATTRIBUTES[U]||U.toLowerCase();if(w[U]!==void 0){const X=m.accessors[r.attributes[U]],J=WEBGL_COMPONENT_TYPES[X.componentType];D[k]=J.name,R[k]=X.normalized===!0}}return i.getDependency("bufferView",A).then(function(U){return new Promise(function(k){_.decodeDracoFile(U,function(X){for(const J in X.attributes){const $=X.attributes[J],oe=R[J];oe!==void 0&&($.normalized=oe)}k(X)},T,D)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(r,i){return(i.texCoord===void 0||i.texCoord===r.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(r=r.clone(),i.texCoord!==void 0&&(r.channel=i.texCoord),i.offset!==void 0&&r.offset.fromArray(i.offset),i.rotation!==void 0&&(r.rotation=i.rotation),i.scale!==void 0&&r.repeat.fromArray(i.scale),r.needsUpdate=!0),r}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(r,i,m,_){super(r,i,m,_)}copySampleValue_(r){const i=this.resultBuffer,m=this.sampleValues,_=this.valueSize,A=r*_*3+_;for(let w=0;w!==_;w++)i[w]=m[A+w];return i}interpolate_(r,i,m,_){const A=this.resultBuffer,w=this.sampleValues,T=this.valueSize,R=T*2,D=T*3,U=_-i,k=(m-i)/U,X=k*k,J=X*k,$=r*D,oe=$-D,ne=-2*J+3*X,H=J-X,V=1-ne,z=H-X+k;for(let ce=0;ce!==T;ce++){const ue=w[oe+ce+T],he=w[oe+ce+R]*U,K=w[$+ce+T],Y=w[$+ce]*U;A[ce]=V*ue+z*he+ne*K+H*Y}return A}}const _q=new Quaternion;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(r,i,m,_){const A=super.interpolate_(r,i,m,_);return _q.fromArray(A).normalize().toArray(A),A}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(u){return u.DefaultMaterial===void 0&&(u.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),u.DefaultMaterial}function addUnknownExtensionsToUserData(u,r,i){for(const m in i.extensions)u[m]===void 0&&(r.userData.gltfExtensions=r.userData.gltfExtensions||{},r.userData.gltfExtensions[m]=i.extensions[m])}function assignExtrasToUserData(u,r){r.extras!==void 0&&(typeof r.extras=="object"?Object.assign(u.userData,r.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+r.extras))}function addMorphTargets(u,r,i){let m=!1,_=!1,A=!1;for(let D=0,U=r.length;D<U;D++){const k=r[D];if(k.POSITION!==void 0&&(m=!0),k.NORMAL!==void 0&&(_=!0),k.COLOR_0!==void 0&&(A=!0),m&&_&&A)break}if(!m&&!_&&!A)return Promise.resolve(u);const w=[],T=[],R=[];for(let D=0,U=r.length;D<U;D++){const k=r[D];if(m){const X=k.POSITION!==void 0?i.getDependency("accessor",k.POSITION):u.attributes.position;w.push(X)}if(_){const X=k.NORMAL!==void 0?i.getDependency("accessor",k.NORMAL):u.attributes.normal;T.push(X)}if(A){const X=k.COLOR_0!==void 0?i.getDependency("accessor",k.COLOR_0):u.attributes.color;R.push(X)}}return Promise.all([Promise.all(w),Promise.all(T),Promise.all(R)]).then(function(D){const U=D[0],k=D[1],X=D[2];return m&&(u.morphAttributes.position=U),_&&(u.morphAttributes.normal=k),A&&(u.morphAttributes.color=X),u.morphTargetsRelative=!0,u})}function updateMorphTargets(u,r){if(u.updateMorphTargets(),r.weights!==void 0)for(let i=0,m=r.weights.length;i<m;i++)u.morphTargetInfluences[i]=r.weights[i];if(r.extras&&Array.isArray(r.extras.targetNames)){const i=r.extras.targetNames;if(u.morphTargetInfluences.length===i.length){u.morphTargetDictionary={};for(let m=0,_=i.length;m<_;m++)u.morphTargetDictionary[i[m]]=m}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(u){let r;const i=u.extensions&&u.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(i?r="draco:"+i.bufferView+":"+i.indices+":"+createAttributesKey(i.attributes):r=u.indices+":"+createAttributesKey(u.attributes)+":"+u.mode,u.targets!==void 0)for(let m=0,_=u.targets.length;m<_;m++)r+=":"+createAttributesKey(u.targets[m]);return r}function createAttributesKey(u){let r="";const i=Object.keys(u).sort();for(let m=0,_=i.length;m<_;m++)r+=i[m]+":"+u[i[m]]+";";return r}function getNormalizedComponentScale(u){switch(u){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(u){return u.search(/\.jpe?g($|\?)/i)>0||u.search(/^data\:image\/jpeg/)===0?"image/jpeg":u.search(/\.webp($|\?)/i)>0||u.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const _identityMatrix=new Matrix4;class GLTFParser{constructor(r={},i={}){this.json=r,this.extensions={},this.plugins={},this.options=i,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let m=!1,_=!1,A=-1;typeof navigator<"u"&&(m=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,_=navigator.userAgent.indexOf("Firefox")>-1,A=_?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||m||_&&A<98?this.textureLoader=new TextureLoader(this.options.manager):this.textureLoader=new ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(r){this.extensions=r}setPlugins(r){this.plugins=r}parse(r,i){const m=this,_=this.json,A=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(w){return w._markDefs&&w._markDefs()}),Promise.all(this._invokeAll(function(w){return w.beforeRoot&&w.beforeRoot()})).then(function(){return Promise.all([m.getDependencies("scene"),m.getDependencies("animation"),m.getDependencies("camera")])}).then(function(w){const T={scene:w[0][_.scene||0],scenes:w[0],animations:w[1],cameras:w[2],asset:_.asset,parser:m,userData:{}};addUnknownExtensionsToUserData(A,T,_),assignExtrasToUserData(T,_),Promise.all(m._invokeAll(function(R){return R.afterRoot&&R.afterRoot(T)})).then(function(){r(T)})}).catch(i)}_markDefs(){const r=this.json.nodes||[],i=this.json.skins||[],m=this.json.meshes||[];for(let _=0,A=i.length;_<A;_++){const w=i[_].joints;for(let T=0,R=w.length;T<R;T++)r[w[T]].isBone=!0}for(let _=0,A=r.length;_<A;_++){const w=r[_];w.mesh!==void 0&&(this._addNodeRef(this.meshCache,w.mesh),w.skin!==void 0&&(m[w.mesh].isSkinnedMesh=!0)),w.camera!==void 0&&this._addNodeRef(this.cameraCache,w.camera)}}_addNodeRef(r,i){i!==void 0&&(r.refs[i]===void 0&&(r.refs[i]=r.uses[i]=0),r.refs[i]++)}_getNodeRef(r,i,m){if(r.refs[i]<=1)return m;const _=m.clone(),A=(w,T)=>{const R=this.associations.get(w);R!=null&&this.associations.set(T,R);for(const[D,U]of w.children.entries())A(U,T.children[D])};return A(m,_),_.name+="_instance_"+r.uses[i]++,_}_invokeOne(r){const i=Object.values(this.plugins);i.push(this);for(let m=0;m<i.length;m++){const _=r(i[m]);if(_)return _}return null}_invokeAll(r){const i=Object.values(this.plugins);i.unshift(this);const m=[];for(let _=0;_<i.length;_++){const A=r(i[_]);A&&m.push(A)}return m}getDependency(r,i){const m=r+":"+i;let _=this.cache.get(m);if(!_){switch(r){case"scene":_=this.loadScene(i);break;case"node":_=this._invokeOne(function(A){return A.loadNode&&A.loadNode(i)});break;case"mesh":_=this._invokeOne(function(A){return A.loadMesh&&A.loadMesh(i)});break;case"accessor":_=this.loadAccessor(i);break;case"bufferView":_=this._invokeOne(function(A){return A.loadBufferView&&A.loadBufferView(i)});break;case"buffer":_=this.loadBuffer(i);break;case"material":_=this._invokeOne(function(A){return A.loadMaterial&&A.loadMaterial(i)});break;case"texture":_=this._invokeOne(function(A){return A.loadTexture&&A.loadTexture(i)});break;case"skin":_=this.loadSkin(i);break;case"animation":_=this._invokeOne(function(A){return A.loadAnimation&&A.loadAnimation(i)});break;case"camera":_=this.loadCamera(i);break;default:if(_=this._invokeOne(function(A){return A!=this&&A.getDependency&&A.getDependency(r,i)}),!_)throw new Error("Unknown type: "+r);break}this.cache.add(m,_)}return _}getDependencies(r){let i=this.cache.get(r);if(!i){const m=this,_=this.json[r+(r==="mesh"?"es":"s")]||[];i=Promise.all(_.map(function(A,w){return m.getDependency(r,w)})),this.cache.add(r,i)}return i}loadBuffer(r){const i=this.json.buffers[r],m=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&r===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const _=this.options;return new Promise(function(A,w){m.load(LoaderUtils.resolveURL(i.uri,_.path),A,void 0,function(){w(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(r){const i=this.json.bufferViews[r];return this.getDependency("buffer",i.buffer).then(function(m){const _=i.byteLength||0,A=i.byteOffset||0;return m.slice(A,A+_)})}loadAccessor(r){const i=this,m=this.json,_=this.json.accessors[r];if(_.bufferView===void 0&&_.sparse===void 0){const w=WEBGL_TYPE_SIZES[_.type],T=WEBGL_COMPONENT_TYPES[_.componentType],R=_.normalized===!0,D=new T(_.count*w);return Promise.resolve(new BufferAttribute(D,w,R))}const A=[];return _.bufferView!==void 0?A.push(this.getDependency("bufferView",_.bufferView)):A.push(null),_.sparse!==void 0&&(A.push(this.getDependency("bufferView",_.sparse.indices.bufferView)),A.push(this.getDependency("bufferView",_.sparse.values.bufferView))),Promise.all(A).then(function(w){const T=w[0],R=WEBGL_TYPE_SIZES[_.type],D=WEBGL_COMPONENT_TYPES[_.componentType],U=D.BYTES_PER_ELEMENT,k=U*R,X=_.byteOffset||0,J=_.bufferView!==void 0?m.bufferViews[_.bufferView].byteStride:void 0,$=_.normalized===!0;let oe,ne;if(J&&J!==k){const H=Math.floor(X/J),V="InterleavedBuffer:"+_.bufferView+":"+_.componentType+":"+H+":"+_.count;let z=i.cache.get(V);z||(oe=new D(T,H*J,_.count*J/U),z=new InterleavedBuffer(oe,J/U),i.cache.add(V,z)),ne=new InterleavedBufferAttribute(z,R,X%J/U,$)}else T===null?oe=new D(_.count*R):oe=new D(T,X,_.count*R),ne=new BufferAttribute(oe,R,$);if(_.sparse!==void 0){const H=WEBGL_TYPE_SIZES.SCALAR,V=WEBGL_COMPONENT_TYPES[_.sparse.indices.componentType],z=_.sparse.indices.byteOffset||0,ce=_.sparse.values.byteOffset||0,ue=new V(w[1],z,_.sparse.count*H),he=new D(w[2],ce,_.sparse.count*R);T!==null&&(ne=new BufferAttribute(ne.array.slice(),ne.itemSize,ne.normalized));for(let K=0,Y=ue.length;K<Y;K++){const ie=ue[K];if(ne.setX(ie,he[K*R]),R>=2&&ne.setY(ie,he[K*R+1]),R>=3&&ne.setZ(ie,he[K*R+2]),R>=4&&ne.setW(ie,he[K*R+3]),R>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return ne})}loadTexture(r){const i=this.json,m=this.options,A=i.textures[r].source,w=i.images[A];let T=this.textureLoader;if(w.uri){const R=m.manager.getHandler(w.uri);R!==null&&(T=R)}return this.loadTextureImage(r,A,T)}loadTextureImage(r,i,m){const _=this,A=this.json,w=A.textures[r],T=A.images[i],R=(T.uri||T.bufferView)+":"+w.sampler;if(this.textureCache[R])return this.textureCache[R];const D=this.loadImageSource(i,m).then(function(U){U.flipY=!1,U.name=w.name||T.name||"",U.name===""&&typeof T.uri=="string"&&T.uri.startsWith("data:image/")===!1&&(U.name=T.uri);const X=(A.samplers||{})[w.sampler]||{};return U.magFilter=WEBGL_FILTERS[X.magFilter]||LinearFilter,U.minFilter=WEBGL_FILTERS[X.minFilter]||LinearMipmapLinearFilter,U.wrapS=WEBGL_WRAPPINGS[X.wrapS]||RepeatWrapping,U.wrapT=WEBGL_WRAPPINGS[X.wrapT]||RepeatWrapping,_.associations.set(U,{textures:r}),U}).catch(function(){return null});return this.textureCache[R]=D,D}loadImageSource(r,i){const m=this,_=this.json,A=this.options;if(this.sourceCache[r]!==void 0)return this.sourceCache[r].then(k=>k.clone());const w=_.images[r],T=self.URL||self.webkitURL;let R=w.uri||"",D=!1;if(w.bufferView!==void 0)R=m.getDependency("bufferView",w.bufferView).then(function(k){D=!0;const X=new Blob([k],{type:w.mimeType});return R=T.createObjectURL(X),R});else if(w.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+r+" is missing URI and bufferView");const U=Promise.resolve(R).then(function(k){return new Promise(function(X,J){let $=X;i.isImageBitmapLoader===!0&&($=function(oe){const ne=new Texture(oe);ne.needsUpdate=!0,X(ne)}),i.load(LoaderUtils.resolveURL(k,A.path),$,void 0,J)})}).then(function(k){return D===!0&&T.revokeObjectURL(R),k.userData.mimeType=w.mimeType||getImageURIMimeType(w.uri),k}).catch(function(k){throw console.error("THREE.GLTFLoader: Couldn't load texture",R),k});return this.sourceCache[r]=U,U}assignTexture(r,i,m,_){const A=this;return this.getDependency("texture",m.index).then(function(w){if(!w)return null;if(m.texCoord!==void 0&&m.texCoord>0&&(w=w.clone(),w.channel=m.texCoord),A.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const T=m.extensions!==void 0?m.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(T){const R=A.associations.get(w);w=A.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(w,T),A.associations.set(w,R)}}return _!==void 0&&(w.colorSpace=_),r[i]=w,w})}assignFinalMaterial(r){const i=r.geometry;let m=r.material;const _=i.attributes.tangent===void 0,A=i.attributes.color!==void 0,w=i.attributes.normal===void 0;if(r.isPoints){const T="PointsMaterial:"+m.uuid;let R=this.cache.get(T);R||(R=new PointsMaterial,Material.prototype.copy.call(R,m),R.color.copy(m.color),R.map=m.map,R.sizeAttenuation=!1,this.cache.add(T,R)),m=R}else if(r.isLine){const T="LineBasicMaterial:"+m.uuid;let R=this.cache.get(T);R||(R=new LineBasicMaterial,Material.prototype.copy.call(R,m),R.color.copy(m.color),R.map=m.map,this.cache.add(T,R)),m=R}if(_||A||w){let T="ClonedMaterial:"+m.uuid+":";_&&(T+="derivative-tangents:"),A&&(T+="vertex-colors:"),w&&(T+="flat-shading:");let R=this.cache.get(T);R||(R=m.clone(),A&&(R.vertexColors=!0),w&&(R.flatShading=!0),_&&(R.normalScale&&(R.normalScale.y*=-1),R.clearcoatNormalScale&&(R.clearcoatNormalScale.y*=-1)),this.cache.add(T,R),this.associations.set(R,this.associations.get(m))),m=R}r.material=m}getMaterialType(){return MeshStandardMaterial}loadMaterial(r){const i=this,m=this.json,_=this.extensions,A=m.materials[r];let w;const T={},R=A.extensions||{},D=[];if(R[EXTENSIONS.KHR_MATERIALS_UNLIT]){const k=_[EXTENSIONS.KHR_MATERIALS_UNLIT];w=k.getMaterialType(),D.push(k.extendParams(T,A,i))}else{const k=A.pbrMetallicRoughness||{};if(T.color=new Color(1,1,1),T.opacity=1,Array.isArray(k.baseColorFactor)){const X=k.baseColorFactor;T.color.setRGB(X[0],X[1],X[2],LinearSRGBColorSpace),T.opacity=X[3]}k.baseColorTexture!==void 0&&D.push(i.assignTexture(T,"map",k.baseColorTexture,SRGBColorSpace)),T.metalness=k.metallicFactor!==void 0?k.metallicFactor:1,T.roughness=k.roughnessFactor!==void 0?k.roughnessFactor:1,k.metallicRoughnessTexture!==void 0&&(D.push(i.assignTexture(T,"metalnessMap",k.metallicRoughnessTexture)),D.push(i.assignTexture(T,"roughnessMap",k.metallicRoughnessTexture))),w=this._invokeOne(function(X){return X.getMaterialType&&X.getMaterialType(r)}),D.push(Promise.all(this._invokeAll(function(X){return X.extendMaterialParams&&X.extendMaterialParams(r,T)})))}A.doubleSided===!0&&(T.side=DoubleSide);const U=A.alphaMode||ALPHA_MODES.OPAQUE;if(U===ALPHA_MODES.BLEND?(T.transparent=!0,T.depthWrite=!1):(T.transparent=!1,U===ALPHA_MODES.MASK&&(T.alphaTest=A.alphaCutoff!==void 0?A.alphaCutoff:.5)),A.normalTexture!==void 0&&w!==MeshBasicMaterial&&(D.push(i.assignTexture(T,"normalMap",A.normalTexture)),T.normalScale=new Vector2(1,1),A.normalTexture.scale!==void 0)){const k=A.normalTexture.scale;T.normalScale.set(k,k)}if(A.occlusionTexture!==void 0&&w!==MeshBasicMaterial&&(D.push(i.assignTexture(T,"aoMap",A.occlusionTexture)),A.occlusionTexture.strength!==void 0&&(T.aoMapIntensity=A.occlusionTexture.strength)),A.emissiveFactor!==void 0&&w!==MeshBasicMaterial){const k=A.emissiveFactor;T.emissive=new Color().setRGB(k[0],k[1],k[2],LinearSRGBColorSpace)}return A.emissiveTexture!==void 0&&w!==MeshBasicMaterial&&D.push(i.assignTexture(T,"emissiveMap",A.emissiveTexture,SRGBColorSpace)),Promise.all(D).then(function(){const k=new w(T);return A.name&&(k.name=A.name),assignExtrasToUserData(k,A),i.associations.set(k,{materials:r}),A.extensions&&addUnknownExtensionsToUserData(_,k,A),k})}createUniqueName(r){const i=PropertyBinding.sanitizeNodeName(r||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(r){const i=this,m=this.extensions,_=this.primitiveCache;function A(T){return m[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(T,i).then(function(R){return addPrimitiveAttributes(R,T,i)})}const w=[];for(let T=0,R=r.length;T<R;T++){const D=r[T],U=createPrimitiveKey(D),k=_[U];if(k)w.push(k.promise);else{let X;D.extensions&&D.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?X=A(D):X=addPrimitiveAttributes(new BufferGeometry$1,D,i),_[U]={primitive:D,promise:X},w.push(X)}}return Promise.all(w)}loadMesh(r){const i=this,m=this.json,_=this.extensions,A=m.meshes[r],w=A.primitives,T=[];for(let R=0,D=w.length;R<D;R++){const U=w[R].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",w[R].material);T.push(U)}return T.push(i.loadGeometries(w)),Promise.all(T).then(function(R){const D=R.slice(0,R.length-1),U=R[R.length-1],k=[];for(let J=0,$=U.length;J<$;J++){const oe=U[J],ne=w[J];let H;const V=D[J];if(ne.mode===WEBGL_CONSTANTS.TRIANGLES||ne.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||ne.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||ne.mode===void 0)H=A.isSkinnedMesh===!0?new SkinnedMesh(oe,V):new Mesh(oe,V),H.isSkinnedMesh===!0&&H.normalizeSkinWeights(),ne.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?H.geometry=toTrianglesDrawMode(H.geometry,TriangleStripDrawMode):ne.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(H.geometry=toTrianglesDrawMode(H.geometry,TriangleFanDrawMode));else if(ne.mode===WEBGL_CONSTANTS.LINES)H=new LineSegments(oe,V);else if(ne.mode===WEBGL_CONSTANTS.LINE_STRIP)H=new Line(oe,V);else if(ne.mode===WEBGL_CONSTANTS.LINE_LOOP)H=new LineLoop(oe,V);else if(ne.mode===WEBGL_CONSTANTS.POINTS)H=new Points(oe,V);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+ne.mode);Object.keys(H.geometry.morphAttributes).length>0&&updateMorphTargets(H,A),H.name=i.createUniqueName(A.name||"mesh_"+r),assignExtrasToUserData(H,A),ne.extensions&&addUnknownExtensionsToUserData(_,H,ne),i.assignFinalMaterial(H),k.push(H)}for(let J=0,$=k.length;J<$;J++)i.associations.set(k[J],{meshes:r,primitives:J});if(k.length===1)return A.extensions&&addUnknownExtensionsToUserData(_,k[0],A),k[0];const X=new Group;A.extensions&&addUnknownExtensionsToUserData(_,X,A),i.associations.set(X,{meshes:r});for(let J=0,$=k.length;J<$;J++)X.add(k[J]);return X})}loadCamera(r){let i;const m=this.json.cameras[r],_=m[m.type];if(!_){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return m.type==="perspective"?i=new PerspectiveCamera(MathUtils.radToDeg(_.yfov),_.aspectRatio||1,_.znear||1,_.zfar||2e6):m.type==="orthographic"&&(i=new OrthographicCamera(-_.xmag,_.xmag,_.ymag,-_.ymag,_.znear,_.zfar)),m.name&&(i.name=this.createUniqueName(m.name)),assignExtrasToUserData(i,m),Promise.resolve(i)}loadSkin(r){const i=this.json.skins[r],m=[];for(let _=0,A=i.joints.length;_<A;_++)m.push(this._loadNodeShallow(i.joints[_]));return i.inverseBindMatrices!==void 0?m.push(this.getDependency("accessor",i.inverseBindMatrices)):m.push(null),Promise.all(m).then(function(_){const A=_.pop(),w=_,T=[],R=[];for(let D=0,U=w.length;D<U;D++){const k=w[D];if(k){T.push(k);const X=new Matrix4;A!==null&&X.fromArray(A.array,D*16),R.push(X)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[D])}return new Skeleton(T,R)})}loadAnimation(r){const i=this.json,m=this,_=i.animations[r],A=_.name?_.name:"animation_"+r,w=[],T=[],R=[],D=[],U=[];for(let k=0,X=_.channels.length;k<X;k++){const J=_.channels[k],$=_.samplers[J.sampler],oe=J.target,ne=oe.node,H=_.parameters!==void 0?_.parameters[$.input]:$.input,V=_.parameters!==void 0?_.parameters[$.output]:$.output;oe.node!==void 0&&(w.push(this.getDependency("node",ne)),T.push(this.getDependency("accessor",H)),R.push(this.getDependency("accessor",V)),D.push($),U.push(oe))}return Promise.all([Promise.all(w),Promise.all(T),Promise.all(R),Promise.all(D),Promise.all(U)]).then(function(k){const X=k[0],J=k[1],$=k[2],oe=k[3],ne=k[4],H=[];for(let V=0,z=X.length;V<z;V++){const ce=X[V],ue=J[V],he=$[V],K=oe[V],Y=ne[V];if(ce===void 0)continue;ce.updateMatrix&&ce.updateMatrix();const ie=m._createAnimationTracks(ce,ue,he,K,Y);if(ie)for(let ve=0;ve<ie.length;ve++)H.push(ie[ve])}return new AnimationClip(A,void 0,H)})}createNodeMesh(r){const i=this.json,m=this,_=i.nodes[r];return _.mesh===void 0?null:m.getDependency("mesh",_.mesh).then(function(A){const w=m._getNodeRef(m.meshCache,_.mesh,A);return _.weights!==void 0&&w.traverse(function(T){if(T.isMesh)for(let R=0,D=_.weights.length;R<D;R++)T.morphTargetInfluences[R]=_.weights[R]}),w})}loadNode(r){const i=this.json,m=this,_=i.nodes[r],A=m._loadNodeShallow(r),w=[],T=_.children||[];for(let D=0,U=T.length;D<U;D++)w.push(m.getDependency("node",T[D]));const R=_.skin===void 0?Promise.resolve(null):m.getDependency("skin",_.skin);return Promise.all([A,Promise.all(w),R]).then(function(D){const U=D[0],k=D[1],X=D[2];X!==null&&U.traverse(function(J){J.isSkinnedMesh&&J.bind(X,_identityMatrix)});for(let J=0,$=k.length;J<$;J++)U.add(k[J]);return U})}_loadNodeShallow(r){const i=this.json,m=this.extensions,_=this;if(this.nodeCache[r]!==void 0)return this.nodeCache[r];const A=i.nodes[r],w=A.name?_.createUniqueName(A.name):"",T=[],R=_._invokeOne(function(D){return D.createNodeMesh&&D.createNodeMesh(r)});return R&&T.push(R),A.camera!==void 0&&T.push(_.getDependency("camera",A.camera).then(function(D){return _._getNodeRef(_.cameraCache,A.camera,D)})),_._invokeAll(function(D){return D.createNodeAttachment&&D.createNodeAttachment(r)}).forEach(function(D){T.push(D)}),this.nodeCache[r]=Promise.all(T).then(function(D){let U;if(A.isBone===!0?U=new Bone:D.length>1?U=new Group:D.length===1?U=D[0]:U=new Object3D,U!==D[0])for(let k=0,X=D.length;k<X;k++)U.add(D[k]);if(A.name&&(U.userData.name=A.name,U.name=w),assignExtrasToUserData(U,A),A.extensions&&addUnknownExtensionsToUserData(m,U,A),A.matrix!==void 0){const k=new Matrix4;k.fromArray(A.matrix),U.applyMatrix4(k)}else A.translation!==void 0&&U.position.fromArray(A.translation),A.rotation!==void 0&&U.quaternion.fromArray(A.rotation),A.scale!==void 0&&U.scale.fromArray(A.scale);return _.associations.has(U)||_.associations.set(U,{}),_.associations.get(U).nodes=r,U}),this.nodeCache[r]}loadScene(r){const i=this.extensions,m=this.json.scenes[r],_=this,A=new Group;m.name&&(A.name=_.createUniqueName(m.name)),assignExtrasToUserData(A,m),m.extensions&&addUnknownExtensionsToUserData(i,A,m);const w=m.nodes||[],T=[];for(let R=0,D=w.length;R<D;R++)T.push(_.getDependency("node",w[R]));return Promise.all(T).then(function(R){for(let U=0,k=R.length;U<k;U++)A.add(R[U]);const D=U=>{const k=new Map;for(const[X,J]of _.associations)(X instanceof Material||X instanceof Texture)&&k.set(X,J);return U.traverse(X=>{const J=_.associations.get(X);J!=null&&k.set(X,J)}),k};return _.associations=D(A),A})}_createAnimationTracks(r,i,m,_,A){const w=[],T=r.name?r.name:r.uuid,R=[];PATH_PROPERTIES[A.path]===PATH_PROPERTIES.weights?r.traverse(function(X){X.morphTargetInfluences&&R.push(X.name?X.name:X.uuid)}):R.push(T);let D;switch(PATH_PROPERTIES[A.path]){case PATH_PROPERTIES.weights:D=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:D=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:D=VectorKeyframeTrack;break;default:switch(m.itemSize){case 1:D=NumberKeyframeTrack;break;case 2:case 3:default:D=VectorKeyframeTrack;break}break}const U=_.interpolation!==void 0?INTERPOLATION[_.interpolation]:InterpolateLinear,k=this._getArrayFromAccessor(m);for(let X=0,J=R.length;X<J;X++){const $=new D(R[X]+"."+PATH_PROPERTIES[A.path],i.array,k,U);_.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant($),w.push($)}return w}_getArrayFromAccessor(r){let i=r.array;if(r.normalized){const m=getNormalizedComponentScale(i.constructor),_=new Float32Array(i.length);for(let A=0,w=i.length;A<w;A++)_[A]=i[A]*m;i=_}return i}_createCubicSplineTrackInterpolant(r){r.createInterpolant=function(m){const _=this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new _(this.times,this.values,this.getValueSize()/3,m)},r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(u,r,i){const m=r.attributes,_=new Box3;if(m.POSITION!==void 0){const T=i.json.accessors[m.POSITION],R=T.min,D=T.max;if(R!==void 0&&D!==void 0){if(_.set(new Vector3(R[0],R[1],R[2]),new Vector3(D[0],D[1],D[2])),T.normalized){const U=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[T.componentType]);_.min.multiplyScalar(U),_.max.multiplyScalar(U)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const A=r.targets;if(A!==void 0){const T=new Vector3,R=new Vector3;for(let D=0,U=A.length;D<U;D++){const k=A[D];if(k.POSITION!==void 0){const X=i.json.accessors[k.POSITION],J=X.min,$=X.max;if(J!==void 0&&$!==void 0){if(R.setX(Math.max(Math.abs(J[0]),Math.abs($[0]))),R.setY(Math.max(Math.abs(J[1]),Math.abs($[1]))),R.setZ(Math.max(Math.abs(J[2]),Math.abs($[2]))),X.normalized){const oe=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[X.componentType]);R.multiplyScalar(oe)}T.max(R)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}_.expandByVector(T)}u.boundingBox=_;const w=new Sphere;_.getCenter(w.center),w.radius=_.min.distanceTo(_.max)/2,u.boundingSphere=w}function addPrimitiveAttributes(u,r,i){const m=r.attributes,_=[];function A(w,T){return i.getDependency("accessor",w).then(function(R){u.setAttribute(T,R)})}for(const w in m){const T=ATTRIBUTES[w]||w.toLowerCase();T in u.attributes||_.push(A(m[w],T))}if(r.indices!==void 0&&!u.index){const w=i.getDependency("accessor",r.indices).then(function(T){u.setIndex(T)});_.push(w)}return ColorManagement.workingColorSpace!==LinearSRGBColorSpace&&"COLOR_0"in m&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ColorManagement.workingColorSpace}" not supported.`),assignExtrasToUserData(u,r),computeBounds(u,r,i),Promise.all(_).then(function(){return r.targets!==void 0?addMorphTargets(u,r.targets,i):u})}const _changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},_ray=new Ray,_plane=new Plane,TILT_LIMIT=Math.cos(70*MathUtils.DEG2RAD);class OrbitControls extends EventDispatcher{constructor(r,i){super(),this.object=r,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return T.phi},this.getAzimuthalAngle=function(){return T.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(ht){ht.addEventListener("keydown",Ae),this._domElementKeyEvents=ht},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Ae),this._domElementKeyEvents=null},this.saveState=function(){m.target0.copy(m.target),m.position0.copy(m.object.position),m.zoom0=m.object.zoom},this.reset=function(){m.target.copy(m.target0),m.object.position.copy(m.position0),m.object.zoom=m.zoom0,m.object.updateProjectionMatrix(),m.dispatchEvent(_changeEvent),m.update(),A=_.NONE},this.update=function(){const ht=new Vector3,zt=new Quaternion().setFromUnitVectors(r.up,new Vector3(0,1,0)),dn=zt.clone().invert(),en=new Vector3,xn=new Quaternion,wi=new Vector3,Gi=2*Math.PI;return function(oi=null){const pn=m.object.position;ht.copy(pn).sub(m.target),ht.applyQuaternion(zt),T.setFromVector3(ht),m.autoRotate&&A===_.NONE&&re(ie(oi)),m.enableDamping?(T.theta+=R.theta*m.dampingFactor,T.phi+=R.phi*m.dampingFactor):(T.theta+=R.theta,T.phi+=R.phi);let Dn=m.minAzimuthAngle,kn=m.maxAzimuthAngle;isFinite(Dn)&&isFinite(kn)&&(Dn<-Math.PI?Dn+=Gi:Dn>Math.PI&&(Dn-=Gi),kn<-Math.PI?kn+=Gi:kn>Math.PI&&(kn-=Gi),Dn<=kn?T.theta=Math.max(Dn,Math.min(kn,T.theta)):T.theta=T.theta>(Dn+kn)/2?Math.max(Dn,T.theta):Math.min(kn,T.theta)),T.phi=Math.max(m.minPolarAngle,Math.min(m.maxPolarAngle,T.phi)),T.makeSafe(),m.enableDamping===!0?m.target.addScaledVector(U,m.dampingFactor):m.target.add(U),m.zoomToCursor&&he||m.object.isOrthographicCamera?T.radius=ot(T.radius):T.radius=ot(T.radius*D),ht.setFromSpherical(T),ht.applyQuaternion(dn),pn.copy(m.target).add(ht),m.object.lookAt(m.target),m.enableDamping===!0?(R.theta*=1-m.dampingFactor,R.phi*=1-m.dampingFactor,U.multiplyScalar(1-m.dampingFactor)):(R.set(0,0,0),U.set(0,0,0));let ui=!1;if(m.zoomToCursor&&he){let Nr=null;if(m.object.isPerspectiveCamera){const Pr=ht.length();Nr=ot(Pr*D);const wr=Pr-Nr;m.object.position.addScaledVector(ce,wr),m.object.updateMatrixWorld()}else if(m.object.isOrthographicCamera){const Pr=new Vector3(ue.x,ue.y,0);Pr.unproject(m.object),m.object.zoom=Math.max(m.minZoom,Math.min(m.maxZoom,m.object.zoom/D)),m.object.updateProjectionMatrix(),ui=!0;const wr=new Vector3(ue.x,ue.y,0);wr.unproject(m.object),m.object.position.sub(wr).add(Pr),m.object.updateMatrixWorld(),Nr=ht.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),m.zoomToCursor=!1;Nr!==null&&(this.screenSpacePanning?m.target.set(0,0,-1).transformDirection(m.object.matrix).multiplyScalar(Nr).add(m.object.position):(_ray.origin.copy(m.object.position),_ray.direction.set(0,0,-1).transformDirection(m.object.matrix),Math.abs(m.object.up.dot(_ray.direction))<TILT_LIMIT?r.lookAt(m.target):(_plane.setFromNormalAndCoplanarPoint(m.object.up,m.target),_ray.intersectPlane(_plane,m.target))))}else m.object.isOrthographicCamera&&(m.object.zoom=Math.max(m.minZoom,Math.min(m.maxZoom,m.object.zoom/D)),m.object.updateProjectionMatrix(),ui=!0);return D=1,he=!1,ui||en.distanceToSquared(m.object.position)>w||8*(1-xn.dot(m.object.quaternion))>w||wi.distanceToSquared(m.target)>0?(m.dispatchEvent(_changeEvent),en.copy(m.object.position),xn.copy(m.object.quaternion),wi.copy(m.target),ui=!1,!0):!1}}(),this.dispose=function(){m.domElement.removeEventListener("contextmenu",$e),m.domElement.removeEventListener("pointerdown",hn),m.domElement.removeEventListener("pointercancel",An),m.domElement.removeEventListener("wheel",de),m.domElement.removeEventListener("pointermove",qt),m.domElement.removeEventListener("pointerup",An),m._domElementKeyEvents!==null&&(m._domElementKeyEvents.removeEventListener("keydown",Ae),m._domElementKeyEvents=null)};const m=this,_={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let A=_.NONE;const w=1e-6,T=new Spherical,R=new Spherical;let D=1;const U=new Vector3,k=new Vector2,X=new Vector2,J=new Vector2,$=new Vector2,oe=new Vector2,ne=new Vector2,H=new Vector2,V=new Vector2,z=new Vector2,ce=new Vector3,ue=new Vector2;let he=!1;const K=[],Y={};function ie(ht){return ht!==null?2*Math.PI/60*m.autoRotateSpeed*ht:2*Math.PI/60/60*m.autoRotateSpeed}function ve(){return Math.pow(.95,m.zoomSpeed)}function re(ht){R.theta-=ht}function ae(ht){R.phi-=ht}const me=function(){const ht=new Vector3;return function(dn,en){ht.setFromMatrixColumn(en,0),ht.multiplyScalar(-dn),U.add(ht)}}(),ye=function(){const ht=new Vector3;return function(dn,en){m.screenSpacePanning===!0?ht.setFromMatrixColumn(en,1):(ht.setFromMatrixColumn(en,0),ht.crossVectors(m.object.up,ht)),ht.multiplyScalar(dn),U.add(ht)}}(),Te=function(){const ht=new Vector3;return function(dn,en){const xn=m.domElement;if(m.object.isPerspectiveCamera){const wi=m.object.position;ht.copy(wi).sub(m.target);let Gi=ht.length();Gi*=Math.tan(m.object.fov/2*Math.PI/180),me(2*dn*Gi/xn.clientHeight,m.object.matrix),ye(2*en*Gi/xn.clientHeight,m.object.matrix)}else m.object.isOrthographicCamera?(me(dn*(m.object.right-m.object.left)/m.object.zoom/xn.clientWidth,m.object.matrix),ye(en*(m.object.top-m.object.bottom)/m.object.zoom/xn.clientHeight,m.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),m.enablePan=!1)}}();function ke(ht){m.object.isPerspectiveCamera||m.object.isOrthographicCamera?D/=ht:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),m.enableZoom=!1)}function Fe(ht){m.object.isPerspectiveCamera||m.object.isOrthographicCamera?D*=ht:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),m.enableZoom=!1)}function Ve(ht){if(!m.zoomToCursor)return;he=!0;const zt=m.domElement.getBoundingClientRect(),dn=ht.clientX-zt.left,en=ht.clientY-zt.top,xn=zt.width,wi=zt.height;ue.x=dn/xn*2-1,ue.y=-(en/wi)*2+1,ce.set(ue.x,ue.y,1).unproject(m.object).sub(m.object.position).normalize()}function ot(ht){return Math.max(m.minDistance,Math.min(m.maxDistance,ht))}function Ye(ht){k.set(ht.clientX,ht.clientY)}function Ze(ht){Ve(ht),H.set(ht.clientX,ht.clientY)}function tt(ht){$.set(ht.clientX,ht.clientY)}function Pt(ht){X.set(ht.clientX,ht.clientY),J.subVectors(X,k).multiplyScalar(m.rotateSpeed);const zt=m.domElement;re(2*Math.PI*J.x/zt.clientHeight),ae(2*Math.PI*J.y/zt.clientHeight),k.copy(X),m.update()}function Et(ht){V.set(ht.clientX,ht.clientY),z.subVectors(V,H),z.y>0?ke(ve()):z.y<0&&Fe(ve()),H.copy(V),m.update()}function Ne(ht){oe.set(ht.clientX,ht.clientY),ne.subVectors(oe,$).multiplyScalar(m.panSpeed),Te(ne.x,ne.y),$.copy(oe),m.update()}function et(ht){Ve(ht),ht.deltaY<0?Fe(ve()):ht.deltaY>0&&ke(ve()),m.update()}function wt(ht){let zt=!1;switch(ht.code){case m.keys.UP:ht.ctrlKey||ht.metaKey||ht.shiftKey?ae(2*Math.PI*m.rotateSpeed/m.domElement.clientHeight):Te(0,m.keyPanSpeed),zt=!0;break;case m.keys.BOTTOM:ht.ctrlKey||ht.metaKey||ht.shiftKey?ae(-2*Math.PI*m.rotateSpeed/m.domElement.clientHeight):Te(0,-m.keyPanSpeed),zt=!0;break;case m.keys.LEFT:ht.ctrlKey||ht.metaKey||ht.shiftKey?re(2*Math.PI*m.rotateSpeed/m.domElement.clientHeight):Te(m.keyPanSpeed,0),zt=!0;break;case m.keys.RIGHT:ht.ctrlKey||ht.metaKey||ht.shiftKey?re(-2*Math.PI*m.rotateSpeed/m.domElement.clientHeight):Te(-m.keyPanSpeed,0),zt=!0;break}zt&&(ht.preventDefault(),m.update())}function Zt(){if(K.length===1)k.set(K[0].pageX,K[0].pageY);else{const ht=.5*(K[0].pageX+K[1].pageX),zt=.5*(K[0].pageY+K[1].pageY);k.set(ht,zt)}}function nn(){if(K.length===1)$.set(K[0].pageX,K[0].pageY);else{const ht=.5*(K[0].pageX+K[1].pageX),zt=.5*(K[0].pageY+K[1].pageY);$.set(ht,zt)}}function Vn(){const ht=K[0].pageX-K[1].pageX,zt=K[0].pageY-K[1].pageY,dn=Math.sqrt(ht*ht+zt*zt);H.set(0,dn)}function Jn(){m.enableZoom&&Vn(),m.enablePan&&nn()}function Ue(){m.enableZoom&&Vn(),m.enableRotate&&Zt()}function St(ht){if(K.length==1)X.set(ht.pageX,ht.pageY);else{const dn=xt(ht),en=.5*(ht.pageX+dn.x),xn=.5*(ht.pageY+dn.y);X.set(en,xn)}J.subVectors(X,k).multiplyScalar(m.rotateSpeed);const zt=m.domElement;re(2*Math.PI*J.x/zt.clientHeight),ae(2*Math.PI*J.y/zt.clientHeight),k.copy(X)}function Lt(ht){if(K.length===1)oe.set(ht.pageX,ht.pageY);else{const zt=xt(ht),dn=.5*(ht.pageX+zt.x),en=.5*(ht.pageY+zt.y);oe.set(dn,en)}ne.subVectors(oe,$).multiplyScalar(m.panSpeed),Te(ne.x,ne.y),$.copy(oe)}function jt(ht){const zt=xt(ht),dn=ht.pageX-zt.x,en=ht.pageY-zt.y,xn=Math.sqrt(dn*dn+en*en);V.set(0,xn),z.set(0,Math.pow(V.y/H.y,m.zoomSpeed)),ke(z.y),H.copy(V)}function Gt(ht){m.enableZoom&&jt(ht),m.enablePan&&Lt(ht)}function fn(ht){m.enableZoom&&jt(ht),m.enableRotate&&St(ht)}function hn(ht){m.enabled!==!1&&(K.length===0&&(m.domElement.setPointerCapture(ht.pointerId),m.domElement.addEventListener("pointermove",qt),m.domElement.addEventListener("pointerup",An)),pt(ht),ht.pointerType==="touch"?Le(ht):_n(ht))}function qt(ht){m.enabled!==!1&&(ht.pointerType==="touch"?Oe(ht):Bn(ht))}function An(ht){Mt(ht),K.length===0&&(m.domElement.releasePointerCapture(ht.pointerId),m.domElement.removeEventListener("pointermove",qt),m.domElement.removeEventListener("pointerup",An)),m.dispatchEvent(_endEvent),A=_.NONE}function _n(ht){let zt;switch(ht.button){case 0:zt=m.mouseButtons.LEFT;break;case 1:zt=m.mouseButtons.MIDDLE;break;case 2:zt=m.mouseButtons.RIGHT;break;default:zt=-1}switch(zt){case MOUSE.DOLLY:if(m.enableZoom===!1)return;Ze(ht),A=_.DOLLY;break;case MOUSE.ROTATE:if(ht.ctrlKey||ht.metaKey||ht.shiftKey){if(m.enablePan===!1)return;tt(ht),A=_.PAN}else{if(m.enableRotate===!1)return;Ye(ht),A=_.ROTATE}break;case MOUSE.PAN:if(ht.ctrlKey||ht.metaKey||ht.shiftKey){if(m.enableRotate===!1)return;Ye(ht),A=_.ROTATE}else{if(m.enablePan===!1)return;tt(ht),A=_.PAN}break;default:A=_.NONE}A!==_.NONE&&m.dispatchEvent(_startEvent)}function Bn(ht){switch(A){case _.ROTATE:if(m.enableRotate===!1)return;Pt(ht);break;case _.DOLLY:if(m.enableZoom===!1)return;Et(ht);break;case _.PAN:if(m.enablePan===!1)return;Ne(ht);break}}function de(ht){m.enabled===!1||m.enableZoom===!1||A!==_.NONE||(ht.preventDefault(),m.dispatchEvent(_startEvent),et(ht),m.dispatchEvent(_endEvent))}function Ae(ht){m.enabled===!1||m.enablePan===!1||wt(ht)}function Le(ht){switch(Bt(ht),K.length){case 1:switch(m.touches.ONE){case TOUCH.ROTATE:if(m.enableRotate===!1)return;Zt(),A=_.TOUCH_ROTATE;break;case TOUCH.PAN:if(m.enablePan===!1)return;nn(),A=_.TOUCH_PAN;break;default:A=_.NONE}break;case 2:switch(m.touches.TWO){case TOUCH.DOLLY_PAN:if(m.enableZoom===!1&&m.enablePan===!1)return;Jn(),A=_.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(m.enableZoom===!1&&m.enableRotate===!1)return;Ue(),A=_.TOUCH_DOLLY_ROTATE;break;default:A=_.NONE}break;default:A=_.NONE}A!==_.NONE&&m.dispatchEvent(_startEvent)}function Oe(ht){switch(Bt(ht),A){case _.TOUCH_ROTATE:if(m.enableRotate===!1)return;St(ht),m.update();break;case _.TOUCH_PAN:if(m.enablePan===!1)return;Lt(ht),m.update();break;case _.TOUCH_DOLLY_PAN:if(m.enableZoom===!1&&m.enablePan===!1)return;Gt(ht),m.update();break;case _.TOUCH_DOLLY_ROTATE:if(m.enableZoom===!1&&m.enableRotate===!1)return;fn(ht),m.update();break;default:A=_.NONE}}function $e(ht){m.enabled!==!1&&ht.preventDefault()}function pt(ht){K.push(ht)}function Mt(ht){delete Y[ht.pointerId];for(let zt=0;zt<K.length;zt++)if(K[zt].pointerId==ht.pointerId){K.splice(zt,1);return}}function Bt(ht){let zt=Y[ht.pointerId];zt===void 0&&(zt=new Vector2,Y[ht.pointerId]=zt),zt.set(ht.pageX,ht.pageY)}function xt(ht){const zt=ht.pointerId===K[0].pointerId?K[1]:K[0];return Y[zt.pointerId]}m.domElement.addEventListener("contextmenu",$e),m.domElement.addEventListener("pointerdown",hn),m.domElement.addEventListener("pointercancel",An),m.domElement.addEventListener("wheel",de,{passive:!1}),this.update()}}const _taskCache=new WeakMap;class DRACOLoader extends Loader{constructor(r){super(r),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(r){return this.decoderPath=r,this}setDecoderConfig(r){return this.decoderConfig=r,this}setWorkerLimit(r){return this.workerLimit=r,this}load(r,i,m,_){const A=new FileLoader(this.manager);A.setPath(this.path),A.setResponseType("arraybuffer"),A.setRequestHeader(this.requestHeader),A.setWithCredentials(this.withCredentials),A.load(r,w=>{this.parse(w,i,_)},m,_)}parse(r,i,m){this.decodeDracoFile(r,i,null,null,SRGBColorSpace).catch(m)}decodeDracoFile(r,i,m,_,A=LinearSRGBColorSpace){const w={attributeIDs:m||this.defaultAttributeIDs,attributeTypes:_||this.defaultAttributeTypes,useUniqueIDs:!!m,vertexColorSpace:A};return this.decodeGeometry(r,w).then(i)}decodeGeometry(r,i){const m=JSON.stringify(i);if(_taskCache.has(r)){const R=_taskCache.get(r);if(R.key===m)return R.promise;if(r.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let _;const A=this.workerNextTaskID++,w=r.byteLength,T=this._getWorker(A,w).then(R=>(_=R,new Promise((D,U)=>{_._callbacks[A]={resolve:D,reject:U},_.postMessage({type:"decode",id:A,taskConfig:i,buffer:r},[r])}))).then(R=>this._createGeometry(R.geometry));return T.catch(()=>!0).then(()=>{_&&A&&this._releaseTask(_,A)}),_taskCache.set(r,{key:m,promise:T}),T}_createGeometry(r){const i=new BufferGeometry$1;r.index&&i.setIndex(new BufferAttribute(r.index.array,1));for(let m=0;m<r.attributes.length;m++){const _=r.attributes[m],A=_.name,w=_.array,T=_.itemSize,R=new BufferAttribute(w,T);A==="color"&&(this._assignVertexColorSpace(R,_.vertexColorSpace),R.normalized=!(w instanceof Float32Array)),i.setAttribute(A,R)}return i}_assignVertexColorSpace(r,i){if(i!==SRGBColorSpace)return;const m=new Color;for(let _=0,A=r.count;_<A;_++)m.fromBufferAttribute(r,_).convertSRGBToLinear(),r.setXYZ(_,m.r,m.g,m.b)}_loadLibrary(r,i){const m=new FileLoader(this.manager);return m.setPath(this.decoderPath),m.setResponseType(i),m.setWithCredentials(this.withCredentials),new Promise((_,A)=>{m.load(r,_,void 0,A)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const r=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return r?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(m=>{const _=m[0];r||(this.decoderConfig.wasmBinary=m[1]);const A=DRACOWorker.toString(),w=["/* draco decoder */",_,"","/* worker */",A.substring(A.indexOf("{")+1,A.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([w]))}),this.decoderPending}_getWorker(r,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const _=new Worker(this.workerSourceURL);_._callbacks={},_._taskCosts={},_._taskLoad=0,_.postMessage({type:"init",decoderConfig:this.decoderConfig}),_.onmessage=function(A){const w=A.data;switch(w.type){case"decode":_._callbacks[w.id].resolve(w);break;case"error":_._callbacks[w.id].reject(w);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+w.type+'"')}},this.workerPool.push(_)}else this.workerPool.sort(function(_,A){return _._taskLoad>A._taskLoad?-1:1});const m=this.workerPool[this.workerPool.length-1];return m._taskCosts[r]=i,m._taskLoad+=i,m})}_releaseTask(r,i){r._taskLoad-=r._taskCosts[i],delete r._callbacks[i],delete r._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(r=>r._taskLoad))}dispose(){for(let r=0;r<this.workerPool.length;++r)this.workerPool[r].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function DRACOWorker(){let u,r;onmessage=function(w){const T=w.data;switch(T.type){case"init":u=T.decoderConfig,r=new Promise(function(U){u.onModuleLoaded=function(k){U({draco:k})},DracoDecoderModule(u)});break;case"decode":const R=T.buffer,D=T.taskConfig;r.then(U=>{const k=U.draco,X=new k.Decoder;try{const J=i(k,X,new Int8Array(R),D),$=J.attributes.map(oe=>oe.array.buffer);J.index&&$.push(J.index.array.buffer),self.postMessage({type:"decode",id:T.id,geometry:J},$)}catch(J){console.error(J),self.postMessage({type:"error",id:T.id,error:J.message})}finally{k.destroy(X)}});break}};function i(w,T,R,D){const U=D.attributeIDs,k=D.attributeTypes;let X,J;const $=T.GetEncodedGeometryType(R);if($===w.TRIANGULAR_MESH)X=new w.Mesh,J=T.DecodeArrayToMesh(R,R.byteLength,X);else if($===w.POINT_CLOUD)X=new w.PointCloud,J=T.DecodeArrayToPointCloud(R,R.byteLength,X);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!J.ok()||X.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+J.error_msg());const oe={index:null,attributes:[]};for(const ne in U){const H=self[k[ne]];let V,z;if(D.useUniqueIDs)z=U[ne],V=T.GetAttributeByUniqueId(X,z);else{if(z=T.GetAttributeId(X,w[U[ne]]),z===-1)continue;V=T.GetAttribute(X,z)}const ce=_(w,T,X,ne,H,V);ne==="color"&&(ce.vertexColorSpace=D.vertexColorSpace),oe.attributes.push(ce)}return $===w.TRIANGULAR_MESH&&(oe.index=m(w,T,X)),w.destroy(X),oe}function m(w,T,R){const U=R.num_faces()*3,k=U*4,X=w._malloc(k);T.GetTrianglesUInt32Array(R,k,X);const J=new Uint32Array(w.HEAPF32.buffer,X,U).slice();return w._free(X),{array:J,itemSize:1}}function _(w,T,R,D,U,k){const X=k.num_components(),$=R.num_points()*X,oe=$*U.BYTES_PER_ELEMENT,ne=A(w,U),H=w._malloc(oe);T.GetAttributeDataArrayForAllPoints(R,k,ne,oe,H);const V=new U(w.HEAPF32.buffer,H,$).slice();return w._free(H),{name:D,array:V,itemSize:X}}function A(w,T){switch(T){case Float32Array:return w.DT_FLOAT32;case Int8Array:return w.DT_INT8;case Int16Array:return w.DT_INT16;case Int32Array:return w.DT_INT32;case Uint8Array:return w.DT_UINT8;case Uint16Array:return w.DT_UINT16;case Uint32Array:return w.DT_UINT32}}}class RGBELoader extends DataTextureLoader{constructor(r){super(r),this.type=HalfFloatType}parse(r){const w=function(Y,ie){switch(Y){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(ie||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(ie||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(ie||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(ie||""))}},U=`
`,k=function(Y,ie,ve){ie=ie||1024;let ae=Y.pos,me=-1,ye=0,Te="",ke=String.fromCharCode.apply(null,new Uint16Array(Y.subarray(ae,ae+128)));for(;0>(me=ke.indexOf(U))&&ye<ie&&ae<Y.byteLength;)Te+=ke,ye+=ke.length,ae+=128,ke+=String.fromCharCode.apply(null,new Uint16Array(Y.subarray(ae,ae+128)));return-1<me?(ve!==!1&&(Y.pos+=ye+me+1),Te+ke.slice(0,me)):!1},X=function(Y){const ie=/^#\?(\S+)/,ve=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,re=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,ae=/^\s*FORMAT=(\S+)\s*$/,me=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,ye={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Te,ke;for((Y.pos>=Y.byteLength||!(Te=k(Y)))&&w(1,"no header found"),(ke=Te.match(ie))||w(3,"bad initial token"),ye.valid|=1,ye.programtype=ke[1],ye.string+=Te+`
`;Te=k(Y),Te!==!1;){if(ye.string+=Te+`
`,Te.charAt(0)==="#"){ye.comments+=Te+`
`;continue}if((ke=Te.match(ve))&&(ye.gamma=parseFloat(ke[1])),(ke=Te.match(re))&&(ye.exposure=parseFloat(ke[1])),(ke=Te.match(ae))&&(ye.valid|=2,ye.format=ke[1]),(ke=Te.match(me))&&(ye.valid|=4,ye.height=parseInt(ke[1],10),ye.width=parseInt(ke[2],10)),ye.valid&2&&ye.valid&4)break}return ye.valid&2||w(3,"missing format specifier"),ye.valid&4||w(3,"missing image size specifier"),ye},J=function(Y,ie,ve){const re=ie;if(re<8||re>32767||Y[0]!==2||Y[1]!==2||Y[2]&128)return new Uint8Array(Y);re!==(Y[2]<<8|Y[3])&&w(3,"wrong scanline width");const ae=new Uint8Array(4*ie*ve);ae.length||w(4,"unable to allocate buffer space");let me=0,ye=0;const Te=4*re,ke=new Uint8Array(4),Fe=new Uint8Array(Te);let Ve=ve;for(;Ve>0&&ye<Y.byteLength;){ye+4>Y.byteLength&&w(1),ke[0]=Y[ye++],ke[1]=Y[ye++],ke[2]=Y[ye++],ke[3]=Y[ye++],(ke[0]!=2||ke[1]!=2||(ke[2]<<8|ke[3])!=re)&&w(3,"bad rgbe scanline format");let ot=0,Ye;for(;ot<Te&&ye<Y.byteLength;){Ye=Y[ye++];const tt=Ye>128;if(tt&&(Ye-=128),(Ye===0||ot+Ye>Te)&&w(3,"bad scanline data"),tt){const Pt=Y[ye++];for(let Et=0;Et<Ye;Et++)Fe[ot++]=Pt}else Fe.set(Y.subarray(ye,ye+Ye),ot),ot+=Ye,ye+=Ye}const Ze=re;for(let tt=0;tt<Ze;tt++){let Pt=0;ae[me]=Fe[tt+Pt],Pt+=re,ae[me+1]=Fe[tt+Pt],Pt+=re,ae[me+2]=Fe[tt+Pt],Pt+=re,ae[me+3]=Fe[tt+Pt],me+=4}Ve--}return ae},$=function(Y,ie,ve,re){const ae=Y[ie+3],me=Math.pow(2,ae-128)/255;ve[re+0]=Y[ie+0]*me,ve[re+1]=Y[ie+1]*me,ve[re+2]=Y[ie+2]*me,ve[re+3]=1},oe=function(Y,ie,ve,re){const ae=Y[ie+3],me=Math.pow(2,ae-128)/255;ve[re+0]=DataUtils.toHalfFloat(Math.min(Y[ie+0]*me,65504)),ve[re+1]=DataUtils.toHalfFloat(Math.min(Y[ie+1]*me,65504)),ve[re+2]=DataUtils.toHalfFloat(Math.min(Y[ie+2]*me,65504)),ve[re+3]=DataUtils.toHalfFloat(1)},ne=new Uint8Array(r);ne.pos=0;const H=X(ne),V=H.width,z=H.height,ce=J(ne.subarray(ne.pos),V,z);let ue,he,K;switch(this.type){case FloatType:K=ce.length/4;const Y=new Float32Array(K*4);for(let ve=0;ve<K;ve++)$(ce,ve*4,Y,ve*4);ue=Y,he=FloatType;break;case HalfFloatType:K=ce.length/4;const ie=new Uint16Array(K*4);for(let ve=0;ve<K;ve++)oe(ce,ve*4,ie,ve*4);ue=ie,he=HalfFloatType;break;default:throw new Error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:V,height:z,data:ue,header:H.string,gamma:H.gamma,exposure:H.exposure,type:he}}setDataType(r){return this.type=r,this}load(r,i,m,_){function A(w,T){switch(w.type){case FloatType:case HalfFloatType:w.colorSpace=LinearSRGBColorSpace,w.minFilter=LinearFilter,w.magFilter=LinearFilter,w.generateMipmaps=!1,w.flipY=!0;break}i&&i(w,T)}return super.load(r,A,m,_)}}class CustomMaterialConfigPlugin extends __webpackgi_exports__MaterialConfiguratorBasePlugin{async _refreshUi(){if(!await super._refreshUi())return!1;const r=document.getElementById("mconfigurator");r.innerHTML="";for(const i of this.variations){console.log(i.title);const m=document.createElement("div");m.classList.add("variations"),m.innerHTML='<span class="variationTitle"> '+i.title,r.appendChild(m);const _=document.createElement("div");_.classList.add("variationTile"),m.appendChild(_),i.materials.map(A=>{let w;if(i.preview.startsWith("generate:"))w=this._previewGenerator.generate(A,i.preview.split(":")[1]);else{const D=A[i.preview]||"#ff00ff";w=D.image||D,w=D.image?__webpackgi_exports__imageBitmapToBase64(D.image,100):void 0,w||(w=__webpackgi_exports__makeColorSvgCircle(D))}const T=()=>{this.applyVariation(i,A.uuid)};console.log({uid:A.uuid,color:A.color,material:A,image:w,onClick:T});const R=document.createElement("div");R.classList.add("variationSelector"),R.innerHTML='<img class="variationImage" src="'+w+'" title="'+A.name+'"/>',R.onclick=T,_.append(R)})}return!0}}cI(CustomMaterialConfigPlugin,"PluginType","MaterialConfiguratorPlugin");let app;const initWedRingMainApp=function(){return app=createApp({props:[]},{properties:[]}),app.component("headercmp",{props:[],data(){return{}},created(){},mounted(){},methods:{},template:`
        <div class="headerPanel" :style="{'opacity': showPropertyMode ? '0.5':'1'}">
            <figure class="logo" onclick="location.href='/Jewellery/index.html'">
                <img src="./images/tanishqlogo.svg">
            </figure>
            <div class="searchbox"><span class="searchplaceholder">Search for Gold Jewellery, Diamond Jewellery and more...</span></div>
            <nav id="navright" class="nav">
                <ul class="slider-ul">
                    <li class="slider-li">
                    <a class="sliderA" href="/Jewellery/index.html"><span class="navSpan">Home</span></a>
                    </li>
                    <li class="slider-li">
                            <a class="sliderA" href="#"><span class="navSpan">Collection</span></a>
                    </li>
                    <li class="slider-li">
                            <a class="sliderA" href="#"><span class="navSpan">About</span></a>
                    </li>
                    <li class="slider-li">
                    <a class="sliderA" href="#">
                        <span>Account</span>
                    </a>
                    </li>
                    <li class="slider-li">
                    <a class="sliderA" href="#">
                        <span>Cart</span>
                        <div class="cart-total">0</div>
                    </a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="menuNavBar">
            <nav class="nav">
                <ul class="slider-ul">
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span class="navSpan">All jewellery</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span class="navSpan">Gold</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span class="navSpan">Diamond</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>Earrings</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>Rings</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>Wedding Rings</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>Rivaah</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>MIA</span></a>
                    </li>
                    <li class="slider-li-menu slider-li">
                        <a class="sliderA-menu sliderA" href="#"><span>More</span></a>
                    </li>
                </ul>
            </nav>
        </div>
    `}),app.component("footercmp",{props:[],data(){return{}},created(){},mounted(){},methods:{},template:`
        <footer class="footerBlock">
        <div style="display:flex; flex-direction:row;">
        <div style="margin-left:4em;width:20em"><h2 class="footerTitle">Useful Links</h2>
            <ul id="collapsible-links" class="menu-footer content">
            <li><a class="gtm-footer-link" href="#" title="Delivery Information" >Delivery Information</a></li>
            <li><a class="gtm-footer-link" href="#" title="International Shipping" >International Shipping</a></li>
            <li><a class="gtm-footer-link" href="#" title="Payment Options" >Payment Options</a></li>
            <li><a class="gtm-footer-link" href="#" title="Track your Order" >Track your Order</a></li>
            <li><a class="gtm-footer-link" href="#" title="Returns" >Returns</a></li>
            <li><a class="gtm-footer-link" href="#" title="Find a Store" >Find a Store</a></li>
            </ul>
        </div>
        <div style="margin-left:4em;width:20em"><h2 class="footerTitle">Information</h2>
            <ul id="collapsible-links" class="menu-footer content">
            <li><a class="gtm-footer-link" href="#" title="Delivery Information" >Careers</a></li>
            <li><a class="gtm-footer-link" href="#" title="International Shipping" >Blog</a></li>
            <li><a class="gtm-footer-link" href="#" title="Payment Options" >Offers & Contest Details</a></li>
            <li><a class="gtm-footer-link" href="#" title="Track your Order" >Help & FAQs</a></li>
            <li><a class="gtm-footer-link" href="#" title="Returns" >About Tanishq</a></li>
            </ul>
        </div>
        <div style="margin-left:4em;width:20em"><h2 class="footerTitle">Contact Us</h2>
            <ul id="collapsible-links" class="menu-footer content">
            <li><a class="gtm-footer-link" href="#" title="Delivery Information" >Write to Us</a></li>
            <li><a class="gtm-footer-link" href="#" title="International Shipping" >1800-266-0123</a></li>
            <li><a class="gtm-footer-link" href="#" title="Payment Options" >Chat with Us</a></li>
            </ul>
        </div>
        <div style="margin-left:4em;width:20em"><h2 class="footerTitle">Download</h2>
            <div>
            <a class="gtm-footer-link" href="#">
                <img class="app-download appstore-img" src="./images/appstore.png" alt="appstore">
            </a>
            <a class="gtm-footer-link" href="#">
                <img class="app-download" src="./images/playstore.png" alt="sdf">
            </a>
            </div>
        </div>
        </div>
        <div>
            <p style="margin-left:2em; font-size:large; color:red">**This is a demo website for training purpose only. It has no connection with or have intention to replicate the original Tanishq website.</p>
        </div>
        </footer>
   `}),app.component("editorscene",{props:["editMode"],data(){return{isLoaded:!1,loadPercentage:0,nightMode:!0}},created(){document.addEventListener("removethreeinstance",()=>{})},mounted(){document.documentElement.className="night",this.loadPercentage=10,setTimeout(()=>{this.initWebGI()},1e3)},unmounted(){this.viewer.renderer.refreshPipeline(),this.viewer.scene.disposeSceneModels(),this.viewer.dispose()},watch:{loadPercentage:function(u){const r=document.getElementById("loader");r!=null&&(r.style.width=this.loadPercentage+"%"),u===100&&(this.isLoaded=!0)}},methods:{toggleSceneMode(){this.nightMode=!this.nightMode,document.getElementById("customizeEditorContainer"),document.getElementById("closeEditorDiv"),this.nightMode?document.documentElement.className="night":document.documentElement.className="day"},async initWebGI(){this.loadPercentage=50,this.viewer=new __webpackgi_exports__ViewerApp({canvas:document.getElementById("editorSceneBlock"),alpha:!0,isAntialiased:!0,useRgbm:!0});const u=new __webpackgi_exports__AssetManagerPlugin;await this.viewer.addPlugin(u),await __webpackgi_exports__addBasePlugins(this.viewer),await this.viewer.addPlugin(CustomMaterialConfigPlugin),this.viewer.renderer.refreshPipeline();const r={autoScale:!1};await u.addFromPath("./objects/ring1.glb",r),this.viewer.scene.environment=await u.importer.importSingle({path:"./images/gem_2.hdr"}),this.viewer.scene.envMapIntensity=.5,this.loadPercentage=100,this.viewer.removePlugin(__webpackgi_exports__MaterialConfiguratorPlugin,!0)},initScene(){this.dom=document.getElementById("editorSceneBlock"),this.loadPercentage=20;const u=this.dom.getBoundingClientRect().width,r=this.dom.getBoundingClientRect().height;this.scene=new Scene,this.camera=new PerspectiveCamera(5,u/r,1,2e3),this.renderer=new WebGLRenderer({antialias:!0}),this.renderer.setSize(u,r),this.renderer.domElement.style.height=`${r} + 'px'`,this.renderer.domElement.style.width=`${u} + 'px'`,this.renderer.domElement.width=u,this.renderer.domElement.height=r,this.dom.appendChild(this.renderer.domElement),this.renderer.setClearColor(0,0),this.controls=new OrbitControls(this.camera,this.renderer.domElement),this.loadProductGltfModel(),this.loadPercentage=30;const i=new PMREMGenerator(this.renderer);i.compileCubemapShader(),DefaultLoadingManager.onLoad=function(){i.dispose()},new RGBELoader().setPath("./images/").load("aircraft_workshop_01_1k.hdr",this.envLoadComplete),this.camera.position.set(0,0,300),this.camera.lookAt(0,0,0),this.camera.updateProjectionMatrix(),this.controls.autoRotateSpeed=1.5,this.controls.minDistance=130,this.controls.maxDistance=350,this.controls.enablePan=!1,this.loadPercentage=35,this.startRendering()},envLoadComplete(u){u.mapping=EquirectangularReflectionMapping,this.scene.environment=u},loadComplete(u){this.meshes=u.scene.children[0].children[0].children[0].children,this.scene.add(u.scene),u.scene.position.y=0,u.scene.scale.set(7,7,7),u.scene.rotation.set(-20*Math.PI/180,-10*Math.PI/180,0),this.meshes[5].material.refractionRatio=.98,this.meshes[5].material.reflectivity=.9,this.loadPercentage=100},loadProductGltfModel(){const u=new GLTFLoader,r=new DRACOLoader;r.setDecoderConfig({type:"js"}),r.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),u.setDRACOLoader(r),u.load("./objects/ring_webgi.glb",this.loadComplete,function(i){console.log(i.loaded/i.total*100+"% loaded")},function(i){console.log("An error happened")}),this.loadPercentage=60},animate(){this.renderer.render(this.scene,this.camera),this.controls.update()},startRendering(){this.renderer.setAnimationLoop(this.animate)},stopRendering(){this.renderer.setAnimationLoop(null)},destroyInstance(){this.renderer.dispose(),this.renderer.forceContextLoss()}},template:`
            <div id="editorLoader" v-if="!isLoaded">
                <div id="loader"></div>
            </div>
            <canvas id="editorSceneBlock" height="100%" width="100%"></canvas>
            <div id="sceneBackgroundControlDiv">
                <img v-if="nightMode" id="moon" src="./images/moon.svg" @click="toggleSceneMode()">
                <img v-if="!nightMode" id="moon" src="./images/daymode.svg" @click="toggleSceneMode()">
            </div>
            <div :style="{'width':isLoaded ? '30vw' : '0' }" id="mconfiguratorBlock">
            </div>
            <div :style="{'width':isLoaded ? '30vw' : '0' }" id="mconfigurator"></div>
    `}),app.component("wedapp",{props:[],data(){return{weddrings:[],weddringColSize:4,customizeMode:!1}},created(){this.weddrings=weddrings},mounted(){},methods:{getWeddringRowNum(){return Math.ceil(this.weddrings.length/this.weddringColSize)},getWeddringIndex(u,r){return(u-1)*this.weddringColSize+r},isCellAvailable(u,r){return!(this.getWeddringIndex(u,r)>this.weddrings.length)},openCategory(u){},startCustomizing(){this.customizeMode=!0;const u=document.getElementById("customizeEditorContainer");u!=null?(u.style.top="0",u.style.left="0",u.style.height="100vh",u.style.width="100vw",u.style.opacity="1",document.getElementsByTagName("body")[0].style.overflow="hidden"):console.log("editor dom not available")},closeCustomizEditor(){document.dispatchEvent(new Event("removethreeinstance")),this.customizeMode=!1;const u=document.getElementById("customizeEditorContainer");u!=null?(document.getElementsByTagName("body")[0].style.removeProperty("overflow"),u.style.top="40vh",u.style.left="40vw",u.style.height="20vh",u.style.width="20vw",u.style.opacity="0"):console.log("editor dom not available")}},template:`
        <headercmp></headercmp>
        <div id="customizeEditorContainer">
            <div id="closeEditorDiv" @click="closeCustomizEditor()">x</div>
            <editorscene :editMode="customizeMode" v-if="customizeMode"></editorscene>
        </div>
        <div id="weddingRingAdArea">
            <div style="position:absolute;top: 25vh;left: 4em;">
            <h1 id="weddHead">Your loved ones are <span id="weddHeadUnique">Unique</span></h1>
            <h3 id="weddSubHead">so should be their, Rings.</h3>
            <p id="weddsub">Customize your uniqe ring with realistic graphics and pure beauty of the collection.</p>
            <div id="customizeButton" @click="startCustomizing()">
                <span style="font-size: larger;padding-left: 1em;">Start now</span>
                <div id="customizeButtonCircle"><img style="height:1.2em;width:1.2em" src="./images/edit.svg"/></div>
            </div>
            </div>
        </div>
        <div class="categoryHeadBlock">
            <div class="categoryHead"><h4>Wedding Rings</h4></div>
            <div class="categoryHeadSub"><p>Browse through our vast collection to find the perfect one as yours!</p></div>
            <img src="./images/Line-Design.svg" style="margin-top: -20px;"/>
        </div>
        <div class="categoryBlock">
            <table class="catagoryTable" style="width: 95%">
                <tr v-for="row in Number(getWeddringRowNum())" style="padding-bottom:1em">
                    <td class="categoryGrid" v-for="col in Number(weddringColSize)" style="padding-bottom: 1.5em;">
                        <div style="border: 1px solid rgb(43,24,25,0.7);width: 92%;cursor: default;" class="categoryItemBlock" v-if="isCellAvailable(row,col)" @click="openCategory(weddrings[getWeddringIndex(row,col)-1])">
                            <div class="categoryImgContainer"><img style="width:100%; cursor: pointer;" :src="'./images/'+ weddrings[getWeddringIndex(row,col)-1].imgSrc"></div>
                            <div class="categoryTitleContainer" style="padding-left:1em;color: #222;border-top: 1px solid rgb(43,24,25,0.7);margin-bottom:1rem">
                                <h4 style="max-width:90%; overflow:hidden;margin-bottom:0;font-weight:bold;font-size:0.9rem">{{weddrings[getWeddringIndex(row,col)-1].name}}</h4>
                                <span class="p-price">&#8377; {{weddrings[getWeddringIndex(row,col)-1].price}}</span>
                                <span class="p-gender">{{weddrings[getWeddringIndex(row,col)-1].gender}} | {{weddrings[getWeddringIndex(row,col)-1].category}}</span>
                                <div class="exploreButtonBox">Explore</div>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div style="width:88%;height:4em;margin:auto;display:flex;justify-content: center;border-top: 1px solid #361a1a2e; padding-top:2em">
            <div style="width:10em" class="exploreButtonBox">Load More</div>
        </div>
        <div class="categoryHeadBlock">
            <div class="categoryHead"><h4>Connect With Us</h4></div>
            <div class="categoryHeadSub"><p>We are always available to guide you at your convenience.</p></div>
            <img src="./images/Line-Design.svg" style="margin-top: -20px;"/>
        </div>
        <footercmp></footercmp>
        `}),app},initHome=function(){initMainApp().mount("#app")},initWeddingRingApp=function(){initWedRingMainApp().mount("#weddingApp")};function main(){const u=document.getElementById("mainScript");if(u==null){try{initHome()}catch(r){console.log(r)}try{initWeddingRingApp()}catch(r){console.log(r)}}else u.getAttribute("page")==="mainapp"?initHome():u.getAttribute("page")==="weddingrings"&&initWeddingRingApp()}window.onload=function(){main()};/*!
 * VERSION: 2.1.3
 * DATE: 2019-05-17
 * UPDATES AND DOCS AT: http://greensock.com
 * 
 * Includes all of the following: TweenLite, TweenMax, TimelineLite, TimelineMax, EasePack, CSSPlugin, RoundPropsPlugin, BezierPlugin, AttrPlugin, DirectionalRotationPlugin
 *
 * @license Copyright (c) 2008-2019, GreenSock. All rights reserved.
 * This work is subject to the terms at http://greensock.com/standard-license or for
 * Club GreenSock members, the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 **/var _gsScope=typeof module<"u"&&module.exports&&typeof global<"u"?global:globalThis||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){_gsScope._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(u,r,i){var m=function(ne){var H=[],V=ne.length,z;for(z=0;z!==V;H.push(ne[z++]));return H},_=function(ne,H,V){var z=ne.cycle,ce,ue;for(ce in z)ue=z[ce],ne[ce]=typeof ue=="function"?ue(V,H[V],H):ue[V%ue.length];delete ne.cycle},A=function(ne){if(typeof ne=="function")return ne;var H=typeof ne=="object"?ne:{each:ne},V=H.ease,z=H.from||0,ce=H.base||0,ue={},he=isNaN(z),K=H.axis,Y={center:.5,end:1}[z]||0;return function(ie,ve,re){var ae=(re||H).length,me=ue[ae],ye,Te,ke,Fe,Ve,ot,Ye,Ze,tt;if(!me){if(tt=H.grid==="auto"?0:(H.grid||[1/0])[0],!tt){for(Ye=-1/0;Ye<(Ye=re[tt++].getBoundingClientRect().left)&&tt<ae;);tt--}for(me=ue[ae]=[],ye=he?Math.min(tt,ae)*Y-.5:z%tt,Te=he?ae*Y/tt-.5:z/tt|0,Ye=0,Ze=1/0,ot=0;ot<ae;ot++)ke=ot%tt-ye,Fe=Te-(ot/tt|0),me[ot]=Ve=K?Math.abs(K==="y"?Fe:ke):Math.sqrt(ke*ke+Fe*Fe),Ve>Ye&&(Ye=Ve),Ve<Ze&&(Ze=Ve);me.max=Ye-Ze,me.min=Ze,me.v=ae=H.amount||H.each*(tt>ae?ae-1:K?K==="y"?ae/tt:tt:Math.max(tt,ae/tt))||0,me.b=ae<0?ce-ae:ce}return ae=(me[ie]-me.min)/me.max,me.b+(V?V.getRatio(ae):ae)*me.v}},w=function(ne,H,V){i.call(this,ne,H,V),this._cycle=0,this._yoyo=this.vars.yoyo===!0||!!this.vars.yoyoEase,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._repeat&&this._uncache(!0),this.render=w.prototype.render},T=1e-8,R=i._internals,D=R.isSelector,U=R.isArray,k=w.prototype=i.to({},.1,{}),X=[];w.version="2.1.3",k.constructor=w,k.kill()._gc=!1,w.killTweensOf=w.killDelayedCallsTo=i.killTweensOf,w.getTweensOf=i.getTweensOf,w.lagSmoothing=i.lagSmoothing,w.ticker=i.ticker,w.render=i.render,w.distribute=A,k.invalidate=function(){return this._yoyo=this.vars.yoyo===!0||!!this.vars.yoyoEase,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._yoyoEase=null,this._uncache(!0),i.prototype.invalidate.call(this)},k.updateTo=function(ne,H){var V=this,z=V.ratio,ce=V.vars.immediateRender||ne.immediateRender,ue;H&&V._startTime<V._timeline._time&&(V._startTime=V._timeline._time,V._uncache(!1),V._gc?V._enabled(!0,!1):V._timeline.insert(V,V._startTime-V._delay));for(ue in ne)V.vars[ue]=ne[ue];if(V._initted||ce){if(H)V._initted=!1,ce&&V.render(0,!0,!0);else if(V._gc&&V._enabled(!0,!1),V._notifyPluginsOfEnabled&&V._firstPT&&i._onPluginEvent("_onDisable",V),V._time/V._duration>.998){var he=V._totalTime;V.render(0,!0,!1),V._initted=!1,V.render(he,!0,!1)}else if(V._initted=!1,V._init(),V._time>0||ce)for(var K=1/(1-z),Y=V._firstPT,ie;Y;)ie=Y.s+Y.c,Y.c*=K,Y.s=ie-Y.c,Y=Y._next}return V},k.render=function(ne,H,V){this._initted||this._duration===0&&this.vars.repeat&&this.invalidate();var z=this,ce=z._dirty?z.totalDuration():z._totalDuration,ue=z._time,he=z._totalTime,K=z._cycle,Y=z._duration,ie=z._rawPrevTime,ve,re,ae,me,ye,Te,ke,Fe,Ve;if(ne>=ce-T&&ne>=0?(z._totalTime=ce,z._cycle=z._repeat,z._yoyo&&z._cycle&1?(z._time=0,z.ratio=z._ease._calcEnd?z._ease.getRatio(0):0):(z._time=Y,z.ratio=z._ease._calcEnd?z._ease.getRatio(1):1),z._reversed||(ve=!0,re="onComplete",V=V||z._timeline.autoRemoveChildren),Y===0&&(z._initted||!z.vars.lazy||V)&&(z._startTime===z._timeline._duration&&(ne=0),(ie<0||ne<=0&&ne>=-T||ie===T&&z.data!=="isPause")&&ie!==ne&&(V=!0,ie>T&&(re="onReverseComplete")),z._rawPrevTime=Fe=!H||ne||ie===ne?ne:T)):ne<T?(z._totalTime=z._time=z._cycle=0,z.ratio=z._ease._calcEnd?z._ease.getRatio(0):0,(he!==0||Y===0&&ie>0)&&(re="onReverseComplete",ve=z._reversed),ne>-T?ne=0:ne<0&&(z._active=!1,Y===0&&(z._initted||!z.vars.lazy||V)&&(ie>=0&&(V=!0),z._rawPrevTime=Fe=!H||ne||ie===ne?ne:T)),z._initted||(V=!0)):(z._totalTime=z._time=ne,z._repeat!==0&&(me=Y+z._repeatDelay,z._cycle=z._totalTime/me>>0,z._cycle!==0&&z._cycle===z._totalTime/me&&he<=ne&&z._cycle--,z._time=z._totalTime-z._cycle*me,z._yoyo&&z._cycle&1&&(z._time=Y-z._time,Ve=z._yoyoEase||z.vars.yoyoEase,Ve&&(z._yoyoEase||(Ve===!0&&!z._initted?(Ve=z.vars.ease,z._yoyoEase=Ve=Ve?Ve instanceof Ease?Ve:typeof Ve=="function"?new Ease(Ve,z.vars.easeParams):Ease.map[Ve]||i.defaultEase:i.defaultEase):z._yoyoEase=Ve=Ve===!0?z._ease:Ve instanceof Ease?Ve:Ease.map[Ve]),z.ratio=Ve?1-Ve.getRatio((Y-z._time)/Y):0)),z._time>Y?z._time=Y:z._time<0&&(z._time=0)),z._easeType&&!Ve?(ye=z._time/Y,Te=z._easeType,ke=z._easePower,(Te===1||Te===3&&ye>=.5)&&(ye=1-ye),Te===3&&(ye*=2),ke===1?ye*=ye:ke===2?ye*=ye*ye:ke===3?ye*=ye*ye*ye:ke===4&&(ye*=ye*ye*ye*ye),z.ratio=Te===1?1-ye:Te===2?ye:z._time/Y<.5?ye/2:1-ye/2):Ve||(z.ratio=z._ease.getRatio(z._time/Y))),ue===z._time&&!V&&K===z._cycle){he!==z._totalTime&&z._onUpdate&&(H||z._callback("onUpdate"));return}else if(!z._initted){if(z._init(),!z._initted||z._gc)return;if(!V&&z._firstPT&&(z.vars.lazy!==!1&&z._duration||z.vars.lazy&&!z._duration)){z._time=ue,z._totalTime=he,z._rawPrevTime=ie,z._cycle=K,R.lazyTweens.push(z),z._lazy=[ne,H];return}z._time&&!ve&&!Ve?z.ratio=z._ease.getRatio(z._time/Y):ve&&this._ease._calcEnd&&!Ve&&(z.ratio=z._ease.getRatio(z._time===0?0:1))}for(z._lazy!==!1&&(z._lazy=!1),z._active||!z._paused&&z._time!==ue&&ne>=0&&(z._active=!0),he===0&&(z._initted===2&&ne>0&&z._init(),z._startAt&&(ne>=0?z._startAt.render(ne,!0,V):re||(re="_dummyGS")),z.vars.onStart&&(z._totalTime!==0||Y===0)&&(H||z._callback("onStart"))),ae=z._firstPT;ae;)ae.f?ae.t[ae.p](ae.c*z.ratio+ae.s):ae.t[ae.p]=ae.c*z.ratio+ae.s,ae=ae._next;z._onUpdate&&(ne<0&&z._startAt&&z._startTime&&z._startAt.render(ne,!0,V),H||(z._totalTime!==he||re)&&z._callback("onUpdate")),z._cycle!==K&&(H||z._gc||z.vars.onRepeat&&z._callback("onRepeat")),re&&(!z._gc||V)&&(ne<0&&z._startAt&&!z._onUpdate&&z._startTime&&z._startAt.render(ne,!0,V),ve&&(z._timeline.autoRemoveChildren&&z._enabled(!1,!1),z._active=!1),!H&&z.vars[re]&&z._callback(re),Y===0&&z._rawPrevTime===T&&Fe!==T&&(z._rawPrevTime=0))},w.to=function(ne,H,V){return new w(ne,H,V)},w.from=function(ne,H,V){return V.runBackwards=!0,V.immediateRender=V.immediateRender!=!1,new w(ne,H,V)},w.fromTo=function(ne,H,V,z){return z.startAt=V,z.immediateRender=z.immediateRender!=!1&&V.immediateRender!=!1,new w(ne,H,z)},w.staggerTo=w.allTo=function(ne,H,V,z,ce,ue,he){var K=[],Y=A(V.stagger||z),ie=V.cycle,ve=(V.startAt||X).cycle,re,ae,me,ye;for(U(ne)||(typeof ne=="string"&&(ne=i.selector(ne)||ne),D(ne)&&(ne=m(ne))),ne=ne||[],re=ne.length-1,me=0;me<=re;me++){ae={};for(ye in V)ae[ye]=V[ye];if(ie&&(_(ae,ne,me),ae.duration!=null&&(H=ae.duration,delete ae.duration)),ve){ve=ae.startAt={};for(ye in V.startAt)ve[ye]=V.startAt[ye];_(ae.startAt,ne,me)}ae.delay=Y(me,ne[me],ne)+(ae.delay||0),me===re&&ce&&(ae.onComplete=function(){V.onComplete&&V.onComplete.apply(V.onCompleteScope||this,arguments),ce.apply(he||V.callbackScope||this,ue||X)}),K[me]=new w(ne[me],H,ae)}return K},w.staggerFrom=w.allFrom=function(ne,H,V,z,ce,ue,he){return V.runBackwards=!0,V.immediateRender=V.immediateRender!=!1,w.staggerTo(ne,H,V,z,ce,ue,he)},w.staggerFromTo=w.allFromTo=function(ne,H,V,z,ce,ue,he,K){return z.startAt=V,z.immediateRender=z.immediateRender!=!1&&V.immediateRender!=!1,w.staggerTo(ne,H,z,ce,ue,he,K)},w.delayedCall=function(ne,H,V,z,ce){return new w(H,0,{delay:ne,onComplete:H,onCompleteParams:V,callbackScope:z,onReverseComplete:H,onReverseCompleteParams:V,immediateRender:!1,useFrames:ce,overwrite:0})},w.set=function(ne,H){return new w(ne,0,H)},w.isTweening=function(ne){return i.getTweensOf(ne,!0).length>0};var J=function(ne,H){for(var V=[],z=0,ce=ne._first;ce;)ce instanceof i?V[z++]=ce:(H&&(V[z++]=ce),V=V.concat(J(ce,H)),z=V.length),ce=ce._next;return V},$=w.getAllTweens=function(ne){return J(u._rootTimeline,ne).concat(J(u._rootFramesTimeline,ne))};w.killAll=function(ne,H,V,z){H==null&&(H=!0),V==null&&(V=!0);var ce=$(z!=!1),ue=ce.length,he=H&&V&&z,K,Y,ie;for(ie=0;ie<ue;ie++)Y=ce[ie],(he||Y instanceof r||(K=Y.target===Y.vars.onComplete)&&V||H&&!K)&&(ne?Y.totalTime(Y._reversed?0:Y.totalDuration()):Y._enabled(!1,!1))},w.killChildTweensOf=function(ne,H){if(ne!=null){var V=R.tweenLookup,z,ce,ue,he,K;if(typeof ne=="string"&&(ne=i.selector(ne)||ne),D(ne)&&(ne=m(ne)),U(ne)){for(he=ne.length;--he>-1;)w.killChildTweensOf(ne[he],H);return}z=[];for(ue in V)for(ce=V[ue].target.parentNode;ce;)ce===ne&&(z=z.concat(V[ue].tweens)),ce=ce.parentNode;for(K=z.length,he=0;he<K;he++)H&&z[he].totalTime(z[he].totalDuration()),z[he]._enabled(!1,!1)}};var oe=function(ne,H,V,z){H=H!==!1,V=V!==!1,z=z!==!1;for(var ce=$(z),ue=H&&V&&z,he=ce.length,K,Y;--he>-1;)Y=ce[he],(ue||Y instanceof r||(K=Y.target===Y.vars.onComplete)&&V||H&&!K)&&Y.paused(ne)};return w.pauseAll=function(ne,H,V){oe(!0,ne,H,V)},w.resumeAll=function(ne,H,V){oe(!1,ne,H,V)},w.globalTimeScale=function(ne){var H=u._rootTimeline,V=i.ticker.time;return arguments.length?(ne=ne||T,H._startTime=V-(V-H._startTime)*H._timeScale/ne,H=u._rootFramesTimeline,V=i.ticker.frame,H._startTime=V-(V-H._startTime)*H._timeScale/ne,H._timeScale=u._rootTimeline._timeScale=ne,ne):H._timeScale},k.progress=function(ne,H){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&this._cycle&1?1-ne:ne)+this._cycle*(this._duration+this._repeatDelay),H):this.duration()?this._time/this._duration:this.ratio},k.totalProgress=function(ne,H){return arguments.length?this.totalTime(this.totalDuration()*ne,H):this._totalTime/this.totalDuration()},k.time=function(ne,H){if(!arguments.length)return this._time;this._dirty&&this.totalDuration();var V=this._duration,z=this._cycle,ce=z*(V+this._repeatDelay);return ne>V&&(ne=V),this.totalTime(this._yoyo&&z&1?V-ne+ce:this._repeat?ne+ce:ne,H)},k.duration=function(ne){return arguments.length?u.prototype.duration.call(this,ne):this._duration},k.totalDuration=function(ne){return arguments.length?this._repeat===-1?this:this.duration((ne-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},k.repeat=function(ne){return arguments.length?(this._repeat=ne,this._uncache(!0)):this._repeat},k.repeatDelay=function(ne){return arguments.length?(this._repeatDelay=ne,this._uncache(!0)):this._repeatDelay},k.yoyo=function(ne){return arguments.length?(this._yoyo=ne,this):this._yoyo},w},!0),_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(u,r,i){var m=function(z){r.call(this,z);var ce=this,ue=ce.vars,he,K;ce._labels={},ce.autoRemoveChildren=!!ue.autoRemoveChildren,ce.smoothChildTiming=!!ue.smoothChildTiming,ce._sortChildren=!0,ce._onUpdate=ue.onUpdate;for(K in ue)he=ue[K],R(he)&&he.join("").indexOf("{self}")!==-1&&(ue[K]=ce._swapSelfInParams(he));R(ue.tweens)&&ce.add(ue.tweens,0,ue.align,ue.stagger)},_=1e-8,A=i._internals,w=m._internals={},T=A.isSelector,R=A.isArray,D=A.lazyTweens,U=A.lazyRender,k=_gsScope._gsDefine.globals,X=function(z){var ce={},ue;for(ue in z)ce[ue]=z[ue];return ce},J=function(z,ce,ue){var he=z.cycle,K,Y;for(K in he)Y=he[K],z[K]=typeof Y=="function"?Y(ue,ce[ue],ce):Y[ue%Y.length];delete z.cycle},$=w.pauseCallback=function(){},oe=function(z){var ce=[],ue=z.length,he;for(he=0;he!==ue;ce.push(z[he++]));return ce},ne=function(z,ce,ue,he){var K="immediateRender";return K in ce||(ce[K]=!(ue&&ue[K]===!1||he)),ce},H=function(z){if(typeof z=="function")return z;var ce=typeof z=="object"?z:{each:z},ue=ce.ease,he=ce.from||0,K=ce.base||0,Y={},ie=isNaN(he),ve=ce.axis,re={center:.5,end:1}[he]||0;return function(ae,me,ye){var Te=(ye||ce).length,ke=Y[Te],Fe,Ve,ot,Ye,Ze,tt,Pt,Et,Ne;if(!ke){if(Ne=ce.grid==="auto"?0:(ce.grid||[1/0])[0],!Ne){for(Pt=-1/0;Pt<(Pt=ye[Ne++].getBoundingClientRect().left)&&Ne<Te;);Ne--}for(ke=Y[Te]=[],Fe=ie?Math.min(Ne,Te)*re-.5:he%Ne,Ve=ie?Te*re/Ne-.5:he/Ne|0,Pt=0,Et=1/0,tt=0;tt<Te;tt++)ot=tt%Ne-Fe,Ye=Ve-(tt/Ne|0),ke[tt]=Ze=ve?Math.abs(ve==="y"?Ye:ot):Math.sqrt(ot*ot+Ye*Ye),Ze>Pt&&(Pt=Ze),Ze<Et&&(Et=Ze);ke.max=Pt-Et,ke.min=Et,ke.v=Te=ce.amount||ce.each*(Ne>Te?Te-1:ve?ve==="y"?Te/Ne:Ne:Math.max(Ne,Te/Ne))||0,ke.b=Te<0?K-Te:K}return Te=(ke[ae]-ke.min)/ke.max,ke.b+(ue?ue.getRatio(Te):Te)*ke.v}},V=m.prototype=new r;return m.version="2.1.3",m.distribute=H,V.constructor=m,V.kill()._gc=V._forcingPlayhead=V._hasPause=!1,V.to=function(z,ce,ue,he){var K=ue.repeat&&k.TweenMax||i;return ce?this.add(new K(z,ce,ue),he):this.set(z,ue,he)},V.from=function(z,ce,ue,he){return this.add((ue.repeat&&k.TweenMax||i).from(z,ce,ne(this,ue)),he)},V.fromTo=function(z,ce,ue,he,K){var Y=he.repeat&&k.TweenMax||i;return he=ne(this,he,ue),ce?this.add(Y.fromTo(z,ce,ue,he),K):this.set(z,he,K)},V.staggerTo=function(z,ce,ue,he,K,Y,ie,ve){var re=new m({onComplete:Y,onCompleteParams:ie,callbackScope:ve,smoothChildTiming:this.smoothChildTiming}),ae=H(ue.stagger||he),me=ue.startAt,ye=ue.cycle,Te,ke;for(typeof z=="string"&&(z=i.selector(z)||z),z=z||[],T(z)&&(z=oe(z)),ke=0;ke<z.length;ke++)Te=X(ue),me&&(Te.startAt=X(me),me.cycle&&J(Te.startAt,z,ke)),ye&&(J(Te,z,ke),Te.duration!=null&&(ce=Te.duration,delete Te.duration)),re.to(z[ke],ce,Te,ae(ke,z[ke],z));return this.add(re,K)},V.staggerFrom=function(z,ce,ue,he,K,Y,ie,ve){return ue.runBackwards=!0,this.staggerTo(z,ce,ne(this,ue),he,K,Y,ie,ve)},V.staggerFromTo=function(z,ce,ue,he,K,Y,ie,ve,re){return he.startAt=ue,this.staggerTo(z,ce,ne(this,he,ue),K,Y,ie,ve,re)},V.call=function(z,ce,ue,he){return this.add(i.delayedCall(0,z,ce,ue),he)},V.set=function(z,ce,ue){return this.add(new i(z,0,ne(this,ce,null,!0)),ue)},m.exportRoot=function(z,ce){z=z||{},z.smoothChildTiming==null&&(z.smoothChildTiming=!0);var ue=new m(z),he=ue._timeline,K,Y,ie,ve;for(ce==null&&(ce=!0),he._remove(ue,!0),ue._startTime=0,ue._rawPrevTime=ue._time=ue._totalTime=he._time,ie=he._first;ie;)ve=ie._next,(!ce||!(ie instanceof i&&ie.target===ie.vars.onComplete))&&(Y=ie._startTime-ie._delay,Y<0&&(K=1),ue.add(ie,Y)),ie=ve;return he.add(ue,0),K&&ue.totalDuration(),ue},V.add=function(z,ce,ue,he){var K=this,Y,ie,ve,re,ae,me;if(typeof ce!="number"&&(ce=K._parseTimeOrLabel(ce,0,!0,z)),!(z instanceof u))if(z instanceof Array||z&&z.push&&R(z)){for(ue=ue||"normal",he=he||0,Y=ce,ie=z.length,ve=0;ve<ie;ve++)R(re=z[ve])&&(re=new m({tweens:re})),K.add(re,Y),typeof re!="string"&&typeof re!="function"&&(ue==="sequence"?Y=re._startTime+re.totalDuration()/re._timeScale:ue==="start"&&(re._startTime-=re.delay())),Y+=he;return K._uncache(!0)}else{if(typeof z=="string")return K.addLabel(z,ce);if(typeof z=="function")z=i.delayedCall(0,z);else throw"Cannot add "+z+" into the timeline; it is not a tween, timeline, function, or string."}if(r.prototype.add.call(K,z,ce),(z._time||!z._duration&&z._initted)&&(Y=(K.rawTime()-z._startTime)*z._timeScale,(!z._duration||Math.abs(Math.max(0,Math.min(z.totalDuration(),Y)))-z._totalTime>1e-5)&&z.render(Y,!1,!1)),(K._gc||K._time===K._duration)&&!K._paused&&K._duration<K.duration())for(ae=K,me=ae.rawTime()>z._startTime;ae._timeline;)me&&ae._timeline.smoothChildTiming?ae.totalTime(ae._totalTime,!0):ae._gc&&ae._enabled(!0,!1),ae=ae._timeline;return K},V.remove=function(z){if(z instanceof u){this._remove(z,!1);var ce=z._timeline=z.vars.useFrames?u._rootFramesTimeline:u._rootTimeline;return z._startTime=(z._paused?z._pauseTime:ce._time)-(z._reversed?z.totalDuration()-z._totalTime:z._totalTime)/z._timeScale,this}else if(z instanceof Array||z&&z.push&&R(z)){for(var ue=z.length;--ue>-1;)this.remove(z[ue]);return this}else if(typeof z=="string")return this.removeLabel(z);return this.kill(null,z)},V._remove=function(z,ce){r.prototype._remove.call(this,z,ce);var ue=this._last;return ue?this._time>this.duration()&&(this._time=this._duration,this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},V.append=function(z,ce){return this.add(z,this._parseTimeOrLabel(null,ce,!0,z))},V.insert=V.insertMultiple=function(z,ce,ue,he){return this.add(z,ce||0,ue,he)},V.appendMultiple=function(z,ce,ue,he){return this.add(z,this._parseTimeOrLabel(null,ce,!0,z),ue,he)},V.addLabel=function(z,ce){return this._labels[z]=this._parseTimeOrLabel(ce),this},V.addPause=function(z,ce,ue,he){var K=i.delayedCall(0,$,ue,he||this);return K.vars.onComplete=K.vars.onReverseComplete=ce,K.data="isPause",this._hasPause=!0,this.add(K,z)},V.removeLabel=function(z){return delete this._labels[z],this},V.getLabelTime=function(z){return this._labels[z]!=null?this._labels[z]:-1},V._parseTimeOrLabel=function(z,ce,ue,he){var K,Y;if(he instanceof u&&he.timeline===this)this.remove(he);else if(he&&(he instanceof Array||he.push&&R(he)))for(Y=he.length;--Y>-1;)he[Y]instanceof u&&he[Y].timeline===this&&this.remove(he[Y]);if(K=typeof z=="number"&&!ce?0:this.duration()>99999999999?this.recent().endTime(!1):this._duration,typeof ce=="string")return this._parseTimeOrLabel(ce,ue&&typeof z=="number"&&this._labels[ce]==null?z-K:0,ue);if(ce=ce||0,typeof z=="string"&&(isNaN(z)||this._labels[z]!=null)){if(Y=z.indexOf("="),Y===-1)return this._labels[z]==null?ue?this._labels[z]=K+ce:ce:this._labels[z]+ce;ce=parseInt(z.charAt(Y-1)+"1",10)*Number(z.substr(Y+1)),z=Y>1?this._parseTimeOrLabel(z.substr(0,Y-1),0,ue):K}else z==null&&(z=K);return Number(z)+ce},V.seek=function(z,ce){return this.totalTime(typeof z=="number"?z:this._parseTimeOrLabel(z),ce!==!1)},V.stop=function(){return this.paused(!0)},V.gotoAndPlay=function(z,ce){return this.play(z,ce)},V.gotoAndStop=function(z,ce){return this.pause(z,ce)},V.render=function(z,ce,ue){this._gc&&this._enabled(!0,!1);var he=this,K=he._time,Y=he._dirty?he.totalDuration():he._totalDuration,ie=he._startTime,ve=he._timeScale,re=he._paused,ae,me,ye,Te,ke,Fe,Ve,ot;if(K!==he._time&&(z+=he._time-K),he._hasPause&&!he._forcingPlayhead&&!ce){if(z>K)for(ae=he._first;ae&&ae._startTime<=z&&!Fe;)ae._duration||ae.data==="isPause"&&!ae.ratio&&!(ae._startTime===0&&he._rawPrevTime===0)&&(Fe=ae),ae=ae._next;else for(ae=he._last;ae&&ae._startTime>=z&&!Fe;)ae._duration||ae.data==="isPause"&&ae._rawPrevTime>0&&(Fe=ae),ae=ae._prev;Fe&&(he._time=he._totalTime=z=Fe._startTime,ot=he._startTime+(he._reversed?he._duration-z:z)/he._timeScale)}if(z>=Y-_&&z>=0)he._totalTime=he._time=Y,he._reversed||he._hasPausedChild()||(me=!0,Te="onComplete",ke=!!he._timeline.autoRemoveChildren,he._duration===0&&(z<=0&&z>=-_||he._rawPrevTime<0||he._rawPrevTime===_)&&he._rawPrevTime!==z&&he._first&&(ke=!0,he._rawPrevTime>_&&(Te="onReverseComplete"))),he._rawPrevTime=he._duration||!ce||z||he._rawPrevTime===z?z:_,z=Y+1e-4;else if(z<_)if(he._totalTime=he._time=0,z>-_&&(z=0),(K!==0||he._duration===0&&he._rawPrevTime!==_&&(he._rawPrevTime>0||z<0&&he._rawPrevTime>=0))&&(Te="onReverseComplete",me=he._reversed),z<0)he._active=!1,he._timeline.autoRemoveChildren&&he._reversed?(ke=me=!0,Te="onReverseComplete"):he._rawPrevTime>=0&&he._first&&(ke=!0),he._rawPrevTime=z;else{if(he._rawPrevTime=he._duration||!ce||z||he._rawPrevTime===z?z:_,z===0&&me)for(ae=he._first;ae&&ae._startTime===0;)ae._duration||(me=!1),ae=ae._next;z=0,he._initted||(ke=!0)}else he._totalTime=he._time=he._rawPrevTime=z;if(!((he._time===K||!he._first)&&!ue&&!ke&&!Fe)){if(he._initted||(he._initted=!0),he._active||!he._paused&&he._time!==K&&z>0&&(he._active=!0),K===0&&he.vars.onStart&&(he._time!==0||!he._duration)&&(ce||he._callback("onStart")),Ve=he._time,Ve>=K)for(ae=he._first;ae&&(ye=ae._next,!(Ve!==he._time||he._paused&&!re));)(ae._active||ae._startTime<=Ve&&!ae._paused&&!ae._gc)&&(Fe===ae&&(he.pause(),he._pauseTime=ot),ae._reversed?ae.render((ae._dirty?ae.totalDuration():ae._totalDuration)-(z-ae._startTime)*ae._timeScale,ce,ue):ae.render((z-ae._startTime)*ae._timeScale,ce,ue)),ae=ye;else for(ae=he._last;ae&&(ye=ae._prev,!(Ve!==he._time||he._paused&&!re));){if(ae._active||ae._startTime<=K&&!ae._paused&&!ae._gc){if(Fe===ae){for(Fe=ae._prev;Fe&&Fe.endTime()>he._time;)Fe.render(Fe._reversed?Fe.totalDuration()-(z-Fe._startTime)*Fe._timeScale:(z-Fe._startTime)*Fe._timeScale,ce,ue),Fe=Fe._prev;Fe=null,he.pause(),he._pauseTime=ot}ae._reversed?ae.render((ae._dirty?ae.totalDuration():ae._totalDuration)-(z-ae._startTime)*ae._timeScale,ce,ue):ae.render((z-ae._startTime)*ae._timeScale,ce,ue)}ae=ye}he._onUpdate&&(ce||(D.length&&U(),he._callback("onUpdate"))),Te&&(he._gc||(ie===he._startTime||ve!==he._timeScale)&&(he._time===0||Y>=he.totalDuration())&&(me&&(D.length&&U(),he._timeline.autoRemoveChildren&&he._enabled(!1,!1),he._active=!1),!ce&&he.vars[Te]&&he._callback(Te)))}},V._hasPausedChild=function(){for(var z=this._first;z;){if(z._paused||z instanceof m&&z._hasPausedChild())return!0;z=z._next}return!1},V.getChildren=function(z,ce,ue,he){he=he||-9999999999;for(var K=[],Y=this._first,ie=0;Y;)Y._startTime<he||(Y instanceof i?ce!==!1&&(K[ie++]=Y):(ue!==!1&&(K[ie++]=Y),z!==!1&&(K=K.concat(Y.getChildren(!0,ce,ue)),ie=K.length))),Y=Y._next;return K},V.getTweensOf=function(z,ce){var ue=this._gc,he=[],K=0,Y,ie;for(ue&&this._enabled(!0,!0),Y=i.getTweensOf(z),ie=Y.length;--ie>-1;)(Y[ie].timeline===this||ce&&this._contains(Y[ie]))&&(he[K++]=Y[ie]);return ue&&this._enabled(!1,!0),he},V.recent=function(){return this._recent},V._contains=function(z){for(var ce=z.timeline;ce;){if(ce===this)return!0;ce=ce.timeline}return!1},V.shiftChildren=function(z,ce,ue){ue=ue||0;for(var he=this._first,K=this._labels,Y;he;)he._startTime>=ue&&(he._startTime+=z),he=he._next;if(ce)for(Y in K)K[Y]>=ue&&(K[Y]+=z);return this._uncache(!0)},V._kill=function(z,ce){if(!z&&!ce)return this._enabled(!1,!1);for(var ue=ce?this.getTweensOf(ce):this.getChildren(!0,!0,!1),he=ue.length,K=!1;--he>-1;)ue[he]._kill(z,ce)&&(K=!0);return K},V.clear=function(z){var ce=this.getChildren(!1,!0,!0),ue=ce.length;for(this._time=this._totalTime=0;--ue>-1;)ce[ue]._enabled(!1,!1);return z!==!1&&(this._labels={}),this._uncache(!0)},V.invalidate=function(){for(var z=this._first;z;)z.invalidate(),z=z._next;return u.prototype.invalidate.call(this)},V._enabled=function(z,ce){if(z===this._gc)for(var ue=this._first;ue;)ue._enabled(z,!0),ue=ue._next;return r.prototype._enabled.call(this,z,ce)},V.totalTime=function(z,ce,ue){this._forcingPlayhead=!0;var he=u.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,he},V.duration=function(z){return arguments.length?(this.duration()!==0&&z!==0&&this.timeScale(this._duration/z),this):(this._dirty&&this.totalDuration(),this._duration)},V.totalDuration=function(z){if(!arguments.length){if(this._dirty){for(var ce=0,ue=this,he=ue._last,K=999999999999,Y,ie;he;)Y=he._prev,he._dirty&&he.totalDuration(),he._startTime>K&&ue._sortChildren&&!he._paused&&!ue._calculatingDuration?(ue._calculatingDuration=1,ue.add(he,he._startTime-he._delay),ue._calculatingDuration=0):K=he._startTime,he._startTime<0&&!he._paused&&(ce-=he._startTime,ue._timeline.smoothChildTiming&&(ue._startTime+=he._startTime/ue._timeScale,ue._time-=he._startTime,ue._totalTime-=he._startTime,ue._rawPrevTime-=he._startTime),ue.shiftChildren(-he._startTime,!1,-9999999999),K=0),ie=he._startTime+he._totalDuration/he._timeScale,ie>ce&&(ce=ie),he=Y;ue._duration=ue._totalDuration=ce,ue._dirty=!1}return this._totalDuration}return z&&this.totalDuration()?this.timeScale(this._totalDuration/z):this},V.paused=function(z){if(z===!1&&this._paused)for(var ce=this._first;ce;)ce._startTime===this._time&&ce.data==="isPause"&&(ce._rawPrevTime=0),ce=ce._next;return u.prototype.paused.apply(this,arguments)},V.usesFrames=function(){for(var z=this._timeline;z._timeline;)z=z._timeline;return z===u._rootFramesTimeline},V.rawTime=function(z){return z&&(this._paused||this._repeat&&this.time()>0&&this.totalProgress()<1)?this._totalTime%(this._duration+this._repeatDelay):this._paused?this._totalTime:(this._timeline.rawTime(z)-this._startTime)*this._timeScale},m},!0),_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(u,r,i){var m=function(k){u.call(this,k),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=!!this.vars.yoyo,this._dirty=!0},_=1e-8,A=r._internals,w=A.lazyTweens,T=A.lazyRender,R=_gsScope._gsDefine.globals,D=new i(null,null,1,0),U=m.prototype=new u;return U.constructor=m,U.kill()._gc=!1,m.version="2.1.3",U.invalidate=function(){return this._yoyo=!!this.vars.yoyo,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),u.prototype.invalidate.call(this)},U.addCallback=function(k,X,J,$){return this.add(r.delayedCall(0,k,J,$),X)},U.removeCallback=function(k,X){if(k)if(X==null)this._kill(null,k);else for(var J=this.getTweensOf(k,!1),$=J.length,oe=this._parseTimeOrLabel(X);--$>-1;)J[$]._startTime===oe&&J[$]._enabled(!1,!1);return this},U.removePause=function(k){return this.removeCallback(u._internals.pauseCallback,k)},U.tweenTo=function(k,X){X=X||{};var J={ease:D,useFrames:this.usesFrames(),immediateRender:!1,lazy:!1},$=X.repeat&&R.TweenMax||r,oe,ne,H;for(ne in X)J[ne]=X[ne];return J.time=this._parseTimeOrLabel(k),oe=Math.abs(Number(J.time)-this._time)/this._timeScale||.001,H=new $(this,oe,J),J.onStart=function(){H.target.paused(!0),H.vars.time!==H.target.time()&&oe===H.duration()&&!H.isFromTo&&H.duration(Math.abs(H.vars.time-H.target.time())/H.target._timeScale).render(H.time(),!0,!0),X.onStart&&X.onStart.apply(X.onStartScope||X.callbackScope||H,X.onStartParams||[])},H},U.tweenFromTo=function(k,X,J){J=J||{},k=this._parseTimeOrLabel(k),J.startAt={onComplete:this.seek,onCompleteParams:[k],callbackScope:this},J.immediateRender=J.immediateRender!==!1;var $=this.tweenTo(X,J);return $.isFromTo=1,$.duration(Math.abs($.vars.time-k)/this._timeScale||.001)},U.render=function(k,X,J){this._gc&&this._enabled(!0,!1);var $=this,oe=$._time,ne=$._dirty?$.totalDuration():$._totalDuration,H=$._duration,V=$._totalTime,z=$._startTime,ce=$._timeScale,ue=$._rawPrevTime,he=$._paused,K=$._cycle,Y,ie,ve,re,ae,me,ye,Te,ke;if(oe!==$._time&&(k+=$._time-oe),k>=ne-_&&k>=0)$._locked||($._totalTime=ne,$._cycle=$._repeat),$._reversed||$._hasPausedChild()||(ie=!0,re="onComplete",ae=!!$._timeline.autoRemoveChildren,$._duration===0&&(k<=0&&k>=-_||ue<0||ue===_)&&ue!==k&&$._first&&(ae=!0,ue>_&&(re="onReverseComplete"))),$._rawPrevTime=$._duration||!X||k||$._rawPrevTime===k?k:_,$._yoyo&&$._cycle&1?$._time=k=0:($._time=H,k=H+1e-4);else if(k<_)if($._locked||($._totalTime=$._cycle=0),$._time=0,k>-_&&(k=0),(oe!==0||H===0&&ue!==_&&(ue>0||k<0&&ue>=0)&&!$._locked)&&(re="onReverseComplete",ie=$._reversed),k<0)$._active=!1,$._timeline.autoRemoveChildren&&$._reversed?(ae=ie=!0,re="onReverseComplete"):ue>=0&&$._first&&(ae=!0),$._rawPrevTime=k;else{if($._rawPrevTime=H||!X||k||$._rawPrevTime===k?k:_,k===0&&ie)for(Y=$._first;Y&&Y._startTime===0;)Y._duration||(ie=!1),Y=Y._next;k=0,$._initted||(ae=!0)}else H===0&&ue<0&&(ae=!0),$._time=$._rawPrevTime=k,$._locked||($._totalTime=k,$._repeat!==0&&(me=H+$._repeatDelay,$._cycle=$._totalTime/me>>0,$._cycle&&$._cycle===$._totalTime/me&&V<=k&&$._cycle--,$._time=$._totalTime-$._cycle*me,$._yoyo&&$._cycle&1&&($._time=H-$._time),$._time>H?($._time=H,k=H+1e-4):$._time<0?$._time=k=0:k=$._time));if($._hasPause&&!$._forcingPlayhead&&!X){if(k=$._time,k>oe||$._repeat&&K!==$._cycle)for(Y=$._first;Y&&Y._startTime<=k&&!ye;)Y._duration||Y.data==="isPause"&&!Y.ratio&&!(Y._startTime===0&&$._rawPrevTime===0)&&(ye=Y),Y=Y._next;else for(Y=$._last;Y&&Y._startTime>=k&&!ye;)Y._duration||Y.data==="isPause"&&Y._rawPrevTime>0&&(ye=Y),Y=Y._prev;ye&&(ke=$._startTime+($._reversed?$._duration-ye._startTime:ye._startTime)/$._timeScale,ye._startTime<H&&($._time=$._rawPrevTime=k=ye._startTime,$._totalTime=k+$._cycle*($._totalDuration+$._repeatDelay)))}if($._cycle!==K&&!$._locked){var Fe=$._yoyo&&(K&1)!==0,Ve=Fe===($._yoyo&&($._cycle&1)!==0),ot=$._totalTime,Ye=$._cycle,Ze=$._rawPrevTime,tt=$._time;if($._totalTime=K*H,$._cycle<K?Fe=!Fe:$._totalTime+=H,$._time=oe,$._rawPrevTime=H===0?ue-1e-4:ue,$._cycle=K,$._locked=!0,oe=Fe?0:H,$.render(oe,X,H===0),X||$._gc||$.vars.onRepeat&&($._cycle=Ye,$._locked=!1,$._callback("onRepeat")),oe!==$._time||(Ve&&($._cycle=K,$._locked=!0,oe=Fe?H+1e-4:-1e-4,$.render(oe,!0,!1)),$._locked=!1,$._paused&&!he))return;$._time=tt,$._totalTime=ot,$._cycle=Ye,$._rawPrevTime=Ze}if(($._time===oe||!$._first)&&!J&&!ae&&!ye){V!==$._totalTime&&$._onUpdate&&(X||$._callback("onUpdate"));return}else $._initted||($._initted=!0);if($._active||!$._paused&&$._totalTime!==V&&k>0&&($._active=!0),V===0&&$.vars.onStart&&($._totalTime!==0||!$._totalDuration)&&(X||$._callback("onStart")),Te=$._time,Te>=oe)for(Y=$._first;Y&&(ve=Y._next,!(Te!==$._time||$._paused&&!he));)(Y._active||Y._startTime<=$._time&&!Y._paused&&!Y._gc)&&(ye===Y&&($.pause(),$._pauseTime=ke),Y._reversed?Y.render((Y._dirty?Y.totalDuration():Y._totalDuration)-(k-Y._startTime)*Y._timeScale,X,J):Y.render((k-Y._startTime)*Y._timeScale,X,J)),Y=ve;else for(Y=$._last;Y&&(ve=Y._prev,!(Te!==$._time||$._paused&&!he));){if(Y._active||Y._startTime<=oe&&!Y._paused&&!Y._gc){if(ye===Y){for(ye=Y._prev;ye&&ye.endTime()>$._time;)ye.render(ye._reversed?ye.totalDuration()-(k-ye._startTime)*ye._timeScale:(k-ye._startTime)*ye._timeScale,X,J),ye=ye._prev;ye=null,$.pause(),$._pauseTime=ke}Y._reversed?Y.render((Y._dirty?Y.totalDuration():Y._totalDuration)-(k-Y._startTime)*Y._timeScale,X,J):Y.render((k-Y._startTime)*Y._timeScale,X,J)}Y=ve}$._onUpdate&&(X||(w.length&&T(),$._callback("onUpdate"))),re&&($._locked||$._gc||(z===$._startTime||ce!==$._timeScale)&&($._time===0||ne>=$.totalDuration())&&(ie&&(w.length&&T(),$._timeline.autoRemoveChildren&&$._enabled(!1,!1),$._active=!1),!X&&$.vars[re]&&$._callback(re)))},U.getActive=function(k,X,J){var $=[],oe=this.getChildren(k||k==null,X||k==null,!!J),ne=0,H=oe.length,V,z;for(V=0;V<H;V++)z=oe[V],z.isActive()&&($[ne++]=z);return $},U.getLabelAfter=function(k){k||k!==0&&(k=this._time);var X=this.getLabelsArray(),J=X.length,$;for($=0;$<J;$++)if(X[$].time>k)return X[$].name;return null},U.getLabelBefore=function(k){k==null&&(k=this._time);for(var X=this.getLabelsArray(),J=X.length;--J>-1;)if(X[J].time<k)return X[J].name;return null},U.getLabelsArray=function(){var k=[],X=0,J;for(J in this._labels)k[X++]={time:this._labels[J],name:J};return k.sort(function($,oe){return $.time-oe.time}),k},U.invalidate=function(){return this._locked=!1,u.prototype.invalidate.call(this)},U.progress=function(k,X){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&this._cycle&1?1-k:k)+this._cycle*(this._duration+this._repeatDelay),X):this._time/this.duration()||0},U.totalProgress=function(k,X){return arguments.length?this.totalTime(this.totalDuration()*k,X):this._totalTime/this.totalDuration()||0},U.totalDuration=function(k){return arguments.length?this._repeat===-1||!k?this:this.timeScale(this.totalDuration()/k):(this._dirty&&(u.prototype.totalDuration.call(this),this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},U.time=function(k,X){if(!arguments.length)return this._time;this._dirty&&this.totalDuration();var J=this._duration,$=this._cycle,oe=$*(J+this._repeatDelay);return k>J&&(k=J),this.totalTime(this._yoyo&&$&1?J-k+oe:this._repeat?k+oe:k,X)},U.repeat=function(k){return arguments.length?(this._repeat=k,this._uncache(!0)):this._repeat},U.repeatDelay=function(k){return arguments.length?(this._repeatDelay=k,this._uncache(!0)):this._repeatDelay},U.yoyo=function(k){return arguments.length?(this._yoyo=k,this):this._yoyo},U.currentLabel=function(k){return arguments.length?this.seek(k,!0):this.getLabelBefore(this._time+_)},m},!0),function(){var u=180/Math.PI,r=[],i=[],m=[],_={},A=_gsScope._gsDefine.globals,w=function(H,V,z,ce){z===ce&&(z=ce-(ce-V)/1e6),H===V&&(V=H+(z-H)/1e6),this.a=H,this.b=V,this.c=z,this.d=ce,this.da=ce-H,this.ca=z-H,this.ba=V-H},T=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",R=function(H,V,z,ce){var ue={a:H},he={},K={},Y={c:ce},ie=(H+V)/2,ve=(V+z)/2,re=(z+ce)/2,ae=(ie+ve)/2,me=(ve+re)/2,ye=(me-ae)/8;return ue.b=ie+(H-ie)/4,he.b=ae+ye,ue.c=he.a=(ue.b+he.b)/2,he.c=K.a=(ae+me)/2,K.b=me-ye,Y.b=re+(ce-re)/4,K.c=Y.a=(K.b+Y.b)/2,[ue,he,K,Y]},D=function(H,V,z,ce,ue){var he=H.length-1,K=0,Y=H[0].a,ie,ve,re,ae,me,ye,Te,ke,Fe,Ve,ot,Ye,Ze;for(ie=0;ie<he;ie++)me=H[K],ve=me.a,re=me.d,ae=H[K+1].d,ue?(ot=r[ie],Ye=i[ie],Ze=(Ye+ot)*V*.25/(ce?.5:m[ie]||.5),ye=re-(re-ve)*(ce?V*.5:ot!==0?Ze/ot:0),Te=re+(ae-re)*(ce?V*.5:Ye!==0?Ze/Ye:0),ke=re-(ye+((Te-ye)*(ot*3/(ot+Ye)+.5)/4||0))):(ye=re-(re-ve)*V*.5,Te=re+(ae-re)*V*.5,ke=re-(ye+Te)/2),ye+=ke,Te+=ke,me.c=Fe=ye,ie!==0?me.b=Y:me.b=Y=me.a+(me.c-me.a)*.6,me.da=re-ve,me.ca=Fe-ve,me.ba=Y-ve,z?(Ve=R(ve,Y,Fe,re),H.splice(K,1,Ve[0],Ve[1],Ve[2],Ve[3]),K+=4):K++,Y=Te;me=H[K],me.b=Y,me.c=Y+(me.d-Y)*.4,me.da=me.d-me.a,me.ca=me.c-me.a,me.ba=Y-me.a,z&&(Ve=R(me.a,Y,me.c,me.d),H.splice(K,1,Ve[0],Ve[1],Ve[2],Ve[3]))},U=function(H,V,z,ce){var ue=[],he,K,Y,ie,ve,re;if(ce)for(H=[ce].concat(H),K=H.length;--K>-1;)typeof(re=H[K][V])=="string"&&re.charAt(1)==="="&&(H[K][V]=ce[V]+Number(re.charAt(0)+re.substr(2)));if(he=H.length-2,he<0)return ue[0]=new w(H[0][V],0,0,H[0][V]),ue;for(K=0;K<he;K++)Y=H[K][V],ie=H[K+1][V],ue[K]=new w(Y,0,0,ie),z&&(ve=H[K+2][V],r[K]=(r[K]||0)+(ie-Y)*(ie-Y),i[K]=(i[K]||0)+(ve-ie)*(ve-ie));return ue[K]=new w(H[K][V],0,0,H[K+1][V]),ue},k=function(H,V,z,ce,ue,he){var K={},Y=[],ie=he||H[0],ve,re,ae,me,ye,Te,ke,Fe;ue=typeof ue=="string"?","+ue+",":T,V==null&&(V=1);for(re in H[0])Y.push(re);if(H.length>1){for(Fe=H[H.length-1],ke=!0,ve=Y.length;--ve>-1;)if(re=Y[ve],Math.abs(ie[re]-Fe[re])>.05){ke=!1;break}ke&&(H=H.concat(),he&&H.unshift(he),H.push(H[1]),he=H[H.length-3])}for(r.length=i.length=m.length=0,ve=Y.length;--ve>-1;)re=Y[ve],_[re]=ue.indexOf(","+re+",")!==-1,K[re]=U(H,re,_[re],he);for(ve=r.length;--ve>-1;)r[ve]=Math.sqrt(r[ve]),i[ve]=Math.sqrt(i[ve]);if(!ce){for(ve=Y.length;--ve>-1;)if(_[re])for(ae=K[Y[ve]],Te=ae.length-1,me=0;me<Te;me++)ye=ae[me+1].da/i[me]+ae[me].da/r[me]||0,m[me]=(m[me]||0)+ye*ye;for(ve=m.length;--ve>-1;)m[ve]=Math.sqrt(m[ve])}for(ve=Y.length,me=z?4:1;--ve>-1;)re=Y[ve],ae=K[re],D(ae,V,z,ce,_[re]),ke&&(ae.splice(0,me),ae.splice(ae.length-me,me));return K},X=function(H,V,z){V=V||"soft";var ce={},ue=V==="cubic"?3:2,he=V==="soft",K=[],Y,ie,ve,re,ae,me,ye,Te,ke,Fe,Ve;if(he&&z&&(H=[z].concat(H)),H==null||H.length<ue+1)throw"invalid Bezier data";for(ke in H[0])K.push(ke);for(me=K.length;--me>-1;){for(ke=K[me],ce[ke]=ae=[],Fe=0,Te=H.length,ye=0;ye<Te;ye++)Y=z==null?H[ye][ke]:typeof(Ve=H[ye][ke])=="string"&&Ve.charAt(1)==="="?z[ke]+Number(Ve.charAt(0)+Ve.substr(2)):Number(Ve),he&&ye>1&&ye<Te-1&&(ae[Fe++]=(Y+ae[Fe-2])/2),ae[Fe++]=Y;for(Te=Fe-ue+1,Fe=0,ye=0;ye<Te;ye+=ue)Y=ae[ye],ie=ae[ye+1],ve=ae[ye+2],re=ue===2?0:ae[ye+3],ae[Fe++]=Ve=ue===3?new w(Y,ie,ve,re):new w(Y,(2*ie+Y)/3,(2*ie+ve)/3,ve);ae.length=Fe}return ce},J=function(H,V,z){for(var ce=1/z,ue=H.length,he,K,Y,ie,ve,re,ae,me,ye,Te,ke;--ue>-1;)for(Te=H[ue],Y=Te.a,ie=Te.d-Y,ve=Te.c-Y,re=Te.b-Y,he=K=0,me=1;me<=z;me++)ae=ce*me,ye=1-ae,he=K-(K=(ae*ae*ie+3*ye*(ae*ve+ye*re))*ae),ke=ue*z+me-1,V[ke]=(V[ke]||0)+he*he},$=function(H,V){V=V>>0||6;var z=[],ce=[],ue=0,he=0,K=V-1,Y=[],ie=[],ve,re,ae,me;for(ve in H)J(H[ve],z,V);for(ae=z.length,re=0;re<ae;re++)ue+=Math.sqrt(z[re]),me=re%V,ie[me]=ue,me===K&&(he+=ue,me=re/V>>0,Y[me]=ie,ce[me]=he,ue=0,ie=[]);return{length:he,lengths:ce,segments:Y}},oe=_gsScope._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.9",API:2,global:!0,init:function(H,V,z){this._target=H,V instanceof Array&&(V={values:V}),this._func={},this._mod={},this._props=[],this._timeRes=V.timeResolution==null?6:parseInt(V.timeResolution,10);var ce=V.values||[],ue={},he=ce[0],K=V.autoRotate||z.vars.orientToBezier,Y,ie,ve,re,ae;this._autoRotate=K?K instanceof Array?K:[["x","y","rotation",K===!0?0:Number(K)||0]]:null;for(Y in he)this._props.push(Y);for(ve=this._props.length;--ve>-1;)Y=this._props[ve],this._overwriteProps.push(Y),ie=this._func[Y]=typeof H[Y]=="function",ue[Y]=ie?H[Y.indexOf("set")||typeof H["get"+Y.substr(3)]!="function"?Y:"get"+Y.substr(3)]():parseFloat(H[Y]),ae||ue[Y]!==ce[0][Y]&&(ae=ue);if(this._beziers=V.type!=="cubic"&&V.type!=="quadratic"&&V.type!=="soft"?k(ce,isNaN(V.curviness)?1:V.curviness,!1,V.type==="thruBasic",V.correlate,ae):X(ce,V.type,ue),this._segCount=this._beziers[Y].length,this._timeRes){var me=$(this._beziers,this._timeRes);this._length=me.length,this._lengths=me.lengths,this._segments=me.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(K=this._autoRotate)for(this._initialRotations=[],K[0]instanceof Array||(this._autoRotate=K=[K]),ve=K.length;--ve>-1;){for(re=0;re<3;re++)Y=K[ve][re],this._func[Y]=typeof H[Y]=="function"?H[Y.indexOf("set")||typeof H["get"+Y.substr(3)]!="function"?Y:"get"+Y.substr(3)]:!1;Y=K[ve][2],this._initialRotations[ve]=(this._func[Y]?this._func[Y].call(this._target):this._target[Y])||0,this._overwriteProps.push(Y)}return this._startRatio=z.vars.runBackwards?1:0,!0},set:function(H){var V=this._segCount,z=this._func,ce=this._target,ue=H!==this._startRatio,he,K,Y,ie,ve,re,ae,me,ye,Te,ke;if(!this._timeRes)he=H<0?0:H>=1?V-1:V*H>>0,re=(H-he*(1/V))*V;else{if(ye=this._lengths,Te=this._curSeg,ke=H*this._length,Y=this._li,ke>this._l2&&Y<V-1){for(me=V-1;Y<me&&(this._l2=ye[++Y])<=ke;);this._l1=ye[Y-1],this._li=Y,this._curSeg=Te=this._segments[Y],this._s2=Te[this._s1=this._si=0]}else if(ke<this._l1&&Y>0){for(;Y>0&&(this._l1=ye[--Y])>=ke;);Y===0&&ke<this._l1?this._l1=0:Y++,this._l2=ye[Y],this._li=Y,this._curSeg=Te=this._segments[Y],this._s1=Te[(this._si=Te.length-1)-1]||0,this._s2=Te[this._si]}if(he=Y,ke-=this._l1,Y=this._si,ke>this._s2&&Y<Te.length-1){for(me=Te.length-1;Y<me&&(this._s2=Te[++Y])<=ke;);this._s1=Te[Y-1],this._si=Y}else if(ke<this._s1&&Y>0){for(;Y>0&&(this._s1=Te[--Y])>=ke;);Y===0&&ke<this._s1?this._s1=0:Y++,this._s2=Te[Y],this._si=Y}re=H===1?1:(Y+(ke-this._s1)/(this._s2-this._s1))*this._prec||0}for(K=1-re,Y=this._props.length;--Y>-1;)ie=this._props[Y],ve=this._beziers[ie][he],ae=(re*re*ve.da+3*K*(re*ve.ca+K*ve.ba))*re+ve.a,this._mod[ie]&&(ae=this._mod[ie](ae,ce)),z[ie]?ce[ie](ae):ce[ie]=ae;if(this._autoRotate){var Fe=this._autoRotate,Ve,ot,Ye,Ze,tt,Pt,Et;for(Y=Fe.length;--Y>-1;)ie=Fe[Y][2],Pt=Fe[Y][3]||0,Et=Fe[Y][4]===!0?1:u,ve=this._beziers[Fe[Y][0]],Ve=this._beziers[Fe[Y][1]],ve&&Ve&&(ve=ve[he],Ve=Ve[he],ot=ve.a+(ve.b-ve.a)*re,Ze=ve.b+(ve.c-ve.b)*re,ot+=(Ze-ot)*re,Ze+=(ve.c+(ve.d-ve.c)*re-Ze)*re,Ye=Ve.a+(Ve.b-Ve.a)*re,tt=Ve.b+(Ve.c-Ve.b)*re,Ye+=(tt-Ye)*re,tt+=(Ve.c+(Ve.d-Ve.c)*re-tt)*re,ae=ue?Math.atan2(tt-Ye,Ze-ot)*Et+Pt:this._initialRotations[Y],this._mod[ie]&&(ae=this._mod[ie](ae,ce)),z[ie]?ce[ie](ae):ce[ie]=ae)}}}),ne=oe.prototype;oe.bezierThrough=k,oe.cubicToQuadratic=R,oe._autoCSS=!0,oe.quadraticToCubic=function(H,V,z){return new w(H,(2*V+H)/3,(2*V+z)/3,z)},oe._cssRegister=function(){var H=A.CSSPlugin;if(H){var V=H._internals,z=V._parseToProxy,ce=V._setPluginRatio,ue=V.CSSPropTween;V._registerComplexSpecialProp("bezier",{parser:function(he,K,Y,ie,ve,re){K instanceof Array&&(K={values:K}),re=new oe;var ae=K.values,me=ae.length-1,ye=[],Te={},ke,Fe,Ve;if(me<0)return ve;for(ke=0;ke<=me;ke++)Ve=z(he,ae[ke],ie,ve,re,me!==ke),ye[ke]=Ve.end;for(Fe in K)Te[Fe]=K[Fe];return Te.values=ye,ve=new ue(he,"bezier",0,0,Ve.pt,2),ve.data=Ve,ve.plugin=re,ve.setRatio=ce,Te.autoRotate===0&&(Te.autoRotate=!0),Te.autoRotate&&!(Te.autoRotate instanceof Array)&&(ke=Te.autoRotate===!0?0:Number(Te.autoRotate),Te.autoRotate=Ve.end.left!=null?[["left","top","rotation",ke,!1]]:Ve.end.x!=null?[["x","y","rotation",ke,!1]]:!1),Te.autoRotate&&(ie._transform||ie._enableTransforms(!1),Ve.autoRotate=ie._target._gsTransform,Ve.proxy.rotation=Ve.autoRotate.rotation||0,ie._overwriteProps.push("rotation")),re._onInitTween(Ve.proxy,Te,ie._tween),ve}})}},ne._mod=function(H){for(var V=this._overwriteProps,z=V.length,ce;--z>-1;)ce=H[V[z]],ce&&typeof ce=="function"&&(this._mod[V[z]]=ce)},ne._kill=function(H){var V=this._props,z,ce;for(z in this._beziers)if(z in H)for(delete this._beziers[z],delete this._func[z],ce=V.length;--ce>-1;)V[ce]===z&&V.splice(ce,1);if(V=this._autoRotate,V)for(ce=V.length;--ce>-1;)H[V[ce][2]]&&V.splice(ce,1);return this._super._kill.call(this,H)}}(),_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(u,r){var i=function(){u.call(this,"css"),this._overwriteProps.length=0,this.setRatio=i.prototype.setRatio},m=_gsScope._gsDefine.globals,_,A,w,T,R={},D=i.prototype=new u("css");D.constructor=i,i.version="2.1.3",i.API=2,i.defaultTransformPerspective=0,i.defaultSkewType="compensated",i.defaultSmoothOrigin=!0,D="px",i.suffixMap={top:D,right:D,bottom:D,left:D,width:D,height:D,fontSize:D,padding:D,margin:D,perspective:D,lineHeight:""};var U=/(?:\-|\.|\b)(\d|\.|e\-)+/g,k=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,X=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,J=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b),?/gi,$=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,oe=/(?:\d|\-|\+|=|#|\.)*/g,ne=/opacity *= *([^)]*)/i,H=/opacity:([^;]*)/i,V=/alpha\(opacity *=.+?\)/i,z=/^(rgb|hsl)/,ce=/([A-Z])/g,ue=/-([a-z])/gi,he=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,K=function(Me,Ee){return Ee.toUpperCase()},Y=/(?:Left|Right|Width)/i,ie=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,ve=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,re=/,(?=[^\)]*(?:\(|$))/gi,ae=/[\s,\(]/i,me=Math.PI/180,ye=180/Math.PI,Te={},ke={style:{}},Fe=_gsScope.document||{createElement:function(){return ke}},Ve=function(Me,Ee){var We=Fe.createElementNS?Fe.createElementNS(Ee||"http://www.w3.org/1999/xhtml",Me):Fe.createElement(Me);return We.style?We:Fe.createElement(Me)},ot=Ve("div"),Ye=Ve("img"),Ze=i._internals={_specialProps:R},tt=(_gsScope.navigator||{}).userAgent||"",Pt,Et,Ne,et,wt,Zt,nn=function(){var Me=tt.indexOf("Android"),Ee=Ve("a");return Ne=tt.indexOf("Safari")!==-1&&tt.indexOf("Chrome")===-1&&(Me===-1||parseFloat(tt.substr(Me+8,2))>3),wt=Ne&&parseFloat(tt.substr(tt.indexOf("Version/")+8,2))<6,et=tt.indexOf("Firefox")!==-1,(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(tt)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(tt))&&(Zt=parseFloat(RegExp.$1)),Ee?(Ee.style.cssText="top:1px;opacity:.55;",/^0.55/.test(Ee.style.opacity)):!1}(),Vn=function(Me){return ne.test(typeof Me=="string"?Me:(Me.currentStyle?Me.currentStyle.filter:Me.style.filter)||"")?parseFloat(RegExp.$1)/100:1},Jn=function(Me){_gsScope.console&&console.log(Me)},Ue,St,Lt="",jt="",Gt=function(Me,Ee){Ee=Ee||ot;var We=Ee.style,it,je;if(We[Me]!==void 0)return Me;for(Me=Me.charAt(0).toUpperCase()+Me.substr(1),it=["O","Moz","ms","Ms","Webkit"],je=5;--je>-1&&We[it[je]+Me]===void 0;);return je>=0?(jt=je===3?"ms":it[je],Lt="-"+jt.toLowerCase()+"-",jt+Me):null},fn=typeof window<"u"?window:Fe.defaultView||{getComputedStyle:function(){}},hn=function(Me){return fn.getComputedStyle(Me)},qt=i.getStyle=function(Me,Ee,We,it,je){var _t;return!nn&&Ee==="opacity"?Vn(Me):(!it&&Me.style[Ee]?_t=Me.style[Ee]:(We=We||hn(Me))?_t=We[Ee]||We.getPropertyValue(Ee)||We.getPropertyValue(Ee.replace(ce,"-$1").toLowerCase()):Me.currentStyle&&(_t=Me.currentStyle[Ee]),je!=null&&(!_t||_t==="none"||_t==="auto"||_t==="auto auto")?je:_t)},An=Ze.convertToPixels=function(Me,Ee,We,it,je){if(it==="px"||!it&&Ee!=="lineHeight")return We;if(it==="auto"||!We)return 0;var _t=Y.test(Ee),qe=Me,lt=ot.style,Nt=We<0,cn=We===1,Xt,In,Ut;if(Nt&&(We=-We),cn&&(We*=100),Ee==="lineHeight"&&!it)In=hn(Me).lineHeight,Me.style.lineHeight=We,Xt=parseFloat(hn(Me).lineHeight),Me.style.lineHeight=In;else if(it==="%"&&Ee.indexOf("border")!==-1)Xt=We/100*(_t?Me.clientWidth:Me.clientHeight);else{if(lt.cssText="border:0 solid red;position:"+qt(Me,"position")+";line-height:0;",it==="%"||!qe.appendChild||it.charAt(0)==="v"||it==="rem"){if(qe=Me.parentNode||Fe.body,qt(qe,"display").indexOf("flex")!==-1&&(lt.position="absolute"),In=qe._gsCache,Ut=r.ticker.frame,In&&_t&&In.time===Ut)return In.width*We/100;lt[_t?"width":"height"]=We+it}else lt[_t?"borderLeftWidth":"borderTopWidth"]=We+it;qe.appendChild(ot),Xt=parseFloat(ot[_t?"offsetWidth":"offsetHeight"]),qe.removeChild(ot),_t&&it==="%"&&i.cacheWidths!==!1&&(In=qe._gsCache=qe._gsCache||{},In.time=Ut,In.width=Xt/We*100),Xt===0&&!je&&(Xt=An(Me,Ee,We,it,!0))}return cn&&(Xt/=100),Nt?-Xt:Xt},_n=Ze.calculateOffset=function(Me,Ee,We){if(qt(Me,"position",We)!=="absolute")return 0;var it=Ee==="left"?"Left":"Top",je=qt(Me,"margin"+it,We);return Me["offset"+it]-(An(Me,Ee,parseFloat(je),je.replace(oe,""))||0)},Bn=function(Me,Ee){var We={},it,je,_t;if(Ee=Ee||hn(Me))if(it=Ee.length)for(;--it>-1;)_t=Ee[it],(_t.indexOf("-transform")===-1||es===_t)&&(We[_t.replace(ue,K)]=Ee.getPropertyValue(_t));else for(it in Ee)(it.indexOf("Transform")===-1||wr===it)&&(We[it]=Ee[it]);else if(Ee=Me.currentStyle||Me.style)for(it in Ee)typeof it=="string"&&We[it]===void 0&&(We[it.replace(ue,K)]=Ee[it]);return nn||(We.opacity=Vn(Me)),je=bn(Me,Ee,!1),We.rotation=je.rotation,We.skewX=je.skewX,We.scaleX=je.scaleX,We.scaleY=je.scaleY,We.x=je.x,We.y=je.y,Jr&&(We.z=je.z,We.rotationX=je.rotationX,We.rotationY=je.rotationY,We.scaleZ=je.scaleZ),We.filters&&delete We.filters,We},de=function(Me,Ee,We,it,je){var _t={},qe=Me.style,lt,Nt,cn;for(Nt in We)Nt!=="cssText"&&Nt!=="length"&&isNaN(Nt)&&(Ee[Nt]!==(lt=We[Nt])||je&&je[Nt])&&Nt.indexOf("Origin")===-1&&(typeof lt=="number"||typeof lt=="string")&&(_t[Nt]=lt==="auto"&&(Nt==="left"||Nt==="top")?_n(Me,Nt):(lt===""||lt==="auto"||lt==="none")&&typeof Ee[Nt]=="string"&&Ee[Nt].replace($,"")!==""?0:lt,qe[Nt]!==void 0&&(cn=new Gi(qe,Nt,qe[Nt],cn)));if(it)for(Nt in it)Nt!=="className"&&(_t[Nt]=it[Nt]);return{difs:_t,firstMPT:cn}},Ae={width:["Left","Right"],height:["Top","Bottom"]},Le=["marginLeft","marginRight","marginTop","marginBottom"],Oe=function(Me,Ee,We){if((Me.nodeName+"").toLowerCase()==="svg")return(We||hn(Me))[Ee]||0;if(Me.getCTM&&ul(Me))return Me.getBBox()[Ee]||0;var it=parseFloat(Ee==="width"?Me.offsetWidth:Me.offsetHeight),je=Ae[Ee],_t=je.length;for(We=We||hn(Me);--_t>-1;)it-=parseFloat(qt(Me,"padding"+je[_t],We,!0))||0,it-=parseFloat(qt(Me,"border"+je[_t]+"Width",We,!0))||0;return it},$e=function(Me,Ee){if(Me==="contain"||Me==="auto"||Me==="auto auto")return Me+" ";(Me==null||Me==="")&&(Me="0 0");var We=Me.split(" "),it=Me.indexOf("left")!==-1?"0%":Me.indexOf("right")!==-1?"100%":We[0],je=Me.indexOf("top")!==-1?"0%":Me.indexOf("bottom")!==-1?"100%":We[1],_t;if(We.length>3&&!Ee){for(We=Me.split(", ").join(",").split(","),Me=[],_t=0;_t<We.length;_t++)Me.push($e(We[_t]));return Me.join(",")}return je==null?je=it==="center"?"50%":"0":je==="center"&&(je="50%"),(it==="center"||isNaN(parseFloat(it))&&(it+"").indexOf("=")===-1)&&(it="50%"),Me=it+" "+je+(We.length>2?" "+We[2]:""),Ee&&(Ee.oxp=it.indexOf("%")!==-1,Ee.oyp=je.indexOf("%")!==-1,Ee.oxr=it.charAt(1)==="=",Ee.oyr=je.charAt(1)==="=",Ee.ox=parseFloat(it.replace($,"")),Ee.oy=parseFloat(je.replace($,"")),Ee.v=Me),Ee||Me},pt=function(Me,Ee){return typeof Me=="function"&&(Me=Me(St,Ue)),typeof Me=="string"&&Me.charAt(1)==="="?parseInt(Me.charAt(0)+"1",10)*parseFloat(Me.substr(2)):parseFloat(Me)-parseFloat(Ee)||0},Mt=function(Me,Ee){typeof Me=="function"&&(Me=Me(St,Ue));var We=typeof Me=="string"&&Me.charAt(1)==="=";return typeof Me=="string"&&Me.charAt(Me.length-2)==="v"&&(Me=(We?Me.substr(0,2):0)+window["inner"+(Me.substr(-2)==="vh"?"Height":"Width")]*(parseFloat(We?Me.substr(2):Me)/100)),Me==null?Ee:We?parseInt(Me.charAt(0)+"1",10)*parseFloat(Me.substr(2))+Ee:parseFloat(Me)||0},Bt=function(Me,Ee,We,it){var je=1e-6,_t,qe,lt,Nt,cn;return typeof Me=="function"&&(Me=Me(St,Ue)),Me==null?Nt=Ee:typeof Me=="number"?Nt=Me:(_t=360,qe=Me.split("_"),cn=Me.charAt(1)==="=",lt=(cn?parseInt(Me.charAt(0)+"1",10)*parseFloat(qe[0].substr(2)):parseFloat(qe[0]))*(Me.indexOf("rad")===-1?1:ye)-(cn?0:Ee),qe.length&&(it&&(it[We]=Ee+lt),Me.indexOf("short")!==-1&&(lt=lt%_t,lt!==lt%(_t/2)&&(lt=lt<0?lt+_t:lt-_t)),Me.indexOf("_cw")!==-1&&lt<0?lt=(lt+_t*9999999999)%_t-(lt/_t|0)*_t:Me.indexOf("ccw")!==-1&&lt>0&&(lt=(lt-_t*9999999999)%_t-(lt/_t|0)*_t)),Nt=Ee+lt),Nt<je&&Nt>-je&&(Nt=0),Nt},xt={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},ht=function(Me,Ee,We){return Me=Me<0?Me+1:Me>1?Me-1:Me,(Me*6<1?Ee+(We-Ee)*Me*6:Me<.5?We:Me*3<2?Ee+(We-Ee)*(2/3-Me)*6:Ee)*255+.5|0},zt=i.parseColor=function(Me,Ee){var We,it,je,_t,qe,lt,Nt,cn,Xt,In,Ut;if(!Me)We=xt.black;else if(typeof Me=="number")We=[Me>>16,Me>>8&255,Me&255];else{if(Me.charAt(Me.length-1)===","&&(Me=Me.substr(0,Me.length-1)),xt[Me])We=xt[Me];else if(Me.charAt(0)==="#")Me.length===4&&(it=Me.charAt(1),je=Me.charAt(2),_t=Me.charAt(3),Me="#"+it+it+je+je+_t+_t),Me=parseInt(Me.substr(1),16),We=[Me>>16,Me>>8&255,Me&255];else if(Me.substr(0,3)==="hsl"){if(We=Ut=Me.match(U),!Ee)qe=Number(We[0])%360/360,lt=Number(We[1])/100,Nt=Number(We[2])/100,je=Nt<=.5?Nt*(lt+1):Nt+lt-Nt*lt,it=Nt*2-je,We.length>3&&(We[3]=Number(We[3])),We[0]=ht(qe+1/3,it,je),We[1]=ht(qe,it,je),We[2]=ht(qe-1/3,it,je);else if(Me.indexOf("=")!==-1)return Me.match(k)}else We=Me.match(U)||xt.transparent;We[0]=Number(We[0]),We[1]=Number(We[1]),We[2]=Number(We[2]),We.length>3&&(We[3]=Number(We[3]))}return Ee&&!Ut&&(it=We[0]/255,je=We[1]/255,_t=We[2]/255,cn=Math.max(it,je,_t),Xt=Math.min(it,je,_t),Nt=(cn+Xt)/2,cn===Xt?qe=lt=0:(In=cn-Xt,lt=Nt>.5?In/(2-cn-Xt):In/(cn+Xt),qe=cn===it?(je-_t)/In+(je<_t?6:0):cn===je?(_t-it)/In+2:(it-je)/In+4,qe*=60),We[0]=qe+.5|0,We[1]=lt*100+.5|0,We[2]=Nt*100+.5|0),We},dn=function(Me,Ee){var We=Me.match(en)||[],it=0,je="",_t,qe,lt;if(!We.length)return Me;for(_t=0;_t<We.length;_t++)qe=We[_t],lt=Me.substr(it,Me.indexOf(qe,it)-it),it+=lt.length+qe.length,qe=zt(qe,Ee),qe.length===3&&qe.push(1),je+=lt+(Ee?"hsla("+qe[0]+","+qe[1]+"%,"+qe[2]+"%,"+qe[3]:"rgba("+qe.join(","))+")";return je+Me.substr(it)},en="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(D in xt)en+="|"+D+"\\b";en=new RegExp(en+")","gi"),i.colorStringFilter=function(Me){var Ee=Me[0]+" "+Me[1],We;en.test(Ee)&&(We=Ee.indexOf("hsl(")!==-1||Ee.indexOf("hsla(")!==-1,Me[0]=dn(Me[0],We),Me[1]=dn(Me[1],We)),en.lastIndex=0},r.defaultStringFilter||(r.defaultStringFilter=i.colorStringFilter);var xn=function(Me,Ee,We,it){if(Me==null)return function(Ut){return Ut};var je=Ee?(Me.match(en)||[""])[0]:"",_t=Me.split(je).join("").match(X)||[],qe=Me.substr(0,Me.indexOf(_t[0])),lt=Me.charAt(Me.length-1)===")"?")":"",Nt=Me.indexOf(" ")!==-1?" ":",",cn=_t.length,Xt=cn>0?_t[0].replace(U,""):"",In;return cn?Ee?(In=function(Ut){var Zn,On,Yt,si;if(typeof Ut=="number")Ut+=Xt;else if(it&&re.test(Ut)){for(si=Ut.replace(re,"|").split("|"),Yt=0;Yt<si.length;Yt++)si[Yt]=In(si[Yt]);return si.join(",")}if(Zn=(Ut.match(en)||[je])[0],On=Ut.split(Zn).join("").match(X)||[],Yt=On.length,cn>Yt--)for(;++Yt<cn;)On[Yt]=We?On[(Yt-1)/2|0]:_t[Yt];return qe+On.join(Nt)+Nt+Zn+lt+(Ut.indexOf("inset")!==-1?" inset":"")},In):(In=function(Ut){var Zn,On,Yt;if(typeof Ut=="number")Ut+=Xt;else if(it&&re.test(Ut)){for(On=Ut.replace(re,"|").split("|"),Yt=0;Yt<On.length;Yt++)On[Yt]=In(On[Yt]);return On.join(",")}if(Zn=Ut.match(Nt===","?X:J)||[],Yt=Zn.length,cn>Yt--)for(;++Yt<cn;)Zn[Yt]=We?Zn[(Yt-1)/2|0]:_t[Yt];return(qe&&Ut!=="none"&&Ut.substr(0,Ut.indexOf(Zn[0]))||qe)+Zn.join(Nt)+lt},In):function(Ut){return Ut}},wi=function(Me){return Me=Me.split(","),function(Ee,We,it,je,_t,qe,lt){var Nt=(We+"").split(" "),cn;for(lt={},cn=0;cn<4;cn++)lt[Me[cn]]=Nt[cn]=Nt[cn]||Nt[(cn-1)/2>>0];return je.parse(Ee,lt,_t,qe)}};Ze._setPluginRatio=function(Me){this.plugin.setRatio(Me);for(var Ee=this.data,We=Ee.proxy,it=Ee.firstMPT,je=1e-6,_t,qe,lt,Nt,cn;it;)_t=We[it.v],it.r?_t=it.r(_t):_t<je&&_t>-je&&(_t=0),it.t[it.p]=_t,it=it._next;if(Ee.autoRotate&&(Ee.autoRotate.rotation=Ee.mod?Ee.mod.call(this._tween,We.rotation,this.t,this._tween):We.rotation),Me===1||Me===0)for(it=Ee.firstMPT,cn=Me===1?"e":"b";it;){if(qe=it.t,!qe.type)qe[cn]=qe.s+qe.xs0;else if(qe.type===1){for(Nt=qe.xs0+qe.s+qe.xs1,lt=1;lt<qe.l;lt++)Nt+=qe["xn"+lt]+qe["xs"+(lt+1)];qe[cn]=Nt}it=it._next}};var Gi=function(Me,Ee,We,it,je){this.t=Me,this.p=Ee,this.v=We,this.r=je,it&&(it._prev=this,this._next=it)};Ze._parseToProxy=function(Me,Ee,We,it,je,_t){var qe=it,lt={},Nt={},cn=We._transform,Xt=Te,In,Ut,Zn,On,Yt;for(We._transform=null,Te=Ee,it=Yt=We.parse(Me,Ee,it,je),Te=Xt,_t&&(We._transform=cn,qe&&(qe._prev=null,qe._prev&&(qe._prev._next=null)));it&&it!==qe;){if(it.type<=1&&(Ut=it.p,Nt[Ut]=it.s+it.c,lt[Ut]=it.s,_t||(On=new Gi(it,"s",Ut,On,it.r),it.c=0),it.type===1))for(In=it.l;--In>0;)Zn="xn"+In,Ut=it.p+"_"+Zn,Nt[Ut]=it.data[Zn],lt[Ut]=it[Zn],_t||(On=new Gi(it,Zn,Ut,On,it.rxp[Zn]));it=it._next}return{proxy:lt,end:Nt,firstMPT:On,pt:Yt}};var Pe=Ze.CSSPropTween=function(Me,Ee,We,it,je,_t,qe,lt,Nt,cn,Xt){this.t=Me,this.p=Ee,this.s=We,this.c=it,this.n=qe||Ee,Me instanceof Pe||T.push(this.n),this.r=lt&&(typeof lt=="function"?lt:Math.round),this.type=_t||0,Nt&&(this.pr=Nt,_=!0),this.b=cn===void 0?We:cn,this.e=Xt===void 0?We+it:Xt,je&&(this._next=je,je._prev=this)},oi=function(Me,Ee,We,it,je,_t){var qe=new Pe(Me,Ee,We,it-We,je,-1,_t);return qe.b=We,qe.e=qe.xs0=it,qe},pn=i.parseComplex=function(Me,Ee,We,it,je,_t,qe,lt,Nt,cn){We=We||_t||"",typeof it=="function"&&(it=it(St,Ue)),qe=new Pe(Me,Ee,0,0,qe,cn?2:1,null,!1,lt,We,it),it+="",je&&en.test(it+We)&&(it=[We,it],i.colorStringFilter(it),We=it[0],it=it[1]);var Xt=We.split(", ").join(",").split(" "),In=it.split(", ").join(",").split(" "),Ut=Xt.length,Zn=Pt!==!1,On,Yt,si,Tn,_i,Ii,Yn,Oi,Ki,Zi,kr,sr,ur;for((it.indexOf(",")!==-1||We.indexOf(",")!==-1)&&((it+We).indexOf("rgb")!==-1||(it+We).indexOf("hsl")!==-1?(Xt=Xt.join(" ").replace(re,", ").split(" "),In=In.join(" ").replace(re,", ").split(" ")):(Xt=Xt.join(" ").split(",").join(", ").split(" "),In=In.join(" ").split(",").join(", ").split(" ")),Ut=Xt.length),Ut!==In.length&&(Xt=(_t||"").split(" "),Ut=Xt.length),qe.plugin=Nt,qe.setRatio=cn,en.lastIndex=0,On=0;On<Ut;On++)if(Tn=Xt[On],_i=In[On]+"",Oi=parseFloat(Tn),Oi||Oi===0)qe.appendXtra("",Oi,pt(_i,Oi),_i.replace(k,""),Zn&&_i.indexOf("px")!==-1?Math.round:!1,!0);else if(je&&en.test(Tn))sr=_i.indexOf(")")+1,sr=")"+(sr?_i.substr(sr):""),ur=_i.indexOf("hsl")!==-1&&nn,Zi=_i,Tn=zt(Tn,ur),_i=zt(_i,ur),Ki=Tn.length+_i.length>6,Ki&&!nn&&_i[3]===0?(qe["xs"+qe.l]+=qe.l?" transparent":"transparent",qe.e=qe.e.split(In[On]).join("transparent")):(nn||(Ki=!1),ur?qe.appendXtra(Zi.substr(0,Zi.indexOf("hsl"))+(Ki?"hsla(":"hsl("),Tn[0],pt(_i[0],Tn[0]),",",!1,!0).appendXtra("",Tn[1],pt(_i[1],Tn[1]),"%,",!1).appendXtra("",Tn[2],pt(_i[2],Tn[2]),Ki?"%,":"%"+sr,!1):qe.appendXtra(Zi.substr(0,Zi.indexOf("rgb"))+(Ki?"rgba(":"rgb("),Tn[0],_i[0]-Tn[0],",",Math.round,!0).appendXtra("",Tn[1],_i[1]-Tn[1],",",Math.round).appendXtra("",Tn[2],_i[2]-Tn[2],Ki?",":sr,Math.round),Ki&&(Tn=Tn.length<4?1:Tn[3],qe.appendXtra("",Tn,(_i.length<4?1:_i[3])-Tn,sr,!1))),en.lastIndex=0;else if(Ii=Tn.match(U),!Ii)qe["xs"+qe.l]+=qe.l||qe["xs"+qe.l]?" "+_i:_i;else{if(Yn=_i.match(k),!Yn||Yn.length!==Ii.length)return qe;for(si=0,Yt=0;Yt<Ii.length;Yt++)kr=Ii[Yt],Zi=Tn.indexOf(kr,si),qe.appendXtra(Tn.substr(si,Zi-si),Number(kr),pt(Yn[Yt],kr),"",Zn&&Tn.substr(Zi+kr.length,2)==="px"?Math.round:!1,Yt===0),si=Zi+kr.length;qe["xs"+qe.l]+=Tn.substr(si)}if(it.indexOf("=")!==-1&&qe.data){for(sr=qe.xs0+qe.data.s,On=1;On<qe.l;On++)sr+=qe["xs"+On]+qe.data["xn"+On];qe.e=sr+qe["xs"+On]}return qe.l||(qe.type=-1,qe.xs0=qe.e),qe.xfirst||qe},Dn=9;for(D=Pe.prototype,D.l=D.pr=0;--Dn>0;)D["xn"+Dn]=0,D["xs"+Dn]="";D.xs0="",D._next=D._prev=D.xfirst=D.data=D.plugin=D.setRatio=D.rxp=null,D.appendXtra=function(Me,Ee,We,it,je,_t){var qe=this,lt=qe.l;return qe["xs"+lt]+=_t&&(lt||qe["xs"+lt])?" "+Me:Me||"",!We&&lt!==0&&!qe.plugin?(qe["xs"+lt]+=Ee+(it||""),qe):(qe.l++,qe.type=qe.setRatio?2:1,qe["xs"+qe.l]=it||"",lt>0?(qe.data["xn"+lt]=Ee+We,qe.rxp["xn"+lt]=je,qe["xn"+lt]=Ee,qe.plugin||(qe.xfirst=new Pe(qe,"xn"+lt,Ee,We,qe.xfirst||qe,0,qe.n,je,qe.pr),qe.xfirst.xs0=0),qe):(qe.data={s:Ee+We},qe.rxp={},qe.s=Ee,qe.c=We,qe.r=je,qe))};var kn=function(Me,Ee){Ee=Ee||{},this.p=Ee.prefix&&Gt(Me)||Me,R[Me]=R[this.p]=this,this.format=Ee.formatter||xn(Ee.defaultValue,Ee.color,Ee.collapsible,Ee.multi),Ee.parser&&(this.parse=Ee.parser),this.clrs=Ee.color,this.multi=Ee.multi,this.keyword=Ee.keyword,this.dflt=Ee.defaultValue,this.allowFunc=Ee.allowFunc,this.pr=Ee.priority||0},ui=Ze._registerComplexSpecialProp=function(Me,Ee,We){typeof Ee!="object"&&(Ee={parser:We});var it=Me.split(","),je=Ee.defaultValue,_t;for(We=We||[je],_t=0;_t<it.length;_t++)Ee.prefix=_t===0&&Ee.prefix,Ee.defaultValue=We[_t]||je,new kn(it[_t],Ee)},Nr=Ze._registerPluginProp=function(Me){if(!R[Me]){var Ee=Me.charAt(0).toUpperCase()+Me.substr(1)+"Plugin";ui(Me,{parser:function(We,it,je,_t,qe,lt,Nt){var cn=m.com.greensock.plugins[Ee];return cn?(cn._cssRegister(),R[je].parse(We,it,je,_t,qe,lt,Nt)):(Jn("Error: "+Ee+" js file not loaded."),qe)}})}};D=kn.prototype,D.parseComplex=function(Me,Ee,We,it,je,_t){var qe=this.keyword,lt,Nt,cn,Xt,In,Ut;if(this.multi&&(re.test(We)||re.test(Ee)?(Nt=Ee.replace(re,"|").split("|"),cn=We.replace(re,"|").split("|")):qe&&(Nt=[Ee],cn=[We])),cn){for(Xt=cn.length>Nt.length?cn.length:Nt.length,lt=0;lt<Xt;lt++)Ee=Nt[lt]=Nt[lt]||this.dflt,We=cn[lt]=cn[lt]||this.dflt,qe&&(In=Ee.indexOf(qe),Ut=We.indexOf(qe),In!==Ut&&(Ut===-1?Nt[lt]=Nt[lt].split(qe).join(""):In===-1&&(Nt[lt]+=" "+qe)));Ee=Nt.join(", "),We=cn.join(", ")}return pn(Me,this.p,Ee,We,this.clrs,this.dflt,it,this.pr,je,_t)},D.parse=function(Me,Ee,We,it,je,_t,qe){return this.parseComplex(Me.style,this.format(qt(Me,this.p,w,!1,this.dflt)),this.format(Ee),je,_t)},i.registerSpecialProp=function(Me,Ee,We){ui(Me,{parser:function(it,je,_t,qe,lt,Nt,cn){var Xt=new Pe(it,_t,0,0,lt,2,_t,!1,We);return Xt.plugin=Nt,Xt.setRatio=Ee(it,je,qe._tween,_t),Xt},priority:We})},i.useSVGTransformAttr=!0;var Pr="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),wr=Gt("transform"),es=Lt+"transform",Ps=Gt("transformOrigin"),Jr=Gt("perspective")!==null,cl=Ze.Transform=function(){this.perspective=parseFloat(i.defaultTransformPerspective)||0,this.force3D=i.defaultForce3D===!1||!Jr?!1:i.defaultForce3D||"auto"},xs=_gsScope.SVGElement,wo,Cl=function(Me,Ee,We){var it=Fe.createElementNS("http://www.w3.org/2000/svg",Me),je=/([a-z])([A-Z])/g,_t;for(_t in We)it.setAttributeNS(null,_t.replace(je,"$1-$2").toLowerCase(),We[_t]);return Ee.appendChild(it),it},Zs=Fe.documentElement||{},Bo=function(){var Me=Zt||/Android/i.test(tt)&&!_gsScope.chrome,Ee,We,it;return Fe.createElementNS&&Zs.appendChild&&!Me&&(Ee=Cl("svg",Zs),We=Cl("rect",Ee,{width:100,height:50,x:100}),it=We.getBoundingClientRect().width,We.style[Ps]="50% 50%",We.style[wr]="scaleX(0.5)",Me=it===We.getBoundingClientRect().width&&!(et&&Jr),Zs.removeChild(Ee)),Me}(),co=function(Me,Ee,We,it,je,_t){var qe=Me._gsTransform,lt=Wt(Me,!0),Nt,cn,Xt,In,Ut,Zn,On,Yt,si,Tn,_i,Ii,Yn,Oi;qe&&(Yn=qe.xOrigin,Oi=qe.yOrigin),(!it||(Nt=it.split(" ")).length<2)&&(On=Me.getBBox(),On.x===0&&On.y===0&&On.width+On.height===0&&(On={x:parseFloat(Me.hasAttribute("x")?Me.getAttribute("x"):Me.hasAttribute("cx")?Me.getAttribute("cx"):0)||0,y:parseFloat(Me.hasAttribute("y")?Me.getAttribute("y"):Me.hasAttribute("cy")?Me.getAttribute("cy"):0)||0,width:0,height:0}),Ee=$e(Ee).split(" "),Nt=[(Ee[0].indexOf("%")!==-1?parseFloat(Ee[0])/100*On.width:parseFloat(Ee[0]))+On.x,(Ee[1].indexOf("%")!==-1?parseFloat(Ee[1])/100*On.height:parseFloat(Ee[1]))+On.y]),We.xOrigin=In=parseFloat(Nt[0]),We.yOrigin=Ut=parseFloat(Nt[1]),it&&lt!==gt&&(Zn=lt[0],On=lt[1],Yt=lt[2],si=lt[3],Tn=lt[4],_i=lt[5],Ii=Zn*si-On*Yt,Ii&&(cn=In*(si/Ii)+Ut*(-Yt/Ii)+(Yt*_i-si*Tn)/Ii,Xt=In*(-On/Ii)+Ut*(Zn/Ii)-(Zn*_i-On*Tn)/Ii,In=We.xOrigin=Nt[0]=cn,Ut=We.yOrigin=Nt[1]=Xt)),qe&&(_t&&(We.xOffset=qe.xOffset,We.yOffset=qe.yOffset,qe=We),je||je!==!1&&i.defaultSmoothOrigin!==!1?(cn=In-Yn,Xt=Ut-Oi,qe.xOffset+=cn*lt[0]+Xt*lt[2]-cn,qe.yOffset+=cn*lt[1]+Xt*lt[3]-Xt):qe.xOffset=qe.yOffset=0),_t||Me.setAttribute("data-svg-origin",Nt.join(" "))},Jl=function(Me){var Ee=Ve("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),We=this.parentNode,it=this.nextSibling,je=this.style.cssText,_t;if(Zs.appendChild(Ee),Ee.appendChild(this),this.style.display="block",Me)try{_t=this.getBBox(),this._originalGetBBox=this.getBBox,this.getBBox=Jl}catch{}else this._originalGetBBox&&(_t=this._originalGetBBox());return it?We.insertBefore(this,it):We.appendChild(this),Zs.removeChild(Ee),this.style.cssText=je,_t},mh=function(Me){try{return Me.getBBox()}catch{return Jl.call(Me,!0)}},ul=function(Me){return!!(xs&&Me.getCTM&&(!Me.parentNode||Me.ownerSVGElement)&&mh(Me))},gt=[1,0,0,1,0,0],Wt=function(Me,Ee){var We=Me._gsTransform||new cl,it=1e5,je=Me.style,_t,qe,lt,Nt,cn,Xt,In;if(wr?qe=qt(Me,es,null,!0):Me.currentStyle&&(qe=Me.currentStyle.filter.match(ie),qe=qe&&qe.length===4?[qe[0].substr(4),Number(qe[2].substr(4)),Number(qe[1].substr(4)),qe[3].substr(4),We.x||0,We.y||0].join(","):""),_t=!qe||qe==="none"||qe==="matrix(1, 0, 0, 1, 0, 0)",wr&&_t&&!Me.offsetParent&&Me!==Zs&&(Nt=je.display,je.display="block",In=Me.parentNode,(!In||!Me.offsetParent)&&(cn=1,Xt=Me.nextSibling,Zs.appendChild(Me)),qe=qt(Me,es,null,!0),_t=!qe||qe==="none"||qe==="matrix(1, 0, 0, 1, 0, 0)",Nt?je.display=Nt:Di(je,"display"),cn&&(Xt?In.insertBefore(Me,Xt):In?In.appendChild(Me):Zs.removeChild(Me))),(We.svg||Me.getCTM&&ul(Me))&&(_t&&(je[wr]+"").indexOf("matrix")!==-1&&(qe=je[wr],_t=0),lt=Me.getAttribute("transform"),_t&&lt&&(lt=Me.transform.baseVal.consolidate().matrix,qe="matrix("+lt.a+","+lt.b+","+lt.c+","+lt.d+","+lt.e+","+lt.f+")",_t=0)),_t)return gt;for(lt=(qe||"").match(U)||[],Dn=lt.length;--Dn>-1;)Nt=Number(lt[Dn]),lt[Dn]=(cn=Nt-(Nt|=0))?(cn*it+(cn<0?-.5:.5)|0)/it+Nt:Nt;return Ee&&lt.length>6?[lt[0],lt[1],lt[4],lt[5],lt[12],lt[13]]:lt},bn=Ze.getTransform=function(Me,Ee,We,it){if(Me._gsTransform&&We&&!it)return Me._gsTransform;var je=We?Me._gsTransform||new cl:new cl,_t=je.scaleX<0,qe=2e-5,lt=1e5,Nt=Jr&&(parseFloat(qt(Me,Ps,Ee,!1,"0 0 0").split(" ")[2])||je.zOrigin)||0,cn=parseFloat(i.defaultTransformPerspective)||0,Xt,In,Ut,Zn,On,Yt;if(je.svg=!!(Me.getCTM&&ul(Me)),je.svg&&(co(Me,qt(Me,Ps,Ee,!1,"50% 50%")+"",je,Me.getAttribute("data-svg-origin")),wo=i.useSVGTransformAttr||Bo),Xt=Wt(Me),Xt!==gt){if(Xt.length===16){var si=Xt[0],Tn=Xt[1],_i=Xt[2],Ii=Xt[3],Yn=Xt[4],Oi=Xt[5],Ki=Xt[6],Zi=Xt[7],kr=Xt[8],sr=Xt[9],ur=Xt[10],eo=Xt[12],Jo=Xt[13],to=Xt[14],gs=Xt[11],Ln=Math.atan2(Ki,ur),as,Ur,Oo,Er,$i;je.zOrigin&&(to=-je.zOrigin,eo=kr*to-Xt[12],Jo=sr*to-Xt[13],to=ur*to+je.zOrigin-Xt[14]),je.rotationX=Ln*ye,Ln&&(Er=Math.cos(-Ln),$i=Math.sin(-Ln),as=Yn*Er+kr*$i,Ur=Oi*Er+sr*$i,Oo=Ki*Er+ur*$i,kr=Yn*-$i+kr*Er,sr=Oi*-$i+sr*Er,ur=Ki*-$i+ur*Er,gs=Zi*-$i+gs*Er,Yn=as,Oi=Ur,Ki=Oo),Ln=Math.atan2(-_i,ur),je.rotationY=Ln*ye,Ln&&(Er=Math.cos(-Ln),$i=Math.sin(-Ln),as=si*Er-kr*$i,Ur=Tn*Er-sr*$i,Oo=_i*Er-ur*$i,sr=Tn*$i+sr*Er,ur=_i*$i+ur*Er,gs=Ii*$i+gs*Er,si=as,Tn=Ur,_i=Oo),Ln=Math.atan2(Tn,si),je.rotation=Ln*ye,Ln&&(Er=Math.cos(Ln),$i=Math.sin(Ln),as=si*Er+Tn*$i,Ur=Yn*Er+Oi*$i,Oo=kr*Er+sr*$i,Tn=Tn*Er-si*$i,Oi=Oi*Er-Yn*$i,sr=sr*Er-kr*$i,si=as,Yn=Ur,kr=Oo),je.rotationX&&Math.abs(je.rotationX)+Math.abs(je.rotation)>359.9&&(je.rotationX=je.rotation=0,je.rotationY=180-je.rotationY),Ln=Math.atan2(Yn,Oi),je.scaleX=(Math.sqrt(si*si+Tn*Tn+_i*_i)*lt+.5|0)/lt,je.scaleY=(Math.sqrt(Oi*Oi+Ki*Ki)*lt+.5|0)/lt,je.scaleZ=(Math.sqrt(kr*kr+sr*sr+ur*ur)*lt+.5|0)/lt,si/=je.scaleX,Yn/=je.scaleY,Tn/=je.scaleX,Oi/=je.scaleY,Math.abs(Ln)>qe?(je.skewX=Ln*ye,Yn=0,je.skewType!=="simple"&&(je.scaleY*=1/Math.cos(Ln))):je.skewX=0,je.perspective=gs?1/(gs<0?-gs:gs):0,je.x=eo,je.y=Jo,je.z=to,je.svg&&(je.x-=je.xOrigin-(je.xOrigin*si-je.yOrigin*Yn),je.y-=je.yOrigin-(je.yOrigin*Tn-je.xOrigin*Oi))}else if(!Jr||it||!Xt.length||je.x!==Xt[4]||je.y!==Xt[5]||!je.rotationX&&!je.rotationY){var ir=Xt.length>=6,Fs=ir?Xt[0]:1,uo=Xt[1]||0,Eo=Xt[2]||0,or=ir?Xt[3]:1;je.x=Xt[4]||0,je.y=Xt[5]||0,Ut=Math.sqrt(Fs*Fs+uo*uo),Zn=Math.sqrt(or*or+Eo*Eo),On=Fs||uo?Math.atan2(uo,Fs)*ye:je.rotation||0,Yt=Eo||or?Math.atan2(Eo,or)*ye+On:je.skewX||0,je.scaleX=Ut,je.scaleY=Zn,je.rotation=On,je.skewX=Yt,Jr&&(je.rotationX=je.rotationY=je.z=0,je.perspective=cn,je.scaleZ=1),je.svg&&(je.x-=je.xOrigin-(je.xOrigin*Fs+je.yOrigin*Eo),je.y-=je.yOrigin-(je.xOrigin*uo+je.yOrigin*or))}Math.abs(je.skewX)>90&&Math.abs(je.skewX)<270&&(_t?(je.scaleX*=-1,je.skewX+=je.rotation<=0?180:-180,je.rotation+=je.rotation<=0?180:-180):(je.scaleY*=-1,je.skewX+=je.skewX<=0?180:-180)),je.zOrigin=Nt;for(In in je)je[In]<qe&&je[In]>-qe&&(je[In]=0)}return We&&(Me._gsTransform=je,je.svg&&(wo&&Me.style[wr]?r.delayedCall(.001,function(){Di(Me.style,wr)}):!wo&&Me.getAttribute("transform")&&r.delayedCall(.001,function(){Me.removeAttribute("transform")}))),je},ln=function(Me){var Ee=this.data,We=-Ee.rotation*me,it=We+Ee.skewX*me,je=1e5,_t=(Math.cos(We)*Ee.scaleX*je|0)/je,qe=(Math.sin(We)*Ee.scaleX*je|0)/je,lt=(Math.sin(it)*-Ee.scaleY*je|0)/je,Nt=(Math.cos(it)*Ee.scaleY*je|0)/je,cn=this.t.style,Xt=this.t.currentStyle,In,Ut;if(Xt){Ut=qe,qe=-lt,lt=-Ut,In=Xt.filter,cn.filter="";var Zn=this.t.offsetWidth,On=this.t.offsetHeight,Yt=Xt.position!=="absolute",si="progid:DXImageTransform.Microsoft.Matrix(M11="+_t+", M12="+qe+", M21="+lt+", M22="+Nt,Tn=Ee.x+Zn*Ee.xPercent/100,_i=Ee.y+On*Ee.yPercent/100,Ii,Yn;if(Ee.ox!=null&&(Ii=(Ee.oxp?Zn*Ee.ox*.01:Ee.ox)-Zn/2,Yn=(Ee.oyp?On*Ee.oy*.01:Ee.oy)-On/2,Tn+=Ii-(Ii*_t+Yn*qe),_i+=Yn-(Ii*lt+Yn*Nt)),Yt?(Ii=Zn/2,Yn=On/2,si+=", Dx="+(Ii-(Ii*_t+Yn*qe)+Tn)+", Dy="+(Yn-(Ii*lt+Yn*Nt)+_i)+")"):si+=", sizingMethod='auto expand')",In.indexOf("DXImageTransform.Microsoft.Matrix(")!==-1?cn.filter=In.replace(ve,si):cn.filter=si+" "+In,(Me===0||Me===1)&&_t===1&&qe===0&&lt===0&&Nt===1&&(!Yt||si.indexOf("Dx=0, Dy=0")!==-1)&&(!ne.test(In)||parseFloat(RegExp.$1)===100)&&In.indexOf(In.indexOf("Alpha"))===-1&&cn.removeAttribute("filter"),!Yt){var Oi=Zt<8?1:-1,Ki,Zi,kr;for(Ii=Ee.ieOffsetX||0,Yn=Ee.ieOffsetY||0,Ee.ieOffsetX=Math.round((Zn-((_t<0?-_t:_t)*Zn+(qe<0?-qe:qe)*On))/2+Tn),Ee.ieOffsetY=Math.round((On-((Nt<0?-Nt:Nt)*On+(lt<0?-lt:lt)*Zn))/2+_i),Dn=0;Dn<4;Dn++)Zi=Le[Dn],Ki=Xt[Zi],Ut=Ki.indexOf("px")!==-1?parseFloat(Ki):An(this.t,Zi,parseFloat(Ki),Ki.replace(oe,""))||0,Ut!==Ee[Zi]?kr=Dn<2?-Ee.ieOffsetX:-Ee.ieOffsetY:kr=Dn<2?Ii-Ee.ieOffsetX:Yn-Ee.ieOffsetY,cn[Zi]=(Ee[Zi]=Math.round(Ut-kr*(Dn===0||Dn===2?1:Oi)))+"px"}}},mn=Ze.set3DTransformRatio=Ze.setTransformRatio=function(Me){var Ee=this.data,We=this.t.style,it=Ee.rotation,je=Ee.rotationX,_t=Ee.rotationY,qe=Ee.scaleX,lt=Ee.scaleY,Nt=Ee.scaleZ,cn=Ee.x,Xt=Ee.y,In=Ee.z,Ut=Ee.svg,Zn=Ee.perspective,On=Ee.force3D,Yt=Ee.skewY,si=Ee.skewX,Tn,_i,Ii,Yn,Oi,Ki,Zi,kr,sr,ur,eo,Jo,to,gs,Ln,as,Ur,Oo,Er,$i,ir,Fs,uo;if(Yt&&(si+=Yt,it+=Yt),((Me===1||Me===0)&&On==="auto"&&(this.tween._totalTime===this.tween._totalDuration||!this.tween._totalTime)||!On)&&!In&&!Zn&&!_t&&!je&&Nt===1||wo&&Ut||!Jr){it||si||Ut?(it*=me,Fs=si*me,uo=1e5,_i=Math.cos(it)*qe,Oi=Math.sin(it)*qe,Ii=Math.sin(it-Fs)*-lt,Ki=Math.cos(it-Fs)*lt,Fs&&Ee.skewType==="simple"&&(Tn=Math.tan(Fs-Yt*me),Tn=Math.sqrt(1+Tn*Tn),Ii*=Tn,Ki*=Tn,Yt&&(Tn=Math.tan(Yt*me),Tn=Math.sqrt(1+Tn*Tn),_i*=Tn,Oi*=Tn)),Ut&&(cn+=Ee.xOrigin-(Ee.xOrigin*_i+Ee.yOrigin*Ii)+Ee.xOffset,Xt+=Ee.yOrigin-(Ee.xOrigin*Oi+Ee.yOrigin*Ki)+Ee.yOffset,wo&&(Ee.xPercent||Ee.yPercent)&&(Ln=this.t.getBBox(),cn+=Ee.xPercent*.01*Ln.width,Xt+=Ee.yPercent*.01*Ln.height),Ln=1e-6,cn<Ln&&cn>-Ln&&(cn=0),Xt<Ln&&Xt>-Ln&&(Xt=0)),Er=(_i*uo|0)/uo+","+(Oi*uo|0)/uo+","+(Ii*uo|0)/uo+","+(Ki*uo|0)/uo+","+cn+","+Xt+")",Ut&&wo?this.t.setAttribute("transform","matrix("+Er):We[wr]=(Ee.xPercent||Ee.yPercent?"translate("+Ee.xPercent+"%,"+Ee.yPercent+"%) matrix(":"matrix(")+Er):We[wr]=(Ee.xPercent||Ee.yPercent?"translate("+Ee.xPercent+"%,"+Ee.yPercent+"%) matrix(":"matrix(")+qe+",0,0,"+lt+","+cn+","+Xt+")";return}if(et&&(Ln=1e-4,qe<Ln&&qe>-Ln&&(qe=Nt=2e-5),lt<Ln&&lt>-Ln&&(lt=Nt=2e-5),Zn&&!Ee.z&&!Ee.rotationX&&!Ee.rotationY&&(Zn=0)),it||si)it*=me,as=_i=Math.cos(it),Ur=Oi=Math.sin(it),si&&(it-=si*me,as=Math.cos(it),Ur=Math.sin(it),Ee.skewType==="simple"&&(Tn=Math.tan((si-Yt)*me),Tn=Math.sqrt(1+Tn*Tn),as*=Tn,Ur*=Tn,Ee.skewY&&(Tn=Math.tan(Yt*me),Tn=Math.sqrt(1+Tn*Tn),_i*=Tn,Oi*=Tn))),Ii=-Ur,Ki=as;else if(!_t&&!je&&Nt===1&&!Zn&&!Ut){We[wr]=(Ee.xPercent||Ee.yPercent?"translate("+Ee.xPercent+"%,"+Ee.yPercent+"%) translate3d(":"translate3d(")+cn+"px,"+Xt+"px,"+In+"px)"+(qe!==1||lt!==1?" scale("+qe+","+lt+")":"");return}else _i=Ki=1,Ii=Oi=0;ur=1,Yn=Zi=kr=sr=eo=Jo=0,to=Zn?-1/Zn:0,gs=Ee.zOrigin,Ln=1e-6,$i=",",ir="0",it=_t*me,it&&(as=Math.cos(it),Ur=Math.sin(it),kr=-Ur,eo=to*-Ur,Yn=_i*Ur,Zi=Oi*Ur,ur=as,to*=as,_i*=as,Oi*=as),it=je*me,it&&(as=Math.cos(it),Ur=Math.sin(it),Tn=Ii*as+Yn*Ur,Oo=Ki*as+Zi*Ur,sr=ur*Ur,Jo=to*Ur,Yn=Ii*-Ur+Yn*as,Zi=Ki*-Ur+Zi*as,ur=ur*as,to=to*as,Ii=Tn,Ki=Oo),Nt!==1&&(Yn*=Nt,Zi*=Nt,ur*=Nt,to*=Nt),lt!==1&&(Ii*=lt,Ki*=lt,sr*=lt,Jo*=lt),qe!==1&&(_i*=qe,Oi*=qe,kr*=qe,eo*=qe),(gs||Ut)&&(gs&&(cn+=Yn*-gs,Xt+=Zi*-gs,In+=ur*-gs+gs),Ut&&(cn+=Ee.xOrigin-(Ee.xOrigin*_i+Ee.yOrigin*Ii)+Ee.xOffset,Xt+=Ee.yOrigin-(Ee.xOrigin*Oi+Ee.yOrigin*Ki)+Ee.yOffset),cn<Ln&&cn>-Ln&&(cn=ir),Xt<Ln&&Xt>-Ln&&(Xt=ir),In<Ln&&In>-Ln&&(In=0)),Er=Ee.xPercent||Ee.yPercent?"translate("+Ee.xPercent+"%,"+Ee.yPercent+"%) matrix3d(":"matrix3d(",Er+=(_i<Ln&&_i>-Ln?ir:_i)+$i+(Oi<Ln&&Oi>-Ln?ir:Oi)+$i+(kr<Ln&&kr>-Ln?ir:kr),Er+=$i+(eo<Ln&&eo>-Ln?ir:eo)+$i+(Ii<Ln&&Ii>-Ln?ir:Ii)+$i+(Ki<Ln&&Ki>-Ln?ir:Ki),je||_t||Nt!==1?(Er+=$i+(sr<Ln&&sr>-Ln?ir:sr)+$i+(Jo<Ln&&Jo>-Ln?ir:Jo)+$i+(Yn<Ln&&Yn>-Ln?ir:Yn),Er+=$i+(Zi<Ln&&Zi>-Ln?ir:Zi)+$i+(ur<Ln&&ur>-Ln?ir:ur)+$i+(to<Ln&&to>-Ln?ir:to)+$i):Er+=",0,0,0,0,1,0,",Er+=cn+$i+Xt+$i+In+$i+(Zn?1+-In/Zn:1)+")",We[wr]=Er};D=cl.prototype,D.x=D.y=D.z=D.skewX=D.skewY=D.rotation=D.rotationX=D.rotationY=D.zOrigin=D.xPercent=D.yPercent=D.xOffset=D.yOffset=0,D.scaleX=D.scaleY=D.scaleZ=1,ui("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(Me,Ee,We,it,je,_t,qe){if(it._lastParsedTransform===qe)return je;it._lastParsedTransform=qe;var lt=qe.scale&&typeof qe.scale=="function"?qe.scale:0;lt&&(qe.scale=lt(St,Me));var Nt=Me._gsTransform,cn=Me.style,Xt=1e-6,In=Pr.length,Ut=qe,Zn={},On="transformOrigin",Yt=bn(Me,w,!0,Ut.parseTransform),si=Ut.transform&&(typeof Ut.transform=="function"?Ut.transform(St,Ue):Ut.transform),Tn,_i,Ii,Yn,Oi,Ki,Zi,kr,sr;if(Yt.skewType=Ut.skewType||Yt.skewType||i.defaultSkewType,it._transform=Yt,"rotationZ"in Ut&&(Ut.rotation=Ut.rotationZ),si&&typeof si=="string"&&wr)_i=ot.style,_i[wr]=si,_i.display="block",_i.position="absolute",si.indexOf("%")!==-1&&(_i.width=qt(Me,"width"),_i.height=qt(Me,"height")),Fe.body.appendChild(ot),Tn=bn(ot,null,!1),Yt.skewType==="simple"&&(Tn.scaleY*=Math.cos(Tn.skewX*me)),Yt.svg&&(Ki=Yt.xOrigin,Zi=Yt.yOrigin,Tn.x-=Yt.xOffset,Tn.y-=Yt.yOffset,(Ut.transformOrigin||Ut.svgOrigin)&&(si={},co(Me,$e(Ut.transformOrigin),si,Ut.svgOrigin,Ut.smoothOrigin,!0),Ki=si.xOrigin,Zi=si.yOrigin,Tn.x-=si.xOffset-Yt.xOffset,Tn.y-=si.yOffset-Yt.yOffset),(Ki||Zi)&&(kr=Wt(ot,!0),Tn.x-=Ki-(Ki*kr[0]+Zi*kr[2]),Tn.y-=Zi-(Ki*kr[1]+Zi*kr[3]))),Fe.body.removeChild(ot),Tn.perspective||(Tn.perspective=Yt.perspective),Ut.xPercent!=null&&(Tn.xPercent=Mt(Ut.xPercent,Yt.xPercent)),Ut.yPercent!=null&&(Tn.yPercent=Mt(Ut.yPercent,Yt.yPercent));else if(typeof Ut=="object"){if(Tn={scaleX:Mt(Ut.scaleX!=null?Ut.scaleX:Ut.scale,Yt.scaleX),scaleY:Mt(Ut.scaleY!=null?Ut.scaleY:Ut.scale,Yt.scaleY),scaleZ:Mt(Ut.scaleZ,Yt.scaleZ),x:Mt(Ut.x,Yt.x),y:Mt(Ut.y,Yt.y),z:Mt(Ut.z,Yt.z),xPercent:Mt(Ut.xPercent,Yt.xPercent),yPercent:Mt(Ut.yPercent,Yt.yPercent),perspective:Mt(Ut.transformPerspective,Yt.perspective)},Oi=Ut.directionalRotation,Oi!=null)if(typeof Oi=="object")for(_i in Oi)Ut[_i]=Oi[_i];else Ut.rotation=Oi;typeof Ut.x=="string"&&Ut.x.indexOf("%")!==-1&&(Tn.x=0,Tn.xPercent=Mt(Ut.x,Yt.xPercent)),typeof Ut.y=="string"&&Ut.y.indexOf("%")!==-1&&(Tn.y=0,Tn.yPercent=Mt(Ut.y,Yt.yPercent)),Tn.rotation=Bt("rotation"in Ut?Ut.rotation:"shortRotation"in Ut?Ut.shortRotation+"_short":Yt.rotation,Yt.rotation,"rotation",Zn),Jr&&(Tn.rotationX=Bt("rotationX"in Ut?Ut.rotationX:"shortRotationX"in Ut?Ut.shortRotationX+"_short":Yt.rotationX||0,Yt.rotationX,"rotationX",Zn),Tn.rotationY=Bt("rotationY"in Ut?Ut.rotationY:"shortRotationY"in Ut?Ut.shortRotationY+"_short":Yt.rotationY||0,Yt.rotationY,"rotationY",Zn)),Tn.skewX=Bt(Ut.skewX,Yt.skewX),Tn.skewY=Bt(Ut.skewY,Yt.skewY)}for(Jr&&Ut.force3D!=null&&(Yt.force3D=Ut.force3D,Yn=!0),Ii=Yt.force3D||Yt.z||Yt.rotationX||Yt.rotationY||Tn.z||Tn.rotationX||Tn.rotationY||Tn.perspective,!Ii&&Ut.scale!=null&&(Tn.scaleZ=1);--In>-1;)sr=Pr[In],si=Tn[sr]-Yt[sr],(si>Xt||si<-Xt||Ut[sr]!=null||Te[sr]!=null)&&(Yn=!0,je=new Pe(Yt,sr,Yt[sr],si,je),sr in Zn&&(je.e=Zn[sr]),je.xs0=0,je.plugin=_t,it._overwriteProps.push(je.n));return si=typeof Ut.transformOrigin=="function"?Ut.transformOrigin(St,Ue):Ut.transformOrigin,Yt.svg&&(si||Ut.svgOrigin)&&(Ki=Yt.xOffset,Zi=Yt.yOffset,co(Me,$e(si),Tn,Ut.svgOrigin,Ut.smoothOrigin),je=oi(Yt,"xOrigin",(Nt?Yt:Tn).xOrigin,Tn.xOrigin,je,On),je=oi(Yt,"yOrigin",(Nt?Yt:Tn).yOrigin,Tn.yOrigin,je,On),(Ki!==Yt.xOffset||Zi!==Yt.yOffset)&&(je=oi(Yt,"xOffset",Nt?Ki:Yt.xOffset,Yt.xOffset,je,On),je=oi(Yt,"yOffset",Nt?Zi:Yt.yOffset,Yt.yOffset,je,On)),si="0px 0px"),(si||Jr&&Ii&&Yt.zOrigin)&&(wr?(Yn=!0,sr=Ps,si||(si=(qt(Me,sr,w,!1,"50% 50%")+"").split(" "),si=si[0]+" "+si[1]+" "+Yt.zOrigin+"px"),si+="",je=new Pe(cn,sr,0,0,je,-1,On),je.b=cn[sr],je.plugin=_t,Jr?(_i=Yt.zOrigin,si=si.split(" "),Yt.zOrigin=(si.length>2?parseFloat(si[2]):_i)||0,je.xs0=je.e=si[0]+" "+(si[1]||"50%")+" 0px",je=new Pe(Yt,"zOrigin",0,0,je,-1,je.n),je.b=_i,je.xs0=je.e=Yt.zOrigin):je.xs0=je.e=si):$e(si+"",Yt)),Yn&&(it._transformType=!(Yt.svg&&wo)&&(Ii||this._transformType===3)?3:2),lt&&(qe.scale=lt),je},allowFunc:!0,prefix:!0}),ui("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),ui("clipPath",{defaultValue:"inset(0%)",prefix:!0,multi:!0,formatter:xn("inset(0% 0% 0% 0%)",!1,!0)}),ui("borderRadius",{defaultValue:"0px",parser:function(Me,Ee,We,it,je,_t){Ee=this.format(Ee);var qe=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],lt=Me.style,Nt,cn,Xt,In,Ut,Zn,On,Yt,si,Tn,_i,Ii,Yn,Oi,Ki,Zi;for(si=parseFloat(Me.offsetWidth),Tn=parseFloat(Me.offsetHeight),Nt=Ee.split(" "),cn=0;cn<qe.length;cn++)this.p.indexOf("border")&&(qe[cn]=Gt(qe[cn])),Ut=In=qt(Me,qe[cn],w,!1,"0px"),Ut.indexOf(" ")!==-1&&(In=Ut.split(" "),Ut=In[0],In=In[1]),Zn=Xt=Nt[cn],On=parseFloat(Ut),Ii=Ut.substr((On+"").length),Yn=Zn.charAt(1)==="=",Yn?(Yt=parseInt(Zn.charAt(0)+"1",10),Zn=Zn.substr(2),Yt*=parseFloat(Zn),_i=Zn.substr((Yt+"").length-(Yt<0?1:0))||""):(Yt=parseFloat(Zn),_i=Zn.substr((Yt+"").length)),_i===""&&(_i=A[We]||Ii),_i!==Ii&&(Oi=An(Me,"borderLeft",On,Ii),Ki=An(Me,"borderTop",On,Ii),_i==="%"?(Ut=Oi/si*100+"%",In=Ki/Tn*100+"%"):_i==="em"?(Zi=An(Me,"borderLeft",1,"em"),Ut=Oi/Zi+"em",In=Ki/Zi+"em"):(Ut=Oi+"px",In=Ki+"px"),Yn&&(Zn=parseFloat(Ut)+Yt+_i,Xt=parseFloat(In)+Yt+_i)),je=pn(lt,qe[cn],Ut+" "+In,Zn+" "+Xt,!1,"0px",je);return je},prefix:!0,formatter:xn("0px 0px 0px 0px",!1,!0)}),ui("borderBottomLeftRadius,borderBottomRightRadius,borderTopLeftRadius,borderTopRightRadius",{defaultValue:"0px",parser:function(Me,Ee,We,it,je,_t){return pn(Me.style,We,this.format(qt(Me,We,w,!1,"0px 0px")),this.format(Ee),!1,"0px",je)},prefix:!0,formatter:xn("0px 0px",!1,!0)}),ui("backgroundPosition",{defaultValue:"0 0",parser:function(Me,Ee,We,it,je,_t){var qe="background-position",lt=w||hn(Me),Nt=this.format((lt?Zt?lt.getPropertyValue(qe+"-x")+" "+lt.getPropertyValue(qe+"-y"):lt.getPropertyValue(qe):Me.currentStyle.backgroundPositionX+" "+Me.currentStyle.backgroundPositionY)||"0 0"),cn=this.format(Ee),Xt,In,Ut,Zn,On,Yt;if(Nt.indexOf("%")!==-1!=(cn.indexOf("%")!==-1)&&cn.split(",").length<2&&(Yt=qt(Me,"backgroundImage").replace(he,""),Yt&&Yt!=="none")){for(Xt=Nt.split(" "),In=cn.split(" "),Ye.setAttribute("src",Yt),Ut=2;--Ut>-1;)Nt=Xt[Ut],Zn=Nt.indexOf("%")!==-1,Zn!==(In[Ut].indexOf("%")!==-1)&&(On=Ut===0?Me.offsetWidth-Ye.width:Me.offsetHeight-Ye.height,Xt[Ut]=Zn?parseFloat(Nt)/100*On+"px":parseFloat(Nt)/On*100+"%");Nt=Xt.join(" ")}return this.parseComplex(Me.style,Nt,cn,je,_t)},formatter:$e}),ui("backgroundSize",{defaultValue:"0 0",formatter:function(Me){return Me+="",Me.substr(0,2)==="co"?Me:$e(Me.indexOf(" ")===-1?Me+" "+Me:Me)}}),ui("perspective",{defaultValue:"0px",prefix:!0}),ui("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),ui("transformStyle",{prefix:!0}),ui("backfaceVisibility",{prefix:!0}),ui("userSelect",{prefix:!0}),ui("margin",{parser:wi("marginTop,marginRight,marginBottom,marginLeft")}),ui("padding",{parser:wi("paddingTop,paddingRight,paddingBottom,paddingLeft")}),ui("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(Me,Ee,We,it,je,_t){var qe,lt,Nt;return Zt<9?(lt=Me.currentStyle,Nt=Zt<8?" ":",",qe="rect("+lt.clipTop+Nt+lt.clipRight+Nt+lt.clipBottom+Nt+lt.clipLeft+")",Ee=this.format(Ee).split(",").join(Nt)):(qe=this.format(qt(Me,this.p,w,!1,this.dflt)),Ee=this.format(Ee)),this.parseComplex(Me.style,qe,Ee,je,_t)}}),ui("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),ui("autoRound,strictUnits",{parser:function(Me,Ee,We,it,je){return je}}),ui("border",{defaultValue:"0px solid #000",parser:function(Me,Ee,We,it,je,_t){var qe=qt(Me,"borderTopWidth",w,!1,"0px"),lt=this.format(Ee).split(" "),Nt=lt[0].replace(oe,"");return Nt!=="px"&&(qe=parseFloat(qe)/An(Me,"borderTopWidth",1,Nt)+Nt),this.parseComplex(Me.style,this.format(qe+" "+qt(Me,"borderTopStyle",w,!1,"solid")+" "+qt(Me,"borderTopColor",w,!1,"#000")),lt.join(" "),je,_t)},color:!0,formatter:function(Me){var Ee=Me.split(" ");return Ee[0]+" "+(Ee[1]||"solid")+" "+(Me.match(en)||["#000"])[0]}}),ui("borderWidth",{parser:wi("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),ui("float,cssFloat,styleFloat",{parser:function(Me,Ee,We,it,je,_t){var qe=Me.style,lt="cssFloat"in qe?"cssFloat":"styleFloat";return new Pe(qe,lt,0,0,je,-1,We,!1,0,qe[lt],Ee)}});var Pi=function(Me){var Ee=this.t,We=Ee.filter||qt(this.data,"filter")||"",it=this.s+this.c*Me|0,je;it===100&&(We.indexOf("atrix(")===-1&&We.indexOf("radient(")===-1&&We.indexOf("oader(")===-1?(Ee.removeAttribute("filter"),je=!qt(this.data,"filter")):(Ee.filter=We.replace(V,""),je=!0)),je||(this.xn1&&(Ee.filter=We=We||"alpha(opacity="+it+")"),We.indexOf("pacity")===-1?(it!==0||!this.xn1)&&(Ee.filter=We+" alpha(opacity="+it+")"):Ee.filter=We.replace(ne,"opacity="+it))};ui("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(Me,Ee,We,it,je,_t){var qe=parseFloat(qt(Me,"opacity",w,!1,"1")),lt=Me.style,Nt=We==="autoAlpha";return typeof Ee=="string"&&Ee.charAt(1)==="="&&(Ee=(Ee.charAt(0)==="-"?-1:1)*parseFloat(Ee.substr(2))+qe),Nt&&qe===1&&qt(Me,"visibility",w)==="hidden"&&Ee!==0&&(qe=0),nn?je=new Pe(lt,"opacity",qe,Ee-qe,je):(je=new Pe(lt,"opacity",qe*100,(Ee-qe)*100,je),je.xn1=Nt?1:0,lt.zoom=1,je.type=2,je.b="alpha(opacity="+je.s+")",je.e="alpha(opacity="+(je.s+je.c)+")",je.data=Me,je.plugin=_t,je.setRatio=Pi),Nt&&(je=new Pe(lt,"visibility",0,0,je,-1,null,!1,0,qe!==0?"inherit":"hidden",Ee===0?"hidden":"inherit"),je.xs0="inherit",it._overwriteProps.push(je.n),it._overwriteProps.push(We)),je}});var Di=function(Me,Ee){Ee&&(Me.removeProperty?((Ee.substr(0,2)==="ms"||Ee.substr(0,6)==="webkit")&&(Ee="-"+Ee),Me.removeProperty(Ee.replace(ce,"-$1").toLowerCase())):Me.removeAttribute(Ee))},En=function(Me){if(this.t._gsClassPT=this,Me===1||Me===0){this.t.setAttribute("class",Me===0?this.b:this.e);for(var Ee=this.data,We=this.t.style;Ee;)Ee.v?We[Ee.p]=Ee.v:Di(We,Ee.p),Ee=Ee._next;Me===1&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};ui("className",{parser:function(Me,Ee,We,it,je,_t,qe){var lt=Me.getAttribute("class")||"",Nt=Me.style.cssText,cn,Xt,In,Ut,Zn;if(je=it._classNamePT=new Pe(Me,We,0,0,je,2),je.setRatio=En,je.pr=-11,_=!0,je.b=lt,Xt=Bn(Me,w),In=Me._gsClassPT,In){for(Ut={},Zn=In.data;Zn;)Ut[Zn.p]=1,Zn=Zn._next;In.setRatio(1)}return Me._gsClassPT=je,je.e=Ee.charAt(1)!=="="?Ee:lt.replace(new RegExp("(?:\\s|^)"+Ee.substr(2)+"(?![\\w-])"),"")+(Ee.charAt(0)==="+"?" "+Ee.substr(2):""),Me.setAttribute("class",je.e),cn=de(Me,Xt,Bn(Me),qe,Ut),Me.setAttribute("class",lt),je.data=cn.firstMPT,Me.style.cssText!==Nt&&(Me.style.cssText=Nt),je=je.xfirst=it.parse(Me,cn.difs,je,_t),je}});var nr=function(Me){if((Me===1||Me===0)&&this.data._totalTime===this.data._totalDuration&&this.data.data!=="isFromStart"){var Ee=this.t.style,We=R.transform.parse,it,je,_t,qe,lt;if(this.e==="all")Ee.cssText="",qe=!0;else for(it=this.e.split(" ").join("").split(","),_t=it.length;--_t>-1;)je=it[_t],R[je]&&(R[je].parse===We?qe=!0:je=je==="transformOrigin"?Ps:R[je].p),Di(Ee,je);qe&&(Di(Ee,wr),lt=this.t._gsTransform,lt&&(lt.svg&&(this.t.removeAttribute("data-svg-origin"),this.t.removeAttribute("transform")),delete this.t._gsTransform))}};for(ui("clearProps",{parser:function(Me,Ee,We,it,je){return je=new Pe(Me,We,0,0,je,2),je.setRatio=nr,je.e=Ee,je.pr=-10,je.data=it._tween,_=!0,je}}),D="bezier,throwProps,physicsProps,physics2D".split(","),Dn=D.length;Dn--;)Nr(D[Dn]);D=i.prototype,D._firstPT=D._lastParsedTransform=D._transform=null,D._onInitTween=function(Me,Ee,We,it){if(!Me.nodeType)return!1;this._target=Ue=Me,this._tween=We,this._vars=Ee,St=it,Pt=Ee.autoRound,_=!1,A=Ee.suffixMap||i.suffixMap,w=hn(Me),T=this._overwriteProps;var je=Me.style,_t,qe,lt,Nt,cn,Xt,In,Ut,Zn;if(Et&&je.zIndex===""&&(_t=qt(Me,"zIndex",w),(_t==="auto"||_t==="")&&this._addLazySet(je,"zIndex",0)),typeof Ee=="string"&&(Nt=je.cssText,_t=Bn(Me,w),je.cssText=Nt+";"+Ee,_t=de(Me,_t,Bn(Me)).difs,!nn&&H.test(Ee)&&(_t.opacity=parseFloat(RegExp.$1)),Ee=_t,je.cssText=Nt),Ee.className?this._firstPT=qe=R.className.parse(Me,Ee.className,"className",this,null,null,Ee):this._firstPT=qe=this.parse(Me,Ee,null),this._transformType){for(Zn=this._transformType===3,wr?Ne&&(Et=!0,je.zIndex===""&&(In=qt(Me,"zIndex",w),(In==="auto"||In==="")&&this._addLazySet(je,"zIndex",0)),wt&&this._addLazySet(je,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(Zn?"visible":"hidden"))):je.zoom=1,lt=qe;lt&&lt._next;)lt=lt._next;Ut=new Pe(Me,"transform",0,0,null,2),this._linkCSSP(Ut,null,lt),Ut.setRatio=wr?mn:ln,Ut.data=this._transform||bn(Me,w,!0),Ut.tween=We,Ut.pr=-1,T.pop()}if(_){for(;qe;){for(Xt=qe._next,lt=Nt;lt&&lt.pr>qe.pr;)lt=lt._next;(qe._prev=lt?lt._prev:cn)?qe._prev._next=qe:Nt=qe,(qe._next=lt)?lt._prev=qe:cn=qe,qe=Xt}this._firstPT=Nt}return!0},D.parse=function(Me,Ee,We,it){var je=Me.style,_t,qe,lt,Nt,cn,Xt,In,Ut,Zn,On;for(_t in Ee){if(Xt=Ee[_t],qe=R[_t],typeof Xt=="function"&&!(qe&&qe.allowFunc)&&(Xt=Xt(St,Ue)),qe)We=qe.parse(Me,Xt,_t,this,We,it,Ee);else if(_t.substr(0,2)==="--"){this._tween._propLookup[_t]=this._addTween.call(this._tween,Me.style,"setProperty",hn(Me).getPropertyValue(_t)+"",Xt+"",_t,!1,_t);continue}else cn=qt(Me,_t,w)+"",Zn=typeof Xt=="string",_t==="color"||_t==="fill"||_t==="stroke"||_t.indexOf("Color")!==-1||Zn&&z.test(Xt)?(Zn||(Xt=zt(Xt),Xt=(Xt.length>3?"rgba(":"rgb(")+Xt.join(",")+")"),We=pn(je,_t,cn,Xt,!0,"transparent",We,0,it)):Zn&&ae.test(Xt)?We=pn(je,_t,cn,Xt,!0,null,We,0,it):(lt=parseFloat(cn),In=lt||lt===0?cn.substr((lt+"").length):"",(cn===""||cn==="auto")&&(_t==="width"||_t==="height"?(lt=Oe(Me,_t,w),In="px"):_t==="left"||_t==="top"?(lt=_n(Me,_t,w),In="px"):(lt=_t!=="opacity"?0:1,In="")),On=Zn&&Xt.charAt(1)==="=",On?(Nt=parseInt(Xt.charAt(0)+"1",10),Xt=Xt.substr(2),Nt*=parseFloat(Xt),Ut=Xt.replace(oe,"")):(Nt=parseFloat(Xt),Ut=Zn?Xt.replace(oe,""):""),Ut===""&&(Ut=_t in A?A[_t]:In),Xt=Nt||Nt===0?(On?Nt+lt:Nt)+Ut:Ee[_t],In!==Ut&&(Ut!==""||_t==="lineHeight")&&(Nt||Nt===0)&&lt&&(lt=An(Me,_t,lt,In),Ut==="%"?(lt/=An(Me,_t,100,"%")/100,Ee.strictUnits!==!0&&(cn=lt+"%")):Ut==="em"||Ut==="rem"||Ut==="vw"||Ut==="vh"?lt/=An(Me,_t,1,Ut):Ut!=="px"&&(Nt=An(Me,_t,Nt,Ut),Ut="px"),On&&(Nt||Nt===0)&&(Xt=Nt+lt+Ut)),On&&(Nt+=lt),(lt||lt===0)&&(Nt||Nt===0)?(We=new Pe(je,_t,lt,Nt-lt,We,0,_t,Pt!==!1&&(Ut==="px"||_t==="zIndex"),0,cn,Xt),We.xs0=Ut):je[_t]===void 0||!Xt&&(Xt+""=="NaN"||Xt==null)?Jn("invalid "+_t+" tween value: "+Ee[_t]):(We=new Pe(je,_t,Nt||lt||0,0,We,-1,_t,!1,0,cn,Xt),We.xs0=Xt==="none"&&(_t==="display"||_t.indexOf("Style")!==-1)?cn:Xt));it&&We&&!We.plugin&&(We.plugin=it)}return We},D.setRatio=function(Me){var Ee=this._firstPT,We=1e-6,it,je,_t;if(Me===1&&(this._tween._time===this._tween._duration||this._tween._time===0))for(;Ee;){if(Ee.type!==2)if(Ee.r&&Ee.type!==-1){if(it=Ee.r(Ee.s+Ee.c),!Ee.type)Ee.t[Ee.p]=it+Ee.xs0;else if(Ee.type===1){for(_t=Ee.l,je=Ee.xs0+it+Ee.xs1,_t=1;_t<Ee.l;_t++)je+=Ee["xn"+_t]+Ee["xs"+(_t+1)];Ee.t[Ee.p]=je}}else Ee.t[Ee.p]=Ee.e;else Ee.setRatio(Me);Ee=Ee._next}else if(Me||!(this._tween._time===this._tween._duration||this._tween._time===0)||this._tween._rawPrevTime===-1e-6)for(;Ee;){if(it=Ee.c*Me+Ee.s,Ee.r?it=Ee.r(it):it<We&&it>-We&&(it=0),!Ee.type)Ee.t[Ee.p]=it+Ee.xs0;else if(Ee.type===1)if(_t=Ee.l,_t===2)Ee.t[Ee.p]=Ee.xs0+it+Ee.xs1+Ee.xn1+Ee.xs2;else if(_t===3)Ee.t[Ee.p]=Ee.xs0+it+Ee.xs1+Ee.xn1+Ee.xs2+Ee.xn2+Ee.xs3;else if(_t===4)Ee.t[Ee.p]=Ee.xs0+it+Ee.xs1+Ee.xn1+Ee.xs2+Ee.xn2+Ee.xs3+Ee.xn3+Ee.xs4;else if(_t===5)Ee.t[Ee.p]=Ee.xs0+it+Ee.xs1+Ee.xn1+Ee.xs2+Ee.xn2+Ee.xs3+Ee.xn3+Ee.xs4+Ee.xn4+Ee.xs5;else{for(je=Ee.xs0+it+Ee.xs1,_t=1;_t<Ee.l;_t++)je+=Ee["xn"+_t]+Ee["xs"+(_t+1)];Ee.t[Ee.p]=je}else Ee.type===-1?Ee.t[Ee.p]=Ee.xs0:Ee.setRatio&&Ee.setRatio(Me);Ee=Ee._next}else for(;Ee;)Ee.type!==2?Ee.t[Ee.p]=Ee.b:Ee.setRatio(Me),Ee=Ee._next},D._enableTransforms=function(Me){this._transform=this._transform||bn(this._target,w,!0),this._transformType=!(this._transform.svg&&wo)&&(Me||this._transformType===3)?3:2};var Hn=function(Me){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};D._addLazySet=function(Me,Ee,We){var it=this._firstPT=new Pe(Me,Ee,0,0,this._firstPT,2);it.e=We,it.setRatio=Hn,it.data=this},D._linkCSSP=function(Me,Ee,We,it){return Me&&(Ee&&(Ee._prev=Me),Me._next&&(Me._next._prev=Me._prev),Me._prev?Me._prev._next=Me._next:this._firstPT===Me&&(this._firstPT=Me._next,it=!0),We?We._next=Me:!it&&this._firstPT===null&&(this._firstPT=Me),Me._next=Ee,Me._prev=We),Me},D._mod=function(Me){for(var Ee=this._firstPT;Ee;)typeof Me[Ee.p]=="function"&&(Ee.r=Me[Ee.p]),Ee=Ee._next},D._kill=function(Me){var Ee=Me,We,it,je;if(Me.autoAlpha||Me.alpha){Ee={};for(it in Me)Ee[it]=Me[it];Ee.opacity=1,Ee.autoAlpha&&(Ee.visibility=1)}for(Me.className&&(We=this._classNamePT)&&(je=We.xfirst,je&&je._prev?this._linkCSSP(je._prev,We._next,je._prev._prev):je===this._firstPT&&(this._firstPT=We._next),We._next&&this._linkCSSP(We._next,We._next._next,je._prev),this._classNamePT=null),We=this._firstPT;We;)We.plugin&&We.plugin!==it&&We.plugin._kill&&(We.plugin._kill(Me),it=We.plugin),We=We._next;return u.prototype._kill.call(this,Ee)};var Ni=function(Me,Ee,We){var it,je,_t,qe;if(Me.slice){for(je=Me.length;--je>-1;)Ni(Me[je],Ee,We);return}for(it=Me.childNodes,je=it.length;--je>-1;)_t=it[je],qe=_t.type,_t.style&&(Ee.push(Bn(_t)),We&&We.push(_t)),(qe===1||qe===9||qe===11)&&_t.childNodes.length&&Ni(_t,Ee,We)};return i.cascadeTo=function(Me,Ee,We){var it=r.to(Me,Ee,We),je=[it],_t=[],qe=[],lt=[],Nt=r._internals.reservedProps,cn,Xt,In,Ut;for(Me=it._targets||it.target,Ni(Me,_t,lt),it.render(Ee,!0,!0),Ni(Me,qe),it.render(0,!0,!0),it._enabled(!0),cn=lt.length;--cn>-1;)if(Xt=de(lt[cn],_t[cn],qe[cn]),Xt.firstMPT){Xt=Xt.difs;for(In in We)Nt[In]&&(Xt[In]=We[In]);Ut={};for(In in Xt)Ut[In]=_t[cn][In];je.push(r.fromTo(lt[cn],Ee,Ut,Xt))}return je},u.activate([i]),i},!0),function(){var u=_gsScope._gsDefine.plugin({propName:"roundProps",version:"1.7.0",priority:-1,API:2,init:function(_,A,w){return this._tween=w,!0}}),r=function(_){var A=_<1?Math.pow(10,(_+"").length-2):1;return function(w){return(Math.round(w/_)*_*A|0)/A}},i=function(_,A){for(;_;)!_.f&&!_.blob&&(_.m=A||Math.round),_=_._next},m=u.prototype;m._onInitAllProps=function(){var _=this._tween,A=_.vars.roundProps,w={},T=_._propLookup.roundProps,R,D,U,k;if(typeof A=="object"&&!A.push)for(k in A)w[k]=r(A[k]);else for(typeof A=="string"&&(A=A.split(",")),U=A.length;--U>-1;)w[A[U]]=Math.round;for(k in w)for(R=_._firstPT;R;)D=R._next,R.pg?R.t._mod(w):R.n===k&&(R.f===2&&R.t?i(R.t._firstPT,w[k]):(this._add(R.t,k,R.s,R.c,w[k]),D&&(D._prev=R._prev),R._prev?R._prev._next=D:_._firstPT===R&&(_._firstPT=D),R._next=R._prev=null,_._propLookup[k]=T)),R=D;return!1},m._add=function(_,A,w,T,R){this._addTween(_,A,w,w+T,A,R||Math.round),this._overwriteProps.push(A)}}(),function(){_gsScope._gsDefine.plugin({propName:"attr",API:2,version:"0.6.1",init:function(u,r,i,m){var _,A;if(typeof u.setAttribute!="function")return!1;for(_ in r)A=r[_],typeof A=="function"&&(A=A(m,u)),this._addTween(u,"setAttribute",u.getAttribute(_)+"",A+"",_,!1,_),this._overwriteProps.push(_);return!0}})}(),_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.3.1",API:2,init:function(u,r,i,m){typeof r!="object"&&(r={rotation:r}),this.finals={};var _=r.useRadians===!0?Math.PI*2:360,A=1e-6,w,T,R,D,U,k;for(w in r)w!=="useRadians"&&(D=r[w],typeof D=="function"&&(D=D(m,u)),k=(D+"").split("_"),T=k[0],R=parseFloat(typeof u[w]!="function"?u[w]:u[w.indexOf("set")||typeof u["get"+w.substr(3)]!="function"?w:"get"+w.substr(3)]()),D=this.finals[w]=typeof T=="string"&&T.charAt(1)==="="?R+parseInt(T.charAt(0)+"1",10)*Number(T.substr(2)):Number(T)||0,U=D-R,k.length&&(T=k.join("_"),T.indexOf("short")!==-1&&(U=U%_,U!==U%(_/2)&&(U=U<0?U+_:U-_)),T.indexOf("_cw")!==-1&&U<0?U=(U+_*9999999999)%_-(U/_|0)*_:T.indexOf("ccw")!==-1&&U>0&&(U=(U-_*9999999999)%_-(U/_|0)*_)),(U>A||U<-A)&&(this._addTween(u,w,R,R+U,w),this._overwriteProps.push(w)));return!0},set:function(u){var r;if(u!==1)this._super.setRatio.call(this,u);else for(r=this._firstPT;r;)r.f?r.t[r.p](this.finals[r.p]):r.t[r.p]=this.finals[r.p],r=r._next}})._autoCSS=!0,_gsScope._gsDefine("easing.Back",["easing.Ease"],function(u){var r=_gsScope.GreenSockGlobals||_gsScope,i=r.com.greensock,m=Math.PI*2,_=Math.PI/2,A=i._class,w=function(V,z){var ce=A("easing."+V,function(){},!0),ue=ce.prototype=new u;return ue.constructor=ce,ue.getRatio=z,ce},T=u.register||function(){},R=function(V,z,ce,ue,he){var K=A("easing."+V,{easeOut:new z,easeIn:new ce,easeInOut:new ue},!0);return T(K,V),K},D=function(V,z,ce){this.t=V,this.v=z,ce&&(this.next=ce,ce.prev=this,this.c=ce.v-z,this.gap=ce.t-V)},U=function(V,z){var ce=A("easing."+V,function(he){this._p1=he||he===0?he:1.70158,this._p2=this._p1*1.525},!0),ue=ce.prototype=new u;return ue.constructor=ce,ue.getRatio=z,ue.config=function(he){return new ce(he)},ce},k=R("Back",U("BackOut",function(V){return(V=V-1)*V*((this._p1+1)*V+this._p1)+1}),U("BackIn",function(V){return V*V*((this._p1+1)*V-this._p1)}),U("BackInOut",function(V){return(V*=2)<1?.5*V*V*((this._p2+1)*V-this._p2):.5*((V-=2)*V*((this._p2+1)*V+this._p2)+2)})),X=A("easing.SlowMo",function(V,z,ce){z=z||z===0?z:.7,V==null?V=.7:V>1&&(V=1),this._p=V!==1?z:0,this._p1=(1-V)/2,this._p2=V,this._p3=this._p1+this._p2,this._calcEnd=ce===!0},!0),J=X.prototype=new u,$,oe,ne,H;return J.constructor=X,J.getRatio=function(V){var z=V+(.5-V)*this._p;return V<this._p1?this._calcEnd?1-(V=1-V/this._p1)*V:z-(V=1-V/this._p1)*V*V*V*z:V>this._p3?this._calcEnd?V===1?0:1-(V=(V-this._p3)/this._p1)*V:z+(V-z)*(V=(V-this._p3)/this._p1)*V*V*V:this._calcEnd?1:z},X.ease=new X(.7,.7),J.config=X.config=function(V,z,ce){return new X(V,z,ce)},$=A("easing.SteppedEase",function(V,z){V=V||1,this._p1=1/V,this._p2=V+(z?0:1),this._p3=z?1:0},!0),J=$.prototype=new u,J.constructor=$,J.getRatio=function(V){return V<0?V=0:V>=1&&(V=.999999999),((this._p2*V|0)+this._p3)*this._p1},J.config=$.config=function(V,z){return new $(V,z)},oe=A("easing.ExpoScaleEase",function(V,z,ce){this._p1=Math.log(z/V),this._p2=z-V,this._p3=V,this._ease=ce},!0),J=oe.prototype=new u,J.constructor=oe,J.getRatio=function(V){return this._ease&&(V=this._ease.getRatio(V)),(this._p3*Math.exp(this._p1*V)-this._p3)/this._p2},J.config=oe.config=function(V,z,ce){return new oe(V,z,ce)},ne=A("easing.RoughEase",function(V){V=V||{};for(var z=V.taper||"none",ce=[],ue=0,he=(V.points||20)|0,K=he,Y=V.randomize!==!1,ie=V.clamp===!0,ve=V.template instanceof u?V.template:null,re=typeof V.strength=="number"?V.strength*.4:.4,ae,me,ye,Te,ke,Fe;--K>-1;)ae=Y?Math.random():1/he*K,me=ve?ve.getRatio(ae):ae,z==="none"?ye=re:z==="out"?(Te=1-ae,ye=Te*Te*re):z==="in"?ye=ae*ae*re:ae<.5?(Te=ae*2,ye=Te*Te*.5*re):(Te=(1-ae)*2,ye=Te*Te*.5*re),Y?me+=Math.random()*ye-ye*.5:K%2?me+=ye*.5:me-=ye*.5,ie&&(me>1?me=1:me<0&&(me=0)),ce[ue++]={x:ae,y:me};for(ce.sort(function(Ve,ot){return Ve.x-ot.x}),Fe=new D(1,1,null),K=he;--K>-1;)ke=ce[K],Fe=new D(ke.x,ke.y,Fe);this._prev=new D(0,0,Fe.t!==0?Fe:Fe.next)},!0),J=ne.prototype=new u,J.constructor=ne,J.getRatio=function(V){var z=this._prev;if(V>z.t){for(;z.next&&V>=z.t;)z=z.next;z=z.prev}else for(;z.prev&&V<=z.t;)z=z.prev;return this._prev=z,z.v+(V-z.t)/z.gap*z.c},J.config=function(V){return new ne(V)},ne.ease=new ne,R("Bounce",w("BounceOut",function(V){return V<1/2.75?7.5625*V*V:V<2/2.75?7.5625*(V-=1.5/2.75)*V+.75:V<2.5/2.75?7.5625*(V-=2.25/2.75)*V+.9375:7.5625*(V-=2.625/2.75)*V+.984375}),w("BounceIn",function(V){return(V=1-V)<1/2.75?1-7.5625*V*V:V<2/2.75?1-(7.5625*(V-=1.5/2.75)*V+.75):V<2.5/2.75?1-(7.5625*(V-=2.25/2.75)*V+.9375):1-(7.5625*(V-=2.625/2.75)*V+.984375)}),w("BounceInOut",function(V){var z=V<.5;return z?V=1-V*2:V=V*2-1,V<1/2.75?V=7.5625*V*V:V<2/2.75?V=7.5625*(V-=1.5/2.75)*V+.75:V<2.5/2.75?V=7.5625*(V-=2.25/2.75)*V+.9375:V=7.5625*(V-=2.625/2.75)*V+.984375,z?(1-V)*.5:V*.5+.5})),R("Circ",w("CircOut",function(V){return Math.sqrt(1-(V=V-1)*V)}),w("CircIn",function(V){return-(Math.sqrt(1-V*V)-1)}),w("CircInOut",function(V){return(V*=2)<1?-.5*(Math.sqrt(1-V*V)-1):.5*(Math.sqrt(1-(V-=2)*V)+1)})),H=function(V,z,ce){var ue=A("easing."+V,function(K,Y){this._p1=K>=1?K:1,this._p2=(Y||ce)/(K<1?K:1),this._p3=this._p2/m*(Math.asin(1/this._p1)||0),this._p2=m/this._p2},!0),he=ue.prototype=new u;return he.constructor=ue,he.getRatio=z,he.config=function(K,Y){return new ue(K,Y)},ue},R("Elastic",H("ElasticOut",function(V){return this._p1*Math.pow(2,-10*V)*Math.sin((V-this._p3)*this._p2)+1},.3),H("ElasticIn",function(V){return-(this._p1*Math.pow(2,10*(V-=1))*Math.sin((V-this._p3)*this._p2))},.3),H("ElasticInOut",function(V){return(V*=2)<1?-.5*(this._p1*Math.pow(2,10*(V-=1))*Math.sin((V-this._p3)*this._p2)):this._p1*Math.pow(2,-10*(V-=1))*Math.sin((V-this._p3)*this._p2)*.5+1},.45)),R("Expo",w("ExpoOut",function(V){return 1-Math.pow(2,-10*V)}),w("ExpoIn",function(V){return Math.pow(2,10*(V-1))-.001}),w("ExpoInOut",function(V){return(V*=2)<1?.5*Math.pow(2,10*(V-1)):.5*(2-Math.pow(2,-10*(V-1)))})),R("Sine",w("SineOut",function(V){return Math.sin(V*_)}),w("SineIn",function(V){return-Math.cos(V*_)+1}),w("SineInOut",function(V){return-.5*(Math.cos(Math.PI*V)-1)})),A("easing.EaseLookup",{find:function(V){return u.map[V]}},!0),T(r.SlowMo,"SlowMo","ease,"),T(ne,"RoughEase","ease,"),T($,"SteppedEase","ease,"),k},!0)});_gsScope._gsDefine&&_gsScope._gsQueue.pop()();(function(u,r){var i={},m=u.document,_=u.GreenSockGlobals=u.GreenSockGlobals||u,A=_[r];if(A)return typeof module<"u"&&module.exports&&(module.exports=A),A;var w=function(de){var Ae=de.split("."),Le=_,Oe;for(Oe=0;Oe<Ae.length;Oe++)Le[Ae[Oe]]=Le=Le[Ae[Oe]]||{};return Le},T=w("com.greensock"),R=1e-8,D=function(de){var Ae=[],Le=de.length,Oe;for(Oe=0;Oe!==Le;Ae.push(de[Oe++]));return Ae},U=function(){},k=function(){var de=Object.prototype.toString,Ae=de.call([]);return function(Le){return Le!=null&&(Le instanceof Array||typeof Le=="object"&&!!Le.push&&de.call(Le)===Ae)}}(),X,J,$,oe,ne,H={},V=function(de,Ae,Le,Oe){this.sc=H[de]?H[de].sc:[],H[de]=this,this.gsClass=null,this.func=Le;var $e=[];this.check=function(pt){for(var Mt=Ae.length,Bt=Mt,xt,ht,zt,dn;--Mt>-1;)(xt=H[Ae[Mt]]||new V(Ae[Mt],[])).gsClass?($e[Mt]=xt.gsClass,Bt--):pt&&xt.sc.push(this);if(Bt===0&&Le){if(ht=("com.greensock."+de).split("."),zt=ht.pop(),dn=w(ht.join("."))[zt]=this.gsClass=Le.apply(Le,$e),Oe)if(_[zt]=i[zt]=dn,typeof module<"u"&&module.exports)if(de===r){module.exports=i[r]=dn;for(Mt in i)dn[Mt]=i[Mt]}else i[r]&&(i[r][zt]=dn);else typeof define=="function"&&define.amd&&define((u.GreenSockAMDPath?u.GreenSockAMDPath+"/":"")+de.split(".").pop(),[],function(){return dn});for(Mt=0;Mt<this.sc.length;Mt++)this.sc[Mt].check()}},this.check(!0)},z=u._gsDefine=function(de,Ae,Le,Oe){return new V(de,Ae,Le,Oe)},ce=T._class=function(de,Ae,Le){return Ae=Ae||function(){},z(de,[],function(){return Ae},Le),Ae};z.globals=_;var ue=[0,0,1,1],he=ce("easing.Ease",function(de,Ae,Le,Oe){this._func=de,this._type=Le||0,this._power=Oe||0,this._params=Ae?ue.concat(Ae):ue},!0),K=he.map={},Y=he.register=function(de,Ae,Le,Oe){for(var $e=Ae.split(","),pt=$e.length,Mt=(Le||"easeIn,easeOut,easeInOut").split(","),Bt,xt,ht,zt;--pt>-1;)for(xt=$e[pt],Bt=Oe?ce("easing."+xt,null,!0):T.easing[xt]||{},ht=Mt.length;--ht>-1;)zt=Mt[ht],K[xt+"."+zt]=K[zt+xt]=Bt[zt]=de.getRatio?de:de[zt]||new de};for($=he.prototype,$._calcEnd=!1,$.getRatio=function(de){if(this._func)return this._params[0]=de,this._func.apply(null,this._params);var Ae=this._type,Le=this._power,Oe=Ae===1?1-de:Ae===2?de:de<.5?de*2:(1-de)*2;return Le===1?Oe*=Oe:Le===2?Oe*=Oe*Oe:Le===3?Oe*=Oe*Oe*Oe:Le===4&&(Oe*=Oe*Oe*Oe*Oe),Ae===1?1-Oe:Ae===2?Oe:de<.5?Oe/2:1-Oe/2},X=["Linear","Quad","Cubic","Quart","Quint,Strong"],J=X.length;--J>-1;)$=X[J]+",Power"+J,Y(new he(null,null,1,J),$,"easeOut",!0),Y(new he(null,null,2,J),$,"easeIn"+(J===0?",easeNone":"")),Y(new he(null,null,3,J),$,"easeInOut");K.linear=T.easing.Linear.easeIn,K.swing=T.easing.Quad.easeInOut;var ie=ce("events.EventDispatcher",function(de){this._listeners={},this._eventTarget=de||this});$=ie.prototype,$.addEventListener=function(de,Ae,Le,Oe,$e){$e=$e||0;var pt=this._listeners[de],Mt=0,Bt,xt;for(this===oe&&!ne&&oe.wake(),pt==null&&(this._listeners[de]=pt=[]),xt=pt.length;--xt>-1;)Bt=pt[xt],Bt.c===Ae&&Bt.s===Le?pt.splice(xt,1):Mt===0&&Bt.pr<$e&&(Mt=xt+1);pt.splice(Mt,0,{c:Ae,s:Le,up:Oe,pr:$e})},$.removeEventListener=function(de,Ae){var Le=this._listeners[de],Oe;if(Le){for(Oe=Le.length;--Oe>-1;)if(Le[Oe].c===Ae){Le.splice(Oe,1);return}}},$.dispatchEvent=function(de){var Ae=this._listeners[de],Le,Oe,$e;if(Ae)for(Le=Ae.length,Le>1&&(Ae=Ae.slice(0)),Oe=this._eventTarget;--Le>-1;)$e=Ae[Le],$e&&($e.up?$e.c.call($e.s||Oe,{type:de,target:Oe}):$e.c.call($e.s||Oe))};var ve=u.requestAnimationFrame,re=u.cancelAnimationFrame,ae=Date.now||function(){return new Date().getTime()},me=ae();for(X=["ms","moz","webkit","o"],J=X.length;--J>-1&&!ve;)ve=u[X[J]+"RequestAnimationFrame"],re=u[X[J]+"CancelAnimationFrame"]||u[X[J]+"CancelRequestAnimationFrame"];ce("Ticker",function(de,Ae){var Le=this,Oe=ae(),$e=Ae!==!1&&ve?"auto":!1,pt=500,Mt=33,Bt="tick",xt,ht,zt,dn,en,xn=function(wi){var Gi=ae()-me,Pe,oi;Gi>pt&&(Oe+=Gi-Mt),me+=Gi,Le.time=(me-Oe)/1e3,Pe=Le.time-en,(!xt||Pe>0||wi===!0)&&(Le.frame++,en+=Pe+(Pe>=dn?.004:dn-Pe),oi=!0),wi!==!0&&(zt=ht(xn)),oi&&Le.dispatchEvent(Bt)};ie.call(Le),Le.time=Le.frame=0,Le.tick=function(){xn(!0)},Le.lagSmoothing=function(wi,Gi){if(!arguments.length)return pt<1/R;pt=wi||1/R,Mt=Math.min(Gi,pt,0)},Le.sleep=function(){zt!=null&&(!$e||!re?clearTimeout(zt):re(zt),ht=U,zt=null,Le===oe&&(ne=!1))},Le.wake=function(wi){zt!==null?Le.sleep():wi?Oe+=-me+(me=ae()):Le.frame>10&&(me=ae()-pt+5),ht=xt===0?U:!$e||!ve?function(Gi){return setTimeout(Gi,(en-Le.time)*1e3+1|0)}:ve,Le===oe&&(ne=!0),xn(2)},Le.fps=function(wi){if(!arguments.length)return xt;xt=wi,dn=1/(xt||60),en=this.time+dn,Le.wake()},Le.useRAF=function(wi){if(!arguments.length)return $e;Le.sleep(),$e=wi,Le.fps(xt)},Le.fps(de),setTimeout(function(){$e==="auto"&&Le.frame<5&&(m||{}).visibilityState!=="hidden"&&Le.useRAF(!1)},1500)}),$=T.Ticker.prototype=new T.events.EventDispatcher,$.constructor=T.Ticker;var ye=ce("core.Animation",function(de,Ae){if(this.vars=Ae=Ae||{},this._duration=this._totalDuration=de||0,this._delay=Number(Ae.delay)||0,this._timeScale=1,this._active=!!Ae.immediateRender,this.data=Ae.data,this._reversed=!!Ae.reversed,!!jt){ne||oe.wake();var Le=this.vars.useFrames?Lt:jt;Le.add(this,Le._time),this.vars.paused&&this.paused(!0)}});oe=ye.ticker=new T.Ticker,$=ye.prototype,$._dirty=$._gc=$._initted=$._paused=!1,$._totalTime=$._time=0,$._rawPrevTime=-1,$._next=$._last=$._onUpdate=$._timeline=$.timeline=null,$._paused=!1;var Te=function(){ne&&ae()-me>2e3&&((m||{}).visibilityState!=="hidden"||!oe.lagSmoothing())&&oe.wake();var de=setTimeout(Te,2e3);de.unref&&de.unref()};Te(),$.play=function(de,Ae){return de!=null&&this.seek(de,Ae),this.reversed(!1).paused(!1)},$.pause=function(de,Ae){return de!=null&&this.seek(de,Ae),this.paused(!0)},$.resume=function(de,Ae){return de!=null&&this.seek(de,Ae),this.paused(!1)},$.seek=function(de,Ae){return this.totalTime(Number(de),Ae!==!1)},$.restart=function(de,Ae){return this.reversed(!1).paused(!1).totalTime(de?-this._delay:0,Ae!==!1,!0)},$.reverse=function(de,Ae){return de!=null&&this.seek(de||this.totalDuration(),Ae),this.reversed(!0).paused(!1)},$.render=function(de,Ae,Le){},$.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},$.isActive=function(){var de=this._timeline,Ae=this._startTime,Le;return!de||!this._gc&&!this._paused&&de.isActive()&&(Le=de.rawTime(!0))>=Ae&&Le<Ae+this.totalDuration()/this._timeScale-R},$._enabled=function(de,Ae){return ne||oe.wake(),this._gc=!de,this._active=this.isActive(),Ae!==!0&&(de&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!de&&this.timeline&&this._timeline._remove(this,!0)),!1},$._kill=function(de,Ae){return this._enabled(!1,!1)},$.kill=function(de,Ae){return this._kill(de,Ae),this},$._uncache=function(de){for(var Ae=de?this:this.timeline;Ae;)Ae._dirty=!0,Ae=Ae.timeline;return this},$._swapSelfInParams=function(de){for(var Ae=de.length,Le=de.concat();--Ae>-1;)de[Ae]==="{self}"&&(Le[Ae]=this);return Le},$._callback=function(de){var Ae=this.vars,Le=Ae[de],Oe=Ae[de+"Params"],$e=Ae[de+"Scope"]||Ae.callbackScope||this,pt=Oe?Oe.length:0;switch(pt){case 0:Le.call($e);break;case 1:Le.call($e,Oe[0]);break;case 2:Le.call($e,Oe[0],Oe[1]);break;default:Le.apply($e,Oe)}},$.eventCallback=function(de,Ae,Le,Oe){if((de||"").substr(0,2)==="on"){var $e=this.vars;if(arguments.length===1)return $e[de];Ae==null?delete $e[de]:($e[de]=Ae,$e[de+"Params"]=k(Le)&&Le.join("").indexOf("{self}")!==-1?this._swapSelfInParams(Le):Le,$e[de+"Scope"]=Oe),de==="onUpdate"&&(this._onUpdate=Ae)}return this},$.delay=function(de){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+de-this._delay),this._delay=de,this):this._delay},$.duration=function(de){return arguments.length?(this._duration=this._totalDuration=de,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&de!==0&&this.totalTime(this._totalTime*(de/this._duration),!0),this):(this._dirty=!1,this._duration)},$.totalDuration=function(de){return this._dirty=!1,arguments.length?this.duration(de):this._totalDuration},$.time=function(de,Ae){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(de>this._duration?this._duration:de,Ae)):this._time},$.totalTime=function(de,Ae,Le){if(ne||oe.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(de<0&&!Le&&(de+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var Oe=this._totalDuration,$e=this._timeline;if(de>Oe&&!Le&&(de=Oe),this._startTime=(this._paused?this._pauseTime:$e._time)-(this._reversed?Oe-de:de)/this._timeScale,$e._dirty||this._uncache(!1),$e._timeline)for(;$e._timeline;)$e._timeline._time!==($e._startTime+$e._totalTime)/$e._timeScale&&$e.totalTime($e._totalTime,!0),$e=$e._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==de||this._duration===0)&&(Ye.length&&fn(),this.render(de,Ae,!1),Ye.length&&fn())}return this},$.progress=$.totalProgress=function(de,Ae){var Le=this.duration();return arguments.length?this.totalTime(Le*de,Ae):Le?this._time/Le:this.ratio},$.startTime=function(de){return arguments.length?(de!==this._startTime&&(this._startTime=de,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,de-this._delay)),this):this._startTime},$.endTime=function(de){return this._startTime+(de!=!1?this.totalDuration():this.duration())/this._timeScale},$.timeScale=function(de){if(!arguments.length)return this._timeScale;var Ae,Le;for(de=de||R,this._timeline&&this._timeline.smoothChildTiming&&(Ae=this._pauseTime,Le=Ae||Ae===0?Ae:this._timeline.totalTime(),this._startTime=Le-(Le-this._startTime)*this._timeScale/de),this._timeScale=de,Le=this.timeline;Le&&Le.timeline;)Le._dirty=!0,Le.totalDuration(),Le=Le.timeline;return this},$.reversed=function(de){return arguments.length?(de!=this._reversed&&(this._reversed=de,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},$.paused=function(de){if(!arguments.length)return this._paused;var Ae=this._timeline,Le,Oe;return de!=this._paused&&Ae&&(!ne&&!de&&oe.wake(),Le=Ae.rawTime(),Oe=Le-this._pauseTime,!de&&Ae.smoothChildTiming&&(this._startTime+=Oe,this._uncache(!1)),this._pauseTime=de?Le:null,this._paused=de,this._active=this.isActive(),!de&&Oe!==0&&this._initted&&this.duration()&&(Le=Ae.smoothChildTiming?this._totalTime:(Le-this._startTime)/this._timeScale,this.render(Le,Le===this._totalTime,!0))),this._gc&&!de&&this._enabled(!0,!1),this};var ke=ce("core.SimpleTimeline",function(de){ye.call(this,0,de),this.autoRemoveChildren=this.smoothChildTiming=!0});$=ke.prototype=new ye,$.constructor=ke,$.kill()._gc=!1,$._first=$._last=$._recent=null,$._sortChildren=!1,$.add=$.insert=function(de,Ae,Le,Oe){var $e,pt;if(de._startTime=Number(Ae||0)+de._delay,de._paused&&this!==de._timeline&&(de._pauseTime=this.rawTime()-(de._timeline.rawTime()-de._pauseTime)),de.timeline&&de.timeline._remove(de,!0),de.timeline=de._timeline=this,de._gc&&de._enabled(!0,!0),$e=this._last,this._sortChildren)for(pt=de._startTime;$e&&$e._startTime>pt;)$e=$e._prev;return $e?(de._next=$e._next,$e._next=de):(de._next=this._first,this._first=de),de._next?de._next._prev=de:this._last=de,de._prev=$e,this._recent=de,this._timeline&&this._uncache(!0),this},$._remove=function(de,Ae){return de.timeline===this&&(Ae||de._enabled(!1,!0),de._prev?de._prev._next=de._next:this._first===de&&(this._first=de._next),de._next?de._next._prev=de._prev:this._last===de&&(this._last=de._prev),de._next=de._prev=de.timeline=null,de===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},$.render=function(de,Ae,Le){var Oe=this._first,$e;for(this._totalTime=this._time=this._rawPrevTime=de;Oe;)$e=Oe._next,(Oe._active||de>=Oe._startTime&&!Oe._paused&&!Oe._gc)&&(Oe._reversed?Oe.render((Oe._dirty?Oe.totalDuration():Oe._totalDuration)-(de-Oe._startTime)*Oe._timeScale,Ae,Le):Oe.render((de-Oe._startTime)*Oe._timeScale,Ae,Le)),Oe=$e},$.rawTime=function(){return ne||oe.wake(),this._totalTime};var Fe=ce("TweenLite",function(de,Ae,Le){if(ye.call(this,Ae,Le),this.render=Fe.prototype.render,de==null)throw"Cannot tween a null target.";this.target=de=typeof de!="string"?de:Fe.selector(de)||de;var Oe=de.jquery||de.length&&de!==u&&de[0]&&(de[0]===u||de[0].nodeType&&de[0].style&&!de.nodeType),$e=this.vars.overwrite,pt,Mt,Bt;if(this._overwrite=$e=$e==null?St[Fe.defaultOverwrite]:typeof $e=="number"?$e>>0:St[$e],(Oe||de instanceof Array||de.push&&k(de))&&typeof de[0]!="number")for(this._targets=Bt=D(de),this._propLookup=[],this._siblings=[],pt=0;pt<Bt.length;pt++){if(Mt=Bt[pt],Mt){if(typeof Mt=="string"){Mt=Bt[pt--]=Fe.selector(Mt),typeof Mt=="string"&&Bt.splice(pt+1,1);continue}else if(Mt.length&&Mt!==u&&Mt[0]&&(Mt[0]===u||Mt[0].nodeType&&Mt[0].style&&!Mt.nodeType)){Bt.splice(pt--,1),this._targets=Bt=Bt.concat(D(Mt));continue}}else{Bt.splice(pt--,1);continue}this._siblings[pt]=hn(Mt,this,!1),$e===1&&this._siblings[pt].length>1&&An(Mt,this,null,1,this._siblings[pt])}else this._propLookup={},this._siblings=hn(de,this,!1),$e===1&&this._siblings.length>1&&An(de,this,null,1,this._siblings);(this.vars.immediateRender||Ae===0&&this._delay===0&&this.vars.immediateRender!==!1)&&(this._time=-R,this.render(Math.min(0,-this._delay)))},!0),Ve=function(de){return de&&de.length&&de!==u&&de[0]&&(de[0]===u||de[0].nodeType&&de[0].style&&!de.nodeType)},ot=function(de,Ae){var Le={},Oe;for(Oe in de)!Ue[Oe]&&(!(Oe in Ae)||Oe==="transform"||Oe==="x"||Oe==="y"||Oe==="width"||Oe==="height"||Oe==="className"||Oe==="border")&&(!nn[Oe]||nn[Oe]&&nn[Oe]._autoCSS)&&(Le[Oe]=de[Oe],delete de[Oe]);de.css=Le};$=Fe.prototype=new ye,$.constructor=Fe,$.kill()._gc=!1,$.ratio=0,$._firstPT=$._targets=$._overwrittenProps=$._startAt=null,$._notifyPluginsOfEnabled=$._lazy=!1,Fe.version="2.1.3",Fe.defaultEase=$._ease=new he(null,null,1,1),Fe.defaultOverwrite="auto",Fe.ticker=oe,Fe.autoSleep=120,Fe.lagSmoothing=function(de,Ae){oe.lagSmoothing(de,Ae)},Fe.selector=u.$||u.jQuery||function(de){var Ae=u.$||u.jQuery;return Ae?(Fe.selector=Ae,Ae(de)):(m||(m=u.document),m?m.querySelectorAll?m.querySelectorAll(de):m.getElementById(de.charAt(0)==="#"?de.substr(1):de):de)};var Ye=[],Ze={},tt=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,Pt=/[\+-]=-?[\.\d]/,Et=function(de){for(var Ae=this._firstPT,Le=1e-6,Oe;Ae;)Oe=Ae.blob?de===1&&this.end!=null?this.end:de?this.join(""):this.start:Ae.c*de+Ae.s,Ae.m?Oe=Ae.m.call(this._tween,Oe,this._target||Ae.t,this._tween):Oe<Le&&Oe>-Le&&!Ae.blob&&(Oe=0),Ae.f?Ae.fp?Ae.t[Ae.p](Ae.fp,Oe):Ae.t[Ae.p](Oe):Ae.t[Ae.p]=Oe,Ae=Ae._next},Ne=function(de){return(de*1e3|0)/1e3+""},et=function(de,Ae,Le,Oe){var $e=[],pt=0,Mt="",Bt=0,xt,ht,zt,dn,en,xn,wi;for($e.start=de,$e.end=Ae,de=$e[0]=de+"",Ae=$e[1]=Ae+"",Le&&(Le($e),de=$e[0],Ae=$e[1]),$e.length=0,xt=de.match(tt)||[],ht=Ae.match(tt)||[],Oe&&(Oe._next=null,Oe.blob=1,$e._firstPT=$e._applyPT=Oe),en=ht.length,dn=0;dn<en;dn++)wi=ht[dn],xn=Ae.substr(pt,Ae.indexOf(wi,pt)-pt),Mt+=xn||!dn?xn:",",pt+=xn.length,Bt?Bt=(Bt+1)%5:xn.substr(-5)==="rgba("&&(Bt=1),wi===xt[dn]||xt.length<=dn?Mt+=wi:(Mt&&($e.push(Mt),Mt=""),zt=parseFloat(xt[dn]),$e.push(zt),$e._firstPT={_next:$e._firstPT,t:$e,p:$e.length-1,s:zt,c:(wi.charAt(1)==="="?parseInt(wi.charAt(0)+"1",10)*parseFloat(wi.substr(2)):parseFloat(wi)-zt)||0,f:0,m:Bt&&Bt<4?Math.round:Ne}),pt+=wi.length;return Mt+=Ae.substr(pt),Mt&&$e.push(Mt),$e.setRatio=Et,Pt.test(Ae)&&($e.end=null),$e},wt=function(de,Ae,Le,Oe,$e,pt,Mt,Bt,xt){typeof Oe=="function"&&(Oe=Oe(xt||0,de));var ht=typeof de[Ae],zt=ht!=="function"?"":Ae.indexOf("set")||typeof de["get"+Ae.substr(3)]!="function"?Ae:"get"+Ae.substr(3),dn=Le!=="get"?Le:zt?Mt?de[zt](Mt):de[zt]():de[Ae],en=typeof Oe=="string"&&Oe.charAt(1)==="=",xn={t:de,p:Ae,s:dn,f:ht==="function",pg:0,n:$e||Ae,m:pt?typeof pt=="function"?pt:Math.round:0,pr:0,c:en?parseInt(Oe.charAt(0)+"1",10)*parseFloat(Oe.substr(2)):parseFloat(Oe)-dn||0},wi;if((typeof dn!="number"||typeof Oe!="number"&&!en)&&(Mt||isNaN(dn)||!en&&isNaN(Oe)||typeof dn=="boolean"||typeof Oe=="boolean"?(xn.fp=Mt,wi=et(dn,en?parseFloat(xn.s)+xn.c+(xn.s+"").replace(/[0-9\-\.]/g,""):Oe,Bt||Fe.defaultStringFilter,xn),xn={t:wi,p:"setRatio",s:0,c:1,f:2,pg:0,n:$e||Ae,pr:0,m:0}):(xn.s=parseFloat(dn),en||(xn.c=parseFloat(Oe)-xn.s||0))),xn.c)return(xn._next=this._firstPT)&&(xn._next._prev=xn),this._firstPT=xn,xn},Zt=Fe._internals={isArray:k,isSelector:Ve,lazyTweens:Ye,blobDif:et},nn=Fe._plugins={},Vn=Zt.tweenLookup={},Jn=0,Ue=Zt.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1,id:1,yoyoEase:1,stagger:1},St={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,true:1,false:0},Lt=ye._rootFramesTimeline=new ke,jt=ye._rootTimeline=new ke,Gt=30,fn=Zt.lazyRender=function(){var de=Ye.length,Ae,Le;for(Ze={},Ae=0;Ae<de;Ae++)Le=Ye[Ae],Le&&Le._lazy!==!1&&(Le.render(Le._lazy[0],Le._lazy[1],!0),Le._lazy=!1);Ye.length=0};jt._startTime=oe.time,Lt._startTime=oe.frame,jt._active=Lt._active=!0,setTimeout(fn,1),ye._updateRoot=Fe.render=function(){var de,Ae,Le;if(Ye.length&&fn(),jt.render((oe.time-jt._startTime)*jt._timeScale,!1,!1),Lt.render((oe.frame-Lt._startTime)*Lt._timeScale,!1,!1),Ye.length&&fn(),oe.frame>=Gt){Gt=oe.frame+(parseInt(Fe.autoSleep,10)||120);for(Le in Vn){for(Ae=Vn[Le].tweens,de=Ae.length;--de>-1;)Ae[de]._gc&&Ae.splice(de,1);Ae.length===0&&delete Vn[Le]}if(Le=jt._first,(!Le||Le._paused)&&Fe.autoSleep&&!Lt._first&&oe._listeners.tick.length===1){for(;Le&&Le._paused;)Le=Le._next;Le||oe.sleep()}}},oe.addEventListener("tick",ye._updateRoot);var hn=function(de,Ae,Le){var Oe=de._gsTweenID,$e,pt;if(Vn[Oe||(de._gsTweenID=Oe="t"+Jn++)]||(Vn[Oe]={target:de,tweens:[]}),Ae&&($e=Vn[Oe].tweens,$e[pt=$e.length]=Ae,Le))for(;--pt>-1;)$e[pt]===Ae&&$e.splice(pt,1);return Vn[Oe].tweens},qt=function(de,Ae,Le,Oe){var $e=de.vars.onOverwrite,pt,Mt;return $e&&(pt=$e(de,Ae,Le,Oe)),$e=Fe.onOverwrite,$e&&(Mt=$e(de,Ae,Le,Oe)),pt!==!1&&Mt!==!1},An=function(de,Ae,Le,Oe,$e){var pt,Mt,Bt,xt;if(Oe===1||Oe>=4){for(xt=$e.length,pt=0;pt<xt;pt++)if((Bt=$e[pt])!==Ae)Bt._gc||Bt._kill(null,de,Ae)&&(Mt=!0);else if(Oe===5)break;return Mt}var ht=Ae._startTime+R,zt=[],dn=0,en=Ae._duration===0,xn;for(pt=$e.length;--pt>-1;)(Bt=$e[pt])===Ae||Bt._gc||Bt._paused||(Bt._timeline!==Ae._timeline?(xn=xn||_n(Ae,0,en),_n(Bt,xn,en)===0&&(zt[dn++]=Bt)):Bt._startTime<=ht&&Bt._startTime+Bt.totalDuration()/Bt._timeScale>ht&&((en||!Bt._initted)&&ht-Bt._startTime<=R*2||(zt[dn++]=Bt)));for(pt=dn;--pt>-1;)if(Bt=zt[pt],xt=Bt._firstPT,Oe===2&&Bt._kill(Le,de,Ae)&&(Mt=!0),Oe!==2||!Bt._firstPT&&Bt._initted&&xt){if(Oe!==2&&!qt(Bt,Ae))continue;Bt._enabled(!1,!1)&&(Mt=!0)}return Mt},_n=function(de,Ae,Le){for(var Oe=de._timeline,$e=Oe._timeScale,pt=de._startTime;Oe._timeline;){if(pt+=Oe._startTime,$e*=Oe._timeScale,Oe._paused)return-100;Oe=Oe._timeline}return pt/=$e,pt>Ae?pt-Ae:Le&&pt===Ae||!de._initted&&pt-Ae<2*R?R:(pt+=de.totalDuration()/de._timeScale/$e)>Ae+R?0:pt-Ae-R};$._init=function(){var de=this.vars,Ae=this._overwrittenProps,Le=this._duration,Oe=!!de.immediateRender,$e=de.ease,pt=this._startAt,Mt,Bt,xt,ht,zt,dn;if(de.startAt){pt&&(pt.render(-1,!0),pt.kill()),zt={};for(ht in de.startAt)zt[ht]=de.startAt[ht];if(zt.data="isStart",zt.overwrite=!1,zt.immediateRender=!0,zt.lazy=Oe&&de.lazy!==!1,zt.startAt=zt.delay=null,zt.onUpdate=de.onUpdate,zt.onUpdateParams=de.onUpdateParams,zt.onUpdateScope=de.onUpdateScope||de.callbackScope||this,this._startAt=Fe.to(this.target||{},0,zt),Oe){if(this._time>0)this._startAt=null;else if(Le!==0)return}}else if(de.runBackwards&&Le!==0)if(pt)pt.render(-1,!0),pt.kill(),this._startAt=null;else{this._time!==0&&(Oe=!1),xt={};for(ht in de)(!Ue[ht]||ht==="autoCSS")&&(xt[ht]=de[ht]);if(xt.overwrite=0,xt.data="isFromStart",xt.lazy=Oe&&de.lazy!==!1,xt.immediateRender=Oe,this._startAt=Fe.to(this.target,0,xt),!Oe)this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null);else if(this._time===0)return}if(this._ease=$e=$e?$e instanceof he?$e:typeof $e=="function"?new he($e,de.easeParams):K[$e]||Fe.defaultEase:Fe.defaultEase,de.easeParams instanceof Array&&$e.config&&(this._ease=$e.config.apply($e,de.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(dn=this._targets.length,Mt=0;Mt<dn;Mt++)this._initProps(this._targets[Mt],this._propLookup[Mt]={},this._siblings[Mt],Ae?Ae[Mt]:null,Mt)&&(Bt=!0);else Bt=this._initProps(this.target,this._propLookup,this._siblings,Ae,0);if(Bt&&Fe._onPluginEvent("_onInitAllProps",this),Ae&&(this._firstPT||typeof this.target!="function"&&this._enabled(!1,!1)),de.runBackwards)for(xt=this._firstPT;xt;)xt.s+=xt.c,xt.c=-xt.c,xt=xt._next;this._onUpdate=de.onUpdate,this._initted=!0},$._initProps=function(de,Ae,Le,Oe,$e){var pt,Mt,Bt,xt,ht,zt;if(de==null)return!1;Ze[de._gsTweenID]&&fn(),this.vars.css||de.style&&de!==u&&de.nodeType&&nn.css&&this.vars.autoCSS!==!1&&ot(this.vars,de);for(pt in this.vars)if(zt=this.vars[pt],Ue[pt])zt&&(zt instanceof Array||zt.push&&k(zt))&&zt.join("").indexOf("{self}")!==-1&&(this.vars[pt]=zt=this._swapSelfInParams(zt,this));else if(nn[pt]&&(xt=new nn[pt])._onInitTween(de,this.vars[pt],this,$e)){for(this._firstPT=ht={_next:this._firstPT,t:xt,p:"setRatio",s:0,c:1,f:1,n:pt,pg:1,pr:xt._priority,m:0},Mt=xt._overwriteProps.length;--Mt>-1;)Ae[xt._overwriteProps[Mt]]=this._firstPT;(xt._priority||xt._onInitAllProps)&&(Bt=!0),(xt._onDisable||xt._onEnable)&&(this._notifyPluginsOfEnabled=!0),ht._next&&(ht._next._prev=ht)}else Ae[pt]=wt.call(this,de,pt,"get",zt,pt,0,null,this.vars.stringFilter,$e);return Oe&&this._kill(Oe,de)?this._initProps(de,Ae,Le,Oe,$e):this._overwrite>1&&this._firstPT&&Le.length>1&&An(de,this,Ae,this._overwrite,Le)?(this._kill(Ae,de),this._initProps(de,Ae,Le,Oe,$e)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(Ze[de._gsTweenID]=!0),Bt)},$.render=function(de,Ae,Le){var Oe=this,$e=Oe._time,pt=Oe._duration,Mt=Oe._rawPrevTime,Bt,xt,ht,zt;if(de>=pt-R&&de>=0)Oe._totalTime=Oe._time=pt,Oe.ratio=Oe._ease._calcEnd?Oe._ease.getRatio(1):1,Oe._reversed||(Bt=!0,xt="onComplete",Le=Le||Oe._timeline.autoRemoveChildren),pt===0&&(Oe._initted||!Oe.vars.lazy||Le)&&(Oe._startTime===Oe._timeline._duration&&(de=0),(Mt<0||de<=0&&de>=-R||Mt===R&&Oe.data!=="isPause")&&Mt!==de&&(Le=!0,Mt>R&&(xt="onReverseComplete")),Oe._rawPrevTime=zt=!Ae||de||Mt===de?de:R);else if(de<R)Oe._totalTime=Oe._time=0,Oe.ratio=Oe._ease._calcEnd?Oe._ease.getRatio(0):0,($e!==0||pt===0&&Mt>0)&&(xt="onReverseComplete",Bt=Oe._reversed),de>-R?de=0:de<0&&(Oe._active=!1,pt===0&&(Oe._initted||!Oe.vars.lazy||Le)&&(Mt>=0&&!(Mt===R&&Oe.data==="isPause")&&(Le=!0),Oe._rawPrevTime=zt=!Ae||de||Mt===de?de:R)),(!Oe._initted||Oe._startAt&&Oe._startAt.progress())&&(Le=!0);else if(Oe._totalTime=Oe._time=de,Oe._easeType){var dn=de/pt,en=Oe._easeType,xn=Oe._easePower;(en===1||en===3&&dn>=.5)&&(dn=1-dn),en===3&&(dn*=2),xn===1?dn*=dn:xn===2?dn*=dn*dn:xn===3?dn*=dn*dn*dn:xn===4&&(dn*=dn*dn*dn*dn),Oe.ratio=en===1?1-dn:en===2?dn:de/pt<.5?dn/2:1-dn/2}else Oe.ratio=Oe._ease.getRatio(de/pt);if(!(Oe._time===$e&&!Le)){if(!Oe._initted){if(Oe._init(),!Oe._initted||Oe._gc)return;if(!Le&&Oe._firstPT&&(Oe.vars.lazy!==!1&&Oe._duration||Oe.vars.lazy&&!Oe._duration)){Oe._time=Oe._totalTime=$e,Oe._rawPrevTime=Mt,Ye.push(Oe),Oe._lazy=[de,Ae];return}Oe._time&&!Bt?Oe.ratio=Oe._ease.getRatio(Oe._time/pt):Bt&&Oe._ease._calcEnd&&(Oe.ratio=Oe._ease.getRatio(Oe._time===0?0:1))}for(Oe._lazy!==!1&&(Oe._lazy=!1),Oe._active||!Oe._paused&&Oe._time!==$e&&de>=0&&(Oe._active=!0),$e===0&&(Oe._startAt&&(de>=0?Oe._startAt.render(de,!0,Le):xt||(xt="_dummyGS")),Oe.vars.onStart&&(Oe._time!==0||pt===0)&&(Ae||Oe._callback("onStart"))),ht=Oe._firstPT;ht;)ht.f?ht.t[ht.p](ht.c*Oe.ratio+ht.s):ht.t[ht.p]=ht.c*Oe.ratio+ht.s,ht=ht._next;Oe._onUpdate&&(de<0&&Oe._startAt&&de!==-1e-4&&Oe._startAt.render(de,!0,Le),Ae||(Oe._time!==$e||Bt||Le)&&Oe._callback("onUpdate")),xt&&(!Oe._gc||Le)&&(de<0&&Oe._startAt&&!Oe._onUpdate&&de!==-1e-4&&Oe._startAt.render(de,!0,Le),Bt&&(Oe._timeline.autoRemoveChildren&&Oe._enabled(!1,!1),Oe._active=!1),!Ae&&Oe.vars[xt]&&Oe._callback(xt),pt===0&&Oe._rawPrevTime===R&&zt!==R&&(Oe._rawPrevTime=0))}},$._kill=function(de,Ae,Le){if(de==="all"&&(de=null),de==null&&(Ae==null||Ae===this.target))return this._lazy=!1,this._enabled(!1,!1);Ae=typeof Ae!="string"?Ae||this._targets||this.target:Fe.selector(Ae)||Ae;var Oe=Le&&this._time&&Le._startTime===this._startTime&&this._timeline===Le._timeline,$e=this._firstPT,pt,Mt,Bt,xt,ht,zt,dn,en,xn;if((k(Ae)||Ve(Ae))&&typeof Ae[0]!="number")for(pt=Ae.length;--pt>-1;)this._kill(de,Ae[pt],Le)&&(zt=!0);else{if(this._targets){for(pt=this._targets.length;--pt>-1;)if(Ae===this._targets[pt]){ht=this._propLookup[pt]||{},this._overwrittenProps=this._overwrittenProps||[],Mt=this._overwrittenProps[pt]=de?this._overwrittenProps[pt]||{}:"all";break}}else{if(Ae!==this.target)return!1;ht=this._propLookup,Mt=this._overwrittenProps=de?this._overwrittenProps||{}:"all"}if(ht){if(dn=de||ht,en=de!==Mt&&Mt!=="all"&&de!==ht&&(typeof de!="object"||!de._tempKill),Le&&(Fe.onOverwrite||this.vars.onOverwrite)){for(Bt in dn)ht[Bt]&&(xn||(xn=[]),xn.push(Bt));if((xn||!de)&&!qt(this,Le,Ae,xn))return!1}for(Bt in dn)(xt=ht[Bt])&&(Oe&&(xt.f?xt.t[xt.p](xt.s):xt.t[xt.p]=xt.s,zt=!0),xt.pg&&xt.t._kill(dn)&&(zt=!0),(!xt.pg||xt.t._overwriteProps.length===0)&&(xt._prev?xt._prev._next=xt._next:xt===this._firstPT&&(this._firstPT=xt._next),xt._next&&(xt._next._prev=xt._prev),xt._next=xt._prev=null),delete ht[Bt]),en&&(Mt[Bt]=1);!this._firstPT&&this._initted&&$e&&this._enabled(!1,!1)}}return zt},$.invalidate=function(){this._notifyPluginsOfEnabled&&Fe._onPluginEvent("_onDisable",this);var de=this._time;return this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],ye.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-R,this.render(de,!1,this.vars.lazy!==!1)),this},$._enabled=function(de,Ae){if(ne||oe.wake(),de&&this._gc){var Le=this._targets,Oe;if(Le)for(Oe=Le.length;--Oe>-1;)this._siblings[Oe]=hn(Le[Oe],this,!0);else this._siblings=hn(this.target,this,!0)}return ye.prototype._enabled.call(this,de,Ae),this._notifyPluginsOfEnabled&&this._firstPT?Fe._onPluginEvent(de?"_onEnable":"_onDisable",this):!1},Fe.to=function(de,Ae,Le){return new Fe(de,Ae,Le)},Fe.from=function(de,Ae,Le){return Le.runBackwards=!0,Le.immediateRender=Le.immediateRender!=!1,new Fe(de,Ae,Le)},Fe.fromTo=function(de,Ae,Le,Oe){return Oe.startAt=Le,Oe.immediateRender=Oe.immediateRender!=!1&&Le.immediateRender!=!1,new Fe(de,Ae,Oe)},Fe.delayedCall=function(de,Ae,Le,Oe,$e){return new Fe(Ae,0,{delay:de,onComplete:Ae,onCompleteParams:Le,callbackScope:Oe,onReverseComplete:Ae,onReverseCompleteParams:Le,immediateRender:!1,lazy:!1,useFrames:$e,overwrite:0})},Fe.set=function(de,Ae){return new Fe(de,0,Ae)},Fe.getTweensOf=function(de,Ae){if(de==null)return[];de=typeof de!="string"?de:Fe.selector(de)||de;var Le,Oe,$e,pt;if((k(de)||Ve(de))&&typeof de[0]!="number"){for(Le=de.length,Oe=[];--Le>-1;)Oe=Oe.concat(Fe.getTweensOf(de[Le],Ae));for(Le=Oe.length;--Le>-1;)for(pt=Oe[Le],$e=Le;--$e>-1;)pt===Oe[$e]&&Oe.splice(Le,1)}else if(de._gsTweenID)for(Oe=hn(de).concat(),Le=Oe.length;--Le>-1;)(Oe[Le]._gc||Ae&&!Oe[Le].isActive())&&Oe.splice(Le,1);return Oe||[]},Fe.killTweensOf=Fe.killDelayedCallsTo=function(de,Ae,Le){typeof Ae=="object"&&(Le=Ae,Ae=!1);for(var Oe=Fe.getTweensOf(de,Ae),$e=Oe.length;--$e>-1;)Oe[$e]._kill(Le,de)};var Bn=ce("plugins.TweenPlugin",function(de,Ae){this._overwriteProps=(de||"").split(","),this._propName=this._overwriteProps[0],this._priority=Ae||0,this._super=Bn.prototype},!0);if($=Bn.prototype,Bn.version="1.19.0",Bn.API=2,$._firstPT=null,$._addTween=wt,$.setRatio=Et,$._kill=function(de){var Ae=this._overwriteProps,Le=this._firstPT,Oe;if(de[this._propName]!=null)this._overwriteProps=[];else for(Oe=Ae.length;--Oe>-1;)de[Ae[Oe]]!=null&&Ae.splice(Oe,1);for(;Le;)de[Le.n]!=null&&(Le._next&&(Le._next._prev=Le._prev),Le._prev?(Le._prev._next=Le._next,Le._prev=null):this._firstPT===Le&&(this._firstPT=Le._next)),Le=Le._next;return!1},$._mod=$._roundProps=function(de){for(var Ae=this._firstPT,Le;Ae;)Le=de[this._propName]||Ae.n!=null&&de[Ae.n.split(this._propName+"_").join("")],Le&&typeof Le=="function"&&(Ae.f===2?Ae.t._applyPT.m=Le:Ae.m=Le),Ae=Ae._next},Fe._onPluginEvent=function(de,Ae){var Le=Ae._firstPT,Oe,$e,pt,Mt,Bt;if(de==="_onInitAllProps"){for(;Le;){for(Bt=Le._next,$e=pt;$e&&$e.pr>Le.pr;)$e=$e._next;(Le._prev=$e?$e._prev:Mt)?Le._prev._next=Le:pt=Le,(Le._next=$e)?$e._prev=Le:Mt=Le,Le=Bt}Le=Ae._firstPT=pt}for(;Le;)Le.pg&&typeof Le.t[de]=="function"&&Le.t[de]()&&(Oe=!0),Le=Le._next;return Oe},Bn.activate=function(de){for(var Ae=de.length;--Ae>-1;)de[Ae].API===Bn.API&&(nn[new de[Ae]()._propName]=de[Ae]);return!0},z.plugin=function(de){if(!de||!de.propName||!de.init||!de.API)throw"illegal plugin definition.";var Ae=de.propName,Le=de.priority||0,Oe=de.overwriteProps,$e={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_mod",mod:"_mod",initAll:"_onInitAllProps"},pt=ce("plugins."+Ae.charAt(0).toUpperCase()+Ae.substr(1)+"Plugin",function(){Bn.call(this,Ae,Le),this._overwriteProps=Oe||[]},de.global===!0),Mt=pt.prototype=new Bn(Ae),Bt;Mt.constructor=pt,pt.API=de.API;for(Bt in $e)typeof de[Bt]=="function"&&(Mt[$e[Bt]]=de[Bt]);return pt.version=de.version,Bn.activate([pt]),pt},X=u._gsQueue,X){for(J=0;J<X.length;J++)X[J]();for($ in H)H[$].func||u.console.log("GSAP encountered missing dependency: "+$)}ne=!1})(typeof module<"u"&&module.exports&&typeof global<"u"?global:globalThis||window,"TweenMax");
